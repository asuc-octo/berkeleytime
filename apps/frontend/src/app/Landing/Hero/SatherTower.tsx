import { useEffect, useMemo, useState } from "react";

interface SatherTowerProps {
  className?: string;
}

const COLORS = {
  light: "#B9CEEA",
  moderate: "#3568A5",
  bright: "#FFFFFF",
  dark: "#2C3642",
};

export default function SatherTower({ className }: SatherTowerProps) {
  const [time, setTime] = useState(() => Date.now());

  useEffect(() => {
    const interval = setInterval(() => {
      setTime(Date.now());
    }, 1000);
    return () => clearInterval(interval);
  }, []);

  const { hourAngle, minuteAngle } = useMemo(() => {
    const date = new Date(time);
    const hours = date.getHours() % 12;
    const minutes = date.getMinutes();
    const seconds = date.getSeconds();

    // Hour hand: 30 degrees per hour + 0.5 degrees per minute
    const hourAngle = (hours + minutes / 60) * 30;
    // Minute hand: 6 degrees per minute + 0.1 degrees per second
    const minuteAngle = (minutes + seconds / 60) * 6;

    return { hourAngle, minuteAngle };
  }, [time]);

  // Left clock (front-facing)
  const leftClockCenter = { x: 940, y: 507 };
  const leftClockSkew = -8;

  // Right clock (side-facing)
  const rightClockCenter = { x: 1032, y: 511 };
  const rightClockSkew = 15;

  // Hand lengths
  const hourHandLength = 18;
  const minuteHandLength = 28;

  return (
    <svg
      className={className}
      xmlns="http://www.w3.org/2000/svg"
      viewBox="880 30 200 720"
    >
      <g id="light">
        <polygon
          points="1060.687 294.727 1052.222 224.092 1047.46 227.531 1040.052 274.621 1010.092 244.661 983.702 88.112 983.161 77.199 981.255 74.223 974.906 72.768 969.417 81.895 936.275 207.028 922.326 233.219 919.548 237.187 921.929 239.833 921.929 260.57 907.71 268.669 907.71 281.169 900.964 317.481 898.384 476.211 894.48 889.017 1057.229 889.017 1060.687 294.727"
          fill={COLORS.light}
        />
      </g>
      <g id="moderate">
        <g>
          <polygon
            points="907.644 221.182 914.37 265.08 909.892 266.883 909.595 294.86 901.757 297.935 903.543 219.991 907.644 221.182"
            fill={COLORS.moderate}
          />
          <polyline
            points="977.452 34.441 973.451 48.363 979.536 77.645"
            fill={COLORS.moderate}
          />
          <path
            d="M1070.45,449.407l-2.869-1.098.021-5.689-1.942-1.512v-128.065l6.899.071v-7.516l-9.468-3.353v-25.254l-.188-5.346-1.323-.992-4.464-40.873-2.05-2.05-2.315-7.374,1.521.033.033-4.233-2.745-6.085-2.976,6.283-.132,4.167,2.282-.132-3.175,7.407h5.026l1.249,45.48v26.463l-.985-.295v-32.486l-20.316-6.558-.533-20.872,3.813-1.562v-4.823l-3.996-1.544v-4.167l-2.844-.959v-4.068l-3.127-1.199-37.316-130.615-.017-3.704.719-1.811v-3.075l-2.468-1.314v-6.659l-.285-.285v-1.637l-2.232-2.232v-.967l.62-.794.198-2.505-1.563-.174-.116-.62,1.604-15.774,2.53-4.018-.248-.546h-1.786l-2.431-.843-1.736-1.687-1.587-3.026-.397-4.117,1.24-.447v-1.24l-.893-.298-.645-.447-.496-.496-.843-22.669.124,22.446-1.414,1.414-2.133.744.843.893h2.431l2.083,43.205,1.835.298.099,3.572-1.289,4.613s9.473,99.604,9.473,100.596l1.852-2.447,1.19,10.33v7.792l-16.535,72.487-96.562,31.397,8.261,4.968,17.467,15.156,1.389,6.349,2.688,7.066,18.681,35.898,4.285-39.991,19.07,35.935,4.066-40.059,21.181,40.695-1.816,50.669-92.241,25.283,5.515,5.427,15.793,12.208,3.175,2.861,26.333,72.065-5.537,347.939h127.851v-415.007l1.536.59-.167,414.417,11.646-1.034v-425.505l-1.885-2.265,3.445-5.456.015-5.35Z"
            fill={COLORS.moderate}
          />
        </g>
      </g>
      <g id="bright">
        <g>
          <path
            d="M978.544,86.128l-.661-8.466,1.653-.017v-6.498l-.694-2.53-.347-25.893-.744-1.538-.298-6.746h-1.29l-.992,5.06-2.877,3.224-3.323.744-.942,1.339,2.728,3.671.843,15.774-1.339.446-.149,1.339,1.24,2.976-2.183,1.29-1.141,3.621v4.948l-2.778.707v4.365l1.389,3.571-37.699,128.969-9.524,14.286.132,6.415,2.778-3.968,57.648-9.544,2.339-17.771-3.77-119.776ZM939.787,211.411l-3.733.788,34.045-121.365,2.687-.263-32.999,120.84Z"
            fill={COLORS.bright}
          />
          <path
            d="M887.862,311.251v123.706l-1.579.549v5.361l-3.483.72-.068,6.93,112.305-19.023.115-136.147-107.289,17.904ZM927.949,429.514l-18.72,3.005.06-11.755,18.72-3.005-.06,11.755ZM928.116,413.279l-18.72,3.005.395-77.423c.025-4.826,4.106-9.391,9.115-10.195l.578-.093c5.01-.804,9.051,2.456,9.026,7.283l-.395,77.423ZM950.742,425.855l-18.72,3.005.06-11.755,18.72-3.005-.06,11.755ZM950.908,409.62l-18.72,3.005.395-77.423c.025-4.826,4.106-9.391,9.115-10.195l.578-.093c5.01-.804,9.051,2.456,9.026,7.283l-.395,77.423ZM973.702,422.169l-18.72,3.005.06-11.755,18.72-3.005-.06,11.755ZM973.869,405.935l-18.72,3.005.395-77.423c.025-4.826,4.106-9.391,9.115-10.195l.578-.093c5.01-.804,9.051,2.456,9.026,7.283l-.395,77.423ZM906.718,327.247l.066,109.777-1.455.298v-110.914h0v-.042s71.823-11.925,71.823-11.925l.002,1.103-70.436,11.703Z"
            fill={COLORS.bright}
          />
          <path
            d="M992.697,194.606l-1.19-10.33-1.852,2.447-1.488,1.935v6.448l1.67.347-2.86,6.945-1.091.595-4.755,33.921-.707-10.814-55.451,9.235-1.658,2.45,12.696,19.934-29.179,4.869v29.096l-1.569.347v-29.216l-1.72-42.825,4.101,1.19-1.587-1.587-2.381-6.614,1.587-.781v-5.833l-2.249-4.63-3.439,5.291v5.172l1.72.649-1.852,6.349-2.348,1.554-5.06,40.973-1.587,1.091v34.028l-10.847,1.914v7.525l115.545-19.295v-41.708l-2.449-50.674ZM958.013,247.763l.173,6.411-10.6,1.976-.173-6.411,10.6-1.977ZM926.559,274.803l-16.667,2.814v-10.318l16.667-2.814v10.318ZM948.93,271.032l-16.667,2.814v-10.318l16.667-2.814v10.318ZM971.301,267.262l-16.667,2.814v-10.318l16.667-2.814v10.318Z"
            fill={COLORS.bright}
          />
          <path
            d="M888.147,453.679l-3.652,2.69v432.648h19.445v-423.13l73.413-11.905v3.376l-70.239,11.39v420.269h87.921v-452.886l-106.889,17.548ZM941.302,806.491l-3.073.397v-22.251l3.073-.397v22.251ZM941.805,697.482l-3.073.397v-22.251l3.073-.397v22.251ZM941.805,588.473l-3.073.397v-22.251l3.073-.397v22.251Z"
            fill={COLORS.bright}
          />
        </g>
      </g>
      <g id="dark">
        <g>
          <g>
            <polygon
              points="1009.197 423.591 1009.191 411.686 1022.175 416.217 1022.181 428.122 1009.197 423.591"
              fill={COLORS.dark}
            />
            <path
              d="M1009.248,407.184l-.035-78.409c-.002-4.888,2.813-7.867,6.287-6.654l.401.14c3.475,1.213,6.293,6.158,6.295,11.046l.035,78.409-12.984-4.531Z"
              fill={COLORS.dark}
            />
            <polygon
              points="1025.005 429.108 1025 417.203 1037.983 421.734 1037.989 433.639 1025.005 429.108"
              fill={COLORS.dark}
            />
            <path
              d="M1025.056,412.701l-.035-78.409c-.002-4.888,2.813-7.867,6.287-6.654l.401.14c3.475,1.213,6.293,6.158,6.295,11.046l.035,78.409-12.984-4.531Z"
              fill={COLORS.dark}
            />
            <polygon
              points="1040.93 434.666 1040.925 422.761 1053.908 427.292 1053.914 439.197 1040.93 434.666"
              fill={COLORS.dark}
            />
            <path
              d="M1040.981,418.259l-.035-78.409c-.002-4.888,2.813-7.867,6.287-6.654l.401.14c3.475,1.213,6.293,6.158,6.295,11.046l.035,78.409-12.984-4.531Z"
              fill={COLORS.dark}
            />
          </g>
          <polygon
            points="1065.631 316.69 995.221 293.224 995.221 287.083 1072.46 312.849 1065.631 316.69"
            fill={COLORS.dark}
          />
          <polygon
            points="1035.814 237.966 1002.214 226.758 1002.88 230.123 1032.001 239.528 1035.814 237.966"
            fill={COLORS.dark}
          />
          <polygon
            points="1066.99 460.213 995.036 436.131 995.036 429.494 1070.435 454.757 1066.99 460.213"
            fill={COLORS.dark}
          />
          <polygon
            points="1035.403 592.615 1032.862 591.615 1032.862 569.337 1035.403 570.337 1035.403 592.615"
            fill={COLORS.dark}
          />
          <polygon
            points="1035.403 700.336 1032.862 699.336 1032.862 677.058 1035.403 678.058 1035.403 700.336"
            fill={COLORS.dark}
          />
          <polygon
            points="1035.403 808.057 1032.862 807.057 1032.862 784.779 1035.403 785.779 1035.403 808.057"
            fill={COLORS.dark}
          />
          <polygon
            points="1055.861 475.876 1008.053 460.305 1008.077 458.196 1057.396 474.582 1055.861 475.876"
            fill={COLORS.dark}
          />
          <polygon
            points="1020.024 261.747 1007.761 257.701 1007.761 268.514 1020.024 272.56 1020.024 261.747"
            fill={COLORS.dark}
          />
          <polygon
            points="1034.658 266.947 1022.395 262.901 1022.395 273.714 1034.658 277.76 1034.658 266.947"
            fill={COLORS.dark}
          />
          <polygon
            points="1049.292 271.548 1037.029 267.503 1037.029 278.316 1049.292 282.361 1049.292 271.548"
            fill={COLORS.dark}
          />
          <polygon
            points="1054.365 332.925 1006.278 316.938 1006.39 316.193 1054.6 332.222 1054.365 332.925"
            fill={COLORS.dark}
          />
          <polygon
            points="1017.291 251.556 1008.539 248.669 1008.539 253.41 1017.291 256.297 1017.291 251.556"
            fill={COLORS.dark}
          />
        </g>
      </g>

      {/* Clock faces with hands */}
      <g id="clocks">
        {/* Left clock (front-facing) */}
        <g
          transform={`translate(${leftClockCenter.x}, ${leftClockCenter.y}) skewY(${leftClockSkew})`}
        >
          {/* Hour hand */}
          <line
            x1="0"
            y1="0"
            x2="0"
            y2={-hourHandLength}
            stroke={COLORS.light}
            strokeWidth="2.5"
            strokeLinecap="round"
            transform={`rotate(${hourAngle})`}
          />
          {/* Minute hand */}
          <line
            x1="0"
            y1="0"
            x2="0"
            y2={-minuteHandLength}
            stroke={COLORS.light}
            strokeWidth="1.5"
            strokeLinecap="round"
            transform={`rotate(${minuteAngle})`}
          />
        </g>

        {/* Right clock (side-facing) */}
        <g
          transform={`translate(${rightClockCenter.x}, ${rightClockCenter.y}) skewY(${rightClockSkew}) scale(0.5, 1)`}
        >
          {/* Hour hand */}
          <line
            x1="0"
            y1="0"
            x2="0"
            y2={-hourHandLength}
            stroke={COLORS.dark}
            strokeWidth="3"
            strokeLinecap="round"
            transform={`rotate(${hourAngle})`}
          />
          {/* Minute hand */}
          <line
            x1="0"
            y1="0"
            x2="0"
            y2={-minuteHandLength}
            stroke={COLORS.dark}
            strokeWidth="2"
            strokeLinecap="round"
            transform={`rotate(${minuteAngle})`}
          />
        </g>
      </g>
    </svg>
  );
}
