version: '3'
services:
  backend:
    image: berkeleytime/berkeleytime:latest
    command: ["0.0.0.0:8000"]
    volumes:
     - ../berkeleytime:/berkeleytime
    environment:
     - "PYTHONUNBUFFERED=1"
     - "GOOGLE_CLIENT_ID=***REMOVED***"
     - "GOOGLE_CLIENT_SECRET=***REMOVED***"
     - "GOOGLE_TOKEN_URI=https://accounts.google.com/o/oauth2/token"
     - "ENVIRONMENT_NAME=LOCALHOST"
     - "DATABASE_URL=postgres://bt_read:yuxinsucks@35.236.65.95:5432/bt_main"
     - "SIS_CLASS_APP_ID=***REMOVED***"
     - "SIS_CLASS_APP_KEY=***REMOVED***"
     - "SIS_COURSE_APP_ID=***REMOVED***"
     - "SIS_COURSE_APP_KEY=***REMOVED***"
    depends_on:
     - redis
#     - postgres
  frontend:
    image: berkeleytime/frontend:latest
    volumes:
     - ../frontend:/frontend
     - /frontend/node_modules
  redis:
    image: redis:alpine
# no longer uses the local postgres database
#  postgres:
#    image: postgres:11
#    volumes:
#     - ./postgres-data:/var/lib/postgresql/data
  nginx:
    image: nginx
    volumes:
     - ./nginx.conf:/etc/nginx/conf.d/default.conf
    ports:
     - "8080:8080"
    depends_on:
     - backend
     - frontend
    
