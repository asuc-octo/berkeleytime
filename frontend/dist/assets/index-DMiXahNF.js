var E7=(t,n)=>()=>(n||t((n={exports:{}}).exports,n),n.exports);var sle=E7((ple,DC)=>{function RC(t,n){for(var o=0;o<n.length;o++){const u=n[o];if(typeof u!="string"&&!Array.isArray(u)){for(const d in u)if(d!=="default"&&!(d in t)){const g=Object.getOwnPropertyDescriptor(u,d);g&&Object.defineProperty(t,d,g.get?g:{enumerable:!0,get:()=>u[d]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))u(d);new MutationObserver(d=>{for(const g of d)if(g.type==="childList")for(const x of g.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&u(x)}).observe(document,{childList:!0,subtree:!0});function o(d){const g={};return d.integrity&&(g.integrity=d.integrity),d.referrerPolicy&&(g.referrerPolicy=d.referrerPolicy),d.crossOrigin==="use-credentials"?g.credentials="include":d.crossOrigin==="anonymous"?g.credentials="omit":g.credentials="same-origin",g}function u(d){if(d.ep)return;d.ep=!0;const g=o(d);fetch(d.href,g)}})();var mc=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function vp(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var X4={exports:{}},i1={},Y4={exports:{}},Tn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Y_=Symbol.for("react.element"),S7=Symbol.for("react.portal"),T7=Symbol.for("react.fragment"),C7=Symbol.for("react.strict_mode"),M7=Symbol.for("react.profiler"),I7=Symbol.for("react.provider"),A7=Symbol.for("react.context"),k7=Symbol.for("react.forward_ref"),P7=Symbol.for("react.suspense"),O7=Symbol.for("react.memo"),D7=Symbol.for("react.lazy"),vD=Symbol.iterator;function R7(t){return t===null||typeof t!="object"?null:(t=vD&&t[vD]||t["@@iterator"],typeof t=="function"?t:null)}var Q4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},K4=Object.assign,J4={};function xp(t,n,o){this.props=t,this.context=n,this.refs=J4,this.updater=o||Q4}xp.prototype.isReactComponent={};xp.prototype.setState=function(t,n){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,n,"setState")};xp.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function e5(){}e5.prototype=xp.prototype;function LC(t,n,o){this.props=t,this.context=n,this.refs=J4,this.updater=o||Q4}var zC=LC.prototype=new e5;zC.constructor=LC;K4(zC,xp.prototype);zC.isPureReactComponent=!0;var xD=Array.isArray,t5=Object.prototype.hasOwnProperty,NC={current:null},r5={key:!0,ref:!0,__self:!0,__source:!0};function n5(t,n,o){var u,d={},g=null,x=null;if(n!=null)for(u in n.ref!==void 0&&(x=n.ref),n.key!==void 0&&(g=""+n.key),n)t5.call(n,u)&&!r5.hasOwnProperty(u)&&(d[u]=n[u]);var T=arguments.length-2;if(T===1)d.children=o;else if(1<T){for(var s=Array(T),I=0;I<T;I++)s[I]=arguments[I+2];d.children=s}if(t&&t.defaultProps)for(u in T=t.defaultProps,T)d[u]===void 0&&(d[u]=T[u]);return{$$typeof:Y_,type:t,key:g,ref:x,props:d,_owner:NC.current}}function L7(t,n){return{$$typeof:Y_,type:t.type,key:n,ref:t.ref,props:t.props,_owner:t._owner}}function FC(t){return typeof t=="object"&&t!==null&&t.$$typeof===Y_}function z7(t){var n={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(o){return n[o]})}var bD=/\/+/g;function oE(t,n){return typeof t=="object"&&t!==null&&t.key!=null?z7(""+t.key):n.toString(36)}function H0(t,n,o,u,d){var g=typeof t;(g==="undefined"||g==="boolean")&&(t=null);var x=!1;if(t===null)x=!0;else switch(g){case"string":case"number":x=!0;break;case"object":switch(t.$$typeof){case Y_:case S7:x=!0}}if(x)return x=t,d=d(x),t=u===""?"."+oE(x,0):u,xD(d)?(o="",t!=null&&(o=t.replace(bD,"$&/")+"/"),H0(d,n,o,"",function(I){return I})):d!=null&&(FC(d)&&(d=L7(d,o+(!d.key||x&&x.key===d.key?"":(""+d.key).replace(bD,"$&/")+"/")+t)),n.push(d)),1;if(x=0,u=u===""?".":u+":",xD(t))for(var T=0;T<t.length;T++){g=t[T];var s=u+oE(g,T);x+=H0(g,n,o,s,d)}else if(s=R7(t),typeof s=="function")for(t=s.call(t),T=0;!(g=t.next()).done;)g=g.value,s=u+oE(g,T++),x+=H0(g,n,o,s,d);else if(g==="object")throw n=String(t),Error("Objects are not valid as a React child (found: "+(n==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":n)+"). If you meant to render a collection of children, use an array instead.");return x}function h0(t,n,o){if(t==null)return t;var u=[],d=0;return H0(t,u,"","",function(g){return n.call(o,g,d++)}),u}function N7(t){if(t._status===-1){var n=t._result;n=n(),n.then(function(o){(t._status===0||t._status===-1)&&(t._status=1,t._result=o)},function(o){(t._status===0||t._status===-1)&&(t._status=2,t._result=o)}),t._status===-1&&(t._status=0,t._result=n)}if(t._status===1)return t._result.default;throw t._result}var vs={current:null},Z0={transition:null},F7={ReactCurrentDispatcher:vs,ReactCurrentBatchConfig:Z0,ReactCurrentOwner:NC};Tn.Children={map:h0,forEach:function(t,n,o){h0(t,function(){n.apply(this,arguments)},o)},count:function(t){var n=0;return h0(t,function(){n++}),n},toArray:function(t){return h0(t,function(n){return n})||[]},only:function(t){if(!FC(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Tn.Component=xp;Tn.Fragment=T7;Tn.Profiler=M7;Tn.PureComponent=LC;Tn.StrictMode=C7;Tn.Suspense=P7;Tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F7;Tn.cloneElement=function(t,n,o){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var u=K4({},t.props),d=t.key,g=t.ref,x=t._owner;if(n!=null){if(n.ref!==void 0&&(g=n.ref,x=NC.current),n.key!==void 0&&(d=""+n.key),t.type&&t.type.defaultProps)var T=t.type.defaultProps;for(s in n)t5.call(n,s)&&!r5.hasOwnProperty(s)&&(u[s]=n[s]===void 0&&T!==void 0?T[s]:n[s])}var s=arguments.length-2;if(s===1)u.children=o;else if(1<s){T=Array(s);for(var I=0;I<s;I++)T[I]=arguments[I+2];u.children=T}return{$$typeof:Y_,type:t.type,key:d,ref:g,props:u,_owner:x}};Tn.createContext=function(t){return t={$$typeof:A7,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:I7,_context:t},t.Consumer=t};Tn.createElement=n5;Tn.createFactory=function(t){var n=n5.bind(null,t);return n.type=t,n};Tn.createRef=function(){return{current:null}};Tn.forwardRef=function(t){return{$$typeof:k7,render:t}};Tn.isValidElement=FC;Tn.lazy=function(t){return{$$typeof:D7,_payload:{_status:-1,_result:t},_init:N7}};Tn.memo=function(t,n){return{$$typeof:O7,type:t,compare:n===void 0?null:n}};Tn.startTransition=function(t){var n=Z0.transition;Z0.transition={};try{t()}finally{Z0.transition=n}};Tn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Tn.useCallback=function(t,n){return vs.current.useCallback(t,n)};Tn.useContext=function(t){return vs.current.useContext(t)};Tn.useDebugValue=function(){};Tn.useDeferredValue=function(t){return vs.current.useDeferredValue(t)};Tn.useEffect=function(t,n){return vs.current.useEffect(t,n)};Tn.useId=function(){return vs.current.useId()};Tn.useImperativeHandle=function(t,n,o){return vs.current.useImperativeHandle(t,n,o)};Tn.useInsertionEffect=function(t,n){return vs.current.useInsertionEffect(t,n)};Tn.useLayoutEffect=function(t,n){return vs.current.useLayoutEffect(t,n)};Tn.useMemo=function(t,n){return vs.current.useMemo(t,n)};Tn.useReducer=function(t,n,o){return vs.current.useReducer(t,n,o)};Tn.useRef=function(t){return vs.current.useRef(t)};Tn.useState=function(t){return vs.current.useState(t)};Tn.useSyncExternalStore=function(t,n,o){return vs.current.useSyncExternalStore(t,n,o)};Tn.useTransition=function(){return vs.current.useTransition()};Tn.version="18.2.0";Y4.exports=Tn;var W=Y4.exports;const BC=vp(W),i5=RC({__proto__:null,default:BC},[W]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B7=W,j7=Symbol.for("react.element"),$7=Symbol.for("react.fragment"),U7=Object.prototype.hasOwnProperty,V7=B7.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,G7={key:!0,ref:!0,__self:!0,__source:!0};function o5(t,n,o){var u,d={},g=null,x=null;o!==void 0&&(g=""+o),n.key!==void 0&&(g=""+n.key),n.ref!==void 0&&(x=n.ref);for(u in n)U7.call(n,u)&&!G7.hasOwnProperty(u)&&(d[u]=n[u]);if(t&&t.defaultProps)for(u in n=t.defaultProps,n)d[u]===void 0&&(d[u]=n[u]);return{$$typeof:j7,type:t,key:g,ref:x,props:d,_owner:V7.current}}i1.Fragment=$7;i1.jsx=o5;i1.jsxs=o5;X4.exports=i1;var Y=X4.exports,GS=function(t,n){return GS=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,u){o.__proto__=u}||function(o,u){for(var d in u)Object.prototype.hasOwnProperty.call(u,d)&&(o[d]=u[d])},GS(t,n)};function jl(t,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");GS(t,n);function o(){this.constructor=t}t.prototype=n===null?Object.create(n):(o.prototype=n.prototype,new o)}var ct=function(){return ct=Object.assign||function(n){for(var o,u=1,d=arguments.length;u<d;u++){o=arguments[u];for(var g in o)Object.prototype.hasOwnProperty.call(o,g)&&(n[g]=o[g])}return n},ct.apply(this,arguments)};function ka(t,n){var o={};for(var u in t)Object.prototype.hasOwnProperty.call(t,u)&&n.indexOf(u)<0&&(o[u]=t[u]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,u=Object.getOwnPropertySymbols(t);d<u.length;d++)n.indexOf(u[d])<0&&Object.prototype.propertyIsEnumerable.call(t,u[d])&&(o[u[d]]=t[u[d]]);return o}function yu(t,n,o,u){function d(g){return g instanceof o?g:new o(function(x){x(g)})}return new(o||(o=Promise))(function(g,x){function T(O){try{I(u.next(O))}catch(D){x(D)}}function s(O){try{I(u.throw(O))}catch(D){x(D)}}function I(O){O.done?g(O.value):d(O.value).then(T,s)}I((u=u.apply(t,n||[])).next())})}function vu(t,n){var o={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},u,d,g,x;return x={next:T(0),throw:T(1),return:T(2)},typeof Symbol=="function"&&(x[Symbol.iterator]=function(){return this}),x;function T(I){return function(O){return s([I,O])}}function s(I){if(u)throw new TypeError("Generator is already executing.");for(;x&&(x=0,I[0]&&(o=0)),o;)try{if(u=1,d&&(g=I[0]&2?d.return:I[0]?d.throw||((g=d.return)&&g.call(d),0):d.next)&&!(g=g.call(d,I[1])).done)return g;switch(d=0,g&&(I=[I[0]&2,g.value]),I[0]){case 0:case 1:g=I;break;case 4:return o.label++,{value:I[1],done:!1};case 5:o.label++,d=I[1],I=[0];continue;case 7:I=o.ops.pop(),o.trys.pop();continue;default:if(g=o.trys,!(g=g.length>0&&g[g.length-1])&&(I[0]===6||I[0]===2)){o=0;continue}if(I[0]===3&&(!g||I[1]>g[0]&&I[1]<g[3])){o.label=I[1];break}if(I[0]===6&&o.label<g[1]){o.label=g[1],g=I;break}if(g&&o.label<g[2]){o.label=g[2],o.ops.push(I);break}g[2]&&o.ops.pop(),o.trys.pop();continue}I=n.call(t,o)}catch(O){I=[6,O],d=0}finally{u=g=0}if(I[0]&5)throw I[1];return{value:I[0]?I[1]:void 0,done:!0}}}function Ia(t,n,o){if(o||arguments.length===2)for(var u=0,d=n.length,g;u<d;u++)(g||!(u in n))&&(g||(g=Array.prototype.slice.call(n,0,u)),g[u]=n[u]);return t.concat(g||Array.prototype.slice.call(n))}var sE="Invariant Violation",wD=Object.setPrototypeOf,q7=wD===void 0?function(t,n){return t.__proto__=n,t}:wD,s5=function(t){jl(n,t);function n(o){o===void 0&&(o=sE);var u=t.call(this,typeof o=="number"?sE+": "+o+" (see https://github.com/apollographql/invariant-packages)":o)||this;return u.framesToPop=1,u.name=sE,q7(u,n.prototype),u}return n}(Error);function qh(t,n){if(!t)throw new s5(n)}var a5=["debug","log","warn","error","silent"],W7=a5.indexOf("log");function d0(t){return function(){if(a5.indexOf(t)>=W7){var n=console[t]||console.log;return n.apply(console,arguments)}}}(function(t){t.debug=d0("debug"),t.log=d0("log"),t.warn=d0("warn"),t.error=d0("error")})(qh||(qh={}));var jC="3.9.5";function tl(t){try{return t()}catch{}}const qS=tl(function(){return globalThis})||tl(function(){return window})||tl(function(){return self})||tl(function(){return global})||tl(function(){return tl.constructor("return this")()});var ED=new Map;function WS(t){var n=ED.get(t)||1;return ED.set(t,n+1),"".concat(t,":").concat(n,":").concat(Math.random().toString(36).slice(2))}function l5(t,n){n===void 0&&(n=0);var o=WS("stringifyForDisplay");return JSON.stringify(t,function(u,d){return d===void 0?o:d},n).split(JSON.stringify(o)).join("<undefined>")}function f0(t){return function(n){for(var o=[],u=1;u<arguments.length;u++)o[u-1]=arguments[u];if(typeof n=="number"){var d=n;n=$C(d),n||(n=UC(d,o),o=[])}t.apply(void 0,[n].concat(o))}}var kr=Object.assign(function(n,o){for(var u=[],d=2;d<arguments.length;d++)u[d-2]=arguments[d];n||qh(n,$C(o,u)||UC(o,u))},{debug:f0(qh.debug),log:f0(qh.log),warn:f0(qh.warn),error:f0(qh.error)});function ys(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];return new s5($C(t,n)||UC(t,n))}var SD=Symbol.for("ApolloErrorMessageHandler_"+jC);function c5(t){return typeof t=="string"?t:l5(t,2).slice(0,1e3)}function $C(t,n){if(n===void 0&&(n=[]),!!t)return qS[SD]&&qS[SD](t,n.map(c5))}function UC(t,n){if(n===void 0&&(n=[]),!!t)return"An error occurred! For more details, see the full error text at https://go.apollo.dev/c/err#".concat(encodeURIComponent(JSON.stringify({version:jC,message:t,args:n.map(c5)})))}function X0(t,n){if(!!!t)throw new Error(n)}function H7(t){return typeof t=="object"&&t!==null}function Z7(t,n){if(!!!t)throw new Error(n??"Unexpected invariant triggered.")}const X7=/\r\n|[\n\r]/g;function HS(t,n){let o=0,u=1;for(const d of t.body.matchAll(X7)){if(typeof d.index=="number"||Z7(!1),d.index>=n)break;o=d.index+d[0].length,u+=1}return{line:u,column:n+1-o}}function Y7(t){return u5(t.source,HS(t.source,t.start))}function u5(t,n){const o=t.locationOffset.column-1,u="".padStart(o)+t.body,d=n.line-1,g=t.locationOffset.line-1,x=n.line+g,T=n.line===1?o:0,s=n.column+T,I=`${t.name}:${x}:${s}
`,O=u.split(/\r\n|[\n\r]/g),D=O[d];if(D.length>120){const N=Math.floor(s/80),j=s%80,G=[];for(let X=0;X<D.length;X+=80)G.push(D.slice(X,X+80));return I+TD([[`${x} |`,G[0]],...G.slice(1,N+1).map(X=>["|",X]),["|","^".padStart(j)],["|",G[N+1]]])}return I+TD([[`${x-1} |`,O[d-1]],[`${x} |`,D],["|","^".padStart(s)],[`${x+1} |`,O[d+1]]])}function TD(t){const n=t.filter(([u,d])=>d!==void 0),o=Math.max(...n.map(([u])=>u.length));return n.map(([u,d])=>u.padStart(o)+(d?" "+d:"")).join(`
`)}function Q7(t){const n=t[0];return n==null||"kind"in n||"length"in n?{nodes:n,source:t[1],positions:t[2],path:t[3],originalError:t[4],extensions:t[5]}:n}class VC extends Error{constructor(n,...o){var u,d,g;const{nodes:x,source:T,positions:s,path:I,originalError:O,extensions:D}=Q7(o);super(n),this.name="GraphQLError",this.path=I??void 0,this.originalError=O??void 0,this.nodes=CD(Array.isArray(x)?x:x?[x]:void 0);const N=CD((u=this.nodes)===null||u===void 0?void 0:u.map(G=>G.loc).filter(G=>G!=null));this.source=T??(N==null||(d=N[0])===null||d===void 0?void 0:d.source),this.positions=s??(N==null?void 0:N.map(G=>G.start)),this.locations=s&&T?s.map(G=>HS(T,G)):N==null?void 0:N.map(G=>HS(G.source,G.start));const j=H7(O==null?void 0:O.extensions)?O==null?void 0:O.extensions:void 0;this.extensions=(g=D??j)!==null&&g!==void 0?g:Object.create(null),Object.defineProperties(this,{message:{writable:!0,enumerable:!0},name:{enumerable:!1},nodes:{enumerable:!1},source:{enumerable:!1},positions:{enumerable:!1},originalError:{enumerable:!1}}),O!=null&&O.stack?Object.defineProperty(this,"stack",{value:O.stack,writable:!0,configurable:!0}):Error.captureStackTrace?Error.captureStackTrace(this,VC):Object.defineProperty(this,"stack",{value:Error().stack,writable:!0,configurable:!0})}get[Symbol.toStringTag](){return"GraphQLError"}toString(){let n=this.message;if(this.nodes)for(const o of this.nodes)o.loc&&(n+=`

`+Y7(o.loc));else if(this.source&&this.locations)for(const o of this.locations)n+=`

`+u5(this.source,o);return n}toJSON(){const n={message:this.message};return this.locations!=null&&(n.locations=this.locations),this.path!=null&&(n.path=this.path),this.extensions!=null&&Object.keys(this.extensions).length>0&&(n.extensions=this.extensions),n}}function CD(t){return t===void 0||t.length===0?void 0:t}function Mo(t,n,o){return new VC(`Syntax Error: ${o}`,{source:t,positions:[n]})}let K7=class{constructor(n,o,u){this.start=n.start,this.end=o.end,this.startToken=n,this.endToken=o,this.source=u}get[Symbol.toStringTag](){return"Location"}toJSON(){return{start:this.start,end:this.end}}};class h5{constructor(n,o,u,d,g,x){this.kind=n,this.start=o,this.end=u,this.line=d,this.column=g,this.value=x,this.prev=null,this.next=null}get[Symbol.toStringTag](){return"Token"}toJSON(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}}}const d5={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},J7=new Set(Object.keys(d5));function MD(t){const n=t==null?void 0:t.kind;return typeof n=="string"&&J7.has(n)}var kf;(function(t){t.QUERY="query",t.MUTATION="mutation",t.SUBSCRIPTION="subscription"})(kf||(kf={}));var ZS;(function(t){t.QUERY="QUERY",t.MUTATION="MUTATION",t.SUBSCRIPTION="SUBSCRIPTION",t.FIELD="FIELD",t.FRAGMENT_DEFINITION="FRAGMENT_DEFINITION",t.FRAGMENT_SPREAD="FRAGMENT_SPREAD",t.INLINE_FRAGMENT="INLINE_FRAGMENT",t.VARIABLE_DEFINITION="VARIABLE_DEFINITION",t.SCHEMA="SCHEMA",t.SCALAR="SCALAR",t.OBJECT="OBJECT",t.FIELD_DEFINITION="FIELD_DEFINITION",t.ARGUMENT_DEFINITION="ARGUMENT_DEFINITION",t.INTERFACE="INTERFACE",t.UNION="UNION",t.ENUM="ENUM",t.ENUM_VALUE="ENUM_VALUE",t.INPUT_OBJECT="INPUT_OBJECT",t.INPUT_FIELD_DEFINITION="INPUT_FIELD_DEFINITION"})(ZS||(ZS={}));var xr;(function(t){t.NAME="Name",t.DOCUMENT="Document",t.OPERATION_DEFINITION="OperationDefinition",t.VARIABLE_DEFINITION="VariableDefinition",t.SELECTION_SET="SelectionSet",t.FIELD="Field",t.ARGUMENT="Argument",t.FRAGMENT_SPREAD="FragmentSpread",t.INLINE_FRAGMENT="InlineFragment",t.FRAGMENT_DEFINITION="FragmentDefinition",t.VARIABLE="Variable",t.INT="IntValue",t.FLOAT="FloatValue",t.STRING="StringValue",t.BOOLEAN="BooleanValue",t.NULL="NullValue",t.ENUM="EnumValue",t.LIST="ListValue",t.OBJECT="ObjectValue",t.OBJECT_FIELD="ObjectField",t.DIRECTIVE="Directive",t.NAMED_TYPE="NamedType",t.LIST_TYPE="ListType",t.NON_NULL_TYPE="NonNullType",t.SCHEMA_DEFINITION="SchemaDefinition",t.OPERATION_TYPE_DEFINITION="OperationTypeDefinition",t.SCALAR_TYPE_DEFINITION="ScalarTypeDefinition",t.OBJECT_TYPE_DEFINITION="ObjectTypeDefinition",t.FIELD_DEFINITION="FieldDefinition",t.INPUT_VALUE_DEFINITION="InputValueDefinition",t.INTERFACE_TYPE_DEFINITION="InterfaceTypeDefinition",t.UNION_TYPE_DEFINITION="UnionTypeDefinition",t.ENUM_TYPE_DEFINITION="EnumTypeDefinition",t.ENUM_VALUE_DEFINITION="EnumValueDefinition",t.INPUT_OBJECT_TYPE_DEFINITION="InputObjectTypeDefinition",t.DIRECTIVE_DEFINITION="DirectiveDefinition",t.SCHEMA_EXTENSION="SchemaExtension",t.SCALAR_TYPE_EXTENSION="ScalarTypeExtension",t.OBJECT_TYPE_EXTENSION="ObjectTypeExtension",t.INTERFACE_TYPE_EXTENSION="InterfaceTypeExtension",t.UNION_TYPE_EXTENSION="UnionTypeExtension",t.ENUM_TYPE_EXTENSION="EnumTypeExtension",t.INPUT_OBJECT_TYPE_EXTENSION="InputObjectTypeExtension"})(xr||(xr={}));function XS(t){return t===9||t===32}function __(t){return t>=48&&t<=57}function f5(t){return t>=97&&t<=122||t>=65&&t<=90}function p5(t){return f5(t)||t===95}function eU(t){return f5(t)||__(t)||t===95}function tU(t){var n;let o=Number.MAX_SAFE_INTEGER,u=null,d=-1;for(let x=0;x<t.length;++x){var g;const T=t[x],s=rU(T);s!==T.length&&(u=(g=u)!==null&&g!==void 0?g:x,d=x,x!==0&&s<o&&(o=s))}return t.map((x,T)=>T===0?x:x.slice(o)).slice((n=u)!==null&&n!==void 0?n:0,d+1)}function rU(t){let n=0;for(;n<t.length&&XS(t.charCodeAt(n));)++n;return n}function nU(t,n){const o=t.replace(/"""/g,'\\"""'),u=o.split(/\r\n|[\n\r]/g),d=u.length===1,g=u.length>1&&u.slice(1).every(j=>j.length===0||XS(j.charCodeAt(0))),x=o.endsWith('\\"""'),T=t.endsWith('"')&&!x,s=t.endsWith("\\"),I=T||s,O=!(n!=null&&n.minimize)&&(!d||t.length>70||I||g||x);let D="";const N=d&&XS(t.charCodeAt(0));return(O&&!N||g)&&(D+=`
`),D+=o,(O||I)&&(D+=`
`),'"""'+D+'"""'}var Lt;(function(t){t.SOF="<SOF>",t.EOF="<EOF>",t.BANG="!",t.DOLLAR="$",t.AMP="&",t.PAREN_L="(",t.PAREN_R=")",t.SPREAD="...",t.COLON=":",t.EQUALS="=",t.AT="@",t.BRACKET_L="[",t.BRACKET_R="]",t.BRACE_L="{",t.PIPE="|",t.BRACE_R="}",t.NAME="Name",t.INT="Int",t.FLOAT="Float",t.STRING="String",t.BLOCK_STRING="BlockString",t.COMMENT="Comment"})(Lt||(Lt={}));class iU{constructor(n){const o=new h5(Lt.SOF,0,0,0,0);this.source=n,this.lastToken=o,this.token=o,this.line=1,this.lineStart=0}get[Symbol.toStringTag](){return"Lexer"}advance(){return this.lastToken=this.token,this.token=this.lookahead()}lookahead(){let n=this.token;if(n.kind!==Lt.EOF)do if(n.next)n=n.next;else{const o=sU(this,n.end);n.next=o,o.prev=n,n=o}while(n.kind===Lt.COMMENT);return n}}function oU(t){return t===Lt.BANG||t===Lt.DOLLAR||t===Lt.AMP||t===Lt.PAREN_L||t===Lt.PAREN_R||t===Lt.SPREAD||t===Lt.COLON||t===Lt.EQUALS||t===Lt.AT||t===Lt.BRACKET_L||t===Lt.BRACKET_R||t===Lt.BRACE_L||t===Lt.PIPE||t===Lt.BRACE_R}function bp(t){return t>=0&&t<=55295||t>=57344&&t<=1114111}function o1(t,n){return m5(t.charCodeAt(n))&&g5(t.charCodeAt(n+1))}function m5(t){return t>=55296&&t<=56319}function g5(t){return t>=56320&&t<=57343}function rd(t,n){const o=t.source.body.codePointAt(n);if(o===void 0)return Lt.EOF;if(o>=32&&o<=126){const u=String.fromCodePoint(o);return u==='"'?`'"'`:`"${u}"`}return"U+"+o.toString(16).toUpperCase().padStart(4,"0")}function ao(t,n,o,u,d){const g=t.line,x=1+o-t.lineStart;return new h5(n,o,u,g,x,d)}function sU(t,n){const o=t.source.body,u=o.length;let d=n;for(;d<u;){const g=o.charCodeAt(d);switch(g){case 65279:case 9:case 32:case 44:++d;continue;case 10:++d,++t.line,t.lineStart=d;continue;case 13:o.charCodeAt(d+1)===10?d+=2:++d,++t.line,t.lineStart=d;continue;case 35:return aU(t,d);case 33:return ao(t,Lt.BANG,d,d+1);case 36:return ao(t,Lt.DOLLAR,d,d+1);case 38:return ao(t,Lt.AMP,d,d+1);case 40:return ao(t,Lt.PAREN_L,d,d+1);case 41:return ao(t,Lt.PAREN_R,d,d+1);case 46:if(o.charCodeAt(d+1)===46&&o.charCodeAt(d+2)===46)return ao(t,Lt.SPREAD,d,d+3);break;case 58:return ao(t,Lt.COLON,d,d+1);case 61:return ao(t,Lt.EQUALS,d,d+1);case 64:return ao(t,Lt.AT,d,d+1);case 91:return ao(t,Lt.BRACKET_L,d,d+1);case 93:return ao(t,Lt.BRACKET_R,d,d+1);case 123:return ao(t,Lt.BRACE_L,d,d+1);case 124:return ao(t,Lt.PIPE,d,d+1);case 125:return ao(t,Lt.BRACE_R,d,d+1);case 34:return o.charCodeAt(d+1)===34&&o.charCodeAt(d+2)===34?fU(t,d):cU(t,d)}if(__(g)||g===45)return lU(t,d,g);if(p5(g))return pU(t,d);throw Mo(t.source,d,g===39?`Unexpected single quote character ('), did you mean to use a double quote (")?`:bp(g)||o1(o,d)?`Unexpected character: ${rd(t,d)}.`:`Invalid character: ${rd(t,d)}.`)}return ao(t,Lt.EOF,u,u)}function aU(t,n){const o=t.source.body,u=o.length;let d=n+1;for(;d<u;){const g=o.charCodeAt(d);if(g===10||g===13)break;if(bp(g))++d;else if(o1(o,d))d+=2;else break}return ao(t,Lt.COMMENT,n,d,o.slice(n+1,d))}function lU(t,n,o){const u=t.source.body;let d=n,g=o,x=!1;if(g===45&&(g=u.charCodeAt(++d)),g===48){if(g=u.charCodeAt(++d),__(g))throw Mo(t.source,d,`Invalid number, unexpected digit after 0: ${rd(t,d)}.`)}else d=aE(t,d,g),g=u.charCodeAt(d);if(g===46&&(x=!0,g=u.charCodeAt(++d),d=aE(t,d,g),g=u.charCodeAt(d)),(g===69||g===101)&&(x=!0,g=u.charCodeAt(++d),(g===43||g===45)&&(g=u.charCodeAt(++d)),d=aE(t,d,g),g=u.charCodeAt(d)),g===46||p5(g))throw Mo(t.source,d,`Invalid number, expected digit but got: ${rd(t,d)}.`);return ao(t,x?Lt.FLOAT:Lt.INT,n,d,u.slice(n,d))}function aE(t,n,o){if(!__(o))throw Mo(t.source,n,`Invalid number, expected digit but got: ${rd(t,n)}.`);const u=t.source.body;let d=n+1;for(;__(u.charCodeAt(d));)++d;return d}function cU(t,n){const o=t.source.body,u=o.length;let d=n+1,g=d,x="";for(;d<u;){const T=o.charCodeAt(d);if(T===34)return x+=o.slice(g,d),ao(t,Lt.STRING,n,d+1,x);if(T===92){x+=o.slice(g,d);const s=o.charCodeAt(d+1)===117?o.charCodeAt(d+2)===123?uU(t,d):hU(t,d):dU(t,d);x+=s.value,d+=s.size,g=d;continue}if(T===10||T===13)break;if(bp(T))++d;else if(o1(o,d))d+=2;else throw Mo(t.source,d,`Invalid character within String: ${rd(t,d)}.`)}throw Mo(t.source,d,"Unterminated string.")}function uU(t,n){const o=t.source.body;let u=0,d=3;for(;d<12;){const g=o.charCodeAt(n+d++);if(g===125){if(d<5||!bp(u))break;return{value:String.fromCodePoint(u),size:d}}if(u=u<<4|Qg(g),u<0)break}throw Mo(t.source,n,`Invalid Unicode escape sequence: "${o.slice(n,n+d)}".`)}function hU(t,n){const o=t.source.body,u=ID(o,n+2);if(bp(u))return{value:String.fromCodePoint(u),size:6};if(m5(u)&&o.charCodeAt(n+6)===92&&o.charCodeAt(n+7)===117){const d=ID(o,n+8);if(g5(d))return{value:String.fromCodePoint(u,d),size:12}}throw Mo(t.source,n,`Invalid Unicode escape sequence: "${o.slice(n,n+6)}".`)}function ID(t,n){return Qg(t.charCodeAt(n))<<12|Qg(t.charCodeAt(n+1))<<8|Qg(t.charCodeAt(n+2))<<4|Qg(t.charCodeAt(n+3))}function Qg(t){return t>=48&&t<=57?t-48:t>=65&&t<=70?t-55:t>=97&&t<=102?t-87:-1}function dU(t,n){const o=t.source.body;switch(o.charCodeAt(n+1)){case 34:return{value:'"',size:2};case 92:return{value:"\\",size:2};case 47:return{value:"/",size:2};case 98:return{value:"\b",size:2};case 102:return{value:"\f",size:2};case 110:return{value:`
`,size:2};case 114:return{value:"\r",size:2};case 116:return{value:"	",size:2}}throw Mo(t.source,n,`Invalid character escape sequence: "${o.slice(n,n+2)}".`)}function fU(t,n){const o=t.source.body,u=o.length;let d=t.lineStart,g=n+3,x=g,T="";const s=[];for(;g<u;){const I=o.charCodeAt(g);if(I===34&&o.charCodeAt(g+1)===34&&o.charCodeAt(g+2)===34){T+=o.slice(x,g),s.push(T);const O=ao(t,Lt.BLOCK_STRING,n,g+3,tU(s).join(`
`));return t.line+=s.length-1,t.lineStart=d,O}if(I===92&&o.charCodeAt(g+1)===34&&o.charCodeAt(g+2)===34&&o.charCodeAt(g+3)===34){T+=o.slice(x,g),x=g+1,g+=4;continue}if(I===10||I===13){T+=o.slice(x,g),s.push(T),I===13&&o.charCodeAt(g+1)===10?g+=2:++g,T="",x=g,d=g;continue}if(bp(I))++g;else if(o1(o,g))g+=2;else throw Mo(t.source,g,`Invalid character within String: ${rd(t,g)}.`)}throw Mo(t.source,g,"Unterminated string.")}function pU(t,n){const o=t.source.body,u=o.length;let d=n+1;for(;d<u;){const g=o.charCodeAt(d);if(eU(g))++d;else break}return ao(t,Lt.NAME,n,d,o.slice(n,d))}const mU=10,_5=2;function GC(t){return s1(t,[])}function s1(t,n){switch(typeof t){case"string":return JSON.stringify(t);case"function":return t.name?`[function ${t.name}]`:"[function]";case"object":return gU(t,n);default:return String(t)}}function gU(t,n){if(t===null)return"null";if(n.includes(t))return"[Circular]";const o=[...n,t];if(_U(t)){const u=t.toJSON();if(u!==t)return typeof u=="string"?u:s1(u,o)}else if(Array.isArray(t))return vU(t,o);return yU(t,o)}function _U(t){return typeof t.toJSON=="function"}function yU(t,n){const o=Object.entries(t);return o.length===0?"{}":n.length>_5?"["+xU(t)+"]":"{ "+o.map(([d,g])=>d+": "+s1(g,n)).join(", ")+" }"}function vU(t,n){if(t.length===0)return"[]";if(n.length>_5)return"[Array]";const o=Math.min(mU,t.length),u=t.length-o,d=[];for(let g=0;g<o;++g)d.push(s1(t[g],n));return u===1?d.push("... 1 more item"):u>1&&d.push(`... ${u} more items`),"["+d.join(", ")+"]"}function xU(t){const n=Object.prototype.toString.call(t).replace(/^\[object /,"").replace(/]$/,"");if(n==="Object"&&typeof t.constructor=="function"){const o=t.constructor.name;if(typeof o=="string"&&o!=="")return o}return n}const bU=globalThis.process?function(n,o){return n instanceof o}:function(n,o){if(n instanceof o)return!0;if(typeof n=="object"&&n!==null){var u;const d=o.prototype[Symbol.toStringTag],g=Symbol.toStringTag in n?n[Symbol.toStringTag]:(u=n.constructor)===null||u===void 0?void 0:u.name;if(d===g){const x=GC(n);throw new Error(`Cannot use ${d} "${x}" from another module or realm.

Ensure that there is only one instance of "graphql" in the node_modules
directory. If different versions of "graphql" are the dependencies of other
relied on modules, use "resolutions" to ensure only one version is installed.

https://yarnpkg.com/en/docs/selective-version-resolutions

Duplicate "graphql" modules cannot be used at the same time since different
versions may have different capabilities and behavior. The data from one
version used in the function from another could produce confusing and
spurious results.`)}}return!1};class y5{constructor(n,o="GraphQL request",u={line:1,column:1}){typeof n=="string"||X0(!1,`Body must be a string. Received: ${GC(n)}.`),this.body=n,this.name=o,this.locationOffset=u,this.locationOffset.line>0||X0(!1,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||X0(!1,"column in locationOffset is 1-indexed and must be positive.")}get[Symbol.toStringTag](){return"Source"}}function wU(t){return bU(t,y5)}function EU(t,n){return new SU(t,n).parseDocument()}class SU{constructor(n,o={}){const u=wU(n)?n:new y5(n);this._lexer=new iU(u),this._options=o,this._tokenCounter=0}parseName(){const n=this.expectToken(Lt.NAME);return this.node(n,{kind:xr.NAME,value:n.value})}parseDocument(){return this.node(this._lexer.token,{kind:xr.DOCUMENT,definitions:this.many(Lt.SOF,this.parseDefinition,Lt.EOF)})}parseDefinition(){if(this.peek(Lt.BRACE_L))return this.parseOperationDefinition();const n=this.peekDescription(),o=n?this._lexer.lookahead():this._lexer.token;if(o.kind===Lt.NAME){switch(o.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}if(n)throw Mo(this._lexer.source,this._lexer.token.start,"Unexpected description, descriptions are supported only on type definitions.");switch(o.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"extend":return this.parseTypeSystemExtension()}}throw this.unexpected(o)}parseOperationDefinition(){const n=this._lexer.token;if(this.peek(Lt.BRACE_L))return this.node(n,{kind:xr.OPERATION_DEFINITION,operation:kf.QUERY,name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet()});const o=this.parseOperationType();let u;return this.peek(Lt.NAME)&&(u=this.parseName()),this.node(n,{kind:xr.OPERATION_DEFINITION,operation:o,name:u,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseOperationType(){const n=this.expectToken(Lt.NAME);switch(n.value){case"query":return kf.QUERY;case"mutation":return kf.MUTATION;case"subscription":return kf.SUBSCRIPTION}throw this.unexpected(n)}parseVariableDefinitions(){return this.optionalMany(Lt.PAREN_L,this.parseVariableDefinition,Lt.PAREN_R)}parseVariableDefinition(){return this.node(this._lexer.token,{kind:xr.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(Lt.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(Lt.EQUALS)?this.parseConstValueLiteral():void 0,directives:this.parseConstDirectives()})}parseVariable(){const n=this._lexer.token;return this.expectToken(Lt.DOLLAR),this.node(n,{kind:xr.VARIABLE,name:this.parseName()})}parseSelectionSet(){return this.node(this._lexer.token,{kind:xr.SELECTION_SET,selections:this.many(Lt.BRACE_L,this.parseSelection,Lt.BRACE_R)})}parseSelection(){return this.peek(Lt.SPREAD)?this.parseFragment():this.parseField()}parseField(){const n=this._lexer.token,o=this.parseName();let u,d;return this.expectOptionalToken(Lt.COLON)?(u=o,d=this.parseName()):d=o,this.node(n,{kind:xr.FIELD,alias:u,name:d,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(Lt.BRACE_L)?this.parseSelectionSet():void 0})}parseArguments(n){const o=n?this.parseConstArgument:this.parseArgument;return this.optionalMany(Lt.PAREN_L,o,Lt.PAREN_R)}parseArgument(n=!1){const o=this._lexer.token,u=this.parseName();return this.expectToken(Lt.COLON),this.node(o,{kind:xr.ARGUMENT,name:u,value:this.parseValueLiteral(n)})}parseConstArgument(){return this.parseArgument(!0)}parseFragment(){const n=this._lexer.token;this.expectToken(Lt.SPREAD);const o=this.expectOptionalKeyword("on");return!o&&this.peek(Lt.NAME)?this.node(n,{kind:xr.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1)}):this.node(n,{kind:xr.INLINE_FRAGMENT,typeCondition:o?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentDefinition(){const n=this._lexer.token;return this.expectKeyword("fragment"),this._options.allowLegacyFragmentVariables===!0?this.node(n,{kind:xr.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()}):this.node(n,{kind:xr.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet()})}parseFragmentName(){if(this._lexer.token.value==="on")throw this.unexpected();return this.parseName()}parseValueLiteral(n){const o=this._lexer.token;switch(o.kind){case Lt.BRACKET_L:return this.parseList(n);case Lt.BRACE_L:return this.parseObject(n);case Lt.INT:return this.advanceLexer(),this.node(o,{kind:xr.INT,value:o.value});case Lt.FLOAT:return this.advanceLexer(),this.node(o,{kind:xr.FLOAT,value:o.value});case Lt.STRING:case Lt.BLOCK_STRING:return this.parseStringLiteral();case Lt.NAME:switch(this.advanceLexer(),o.value){case"true":return this.node(o,{kind:xr.BOOLEAN,value:!0});case"false":return this.node(o,{kind:xr.BOOLEAN,value:!1});case"null":return this.node(o,{kind:xr.NULL});default:return this.node(o,{kind:xr.ENUM,value:o.value})}case Lt.DOLLAR:if(n)if(this.expectToken(Lt.DOLLAR),this._lexer.token.kind===Lt.NAME){const u=this._lexer.token.value;throw Mo(this._lexer.source,o.start,`Unexpected variable "$${u}" in constant value.`)}else throw this.unexpected(o);return this.parseVariable();default:throw this.unexpected()}}parseConstValueLiteral(){return this.parseValueLiteral(!0)}parseStringLiteral(){const n=this._lexer.token;return this.advanceLexer(),this.node(n,{kind:xr.STRING,value:n.value,block:n.kind===Lt.BLOCK_STRING})}parseList(n){const o=()=>this.parseValueLiteral(n);return this.node(this._lexer.token,{kind:xr.LIST,values:this.any(Lt.BRACKET_L,o,Lt.BRACKET_R)})}parseObject(n){const o=()=>this.parseObjectField(n);return this.node(this._lexer.token,{kind:xr.OBJECT,fields:this.any(Lt.BRACE_L,o,Lt.BRACE_R)})}parseObjectField(n){const o=this._lexer.token,u=this.parseName();return this.expectToken(Lt.COLON),this.node(o,{kind:xr.OBJECT_FIELD,name:u,value:this.parseValueLiteral(n)})}parseDirectives(n){const o=[];for(;this.peek(Lt.AT);)o.push(this.parseDirective(n));return o}parseConstDirectives(){return this.parseDirectives(!0)}parseDirective(n){const o=this._lexer.token;return this.expectToken(Lt.AT),this.node(o,{kind:xr.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(n)})}parseTypeReference(){const n=this._lexer.token;let o;if(this.expectOptionalToken(Lt.BRACKET_L)){const u=this.parseTypeReference();this.expectToken(Lt.BRACKET_R),o=this.node(n,{kind:xr.LIST_TYPE,type:u})}else o=this.parseNamedType();return this.expectOptionalToken(Lt.BANG)?this.node(n,{kind:xr.NON_NULL_TYPE,type:o}):o}parseNamedType(){return this.node(this._lexer.token,{kind:xr.NAMED_TYPE,name:this.parseName()})}peekDescription(){return this.peek(Lt.STRING)||this.peek(Lt.BLOCK_STRING)}parseDescription(){if(this.peekDescription())return this.parseStringLiteral()}parseSchemaDefinition(){const n=this._lexer.token,o=this.parseDescription();this.expectKeyword("schema");const u=this.parseConstDirectives(),d=this.many(Lt.BRACE_L,this.parseOperationTypeDefinition,Lt.BRACE_R);return this.node(n,{kind:xr.SCHEMA_DEFINITION,description:o,directives:u,operationTypes:d})}parseOperationTypeDefinition(){const n=this._lexer.token,o=this.parseOperationType();this.expectToken(Lt.COLON);const u=this.parseNamedType();return this.node(n,{kind:xr.OPERATION_TYPE_DEFINITION,operation:o,type:u})}parseScalarTypeDefinition(){const n=this._lexer.token,o=this.parseDescription();this.expectKeyword("scalar");const u=this.parseName(),d=this.parseConstDirectives();return this.node(n,{kind:xr.SCALAR_TYPE_DEFINITION,description:o,name:u,directives:d})}parseObjectTypeDefinition(){const n=this._lexer.token,o=this.parseDescription();this.expectKeyword("type");const u=this.parseName(),d=this.parseImplementsInterfaces(),g=this.parseConstDirectives(),x=this.parseFieldsDefinition();return this.node(n,{kind:xr.OBJECT_TYPE_DEFINITION,description:o,name:u,interfaces:d,directives:g,fields:x})}parseImplementsInterfaces(){return this.expectOptionalKeyword("implements")?this.delimitedMany(Lt.AMP,this.parseNamedType):[]}parseFieldsDefinition(){return this.optionalMany(Lt.BRACE_L,this.parseFieldDefinition,Lt.BRACE_R)}parseFieldDefinition(){const n=this._lexer.token,o=this.parseDescription(),u=this.parseName(),d=this.parseArgumentDefs();this.expectToken(Lt.COLON);const g=this.parseTypeReference(),x=this.parseConstDirectives();return this.node(n,{kind:xr.FIELD_DEFINITION,description:o,name:u,arguments:d,type:g,directives:x})}parseArgumentDefs(){return this.optionalMany(Lt.PAREN_L,this.parseInputValueDef,Lt.PAREN_R)}parseInputValueDef(){const n=this._lexer.token,o=this.parseDescription(),u=this.parseName();this.expectToken(Lt.COLON);const d=this.parseTypeReference();let g;this.expectOptionalToken(Lt.EQUALS)&&(g=this.parseConstValueLiteral());const x=this.parseConstDirectives();return this.node(n,{kind:xr.INPUT_VALUE_DEFINITION,description:o,name:u,type:d,defaultValue:g,directives:x})}parseInterfaceTypeDefinition(){const n=this._lexer.token,o=this.parseDescription();this.expectKeyword("interface");const u=this.parseName(),d=this.parseImplementsInterfaces(),g=this.parseConstDirectives(),x=this.parseFieldsDefinition();return this.node(n,{kind:xr.INTERFACE_TYPE_DEFINITION,description:o,name:u,interfaces:d,directives:g,fields:x})}parseUnionTypeDefinition(){const n=this._lexer.token,o=this.parseDescription();this.expectKeyword("union");const u=this.parseName(),d=this.parseConstDirectives(),g=this.parseUnionMemberTypes();return this.node(n,{kind:xr.UNION_TYPE_DEFINITION,description:o,name:u,directives:d,types:g})}parseUnionMemberTypes(){return this.expectOptionalToken(Lt.EQUALS)?this.delimitedMany(Lt.PIPE,this.parseNamedType):[]}parseEnumTypeDefinition(){const n=this._lexer.token,o=this.parseDescription();this.expectKeyword("enum");const u=this.parseName(),d=this.parseConstDirectives(),g=this.parseEnumValuesDefinition();return this.node(n,{kind:xr.ENUM_TYPE_DEFINITION,description:o,name:u,directives:d,values:g})}parseEnumValuesDefinition(){return this.optionalMany(Lt.BRACE_L,this.parseEnumValueDefinition,Lt.BRACE_R)}parseEnumValueDefinition(){const n=this._lexer.token,o=this.parseDescription(),u=this.parseEnumValueName(),d=this.parseConstDirectives();return this.node(n,{kind:xr.ENUM_VALUE_DEFINITION,description:o,name:u,directives:d})}parseEnumValueName(){if(this._lexer.token.value==="true"||this._lexer.token.value==="false"||this._lexer.token.value==="null")throw Mo(this._lexer.source,this._lexer.token.start,`${p0(this._lexer.token)} is reserved and cannot be used for an enum value.`);return this.parseName()}parseInputObjectTypeDefinition(){const n=this._lexer.token,o=this.parseDescription();this.expectKeyword("input");const u=this.parseName(),d=this.parseConstDirectives(),g=this.parseInputFieldsDefinition();return this.node(n,{kind:xr.INPUT_OBJECT_TYPE_DEFINITION,description:o,name:u,directives:d,fields:g})}parseInputFieldsDefinition(){return this.optionalMany(Lt.BRACE_L,this.parseInputValueDef,Lt.BRACE_R)}parseTypeSystemExtension(){const n=this._lexer.lookahead();if(n.kind===Lt.NAME)switch(n.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(n)}parseSchemaExtension(){const n=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");const o=this.parseConstDirectives(),u=this.optionalMany(Lt.BRACE_L,this.parseOperationTypeDefinition,Lt.BRACE_R);if(o.length===0&&u.length===0)throw this.unexpected();return this.node(n,{kind:xr.SCHEMA_EXTENSION,directives:o,operationTypes:u})}parseScalarTypeExtension(){const n=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");const o=this.parseName(),u=this.parseConstDirectives();if(u.length===0)throw this.unexpected();return this.node(n,{kind:xr.SCALAR_TYPE_EXTENSION,name:o,directives:u})}parseObjectTypeExtension(){const n=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");const o=this.parseName(),u=this.parseImplementsInterfaces(),d=this.parseConstDirectives(),g=this.parseFieldsDefinition();if(u.length===0&&d.length===0&&g.length===0)throw this.unexpected();return this.node(n,{kind:xr.OBJECT_TYPE_EXTENSION,name:o,interfaces:u,directives:d,fields:g})}parseInterfaceTypeExtension(){const n=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");const o=this.parseName(),u=this.parseImplementsInterfaces(),d=this.parseConstDirectives(),g=this.parseFieldsDefinition();if(u.length===0&&d.length===0&&g.length===0)throw this.unexpected();return this.node(n,{kind:xr.INTERFACE_TYPE_EXTENSION,name:o,interfaces:u,directives:d,fields:g})}parseUnionTypeExtension(){const n=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");const o=this.parseName(),u=this.parseConstDirectives(),d=this.parseUnionMemberTypes();if(u.length===0&&d.length===0)throw this.unexpected();return this.node(n,{kind:xr.UNION_TYPE_EXTENSION,name:o,directives:u,types:d})}parseEnumTypeExtension(){const n=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");const o=this.parseName(),u=this.parseConstDirectives(),d=this.parseEnumValuesDefinition();if(u.length===0&&d.length===0)throw this.unexpected();return this.node(n,{kind:xr.ENUM_TYPE_EXTENSION,name:o,directives:u,values:d})}parseInputObjectTypeExtension(){const n=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");const o=this.parseName(),u=this.parseConstDirectives(),d=this.parseInputFieldsDefinition();if(u.length===0&&d.length===0)throw this.unexpected();return this.node(n,{kind:xr.INPUT_OBJECT_TYPE_EXTENSION,name:o,directives:u,fields:d})}parseDirectiveDefinition(){const n=this._lexer.token,o=this.parseDescription();this.expectKeyword("directive"),this.expectToken(Lt.AT);const u=this.parseName(),d=this.parseArgumentDefs(),g=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");const x=this.parseDirectiveLocations();return this.node(n,{kind:xr.DIRECTIVE_DEFINITION,description:o,name:u,arguments:d,repeatable:g,locations:x})}parseDirectiveLocations(){return this.delimitedMany(Lt.PIPE,this.parseDirectiveLocation)}parseDirectiveLocation(){const n=this._lexer.token,o=this.parseName();if(Object.prototype.hasOwnProperty.call(ZS,o.value))return o;throw this.unexpected(n)}node(n,o){return this._options.noLocation!==!0&&(o.loc=new K7(n,this._lexer.lastToken,this._lexer.source)),o}peek(n){return this._lexer.token.kind===n}expectToken(n){const o=this._lexer.token;if(o.kind===n)return this.advanceLexer(),o;throw Mo(this._lexer.source,o.start,`Expected ${v5(n)}, found ${p0(o)}.`)}expectOptionalToken(n){return this._lexer.token.kind===n?(this.advanceLexer(),!0):!1}expectKeyword(n){const o=this._lexer.token;if(o.kind===Lt.NAME&&o.value===n)this.advanceLexer();else throw Mo(this._lexer.source,o.start,`Expected "${n}", found ${p0(o)}.`)}expectOptionalKeyword(n){const o=this._lexer.token;return o.kind===Lt.NAME&&o.value===n?(this.advanceLexer(),!0):!1}unexpected(n){const o=n??this._lexer.token;return Mo(this._lexer.source,o.start,`Unexpected ${p0(o)}.`)}any(n,o,u){this.expectToken(n);const d=[];for(;!this.expectOptionalToken(u);)d.push(o.call(this));return d}optionalMany(n,o,u){if(this.expectOptionalToken(n)){const d=[];do d.push(o.call(this));while(!this.expectOptionalToken(u));return d}return[]}many(n,o,u){this.expectToken(n);const d=[];do d.push(o.call(this));while(!this.expectOptionalToken(u));return d}delimitedMany(n,o){this.expectOptionalToken(n);const u=[];do u.push(o.call(this));while(this.expectOptionalToken(n));return u}advanceLexer(){const{maxTokens:n}=this._options,o=this._lexer.advance();if(n!==void 0&&o.kind!==Lt.EOF&&(++this._tokenCounter,this._tokenCounter>n))throw Mo(this._lexer.source,o.start,`Document contains more that ${n} tokens. Parsing aborted.`)}}function p0(t){const n=t.value;return v5(t.kind)+(n!=null?` "${n}"`:"")}function v5(t){return oU(t)?`"${t}"`:t}function TU(t){return`"${t.replace(CU,MU)}"`}const CU=/[\x00-\x1f\x22\x5c\x7f-\x9f]/g;function MU(t){return IU[t.charCodeAt(0)]}const IU=["\\u0000","\\u0001","\\u0002","\\u0003","\\u0004","\\u0005","\\u0006","\\u0007","\\b","\\t","\\n","\\u000B","\\f","\\r","\\u000E","\\u000F","\\u0010","\\u0011","\\u0012","\\u0013","\\u0014","\\u0015","\\u0016","\\u0017","\\u0018","\\u0019","\\u001A","\\u001B","\\u001C","\\u001D","\\u001E","\\u001F","","",'\\"',"","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\\\","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","\\u007F","\\u0080","\\u0081","\\u0082","\\u0083","\\u0084","\\u0085","\\u0086","\\u0087","\\u0088","\\u0089","\\u008A","\\u008B","\\u008C","\\u008D","\\u008E","\\u008F","\\u0090","\\u0091","\\u0092","\\u0093","\\u0094","\\u0095","\\u0096","\\u0097","\\u0098","\\u0099","\\u009A","\\u009B","\\u009C","\\u009D","\\u009E","\\u009F"],qC=Object.freeze({});function Ec(t,n,o=d5){const u=new Map;for(const H of Object.values(xr))u.set(H,AU(n,H));let d,g=Array.isArray(t),x=[t],T=-1,s=[],I=t,O,D;const N=[],j=[];do{T++;const H=T===x.length,U=H&&s.length!==0;if(H){if(O=j.length===0?void 0:N[N.length-1],I=D,D=j.pop(),U)if(g){I=I.slice();let J=0;for(const[pe,ue]of s){const Me=pe-J;ue===null?(I.splice(Me,1),J++):I[Me]=ue}}else{I=Object.defineProperties({},Object.getOwnPropertyDescriptors(I));for(const[J,pe]of s)I[J]=pe}T=d.index,x=d.keys,s=d.edits,g=d.inArray,d=d.prev}else if(D){if(O=g?T:x[T],I=D[O],I==null)continue;N.push(O)}let q;if(!Array.isArray(I)){var G,X;MD(I)||X0(!1,`Invalid AST Node: ${GC(I)}.`);const J=H?(G=u.get(I.kind))===null||G===void 0?void 0:G.leave:(X=u.get(I.kind))===null||X===void 0?void 0:X.enter;if(q=J==null?void 0:J.call(n,I,O,D,N,j),q===qC)break;if(q===!1){if(!H){N.pop();continue}}else if(q!==void 0&&(s.push([O,q]),!H))if(MD(q))I=q;else{N.pop();continue}}if(q===void 0&&U&&s.push([O,I]),H)N.pop();else{var te;d={inArray:g,index:T,keys:x,edits:s,prev:d},g=Array.isArray(I),x=g?I:(te=o[I.kind])!==null&&te!==void 0?te:[],T=-1,s=[],D&&j.push(D),D=I}}while(d!==void 0);return s.length!==0?s[s.length-1][1]:t}function AU(t,n){const o=t[n];return typeof o=="object"?o:typeof o=="function"?{enter:o,leave:void 0}:{enter:t.enter,leave:t.leave}}function kU(t){return Ec(t,OU)}const PU=80,OU={Name:{leave:t=>t.value},Variable:{leave:t=>"$"+t.name},Document:{leave:t=>br(t.definitions,`

`)},OperationDefinition:{leave(t){const n=Sn("(",br(t.variableDefinitions,", "),")"),o=br([t.operation,br([t.name,n]),br(t.directives," ")]," ");return(o==="query"?"":o+" ")+t.selectionSet}},VariableDefinition:{leave:({variable:t,type:n,defaultValue:o,directives:u})=>t+": "+n+Sn(" = ",o)+Sn(" ",br(u," "))},SelectionSet:{leave:({selections:t})=>Ya(t)},Field:{leave({alias:t,name:n,arguments:o,directives:u,selectionSet:d}){const g=Sn("",t,": ")+n;let x=g+Sn("(",br(o,", "),")");return x.length>PU&&(x=g+Sn(`(
`,Y0(br(o,`
`)),`
)`)),br([x,br(u," "),d]," ")}},Argument:{leave:({name:t,value:n})=>t+": "+n},FragmentSpread:{leave:({name:t,directives:n})=>"..."+t+Sn(" ",br(n," "))},InlineFragment:{leave:({typeCondition:t,directives:n,selectionSet:o})=>br(["...",Sn("on ",t),br(n," "),o]," ")},FragmentDefinition:{leave:({name:t,typeCondition:n,variableDefinitions:o,directives:u,selectionSet:d})=>`fragment ${t}${Sn("(",br(o,", "),")")} on ${n} ${Sn("",br(u," ")," ")}`+d},IntValue:{leave:({value:t})=>t},FloatValue:{leave:({value:t})=>t},StringValue:{leave:({value:t,block:n})=>n?nU(t):TU(t)},BooleanValue:{leave:({value:t})=>t?"true":"false"},NullValue:{leave:()=>"null"},EnumValue:{leave:({value:t})=>t},ListValue:{leave:({values:t})=>"["+br(t,", ")+"]"},ObjectValue:{leave:({fields:t})=>"{"+br(t,", ")+"}"},ObjectField:{leave:({name:t,value:n})=>t+": "+n},Directive:{leave:({name:t,arguments:n})=>"@"+t+Sn("(",br(n,", "),")")},NamedType:{leave:({name:t})=>t},ListType:{leave:({type:t})=>"["+t+"]"},NonNullType:{leave:({type:t})=>t+"!"},SchemaDefinition:{leave:({description:t,directives:n,operationTypes:o})=>Sn("",t,`
`)+br(["schema",br(n," "),Ya(o)]," ")},OperationTypeDefinition:{leave:({operation:t,type:n})=>t+": "+n},ScalarTypeDefinition:{leave:({description:t,name:n,directives:o})=>Sn("",t,`
`)+br(["scalar",n,br(o," ")]," ")},ObjectTypeDefinition:{leave:({description:t,name:n,interfaces:o,directives:u,fields:d})=>Sn("",t,`
`)+br(["type",n,Sn("implements ",br(o," & ")),br(u," "),Ya(d)]," ")},FieldDefinition:{leave:({description:t,name:n,arguments:o,type:u,directives:d})=>Sn("",t,`
`)+n+(AD(o)?Sn(`(
`,Y0(br(o,`
`)),`
)`):Sn("(",br(o,", "),")"))+": "+u+Sn(" ",br(d," "))},InputValueDefinition:{leave:({description:t,name:n,type:o,defaultValue:u,directives:d})=>Sn("",t,`
`)+br([n+": "+o,Sn("= ",u),br(d," ")]," ")},InterfaceTypeDefinition:{leave:({description:t,name:n,interfaces:o,directives:u,fields:d})=>Sn("",t,`
`)+br(["interface",n,Sn("implements ",br(o," & ")),br(u," "),Ya(d)]," ")},UnionTypeDefinition:{leave:({description:t,name:n,directives:o,types:u})=>Sn("",t,`
`)+br(["union",n,br(o," "),Sn("= ",br(u," | "))]," ")},EnumTypeDefinition:{leave:({description:t,name:n,directives:o,values:u})=>Sn("",t,`
`)+br(["enum",n,br(o," "),Ya(u)]," ")},EnumValueDefinition:{leave:({description:t,name:n,directives:o})=>Sn("",t,`
`)+br([n,br(o," ")]," ")},InputObjectTypeDefinition:{leave:({description:t,name:n,directives:o,fields:u})=>Sn("",t,`
`)+br(["input",n,br(o," "),Ya(u)]," ")},DirectiveDefinition:{leave:({description:t,name:n,arguments:o,repeatable:u,locations:d})=>Sn("",t,`
`)+"directive @"+n+(AD(o)?Sn(`(
`,Y0(br(o,`
`)),`
)`):Sn("(",br(o,", "),")"))+(u?" repeatable":"")+" on "+br(d," | ")},SchemaExtension:{leave:({directives:t,operationTypes:n})=>br(["extend schema",br(t," "),Ya(n)]," ")},ScalarTypeExtension:{leave:({name:t,directives:n})=>br(["extend scalar",t,br(n," ")]," ")},ObjectTypeExtension:{leave:({name:t,interfaces:n,directives:o,fields:u})=>br(["extend type",t,Sn("implements ",br(n," & ")),br(o," "),Ya(u)]," ")},InterfaceTypeExtension:{leave:({name:t,interfaces:n,directives:o,fields:u})=>br(["extend interface",t,Sn("implements ",br(n," & ")),br(o," "),Ya(u)]," ")},UnionTypeExtension:{leave:({name:t,directives:n,types:o})=>br(["extend union",t,br(n," "),Sn("= ",br(o," | "))]," ")},EnumTypeExtension:{leave:({name:t,directives:n,values:o})=>br(["extend enum",t,br(n," "),Ya(o)]," ")},InputObjectTypeExtension:{leave:({name:t,directives:n,fields:o})=>br(["extend input",t,br(n," "),Ya(o)]," ")}};function br(t,n=""){var o;return(o=t==null?void 0:t.filter(u=>u).join(n))!==null&&o!==void 0?o:""}function Ya(t){return Sn(`{
`,Y0(br(t,`
`)),`
}`)}function Sn(t,n,o=""){return n!=null&&n!==""?t+n+o:""}function Y0(t){return Sn("  ",t.replace(/\n/g,`
  `))}function AD(t){var n;return(n=t==null?void 0:t.some(o=>o.includes(`
`)))!==null&&n!==void 0?n:!1}function kD(t){return t.kind===xr.FIELD||t.kind===xr.FRAGMENT_SPREAD||t.kind===xr.INLINE_FRAGMENT}function Q_(t,n){var o=t.directives;return!o||!o.length?!0:LU(o).every(function(u){var d=u.directive,g=u.ifArgument,x=!1;return g.value.kind==="Variable"?(x=n&&n[g.value.name.value],kr(x!==void 0,67,d.name.value)):x=g.value.value,d.name.value==="skip"?!x:x})}function y_(t,n,o){var u=new Set(t),d=u.size;return Ec(n,{Directive:function(g){if(u.delete(g.name.value)&&(!o||!u.size))return qC}}),o?!u.size:u.size<d}function DU(t){return t&&y_(["client","export"],t,!0)}function RU(t){var n=t.name.value;return n==="skip"||n==="include"}function LU(t){var n=[];return t&&t.length&&t.forEach(function(o){if(RU(o)){var u=o.arguments,d=o.name.value;kr(u&&u.length===1,68,d);var g=u[0];kr(g.name&&g.name.value==="if",69,d);var x=g.value;kr(x&&(x.kind==="Variable"||x.kind==="BooleanValue"),70,d),n.push({directive:o,ifArgument:g})}}),n}const zU=()=>Object.create(null),{forEach:NU,slice:PD}=Array.prototype,{hasOwnProperty:FU}=Object.prototype;let wp=class x5{constructor(n=!0,o=zU){this.weakness=n,this.makeData=o}lookup(){return this.lookupArray(arguments)}lookupArray(n){let o=this;return NU.call(n,u=>o=o.getChildTrie(u)),FU.call(o,"data")?o.data:o.data=this.makeData(PD.call(n))}peek(){return this.peekArray(arguments)}peekArray(n){let o=this;for(let u=0,d=n.length;o&&u<d;++u){const g=o.mapFor(n[u],!1);o=g&&g.get(n[u])}return o&&o.data}remove(){return this.removeArray(arguments)}removeArray(n){let o;if(n.length){const u=n[0],d=this.mapFor(u,!1),g=d&&d.get(u);g&&(o=g.removeArray(PD.call(n,1)),!g.data&&!g.weak&&!(g.strong&&g.strong.size)&&d.delete(u))}else o=this.data,delete this.data;return o}getChildTrie(n){const o=this.mapFor(n,!0);let u=o.get(n);return u||o.set(n,u=new x5(this.weakness,this.makeData)),u}mapFor(n,o){return this.weakness&&BU(n)?this.weak||(o?this.weak=new WeakMap:void 0):this.strong||(o?this.strong=new Map:void 0)}};function BU(t){switch(typeof t){case"object":if(t===null)break;case"function":return!0}return!1}var fd=typeof WeakMap=="function"&&!tl(function(){return navigator.product=="ReactNative"&&!global.HermesInternal}),b5=typeof WeakSet=="function",WC=typeof Symbol=="function"&&typeof Symbol.for=="function",a1=WC&&Symbol.asyncIterator,jU=typeof tl(function(){return window.document.createElement})=="function",$U=tl(function(){return navigator.userAgent.indexOf("jsdom")>=0})||!1,UU=jU&&!$U;function Hi(t){return t!==null&&typeof t=="object"}function VU(t,n){var o=n,u=[];t.definitions.forEach(function(g){if(g.kind==="OperationDefinition")throw ys(71,g.operation,g.name?" named '".concat(g.name.value,"'"):"");g.kind==="FragmentDefinition"&&u.push(g)}),typeof o>"u"&&(kr(u.length===1,72,u.length),o=u[0].name.value);var d=ct(ct({},t),{definitions:Ia([{kind:"OperationDefinition",operation:"query",selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:o}}]}}],t.definitions,!0)});return d}function l1(t){t===void 0&&(t=[]);var n={};return t.forEach(function(o){n[o.name.value]=o}),n}function c1(t,n){switch(t.kind){case"InlineFragment":return t;case"FragmentSpread":{var o=t.name.value;if(typeof n=="function")return n(o);var u=n&&n[o];return kr(u,73,o),u||null}default:return null}}function GU(){}class YS{constructor(n=1/0,o=GU){this.max=n,this.dispose=o,this.map=new Map,this.newest=null,this.oldest=null}has(n){return this.map.has(n)}get(n){const o=this.getNode(n);return o&&o.value}get size(){return this.map.size}getNode(n){const o=this.map.get(n);if(o&&o!==this.newest){const{older:u,newer:d}=o;d&&(d.older=u),u&&(u.newer=d),o.older=this.newest,o.older.newer=o,o.newer=null,this.newest=o,o===this.oldest&&(this.oldest=d)}return o}set(n,o){let u=this.getNode(n);return u?u.value=o:(u={key:n,value:o,newer:null,older:this.newest},this.newest&&(this.newest.newer=u),this.newest=u,this.oldest=this.oldest||u,this.map.set(n,u),u.value)}clean(){for(;this.oldest&&this.map.size>this.max;)this.delete(this.oldest.key)}delete(n){const o=this.map.get(n);return o?(o===this.newest&&(this.newest=o.older),o===this.oldest&&(this.oldest=o.newer),o.newer&&(o.newer.older=o.older),o.older&&(o.older.newer=o.newer),this.map.delete(n),this.dispose(o.value,n),!0):!1}}function QS(){}const qU=QS,WU=typeof WeakRef<"u"?WeakRef:function(t){return{deref:()=>t}},HU=typeof WeakMap<"u"?WeakMap:Map,ZU=typeof FinalizationRegistry<"u"?FinalizationRegistry:function(){return{register:QS,unregister:QS}},XU=10024;class wx{constructor(n=1/0,o=qU){this.max=n,this.dispose=o,this.map=new HU,this.newest=null,this.oldest=null,this.unfinalizedNodes=new Set,this.finalizationScheduled=!1,this.size=0,this.finalize=()=>{const u=this.unfinalizedNodes.values();for(let d=0;d<XU;d++){const g=u.next().value;if(!g)break;this.unfinalizedNodes.delete(g);const x=g.key;delete g.key,g.keyRef=new WU(x),this.registry.register(x,g,g)}this.unfinalizedNodes.size>0?queueMicrotask(this.finalize):this.finalizationScheduled=!1},this.registry=new ZU(this.deleteNode.bind(this))}has(n){return this.map.has(n)}get(n){const o=this.getNode(n);return o&&o.value}getNode(n){const o=this.map.get(n);if(o&&o!==this.newest){const{older:u,newer:d}=o;d&&(d.older=u),u&&(u.newer=d),o.older=this.newest,o.older.newer=o,o.newer=null,this.newest=o,o===this.oldest&&(this.oldest=d)}return o}set(n,o){let u=this.getNode(n);return u?u.value=o:(u={key:n,value:o,newer:null,older:this.newest},this.newest&&(this.newest.newer=u),this.newest=u,this.oldest=this.oldest||u,this.scheduleFinalization(u),this.map.set(n,u),this.size++,u.value)}clean(){for(;this.oldest&&this.size>this.max;)this.deleteNode(this.oldest)}deleteNode(n){n===this.newest&&(this.newest=n.older),n===this.oldest&&(this.oldest=n.newer),n.newer&&(n.newer.older=n.older),n.older&&(n.older.newer=n.newer),this.size--;const o=n.key||n.keyRef&&n.keyRef.deref();this.dispose(n.value,o),n.keyRef?this.registry.unregister(n):this.unfinalizedNodes.delete(n),o&&this.map.delete(o)}delete(n){const o=this.map.get(n);return o?(this.deleteNode(o),!0):!1}scheduleFinalization(n){this.unfinalizedNodes.add(n),this.finalizationScheduled||(this.finalizationScheduled=!0,queueMicrotask(this.finalize))}}var lE=new WeakSet;function w5(t){lE.has(t)||(lE.add(t),setTimeout(function(){t.clean(),lE.delete(t)},100))}var HC=function(t,n){var o=new wx(t,n);return o.set=function(u,d){return w5(this),wx.prototype.set.call(this,u,d)},o},YU=function(t,n){var o=new YS(t,n);return o.set=function(u,d){return w5(this),YS.prototype.set.call(this,u,d)},o},QU=Symbol.for("apollo.cacheSize"),Fl=ct({},qS[QU]),Uh={};function ZC(t,n){Uh[t]=n}var KU=globalThis.__DEV__!==!1?rV:void 0,JU=globalThis.__DEV__!==!1?nV:void 0,eV=globalThis.__DEV__!==!1?E5:void 0;function tV(){var t={parser:1e3,canonicalStringify:1e3,print:2e3,"documentTransform.cache":2e3,"queryManager.getDocumentInfo":2e3,"PersistedQueryLink.persistedQueryHashes":2e3,"fragmentRegistry.transform":2e3,"fragmentRegistry.lookup":1e3,"fragmentRegistry.findFragmentSpreads":4e3,"cache.fragmentQueryDocuments":1e3,"removeTypenameFromVariables.getVariableDefinitions":2e3,"inMemoryCache.maybeBroadcastWatch":5e3,"inMemoryCache.executeSelectionSet":5e4,"inMemoryCache.executeSubSelectedArray":1e4};return Object.fromEntries(Object.entries(t).map(function(n){var o=n[0],u=n[1];return[o,Fl[o]||u]}))}function rV(){var t,n,o,u,d;if(globalThis.__DEV__===!1)throw new Error("only supported in development mode");return{limits:tV(),sizes:ct({print:(t=Uh.print)===null||t===void 0?void 0:t.call(Uh),parser:(n=Uh.parser)===null||n===void 0?void 0:n.call(Uh),canonicalStringify:(o=Uh.canonicalStringify)===null||o===void 0?void 0:o.call(Uh),links:JS(this.link),queryManager:{getDocumentInfo:this.queryManager.transformCache.size,documentTransforms:T5(this.queryManager.documentTransform)}},(d=(u=this.cache).getMemoryInternals)===null||d===void 0?void 0:d.call(u))}}function E5(){return{cache:{fragmentQueryDocuments:xu(this.getFragmentDoc)}}}function nV(){var t=this.config.fragments;return ct(ct({},E5.apply(this)),{addTypenameDocumentTransform:T5(this.addTypenameTransform),inMemoryCache:{executeSelectionSet:xu(this.storeReader.executeSelectionSet),executeSubSelectedArray:xu(this.storeReader.executeSubSelectedArray),maybeBroadcastWatch:xu(this.maybeBroadcastWatch)},fragmentRegistry:{findFragmentSpreads:xu(t==null?void 0:t.findFragmentSpreads),lookup:xu(t==null?void 0:t.lookup),transform:xu(t==null?void 0:t.transform)}})}function iV(t){return!!t&&"dirtyKey"in t}function xu(t){return iV(t)?t.size:void 0}function S5(t){return t!=null}function T5(t){return KS(t).map(function(n){return{cache:n}})}function KS(t){return t?Ia(Ia([xu(t==null?void 0:t.performWork)],KS(t==null?void 0:t.left),!0),KS(t==null?void 0:t.right),!0).filter(S5):[]}function JS(t){var n;return t?Ia(Ia([(n=t==null?void 0:t.getMemoryInternals)===null||n===void 0?void 0:n.call(t)],JS(t==null?void 0:t.left),!0),JS(t==null?void 0:t.right),!0).filter(S5):[]}var Au=Object.assign(function(n){return JSON.stringify(n,oV)},{reset:function(){Pf=new YU(Fl.canonicalStringify||1e3)}});globalThis.__DEV__!==!1&&ZC("canonicalStringify",function(){return Pf.size});var Pf;Au.reset();function oV(t,n){if(n&&typeof n=="object"){var o=Object.getPrototypeOf(n);if(o===Object.prototype||o===null){var u=Object.keys(n);if(u.every(sV))return n;var d=JSON.stringify(u),g=Pf.get(d);if(!g){u.sort();var x=JSON.stringify(u);g=Pf.get(x)||u,Pf.set(d,g),Pf.set(x,g)}var T=Object.create(o);return g.forEach(function(s){T[s]=n[s]}),T}}return n}function sV(t,n,o){return n===0||o[n-1]<=t}function Zf(t){return{__ref:String(t)}}function Jn(t){return!!(t&&typeof t=="object"&&typeof t.__ref=="string")}function aV(t){return Hi(t)&&t.kind==="Document"&&Array.isArray(t.definitions)}function lV(t){return t.kind==="StringValue"}function cV(t){return t.kind==="BooleanValue"}function uV(t){return t.kind==="IntValue"}function hV(t){return t.kind==="FloatValue"}function dV(t){return t.kind==="Variable"}function fV(t){return t.kind==="ObjectValue"}function pV(t){return t.kind==="ListValue"}function mV(t){return t.kind==="EnumValue"}function gV(t){return t.kind==="NullValue"}function op(t,n,o,u){if(uV(o)||hV(o))t[n.value]=Number(o.value);else if(cV(o)||lV(o))t[n.value]=o.value;else if(fV(o)){var d={};o.fields.map(function(x){return op(d,x.name,x.value,u)}),t[n.value]=d}else if(dV(o)){var g=(u||{})[o.name.value];t[n.value]=g}else if(pV(o))t[n.value]=o.values.map(function(x){var T={};return op(T,n,x,u),T[n.value]});else if(mV(o))t[n.value]=o.value;else if(gV(o))t[n.value]=null;else throw ys(82,n.value,o.kind)}function _V(t,n){var o=null;t.directives&&(o={},t.directives.forEach(function(d){o[d.name.value]={},d.arguments&&d.arguments.forEach(function(g){var x=g.name,T=g.value;return op(o[d.name.value],x,T,n)})}));var u=null;return t.arguments&&t.arguments.length&&(u={},t.arguments.forEach(function(d){var g=d.name,x=d.value;return op(u,g,x,n)})),C5(t.name.value,u,o)}var yV=["connection","include","skip","client","rest","export","nonreactive"],tg=Au,C5=Object.assign(function(t,n,o){if(n&&o&&o.connection&&o.connection.key)if(o.connection.filter&&o.connection.filter.length>0){var u=o.connection.filter?o.connection.filter:[];u.sort();var d={};return u.forEach(function(T){d[T]=n[T]}),"".concat(o.connection.key,"(").concat(tg(d),")")}else return o.connection.key;var g=t;if(n){var x=tg(n);g+="(".concat(x,")")}return o&&Object.keys(o).forEach(function(T){yV.indexOf(T)===-1&&(o[T]&&Object.keys(o[T]).length?g+="@".concat(T,"(").concat(tg(o[T]),")"):g+="@".concat(T))}),g},{setStringify:function(t){var n=tg;return tg=t,n}});function u1(t,n){if(t.arguments&&t.arguments.length){var o={};return t.arguments.forEach(function(u){var d=u.name,g=u.value;return op(o,d,g,n)}),o}return null}function Fu(t){return t.alias?t.alias.value:t.name.value}function eT(t,n,o){for(var u,d=0,g=n.selections;d<g.length;d++){var x=g[d];if(Bu(x)){if(x.name.value==="__typename")return t[Fu(x)]}else u?u.push(x):u=[x]}if(typeof t.__typename=="string")return t.__typename;if(u)for(var T=0,s=u;T<s.length;T++){var x=s[T],I=eT(t,c1(x,o).selectionSet,o);if(typeof I=="string")return I}}function Bu(t){return t.kind==="Field"}function vV(t){return t.kind==="InlineFragment"}function K_(t){kr(t&&t.kind==="Document",74);var n=t.definitions.filter(function(o){return o.kind!=="FragmentDefinition"}).map(function(o){if(o.kind!=="OperationDefinition")throw ys(75,o.kind);return o});return kr(n.length<=1,76,n.length),t}function J_(t){return K_(t),t.definitions.filter(function(n){return n.kind==="OperationDefinition"})[0]}function tT(t){return t.definitions.filter(function(n){return n.kind==="OperationDefinition"&&!!n.name}).map(function(n){return n.name.value})[0]||null}function h1(t){return t.definitions.filter(function(n){return n.kind==="FragmentDefinition"})}function M5(t){var n=J_(t);return kr(n&&n.operation==="query",77),n}function xV(t){kr(t.kind==="Document",78),kr(t.definitions.length<=1,79);var n=t.definitions[0];return kr(n.kind==="FragmentDefinition",80),n}function ey(t){K_(t);for(var n,o=0,u=t.definitions;o<u.length;o++){var d=u[o];if(d.kind==="OperationDefinition"){var g=d.operation;if(g==="query"||g==="mutation"||g==="subscription")return d}d.kind==="FragmentDefinition"&&!n&&(n=d)}if(n)return n;throw ys(81)}function XC(t){var n=Object.create(null),o=t&&t.variableDefinitions;return o&&o.length&&o.forEach(function(u){u.defaultValue&&op(n,u.variable.name,u.defaultValue)}),n}const bV=()=>Object.create(null),{forEach:wV,slice:EV}=Array.prototype,{hasOwnProperty:SV}=Object.prototype;class YC{constructor(n=!0,o=bV){this.weakness=n,this.makeData=o}lookup(...n){return this.lookupArray(n)}lookupArray(n){let o=this;return wV.call(n,u=>o=o.getChildTrie(u)),SV.call(o,"data")?o.data:o.data=this.makeData(EV.call(n))}peek(...n){return this.peekArray(n)}peekArray(n){let o=this;for(let u=0,d=n.length;o&&u<d;++u){const g=this.weakness&&OD(n[u])?o.weak:o.strong;o=g&&g.get(n[u])}return o&&o.data}getChildTrie(n){const o=this.weakness&&OD(n)?this.weak||(this.weak=new WeakMap):this.strong||(this.strong=new Map);let u=o.get(n);return u||o.set(n,u=new YC(this.weakness,this.makeData)),u}}function OD(t){switch(typeof t){case"object":if(t===null)break;case"function":return!0}return!1}let Bo=null;const DD={};let TV=1;const CV=()=>class{constructor(){this.id=["slot",TV++,Date.now(),Math.random().toString(36).slice(2)].join(":")}hasValue(){for(let n=Bo;n;n=n.parent)if(this.id in n.slots){const o=n.slots[this.id];if(o===DD)break;return n!==Bo&&(Bo.slots[this.id]=o),!0}return Bo&&(Bo.slots[this.id]=DD),!1}getValue(){if(this.hasValue())return Bo.slots[this.id]}withValue(n,o,u,d){const g={__proto__:null,[this.id]:n},x=Bo;Bo={parent:x,slots:g};try{return o.apply(d,u)}finally{Bo=x}}static bind(n){const o=Bo;return function(){const u=Bo;try{return Bo=o,n.apply(this,arguments)}finally{Bo=u}}}static noContext(n,o,u){if(Bo){const d=Bo;try{return Bo=null,n.apply(u,o)}finally{Bo=d}}else return n.apply(u,o)}};function RD(t){try{return t()}catch{}}const cE="@wry/context:Slot",MV=RD(()=>globalThis)||RD(()=>global)||Object.create(null),LD=MV,I5=LD[cE]||Array[cE]||function(t){try{Object.defineProperty(LD,cE,{value:t,enumerable:!1,writable:!1,configurable:!0})}finally{return t}}(CV()),d1=new I5,{hasOwnProperty:IV}=Object.prototype,QC=Array.from||function(t){const n=[];return t.forEach(o=>n.push(o)),n};function Ex(t){const{unsubscribe:n}=t;typeof n=="function"&&(t.unsubscribe=void 0,n())}const v_=[],AV=100;function sp(t,n){if(!t)throw new Error(n||"assertion failure")}function A5(t,n){const o=t.length;return o>0&&o===n.length&&t[o-1]===n[o-1]}function k5(t){switch(t.length){case 0:throw new Error("unknown value");case 1:return t[0];case 2:throw t[1]}}function P5(t){return t.slice(0)}class f1{constructor(n){this.fn=n,this.parents=new Set,this.childValues=new Map,this.dirtyChildren=null,this.dirty=!0,this.recomputing=!1,this.value=[],this.deps=null,++f1.count}peek(){if(this.value.length===1&&!ju(this))return zD(this),this.value[0]}recompute(n){return sp(!this.recomputing,"already recomputing"),zD(this),ju(this)?kV(this,n):k5(this.value)}setDirty(){this.dirty||(this.dirty=!0,O5(this),Ex(this))}dispose(){this.setDirty(),N5(this),KC(this,(n,o)=>{n.setDirty(),F5(n,this)})}forget(){this.dispose()}dependOn(n){n.add(this),this.deps||(this.deps=v_.pop()||new Set),this.deps.add(n)}forgetDeps(){this.deps&&(QC(this.deps).forEach(n=>n.delete(this)),this.deps.clear(),v_.push(this.deps),this.deps=null)}}f1.count=0;function zD(t){const n=d1.getValue();if(n)return t.parents.add(n),n.childValues.has(t)||n.childValues.set(t,[]),ju(t)?R5(n,t):L5(n,t),n}function kV(t,n){return N5(t),d1.withValue(t,PV,[t,n]),DV(t,n)&&OV(t),k5(t.value)}function PV(t,n){t.recomputing=!0;const{normalizeResult:o}=t;let u;o&&t.value.length===1&&(u=P5(t.value)),t.value.length=0;try{if(t.value[0]=t.fn.apply(null,n),o&&u&&!A5(u,t.value))try{t.value[0]=o(t.value[0],u[0])}catch{}}catch(d){t.value[1]=d}t.recomputing=!1}function ju(t){return t.dirty||!!(t.dirtyChildren&&t.dirtyChildren.size)}function OV(t){t.dirty=!1,!ju(t)&&D5(t)}function O5(t){KC(t,R5)}function D5(t){KC(t,L5)}function KC(t,n){const o=t.parents.size;if(o){const u=QC(t.parents);for(let d=0;d<o;++d)n(u[d],t)}}function R5(t,n){sp(t.childValues.has(n)),sp(ju(n));const o=!ju(t);if(!t.dirtyChildren)t.dirtyChildren=v_.pop()||new Set;else if(t.dirtyChildren.has(n))return;t.dirtyChildren.add(n),o&&O5(t)}function L5(t,n){sp(t.childValues.has(n)),sp(!ju(n));const o=t.childValues.get(n);o.length===0?t.childValues.set(n,P5(n.value)):A5(o,n.value)||t.setDirty(),z5(t,n),!ju(t)&&D5(t)}function z5(t,n){const o=t.dirtyChildren;o&&(o.delete(n),o.size===0&&(v_.length<AV&&v_.push(o),t.dirtyChildren=null))}function N5(t){t.childValues.size>0&&t.childValues.forEach((n,o)=>{F5(t,o)}),t.forgetDeps(),sp(t.dirtyChildren===null)}function F5(t,n){n.parents.delete(t),t.childValues.delete(n),z5(t,n)}function DV(t,n){if(typeof t.subscribe=="function")try{Ex(t),t.unsubscribe=t.subscribe.apply(null,n)}catch{return t.setDirty(),!1}return!0}const RV={setDirty:!0,dispose:!0,forget:!0};function B5(t){const n=new Map,o=t&&t.subscribe;function u(d){const g=d1.getValue();if(g){let x=n.get(d);x||n.set(d,x=new Set),g.dependOn(x),typeof o=="function"&&(Ex(x),x.unsubscribe=o(d))}}return u.dirty=function(g,x){const T=n.get(g);if(T){const s=x&&IV.call(RV,x)?x:"setDirty";QC(T).forEach(I=>I[s]()),n.delete(g),Ex(T)}},u}let ND;function LV(...t){return(ND||(ND=new YC(typeof WeakMap=="function"))).lookupArray(t)}const uE=new Set;function x_(t,{max:n=Math.pow(2,16),keyArgs:o,makeCacheKey:u=LV,normalizeResult:d,subscribe:g,cache:x=YS}=Object.create(null)){const T=typeof x=="function"?new x(n,N=>N.dispose()):x,s=function(){const N=u.apply(null,o?o.apply(null,arguments):arguments);if(N===void 0)return t.apply(null,arguments);let j=T.get(N);j||(T.set(N,j=new f1(t)),j.normalizeResult=d,j.subscribe=g,j.forget=()=>T.delete(N));const G=j.recompute(Array.prototype.slice.call(arguments));return T.set(N,j),uE.add(T),d1.hasValue()||(uE.forEach(X=>X.clean()),uE.clear()),G};Object.defineProperty(s,"size",{get:()=>T.size,configurable:!1,enumerable:!1}),Object.freeze(s.options={max:n,keyArgs:o,makeCacheKey:u,normalizeResult:d,subscribe:g,cache:T});function I(N){const j=N&&T.get(N);j&&j.setDirty()}s.dirtyKey=I,s.dirty=function(){I(u.apply(null,arguments))};function O(N){const j=N&&T.get(N);if(j)return j.peek()}s.peekKey=O,s.peek=function(){return O(u.apply(null,arguments))};function D(N){return N?T.delete(N):!1}return s.forgetKey=D,s.forget=function(){return D(u.apply(null,arguments))},s.makeCacheKey=u,s.getKey=o?function(){return u.apply(null,o.apply(null,arguments))}:u,Object.freeze(s)}function zV(t){return t}var j5=function(){function t(n,o){o===void 0&&(o=Object.create(null)),this.resultCache=b5?new WeakSet:new Set,this.transform=n,o.getCacheKey&&(this.getCacheKey=o.getCacheKey),this.cached=o.cache!==!1,this.resetCache()}return t.prototype.getCacheKey=function(n){return[n]},t.identity=function(){return new t(zV,{cache:!1})},t.split=function(n,o,u){return u===void 0&&(u=t.identity()),Object.assign(new t(function(d){var g=n(d)?o:u;return g.transformDocument(d)},{cache:!1}),{left:o,right:u})},t.prototype.resetCache=function(){var n=this;if(this.cached){var o=new wp(fd);this.performWork=x_(t.prototype.performWork.bind(this),{makeCacheKey:function(u){var d=n.getCacheKey(u);if(d)return kr(Array.isArray(d),66),o.lookupArray(d)},max:Fl["documentTransform.cache"],cache:wx})}},t.prototype.performWork=function(n){return K_(n),this.transform(n)},t.prototype.transformDocument=function(n){if(this.resultCache.has(n))return n;var o=this.performWork(n);return this.resultCache.add(o),o},t.prototype.concat=function(n){var o=this;return Object.assign(new t(function(u){return n.transformDocument(o.transformDocument(u))},{cache:!1}),{left:this,right:n})},t}(),r_,p1=Object.assign(function(t){var n=r_.get(t);return n||(n=kU(t),r_.set(t,n)),n},{reset:function(){r_=new HC(Fl.print||2e3)}});p1.reset();globalThis.__DEV__!==!1&&ZC("print",function(){return r_?r_.size:0});var Zi=Array.isArray;function Pa(t){return Array.isArray(t)&&t.length>0}var FD={kind:xr.FIELD,name:{kind:xr.NAME,value:"__typename"}};function $5(t,n){return!t||t.selectionSet.selections.every(function(o){return o.kind===xr.FRAGMENT_SPREAD&&$5(n[o.name.value],n)})}function NV(t){return $5(J_(t)||xV(t),l1(h1(t)))?null:t}function FV(t){var n=new Map,o=new Map;return t.forEach(function(u){u&&(u.name?n.set(u.name,u):u.test&&o.set(u.test,u))}),function(u){var d=n.get(u.name.value);return!d&&o.size&&o.forEach(function(g,x){x(u)&&(d=g)}),d}}function BD(t){var n=new Map;return function(u){u===void 0&&(u=t);var d=n.get(u);return d||n.set(u,d={variables:new Set,fragmentSpreads:new Set}),d}}function U5(t,n){K_(n);for(var o=BD(""),u=BD(""),d=function(H){for(var U=0,q=void 0;U<H.length&&(q=H[U]);++U)if(!Zi(q)){if(q.kind===xr.OPERATION_DEFINITION)return o(q.name&&q.name.value);if(q.kind===xr.FRAGMENT_DEFINITION)return u(q.name.value)}return globalThis.__DEV__!==!1&&kr.error(83),null},g=0,x=n.definitions.length-1;x>=0;--x)n.definitions[x].kind===xr.OPERATION_DEFINITION&&++g;var T=FV(t),s=function(H){return Pa(H)&&H.map(T).some(function(U){return U&&U.remove})},I=new Map,O=!1,D={enter:function(H){if(s(H.directives))return O=!0,null}},N=Ec(n,{Field:D,InlineFragment:D,VariableDefinition:{enter:function(){return!1}},Variable:{enter:function(H,U,q,J,pe){var ue=d(pe);ue&&ue.variables.add(H.name.value)}},FragmentSpread:{enter:function(H,U,q,J,pe){if(s(H.directives))return O=!0,null;var ue=d(pe);ue&&ue.fragmentSpreads.add(H.name.value)}},FragmentDefinition:{enter:function(H,U,q,J){I.set(JSON.stringify(J),H)},leave:function(H,U,q,J){var pe=I.get(JSON.stringify(J));if(H===pe)return H;if(g>0&&H.selectionSet.selections.every(function(ue){return ue.kind===xr.FIELD&&ue.name.value==="__typename"}))return u(H.name.value).removed=!0,O=!0,null}},Directive:{leave:function(H){if(T(H))return O=!0,null}}});if(!O)return n;var j=function(H){return H.transitiveVars||(H.transitiveVars=new Set(H.variables),H.removed||H.fragmentSpreads.forEach(function(U){j(u(U)).transitiveVars.forEach(function(q){H.transitiveVars.add(q)})})),H},G=new Set;N.definitions.forEach(function(H){H.kind===xr.OPERATION_DEFINITION?j(o(H.name&&H.name.value)).fragmentSpreads.forEach(function(U){G.add(U)}):H.kind===xr.FRAGMENT_DEFINITION&&g===0&&!u(H.name.value).removed&&G.add(H.name.value)}),G.forEach(function(H){j(u(H)).fragmentSpreads.forEach(function(U){G.add(U)})});var X=function(H){return!!(!G.has(H)||u(H).removed)},te={enter:function(H){if(X(H.name.value))return null}};return NV(Ec(N,{FragmentSpread:te,FragmentDefinition:te,OperationDefinition:{leave:function(H){if(H.variableDefinitions){var U=j(o(H.name&&H.name.value)).transitiveVars;if(U.size<H.variableDefinitions.length)return ct(ct({},H),{variableDefinitions:H.variableDefinitions.filter(function(q){return U.has(q.variable.name.value)})})}}}}))}var JC=Object.assign(function(t){return Ec(t,{SelectionSet:{enter:function(n,o,u){if(!(u&&u.kind===xr.OPERATION_DEFINITION)){var d=n.selections;if(d){var g=d.some(function(T){return Bu(T)&&(T.name.value==="__typename"||T.name.value.lastIndexOf("__",0)===0)});if(!g){var x=u;if(!(Bu(x)&&x.directives&&x.directives.some(function(T){return T.name.value==="export"})))return ct(ct({},n),{selections:Ia(Ia([],d,!0),[FD],!1)})}}}}}})},{added:function(t){return t===FD}});function BV(t){var n=ey(t),o=n.operation;if(o==="query")return t;var u=Ec(t,{OperationDefinition:{enter:function(d){return ct(ct({},d),{operation:"query"})}}});return u}function V5(t){K_(t);var n=U5([{test:function(o){return o.name.value==="client"},remove:!0}],t);return n}var jV=Object.prototype.hasOwnProperty;function jD(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return eM(t)}function eM(t){var n=t[0]||{},o=t.length;if(o>1)for(var u=new $u,d=1;d<o;++d)n=u.merge(n,t[d]);return n}var $V=function(t,n,o){return this.merge(t[o],n[o])},$u=function(){function t(n){n===void 0&&(n=$V),this.reconciler=n,this.isObject=Hi,this.pastCopies=new Set}return t.prototype.merge=function(n,o){for(var u=this,d=[],g=2;g<arguments.length;g++)d[g-2]=arguments[g];return Hi(o)&&Hi(n)?(Object.keys(o).forEach(function(x){if(jV.call(n,x)){var T=n[x];if(o[x]!==T){var s=u.reconciler.apply(u,Ia([n,o,x],d,!1));s!==T&&(n=u.shallowCopyForMerge(n),n[x]=s)}}else n=u.shallowCopyForMerge(n),n[x]=o[x]}),n):o},t.prototype.shallowCopyForMerge=function(n){return Hi(n)&&(this.pastCopies.has(n)||(Array.isArray(n)?n=n.slice(0):n=ct({__proto__:Object.getPrototypeOf(n)},n),this.pastCopies.add(n))),n},t}();function UV(t,n){var o=typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(o)return(o=o.call(t)).next.bind(o);if(Array.isArray(t)||(o=VV(t))||n&&t&&typeof t.length=="number"){o&&(t=o);var u=0;return function(){return u>=t.length?{done:!0}:{done:!1,value:t[u++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function VV(t,n){if(t){if(typeof t=="string")return $D(t,n);var o=Object.prototype.toString.call(t).slice(8,-1);if(o==="Object"&&t.constructor&&(o=t.constructor.name),o==="Map"||o==="Set")return Array.from(t);if(o==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o))return $D(t,n)}}function $D(t,n){(n==null||n>t.length)&&(n=t.length);for(var o=0,u=new Array(n);o<n;o++)u[o]=t[o];return u}function UD(t,n){for(var o=0;o<n.length;o++){var u=n[o];u.enumerable=u.enumerable||!1,u.configurable=!0,"value"in u&&(u.writable=!0),Object.defineProperty(t,u.key,u)}}function tM(t,n,o){return n&&UD(t.prototype,n),o&&UD(t,o),Object.defineProperty(t,"prototype",{writable:!1}),t}var rM=function(){return typeof Symbol=="function"},nM=function(t){return rM()&&!!Symbol[t]},iM=function(t){return nM(t)?Symbol[t]:"@@"+t};rM()&&!nM("observable")&&(Symbol.observable=Symbol("observable"));var GV=iM("iterator"),rT=iM("observable"),G5=iM("species");function Sx(t,n){var o=t[n];if(o!=null){if(typeof o!="function")throw new TypeError(o+" is not a function");return o}}function rg(t){var n=t.constructor;return n!==void 0&&(n=n[G5],n===null&&(n=void 0)),n!==void 0?n:Ti}function qV(t){return t instanceof Ti}function ap(t){ap.log?ap.log(t):setTimeout(function(){throw t})}function Q0(t){Promise.resolve().then(function(){try{t()}catch(n){ap(n)}})}function q5(t){var n=t._cleanup;if(n!==void 0&&(t._cleanup=void 0,!!n))try{if(typeof n=="function")n();else{var o=Sx(n,"unsubscribe");o&&o.call(n)}}catch(u){ap(u)}}function nT(t){t._observer=void 0,t._queue=void 0,t._state="closed"}function WV(t){var n=t._queue;if(n){t._queue=void 0,t._state="ready";for(var o=0;o<n.length&&(W5(t,n[o].type,n[o].value),t._state!=="closed");++o);}}function W5(t,n,o){t._state="running";var u=t._observer;try{var d=Sx(u,n);switch(n){case"next":d&&d.call(u,o);break;case"error":if(nT(t),d)d.call(u,o);else throw o;break;case"complete":nT(t),d&&d.call(u);break}}catch(g){ap(g)}t._state==="closed"?q5(t):t._state==="running"&&(t._state="ready")}function hE(t,n,o){if(t._state!=="closed"){if(t._state==="buffering"){t._queue.push({type:n,value:o});return}if(t._state!=="ready"){t._state="buffering",t._queue=[{type:n,value:o}],Q0(function(){return WV(t)});return}W5(t,n,o)}}var HV=function(){function t(o,u){this._cleanup=void 0,this._observer=o,this._queue=void 0,this._state="initializing";var d=new ZV(this);try{this._cleanup=u.call(void 0,d)}catch(g){d.error(g)}this._state==="initializing"&&(this._state="ready")}var n=t.prototype;return n.unsubscribe=function(){this._state!=="closed"&&(nT(this),q5(this))},tM(t,[{key:"closed",get:function(){return this._state==="closed"}}]),t}(),ZV=function(){function t(o){this._subscription=o}var n=t.prototype;return n.next=function(u){hE(this._subscription,"next",u)},n.error=function(u){hE(this._subscription,"error",u)},n.complete=function(){hE(this._subscription,"complete")},tM(t,[{key:"closed",get:function(){return this._subscription._state==="closed"}}]),t}(),Ti=function(){function t(o){if(!(this instanceof t))throw new TypeError("Observable cannot be called as a function");if(typeof o!="function")throw new TypeError("Observable initializer must be a function");this._subscriber=o}var n=t.prototype;return n.subscribe=function(u){return(typeof u!="object"||u===null)&&(u={next:u,error:arguments[1],complete:arguments[2]}),new HV(u,this._subscriber)},n.forEach=function(u){var d=this;return new Promise(function(g,x){if(typeof u!="function"){x(new TypeError(u+" is not a function"));return}function T(){s.unsubscribe(),g()}var s=d.subscribe({next:function(I){try{u(I,T)}catch(O){x(O),s.unsubscribe()}},error:x,complete:g})})},n.map=function(u){var d=this;if(typeof u!="function")throw new TypeError(u+" is not a function");var g=rg(this);return new g(function(x){return d.subscribe({next:function(T){try{T=u(T)}catch(s){return x.error(s)}x.next(T)},error:function(T){x.error(T)},complete:function(){x.complete()}})})},n.filter=function(u){var d=this;if(typeof u!="function")throw new TypeError(u+" is not a function");var g=rg(this);return new g(function(x){return d.subscribe({next:function(T){try{if(!u(T))return}catch(s){return x.error(s)}x.next(T)},error:function(T){x.error(T)},complete:function(){x.complete()}})})},n.reduce=function(u){var d=this;if(typeof u!="function")throw new TypeError(u+" is not a function");var g=rg(this),x=arguments.length>1,T=!1,s=arguments[1],I=s;return new g(function(O){return d.subscribe({next:function(D){var N=!T;if(T=!0,!N||x)try{I=u(I,D)}catch(j){return O.error(j)}else I=D},error:function(D){O.error(D)},complete:function(){if(!T&&!x)return O.error(new TypeError("Cannot reduce an empty sequence"));O.next(I),O.complete()}})})},n.concat=function(){for(var u=this,d=arguments.length,g=new Array(d),x=0;x<d;x++)g[x]=arguments[x];var T=rg(this);return new T(function(s){var I,O=0;function D(N){I=N.subscribe({next:function(j){s.next(j)},error:function(j){s.error(j)},complete:function(){O===g.length?(I=void 0,s.complete()):D(T.from(g[O++]))}})}return D(u),function(){I&&(I.unsubscribe(),I=void 0)}})},n.flatMap=function(u){var d=this;if(typeof u!="function")throw new TypeError(u+" is not a function");var g=rg(this);return new g(function(x){var T=[],s=d.subscribe({next:function(O){if(u)try{O=u(O)}catch(N){return x.error(N)}var D=g.from(O).subscribe({next:function(N){x.next(N)},error:function(N){x.error(N)},complete:function(){var N=T.indexOf(D);N>=0&&T.splice(N,1),I()}});T.push(D)},error:function(O){x.error(O)},complete:function(){I()}});function I(){s.closed&&T.length===0&&x.complete()}return function(){T.forEach(function(O){return O.unsubscribe()}),s.unsubscribe()}})},n[rT]=function(){return this},t.from=function(u){var d=typeof this=="function"?this:t;if(u==null)throw new TypeError(u+" is not an object");var g=Sx(u,rT);if(g){var x=g.call(u);if(Object(x)!==x)throw new TypeError(x+" is not an object");return qV(x)&&x.constructor===d?x:new d(function(T){return x.subscribe(T)})}if(nM("iterator")&&(g=Sx(u,GV),g))return new d(function(T){Q0(function(){if(!T.closed){for(var s=UV(g.call(u)),I;!(I=s()).done;){var O=I.value;if(T.next(O),T.closed)return}T.complete()}})});if(Array.isArray(u))return new d(function(T){Q0(function(){if(!T.closed){for(var s=0;s<u.length;++s)if(T.next(u[s]),T.closed)return;T.complete()}})});throw new TypeError(u+" is not observable")},t.of=function(){for(var u=arguments.length,d=new Array(u),g=0;g<u;g++)d[g]=arguments[g];var x=typeof this=="function"?this:t;return new x(function(T){Q0(function(){if(!T.closed){for(var s=0;s<d.length;++s)if(T.next(d[s]),T.closed)return;T.complete()}})})},tM(t,null,[{key:G5,get:function(){return this}}]),t}();rM()&&Object.defineProperty(Ti,Symbol("extensions"),{value:{symbol:rT,hostReportError:ap},configurable:!0});function XV(t){var n,o=t.Symbol;if(typeof o=="function")if(o.observable)n=o.observable;else{typeof o.for=="function"?n=o.for("https://github.com/benlesh/symbol-observable"):n=o("https://github.com/benlesh/symbol-observable");try{o.observable=n}catch{}}else n="@@observable";return n}var If;typeof self<"u"?If=self:typeof window<"u"?If=window:typeof global<"u"?If=global:typeof DC<"u"?If=DC:If=Function("return this")();XV(If);var VD=Ti.prototype,GD="@@observable";VD[GD]||(VD[GD]=function(){return this});var YV=Object.prototype.toString;function H5(t){return iT(t)}function iT(t,n){switch(YV.call(t)){case"[object Array]":{if(n=n||new Map,n.has(t))return n.get(t);var o=t.slice(0);return n.set(t,o),o.forEach(function(d,g){o[g]=iT(d,n)}),o}case"[object Object]":{if(n=n||new Map,n.has(t))return n.get(t);var u=Object.create(Object.getPrototypeOf(t));return n.set(t,u),Object.keys(t).forEach(function(d){u[d]=iT(t[d],n)}),u}default:return t}}function QV(t){var n=new Set([t]);return n.forEach(function(o){Hi(o)&&KV(o)===o&&Object.getOwnPropertyNames(o).forEach(function(u){Hi(o[u])&&n.add(o[u])})}),t}function KV(t){if(globalThis.__DEV__!==!1&&!Object.isFrozen(t))try{Object.freeze(t)}catch(n){if(n instanceof TypeError)return null;throw n}return t}function b_(t){return globalThis.__DEV__!==!1&&QV(t),t}function n_(t,n,o){var u=[];t.forEach(function(d){return d[n]&&u.push(d)}),u.forEach(function(d){return d[n](o)})}function dE(t,n,o){return new Ti(function(u){var d={then:function(s){return new Promise(function(I){return I(s())})}};function g(s,I){return function(O){if(s){var D=function(){return u.closed?0:s(O)};d=d.then(D,D).then(function(N){return u.next(N)},function(N){return u.error(N)})}else u[I](O)}}var x={next:g(n,"next"),error:g(o,"error"),complete:function(){d.then(function(){return u.complete()})}},T=t.subscribe(x);return function(){return T.unsubscribe()}})}function Z5(t){function n(o){Object.defineProperty(t,o,{value:Ti})}return WC&&Symbol.species&&n(Symbol.species),n("@@species"),t}function qD(t){return t&&typeof t.then=="function"}var Af=function(t){jl(n,t);function n(o){var u=t.call(this,function(d){return u.addObserver(d),function(){return u.removeObserver(d)}})||this;return u.observers=new Set,u.promise=new Promise(function(d,g){u.resolve=d,u.reject=g}),u.handlers={next:function(d){u.sub!==null&&(u.latest=["next",d],u.notify("next",d),n_(u.observers,"next",d))},error:function(d){var g=u.sub;g!==null&&(g&&setTimeout(function(){return g.unsubscribe()}),u.sub=null,u.latest=["error",d],u.reject(d),u.notify("error",d),n_(u.observers,"error",d))},complete:function(){var d=u,g=d.sub,x=d.sources,T=x===void 0?[]:x;if(g!==null){var s=T.shift();s?qD(s)?s.then(function(I){return u.sub=I.subscribe(u.handlers)},u.handlers.error):u.sub=s.subscribe(u.handlers):(g&&setTimeout(function(){return g.unsubscribe()}),u.sub=null,u.latest&&u.latest[0]==="next"?u.resolve(u.latest[1]):u.resolve(),u.notify("complete"),n_(u.observers,"complete"))}}},u.nextResultListeners=new Set,u.cancel=function(d){u.reject(d),u.sources=[],u.handlers.complete()},u.promise.catch(function(d){}),typeof o=="function"&&(o=[new Ti(o)]),qD(o)?o.then(function(d){return u.start(d)},u.handlers.error):u.start(o),u}return n.prototype.start=function(o){this.sub===void 0&&(this.sources=Array.from(o),this.handlers.complete())},n.prototype.deliverLastMessage=function(o){if(this.latest){var u=this.latest[0],d=o[u];d&&d.call(o,this.latest[1]),this.sub===null&&u==="next"&&o.complete&&o.complete()}},n.prototype.addObserver=function(o){this.observers.has(o)||(this.deliverLastMessage(o),this.observers.add(o))},n.prototype.removeObserver=function(o){this.observers.delete(o)&&this.observers.size<1&&this.handlers.complete()},n.prototype.notify=function(o,u){var d=this.nextResultListeners;d.size&&(this.nextResultListeners=new Set,d.forEach(function(g){return g(o,u)}))},n.prototype.beforeNext=function(o){var u=!1;this.nextResultListeners.add(function(d,g){u||(u=!0,o(d,g))})},n}(Ti);Z5(Af);function Xf(t){return"incremental"in t}function JV(t){return"hasNext"in t&&"data"in t}function e9(t){return Xf(t)||JV(t)}function t9(t){return Hi(t)&&"payload"in t}function X5(t,n){var o=t,u=new $u;return Xf(n)&&Pa(n.incremental)&&n.incremental.forEach(function(d){for(var g=d.data,x=d.path,T=x.length-1;T>=0;--T){var s=x[T],I=!isNaN(+s),O=I?[]:{};O[s]=g,g=O}o=u.merge(o,g)}),o}function K0(t){var n=oT(t);return Pa(n)}function oT(t){var n=Pa(t.errors)?t.errors.slice(0):[];return Xf(t)&&Pa(t.incremental)&&t.incremental.forEach(function(o){o.errors&&n.push.apply(n,o.errors)}),n}function nd(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var o=Object.create(null);return t.forEach(function(u){u&&Object.keys(u).forEach(function(d){var g=u[d];g!==void 0&&(o[d]=g)})}),o}function J0(t,n){return nd(t,n,n.variables&&{variables:nd(ct(ct({},t&&t.variables),n.variables))})}function fE(t){return new Ti(function(n){n.error(t)})}var Y5=function(t,n,o){var u=new Error(o);throw u.name="ServerError",u.response=t,u.statusCode=t.status,u.result=n,u};function r9(t){for(var n=["query","operationName","variables","extensions","context"],o=0,u=Object.keys(t);o<u.length;o++){var d=u[o];if(n.indexOf(d)<0)throw ys(43,d)}return t}function n9(t,n){var o=ct({},t),u=function(g){typeof g=="function"?o=ct(ct({},o),g(o)):o=ct(ct({},o),g)},d=function(){return ct({},o)};return Object.defineProperty(n,"setContext",{enumerable:!1,value:u}),Object.defineProperty(n,"getContext",{enumerable:!1,value:d}),n}function i9(t){var n={variables:t.variables||{},extensions:t.extensions||{},operationName:t.operationName,query:t.query};return n.operationName||(n.operationName=typeof n.query!="string"?tT(n.query)||void 0:""),n}function o9(t,n){var o=ct({},t),u=new Set(Object.keys(t));return Ec(n,{Variable:function(d,g,x){x&&x.kind!=="VariableDefinition"&&u.delete(d.name.value)}}),u.forEach(function(d){delete o[d]}),o}function WD(t,n){return n?n(t):Ti.of()}function ng(t){return typeof t=="function"?new ty(t):t}function m0(t){return t.request.length<=1}var ty=function(){function t(n){n&&(this.request=n)}return t.empty=function(){return new t(function(){return Ti.of()})},t.from=function(n){return n.length===0?t.empty():n.map(ng).reduce(function(o,u){return o.concat(u)})},t.split=function(n,o,u){var d=ng(o),g=ng(u||new t(WD)),x;return m0(d)&&m0(g)?x=new t(function(T){return n(T)?d.request(T)||Ti.of():g.request(T)||Ti.of()}):x=new t(function(T,s){return n(T)?d.request(T,s)||Ti.of():g.request(T,s)||Ti.of()}),Object.assign(x,{left:d,right:g})},t.execute=function(n,o){return n.request(n9(o.context,i9(r9(o))))||Ti.of()},t.concat=function(n,o){var u=ng(n);if(m0(u))return globalThis.__DEV__!==!1&&kr.warn(35,u),u;var d=ng(o),g;return m0(d)?g=new t(function(x){return u.request(x,function(T){return d.request(T)||Ti.of()})||Ti.of()}):g=new t(function(x,T){return u.request(x,function(s){return d.request(s,T)||Ti.of()})||Ti.of()}),Object.assign(g,{left:u,right:d})},t.prototype.split=function(n,o,u){return this.concat(t.split(n,o,u||new t(WD)))},t.prototype.concat=function(n){return t.concat(this,n)},t.prototype.request=function(n,o){throw ys(36)},t.prototype.onError=function(n,o){if(o&&o.error)return o.error(n),!1;throw n},t.prototype.setOnError=function(n){return this.onError=n,this},t}(),sT=ty.execute;function s9(t){var n,o=t[Symbol.asyncIterator]();return n={next:function(){return o.next()}},n[Symbol.asyncIterator]=function(){return this},n}function a9(t){var n=null,o=null,u=!1,d=[],g=[];function x(D){if(!o){if(g.length){var N=g.shift();if(Array.isArray(N)&&N[0])return N[0]({value:D,done:!1})}d.push(D)}}function T(D){o=D;var N=g.slice();N.forEach(function(j){j[1](D)}),!n||n()}function s(){u=!0;var D=g.slice();D.forEach(function(N){N[0]({value:void 0,done:!0})}),!n||n()}n=function(){n=null,t.removeListener("data",x),t.removeListener("error",T),t.removeListener("end",s),t.removeListener("finish",s),t.removeListener("close",s)},t.on("data",x),t.on("error",T),t.on("end",s),t.on("finish",s),t.on("close",s);function I(){return new Promise(function(D,N){if(o)return N(o);if(d.length)return D({value:d.shift(),done:!1});if(u)return D({value:void 0,done:!0});g.push([D,N])})}var O={next:function(){return I()}};return a1&&(O[Symbol.asyncIterator]=function(){return this}),O}function l9(t){var n=!1,o={next:function(){return n?Promise.resolve({value:void 0,done:!0}):(n=!0,new Promise(function(u,d){t.then(function(g){u({value:g,done:!1})}).catch(d)}))}};return a1&&(o[Symbol.asyncIterator]=function(){return this}),o}function HD(t){var n={next:function(){return t.read()}};return a1&&(n[Symbol.asyncIterator]=function(){return this}),n}function c9(t){return!!t.body}function u9(t){return!!t.getReader}function h9(t){return!!(a1&&t[Symbol.asyncIterator])}function d9(t){return!!t.stream}function f9(t){return!!t.arrayBuffer}function p9(t){return!!t.pipe}function m9(t){var n=t;if(c9(t)&&(n=t.body),h9(n))return s9(n);if(u9(n))return HD(n.getReader());if(d9(n))return HD(n.stream().getReader());if(f9(n))return l9(n.arrayBuffer());if(p9(n))return a9(n);throw new Error("Unknown body type for responseIterator. Please pass a streamable response.")}var oM=Symbol();function g9(t){return t.extensions?Array.isArray(t.extensions[oM]):!1}function _9(t){return t.hasOwnProperty("graphQLErrors")}var y9=function(t){var n=Ia(Ia(Ia([],t.graphQLErrors,!0),t.clientErrors,!0),t.protocolErrors,!0);return t.networkError&&n.push(t.networkError),n.map(function(o){return Hi(o)&&o.message||"Error message not found."}).join(`
`)},bu=function(t){jl(n,t);function n(o){var u=o.graphQLErrors,d=o.protocolErrors,g=o.clientErrors,x=o.networkError,T=o.errorMessage,s=o.extraInfo,I=t.call(this,T)||this;return I.name="ApolloError",I.graphQLErrors=u||[],I.protocolErrors=d||[],I.clientErrors=g||[],I.networkError=x||null,I.message=T||y9(I),I.extraInfo=s,I.__proto__=n.prototype,I}return n}(Error),ZD=Object.prototype.hasOwnProperty;function v9(t,n){var o;return yu(this,void 0,void 0,function(){var u,d,g,x,T,s,I,O,D,N,j,G,X,te,H,U,q,J,pe,ue,Me,Se,ge;return vu(this,function(se){switch(se.label){case 0:if(TextDecoder===void 0)throw new Error("TextDecoder must be defined in the environment: please import a polyfill.");u=new TextDecoder("utf-8"),d=(o=t.headers)===null||o===void 0?void 0:o.get("content-type"),g="boundary=",x=d!=null&&d.includes(g)?d==null?void 0:d.substring((d==null?void 0:d.indexOf(g))+g.length).replace(/['"]/g,"").replace(/\;(.*)/gm,"").trim():"-",T=`\r
--`.concat(x),s="",I=m9(t),O=!0,se.label=1;case 1:return O?[4,I.next()]:[3,3];case 2:for(D=se.sent(),N=D.value,j=D.done,G=typeof N=="string"?N:u.decode(N),X=s.length-T.length+1,O=!j,s+=G,te=s.indexOf(T,X);te>-1;){if(H=void 0,Se=[s.slice(0,te),s.slice(te+T.length)],H=Se[0],s=Se[1],U=H.indexOf(`\r
\r
`),q=x9(H.slice(0,U)),J=q["content-type"],J&&J.toLowerCase().indexOf("application/json")===-1)throw new Error("Unsupported patch content type: application/json is required.");if(pe=H.slice(U),pe){if(ue=Q5(t,pe),Object.keys(ue).length>1||"data"in ue||"incremental"in ue||"errors"in ue||"payload"in ue)t9(ue)?(Me={},"payload"in ue&&(Me=ct({},ue.payload)),"errors"in ue&&(Me=ct(ct({},Me),{extensions:ct(ct({},"extensions"in Me?Me.extensions:null),(ge={},ge[oM]=ue.errors,ge))})),n(Me)):n(ue);else if(Object.keys(ue).length===1&&"hasNext"in ue&&!ue.hasNext)return[2]}te=s.indexOf(T)}return[3,1];case 3:return[2]}})})}function x9(t){var n={};return t.split(`
`).forEach(function(o){var u=o.indexOf(":");if(u>-1){var d=o.slice(0,u).trim().toLowerCase(),g=o.slice(u+1).trim();n[d]=g}}),n}function Q5(t,n){if(t.status>=300){var o=function(){try{return JSON.parse(n)}catch{return n}};Y5(t,o(),"Response not successful: Received status code ".concat(t.status))}try{return JSON.parse(n)}catch(d){var u=d;throw u.name="ServerParseError",u.response=t,u.statusCode=t.status,u.bodyText=n,u}}function b9(t,n){t.result&&t.result.errors&&t.result.data&&n.next(t.result),n.error(t)}function w9(t){return function(n){return n.text().then(function(o){return Q5(n,o)}).then(function(o){return!Array.isArray(o)&&!ZD.call(o,"data")&&!ZD.call(o,"errors")&&Y5(n,o,"Server response was missing for query '".concat(Array.isArray(t)?t.map(function(u){return u.operationName}):t.operationName,"'.")),o})}}var aT=function(t,n){var o;try{o=JSON.stringify(t)}catch(d){var u=ys(39,n,d.message);throw u.parseError=d,u}return o},E9={includeQuery:!0,includeExtensions:!1,preserveHeaderCase:!1},S9={accept:"*/*","content-type":"application/json"},T9={method:"POST"},C9={http:E9,headers:S9,options:T9},M9=function(t,n){return n(t)};function I9(t,n){for(var o=[],u=2;u<arguments.length;u++)o[u-2]=arguments[u];var d={},g={};o.forEach(function(D){d=ct(ct(ct({},d),D.options),{headers:ct(ct({},d.headers),D.headers)}),D.credentials&&(d.credentials=D.credentials),g=ct(ct({},g),D.http)}),d.headers&&(d.headers=A9(d.headers,g.preserveHeaderCase));var x=t.operationName,T=t.extensions,s=t.variables,I=t.query,O={operationName:x,variables:s};return g.includeExtensions&&(O.extensions=T),g.includeQuery&&(O.query=n(I,p1)),{options:d,body:O}}function A9(t,n){if(!n){var o=Object.create(null);return Object.keys(Object(t)).forEach(function(g){o[g.toLowerCase()]=t[g]}),o}var u=Object.create(null);Object.keys(Object(t)).forEach(function(g){u[g.toLowerCase()]={originalName:g,value:t[g]}});var d=Object.create(null);return Object.keys(u).forEach(function(g){d[u[g].originalName]=u[g].value}),d}var k9=function(t){if(!t&&typeof fetch>"u")throw ys(37)},P9=function(t,n){var o=t.getContext(),u=o.uri;return u||(typeof n=="function"?n(t):n||"/graphql")};function O9(t,n){var o=[],u=function(D,N){o.push("".concat(D,"=").concat(encodeURIComponent(N)))};if("query"in n&&u("query",n.query),n.operationName&&u("operationName",n.operationName),n.variables){var d=void 0;try{d=aT(n.variables,"Variables map")}catch(D){return{parseError:D}}u("variables",d)}if(n.extensions){var g=void 0;try{g=aT(n.extensions,"Extensions map")}catch(D){return{parseError:D}}u("extensions",g)}var x="",T=t,s=t.indexOf("#");s!==-1&&(x=t.substr(s),T=t.substr(0,s));var I=T.indexOf("?")===-1?"?":"&",O=T+I+o.join("&")+x;return{newURI:O}}var XD=tl(function(){return fetch}),D9=function(t){t===void 0&&(t={});var n=t.uri,o=n===void 0?"/graphql":n,u=t.fetch,d=t.print,g=d===void 0?M9:d,x=t.includeExtensions,T=t.preserveHeaderCase,s=t.useGETForQueries,I=t.includeUnusedVariables,O=I===void 0?!1:I,D=ka(t,["uri","fetch","print","includeExtensions","preserveHeaderCase","useGETForQueries","includeUnusedVariables"]);globalThis.__DEV__!==!1&&k9(u||XD);var N={http:{includeExtensions:x,preserveHeaderCase:T},options:D.fetchOptions,credentials:D.credentials,headers:D.headers};return new ty(function(j){var G=P9(j,o),X=j.getContext(),te={};if(X.clientAwareness){var H=X.clientAwareness,U=H.name,q=H.version;U&&(te["apollographql-client-name"]=U),q&&(te["apollographql-client-version"]=q)}var J=ct(ct({},te),X.headers),pe={http:X.http,options:X.fetchOptions,credentials:X.credentials,headers:J};if(y_(["client"],j.query)){var ue=V5(j.query);if(!ue)return fE(new Error("HttpLink: Trying to send a client-only query to the server. To send to the server, ensure a non-client field is added to the query or set the `transformOptions.removeClientFields` option to `true`."));j.query=ue}var Me=I9(j,g,C9,N,pe),Se=Me.options,ge=Me.body;ge.variables&&!O&&(ge.variables=o9(ge.variables,j.query));var se;!Se.signal&&typeof AbortController<"u"&&(se=new AbortController,Se.signal=se.signal);var Ie=function(rt){return rt.kind==="OperationDefinition"&&rt.operation==="mutation"},We=function(rt){return rt.kind==="OperationDefinition"&&rt.operation==="subscription"},ze=We(ey(j.query)),De=y_(["defer"],j.query);if(s&&!j.query.definitions.some(Ie)&&(Se.method="GET"),De||ze){Se.headers=Se.headers||{};var nt="multipart/mixed;";ze&&De&&globalThis.__DEV__!==!1&&kr.warn(38),ze?nt+="boundary=graphql;subscriptionSpec=1.0,application/json":De&&(nt+="deferSpec=20220824,application/json"),Se.headers.accept=nt}if(Se.method==="GET"){var It=O9(G,ge),Ot=It.newURI,bt=It.parseError;if(bt)return fE(bt);G=Ot}else try{Se.body=aT(ge,"Payload")}catch(rt){return fE(rt)}return new Ti(function(rt){var Gt=u||tl(function(){return fetch})||XD,Vt=rt.next.bind(rt);return Gt(G,Se).then(function(Jt){var wr;j.setContext({response:Jt});var or=(wr=Jt.headers)===null||wr===void 0?void 0:wr.get("content-type");return or!==null&&/^multipart\/mixed/i.test(or)?v9(Jt,Vt):w9(j)(Jt).then(Vt)}).then(function(){se=void 0,rt.complete()}).catch(function(Jt){se=void 0,b9(Jt,rt)}),function(){se&&se.abort()}})})},R9=function(t){jl(n,t);function n(o){o===void 0&&(o={});var u=t.call(this,D9(o).request)||this;return u.options=o,u}return n}(ty);const{toString:YD,hasOwnProperty:L9}=Object.prototype,QD=Function.prototype.toString,lT=new Map;function li(t,n){try{return cT(t,n)}finally{lT.clear()}}function cT(t,n){if(t===n)return!0;const o=YD.call(t),u=YD.call(n);if(o!==u)return!1;switch(o){case"[object Array]":if(t.length!==n.length)return!1;case"[object Object]":{if(JD(t,n))return!0;const d=KD(t),g=KD(n),x=d.length;if(x!==g.length)return!1;for(let T=0;T<x;++T)if(!L9.call(n,d[T]))return!1;for(let T=0;T<x;++T){const s=d[T];if(!cT(t[s],n[s]))return!1}return!0}case"[object Error]":return t.name===n.name&&t.message===n.message;case"[object Number]":if(t!==t)return n!==n;case"[object Boolean]":case"[object Date]":return+t==+n;case"[object RegExp]":case"[object String]":return t==`${n}`;case"[object Map]":case"[object Set]":{if(t.size!==n.size)return!1;if(JD(t,n))return!0;const d=t.entries(),g=o==="[object Map]";for(;;){const x=d.next();if(x.done)break;const[T,s]=x.value;if(!n.has(T)||g&&!cT(s,n.get(T)))return!1}return!0}case"[object Uint16Array]":case"[object Uint8Array]":case"[object Uint32Array]":case"[object Int32Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object ArrayBuffer]":t=new Uint8Array(t),n=new Uint8Array(n);case"[object DataView]":{let d=t.byteLength;if(d===n.byteLength)for(;d--&&t[d]===n[d];);return d===-1}case"[object AsyncFunction]":case"[object GeneratorFunction]":case"[object AsyncGeneratorFunction]":case"[object Function]":{const d=QD.call(t);return d!==QD.call(n)?!1:!F9(d,N9)}}return!1}function KD(t){return Object.keys(t).filter(z9,t)}function z9(t){return this[t]!==void 0}const N9="{ [native code] }";function F9(t,n){const o=t.length-n.length;return o>=0&&t.indexOf(n,o)===o}function JD(t,n){let o=lT.get(t);if(o){if(o.has(n))return!0}else lT.set(t,o=new Set);return o.add(n),!1}var K5=function(){function t(){this.assumeImmutableResults=!1,this.getFragmentDoc=x_(VU,{max:Fl["cache.fragmentQueryDocuments"]||1e3,cache:wx})}return t.prototype.batch=function(n){var o=this,u=typeof n.optimistic=="string"?n.optimistic:n.optimistic===!1?null:void 0,d;return this.performTransaction(function(){return d=n.update(o)},u),d},t.prototype.recordOptimisticTransaction=function(n,o){this.performTransaction(n,o)},t.prototype.transformDocument=function(n){return n},t.prototype.transformForLink=function(n){return n},t.prototype.identify=function(n){},t.prototype.gc=function(){return[]},t.prototype.modify=function(n){return!1},t.prototype.readQuery=function(n,o){return o===void 0&&(o=!!n.optimistic),this.read(ct(ct({},n),{rootId:n.id||"ROOT_QUERY",optimistic:o}))},t.prototype.readFragment=function(n,o){return o===void 0&&(o=!!n.optimistic),this.read(ct(ct({},n),{query:this.getFragmentDoc(n.fragment,n.fragmentName),rootId:n.id,optimistic:o}))},t.prototype.writeQuery=function(n){var o=n.id,u=n.data,d=ka(n,["id","data"]);return this.write(Object.assign(d,{dataId:o||"ROOT_QUERY",result:u}))},t.prototype.writeFragment=function(n){var o=n.id,u=n.data,d=n.fragment,g=n.fragmentName,x=ka(n,["id","data","fragment","fragmentName"]);return this.write(Object.assign(x,{query:this.getFragmentDoc(d,g),dataId:o,result:u}))},t.prototype.updateQuery=function(n,o){return this.batch({update:function(u){var d=u.readQuery(n),g=o(d);return g==null?d:(u.writeQuery(ct(ct({},n),{data:g})),g)}})},t.prototype.updateFragment=function(n,o){return this.batch({update:function(u){var d=u.readFragment(n),g=o(d);return g==null?d:(u.writeFragment(ct(ct({},n),{data:g})),g)}})},t}();globalThis.__DEV__!==!1&&(K5.prototype.getMemoryInternals=eV);var J5=function(t){jl(n,t);function n(o,u,d,g){var x,T=t.call(this,o)||this;if(T.message=o,T.path=u,T.query=d,T.variables=g,Array.isArray(T.path)){T.missing=T.message;for(var s=T.path.length-1;s>=0;--s)T.missing=(x={},x[T.path[s]]=T.missing,x)}else T.missing=T.path;return T.__proto__=n.prototype,T}return n}(Error),To=Object.prototype.hasOwnProperty;function ig(t){return t==null}function ez(t,n){var o=t.__typename,u=t.id,d=t._id;if(typeof o=="string"&&(n&&(n.keyObject=ig(u)?ig(d)?void 0:{_id:d}:{id:u}),ig(u)&&!ig(d)&&(u=d),!ig(u)))return"".concat(o,":").concat(typeof u=="number"||typeof u=="string"?u:JSON.stringify(u))}var tz={dataIdFromObject:ez,addTypename:!0,resultCaching:!0,canonizeResults:!1};function B9(t){return nd(tz,t)}function rz(t){var n=t.canonizeResults;return n===void 0?tz.canonizeResults:n}function j9(t,n){return Jn(n)?t.get(n.__ref,"__typename"):n&&n.__typename}var nz=/^[_a-z][_0-9a-z]*/i;function Uu(t){var n=t.match(nz);return n?n[0]:t}function uT(t,n,o){return Hi(n)?Zi(n)?n.every(function(u){return uT(t,u,o)}):t.selections.every(function(u){if(Bu(u)&&Q_(u,o)){var d=Fu(u);return To.call(n,d)&&(!u.selectionSet||uT(u.selectionSet,n[d],o))}return!0}):!1}function Of(t){return Hi(t)&&!Jn(t)&&!Zi(t)}function $9(){return new $u}function iz(t,n){var o=l1(h1(t));return{fragmentMap:o,lookupFragment:function(u){var d=o[u];return!d&&n&&(d=n.lookup(u)),d||null}}}var ex=Object.create(null),pE=function(){return ex},e3=Object.create(null),w_=function(){function t(n,o){var u=this;this.policies=n,this.group=o,this.data=Object.create(null),this.rootIds=Object.create(null),this.refs=Object.create(null),this.getFieldValue=function(d,g){return b_(Jn(d)?u.get(d.__ref,g):d&&d[g])},this.canRead=function(d){return Jn(d)?u.has(d.__ref):typeof d=="object"},this.toReference=function(d,g){if(typeof d=="string")return Zf(d);if(Jn(d))return d;var x=u.policies.identify(d)[0];if(x){var T=Zf(x);return g&&u.merge(x,d),T}}}return t.prototype.toObject=function(){return ct({},this.data)},t.prototype.has=function(n){return this.lookup(n,!0)!==void 0},t.prototype.get=function(n,o){if(this.group.depend(n,o),To.call(this.data,n)){var u=this.data[n];if(u&&To.call(u,o))return u[o]}if(o==="__typename"&&To.call(this.policies.rootTypenamesById,n))return this.policies.rootTypenamesById[n];if(this instanceof mu)return this.parent.get(n,o)},t.prototype.lookup=function(n,o){if(o&&this.group.depend(n,"__exists"),To.call(this.data,n))return this.data[n];if(this instanceof mu)return this.parent.lookup(n,o);if(this.policies.rootTypenamesById[n])return Object.create(null)},t.prototype.merge=function(n,o){var u=this,d;Jn(n)&&(n=n.__ref),Jn(o)&&(o=o.__ref);var g=typeof n=="string"?this.lookup(d=n):n,x=typeof o=="string"?this.lookup(d=o):o;if(x){kr(typeof d=="string",1);var T=new $u(V9).merge(g,x);if(this.data[d]=T,T!==g&&(delete this.refs[d],this.group.caching)){var s=Object.create(null);g||(s.__exists=1),Object.keys(x).forEach(function(I){if(!g||g[I]!==T[I]){s[I]=1;var O=Uu(I);O!==I&&!u.policies.hasKeyArgs(T.__typename,O)&&(s[O]=1),T[I]===void 0&&!(u instanceof mu)&&delete T[I]}}),s.__typename&&!(g&&g.__typename)&&this.policies.rootTypenamesById[d]===T.__typename&&delete s.__typename,Object.keys(s).forEach(function(I){return u.group.dirty(d,I)})}}},t.prototype.modify=function(n,o){var u=this,d=this.lookup(n);if(d){var g=Object.create(null),x=!1,T=!0,s={DELETE:ex,INVALIDATE:e3,isReference:Jn,toReference:this.toReference,canRead:this.canRead,readField:function(I,O){return u.policies.readField(typeof I=="string"?{fieldName:I,from:O||Zf(n)}:I,{store:u})}};if(Object.keys(d).forEach(function(I){var O=Uu(I),D=d[I];if(D!==void 0){var N=typeof o=="function"?o:o[I]||o[O];if(N){var j=N===pE?ex:N(b_(D),ct(ct({},s),{fieldName:O,storeFieldName:I,storage:u.getStorage(n,I)}));if(j===e3)u.group.dirty(n,I);else if(j===ex&&(j=void 0),j!==D&&(g[I]=j,x=!0,D=j,globalThis.__DEV__!==!1)){var G=function(pe){if(u.lookup(pe.__ref)===void 0)return globalThis.__DEV__!==!1&&kr.warn(2,pe),!0};if(Jn(j))G(j);else if(Array.isArray(j))for(var X=!1,te=void 0,H=0,U=j;H<U.length;H++){var q=U[H];if(Jn(q)){if(X=!0,G(q))break}else if(typeof q=="object"&&q){var J=u.policies.identify(q)[0];J&&(te=q)}if(X&&te!==void 0){globalThis.__DEV__!==!1&&kr.warn(3,te);break}}}}D!==void 0&&(T=!1)}}),x)return this.merge(n,g),T&&(this instanceof mu?this.data[n]=void 0:delete this.data[n],this.group.dirty(n,"__exists")),!0}return!1},t.prototype.delete=function(n,o,u){var d,g=this.lookup(n);if(g){var x=this.getFieldValue(g,"__typename"),T=o&&u?this.policies.getStoreFieldName({typename:x,fieldName:o,args:u}):o;return this.modify(n,T?(d={},d[T]=pE,d):pE)}return!1},t.prototype.evict=function(n,o){var u=!1;return n.id&&(To.call(this.data,n.id)&&(u=this.delete(n.id,n.fieldName,n.args)),this instanceof mu&&this!==o&&(u=this.parent.evict(n,o)||u),(n.fieldName||u)&&this.group.dirty(n.id,n.fieldName||"__exists")),u},t.prototype.clear=function(){this.replace(null)},t.prototype.extract=function(){var n=this,o=this.toObject(),u=[];return this.getRootIdSet().forEach(function(d){To.call(n.policies.rootTypenamesById,d)||u.push(d)}),u.length&&(o.__META={extraRootIds:u.sort()}),o},t.prototype.replace=function(n){var o=this;if(Object.keys(this.data).forEach(function(g){n&&To.call(n,g)||o.delete(g)}),n){var u=n.__META,d=ka(n,["__META"]);Object.keys(d).forEach(function(g){o.merge(g,d[g])}),u&&u.extraRootIds.forEach(this.retain,this)}},t.prototype.retain=function(n){return this.rootIds[n]=(this.rootIds[n]||0)+1},t.prototype.release=function(n){if(this.rootIds[n]>0){var o=--this.rootIds[n];return o||delete this.rootIds[n],o}return 0},t.prototype.getRootIdSet=function(n){return n===void 0&&(n=new Set),Object.keys(this.rootIds).forEach(n.add,n),this instanceof mu?this.parent.getRootIdSet(n):Object.keys(this.policies.rootTypenamesById).forEach(n.add,n),n},t.prototype.gc=function(){var n=this,o=this.getRootIdSet(),u=this.toObject();o.forEach(function(x){To.call(u,x)&&(Object.keys(n.findChildRefIds(x)).forEach(o.add,o),delete u[x])});var d=Object.keys(u);if(d.length){for(var g=this;g instanceof mu;)g=g.parent;d.forEach(function(x){return g.delete(x)})}return d},t.prototype.findChildRefIds=function(n){if(!To.call(this.refs,n)){var o=this.refs[n]=Object.create(null),u=this.data[n];if(!u)return o;var d=new Set([u]);d.forEach(function(g){Jn(g)&&(o[g.__ref]=!0),Hi(g)&&Object.keys(g).forEach(function(x){var T=g[x];Hi(T)&&d.add(T)})})}return this.refs[n]},t.prototype.makeCacheKey=function(){return this.group.keyMaker.lookupArray(arguments)},t}(),oz=function(){function t(n,o){o===void 0&&(o=null),this.caching=n,this.parent=o,this.d=null,this.resetCaching()}return t.prototype.resetCaching=function(){this.d=this.caching?B5():null,this.keyMaker=new wp(fd)},t.prototype.depend=function(n,o){if(this.d){this.d(mE(n,o));var u=Uu(o);u!==o&&this.d(mE(n,u)),this.parent&&this.parent.depend(n,o)}},t.prototype.dirty=function(n,o){this.d&&this.d.dirty(mE(n,o),o==="__exists"?"forget":"setDirty")},t}();function mE(t,n){return n+"#"+t}function t3(t,n){i_(t)&&t.group.depend(n,"__exists")}(function(t){var n=function(o){jl(u,o);function u(d){var g=d.policies,x=d.resultCaching,T=x===void 0?!0:x,s=d.seed,I=o.call(this,g,new oz(T))||this;return I.stump=new U9(I),I.storageTrie=new wp(fd),s&&I.replace(s),I}return u.prototype.addLayer=function(d,g){return this.stump.addLayer(d,g)},u.prototype.removeLayer=function(){return this},u.prototype.getStorage=function(){return this.storageTrie.lookupArray(arguments)},u}(t);t.Root=n})(w_||(w_={}));var mu=function(t){jl(n,t);function n(o,u,d,g){var x=t.call(this,u.policies,g)||this;return x.id=o,x.parent=u,x.replay=d,x.group=g,d(x),x}return n.prototype.addLayer=function(o,u){return new n(o,this,u,this.group)},n.prototype.removeLayer=function(o){var u=this,d=this.parent.removeLayer(o);return o===this.id?(this.group.caching&&Object.keys(this.data).forEach(function(g){var x=u.data[g],T=d.lookup(g);T?x?x!==T&&Object.keys(x).forEach(function(s){li(x[s],T[s])||u.group.dirty(g,s)}):(u.group.dirty(g,"__exists"),Object.keys(T).forEach(function(s){u.group.dirty(g,s)})):u.delete(g)}),d):d===this.parent?this:d.addLayer(this.id,this.replay)},n.prototype.toObject=function(){return ct(ct({},this.parent.toObject()),this.data)},n.prototype.findChildRefIds=function(o){var u=this.parent.findChildRefIds(o);return To.call(this.data,o)?ct(ct({},u),t.prototype.findChildRefIds.call(this,o)):u},n.prototype.getStorage=function(){for(var o=this.parent;o.parent;)o=o.parent;return o.getStorage.apply(o,arguments)},n}(w_),U9=function(t){jl(n,t);function n(o){return t.call(this,"EntityStore.Stump",o,function(){},new oz(o.group.caching,o.group))||this}return n.prototype.removeLayer=function(){return this},n.prototype.merge=function(o,u){return this.parent.merge(o,u)},n}(mu);function V9(t,n,o){var u=t[o],d=n[o];return li(u,d)?u:d}function i_(t){return!!(t instanceof w_&&t.group.caching)}function G9(t){return Hi(t)?Zi(t)?t.slice(0):ct({__proto__:Object.getPrototypeOf(t)},t):t}var r3=function(){function t(){this.known=new(b5?WeakSet:Set),this.pool=new wp(fd),this.passes=new WeakMap,this.keysByJSON=new Map,this.empty=this.admit({})}return t.prototype.isKnown=function(n){return Hi(n)&&this.known.has(n)},t.prototype.pass=function(n){if(Hi(n)){var o=G9(n);return this.passes.set(o,n),o}return n},t.prototype.admit=function(n){var o=this;if(Hi(n)){var u=this.passes.get(n);if(u)return u;var d=Object.getPrototypeOf(n);switch(d){case Array.prototype:{if(this.known.has(n))return n;var g=n.map(this.admit,this),x=this.pool.lookupArray(g);return x.array||(this.known.add(x.array=g),globalThis.__DEV__!==!1&&Object.freeze(g)),x.array}case null:case Object.prototype:{if(this.known.has(n))return n;var T=Object.getPrototypeOf(n),s=[T],I=this.sortedKeys(n);s.push(I.json);var O=s.length;I.sorted.forEach(function(j){s.push(o.admit(n[j]))});var x=this.pool.lookupArray(s);if(!x.object){var D=x.object=Object.create(T);this.known.add(D),I.sorted.forEach(function(j,G){D[j]=s[O+G]}),globalThis.__DEV__!==!1&&Object.freeze(D)}return x.object}}}return n},t.prototype.sortedKeys=function(n){var o=Object.keys(n),u=this.pool.lookupArray(o);if(!u.keys){o.sort();var d=JSON.stringify(o);(u.keys=this.keysByJSON.get(d))||this.keysByJSON.set(d,u.keys={sorted:o,json:d})}return u.keys},t}();function n3(t){return[t.selectionSet,t.objectOrReference,t.context,t.context.canonizeResults]}var q9=function(){function t(n){var o=this;this.knownResults=new(fd?WeakMap:Map),this.config=nd(n,{addTypename:n.addTypename!==!1,canonizeResults:rz(n)}),this.canon=n.canon||new r3,this.executeSelectionSet=x_(function(u){var d,g=u.context.canonizeResults,x=n3(u);x[3]=!g;var T=(d=o.executeSelectionSet).peek.apply(d,x);return T?g?ct(ct({},T),{result:o.canon.admit(T.result)}):T:(t3(u.context.store,u.enclosingRef.__ref),o.execSelectionSetImpl(u))},{max:this.config.resultCacheMaxSize||Fl["inMemoryCache.executeSelectionSet"]||5e4,keyArgs:n3,makeCacheKey:function(u,d,g,x){if(i_(g.store))return g.store.makeCacheKey(u,Jn(d)?d.__ref:d,g.varString,x)}}),this.executeSubSelectedArray=x_(function(u){return t3(u.context.store,u.enclosingRef.__ref),o.execSubSelectedArrayImpl(u)},{max:this.config.resultCacheMaxSize||Fl["inMemoryCache.executeSubSelectedArray"]||1e4,makeCacheKey:function(u){var d=u.field,g=u.array,x=u.context;if(i_(x.store))return x.store.makeCacheKey(d,g,x.varString)}})}return t.prototype.resetCanon=function(){this.canon=new r3},t.prototype.diffQueryAgainstStore=function(n){var o=n.store,u=n.query,d=n.rootId,g=d===void 0?"ROOT_QUERY":d,x=n.variables,T=n.returnPartialData,s=T===void 0?!0:T,I=n.canonizeResults,O=I===void 0?this.config.canonizeResults:I,D=this.config.cache.policies;x=ct(ct({},XC(M5(u))),x);var N=Zf(g),j=this.executeSelectionSet({selectionSet:ey(u).selectionSet,objectOrReference:N,enclosingRef:N,context:ct({store:o,query:u,policies:D,variables:x,varString:Au(x),canonizeResults:O},iz(u,this.config.fragments))}),G;if(j.missing&&(G=[new J5(W9(j.missing),j.missing,u,x)],!s))throw G[0];return{result:j.result,complete:!G,missing:G}},t.prototype.isFresh=function(n,o,u,d){if(i_(d.store)&&this.knownResults.get(n)===u){var g=this.executeSelectionSet.peek(u,o,d,this.canon.isKnown(n));if(g&&n===g.result)return!0}return!1},t.prototype.execSelectionSetImpl=function(n){var o=this,u=n.selectionSet,d=n.objectOrReference,g=n.enclosingRef,x=n.context;if(Jn(d)&&!x.policies.rootTypenamesById[d.__ref]&&!x.store.has(d.__ref))return{result:this.canon.empty,missing:"Dangling reference to missing ".concat(d.__ref," object")};var T=x.variables,s=x.policies,I=x.store,O=I.getFieldValue(d,"__typename"),D=[],N,j=new $u;this.config.addTypename&&typeof O=="string"&&!s.rootIdsByTypename[O]&&D.push({__typename:O});function G(q,J){var pe;return q.missing&&(N=j.merge(N,(pe={},pe[J]=q.missing,pe))),q.result}var X=new Set(u.selections);X.forEach(function(q){var J,pe;if(Q_(q,T))if(Bu(q)){var ue=s.readField({fieldName:q.name.value,field:q,variables:x.variables,from:d},x),Me=Fu(q);ue===void 0?JC.added(q)||(N=j.merge(N,(J={},J[Me]="Can't find field '".concat(q.name.value,"' on ").concat(Jn(d)?d.__ref+" object":"object "+JSON.stringify(d,null,2)),J))):Zi(ue)?ue=G(o.executeSubSelectedArray({field:q,array:ue,enclosingRef:g,context:x}),Me):q.selectionSet?ue!=null&&(ue=G(o.executeSelectionSet({selectionSet:q.selectionSet,objectOrReference:ue,enclosingRef:Jn(ue)?ue:g,context:x}),Me)):x.canonizeResults&&(ue=o.canon.pass(ue)),ue!==void 0&&D.push((pe={},pe[Me]=ue,pe))}else{var Se=c1(q,x.lookupFragment);if(!Se&&q.kind===xr.FRAGMENT_SPREAD)throw ys(9,q.name.value);Se&&s.fragmentMatches(Se,O)&&Se.selectionSet.selections.forEach(X.add,X)}});var te=eM(D),H={result:te,missing:N},U=x.canonizeResults?this.canon.admit(H):b_(H);return U.result&&this.knownResults.set(U.result,u),U},t.prototype.execSubSelectedArrayImpl=function(n){var o=this,u=n.field,d=n.array,g=n.enclosingRef,x=n.context,T,s=new $u;function I(O,D){var N;return O.missing&&(T=s.merge(T,(N={},N[D]=O.missing,N))),O.result}return u.selectionSet&&(d=d.filter(x.store.canRead)),d=d.map(function(O,D){return O===null?null:Zi(O)?I(o.executeSubSelectedArray({field:u,array:O,enclosingRef:g,context:x}),D):u.selectionSet?I(o.executeSelectionSet({selectionSet:u.selectionSet,objectOrReference:O,enclosingRef:Jn(O)?O:g,context:x}),D):(globalThis.__DEV__!==!1&&H9(x.store,u,O),O)}),{result:x.canonizeResults?this.canon.admit(d):d,missing:T}},t}();function W9(t){try{JSON.stringify(t,function(n,o){if(typeof o=="string")throw o;return o})}catch(n){return n}}function H9(t,n,o){if(!n.selectionSet){var u=new Set([o]);u.forEach(function(d){Hi(d)&&(kr(!Jn(d),10,j9(t,d),n.name.value),Object.values(d).forEach(u.add,u))})}}var sM=new I5,i3=new WeakMap;function o_(t){var n=i3.get(t);return n||i3.set(t,n={vars:new Set,dep:B5()}),n}function o3(t){o_(t).vars.forEach(function(n){return n.forgetCache(t)})}function Z9(t){o_(t).vars.forEach(function(n){return n.attachCache(t)})}function X9(t){var n=new Set,o=new Set,u=function(g){if(arguments.length>0){if(t!==g){t=g,n.forEach(function(s){o_(s).dep.dirty(u),Y9(s)});var x=Array.from(o);o.clear(),x.forEach(function(s){return s(t)})}}else{var T=sM.getValue();T&&(d(T),o_(T).dep(u))}return t};u.onNextChange=function(g){return o.add(g),function(){o.delete(g)}};var d=u.attachCache=function(g){return n.add(g),o_(g).vars.add(u),u};return u.forgetCache=function(g){return n.delete(g)},u}function Y9(t){t.broadcastWatches&&t.broadcastWatches()}var s3=Object.create(null);function aM(t){var n=JSON.stringify(t);return s3[n]||(s3[n]=Object.create(null))}function a3(t){var n=aM(t);return n.keyFieldsFn||(n.keyFieldsFn=function(o,u){var d=function(x,T){return u.readField(T,x)},g=u.keyObject=lM(t,function(x){var T=Yf(u.storeObject,x,d);return T===void 0&&o!==u.storeObject&&To.call(o,x[0])&&(T=Yf(o,x,az)),kr(T!==void 0,4,x.join("."),o),T});return"".concat(u.typename,":").concat(JSON.stringify(g))})}function l3(t){var n=aM(t);return n.keyArgsFn||(n.keyArgsFn=function(o,u){var d=u.field,g=u.variables,x=u.fieldName,T=lM(t,function(I){var O=I[0],D=O.charAt(0);if(D==="@"){if(d&&Pa(d.directives)){var N=O.slice(1),j=d.directives.find(function(H){return H.name.value===N}),G=j&&u1(j,g);return G&&Yf(G,I.slice(1))}return}if(D==="$"){var X=O.slice(1);if(g&&To.call(g,X)){var te=I.slice(0);return te[0]=X,Yf(g,te)}return}if(o)return Yf(o,I)}),s=JSON.stringify(T);return(o||s!=="{}")&&(x+=":"+s),x})}function lM(t,n){var o=new $u;return sz(t).reduce(function(u,d){var g,x=n(d);if(x!==void 0){for(var T=d.length-1;T>=0;--T)x=(g={},g[d[T]]=x,g);u=o.merge(u,x)}return u},Object.create(null))}function sz(t){var n=aM(t);if(!n.paths){var o=n.paths=[],u=[];t.forEach(function(d,g){Zi(d)?(sz(d).forEach(function(x){return o.push(u.concat(x))}),u.length=0):(u.push(d),Zi(t[g+1])||(o.push(u.slice(0)),u.length=0))})}return n.paths}function az(t,n){return t[n]}function Yf(t,n,o){return o=o||az,lz(n.reduce(function u(d,g){return Zi(d)?d.map(function(x){return u(x,g)}):d&&o(d,g)},t))}function lz(t){return Hi(t)?Zi(t)?t.map(lz):lM(Object.keys(t).sort(),function(n){return Yf(t,n)}):t}function hT(t){return t.args!==void 0?t.args:t.field?u1(t.field,t.variables):null}var Q9=function(){},c3=function(t,n){return n.fieldName},u3=function(t,n,o){var u=o.mergeObjects;return u(t,n)},h3=function(t,n){return n},K9=function(){function t(n){this.config=n,this.typePolicies=Object.create(null),this.toBeAdded=Object.create(null),this.supertypeMap=new Map,this.fuzzySubtypes=new Map,this.rootIdsByTypename=Object.create(null),this.rootTypenamesById=Object.create(null),this.usingPossibleTypes=!1,this.config=ct({dataIdFromObject:ez},n),this.cache=this.config.cache,this.setRootTypename("Query"),this.setRootTypename("Mutation"),this.setRootTypename("Subscription"),n.possibleTypes&&this.addPossibleTypes(n.possibleTypes),n.typePolicies&&this.addTypePolicies(n.typePolicies)}return t.prototype.identify=function(n,o){var u,d=this,g=o&&(o.typename||((u=o.storeObject)===null||u===void 0?void 0:u.__typename))||n.__typename;if(g===this.rootTypenamesById.ROOT_QUERY)return["ROOT_QUERY"];for(var x=o&&o.storeObject||n,T=ct(ct({},o),{typename:g,storeObject:x,readField:o&&o.readField||function(){var N=cM(arguments,x);return d.readField(N,{store:d.cache.data,variables:N.variables})}}),s,I=g&&this.getTypePolicy(g),O=I&&I.keyFn||this.config.dataIdFromObject;O;){var D=O(ct(ct({},n),x),T);if(Zi(D))O=a3(D);else{s=D;break}}return s=s?String(s):void 0,T.keyObject?[s,T.keyObject]:[s]},t.prototype.addTypePolicies=function(n){var o=this;Object.keys(n).forEach(function(u){var d=n[u],g=d.queryType,x=d.mutationType,T=d.subscriptionType,s=ka(d,["queryType","mutationType","subscriptionType"]);g&&o.setRootTypename("Query",u),x&&o.setRootTypename("Mutation",u),T&&o.setRootTypename("Subscription",u),To.call(o.toBeAdded,u)?o.toBeAdded[u].push(s):o.toBeAdded[u]=[s]})},t.prototype.updateTypePolicy=function(n,o){var u=this,d=this.getTypePolicy(n),g=o.keyFields,x=o.fields;function T(s,I){s.merge=typeof I=="function"?I:I===!0?u3:I===!1?h3:s.merge}T(d,o.merge),d.keyFn=g===!1?Q9:Zi(g)?a3(g):typeof g=="function"?g:d.keyFn,x&&Object.keys(x).forEach(function(s){var I=u.getFieldPolicy(n,s,!0),O=x[s];if(typeof O=="function")I.read=O;else{var D=O.keyArgs,N=O.read,j=O.merge;I.keyFn=D===!1?c3:Zi(D)?l3(D):typeof D=="function"?D:I.keyFn,typeof N=="function"&&(I.read=N),T(I,j)}I.read&&I.merge&&(I.keyFn=I.keyFn||c3)})},t.prototype.setRootTypename=function(n,o){o===void 0&&(o=n);var u="ROOT_"+n.toUpperCase(),d=this.rootTypenamesById[u];o!==d&&(kr(!d||d===n,5,n),d&&delete this.rootIdsByTypename[d],this.rootIdsByTypename[o]=u,this.rootTypenamesById[u]=o)},t.prototype.addPossibleTypes=function(n){var o=this;this.usingPossibleTypes=!0,Object.keys(n).forEach(function(u){o.getSupertypeSet(u,!0),n[u].forEach(function(d){o.getSupertypeSet(d,!0).add(u);var g=d.match(nz);(!g||g[0]!==d)&&o.fuzzySubtypes.set(d,new RegExp(d))})})},t.prototype.getTypePolicy=function(n){var o=this;if(!To.call(this.typePolicies,n)){var u=this.typePolicies[n]=Object.create(null);u.fields=Object.create(null);var d=this.supertypeMap.get(n);!d&&this.fuzzySubtypes.size&&(d=this.getSupertypeSet(n,!0),this.fuzzySubtypes.forEach(function(x,T){if(x.test(n)){var s=o.supertypeMap.get(T);s&&s.forEach(function(I){return d.add(I)})}})),d&&d.size&&d.forEach(function(x){var T=o.getTypePolicy(x),s=T.fields,I=ka(T,["fields"]);Object.assign(u,I),Object.assign(u.fields,s)})}var g=this.toBeAdded[n];return g&&g.length&&g.splice(0).forEach(function(x){o.updateTypePolicy(n,x)}),this.typePolicies[n]},t.prototype.getFieldPolicy=function(n,o,u){if(n){var d=this.getTypePolicy(n).fields;return d[o]||u&&(d[o]=Object.create(null))}},t.prototype.getSupertypeSet=function(n,o){var u=this.supertypeMap.get(n);return!u&&o&&this.supertypeMap.set(n,u=new Set),u},t.prototype.fragmentMatches=function(n,o,u,d){var g=this;if(!n.typeCondition)return!0;if(!o)return!1;var x=n.typeCondition.name.value;if(o===x)return!0;if(this.usingPossibleTypes&&this.supertypeMap.has(x))for(var T=this.getSupertypeSet(o,!0),s=[T],I=function(G){var X=g.getSupertypeSet(G,!1);X&&X.size&&s.indexOf(X)<0&&s.push(X)},O=!!(u&&this.fuzzySubtypes.size),D=!1,N=0;N<s.length;++N){var j=s[N];if(j.has(x))return T.has(x)||(D&&globalThis.__DEV__!==!1&&kr.warn(6,o,x),T.add(x)),!0;j.forEach(I),O&&N===s.length-1&&uT(n.selectionSet,u,d)&&(O=!1,D=!0,this.fuzzySubtypes.forEach(function(G,X){var te=o.match(G);te&&te[0]===o&&I(X)}))}return!1},t.prototype.hasKeyArgs=function(n,o){var u=this.getFieldPolicy(n,o,!1);return!!(u&&u.keyFn)},t.prototype.getStoreFieldName=function(n){var o=n.typename,u=n.fieldName,d=this.getFieldPolicy(o,u,!1),g,x=d&&d.keyFn;if(x&&o)for(var T={typename:o,fieldName:u,field:n.field||null,variables:n.variables},s=hT(n);x;){var I=x(s,T);if(Zi(I))x=l3(I);else{g=I||u;break}}return g===void 0&&(g=n.field?_V(n.field,n.variables):C5(u,hT(n))),g===!1?u:u===Uu(g)?g:u+":"+g},t.prototype.readField=function(n,o){var u=n.from;if(u){var d=n.field||n.fieldName;if(d){if(n.typename===void 0){var g=o.store.getFieldValue(u,"__typename");g&&(n.typename=g)}var x=this.getStoreFieldName(n),T=Uu(x),s=o.store.getFieldValue(u,x),I=this.getFieldPolicy(n.typename,T,!1),O=I&&I.read;if(O){var D=d3(this,u,n,o,o.store.getStorage(Jn(u)?u.__ref:u,x));return sM.withValue(this.cache,O,[s,D])}return s}}},t.prototype.getReadFunction=function(n,o){var u=this.getFieldPolicy(n,o,!1);return u&&u.read},t.prototype.getMergeFunction=function(n,o,u){var d=this.getFieldPolicy(n,o,!1),g=d&&d.merge;return!g&&u&&(d=this.getTypePolicy(u),g=d&&d.merge),g},t.prototype.runMergeFunction=function(n,o,u,d,g){var x=u.field,T=u.typename,s=u.merge;return s===u3?cz(d.store)(n,o):s===h3?o:(d.overwrite&&(n=void 0),s(n,o,d3(this,void 0,{typename:T,fieldName:x.name.value,field:x,variables:d.variables},d,g||Object.create(null))))},t}();function d3(t,n,o,u,d){var g=t.getStoreFieldName(o),x=Uu(g),T=o.variables||u.variables,s=u.store,I=s.toReference,O=s.canRead;return{args:hT(o),field:o.field||null,fieldName:x,storeFieldName:g,variables:T,isReference:Jn,toReference:I,storage:d,cache:t.cache,canRead:O,readField:function(){return t.readField(cM(arguments,n,T),u)},mergeObjects:cz(u.store)}}function cM(t,n,o){var u=t[0],d=t[1],g=t.length,x;return typeof u=="string"?x={fieldName:u,from:g>1?d:n}:(x=ct({},u),To.call(x,"from")||(x.from=n)),globalThis.__DEV__!==!1&&x.from===void 0&&globalThis.__DEV__!==!1&&kr.warn(7,l5(Array.from(t))),x.variables===void 0&&(x.variables=o),x}function cz(t){return function(o,u){if(Zi(o)||Zi(u))throw ys(8);if(Hi(o)&&Hi(u)){var d=t.getFieldValue(o,"__typename"),g=t.getFieldValue(u,"__typename"),x=d&&g&&d!==g;if(x)return u;if(Jn(o)&&Of(u))return t.merge(o.__ref,u),o;if(Of(o)&&Jn(u))return t.merge(o,u.__ref),u;if(Of(o)&&Of(u))return ct(ct({},o),u)}return u}}function gE(t,n,o){var u="".concat(n).concat(o),d=t.flavors.get(u);return d||t.flavors.set(u,d=t.clientOnly===n&&t.deferred===o?t:ct(ct({},t),{clientOnly:n,deferred:o})),d}var J9=function(){function t(n,o,u){this.cache=n,this.reader=o,this.fragments=u}return t.prototype.writeToStore=function(n,o){var u=this,d=o.query,g=o.result,x=o.dataId,T=o.variables,s=o.overwrite,I=J_(d),O=$9();T=ct(ct({},XC(I)),T);var D=ct(ct({store:n,written:Object.create(null),merge:function(j,G){return O.merge(j,G)},variables:T,varString:Au(T)},iz(d,this.fragments)),{overwrite:!!s,incomingById:new Map,clientOnly:!1,deferred:!1,flavors:new Map}),N=this.processSelectionSet({result:g||Object.create(null),dataId:x,selectionSet:I.selectionSet,mergeTree:{map:new Map},context:D});if(!Jn(N))throw ys(11,g);return D.incomingById.forEach(function(j,G){var X=j.storeObject,te=j.mergeTree,H=j.fieldNodeSet,U=Zf(G);if(te&&te.map.size){var q=u.applyMerges(te,U,X,D);if(Jn(q))return;X=q}if(globalThis.__DEV__!==!1&&!D.overwrite){var J=Object.create(null);H.forEach(function(Me){Me.selectionSet&&(J[Me.name.value]=!0)});var pe=function(Me){return J[Uu(Me)]===!0},ue=function(Me){var Se=te&&te.map.get(Me);return!!(Se&&Se.info&&Se.info.merge)};Object.keys(X).forEach(function(Me){pe(Me)&&!ue(Me)&&eG(U,X,Me,D.store)})}n.merge(G,X)}),n.retain(N.__ref),N},t.prototype.processSelectionSet=function(n){var o=this,u=n.dataId,d=n.result,g=n.selectionSet,x=n.context,T=n.mergeTree,s=this.cache.policies,I=Object.create(null),O=u&&s.rootTypenamesById[u]||eT(d,g,x.fragmentMap)||u&&x.store.get(u,"__typename");typeof O=="string"&&(I.__typename=O);var D=function(){var q=cM(arguments,I,x.variables);if(Jn(q.from)){var J=x.incomingById.get(q.from.__ref);if(J){var pe=s.readField(ct(ct({},q),{from:J.storeObject}),x);if(pe!==void 0)return pe}}return s.readField(q,x)},N=new Set;this.flattenFields(g,d,x,O).forEach(function(q,J){var pe,ue=Fu(J),Me=d[ue];if(N.add(J),Me!==void 0){var Se=s.getStoreFieldName({typename:O,fieldName:J.name.value,field:J,variables:q.variables}),ge=f3(T,Se),se=o.processFieldValue(Me,J,J.selectionSet?gE(q,!1,!1):q,ge),Ie=void 0;J.selectionSet&&(Jn(se)||Of(se))&&(Ie=D("__typename",se));var We=s.getMergeFunction(O,J.name.value,Ie);We?ge.info={field:J,typename:O,merge:We}:p3(T,Se),I=q.merge(I,(pe={},pe[Se]=se,pe))}else globalThis.__DEV__!==!1&&!q.clientOnly&&!q.deferred&&!JC.added(J)&&!s.getReadFunction(O,J.name.value)&&globalThis.__DEV__!==!1&&kr.error(12,Fu(J),d)});try{var j=s.identify(d,{typename:O,selectionSet:g,fragmentMap:x.fragmentMap,storeObject:I,readField:D}),G=j[0],X=j[1];u=u||G,X&&(I=x.merge(I,X))}catch(q){if(!u)throw q}if(typeof u=="string"){var te=Zf(u),H=x.written[u]||(x.written[u]=[]);if(H.indexOf(g)>=0||(H.push(g),this.reader&&this.reader.isFresh(d,te,g,x)))return te;var U=x.incomingById.get(u);return U?(U.storeObject=x.merge(U.storeObject,I),U.mergeTree=dT(U.mergeTree,T),N.forEach(function(q){return U.fieldNodeSet.add(q)})):x.incomingById.set(u,{storeObject:I,mergeTree:Tx(T)?void 0:T,fieldNodeSet:N}),te}return I},t.prototype.processFieldValue=function(n,o,u,d){var g=this;return!o.selectionSet||n===null?globalThis.__DEV__!==!1?H5(n):n:Zi(n)?n.map(function(x,T){var s=g.processFieldValue(x,o,u,f3(d,T));return p3(d,T),s}):this.processSelectionSet({result:n,selectionSet:o.selectionSet,context:u,mergeTree:d})},t.prototype.flattenFields=function(n,o,u,d){d===void 0&&(d=eT(o,n,u.fragmentMap));var g=new Map,x=this.cache.policies,T=new wp(!1);return function s(I,O){var D=T.lookup(I,O.clientOnly,O.deferred);D.visited||(D.visited=!0,I.selections.forEach(function(N){if(Q_(N,u.variables)){var j=O.clientOnly,G=O.deferred;if(!(j&&G)&&Pa(N.directives)&&N.directives.forEach(function(H){var U=H.name.value;if(U==="client"&&(j=!0),U==="defer"){var q=u1(H,u.variables);(!q||q.if!==!1)&&(G=!0)}}),Bu(N)){var X=g.get(N);X&&(j=j&&X.clientOnly,G=G&&X.deferred),g.set(N,gE(u,j,G))}else{var te=c1(N,u.lookupFragment);if(!te&&N.kind===xr.FRAGMENT_SPREAD)throw ys(13,N.name.value);te&&x.fragmentMatches(te,d,o,u.variables)&&s(te.selectionSet,gE(u,j,G))}}}))}(n,u),g},t.prototype.applyMerges=function(n,o,u,d,g){var x,T=this;if(n.map.size&&!Jn(u)){var s=!Zi(u)&&(Jn(o)||Of(o))?o:void 0,I=u;s&&!g&&(g=[Jn(s)?s.__ref:s]);var O,D=function(N,j){return Zi(N)?typeof j=="number"?N[j]:void 0:d.store.getFieldValue(N,String(j))};n.map.forEach(function(N,j){var G=D(s,j),X=D(I,j);if(X!==void 0){g&&g.push(j);var te=T.applyMerges(N,G,X,d,g);te!==X&&(O=O||new Map,O.set(j,te)),g&&kr(g.pop()===j)}}),O&&(u=Zi(I)?I.slice(0):ct({},I),O.forEach(function(N,j){u[j]=N}))}return n.info?this.cache.policies.runMergeFunction(o,u,n.info,d,g&&(x=d.store).getStorage.apply(x,g)):u},t}(),uz=[];function f3(t,n){var o=t.map;return o.has(n)||o.set(n,uz.pop()||{map:new Map}),o.get(n)}function dT(t,n){if(t===n||!n||Tx(n))return t;if(!t||Tx(t))return n;var o=t.info&&n.info?ct(ct({},t.info),n.info):t.info||n.info,u=t.map.size&&n.map.size,d=u?new Map:t.map.size?t.map:n.map,g={info:o,map:d};if(u){var x=new Set(n.map.keys());t.map.forEach(function(T,s){g.map.set(s,dT(T,n.map.get(s))),x.delete(s)}),x.forEach(function(T){g.map.set(T,dT(n.map.get(T),t.map.get(T)))})}return g}function Tx(t){return!t||!(t.info||t.map.size)}function p3(t,n){var o=t.map,u=o.get(n);u&&Tx(u)&&(uz.push(u),o.delete(n))}var m3=new Set;function eG(t,n,o,u){var d=function(D){var N=u.getFieldValue(D,o);return typeof N=="object"&&N},g=d(t);if(g){var x=d(n);if(x&&!Jn(g)&&!li(g,x)&&!Object.keys(g).every(function(D){return u.getFieldValue(x,D)!==void 0})){var T=u.getFieldValue(t,"__typename")||u.getFieldValue(n,"__typename"),s=Uu(o),I="".concat(T,".").concat(s);if(!m3.has(I)){m3.add(I);var O=[];!Zi(g)&&!Zi(x)&&[g,x].forEach(function(D){var N=u.getFieldValue(D,"__typename");typeof N=="string"&&!O.includes(N)&&O.push(N)}),globalThis.__DEV__!==!1&&kr.warn(14,s,T,O.length?"either ensure all objects of type "+O.join(" and ")+" have an ID or a custom merge function, or ":"",I,g,x)}}}}var hz=function(t){jl(n,t);function n(o){o===void 0&&(o={});var u=t.call(this)||this;return u.watches=new Set,u.addTypenameTransform=new j5(JC),u.assumeImmutableResults=!0,u.makeVar=X9,u.txCount=0,u.config=B9(o),u.addTypename=!!u.config.addTypename,u.policies=new K9({cache:u,dataIdFromObject:u.config.dataIdFromObject,possibleTypes:u.config.possibleTypes,typePolicies:u.config.typePolicies}),u.init(),u}return n.prototype.init=function(){var o=this.data=new w_.Root({policies:this.policies,resultCaching:this.config.resultCaching});this.optimisticData=o.stump,this.resetResultCache()},n.prototype.resetResultCache=function(o){var u=this,d=this.storeReader,g=this.config.fragments;this.storeWriter=new J9(this,this.storeReader=new q9({cache:this,addTypename:this.addTypename,resultCacheMaxSize:this.config.resultCacheMaxSize,canonizeResults:rz(this.config),canon:o?void 0:d&&d.canon,fragments:g}),g),this.maybeBroadcastWatch=x_(function(x,T){return u.broadcastWatch(x,T)},{max:this.config.resultCacheMaxSize||Fl["inMemoryCache.maybeBroadcastWatch"]||5e3,makeCacheKey:function(x){var T=x.optimistic?u.optimisticData:u.data;if(i_(T)){var s=x.optimistic,I=x.id,O=x.variables;return T.makeCacheKey(x.query,x.callback,Au({optimistic:s,id:I,variables:O}))}}}),new Set([this.data.group,this.optimisticData.group]).forEach(function(x){return x.resetCaching()})},n.prototype.restore=function(o){return this.init(),o&&this.data.replace(o),this},n.prototype.extract=function(o){return o===void 0&&(o=!1),(o?this.optimisticData:this.data).extract()},n.prototype.read=function(o){var u=o.returnPartialData,d=u===void 0?!1:u;try{return this.storeReader.diffQueryAgainstStore(ct(ct({},o),{store:o.optimistic?this.optimisticData:this.data,config:this.config,returnPartialData:d})).result||null}catch(g){if(g instanceof J5)return null;throw g}},n.prototype.write=function(o){try{return++this.txCount,this.storeWriter.writeToStore(this.data,o)}finally{!--this.txCount&&o.broadcast!==!1&&this.broadcastWatches()}},n.prototype.modify=function(o){if(To.call(o,"id")&&!o.id)return!1;var u=o.optimistic?this.optimisticData:this.data;try{return++this.txCount,u.modify(o.id||"ROOT_QUERY",o.fields)}finally{!--this.txCount&&o.broadcast!==!1&&this.broadcastWatches()}},n.prototype.diff=function(o){return this.storeReader.diffQueryAgainstStore(ct(ct({},o),{store:o.optimistic?this.optimisticData:this.data,rootId:o.id||"ROOT_QUERY",config:this.config}))},n.prototype.watch=function(o){var u=this;return this.watches.size||Z9(this),this.watches.add(o),o.immediate&&this.maybeBroadcastWatch(o),function(){u.watches.delete(o)&&!u.watches.size&&o3(u),u.maybeBroadcastWatch.forget(o)}},n.prototype.gc=function(o){var u;Au.reset(),p1.reset(),this.addTypenameTransform.resetCache(),(u=this.config.fragments)===null||u===void 0||u.resetCaches();var d=this.optimisticData.gc();return o&&!this.txCount&&(o.resetResultCache?this.resetResultCache(o.resetResultIdentities):o.resetResultIdentities&&this.storeReader.resetCanon()),d},n.prototype.retain=function(o,u){return(u?this.optimisticData:this.data).retain(o)},n.prototype.release=function(o,u){return(u?this.optimisticData:this.data).release(o)},n.prototype.identify=function(o){if(Jn(o))return o.__ref;try{return this.policies.identify(o)[0]}catch(u){globalThis.__DEV__!==!1&&kr.warn(u)}},n.prototype.evict=function(o){if(!o.id){if(To.call(o,"id"))return!1;o=ct(ct({},o),{id:"ROOT_QUERY"})}try{return++this.txCount,this.optimisticData.evict(o,this.data)}finally{!--this.txCount&&o.broadcast!==!1&&this.broadcastWatches()}},n.prototype.reset=function(o){var u=this;return this.init(),Au.reset(),o&&o.discardWatches?(this.watches.forEach(function(d){return u.maybeBroadcastWatch.forget(d)}),this.watches.clear(),o3(this)):this.broadcastWatches(),Promise.resolve()},n.prototype.removeOptimistic=function(o){var u=this.optimisticData.removeLayer(o);u!==this.optimisticData&&(this.optimisticData=u,this.broadcastWatches())},n.prototype.batch=function(o){var u=this,d=o.update,g=o.optimistic,x=g===void 0?!0:g,T=o.removeOptimistic,s=o.onWatchUpdated,I,O=function(N){var j=u,G=j.data,X=j.optimisticData;++u.txCount,N&&(u.data=u.optimisticData=N);try{return I=d(u)}finally{--u.txCount,u.data=G,u.optimisticData=X}},D=new Set;return s&&!this.txCount&&this.broadcastWatches(ct(ct({},o),{onWatchUpdated:function(N){return D.add(N),!1}})),typeof x=="string"?this.optimisticData=this.optimisticData.addLayer(x,O):x===!1?O(this.data):O(),typeof T=="string"&&(this.optimisticData=this.optimisticData.removeLayer(T)),s&&D.size?(this.broadcastWatches(ct(ct({},o),{onWatchUpdated:function(N,j){var G=s.call(this,N,j);return G!==!1&&D.delete(N),G}})),D.size&&D.forEach(function(N){return u.maybeBroadcastWatch.dirty(N)})):this.broadcastWatches(o),I},n.prototype.performTransaction=function(o,u){return this.batch({update:o,optimistic:u||u!==null})},n.prototype.transformDocument=function(o){return this.addTypenameToDocument(this.addFragmentsToDocument(o))},n.prototype.broadcastWatches=function(o){var u=this;this.txCount||this.watches.forEach(function(d){return u.maybeBroadcastWatch(d,o)})},n.prototype.addFragmentsToDocument=function(o){var u=this.config.fragments;return u?u.transform(o):o},n.prototype.addTypenameToDocument=function(o){return this.addTypename?this.addTypenameTransform.transformDocument(o):o},n.prototype.broadcastWatch=function(o,u){var d=o.lastDiff,g=this.diff(o);u&&(o.optimistic&&typeof u.optimistic=="string"&&(g.fromOptimisticTransaction=!0),u.onWatchUpdated&&u.onWatchUpdated.call(this,o,g,d)===!1)||(!d||!li(d.result,g.result))&&o.callback(o.lastDiff=g,d)},n}(K5);globalThis.__DEV__!==!1&&(hz.prototype.getMemoryInternals=JU);var Ln;(function(t){t[t.loading=1]="loading",t[t.setVariables=2]="setVariables",t[t.fetchMore=3]="fetchMore",t[t.refetch=4]="refetch",t[t.poll=6]="poll",t[t.ready=7]="ready",t[t.error=8]="error"})(Ln||(Ln={}));function E_(t){return t?t<7:!1}function tG(t,n,o,u){var d=n.data,g=ka(n,["data"]),x=o.data,T=ka(o,["data"]);return li(g,T)&&tx(ey(t).selectionSet,d,x,{fragmentMap:l1(h1(t)),variables:u})}function tx(t,n,o,u){if(n===o)return!0;var d=new Set;return t.selections.every(function(g){if(d.has(g)||(d.add(g),!Q_(g,u.variables))||g3(g))return!0;if(Bu(g)){var x=Fu(g),T=n&&n[x],s=o&&o[x],I=g.selectionSet;if(!I)return li(T,s);var O=Array.isArray(T),D=Array.isArray(s);if(O!==D)return!1;if(O&&D){var N=T.length;if(s.length!==N)return!1;for(var j=0;j<N;++j)if(!tx(I,T[j],s[j],u))return!1;return!0}return tx(I,T,s,u)}else{var G=c1(g,u.fragmentMap);if(G)return g3(G)?!0:tx(G.selectionSet,n,o,u)}})}function g3(t){return!!t.directives&&t.directives.some(rG)}function rG(t){return t.name.value==="nonreactive"}var _3=Object.assign,nG=Object.hasOwnProperty,fT=function(t){jl(n,t);function n(o){var u=o.queryManager,d=o.queryInfo,g=o.options,x=t.call(this,function(te){try{var H=te._subscription._observer;H&&!H.error&&(H.error=iG)}catch{}var U=!x.observers.size;x.observers.add(te);var q=x.last;return q&&q.error?te.error&&te.error(q.error):q&&q.result&&te.next&&te.next(q.result),U&&x.reobserve().catch(function(){}),function(){x.observers.delete(te)&&!x.observers.size&&x.tearDownQuery()}})||this;x.observers=new Set,x.subscriptions=new Set,x.queryInfo=d,x.queryManager=u,x.waitForOwnResult=_E(g.fetchPolicy),x.isTornDown=!1;var T=u.defaultOptions.watchQuery,s=T===void 0?{}:T,I=s.fetchPolicy,O=I===void 0?"cache-first":I,D=g.fetchPolicy,N=D===void 0?O:D,j=g.initialFetchPolicy,G=j===void 0?N==="standby"?O:N:j;x.options=ct(ct({},g),{initialFetchPolicy:G,fetchPolicy:N}),x.queryId=d.queryId||u.generateQueryId();var X=J_(x.query);return x.queryName=X&&X.name&&X.name.value,x}return Object.defineProperty(n.prototype,"query",{get:function(){return this.lastQuery||this.options.query},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"variables",{get:function(){return this.options.variables},enumerable:!1,configurable:!0}),n.prototype.result=function(){var o=this;return new Promise(function(u,d){var g={next:function(T){u(T),o.observers.delete(g),o.observers.size||o.queryManager.removeQuery(o.queryId),setTimeout(function(){x.unsubscribe()},0)},error:d},x=o.subscribe(g)})},n.prototype.resetDiff=function(){this.queryInfo.resetDiff()},n.prototype.getCurrentResult=function(o){o===void 0&&(o=!0);var u=this.getLastResult(!0),d=this.queryInfo.networkStatus||u&&u.networkStatus||Ln.ready,g=ct(ct({},u),{loading:E_(d),networkStatus:d}),x=this.options.fetchPolicy,T=x===void 0?"cache-first":x;if(!(_E(T)||this.queryManager.getDocumentInfo(this.query).hasForcedResolvers))if(this.waitForOwnResult)this.queryInfo.updateWatch();else{var s=this.queryInfo.getDiff();(s.complete||this.options.returnPartialData)&&(g.data=s.result),li(g.data,{})&&(g.data=void 0),s.complete?(delete g.partial,s.complete&&g.networkStatus===Ln.loading&&(T==="cache-first"||T==="cache-only")&&(g.networkStatus=Ln.ready,g.loading=!1)):g.partial=!0,globalThis.__DEV__!==!1&&!s.complete&&!this.options.partialRefetch&&!g.loading&&!g.data&&!g.error&&fz(s.missing)}return o&&this.updateLastResult(g),g},n.prototype.isDifferentFromLastResult=function(o,u){if(!this.last)return!0;var d=this.queryManager.getDocumentInfo(this.query).hasNonreactiveDirective?!tG(this.query,this.last.result,o,this.variables):!li(this.last.result,o);return d||u&&!li(this.last.variables,u)},n.prototype.getLast=function(o,u){var d=this.last;if(d&&d[o]&&(!u||li(d.variables,this.variables)))return d[o]},n.prototype.getLastResult=function(o){return this.getLast("result",o)},n.prototype.getLastError=function(o){return this.getLast("error",o)},n.prototype.resetLastResults=function(){delete this.last,this.isTornDown=!1},n.prototype.resetQueryStoreErrors=function(){this.queryManager.resetErrors(this.queryId)},n.prototype.refetch=function(o){var u,d={pollInterval:0},g=this.options.fetchPolicy;if(g==="cache-and-network"?d.fetchPolicy=g:g==="no-cache"?d.fetchPolicy="no-cache":d.fetchPolicy="network-only",globalThis.__DEV__!==!1&&o&&nG.call(o,"variables")){var x=M5(this.query),T=x.variableDefinitions;(!T||!T.some(function(s){return s.variable.name.value==="variables"}))&&globalThis.__DEV__!==!1&&kr.warn(20,o,((u=x.name)===null||u===void 0?void 0:u.value)||x)}return o&&!li(this.options.variables,o)&&(d.variables=this.options.variables=ct(ct({},this.options.variables),o)),this.queryInfo.resetLastWrite(),this.reobserve(d,Ln.refetch)},n.prototype.fetchMore=function(o){var u=this,d=ct(ct({},o.query?o:ct(ct(ct(ct({},this.options),{query:this.options.query}),o),{variables:ct(ct({},this.options.variables),o.variables)})),{fetchPolicy:"no-cache"});d.query=this.transformDocument(d.query);var g=this.queryManager.generateQueryId();this.lastQuery=o.query?this.transformDocument(this.options.query):d.query;var x=this.queryInfo,T=x.networkStatus;x.networkStatus=Ln.fetchMore,d.notifyOnNetworkStatusChange&&this.observe();var s=new Set;return this.queryManager.fetchQuery(g,d,Ln.fetchMore).then(function(I){return u.queryManager.removeQuery(g),x.networkStatus===Ln.fetchMore&&(x.networkStatus=T),u.queryManager.cache.batch({update:function(O){var D=o.updateQuery;D?O.updateQuery({query:u.query,variables:u.variables,returnPartialData:!0,optimistic:!1},function(N){return D(N,{fetchMoreResult:I.data,variables:d.variables})}):O.writeQuery({query:d.query,variables:d.variables,data:I.data})},onWatchUpdated:function(O){s.add(O.query)}}),I}).finally(function(){s.has(u.query)||dz(u)})},n.prototype.subscribeToMore=function(o){var u=this,d=this.queryManager.startGraphQLSubscription({query:o.document,variables:o.variables,context:o.context}).subscribe({next:function(g){var x=o.updateQuery;x&&u.updateQuery(function(T,s){var I=s.variables;return x(T,{subscriptionData:g,variables:I})})},error:function(g){if(o.onError){o.onError(g);return}globalThis.__DEV__!==!1&&kr.error(21,g)}});return this.subscriptions.add(d),function(){u.subscriptions.delete(d)&&d.unsubscribe()}},n.prototype.setOptions=function(o){return this.reobserve(o)},n.prototype.silentSetOptions=function(o){var u=nd(this.options,o||{});_3(this.options,u)},n.prototype.setVariables=function(o){return li(this.variables,o)?this.observers.size?this.result():Promise.resolve():(this.options.variables=o,this.observers.size?this.reobserve({fetchPolicy:this.options.initialFetchPolicy,variables:o},Ln.setVariables):Promise.resolve())},n.prototype.updateQuery=function(o){var u=this.queryManager,d=u.cache.diff({query:this.options.query,variables:this.variables,returnPartialData:!0,optimistic:!1}).result,g=o(d,{variables:this.variables});g&&(u.cache.writeQuery({query:this.options.query,data:g,variables:this.variables}),u.broadcastQueries())},n.prototype.startPolling=function(o){this.options.pollInterval=o,this.updatePolling()},n.prototype.stopPolling=function(){this.options.pollInterval=0,this.updatePolling()},n.prototype.applyNextFetchPolicy=function(o,u){if(u.nextFetchPolicy){var d=u.fetchPolicy,g=d===void 0?"cache-first":d,x=u.initialFetchPolicy,T=x===void 0?g:x;g==="standby"||(typeof u.nextFetchPolicy=="function"?u.fetchPolicy=u.nextFetchPolicy(g,{reason:o,options:u,observable:this,initialFetchPolicy:T}):o==="variables-changed"?u.fetchPolicy=T:u.fetchPolicy=u.nextFetchPolicy)}return u.fetchPolicy},n.prototype.fetch=function(o,u,d){return this.queryManager.setObservableQuery(this),this.queryManager.fetchConcastWithInfo(this.queryId,o,u,d)},n.prototype.updatePolling=function(){var o=this;if(!this.queryManager.ssrMode){var u=this,d=u.pollingInfo,g=u.options.pollInterval;if(!g){d&&(clearTimeout(d.timeout),delete this.pollingInfo);return}if(!(d&&d.interval===g)){kr(g,22);var x=d||(this.pollingInfo={});x.interval=g;var T=function(){var I,O;o.pollingInfo&&(!E_(o.queryInfo.networkStatus)&&!(!((O=(I=o.options).skipPollAttempt)===null||O===void 0)&&O.call(I))?o.reobserve({fetchPolicy:o.options.initialFetchPolicy==="no-cache"?"no-cache":"network-only"},Ln.poll).then(s,s):s())},s=function(){var I=o.pollingInfo;I&&(clearTimeout(I.timeout),I.timeout=setTimeout(T,I.interval))};s()}}},n.prototype.updateLastResult=function(o,u){u===void 0&&(u=this.variables);var d=this.getLastError();return d&&this.last&&!li(u,this.last.variables)&&(d=void 0),this.last=ct({result:this.queryManager.assumeImmutableResults?o:H5(o),variables:u},d?{error:d}:null)},n.prototype.reobserveAsConcast=function(o,u){var d=this;this.isTornDown=!1;var g=u===Ln.refetch||u===Ln.fetchMore||u===Ln.poll,x=this.options.variables,T=this.options.fetchPolicy,s=nd(this.options,o||{}),I=g?s:_3(this.options,s),O=this.transformDocument(I.query);this.lastQuery=O,g||(this.updatePolling(),o&&o.variables&&!li(o.variables,x)&&I.fetchPolicy!=="standby"&&I.fetchPolicy===T&&(this.applyNextFetchPolicy("variables-changed",I),u===void 0&&(u=Ln.setVariables))),this.waitForOwnResult&&(this.waitForOwnResult=_E(I.fetchPolicy));var D=function(){d.concast===G&&(d.waitForOwnResult=!1)},N=I.variables&&ct({},I.variables),j=this.fetch(I,u,O),G=j.concast,X=j.fromLink,te={next:function(H){li(d.variables,N)&&(D(),d.reportResult(H,N))},error:function(H){li(d.variables,N)&&(D(),d.reportError(H,N))}};return!g&&(X||!this.concast)&&(this.concast&&this.observer&&this.concast.removeObserver(this.observer),this.concast=G,this.observer=te),G.addObserver(te),G},n.prototype.reobserve=function(o,u){return this.reobserveAsConcast(o,u).promise},n.prototype.resubscribeAfterError=function(){for(var o=[],u=0;u<arguments.length;u++)o[u]=arguments[u];var d=this.last;this.resetLastResults();var g=this.subscribe.apply(this,o);return this.last=d,g},n.prototype.observe=function(){this.reportResult(this.getCurrentResult(!1),this.variables)},n.prototype.reportResult=function(o,u){var d=this.getLastError(),g=this.isDifferentFromLastResult(o,u);(d||!o.partial||this.options.returnPartialData)&&this.updateLastResult(o,u),(d||g)&&n_(this.observers,"next",o)},n.prototype.reportError=function(o,u){var d=ct(ct({},this.getLastResult()),{error:o,errors:o.graphQLErrors,networkStatus:Ln.error,loading:!1});this.updateLastResult(d,u),n_(this.observers,"error",this.last.error=o)},n.prototype.hasObservers=function(){return this.observers.size>0},n.prototype.tearDownQuery=function(){this.isTornDown||(this.concast&&this.observer&&(this.concast.removeObserver(this.observer),delete this.concast,delete this.observer),this.stopPolling(),this.subscriptions.forEach(function(o){return o.unsubscribe()}),this.subscriptions.clear(),this.queryManager.stopQuery(this.queryId),this.observers.clear(),this.isTornDown=!0)},n.prototype.transformDocument=function(o){return this.queryManager.transform(o)},n}(Ti);Z5(fT);function dz(t){var n=t.options,o=n.fetchPolicy,u=n.nextFetchPolicy;return o==="cache-and-network"||o==="network-only"?t.reobserve({fetchPolicy:"cache-first",nextFetchPolicy:function(d,g){return this.nextFetchPolicy=u,typeof this.nextFetchPolicy=="function"?this.nextFetchPolicy(d,g):o}}):t.reobserve()}function iG(t){globalThis.__DEV__!==!1&&kr.error(23,t.message,t.stack)}function fz(t){globalThis.__DEV__!==!1&&t&&globalThis.__DEV__!==!1&&kr.debug(24,t)}function _E(t){return t==="network-only"||t==="no-cache"||t==="standby"}var pz=function(){function t(n){var o=n.cache,u=n.client,d=n.resolvers,g=n.fragmentMatcher;this.selectionsToResolveCache=new WeakMap,this.cache=o,u&&(this.client=u),d&&this.addResolvers(d),g&&this.setFragmentMatcher(g)}return t.prototype.addResolvers=function(n){var o=this;this.resolvers=this.resolvers||{},Array.isArray(n)?n.forEach(function(u){o.resolvers=jD(o.resolvers,u)}):this.resolvers=jD(this.resolvers,n)},t.prototype.setResolvers=function(n){this.resolvers={},this.addResolvers(n)},t.prototype.getResolvers=function(){return this.resolvers||{}},t.prototype.runResolvers=function(n){var o=n.document,u=n.remoteResult,d=n.context,g=n.variables,x=n.onlyRunForcedResolvers,T=x===void 0?!1:x;return yu(this,void 0,void 0,function(){return vu(this,function(s){return o?[2,this.resolveDocument(o,u.data,d,g,this.fragmentMatcher,T).then(function(I){return ct(ct({},u),{data:I.result})})]:[2,u]})})},t.prototype.setFragmentMatcher=function(n){this.fragmentMatcher=n},t.prototype.getFragmentMatcher=function(){return this.fragmentMatcher},t.prototype.clientQuery=function(n){return y_(["client"],n)&&this.resolvers?n:null},t.prototype.serverQuery=function(n){return V5(n)},t.prototype.prepareContext=function(n){var o=this.cache;return ct(ct({},n),{cache:o,getCacheKey:function(u){return o.identify(u)}})},t.prototype.addExportedVariables=function(n,o,u){return o===void 0&&(o={}),u===void 0&&(u={}),yu(this,void 0,void 0,function(){return vu(this,function(d){return n?[2,this.resolveDocument(n,this.buildRootValueFromCache(n,o)||{},this.prepareContext(u),o).then(function(g){return ct(ct({},o),g.exportedVariables)})]:[2,ct({},o)]})})},t.prototype.shouldForceResolvers=function(n){var o=!1;return Ec(n,{Directive:{enter:function(u){if(u.name.value==="client"&&u.arguments&&(o=u.arguments.some(function(d){return d.name.value==="always"&&d.value.kind==="BooleanValue"&&d.value.value===!0}),o))return qC}}}),o},t.prototype.buildRootValueFromCache=function(n,o){return this.cache.diff({query:BV(n),variables:o,returnPartialData:!0,optimistic:!1}).result},t.prototype.resolveDocument=function(n,o,u,d,g,x){return u===void 0&&(u={}),d===void 0&&(d={}),g===void 0&&(g=function(){return!0}),x===void 0&&(x=!1),yu(this,void 0,void 0,function(){var T,s,I,O,D,N,j,G,X,te,H;return vu(this,function(U){return T=ey(n),s=h1(n),I=l1(s),O=this.collectSelectionsToResolve(T,I),D=T.operation,N=D?D.charAt(0).toUpperCase()+D.slice(1):"Query",j=this,G=j.cache,X=j.client,te={fragmentMap:I,context:ct(ct({},u),{cache:G,client:X}),variables:d,fragmentMatcher:g,defaultOperationType:N,exportedVariables:{},selectionsToResolve:O,onlyRunForcedResolvers:x},H=!1,[2,this.resolveSelectionSet(T.selectionSet,H,o,te).then(function(q){return{result:q,exportedVariables:te.exportedVariables}})]})})},t.prototype.resolveSelectionSet=function(n,o,u,d){return yu(this,void 0,void 0,function(){var g,x,T,s,I,O=this;return vu(this,function(D){return g=d.fragmentMap,x=d.context,T=d.variables,s=[u],I=function(N){return yu(O,void 0,void 0,function(){var j,G;return vu(this,function(X){return!o&&!d.selectionsToResolve.has(N)?[2]:Q_(N,T)?Bu(N)?[2,this.resolveField(N,o,u,d).then(function(te){var H;typeof te<"u"&&s.push((H={},H[Fu(N)]=te,H))})]:(vV(N)?j=N:(j=g[N.name.value],kr(j,18,N.name.value)),j&&j.typeCondition&&(G=j.typeCondition.name.value,d.fragmentMatcher(u,G,x))?[2,this.resolveSelectionSet(j.selectionSet,o,u,d).then(function(te){s.push(te)})]:[2]):[2]})})},[2,Promise.all(n.selections.map(I)).then(function(){return eM(s)})]})})},t.prototype.resolveField=function(n,o,u,d){return yu(this,void 0,void 0,function(){var g,x,T,s,I,O,D,N,j,G=this;return vu(this,function(X){return u?(g=d.variables,x=n.name.value,T=Fu(n),s=x!==T,I=u[T]||u[x],O=Promise.resolve(I),(!d.onlyRunForcedResolvers||this.shouldForceResolvers(n))&&(D=u.__typename||d.defaultOperationType,N=this.resolvers&&this.resolvers[D],N&&(j=N[s?x:T],j&&(O=Promise.resolve(sM.withValue(this.cache,j,[u,u1(n,g),d.context,{field:n,fragmentMap:d.fragmentMap}]))))),[2,O.then(function(te){var H,U;if(te===void 0&&(te=I),n.directives&&n.directives.forEach(function(J){J.name.value==="export"&&J.arguments&&J.arguments.forEach(function(pe){pe.name.value==="as"&&pe.value.kind==="StringValue"&&(d.exportedVariables[pe.value.value]=te)})}),!n.selectionSet||te==null)return te;var q=(U=(H=n.directives)===null||H===void 0?void 0:H.some(function(J){return J.name.value==="client"}))!==null&&U!==void 0?U:!1;if(Array.isArray(te))return G.resolveSubSelectedArray(n,o||q,te,d);if(n.selectionSet)return G.resolveSelectionSet(n.selectionSet,o||q,te,d)})]):[2,null]})})},t.prototype.resolveSubSelectedArray=function(n,o,u,d){var g=this;return Promise.all(u.map(function(x){if(x===null)return null;if(Array.isArray(x))return g.resolveSubSelectedArray(n,o,x,d);if(n.selectionSet)return g.resolveSelectionSet(n.selectionSet,o,x,d)}))},t.prototype.collectSelectionsToResolve=function(n,o){var u=function(x){return!Array.isArray(x)},d=this.selectionsToResolveCache;function g(x){if(!d.has(x)){var T=new Set;d.set(x,T),Ec(x,{Directive:function(s,I,O,D,N){s.name.value==="client"&&N.forEach(function(j){u(j)&&kD(j)&&T.add(j)})},FragmentSpread:function(s,I,O,D,N){var j=o[s.name.value];kr(j,19,s.name.value);var G=g(j);G.size>0&&(N.forEach(function(X){u(X)&&kD(X)&&T.add(X)}),T.add(s),G.forEach(function(X){T.add(X)}))}})}return d.get(x)}return g(n)},t}(),Df=new(fd?WeakMap:Map);function yE(t,n){var o=t[n];typeof o=="function"&&(t[n]=function(){return Df.set(t,(Df.get(t)+1)%1e15),o.apply(this,arguments)})}function y3(t){t.notifyTimeout&&(clearTimeout(t.notifyTimeout),t.notifyTimeout=void 0)}var vE=function(){function t(n,o){o===void 0&&(o=n.generateQueryId()),this.queryId=o,this.listeners=new Set,this.document=null,this.lastRequestId=1,this.stopped=!1,this.dirty=!1,this.observableQuery=null;var u=this.cache=n.cache;Df.has(u)||(Df.set(u,0),yE(u,"evict"),yE(u,"modify"),yE(u,"reset"))}return t.prototype.init=function(n){var o=n.networkStatus||Ln.loading;return this.variables&&this.networkStatus!==Ln.loading&&!li(this.variables,n.variables)&&(o=Ln.setVariables),li(n.variables,this.variables)||(this.lastDiff=void 0),Object.assign(this,{document:n.document,variables:n.variables,networkError:null,graphQLErrors:this.graphQLErrors||[],networkStatus:o}),n.observableQuery&&this.setObservableQuery(n.observableQuery),n.lastRequestId&&(this.lastRequestId=n.lastRequestId),this},t.prototype.reset=function(){y3(this),this.dirty=!1},t.prototype.resetDiff=function(){this.lastDiff=void 0},t.prototype.getDiff=function(){var n=this.getDiffOptions();if(this.lastDiff&&li(n,this.lastDiff.options))return this.lastDiff.diff;this.updateWatch(this.variables);var o=this.observableQuery;if(o&&o.options.fetchPolicy==="no-cache")return{complete:!1};var u=this.cache.diff(n);return this.updateLastDiff(u,n),u},t.prototype.updateLastDiff=function(n,o){this.lastDiff=n?{diff:n,options:o||this.getDiffOptions()}:void 0},t.prototype.getDiffOptions=function(n){var o;return n===void 0&&(n=this.variables),{query:this.document,variables:n,returnPartialData:!0,optimistic:!0,canonizeResults:(o=this.observableQuery)===null||o===void 0?void 0:o.options.canonizeResults}},t.prototype.setDiff=function(n){var o=this,u,d=this.lastDiff&&this.lastDiff.diff;n&&!n.complete&&!(!((u=this.observableQuery)===null||u===void 0)&&u.options.returnPartialData)&&!(d&&d.complete)||(this.updateLastDiff(n),!this.dirty&&!li(d&&d.result,n&&n.result)&&(this.dirty=!0,this.notifyTimeout||(this.notifyTimeout=setTimeout(function(){return o.notify()},0))))},t.prototype.setObservableQuery=function(n){var o=this;n!==this.observableQuery&&(this.oqListener&&this.listeners.delete(this.oqListener),this.observableQuery=n,n?(n.queryInfo=this,this.listeners.add(this.oqListener=function(){var u=o.getDiff();u.fromOptimisticTransaction?n.observe():dz(n)})):delete this.oqListener)},t.prototype.notify=function(){var n=this;y3(this),this.shouldNotify()&&this.listeners.forEach(function(o){return o(n)}),this.dirty=!1},t.prototype.shouldNotify=function(){if(!this.dirty||!this.listeners.size)return!1;if(E_(this.networkStatus)&&this.observableQuery){var n=this.observableQuery.options.fetchPolicy;if(n!=="cache-only"&&n!=="cache-and-network")return!1}return!0},t.prototype.stop=function(){if(!this.stopped){this.stopped=!0,this.reset(),this.cancel(),this.cancel=t.prototype.cancel;var n=this.observableQuery;n&&n.stopPolling()}},t.prototype.cancel=function(){},t.prototype.updateWatch=function(n){var o=this;n===void 0&&(n=this.variables);var u=this.observableQuery;if(!(u&&u.options.fetchPolicy==="no-cache")){var d=ct(ct({},this.getDiffOptions(n)),{watcher:this,callback:function(g){return o.setDiff(g)}});(!this.lastWatch||!li(d,this.lastWatch))&&(this.cancel(),this.cancel=this.cache.watch(this.lastWatch=d))}},t.prototype.resetLastWrite=function(){this.lastWrite=void 0},t.prototype.shouldWrite=function(n,o){var u=this.lastWrite;return!(u&&u.dmCount===Df.get(this.cache)&&li(o,u.variables)&&li(n.data,u.result.data))},t.prototype.markResult=function(n,o,u,d){var g=this,x=new $u,T=Pa(n.errors)?n.errors.slice(0):[];if(this.reset(),"incremental"in n&&Pa(n.incremental)){var s=X5(this.getDiff().result,n);n.data=s}else if("hasNext"in n&&n.hasNext){var I=this.getDiff();n.data=x.merge(I.result,n.data)}this.graphQLErrors=T,u.fetchPolicy==="no-cache"?this.updateLastDiff({result:n.data,complete:!0},this.getDiffOptions(u.variables)):d!==0&&(pT(n,u.errorPolicy)?this.cache.performTransaction(function(O){if(g.shouldWrite(n,u.variables))O.writeQuery({query:o,data:n.data,variables:u.variables,overwrite:d===1}),g.lastWrite={result:n,variables:u.variables,dmCount:Df.get(g.cache)};else if(g.lastDiff&&g.lastDiff.diff.complete){n.data=g.lastDiff.diff.result;return}var D=g.getDiffOptions(u.variables),N=O.diff(D);!g.stopped&&li(g.variables,u.variables)&&g.updateWatch(u.variables),g.updateLastDiff(N,D),N.complete&&(n.data=N.result)}):this.lastWrite=void 0)},t.prototype.markReady=function(){return this.networkError=null,this.networkStatus=Ln.ready},t.prototype.markError=function(n){return this.networkStatus=Ln.error,this.lastWrite=void 0,this.reset(),n.graphQLErrors&&(this.graphQLErrors=n.graphQLErrors),n.networkError&&(this.networkError=n.networkError),n},t}();function pT(t,n){n===void 0&&(n="none");var o=n==="ignore"||n==="all",u=!K0(t);return!u&&o&&t.data&&(u=!0),u}var oG=Object.prototype.hasOwnProperty,v3=Object.create(null),sG=function(){function t(n){var o=n.cache,u=n.link,d=n.defaultOptions,g=n.documentTransform,x=n.queryDeduplication,T=x===void 0?!1:x,s=n.onBroadcast,I=n.ssrMode,O=I===void 0?!1:I,D=n.clientAwareness,N=D===void 0?{}:D,j=n.localState,G=n.assumeImmutableResults,X=G===void 0?!!o.assumeImmutableResults:G,te=n.defaultContext,H=this;this.clientAwareness={},this.queries=new Map,this.fetchCancelFns=new Map,this.transformCache=new HC(Fl["queryManager.getDocumentInfo"]||2e3),this.queryIdCounter=1,this.requestIdCounter=1,this.mutationIdCounter=1,this.inFlightLinkObservables=new wp(!1);var U=new j5(function(q){return H.cache.transformDocument(q)},{cache:!1});this.cache=o,this.link=u,this.defaultOptions=d||Object.create(null),this.queryDeduplication=T,this.clientAwareness=N,this.localState=j||new pz({cache:o}),this.ssrMode=O,this.assumeImmutableResults=X,this.documentTransform=g?U.concat(g).concat(U):U,this.defaultContext=te||Object.create(null),(this.onBroadcast=s)&&(this.mutationStore=Object.create(null))}return t.prototype.stop=function(){var n=this;this.queries.forEach(function(o,u){n.stopQueryNoBroadcast(u)}),this.cancelPendingFetches(ys(25))},t.prototype.cancelPendingFetches=function(n){this.fetchCancelFns.forEach(function(o){return o(n)}),this.fetchCancelFns.clear()},t.prototype.mutate=function(n){var o,u,d=n.mutation,g=n.variables,x=n.optimisticResponse,T=n.updateQueries,s=n.refetchQueries,I=s===void 0?[]:s,O=n.awaitRefetchQueries,D=O===void 0?!1:O,N=n.update,j=n.onQueryUpdated,G=n.fetchPolicy,X=G===void 0?((o=this.defaultOptions.mutate)===null||o===void 0?void 0:o.fetchPolicy)||"network-only":G,te=n.errorPolicy,H=te===void 0?((u=this.defaultOptions.mutate)===null||u===void 0?void 0:u.errorPolicy)||"none":te,U=n.keepRootFields,q=n.context;return yu(this,void 0,void 0,function(){var J,pe,ue,Me,Se;return vu(this,function(ge){switch(ge.label){case 0:return kr(d,26),kr(X==="network-only"||X==="no-cache",27),J=this.generateMutationId(),d=this.cache.transformForLink(this.transform(d)),pe=this.getDocumentInfo(d).hasClientExports,g=this.getVariables(d,g),pe?[4,this.localState.addExportedVariables(d,g,q)]:[3,2];case 1:g=ge.sent(),ge.label=2;case 2:return ue=this.mutationStore&&(this.mutationStore[J]={mutation:d,variables:g,loading:!0,error:null}),Me=x&&this.markMutationOptimistic(x,{mutationId:J,document:d,variables:g,fetchPolicy:X,errorPolicy:H,context:q,updateQueries:T,update:N,keepRootFields:U}),this.broadcastQueries(),Se=this,[2,new Promise(function(se,Ie){return dE(Se.getObservableFromLink(d,ct(ct({},q),{optimisticResponse:Me?x:void 0}),g,!1),function(We){if(K0(We)&&H==="none")throw new bu({graphQLErrors:oT(We)});ue&&(ue.loading=!1,ue.error=null);var ze=ct({},We);return typeof I=="function"&&(I=I(ze)),H==="ignore"&&K0(ze)&&delete ze.errors,Se.markMutationResult({mutationId:J,result:ze,document:d,variables:g,fetchPolicy:X,errorPolicy:H,context:q,update:N,updateQueries:T,awaitRefetchQueries:D,refetchQueries:I,removeOptimistic:Me?J:void 0,onQueryUpdated:j,keepRootFields:U})}).subscribe({next:function(We){Se.broadcastQueries(),(!("hasNext"in We)||We.hasNext===!1)&&se(We)},error:function(We){ue&&(ue.loading=!1,ue.error=We),Me&&Se.cache.removeOptimistic(J),Se.broadcastQueries(),Ie(We instanceof bu?We:new bu({networkError:We}))}})})]}})})},t.prototype.markMutationResult=function(n,o){var u=this;o===void 0&&(o=this.cache);var d=n.result,g=[],x=n.fetchPolicy==="no-cache";if(!x&&pT(d,n.errorPolicy)){if(Xf(d)||g.push({result:d.data,dataId:"ROOT_MUTATION",query:n.document,variables:n.variables}),Xf(d)&&Pa(d.incremental)){var T=o.diff({id:"ROOT_MUTATION",query:this.getDocumentInfo(n.document).asQuery,variables:n.variables,optimistic:!1,returnPartialData:!0}),s=void 0;T.result&&(s=X5(T.result,d)),typeof s<"u"&&(d.data=s,g.push({result:s,dataId:"ROOT_MUTATION",query:n.document,variables:n.variables}))}var I=n.updateQueries;I&&this.queries.forEach(function(D,N){var j=D.observableQuery,G=j&&j.queryName;if(!(!G||!oG.call(I,G))){var X=I[G],te=u.queries.get(N),H=te.document,U=te.variables,q=o.diff({query:H,variables:U,returnPartialData:!0,optimistic:!1}),J=q.result,pe=q.complete;if(pe&&J){var ue=X(J,{mutationResult:d,queryName:H&&tT(H)||void 0,queryVariables:U});ue&&g.push({result:ue,dataId:"ROOT_QUERY",query:H,variables:U})}}})}if(g.length>0||(n.refetchQueries||"").length>0||n.update||n.onQueryUpdated||n.removeOptimistic){var O=[];if(this.refetchQueries({updateCache:function(D){x||g.forEach(function(X){return D.write(X)});var N=n.update,j=!e9(d)||Xf(d)&&!d.hasNext;if(N){if(!x){var G=D.diff({id:"ROOT_MUTATION",query:u.getDocumentInfo(n.document).asQuery,variables:n.variables,optimistic:!1,returnPartialData:!0});G.complete&&(d=ct(ct({},d),{data:G.result}),"incremental"in d&&delete d.incremental,"hasNext"in d&&delete d.hasNext)}j&&N(D,d,{context:n.context,variables:n.variables})}!x&&!n.keepRootFields&&j&&D.modify({id:"ROOT_MUTATION",fields:function(X,te){var H=te.fieldName,U=te.DELETE;return H==="__typename"?X:U}})},include:n.refetchQueries,optimistic:!1,removeOptimistic:n.removeOptimistic,onQueryUpdated:n.onQueryUpdated||null}).forEach(function(D){return O.push(D)}),n.awaitRefetchQueries||n.onQueryUpdated)return Promise.all(O).then(function(){return d})}return Promise.resolve(d)},t.prototype.markMutationOptimistic=function(n,o){var u=this,d=typeof n=="function"?n(o.variables,{IGNORE:v3}):n;return d===v3?!1:(this.cache.recordOptimisticTransaction(function(g){try{u.markMutationResult(ct(ct({},o),{result:{data:d}}),g)}catch(x){globalThis.__DEV__!==!1&&kr.error(x)}},o.mutationId),!0)},t.prototype.fetchQuery=function(n,o,u){return this.fetchConcastWithInfo(n,o,u).concast.promise},t.prototype.getQueryStore=function(){var n=Object.create(null);return this.queries.forEach(function(o,u){n[u]={variables:o.variables,networkStatus:o.networkStatus,networkError:o.networkError,graphQLErrors:o.graphQLErrors}}),n},t.prototype.resetErrors=function(n){var o=this.queries.get(n);o&&(o.networkError=void 0,o.graphQLErrors=[])},t.prototype.transform=function(n){return this.documentTransform.transformDocument(n)},t.prototype.getDocumentInfo=function(n){var o=this.transformCache;if(!o.has(n)){var u={hasClientExports:DU(n),hasForcedResolvers:this.localState.shouldForceResolvers(n),hasNonreactiveDirective:y_(["nonreactive"],n),clientQuery:this.localState.clientQuery(n),serverQuery:U5([{name:"client",remove:!0},{name:"connection"},{name:"nonreactive"}],n),defaultVars:XC(J_(n)),asQuery:ct(ct({},n),{definitions:n.definitions.map(function(d){return d.kind==="OperationDefinition"&&d.operation!=="query"?ct(ct({},d),{operation:"query"}):d})})};o.set(n,u)}return o.get(n)},t.prototype.getVariables=function(n,o){return ct(ct({},this.getDocumentInfo(n).defaultVars),o)},t.prototype.watchQuery=function(n){var o=this.transform(n.query);n=ct(ct({},n),{variables:this.getVariables(o,n.variables)}),typeof n.notifyOnNetworkStatusChange>"u"&&(n.notifyOnNetworkStatusChange=!1);var u=new vE(this),d=new fT({queryManager:this,queryInfo:u,options:n});return d.lastQuery=o,this.queries.set(d.queryId,u),u.init({document:o,observableQuery:d,variables:d.variables}),d},t.prototype.query=function(n,o){var u=this;return o===void 0&&(o=this.generateQueryId()),kr(n.query,28),kr(n.query.kind==="Document",29),kr(!n.returnPartialData,30),kr(!n.pollInterval,31),this.fetchQuery(o,ct(ct({},n),{query:this.transform(n.query)})).finally(function(){return u.stopQuery(o)})},t.prototype.generateQueryId=function(){return String(this.queryIdCounter++)},t.prototype.generateRequestId=function(){return this.requestIdCounter++},t.prototype.generateMutationId=function(){return String(this.mutationIdCounter++)},t.prototype.stopQueryInStore=function(n){this.stopQueryInStoreNoBroadcast(n),this.broadcastQueries()},t.prototype.stopQueryInStoreNoBroadcast=function(n){var o=this.queries.get(n);o&&o.stop()},t.prototype.clearStore=function(n){return n===void 0&&(n={discardWatches:!0}),this.cancelPendingFetches(ys(32)),this.queries.forEach(function(o){o.observableQuery?o.networkStatus=Ln.loading:o.stop()}),this.mutationStore&&(this.mutationStore=Object.create(null)),this.cache.reset(n)},t.prototype.getObservableQueries=function(n){var o=this;n===void 0&&(n="active");var u=new Map,d=new Map,g=new Set;return Array.isArray(n)&&n.forEach(function(x){typeof x=="string"?d.set(x,!1):aV(x)?d.set(o.transform(x),!1):Hi(x)&&x.query&&g.add(x)}),this.queries.forEach(function(x,T){var s=x.observableQuery,I=x.document;if(s){if(n==="all"){u.set(T,s);return}var O=s.queryName,D=s.options.fetchPolicy;if(D==="standby"||n==="active"&&!s.hasObservers())return;(n==="active"||O&&d.has(O)||I&&d.has(I))&&(u.set(T,s),O&&d.set(O,!0),I&&d.set(I,!0))}}),g.size&&g.forEach(function(x){var T=WS("legacyOneTimeQuery"),s=o.getQuery(T).init({document:x.query,variables:x.variables}),I=new fT({queryManager:o,queryInfo:s,options:ct(ct({},x),{fetchPolicy:"network-only"})});kr(I.queryId===T),s.setObservableQuery(I),u.set(T,I)}),globalThis.__DEV__!==!1&&d.size&&d.forEach(function(x,T){x||globalThis.__DEV__!==!1&&kr.warn(typeof T=="string"?33:34,T)}),u},t.prototype.reFetchObservableQueries=function(n){var o=this;n===void 0&&(n=!1);var u=[];return this.getObservableQueries(n?"all":"active").forEach(function(d,g){var x=d.options.fetchPolicy;d.resetLastResults(),(n||x!=="standby"&&x!=="cache-only")&&u.push(d.refetch()),o.getQuery(g).setDiff(null)}),this.broadcastQueries(),Promise.all(u)},t.prototype.setObservableQuery=function(n){this.getQuery(n.queryId).setObservableQuery(n)},t.prototype.startGraphQLSubscription=function(n){var o=this,u=n.query,d=n.fetchPolicy,g=n.errorPolicy,x=g===void 0?"none":g,T=n.variables,s=n.context,I=s===void 0?{}:s;u=this.transform(u),T=this.getVariables(u,T);var O=function(N){return o.getObservableFromLink(u,I,N).map(function(j){d!=="no-cache"&&(pT(j,x)&&o.cache.write({query:u,result:j.data,dataId:"ROOT_SUBSCRIPTION",variables:N}),o.broadcastQueries());var G=K0(j),X=g9(j);if(G||X){var te={};if(G&&(te.graphQLErrors=j.errors),X&&(te.protocolErrors=j.extensions[oM]),x==="none"||X)throw new bu(te)}return x==="ignore"&&delete j.errors,j})};if(this.getDocumentInfo(u).hasClientExports){var D=this.localState.addExportedVariables(u,T,I).then(O);return new Ti(function(N){var j=null;return D.then(function(G){return j=G.subscribe(N)},N.error),function(){return j&&j.unsubscribe()}})}return O(T)},t.prototype.stopQuery=function(n){this.stopQueryNoBroadcast(n),this.broadcastQueries()},t.prototype.stopQueryNoBroadcast=function(n){this.stopQueryInStoreNoBroadcast(n),this.removeQuery(n)},t.prototype.removeQuery=function(n){this.fetchCancelFns.delete(n),this.queries.has(n)&&(this.getQuery(n).stop(),this.queries.delete(n))},t.prototype.broadcastQueries=function(){this.onBroadcast&&this.onBroadcast(),this.queries.forEach(function(n){return n.notify()})},t.prototype.getLocalState=function(){return this.localState},t.prototype.getObservableFromLink=function(n,o,u,d){var g=this,x;d===void 0&&(d=(x=o==null?void 0:o.queryDeduplication)!==null&&x!==void 0?x:this.queryDeduplication);var T,s=this.getDocumentInfo(n),I=s.serverQuery,O=s.clientQuery;if(I){var D=this,N=D.inFlightLinkObservables,j=D.link,G={query:I,variables:u,operationName:tT(I)||void 0,context:this.prepareContext(ct(ct({},o),{forceFetch:!d}))};if(o=G.context,d){var X=p1(I),te=Au(u),H=N.lookup(X,te);if(T=H.observable,!T){var U=new Af([sT(j,G)]);T=H.observable=U,U.beforeNext(function(){N.remove(X,te)})}}else T=new Af([sT(j,G)])}else T=new Af([Ti.of({data:{}})]),o=this.prepareContext(o);return O&&(T=dE(T,function(q){return g.localState.runResolvers({document:O,remoteResult:q,context:o,variables:u})})),T},t.prototype.getResultsFromLink=function(n,o,u){var d=n.lastRequestId=this.generateRequestId(),g=this.cache.transformForLink(u.query);return dE(this.getObservableFromLink(g,u.context,u.variables),function(x){var T=oT(x),s=T.length>0;if(d>=n.lastRequestId){if(s&&u.errorPolicy==="none")throw n.markError(new bu({graphQLErrors:T}));n.markResult(x,g,u,o),n.markReady()}var I={data:x.data,loading:!1,networkStatus:Ln.ready};return s&&u.errorPolicy!=="ignore"&&(I.errors=T,I.networkStatus=Ln.error),I},function(x){var T=_9(x)?x:new bu({networkError:x});throw d>=n.lastRequestId&&n.markError(T),T})},t.prototype.fetchConcastWithInfo=function(n,o,u,d){var g=this;u===void 0&&(u=Ln.loading),d===void 0&&(d=o.query);var x=this.getVariables(d,o.variables),T=this.getQuery(n),s=this.defaultOptions.watchQuery,I=o.fetchPolicy,O=I===void 0?s&&s.fetchPolicy||"cache-first":I,D=o.errorPolicy,N=D===void 0?s&&s.errorPolicy||"none":D,j=o.returnPartialData,G=j===void 0?!1:j,X=o.notifyOnNetworkStatusChange,te=X===void 0?!1:X,H=o.context,U=H===void 0?{}:H,q=Object.assign({},o,{query:d,variables:x,fetchPolicy:O,errorPolicy:N,returnPartialData:G,notifyOnNetworkStatusChange:te,context:U}),J=function(ge){q.variables=ge;var se=g.fetchQueryByPolicy(T,q,u);return q.fetchPolicy!=="standby"&&se.sources.length>0&&T.observableQuery&&T.observableQuery.applyNextFetchPolicy("after-fetch",o),se},pe=function(){return g.fetchCancelFns.delete(n)};this.fetchCancelFns.set(n,function(ge){pe(),setTimeout(function(){return ue.cancel(ge)})});var ue,Me;if(this.getDocumentInfo(q.query).hasClientExports)ue=new Af(this.localState.addExportedVariables(q.query,q.variables,q.context).then(J).then(function(ge){return ge.sources})),Me=!0;else{var Se=J(q.variables);Me=Se.fromLink,ue=new Af(Se.sources)}return ue.promise.then(pe,pe),{concast:ue,fromLink:Me}},t.prototype.refetchQueries=function(n){var o=this,u=n.updateCache,d=n.include,g=n.optimistic,x=g===void 0?!1:g,T=n.removeOptimistic,s=T===void 0?x?WS("refetchQueries"):void 0:T,I=n.onQueryUpdated,O=new Map;d&&this.getObservableQueries(d).forEach(function(N,j){O.set(j,{oq:N,lastDiff:o.getQuery(j).getDiff()})});var D=new Map;return u&&this.cache.batch({update:u,optimistic:x&&s||!1,removeOptimistic:s,onWatchUpdated:function(N,j,G){var X=N.watcher instanceof vE&&N.watcher.observableQuery;if(X){if(I){O.delete(X.queryId);var te=I(X,j,G);return te===!0&&(te=X.refetch()),te!==!1&&D.set(X,te),te}I!==null&&O.set(X.queryId,{oq:X,lastDiff:G,diff:j})}}}),O.size&&O.forEach(function(N,j){var G=N.oq,X=N.lastDiff,te=N.diff,H;if(I){if(!te){var U=G.queryInfo;U.reset(),te=U.getDiff()}H=I(G,te,X)}(!I||H===!0)&&(H=G.refetch()),H!==!1&&D.set(G,H),j.indexOf("legacyOneTimeQuery")>=0&&o.stopQueryNoBroadcast(j)}),s&&this.cache.removeOptimistic(s),D},t.prototype.fetchQueryByPolicy=function(n,o,u){var d=this,g=o.query,x=o.variables,T=o.fetchPolicy,s=o.refetchWritePolicy,I=o.errorPolicy,O=o.returnPartialData,D=o.context,N=o.notifyOnNetworkStatusChange,j=n.networkStatus;n.init({document:g,variables:x,networkStatus:u});var G=function(){return n.getDiff()},X=function(J,pe){pe===void 0&&(pe=n.networkStatus||Ln.loading);var ue=J.result;globalThis.__DEV__!==!1&&!O&&!li(ue,{})&&fz(J.missing);var Me=function(Se){return Ti.of(ct({data:Se,loading:E_(pe),networkStatus:pe},J.complete?null:{partial:!0}))};return ue&&d.getDocumentInfo(g).hasForcedResolvers?d.localState.runResolvers({document:g,remoteResult:{data:ue},context:D,variables:x,onlyRunForcedResolvers:!0}).then(function(Se){return Me(Se.data||void 0)}):I==="none"&&pe===Ln.refetch&&Array.isArray(J.missing)?Me(void 0):Me(ue)},te=T==="no-cache"?0:u===Ln.refetch&&s!=="merge"?1:2,H=function(){return d.getResultsFromLink(n,te,{query:g,variables:x,context:D,fetchPolicy:T,errorPolicy:I})},U=N&&typeof j=="number"&&j!==u&&E_(u);switch(T){default:case"cache-first":{var q=G();return q.complete?{fromLink:!1,sources:[X(q,n.markReady())]}:O||U?{fromLink:!0,sources:[X(q),H()]}:{fromLink:!0,sources:[H()]}}case"cache-and-network":{var q=G();return q.complete||O||U?{fromLink:!0,sources:[X(q),H()]}:{fromLink:!0,sources:[H()]}}case"cache-only":return{fromLink:!1,sources:[X(G(),n.markReady())]};case"network-only":return U?{fromLink:!0,sources:[X(G()),H()]}:{fromLink:!0,sources:[H()]};case"no-cache":return U?{fromLink:!0,sources:[X(n.getDiff()),H()]}:{fromLink:!0,sources:[H()]};case"standby":return{fromLink:!1,sources:[]}}},t.prototype.getQuery=function(n){return n&&!this.queries.has(n)&&this.queries.set(n,new vE(this,n)),this.queries.get(n)},t.prototype.prepareContext=function(n){n===void 0&&(n={});var o=this.localState.prepareContext(n);return ct(ct(ct({},this.defaultContext),o),{clientAwareness:this.clientAwareness})},t}(),x3=!1,mz=function(){function t(n){var o=this;if(this.resetStoreCallbacks=[],this.clearStoreCallbacks=[],!n.cache)throw ys(15);var u=n.uri,d=n.credentials,g=n.headers,x=n.cache,T=n.documentTransform,s=n.ssrMode,I=s===void 0?!1:s,O=n.ssrForceFetchDelay,D=O===void 0?0:O,N=n.connectToDevTools,j=N===void 0?typeof window=="object"&&!window.__APOLLO_CLIENT__&&globalThis.__DEV__!==!1:N,G=n.queryDeduplication,X=G===void 0?!0:G,te=n.defaultOptions,H=n.defaultContext,U=n.assumeImmutableResults,q=U===void 0?x.assumeImmutableResults:U,J=n.resolvers,pe=n.typeDefs,ue=n.fragmentMatcher,Me=n.name,Se=n.version,ge=n.link;ge||(ge=u?new R9({uri:u,credentials:d,headers:g}):ty.empty()),this.link=ge,this.cache=x,this.disableNetworkFetches=I||D>0,this.queryDeduplication=X,this.defaultOptions=te||Object.create(null),this.typeDefs=pe,D&&setTimeout(function(){return o.disableNetworkFetches=!1},D),this.watchQuery=this.watchQuery.bind(this),this.query=this.query.bind(this),this.mutate=this.mutate.bind(this),this.resetStore=this.resetStore.bind(this),this.reFetchObservableQueries=this.reFetchObservableQueries.bind(this),this.version=jC,this.localState=new pz({cache:x,client:this,resolvers:J,fragmentMatcher:ue}),this.queryManager=new sG({cache:this.cache,link:this.link,defaultOptions:this.defaultOptions,defaultContext:H,documentTransform:T,queryDeduplication:X,ssrMode:I,clientAwareness:{name:Me,version:Se},localState:this.localState,assumeImmutableResults:q,onBroadcast:j?function(){o.devToolsHookCb&&o.devToolsHookCb({action:{},state:{queries:o.queryManager.getQueryStore(),mutations:o.queryManager.mutationStore||{}},dataWithOptimisticResults:o.cache.extract(!0)})}:void 0}),j&&this.connectToDevTools()}return t.prototype.connectToDevTools=function(){if(typeof window=="object"){var n=window,o=Symbol.for("apollo.devtools");(n[o]=n[o]||[]).push(this),n.__APOLLO_CLIENT__=this}!x3&&globalThis.__DEV__!==!1&&(x3=!0,setTimeout(function(){if(typeof window<"u"&&window.document&&window.top===window.self&&!window.__APOLLO_DEVTOOLS_GLOBAL_HOOK__){var u=window.navigator,d=u&&u.userAgent,g=void 0;typeof d=="string"&&(d.indexOf("Chrome/")>-1?g="https://chrome.google.com/webstore/detail/apollo-client-developer-t/jdkknkkbebbapilgoeccciglkfbmbnfm":d.indexOf("Firefox/")>-1&&(g="https://addons.mozilla.org/en-US/firefox/addon/apollo-developer-tools/")),g&&globalThis.__DEV__!==!1&&kr.log("Download the Apollo DevTools for a better development experience: %s",g)}},1e4))},Object.defineProperty(t.prototype,"documentTransform",{get:function(){return this.queryManager.documentTransform},enumerable:!1,configurable:!0}),t.prototype.stop=function(){this.queryManager.stop()},t.prototype.watchQuery=function(n){return this.defaultOptions.watchQuery&&(n=J0(this.defaultOptions.watchQuery,n)),this.disableNetworkFetches&&(n.fetchPolicy==="network-only"||n.fetchPolicy==="cache-and-network")&&(n=ct(ct({},n),{fetchPolicy:"cache-first"})),this.queryManager.watchQuery(n)},t.prototype.query=function(n){return this.defaultOptions.query&&(n=J0(this.defaultOptions.query,n)),kr(n.fetchPolicy!=="cache-and-network",16),this.disableNetworkFetches&&n.fetchPolicy==="network-only"&&(n=ct(ct({},n),{fetchPolicy:"cache-first"})),this.queryManager.query(n)},t.prototype.mutate=function(n){return this.defaultOptions.mutate&&(n=J0(this.defaultOptions.mutate,n)),this.queryManager.mutate(n)},t.prototype.subscribe=function(n){return this.queryManager.startGraphQLSubscription(n)},t.prototype.readQuery=function(n,o){return o===void 0&&(o=!1),this.cache.readQuery(n,o)},t.prototype.readFragment=function(n,o){return o===void 0&&(o=!1),this.cache.readFragment(n,o)},t.prototype.writeQuery=function(n){var o=this.cache.writeQuery(n);return n.broadcast!==!1&&this.queryManager.broadcastQueries(),o},t.prototype.writeFragment=function(n){var o=this.cache.writeFragment(n);return n.broadcast!==!1&&this.queryManager.broadcastQueries(),o},t.prototype.__actionHookForDevTools=function(n){this.devToolsHookCb=n},t.prototype.__requestRaw=function(n){return sT(this.link,n)},t.prototype.resetStore=function(){var n=this;return Promise.resolve().then(function(){return n.queryManager.clearStore({discardWatches:!1})}).then(function(){return Promise.all(n.resetStoreCallbacks.map(function(o){return o()}))}).then(function(){return n.reFetchObservableQueries()})},t.prototype.clearStore=function(){var n=this;return Promise.resolve().then(function(){return n.queryManager.clearStore({discardWatches:!0})}).then(function(){return Promise.all(n.clearStoreCallbacks.map(function(o){return o()}))})},t.prototype.onResetStore=function(n){var o=this;return this.resetStoreCallbacks.push(n),function(){o.resetStoreCallbacks=o.resetStoreCallbacks.filter(function(u){return u!==n})}},t.prototype.onClearStore=function(n){var o=this;return this.clearStoreCallbacks.push(n),function(){o.clearStoreCallbacks=o.clearStoreCallbacks.filter(function(u){return u!==n})}},t.prototype.reFetchObservableQueries=function(n){return this.queryManager.reFetchObservableQueries(n)},t.prototype.refetchQueries=function(n){var o=this.queryManager.refetchQueries(n),u=[],d=[];o.forEach(function(x,T){u.push(T),d.push(x)});var g=Promise.all(d);return g.queries=u,g.results=d,g.catch(function(x){globalThis.__DEV__!==!1&&kr.debug(17,x)}),g},t.prototype.getObservableQueries=function(n){return n===void 0&&(n="active"),this.queryManager.getObservableQueries(n)},t.prototype.extract=function(n){return this.cache.extract(n)},t.prototype.restore=function(n){return this.cache.restore(n)},t.prototype.addResolvers=function(n){this.localState.addResolvers(n)},t.prototype.setResolvers=function(n){this.localState.setResolvers(n)},t.prototype.getResolvers=function(){return this.localState.getResolvers()},t.prototype.setLocalStateFragmentMatcher=function(n){this.localState.setFragmentMatcher(n)},t.prototype.setLink=function(n){this.link=this.queryManager.link=n},Object.defineProperty(t.prototype,"defaultContext",{get:function(){return this.queryManager.defaultContext},enumerable:!1,configurable:!0}),t}();globalThis.__DEV__!==!1&&(mz.prototype.getMemoryInternals=KU);var rx=new Map,mT=new Map,gz=!0,Cx=!1;function _z(t){return t.replace(/[\s,]+/g," ").trim()}function aG(t){return _z(t.source.body.substring(t.start,t.end))}function lG(t){var n=new Set,o=[];return t.definitions.forEach(function(u){if(u.kind==="FragmentDefinition"){var d=u.name.value,g=aG(u.loc),x=mT.get(d);x&&!x.has(g)?gz&&console.warn("Warning: fragment with name "+d+` already exists.
graphql-tag enforces all fragment names across your application to be unique; read more about
this in the docs: http://dev.apollodata.com/core/fragments.html#unique-names`):x||mT.set(d,x=new Set),x.add(g),n.has(g)||(n.add(g),o.push(u))}else o.push(u)}),ct(ct({},t),{definitions:o})}function cG(t){var n=new Set(t.definitions);n.forEach(function(u){u.loc&&delete u.loc,Object.keys(u).forEach(function(d){var g=u[d];g&&typeof g=="object"&&n.add(g)})});var o=t.loc;return o&&(delete o.startToken,delete o.endToken),t}function uG(t){var n=_z(t);if(!rx.has(n)){var o=EU(t,{experimentalFragmentVariables:Cx,allowLegacyFragmentVariables:Cx});if(!o||o.kind!=="Document")throw new Error("Not a valid GraphQL document.");rx.set(n,cG(lG(o)))}return rx.get(n)}function Sc(t){for(var n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];typeof t=="string"&&(t=[t]);var u=t[0];return n.forEach(function(d,g){d&&d.kind==="Document"?u+=d.loc.source.body:u+=d,u+=t[g+1]}),uG(u)}function hG(){rx.clear(),mT.clear()}function dG(){gz=!1}function fG(){Cx=!0}function pG(){Cx=!1}var og={gql:Sc,resetCaches:hG,disableFragmentWarnings:dG,enableExperimentalFragmentVariables:fG,disableExperimentalFragmentVariables:pG};(function(t){t.gql=og.gql,t.resetCaches=og.resetCaches,t.disableFragmentWarnings=og.disableFragmentWarnings,t.enableExperimentalFragmentVariables=og.enableExperimentalFragmentVariables,t.disableExperimentalFragmentVariables=og.disableExperimentalFragmentVariables})(Sc||(Sc={}));Sc.default=Sc;var $o=W;const mG=vp($o),yz=RC({__proto__:null,default:mG},[$o]);var b3=WC?Symbol.for("__APOLLO_CONTEXT__"):"__APOLLO_CONTEXT__";function uM(){kr("createContext"in yz,45);var t=$o.createContext[b3];return t||(Object.defineProperty($o.createContext,b3,{value:t=$o.createContext({}),enumerable:!1,writable:!1,configurable:!0}),t.displayName="ApolloContext"),t}var gG=function(t){var n=t.client,o=t.children,u=uM(),d=$o.useContext(u),g=$o.useMemo(function(){return ct(ct({},d),{client:n||d.client})},[d,n]);return kr(g.client,46),$o.createElement(u.Provider,{value:g},o)};function hM(t){var n=$o.useContext(uM()),o=t||n.client;return kr(!!o,49),o}var w3=!1,_G="useSyncExternalStore",yG=yz[_G],vG=yG||function(t,n,o){var u=n();globalThis.__DEV__!==!1&&!w3&&u!==n()&&(w3=!0,globalThis.__DEV__!==!1&&kr.error(58));var d=$o.useState({inst:{value:u,getSnapshot:n}}),g=d[0].inst,x=d[1];return UU?$o.useLayoutEffect(function(){Object.assign(g,{value:u,getSnapshot:n}),xE(g)&&x({inst:g})},[t,u,n]):Object.assign(g,{value:u,getSnapshot:n}),$o.useEffect(function(){return xE(g)&&x({inst:g}),t(function(){xE(g)&&x({inst:g})})},[t]),u};function xE(t){var n=t.value,o=t.getSnapshot;try{return n!==o()}catch{return!0}}var xc;(function(t){t[t.Query=0]="Query",t[t.Mutation=1]="Mutation",t[t.Subscription=2]="Subscription"})(xc||(xc={}));var Hh;function E3(t){var n;switch(t){case xc.Query:n="Query";break;case xc.Mutation:n="Mutation";break;case xc.Subscription:n="Subscription";break}return n}function vz(t){Hh||(Hh=new HC(Fl.parser||1e3));var n=Hh.get(t);if(n)return n;var o,u,d;kr(!!t&&!!t.kind,59,t);for(var g=[],x=[],T=[],s=[],I=0,O=t.definitions;I<O.length;I++){var D=O[I];if(D.kind==="FragmentDefinition"){g.push(D);continue}if(D.kind==="OperationDefinition")switch(D.operation){case"query":x.push(D);break;case"mutation":T.push(D);break;case"subscription":s.push(D);break}}kr(!g.length||x.length||T.length||s.length,60),kr(x.length+T.length+s.length<=1,61,t,x.length,s.length,T.length),u=x.length?xc.Query:xc.Mutation,!x.length&&!T.length&&(u=xc.Subscription);var N=x.length?x:T.length?T:s;kr(N.length===1,62,t,N.length);var j=N[0];o=j.variableDefinitions||[],j.name&&j.name.kind==="Name"?d=j.name.value:d="data";var G={name:d,type:u,variables:o};return Hh.set(t,G),G}vz.resetCache=function(){Hh=void 0};globalThis.__DEV__!==!1&&ZC("parser",function(){return Hh?Hh.size:0});function xG(t,n){var o=vz(t),u=E3(n),d=E3(o.type);kr(o.type===n,63,u,u,d)}var bG=Object.prototype.hasOwnProperty;function ry(t,n){return n===void 0&&(n=Object.create(null)),wG(hM(n.client),t).useQuery(n)}function wG(t,n){var o=$o.useRef();(!o.current||t!==o.current.client||n!==o.current.query)&&(o.current=new EG(t,n,o.current));var u=o.current;return u.forceUpdateState=$o.useReducer(function(d){return d+1},0)[1],u}var EG=function(){function t(n,o,u){var d=this;this.client=n,this.query=o,this.forceUpdate=function(){return d.forceUpdateState()},this.ssrDisabledResult=b_({loading:!0,data:void 0,error:void 0,networkStatus:Ln.loading}),this.skipStandbyResult=b_({loading:!1,data:void 0,error:void 0,networkStatus:Ln.ready}),this.toQueryResultCache=new(fd?WeakMap:Map),xG(o,xc.Query);var g=u&&u.result,x=g&&g.data;x&&(this.previousData=x)}return t.prototype.forceUpdateState=function(){globalThis.__DEV__!==!1&&kr.warn(51)},t.prototype.executeQuery=function(n){var o=this,u;n.query&&Object.assign(this,{query:n.query}),this.watchQueryOptions=this.createWatchQueryOptions(this.queryHookOptions=n);var d=this.observable.reobserveAsConcast(this.getObsQueryOptions());return this.previousData=((u=this.result)===null||u===void 0?void 0:u.data)||this.previousData,this.result=void 0,this.forceUpdate(),new Promise(function(g){var x;d.subscribe({next:function(T){x=T},error:function(){g(o.toQueryResult(o.observable.getCurrentResult()))},complete:function(){g(o.toQueryResult(x))}})})},t.prototype.useQuery=function(n){var o=this;this.renderPromises=$o.useContext(uM()).renderPromises,this.useOptions(n);var u=this.useObservableQuery(),d=vG($o.useCallback(function(g){if(o.renderPromises)return function(){};o.forceUpdate=g;var x=function(){var I=o.result,O=u.getCurrentResult();I&&I.loading===O.loading&&I.networkStatus===O.networkStatus&&li(I.data,O.data)||o.setResult(O)},T=function(I){if(s.unsubscribe(),s=u.resubscribeAfterError(x,T),!bG.call(I,"graphQLErrors"))throw I;var O=o.result;(!O||O&&O.loading||!li(I,O.error))&&o.setResult({data:O&&O.data,error:I,loading:!1,networkStatus:Ln.error})},s=u.subscribe(x,T);return function(){setTimeout(function(){return s.unsubscribe()}),o.forceUpdate=function(){return o.forceUpdateState()}}},[u,this.renderPromises,this.client.disableNetworkFetches]),function(){return o.getCurrentResult()},function(){return o.getCurrentResult()});return this.unsafeHandlePartialRefetch(d),this.toQueryResult(d)},t.prototype.useOptions=function(n){var o,u=this.createWatchQueryOptions(this.queryHookOptions=n),d=this.watchQueryOptions;li(u,d)||(this.watchQueryOptions=u,d&&this.observable&&(this.observable.reobserve(this.getObsQueryOptions()),this.previousData=((o=this.result)===null||o===void 0?void 0:o.data)||this.previousData,this.result=void 0)),this.onCompleted=n.onCompleted||t.prototype.onCompleted,this.onError=n.onError||t.prototype.onError,(this.renderPromises||this.client.disableNetworkFetches)&&this.queryHookOptions.ssr===!1&&!this.queryHookOptions.skip?this.result=this.ssrDisabledResult:this.queryHookOptions.skip||this.watchQueryOptions.fetchPolicy==="standby"?this.result=this.skipStandbyResult:(this.result===this.ssrDisabledResult||this.result===this.skipStandbyResult)&&(this.result=void 0)},t.prototype.getObsQueryOptions=function(){var n=[],o=this.client.defaultOptions.watchQuery;return o&&n.push(o),this.queryHookOptions.defaultOptions&&n.push(this.queryHookOptions.defaultOptions),n.push(nd(this.observable&&this.observable.options,this.watchQueryOptions)),n.reduce(J0)},t.prototype.createWatchQueryOptions=function(n){var o;n===void 0&&(n={});var u=n.skip;n.ssr,n.onCompleted,n.onError,n.defaultOptions;var d=ka(n,["skip","ssr","onCompleted","onError","defaultOptions"]),g=Object.assign(d,{query:this.query});if(this.renderPromises&&(g.fetchPolicy==="network-only"||g.fetchPolicy==="cache-and-network")&&(g.fetchPolicy="cache-first"),g.variables||(g.variables={}),u){var x=g.fetchPolicy,T=x===void 0?this.getDefaultFetchPolicy():x,s=g.initialFetchPolicy,I=s===void 0?T:s;Object.assign(g,{initialFetchPolicy:I,fetchPolicy:"standby"})}else g.fetchPolicy||(g.fetchPolicy=((o=this.observable)===null||o===void 0?void 0:o.options.initialFetchPolicy)||this.getDefaultFetchPolicy());return g},t.prototype.getDefaultFetchPolicy=function(){var n,o;return((n=this.queryHookOptions.defaultOptions)===null||n===void 0?void 0:n.fetchPolicy)||((o=this.client.defaultOptions.watchQuery)===null||o===void 0?void 0:o.fetchPolicy)||"cache-first"},t.prototype.onCompleted=function(n){},t.prototype.onError=function(n){},t.prototype.useObservableQuery=function(){var n=this.observable=this.renderPromises&&this.renderPromises.getSSRObservable(this.watchQueryOptions)||this.observable||this.client.watchQuery(this.getObsQueryOptions());this.obsQueryFields=$o.useMemo(function(){return{refetch:n.refetch.bind(n),reobserve:n.reobserve.bind(n),fetchMore:n.fetchMore.bind(n),updateQuery:n.updateQuery.bind(n),startPolling:n.startPolling.bind(n),stopPolling:n.stopPolling.bind(n),subscribeToMore:n.subscribeToMore.bind(n)}},[n]);var o=!(this.queryHookOptions.ssr===!1||this.queryHookOptions.skip);return this.renderPromises&&o&&(this.renderPromises.registerSSRObservable(n),n.getCurrentResult().loading&&this.renderPromises.addObservableQueryPromise(n)),n},t.prototype.setResult=function(n){var o=this.result;o&&o.data&&(this.previousData=o.data),this.result=n,this.forceUpdate(),this.handleErrorOrCompleted(n,o)},t.prototype.handleErrorOrCompleted=function(n,o){var u=this;if(!n.loading){var d=this.toApolloError(n);Promise.resolve().then(function(){d?u.onError(d):n.data&&(o==null?void 0:o.networkStatus)!==n.networkStatus&&n.networkStatus===Ln.ready&&u.onCompleted(n.data)}).catch(function(g){globalThis.__DEV__!==!1&&kr.warn(g)})}},t.prototype.toApolloError=function(n){return Pa(n.errors)?new bu({graphQLErrors:n.errors}):n.error},t.prototype.getCurrentResult=function(){return this.result||this.handleErrorOrCompleted(this.result=this.observable.getCurrentResult()),this.result},t.prototype.toQueryResult=function(n){var o=this.toQueryResultCache.get(n);if(o)return o;var u=n.data;n.partial;var d=ka(n,["data","partial"]);return this.toQueryResultCache.set(n,o=ct(ct(ct({data:u},d),this.obsQueryFields),{client:this.client,observable:this.observable,variables:this.observable.variables,called:!this.queryHookOptions.skip,previousData:this.previousData})),!o.error&&Pa(n.errors)&&(o.error=new bu({graphQLErrors:n.errors})),o},t.prototype.unsafeHandlePartialRefetch=function(n){n.partial&&this.queryHookOptions.partialRefetch&&!n.loading&&(!n.data||Object.keys(n.data).length===0)&&this.observable.options.fetchPolicy!=="cache-only"&&(Object.assign(n,{loading:!0,networkStatus:Ln.refetch}),this.observable.refetch())},t}(),xz={exports:{}},ca={},bz={exports:{}},wz={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function n(bt,rt){var Gt=bt.length;bt.push(rt);e:for(;0<Gt;){var Vt=Gt-1>>>1,Jt=bt[Vt];if(0<d(Jt,rt))bt[Vt]=rt,bt[Gt]=Jt,Gt=Vt;else break e}}function o(bt){return bt.length===0?null:bt[0]}function u(bt){if(bt.length===0)return null;var rt=bt[0],Gt=bt.pop();if(Gt!==rt){bt[0]=Gt;e:for(var Vt=0,Jt=bt.length,wr=Jt>>>1;Vt<wr;){var or=2*(Vt+1)-1,et=bt[or],At=or+1,Qt=bt[At];if(0>d(et,Gt))At<Jt&&0>d(Qt,et)?(bt[Vt]=Qt,bt[At]=Gt,Vt=At):(bt[Vt]=et,bt[or]=Gt,Vt=or);else if(At<Jt&&0>d(Qt,Gt))bt[Vt]=Qt,bt[At]=Gt,Vt=At;else break e}}return rt}function d(bt,rt){var Gt=bt.sortIndex-rt.sortIndex;return Gt!==0?Gt:bt.id-rt.id}if(typeof performance=="object"&&typeof performance.now=="function"){var g=performance;t.unstable_now=function(){return g.now()}}else{var x=Date,T=x.now();t.unstable_now=function(){return x.now()-T}}var s=[],I=[],O=1,D=null,N=3,j=!1,G=!1,X=!1,te=typeof setTimeout=="function"?setTimeout:null,H=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function q(bt){for(var rt=o(I);rt!==null;){if(rt.callback===null)u(I);else if(rt.startTime<=bt)u(I),rt.sortIndex=rt.expirationTime,n(s,rt);else break;rt=o(I)}}function J(bt){if(X=!1,q(bt),!G)if(o(s)!==null)G=!0,It(pe);else{var rt=o(I);rt!==null&&Ot(J,rt.startTime-bt)}}function pe(bt,rt){G=!1,X&&(X=!1,H(Se),Se=-1),j=!0;var Gt=N;try{for(q(rt),D=o(s);D!==null&&(!(D.expirationTime>rt)||bt&&!Ie());){var Vt=D.callback;if(typeof Vt=="function"){D.callback=null,N=D.priorityLevel;var Jt=Vt(D.expirationTime<=rt);rt=t.unstable_now(),typeof Jt=="function"?D.callback=Jt:D===o(s)&&u(s),q(rt)}else u(s);D=o(s)}if(D!==null)var wr=!0;else{var or=o(I);or!==null&&Ot(J,or.startTime-rt),wr=!1}return wr}finally{D=null,N=Gt,j=!1}}var ue=!1,Me=null,Se=-1,ge=5,se=-1;function Ie(){return!(t.unstable_now()-se<ge)}function We(){if(Me!==null){var bt=t.unstable_now();se=bt;var rt=!0;try{rt=Me(!0,bt)}finally{rt?ze():(ue=!1,Me=null)}}else ue=!1}var ze;if(typeof U=="function")ze=function(){U(We)};else if(typeof MessageChannel<"u"){var De=new MessageChannel,nt=De.port2;De.port1.onmessage=We,ze=function(){nt.postMessage(null)}}else ze=function(){te(We,0)};function It(bt){Me=bt,ue||(ue=!0,ze())}function Ot(bt,rt){Se=te(function(){bt(t.unstable_now())},rt)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(bt){bt.callback=null},t.unstable_continueExecution=function(){G||j||(G=!0,It(pe))},t.unstable_forceFrameRate=function(bt){0>bt||125<bt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ge=0<bt?Math.floor(1e3/bt):5},t.unstable_getCurrentPriorityLevel=function(){return N},t.unstable_getFirstCallbackNode=function(){return o(s)},t.unstable_next=function(bt){switch(N){case 1:case 2:case 3:var rt=3;break;default:rt=N}var Gt=N;N=rt;try{return bt()}finally{N=Gt}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(bt,rt){switch(bt){case 1:case 2:case 3:case 4:case 5:break;default:bt=3}var Gt=N;N=bt;try{return rt()}finally{N=Gt}},t.unstable_scheduleCallback=function(bt,rt,Gt){var Vt=t.unstable_now();switch(typeof Gt=="object"&&Gt!==null?(Gt=Gt.delay,Gt=typeof Gt=="number"&&0<Gt?Vt+Gt:Vt):Gt=Vt,bt){case 1:var Jt=-1;break;case 2:Jt=250;break;case 5:Jt=1073741823;break;case 4:Jt=1e4;break;default:Jt=5e3}return Jt=Gt+Jt,bt={id:O++,callback:rt,priorityLevel:bt,startTime:Gt,expirationTime:Jt,sortIndex:-1},Gt>Vt?(bt.sortIndex=Gt,n(I,bt),o(s)===null&&bt===o(I)&&(X?(H(Se),Se=-1):X=!0,Ot(J,Gt-Vt))):(bt.sortIndex=Jt,n(s,bt),G||j||(G=!0,It(pe))),bt},t.unstable_shouldYield=Ie,t.unstable_wrapCallback=function(bt){var rt=N;return function(){var Gt=N;N=rt;try{return bt.apply(this,arguments)}finally{N=Gt}}}})(wz);bz.exports=wz;var SG=bz.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ez=W,la=SG;function Kt(t){for(var n="https://reactjs.org/docs/error-decoder.html?invariant="+t,o=1;o<arguments.length;o++)n+="&args[]="+encodeURIComponent(arguments[o]);return"Minified React error #"+t+"; visit "+n+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Sz=new Set,S_={};function pd(t,n){lp(t,n),lp(t+"Capture",n)}function lp(t,n){for(S_[t]=n,t=0;t<n.length;t++)Sz.add(n[t])}var Tc=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),gT=Object.prototype.hasOwnProperty,TG=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,S3={},T3={};function CG(t){return gT.call(T3,t)?!0:gT.call(S3,t)?!1:TG.test(t)?T3[t]=!0:(S3[t]=!0,!1)}function MG(t,n,o,u){if(o!==null&&o.type===0)return!1;switch(typeof n){case"function":case"symbol":return!0;case"boolean":return u?!1:o!==null?!o.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function IG(t,n,o,u){if(n===null||typeof n>"u"||MG(t,n,o,u))return!0;if(u)return!1;if(o!==null)switch(o.type){case 3:return!n;case 4:return n===!1;case 5:return isNaN(n);case 6:return isNaN(n)||1>n}return!1}function xs(t,n,o,u,d,g,x){this.acceptsBooleans=n===2||n===3||n===4,this.attributeName=u,this.attributeNamespace=d,this.mustUseProperty=o,this.propertyName=t,this.type=n,this.sanitizeURL=g,this.removeEmptyString=x}var Vo={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Vo[t]=new xs(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var n=t[0];Vo[n]=new xs(n,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Vo[t]=new xs(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Vo[t]=new xs(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Vo[t]=new xs(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Vo[t]=new xs(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Vo[t]=new xs(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Vo[t]=new xs(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Vo[t]=new xs(t,5,!1,t.toLowerCase(),null,!1,!1)});var dM=/[\-:]([a-z])/g;function fM(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var n=t.replace(dM,fM);Vo[n]=new xs(n,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var n=t.replace(dM,fM);Vo[n]=new xs(n,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var n=t.replace(dM,fM);Vo[n]=new xs(n,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Vo[t]=new xs(t,1,!1,t.toLowerCase(),null,!1,!1)});Vo.xlinkHref=new xs("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Vo[t]=new xs(t,1,!1,t.toLowerCase(),null,!0,!0)});function pM(t,n,o,u){var d=Vo.hasOwnProperty(n)?Vo[n]:null;(d!==null?d.type!==0:u||!(2<n.length)||n[0]!=="o"&&n[0]!=="O"||n[1]!=="n"&&n[1]!=="N")&&(IG(n,o,d,u)&&(o=null),u||d===null?CG(n)&&(o===null?t.removeAttribute(n):t.setAttribute(n,""+o)):d.mustUseProperty?t[d.propertyName]=o===null?d.type===3?!1:"":o:(n=d.attributeName,u=d.attributeNamespace,o===null?t.removeAttribute(n):(d=d.type,o=d===3||d===4&&o===!0?"":""+o,u?t.setAttributeNS(u,n,o):t.setAttribute(n,o))))}var Rc=Ez.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,g0=Symbol.for("react.element"),Rf=Symbol.for("react.portal"),Lf=Symbol.for("react.fragment"),mM=Symbol.for("react.strict_mode"),_T=Symbol.for("react.profiler"),Tz=Symbol.for("react.provider"),Cz=Symbol.for("react.context"),gM=Symbol.for("react.forward_ref"),yT=Symbol.for("react.suspense"),vT=Symbol.for("react.suspense_list"),_M=Symbol.for("react.memo"),wu=Symbol.for("react.lazy"),Mz=Symbol.for("react.offscreen"),C3=Symbol.iterator;function sg(t){return t===null||typeof t!="object"?null:(t=C3&&t[C3]||t["@@iterator"],typeof t=="function"?t:null)}var Bi=Object.assign,bE;function Kg(t){if(bE===void 0)try{throw Error()}catch(o){var n=o.stack.trim().match(/\n( *(at )?)/);bE=n&&n[1]||""}return`
`+bE+t}var wE=!1;function EE(t,n){if(!t||wE)return"";wE=!0;var o=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(n)if(n=function(){throw Error()},Object.defineProperty(n.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(n,[])}catch(I){var u=I}Reflect.construct(t,[],n)}else{try{n.call()}catch(I){u=I}t.call(n.prototype)}else{try{throw Error()}catch(I){u=I}t()}}catch(I){if(I&&u&&typeof I.stack=="string"){for(var d=I.stack.split(`
`),g=u.stack.split(`
`),x=d.length-1,T=g.length-1;1<=x&&0<=T&&d[x]!==g[T];)T--;for(;1<=x&&0<=T;x--,T--)if(d[x]!==g[T]){if(x!==1||T!==1)do if(x--,T--,0>T||d[x]!==g[T]){var s=`
`+d[x].replace(" at new "," at ");return t.displayName&&s.includes("<anonymous>")&&(s=s.replace("<anonymous>",t.displayName)),s}while(1<=x&&0<=T);break}}}finally{wE=!1,Error.prepareStackTrace=o}return(t=t?t.displayName||t.name:"")?Kg(t):""}function AG(t){switch(t.tag){case 5:return Kg(t.type);case 16:return Kg("Lazy");case 13:return Kg("Suspense");case 19:return Kg("SuspenseList");case 0:case 2:case 15:return t=EE(t.type,!1),t;case 11:return t=EE(t.type.render,!1),t;case 1:return t=EE(t.type,!0),t;default:return""}}function xT(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case Lf:return"Fragment";case Rf:return"Portal";case _T:return"Profiler";case mM:return"StrictMode";case yT:return"Suspense";case vT:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case Cz:return(t.displayName||"Context")+".Consumer";case Tz:return(t._context.displayName||"Context")+".Provider";case gM:var n=t.render;return t=t.displayName,t||(t=n.displayName||n.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case _M:return n=t.displayName||null,n!==null?n:xT(t.type)||"Memo";case wu:n=t._payload,t=t._init;try{return xT(t(n))}catch{}}return null}function kG(t){var n=t.type;switch(t.tag){case 24:return"Cache";case 9:return(n.displayName||"Context")+".Consumer";case 10:return(n._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=n.render,t=t.displayName||t.name||"",n.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return n;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return xT(n);case 8:return n===mM?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n}return null}function Vu(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function Iz(t){var n=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(n==="checkbox"||n==="radio")}function PG(t){var n=Iz(t)?"checked":"value",o=Object.getOwnPropertyDescriptor(t.constructor.prototype,n),u=""+t[n];if(!t.hasOwnProperty(n)&&typeof o<"u"&&typeof o.get=="function"&&typeof o.set=="function"){var d=o.get,g=o.set;return Object.defineProperty(t,n,{configurable:!0,get:function(){return d.call(this)},set:function(x){u=""+x,g.call(this,x)}}),Object.defineProperty(t,n,{enumerable:o.enumerable}),{getValue:function(){return u},setValue:function(x){u=""+x},stopTracking:function(){t._valueTracker=null,delete t[n]}}}}function _0(t){t._valueTracker||(t._valueTracker=PG(t))}function Az(t){if(!t)return!1;var n=t._valueTracker;if(!n)return!0;var o=n.getValue(),u="";return t&&(u=Iz(t)?t.checked?"true":"false":t.value),t=u,t!==o?(n.setValue(t),!0):!1}function Mx(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function bT(t,n){var o=n.checked;return Bi({},n,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:o??t._wrapperState.initialChecked})}function M3(t,n){var o=n.defaultValue==null?"":n.defaultValue,u=n.checked!=null?n.checked:n.defaultChecked;o=Vu(n.value!=null?n.value:o),t._wrapperState={initialChecked:u,initialValue:o,controlled:n.type==="checkbox"||n.type==="radio"?n.checked!=null:n.value!=null}}function kz(t,n){n=n.checked,n!=null&&pM(t,"checked",n,!1)}function wT(t,n){kz(t,n);var o=Vu(n.value),u=n.type;if(o!=null)u==="number"?(o===0&&t.value===""||t.value!=o)&&(t.value=""+o):t.value!==""+o&&(t.value=""+o);else if(u==="submit"||u==="reset"){t.removeAttribute("value");return}n.hasOwnProperty("value")?ET(t,n.type,o):n.hasOwnProperty("defaultValue")&&ET(t,n.type,Vu(n.defaultValue)),n.checked==null&&n.defaultChecked!=null&&(t.defaultChecked=!!n.defaultChecked)}function I3(t,n,o){if(n.hasOwnProperty("value")||n.hasOwnProperty("defaultValue")){var u=n.type;if(!(u!=="submit"&&u!=="reset"||n.value!==void 0&&n.value!==null))return;n=""+t._wrapperState.initialValue,o||n===t.value||(t.value=n),t.defaultValue=n}o=t.name,o!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,o!==""&&(t.name=o)}function ET(t,n,o){(n!=="number"||Mx(t.ownerDocument)!==t)&&(o==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+o&&(t.defaultValue=""+o))}var Jg=Array.isArray;function Qf(t,n,o,u){if(t=t.options,n){n={};for(var d=0;d<o.length;d++)n["$"+o[d]]=!0;for(o=0;o<t.length;o++)d=n.hasOwnProperty("$"+t[o].value),t[o].selected!==d&&(t[o].selected=d),d&&u&&(t[o].defaultSelected=!0)}else{for(o=""+Vu(o),n=null,d=0;d<t.length;d++){if(t[d].value===o){t[d].selected=!0,u&&(t[d].defaultSelected=!0);return}n!==null||t[d].disabled||(n=t[d])}n!==null&&(n.selected=!0)}}function ST(t,n){if(n.dangerouslySetInnerHTML!=null)throw Error(Kt(91));return Bi({},n,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function A3(t,n){var o=n.value;if(o==null){if(o=n.children,n=n.defaultValue,o!=null){if(n!=null)throw Error(Kt(92));if(Jg(o)){if(1<o.length)throw Error(Kt(93));o=o[0]}n=o}n==null&&(n=""),o=n}t._wrapperState={initialValue:Vu(o)}}function Pz(t,n){var o=Vu(n.value),u=Vu(n.defaultValue);o!=null&&(o=""+o,o!==t.value&&(t.value=o),n.defaultValue==null&&t.defaultValue!==o&&(t.defaultValue=o)),u!=null&&(t.defaultValue=""+u)}function k3(t){var n=t.textContent;n===t._wrapperState.initialValue&&n!==""&&n!==null&&(t.value=n)}function Oz(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function TT(t,n){return t==null||t==="http://www.w3.org/1999/xhtml"?Oz(n):t==="http://www.w3.org/2000/svg"&&n==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var y0,Dz=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(n,o,u,d){MSApp.execUnsafeLocalFunction(function(){return t(n,o,u,d)})}:t}(function(t,n){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=n;else{for(y0=y0||document.createElement("div"),y0.innerHTML="<svg>"+n.valueOf().toString()+"</svg>",n=y0.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;n.firstChild;)t.appendChild(n.firstChild)}});function T_(t,n){if(n){var o=t.firstChild;if(o&&o===t.lastChild&&o.nodeType===3){o.nodeValue=n;return}}t.textContent=n}var s_={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},OG=["Webkit","ms","Moz","O"];Object.keys(s_).forEach(function(t){OG.forEach(function(n){n=n+t.charAt(0).toUpperCase()+t.substring(1),s_[n]=s_[t]})});function Rz(t,n,o){return n==null||typeof n=="boolean"||n===""?"":o||typeof n!="number"||n===0||s_.hasOwnProperty(t)&&s_[t]?(""+n).trim():n+"px"}function Lz(t,n){t=t.style;for(var o in n)if(n.hasOwnProperty(o)){var u=o.indexOf("--")===0,d=Rz(o,n[o],u);o==="float"&&(o="cssFloat"),u?t.setProperty(o,d):t[o]=d}}var DG=Bi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function CT(t,n){if(n){if(DG[t]&&(n.children!=null||n.dangerouslySetInnerHTML!=null))throw Error(Kt(137,t));if(n.dangerouslySetInnerHTML!=null){if(n.children!=null)throw Error(Kt(60));if(typeof n.dangerouslySetInnerHTML!="object"||!("__html"in n.dangerouslySetInnerHTML))throw Error(Kt(61))}if(n.style!=null&&typeof n.style!="object")throw Error(Kt(62))}}function MT(t,n){if(t.indexOf("-")===-1)return typeof n.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var IT=null;function yM(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var AT=null,Kf=null,Jf=null;function P3(t){if(t=oy(t)){if(typeof AT!="function")throw Error(Kt(280));var n=t.stateNode;n&&(n=v1(n),AT(t.stateNode,t.type,n))}}function zz(t){Kf?Jf?Jf.push(t):Jf=[t]:Kf=t}function Nz(){if(Kf){var t=Kf,n=Jf;if(Jf=Kf=null,P3(t),n)for(t=0;t<n.length;t++)P3(n[t])}}function Fz(t,n){return t(n)}function Bz(){}var SE=!1;function jz(t,n,o){if(SE)return t(n,o);SE=!0;try{return Fz(t,n,o)}finally{SE=!1,(Kf!==null||Jf!==null)&&(Bz(),Nz())}}function C_(t,n){var o=t.stateNode;if(o===null)return null;var u=v1(o);if(u===null)return null;o=u[n];e:switch(n){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(t=t.type,u=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!u;break e;default:t=!1}if(t)return null;if(o&&typeof o!="function")throw Error(Kt(231,n,typeof o));return o}var kT=!1;if(Tc)try{var ag={};Object.defineProperty(ag,"passive",{get:function(){kT=!0}}),window.addEventListener("test",ag,ag),window.removeEventListener("test",ag,ag)}catch{kT=!1}function RG(t,n,o,u,d,g,x,T,s){var I=Array.prototype.slice.call(arguments,3);try{n.apply(o,I)}catch(O){this.onError(O)}}var a_=!1,Ix=null,Ax=!1,PT=null,LG={onError:function(t){a_=!0,Ix=t}};function zG(t,n,o,u,d,g,x,T,s){a_=!1,Ix=null,RG.apply(LG,arguments)}function NG(t,n,o,u,d,g,x,T,s){if(zG.apply(this,arguments),a_){if(a_){var I=Ix;a_=!1,Ix=null}else throw Error(Kt(198));Ax||(Ax=!0,PT=I)}}function md(t){var n=t,o=t;if(t.alternate)for(;n.return;)n=n.return;else{t=n;do n=t,n.flags&4098&&(o=n.return),t=n.return;while(t)}return n.tag===3?o:null}function $z(t){if(t.tag===13){var n=t.memoizedState;if(n===null&&(t=t.alternate,t!==null&&(n=t.memoizedState)),n!==null)return n.dehydrated}return null}function O3(t){if(md(t)!==t)throw Error(Kt(188))}function FG(t){var n=t.alternate;if(!n){if(n=md(t),n===null)throw Error(Kt(188));return n!==t?null:t}for(var o=t,u=n;;){var d=o.return;if(d===null)break;var g=d.alternate;if(g===null){if(u=d.return,u!==null){o=u;continue}break}if(d.child===g.child){for(g=d.child;g;){if(g===o)return O3(d),t;if(g===u)return O3(d),n;g=g.sibling}throw Error(Kt(188))}if(o.return!==u.return)o=d,u=g;else{for(var x=!1,T=d.child;T;){if(T===o){x=!0,o=d,u=g;break}if(T===u){x=!0,u=d,o=g;break}T=T.sibling}if(!x){for(T=g.child;T;){if(T===o){x=!0,o=g,u=d;break}if(T===u){x=!0,u=g,o=d;break}T=T.sibling}if(!x)throw Error(Kt(189))}}if(o.alternate!==u)throw Error(Kt(190))}if(o.tag!==3)throw Error(Kt(188));return o.stateNode.current===o?t:n}function Uz(t){return t=FG(t),t!==null?Vz(t):null}function Vz(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var n=Vz(t);if(n!==null)return n;t=t.sibling}return null}var Gz=la.unstable_scheduleCallback,D3=la.unstable_cancelCallback,BG=la.unstable_shouldYield,jG=la.unstable_requestPaint,ro=la.unstable_now,$G=la.unstable_getCurrentPriorityLevel,vM=la.unstable_ImmediatePriority,qz=la.unstable_UserBlockingPriority,kx=la.unstable_NormalPriority,UG=la.unstable_LowPriority,Wz=la.unstable_IdlePriority,m1=null,zl=null;function VG(t){if(zl&&typeof zl.onCommitFiberRoot=="function")try{zl.onCommitFiberRoot(m1,t,void 0,(t.current.flags&128)===128)}catch{}}var il=Math.clz32?Math.clz32:WG,GG=Math.log,qG=Math.LN2;function WG(t){return t>>>=0,t===0?32:31-(GG(t)/qG|0)|0}var v0=64,x0=4194304;function e_(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Px(t,n){var o=t.pendingLanes;if(o===0)return 0;var u=0,d=t.suspendedLanes,g=t.pingedLanes,x=o&268435455;if(x!==0){var T=x&~d;T!==0?u=e_(T):(g&=x,g!==0&&(u=e_(g)))}else x=o&~d,x!==0?u=e_(x):g!==0&&(u=e_(g));if(u===0)return 0;if(n!==0&&n!==u&&!(n&d)&&(d=u&-u,g=n&-n,d>=g||d===16&&(g&4194240)!==0))return n;if(u&4&&(u|=o&16),n=t.entangledLanes,n!==0)for(t=t.entanglements,n&=u;0<n;)o=31-il(n),d=1<<o,u|=t[o],n&=~d;return u}function HG(t,n){switch(t){case 1:case 2:case 4:return n+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ZG(t,n){for(var o=t.suspendedLanes,u=t.pingedLanes,d=t.expirationTimes,g=t.pendingLanes;0<g;){var x=31-il(g),T=1<<x,s=d[x];s===-1?(!(T&o)||T&u)&&(d[x]=HG(T,n)):s<=n&&(t.expiredLanes|=T),g&=~T}}function OT(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Hz(){var t=v0;return v0<<=1,!(v0&4194240)&&(v0=64),t}function TE(t){for(var n=[],o=0;31>o;o++)n.push(t);return n}function ny(t,n,o){t.pendingLanes|=n,n!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,n=31-il(n),t[n]=o}function XG(t,n){var o=t.pendingLanes&~n;t.pendingLanes=n,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=n,t.mutableReadLanes&=n,t.entangledLanes&=n,n=t.entanglements;var u=t.eventTimes;for(t=t.expirationTimes;0<o;){var d=31-il(o),g=1<<d;n[d]=0,u[d]=-1,t[d]=-1,o&=~g}}function xM(t,n){var o=t.entangledLanes|=n;for(t=t.entanglements;o;){var u=31-il(o),d=1<<u;d&n|t[u]&n&&(t[u]|=n),o&=~d}}var ni=0;function Zz(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var Xz,bM,Yz,Qz,Kz,DT=!1,b0=[],ku=null,Pu=null,Ou=null,M_=new Map,I_=new Map,Su=[],YG="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function R3(t,n){switch(t){case"focusin":case"focusout":ku=null;break;case"dragenter":case"dragleave":Pu=null;break;case"mouseover":case"mouseout":Ou=null;break;case"pointerover":case"pointerout":M_.delete(n.pointerId);break;case"gotpointercapture":case"lostpointercapture":I_.delete(n.pointerId)}}function lg(t,n,o,u,d,g){return t===null||t.nativeEvent!==g?(t={blockedOn:n,domEventName:o,eventSystemFlags:u,nativeEvent:g,targetContainers:[d]},n!==null&&(n=oy(n),n!==null&&bM(n)),t):(t.eventSystemFlags|=u,n=t.targetContainers,d!==null&&n.indexOf(d)===-1&&n.push(d),t)}function QG(t,n,o,u,d){switch(n){case"focusin":return ku=lg(ku,t,n,o,u,d),!0;case"dragenter":return Pu=lg(Pu,t,n,o,u,d),!0;case"mouseover":return Ou=lg(Ou,t,n,o,u,d),!0;case"pointerover":var g=d.pointerId;return M_.set(g,lg(M_.get(g)||null,t,n,o,u,d)),!0;case"gotpointercapture":return g=d.pointerId,I_.set(g,lg(I_.get(g)||null,t,n,o,u,d)),!0}return!1}function Jz(t){var n=Zh(t.target);if(n!==null){var o=md(n);if(o!==null){if(n=o.tag,n===13){if(n=$z(o),n!==null){t.blockedOn=n,Kz(t.priority,function(){Yz(o)});return}}else if(n===3&&o.stateNode.current.memoizedState.isDehydrated){t.blockedOn=o.tag===3?o.stateNode.containerInfo:null;return}}}t.blockedOn=null}function nx(t){if(t.blockedOn!==null)return!1;for(var n=t.targetContainers;0<n.length;){var o=RT(t.domEventName,t.eventSystemFlags,n[0],t.nativeEvent);if(o===null){o=t.nativeEvent;var u=new o.constructor(o.type,o);IT=u,o.target.dispatchEvent(u),IT=null}else return n=oy(o),n!==null&&bM(n),t.blockedOn=o,!1;n.shift()}return!0}function L3(t,n,o){nx(t)&&o.delete(n)}function KG(){DT=!1,ku!==null&&nx(ku)&&(ku=null),Pu!==null&&nx(Pu)&&(Pu=null),Ou!==null&&nx(Ou)&&(Ou=null),M_.forEach(L3),I_.forEach(L3)}function cg(t,n){t.blockedOn===n&&(t.blockedOn=null,DT||(DT=!0,la.unstable_scheduleCallback(la.unstable_NormalPriority,KG)))}function A_(t){function n(d){return cg(d,t)}if(0<b0.length){cg(b0[0],t);for(var o=1;o<b0.length;o++){var u=b0[o];u.blockedOn===t&&(u.blockedOn=null)}}for(ku!==null&&cg(ku,t),Pu!==null&&cg(Pu,t),Ou!==null&&cg(Ou,t),M_.forEach(n),I_.forEach(n),o=0;o<Su.length;o++)u=Su[o],u.blockedOn===t&&(u.blockedOn=null);for(;0<Su.length&&(o=Su[0],o.blockedOn===null);)Jz(o),o.blockedOn===null&&Su.shift()}var ep=Rc.ReactCurrentBatchConfig,Ox=!0;function JG(t,n,o,u){var d=ni,g=ep.transition;ep.transition=null;try{ni=1,wM(t,n,o,u)}finally{ni=d,ep.transition=g}}function eq(t,n,o,u){var d=ni,g=ep.transition;ep.transition=null;try{ni=4,wM(t,n,o,u)}finally{ni=d,ep.transition=g}}function wM(t,n,o,u){if(Ox){var d=RT(t,n,o,u);if(d===null)LE(t,n,u,Dx,o),R3(t,u);else if(QG(d,t,n,o,u))u.stopPropagation();else if(R3(t,u),n&4&&-1<YG.indexOf(t)){for(;d!==null;){var g=oy(d);if(g!==null&&Xz(g),g=RT(t,n,o,u),g===null&&LE(t,n,u,Dx,o),g===d)break;d=g}d!==null&&u.stopPropagation()}else LE(t,n,u,null,o)}}var Dx=null;function RT(t,n,o,u){if(Dx=null,t=yM(u),t=Zh(t),t!==null)if(n=md(t),n===null)t=null;else if(o=n.tag,o===13){if(t=$z(n),t!==null)return t;t=null}else if(o===3){if(n.stateNode.current.memoizedState.isDehydrated)return n.tag===3?n.stateNode.containerInfo:null;t=null}else n!==t&&(t=null);return Dx=t,null}function eN(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch($G()){case vM:return 1;case qz:return 4;case kx:case UG:return 16;case Wz:return 536870912;default:return 16}default:return 16}}var Cu=null,EM=null,ix=null;function tN(){if(ix)return ix;var t,n=EM,o=n.length,u,d="value"in Cu?Cu.value:Cu.textContent,g=d.length;for(t=0;t<o&&n[t]===d[t];t++);var x=o-t;for(u=1;u<=x&&n[o-u]===d[g-u];u++);return ix=d.slice(t,1<u?1-u:void 0)}function ox(t){var n=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&n===13&&(t=13)):t=n,t===10&&(t=13),32<=t||t===13?t:0}function w0(){return!0}function z3(){return!1}function ua(t){function n(o,u,d,g,x){this._reactName=o,this._targetInst=d,this.type=u,this.nativeEvent=g,this.target=x,this.currentTarget=null;for(var T in t)t.hasOwnProperty(T)&&(o=t[T],this[T]=o?o(g):g[T]);return this.isDefaultPrevented=(g.defaultPrevented!=null?g.defaultPrevented:g.returnValue===!1)?w0:z3,this.isPropagationStopped=z3,this}return Bi(n.prototype,{preventDefault:function(){this.defaultPrevented=!0;var o=this.nativeEvent;o&&(o.preventDefault?o.preventDefault():typeof o.returnValue!="unknown"&&(o.returnValue=!1),this.isDefaultPrevented=w0)},stopPropagation:function(){var o=this.nativeEvent;o&&(o.stopPropagation?o.stopPropagation():typeof o.cancelBubble!="unknown"&&(o.cancelBubble=!0),this.isPropagationStopped=w0)},persist:function(){},isPersistent:w0}),n}var Ep={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},SM=ua(Ep),iy=Bi({},Ep,{view:0,detail:0}),tq=ua(iy),CE,ME,ug,g1=Bi({},iy,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:TM,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ug&&(ug&&t.type==="mousemove"?(CE=t.screenX-ug.screenX,ME=t.screenY-ug.screenY):ME=CE=0,ug=t),CE)},movementY:function(t){return"movementY"in t?t.movementY:ME}}),N3=ua(g1),rq=Bi({},g1,{dataTransfer:0}),nq=ua(rq),iq=Bi({},iy,{relatedTarget:0}),IE=ua(iq),oq=Bi({},Ep,{animationName:0,elapsedTime:0,pseudoElement:0}),sq=ua(oq),aq=Bi({},Ep,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),lq=ua(aq),cq=Bi({},Ep,{data:0}),F3=ua(cq),uq={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},hq={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},dq={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fq(t){var n=this.nativeEvent;return n.getModifierState?n.getModifierState(t):(t=dq[t])?!!n[t]:!1}function TM(){return fq}var pq=Bi({},iy,{key:function(t){if(t.key){var n=uq[t.key]||t.key;if(n!=="Unidentified")return n}return t.type==="keypress"?(t=ox(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?hq[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:TM,charCode:function(t){return t.type==="keypress"?ox(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?ox(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),mq=ua(pq),gq=Bi({},g1,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),B3=ua(gq),_q=Bi({},iy,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:TM}),yq=ua(_q),vq=Bi({},Ep,{propertyName:0,elapsedTime:0,pseudoElement:0}),xq=ua(vq),bq=Bi({},g1,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),wq=ua(bq),Eq=[9,13,27,32],CM=Tc&&"CompositionEvent"in window,l_=null;Tc&&"documentMode"in document&&(l_=document.documentMode);var Sq=Tc&&"TextEvent"in window&&!l_,rN=Tc&&(!CM||l_&&8<l_&&11>=l_),j3=" ",$3=!1;function nN(t,n){switch(t){case"keyup":return Eq.indexOf(n.keyCode)!==-1;case"keydown":return n.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function iN(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var zf=!1;function Tq(t,n){switch(t){case"compositionend":return iN(n);case"keypress":return n.which!==32?null:($3=!0,j3);case"textInput":return t=n.data,t===j3&&$3?null:t;default:return null}}function Cq(t,n){if(zf)return t==="compositionend"||!CM&&nN(t,n)?(t=tN(),ix=EM=Cu=null,zf=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(n.ctrlKey||n.altKey||n.metaKey)||n.ctrlKey&&n.altKey){if(n.char&&1<n.char.length)return n.char;if(n.which)return String.fromCharCode(n.which)}return null;case"compositionend":return rN&&n.locale!=="ko"?null:n.data;default:return null}}var Mq={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function U3(t){var n=t&&t.nodeName&&t.nodeName.toLowerCase();return n==="input"?!!Mq[t.type]:n==="textarea"}function oN(t,n,o,u){zz(u),n=Rx(n,"onChange"),0<n.length&&(o=new SM("onChange","change",null,o,u),t.push({event:o,listeners:n}))}var c_=null,k_=null;function Iq(t){gN(t,0)}function _1(t){var n=Bf(t);if(Az(n))return t}function Aq(t,n){if(t==="change")return n}var sN=!1;if(Tc){var AE;if(Tc){var kE="oninput"in document;if(!kE){var V3=document.createElement("div");V3.setAttribute("oninput","return;"),kE=typeof V3.oninput=="function"}AE=kE}else AE=!1;sN=AE&&(!document.documentMode||9<document.documentMode)}function G3(){c_&&(c_.detachEvent("onpropertychange",aN),k_=c_=null)}function aN(t){if(t.propertyName==="value"&&_1(k_)){var n=[];oN(n,k_,t,yM(t)),jz(Iq,n)}}function kq(t,n,o){t==="focusin"?(G3(),c_=n,k_=o,c_.attachEvent("onpropertychange",aN)):t==="focusout"&&G3()}function Pq(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return _1(k_)}function Oq(t,n){if(t==="click")return _1(n)}function Dq(t,n){if(t==="input"||t==="change")return _1(n)}function Rq(t,n){return t===n&&(t!==0||1/t===1/n)||t!==t&&n!==n}var sl=typeof Object.is=="function"?Object.is:Rq;function P_(t,n){if(sl(t,n))return!0;if(typeof t!="object"||t===null||typeof n!="object"||n===null)return!1;var o=Object.keys(t),u=Object.keys(n);if(o.length!==u.length)return!1;for(u=0;u<o.length;u++){var d=o[u];if(!gT.call(n,d)||!sl(t[d],n[d]))return!1}return!0}function q3(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function W3(t,n){var o=q3(t);t=0;for(var u;o;){if(o.nodeType===3){if(u=t+o.textContent.length,t<=n&&u>=n)return{node:o,offset:n-t};t=u}e:{for(;o;){if(o.nextSibling){o=o.nextSibling;break e}o=o.parentNode}o=void 0}o=q3(o)}}function lN(t,n){return t&&n?t===n?!0:t&&t.nodeType===3?!1:n&&n.nodeType===3?lN(t,n.parentNode):"contains"in t?t.contains(n):t.compareDocumentPosition?!!(t.compareDocumentPosition(n)&16):!1:!1}function cN(){for(var t=window,n=Mx();n instanceof t.HTMLIFrameElement;){try{var o=typeof n.contentWindow.location.href=="string"}catch{o=!1}if(o)t=n.contentWindow;else break;n=Mx(t.document)}return n}function MM(t){var n=t&&t.nodeName&&t.nodeName.toLowerCase();return n&&(n==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||n==="textarea"||t.contentEditable==="true")}function Lq(t){var n=cN(),o=t.focusedElem,u=t.selectionRange;if(n!==o&&o&&o.ownerDocument&&lN(o.ownerDocument.documentElement,o)){if(u!==null&&MM(o)){if(n=u.start,t=u.end,t===void 0&&(t=n),"selectionStart"in o)o.selectionStart=n,o.selectionEnd=Math.min(t,o.value.length);else if(t=(n=o.ownerDocument||document)&&n.defaultView||window,t.getSelection){t=t.getSelection();var d=o.textContent.length,g=Math.min(u.start,d);u=u.end===void 0?g:Math.min(u.end,d),!t.extend&&g>u&&(d=u,u=g,g=d),d=W3(o,g);var x=W3(o,u);d&&x&&(t.rangeCount!==1||t.anchorNode!==d.node||t.anchorOffset!==d.offset||t.focusNode!==x.node||t.focusOffset!==x.offset)&&(n=n.createRange(),n.setStart(d.node,d.offset),t.removeAllRanges(),g>u?(t.addRange(n),t.extend(x.node,x.offset)):(n.setEnd(x.node,x.offset),t.addRange(n)))}}for(n=[],t=o;t=t.parentNode;)t.nodeType===1&&n.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof o.focus=="function"&&o.focus(),o=0;o<n.length;o++)t=n[o],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var zq=Tc&&"documentMode"in document&&11>=document.documentMode,Nf=null,LT=null,u_=null,zT=!1;function H3(t,n,o){var u=o.window===o?o.document:o.nodeType===9?o:o.ownerDocument;zT||Nf==null||Nf!==Mx(u)||(u=Nf,"selectionStart"in u&&MM(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),u_&&P_(u_,u)||(u_=u,u=Rx(LT,"onSelect"),0<u.length&&(n=new SM("onSelect","select",null,n,o),t.push({event:n,listeners:u}),n.target=Nf)))}function E0(t,n){var o={};return o[t.toLowerCase()]=n.toLowerCase(),o["Webkit"+t]="webkit"+n,o["Moz"+t]="moz"+n,o}var Ff={animationend:E0("Animation","AnimationEnd"),animationiteration:E0("Animation","AnimationIteration"),animationstart:E0("Animation","AnimationStart"),transitionend:E0("Transition","TransitionEnd")},PE={},uN={};Tc&&(uN=document.createElement("div").style,"AnimationEvent"in window||(delete Ff.animationend.animation,delete Ff.animationiteration.animation,delete Ff.animationstart.animation),"TransitionEvent"in window||delete Ff.transitionend.transition);function y1(t){if(PE[t])return PE[t];if(!Ff[t])return t;var n=Ff[t],o;for(o in n)if(n.hasOwnProperty(o)&&o in uN)return PE[t]=n[o];return t}var hN=y1("animationend"),dN=y1("animationiteration"),fN=y1("animationstart"),pN=y1("transitionend"),mN=new Map,Z3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Xu(t,n){mN.set(t,n),pd(n,[t])}for(var OE=0;OE<Z3.length;OE++){var DE=Z3[OE],Nq=DE.toLowerCase(),Fq=DE[0].toUpperCase()+DE.slice(1);Xu(Nq,"on"+Fq)}Xu(hN,"onAnimationEnd");Xu(dN,"onAnimationIteration");Xu(fN,"onAnimationStart");Xu("dblclick","onDoubleClick");Xu("focusin","onFocus");Xu("focusout","onBlur");Xu(pN,"onTransitionEnd");lp("onMouseEnter",["mouseout","mouseover"]);lp("onMouseLeave",["mouseout","mouseover"]);lp("onPointerEnter",["pointerout","pointerover"]);lp("onPointerLeave",["pointerout","pointerover"]);pd("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));pd("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));pd("onBeforeInput",["compositionend","keypress","textInput","paste"]);pd("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));pd("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));pd("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var t_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Bq=new Set("cancel close invalid load scroll toggle".split(" ").concat(t_));function X3(t,n,o){var u=t.type||"unknown-event";t.currentTarget=o,NG(u,n,void 0,t),t.currentTarget=null}function gN(t,n){n=(n&4)!==0;for(var o=0;o<t.length;o++){var u=t[o],d=u.event;u=u.listeners;e:{var g=void 0;if(n)for(var x=u.length-1;0<=x;x--){var T=u[x],s=T.instance,I=T.currentTarget;if(T=T.listener,s!==g&&d.isPropagationStopped())break e;X3(d,T,I),g=s}else for(x=0;x<u.length;x++){if(T=u[x],s=T.instance,I=T.currentTarget,T=T.listener,s!==g&&d.isPropagationStopped())break e;X3(d,T,I),g=s}}}if(Ax)throw t=PT,Ax=!1,PT=null,t}function Si(t,n){var o=n[$T];o===void 0&&(o=n[$T]=new Set);var u=t+"__bubble";o.has(u)||(_N(n,t,2,!1),o.add(u))}function RE(t,n,o){var u=0;n&&(u|=4),_N(o,t,u,n)}var S0="_reactListening"+Math.random().toString(36).slice(2);function O_(t){if(!t[S0]){t[S0]=!0,Sz.forEach(function(o){o!=="selectionchange"&&(Bq.has(o)||RE(o,!1,t),RE(o,!0,t))});var n=t.nodeType===9?t:t.ownerDocument;n===null||n[S0]||(n[S0]=!0,RE("selectionchange",!1,n))}}function _N(t,n,o,u){switch(eN(n)){case 1:var d=JG;break;case 4:d=eq;break;default:d=wM}o=d.bind(null,n,o,t),d=void 0,!kT||n!=="touchstart"&&n!=="touchmove"&&n!=="wheel"||(d=!0),u?d!==void 0?t.addEventListener(n,o,{capture:!0,passive:d}):t.addEventListener(n,o,!0):d!==void 0?t.addEventListener(n,o,{passive:d}):t.addEventListener(n,o,!1)}function LE(t,n,o,u,d){var g=u;if(!(n&1)&&!(n&2)&&u!==null)e:for(;;){if(u===null)return;var x=u.tag;if(x===3||x===4){var T=u.stateNode.containerInfo;if(T===d||T.nodeType===8&&T.parentNode===d)break;if(x===4)for(x=u.return;x!==null;){var s=x.tag;if((s===3||s===4)&&(s=x.stateNode.containerInfo,s===d||s.nodeType===8&&s.parentNode===d))return;x=x.return}for(;T!==null;){if(x=Zh(T),x===null)return;if(s=x.tag,s===5||s===6){u=g=x;continue e}T=T.parentNode}}u=u.return}jz(function(){var I=g,O=yM(o),D=[];e:{var N=mN.get(t);if(N!==void 0){var j=SM,G=t;switch(t){case"keypress":if(ox(o)===0)break e;case"keydown":case"keyup":j=mq;break;case"focusin":G="focus",j=IE;break;case"focusout":G="blur",j=IE;break;case"beforeblur":case"afterblur":j=IE;break;case"click":if(o.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":j=N3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":j=nq;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":j=yq;break;case hN:case dN:case fN:j=sq;break;case pN:j=xq;break;case"scroll":j=tq;break;case"wheel":j=wq;break;case"copy":case"cut":case"paste":j=lq;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":j=B3}var X=(n&4)!==0,te=!X&&t==="scroll",H=X?N!==null?N+"Capture":null:N;X=[];for(var U=I,q;U!==null;){q=U;var J=q.stateNode;if(q.tag===5&&J!==null&&(q=J,H!==null&&(J=C_(U,H),J!=null&&X.push(D_(U,J,q)))),te)break;U=U.return}0<X.length&&(N=new j(N,G,null,o,O),D.push({event:N,listeners:X}))}}if(!(n&7)){e:{if(N=t==="mouseover"||t==="pointerover",j=t==="mouseout"||t==="pointerout",N&&o!==IT&&(G=o.relatedTarget||o.fromElement)&&(Zh(G)||G[Cc]))break e;if((j||N)&&(N=O.window===O?O:(N=O.ownerDocument)?N.defaultView||N.parentWindow:window,j?(G=o.relatedTarget||o.toElement,j=I,G=G?Zh(G):null,G!==null&&(te=md(G),G!==te||G.tag!==5&&G.tag!==6)&&(G=null)):(j=null,G=I),j!==G)){if(X=N3,J="onMouseLeave",H="onMouseEnter",U="mouse",(t==="pointerout"||t==="pointerover")&&(X=B3,J="onPointerLeave",H="onPointerEnter",U="pointer"),te=j==null?N:Bf(j),q=G==null?N:Bf(G),N=new X(J,U+"leave",j,o,O),N.target=te,N.relatedTarget=q,J=null,Zh(O)===I&&(X=new X(H,U+"enter",G,o,O),X.target=q,X.relatedTarget=te,J=X),te=J,j&&G)t:{for(X=j,H=G,U=0,q=X;q;q=mf(q))U++;for(q=0,J=H;J;J=mf(J))q++;for(;0<U-q;)X=mf(X),U--;for(;0<q-U;)H=mf(H),q--;for(;U--;){if(X===H||H!==null&&X===H.alternate)break t;X=mf(X),H=mf(H)}X=null}else X=null;j!==null&&Y3(D,N,j,X,!1),G!==null&&te!==null&&Y3(D,te,G,X,!0)}}e:{if(N=I?Bf(I):window,j=N.nodeName&&N.nodeName.toLowerCase(),j==="select"||j==="input"&&N.type==="file")var pe=Aq;else if(U3(N))if(sN)pe=Dq;else{pe=Pq;var ue=kq}else(j=N.nodeName)&&j.toLowerCase()==="input"&&(N.type==="checkbox"||N.type==="radio")&&(pe=Oq);if(pe&&(pe=pe(t,I))){oN(D,pe,o,O);break e}ue&&ue(t,N,I),t==="focusout"&&(ue=N._wrapperState)&&ue.controlled&&N.type==="number"&&ET(N,"number",N.value)}switch(ue=I?Bf(I):window,t){case"focusin":(U3(ue)||ue.contentEditable==="true")&&(Nf=ue,LT=I,u_=null);break;case"focusout":u_=LT=Nf=null;break;case"mousedown":zT=!0;break;case"contextmenu":case"mouseup":case"dragend":zT=!1,H3(D,o,O);break;case"selectionchange":if(zq)break;case"keydown":case"keyup":H3(D,o,O)}var Me;if(CM)e:{switch(t){case"compositionstart":var Se="onCompositionStart";break e;case"compositionend":Se="onCompositionEnd";break e;case"compositionupdate":Se="onCompositionUpdate";break e}Se=void 0}else zf?nN(t,o)&&(Se="onCompositionEnd"):t==="keydown"&&o.keyCode===229&&(Se="onCompositionStart");Se&&(rN&&o.locale!=="ko"&&(zf||Se!=="onCompositionStart"?Se==="onCompositionEnd"&&zf&&(Me=tN()):(Cu=O,EM="value"in Cu?Cu.value:Cu.textContent,zf=!0)),ue=Rx(I,Se),0<ue.length&&(Se=new F3(Se,t,null,o,O),D.push({event:Se,listeners:ue}),Me?Se.data=Me:(Me=iN(o),Me!==null&&(Se.data=Me)))),(Me=Sq?Tq(t,o):Cq(t,o))&&(I=Rx(I,"onBeforeInput"),0<I.length&&(O=new F3("onBeforeInput","beforeinput",null,o,O),D.push({event:O,listeners:I}),O.data=Me))}gN(D,n)})}function D_(t,n,o){return{instance:t,listener:n,currentTarget:o}}function Rx(t,n){for(var o=n+"Capture",u=[];t!==null;){var d=t,g=d.stateNode;d.tag===5&&g!==null&&(d=g,g=C_(t,o),g!=null&&u.unshift(D_(t,g,d)),g=C_(t,n),g!=null&&u.push(D_(t,g,d))),t=t.return}return u}function mf(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Y3(t,n,o,u,d){for(var g=n._reactName,x=[];o!==null&&o!==u;){var T=o,s=T.alternate,I=T.stateNode;if(s!==null&&s===u)break;T.tag===5&&I!==null&&(T=I,d?(s=C_(o,g),s!=null&&x.unshift(D_(o,s,T))):d||(s=C_(o,g),s!=null&&x.push(D_(o,s,T)))),o=o.return}x.length!==0&&t.push({event:n,listeners:x})}var jq=/\r\n?/g,$q=/\u0000|\uFFFD/g;function Q3(t){return(typeof t=="string"?t:""+t).replace(jq,`
`).replace($q,"")}function T0(t,n,o){if(n=Q3(n),Q3(t)!==n&&o)throw Error(Kt(425))}function Lx(){}var NT=null,FT=null;function BT(t,n){return t==="textarea"||t==="noscript"||typeof n.children=="string"||typeof n.children=="number"||typeof n.dangerouslySetInnerHTML=="object"&&n.dangerouslySetInnerHTML!==null&&n.dangerouslySetInnerHTML.__html!=null}var jT=typeof setTimeout=="function"?setTimeout:void 0,Uq=typeof clearTimeout=="function"?clearTimeout:void 0,K3=typeof Promise=="function"?Promise:void 0,Vq=typeof queueMicrotask=="function"?queueMicrotask:typeof K3<"u"?function(t){return K3.resolve(null).then(t).catch(Gq)}:jT;function Gq(t){setTimeout(function(){throw t})}function zE(t,n){var o=n,u=0;do{var d=o.nextSibling;if(t.removeChild(o),d&&d.nodeType===8)if(o=d.data,o==="/$"){if(u===0){t.removeChild(d),A_(n);return}u--}else o!=="$"&&o!=="$?"&&o!=="$!"||u++;o=d}while(o);A_(n)}function Du(t){for(;t!=null;t=t.nextSibling){var n=t.nodeType;if(n===1||n===3)break;if(n===8){if(n=t.data,n==="$"||n==="$!"||n==="$?")break;if(n==="/$")return null}}return t}function J3(t){t=t.previousSibling;for(var n=0;t;){if(t.nodeType===8){var o=t.data;if(o==="$"||o==="$!"||o==="$?"){if(n===0)return t;n--}else o==="/$"&&n++}t=t.previousSibling}return null}var Sp=Math.random().toString(36).slice(2),Dl="__reactFiber$"+Sp,R_="__reactProps$"+Sp,Cc="__reactContainer$"+Sp,$T="__reactEvents$"+Sp,qq="__reactListeners$"+Sp,Wq="__reactHandles$"+Sp;function Zh(t){var n=t[Dl];if(n)return n;for(var o=t.parentNode;o;){if(n=o[Cc]||o[Dl]){if(o=n.alternate,n.child!==null||o!==null&&o.child!==null)for(t=J3(t);t!==null;){if(o=t[Dl])return o;t=J3(t)}return n}t=o,o=t.parentNode}return null}function oy(t){return t=t[Dl]||t[Cc],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Bf(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(Kt(33))}function v1(t){return t[R_]||null}var UT=[],jf=-1;function Yu(t){return{current:t}}function Mi(t){0>jf||(t.current=UT[jf],UT[jf]=null,jf--)}function bi(t,n){jf++,UT[jf]=t.current,t.current=n}var Gu={},ss=Yu(Gu),Ns=Yu(!1),id=Gu;function cp(t,n){var o=t.type.contextTypes;if(!o)return Gu;var u=t.stateNode;if(u&&u.__reactInternalMemoizedUnmaskedChildContext===n)return u.__reactInternalMemoizedMaskedChildContext;var d={},g;for(g in o)d[g]=n[g];return u&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=n,t.__reactInternalMemoizedMaskedChildContext=d),d}function Fs(t){return t=t.childContextTypes,t!=null}function zx(){Mi(Ns),Mi(ss)}function eR(t,n,o){if(ss.current!==Gu)throw Error(Kt(168));bi(ss,n),bi(Ns,o)}function yN(t,n,o){var u=t.stateNode;if(n=n.childContextTypes,typeof u.getChildContext!="function")return o;u=u.getChildContext();for(var d in u)if(!(d in n))throw Error(Kt(108,kG(t)||"Unknown",d));return Bi({},o,u)}function Nx(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Gu,id=ss.current,bi(ss,t),bi(Ns,Ns.current),!0}function tR(t,n,o){var u=t.stateNode;if(!u)throw Error(Kt(169));o?(t=yN(t,n,id),u.__reactInternalMemoizedMergedChildContext=t,Mi(Ns),Mi(ss),bi(ss,t)):Mi(Ns),bi(Ns,o)}var _c=null,x1=!1,NE=!1;function vN(t){_c===null?_c=[t]:_c.push(t)}function Hq(t){x1=!0,vN(t)}function Qu(){if(!NE&&_c!==null){NE=!0;var t=0,n=ni;try{var o=_c;for(ni=1;t<o.length;t++){var u=o[t];do u=u(!0);while(u!==null)}_c=null,x1=!1}catch(d){throw _c!==null&&(_c=_c.slice(t+1)),Gz(vM,Qu),d}finally{ni=n,NE=!1}}return null}var $f=[],Uf=0,Fx=null,Bx=0,Sa=[],Ta=0,od=null,yc=1,vc="";function Vh(t,n){$f[Uf++]=Bx,$f[Uf++]=Fx,Fx=t,Bx=n}function xN(t,n,o){Sa[Ta++]=yc,Sa[Ta++]=vc,Sa[Ta++]=od,od=t;var u=yc;t=vc;var d=32-il(u)-1;u&=~(1<<d),o+=1;var g=32-il(n)+d;if(30<g){var x=d-d%5;g=(u&(1<<x)-1).toString(32),u>>=x,d-=x,yc=1<<32-il(n)+d|o<<d|u,vc=g+t}else yc=1<<g|o<<d|u,vc=t}function IM(t){t.return!==null&&(Vh(t,1),xN(t,1,0))}function AM(t){for(;t===Fx;)Fx=$f[--Uf],$f[Uf]=null,Bx=$f[--Uf],$f[Uf]=null;for(;t===od;)od=Sa[--Ta],Sa[Ta]=null,vc=Sa[--Ta],Sa[Ta]=null,yc=Sa[--Ta],Sa[Ta]=null}var sa=null,oa=null,Pi=!1,rl=null;function bN(t,n){var o=Ca(5,null,null,0);o.elementType="DELETED",o.stateNode=n,o.return=t,n=t.deletions,n===null?(t.deletions=[o],t.flags|=16):n.push(o)}function rR(t,n){switch(t.tag){case 5:var o=t.type;return n=n.nodeType!==1||o.toLowerCase()!==n.nodeName.toLowerCase()?null:n,n!==null?(t.stateNode=n,sa=t,oa=Du(n.firstChild),!0):!1;case 6:return n=t.pendingProps===""||n.nodeType!==3?null:n,n!==null?(t.stateNode=n,sa=t,oa=null,!0):!1;case 13:return n=n.nodeType!==8?null:n,n!==null?(o=od!==null?{id:yc,overflow:vc}:null,t.memoizedState={dehydrated:n,treeContext:o,retryLane:1073741824},o=Ca(18,null,null,0),o.stateNode=n,o.return=t,t.child=o,sa=t,oa=null,!0):!1;default:return!1}}function VT(t){return(t.mode&1)!==0&&(t.flags&128)===0}function GT(t){if(Pi){var n=oa;if(n){var o=n;if(!rR(t,n)){if(VT(t))throw Error(Kt(418));n=Du(o.nextSibling);var u=sa;n&&rR(t,n)?bN(u,o):(t.flags=t.flags&-4097|2,Pi=!1,sa=t)}}else{if(VT(t))throw Error(Kt(418));t.flags=t.flags&-4097|2,Pi=!1,sa=t}}}function nR(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;sa=t}function C0(t){if(t!==sa)return!1;if(!Pi)return nR(t),Pi=!0,!1;var n;if((n=t.tag!==3)&&!(n=t.tag!==5)&&(n=t.type,n=n!=="head"&&n!=="body"&&!BT(t.type,t.memoizedProps)),n&&(n=oa)){if(VT(t))throw wN(),Error(Kt(418));for(;n;)bN(t,n),n=Du(n.nextSibling)}if(nR(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(Kt(317));e:{for(t=t.nextSibling,n=0;t;){if(t.nodeType===8){var o=t.data;if(o==="/$"){if(n===0){oa=Du(t.nextSibling);break e}n--}else o!=="$"&&o!=="$!"&&o!=="$?"||n++}t=t.nextSibling}oa=null}}else oa=sa?Du(t.stateNode.nextSibling):null;return!0}function wN(){for(var t=oa;t;)t=Du(t.nextSibling)}function up(){oa=sa=null,Pi=!1}function kM(t){rl===null?rl=[t]:rl.push(t)}var Zq=Rc.ReactCurrentBatchConfig;function Ka(t,n){if(t&&t.defaultProps){n=Bi({},n),t=t.defaultProps;for(var o in t)n[o]===void 0&&(n[o]=t[o]);return n}return n}var jx=Yu(null),$x=null,Vf=null,PM=null;function OM(){PM=Vf=$x=null}function DM(t){var n=jx.current;Mi(jx),t._currentValue=n}function qT(t,n,o){for(;t!==null;){var u=t.alternate;if((t.childLanes&n)!==n?(t.childLanes|=n,u!==null&&(u.childLanes|=n)):u!==null&&(u.childLanes&n)!==n&&(u.childLanes|=n),t===o)break;t=t.return}}function tp(t,n){$x=t,PM=Vf=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&n&&(zs=!0),t.firstContext=null)}function Oa(t){var n=t._currentValue;if(PM!==t)if(t={context:t,memoizedValue:n,next:null},Vf===null){if($x===null)throw Error(Kt(308));Vf=t,$x.dependencies={lanes:0,firstContext:t}}else Vf=Vf.next=t;return n}var Xh=null;function RM(t){Xh===null?Xh=[t]:Xh.push(t)}function EN(t,n,o,u){var d=n.interleaved;return d===null?(o.next=o,RM(n)):(o.next=d.next,d.next=o),n.interleaved=o,Mc(t,u)}function Mc(t,n){t.lanes|=n;var o=t.alternate;for(o!==null&&(o.lanes|=n),o=t,t=t.return;t!==null;)t.childLanes|=n,o=t.alternate,o!==null&&(o.childLanes|=n),o=t,t=t.return;return o.tag===3?o.stateNode:null}var Eu=!1;function LM(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function SN(t,n){t=t.updateQueue,n.updateQueue===t&&(n.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function bc(t,n){return{eventTime:t,lane:n,tag:0,payload:null,callback:null,next:null}}function Ru(t,n,o){var u=t.updateQueue;if(u===null)return null;if(u=u.shared,zn&2){var d=u.pending;return d===null?n.next=n:(n.next=d.next,d.next=n),u.pending=n,Mc(t,o)}return d=u.interleaved,d===null?(n.next=n,RM(u)):(n.next=d.next,d.next=n),u.interleaved=n,Mc(t,o)}function sx(t,n,o){if(n=n.updateQueue,n!==null&&(n=n.shared,(o&4194240)!==0)){var u=n.lanes;u&=t.pendingLanes,o|=u,n.lanes=o,xM(t,o)}}function iR(t,n){var o=t.updateQueue,u=t.alternate;if(u!==null&&(u=u.updateQueue,o===u)){var d=null,g=null;if(o=o.firstBaseUpdate,o!==null){do{var x={eventTime:o.eventTime,lane:o.lane,tag:o.tag,payload:o.payload,callback:o.callback,next:null};g===null?d=g=x:g=g.next=x,o=o.next}while(o!==null);g===null?d=g=n:g=g.next=n}else d=g=n;o={baseState:u.baseState,firstBaseUpdate:d,lastBaseUpdate:g,shared:u.shared,effects:u.effects},t.updateQueue=o;return}t=o.lastBaseUpdate,t===null?o.firstBaseUpdate=n:t.next=n,o.lastBaseUpdate=n}function Ux(t,n,o,u){var d=t.updateQueue;Eu=!1;var g=d.firstBaseUpdate,x=d.lastBaseUpdate,T=d.shared.pending;if(T!==null){d.shared.pending=null;var s=T,I=s.next;s.next=null,x===null?g=I:x.next=I,x=s;var O=t.alternate;O!==null&&(O=O.updateQueue,T=O.lastBaseUpdate,T!==x&&(T===null?O.firstBaseUpdate=I:T.next=I,O.lastBaseUpdate=s))}if(g!==null){var D=d.baseState;x=0,O=I=s=null,T=g;do{var N=T.lane,j=T.eventTime;if((u&N)===N){O!==null&&(O=O.next={eventTime:j,lane:0,tag:T.tag,payload:T.payload,callback:T.callback,next:null});e:{var G=t,X=T;switch(N=n,j=o,X.tag){case 1:if(G=X.payload,typeof G=="function"){D=G.call(j,D,N);break e}D=G;break e;case 3:G.flags=G.flags&-65537|128;case 0:if(G=X.payload,N=typeof G=="function"?G.call(j,D,N):G,N==null)break e;D=Bi({},D,N);break e;case 2:Eu=!0}}T.callback!==null&&T.lane!==0&&(t.flags|=64,N=d.effects,N===null?d.effects=[T]:N.push(T))}else j={eventTime:j,lane:N,tag:T.tag,payload:T.payload,callback:T.callback,next:null},O===null?(I=O=j,s=D):O=O.next=j,x|=N;if(T=T.next,T===null){if(T=d.shared.pending,T===null)break;N=T,T=N.next,N.next=null,d.lastBaseUpdate=N,d.shared.pending=null}}while(!0);if(O===null&&(s=D),d.baseState=s,d.firstBaseUpdate=I,d.lastBaseUpdate=O,n=d.shared.interleaved,n!==null){d=n;do x|=d.lane,d=d.next;while(d!==n)}else g===null&&(d.shared.lanes=0);ad|=x,t.lanes=x,t.memoizedState=D}}function oR(t,n,o){if(t=n.effects,n.effects=null,t!==null)for(n=0;n<t.length;n++){var u=t[n],d=u.callback;if(d!==null){if(u.callback=null,u=o,typeof d!="function")throw Error(Kt(191,d));d.call(u)}}}var TN=new Ez.Component().refs;function WT(t,n,o,u){n=t.memoizedState,o=o(u,n),o=o==null?n:Bi({},n,o),t.memoizedState=o,t.lanes===0&&(t.updateQueue.baseState=o)}var b1={isMounted:function(t){return(t=t._reactInternals)?md(t)===t:!1},enqueueSetState:function(t,n,o){t=t._reactInternals;var u=_s(),d=zu(t),g=bc(u,d);g.payload=n,o!=null&&(g.callback=o),n=Ru(t,g,d),n!==null&&(ol(n,t,d,u),sx(n,t,d))},enqueueReplaceState:function(t,n,o){t=t._reactInternals;var u=_s(),d=zu(t),g=bc(u,d);g.tag=1,g.payload=n,o!=null&&(g.callback=o),n=Ru(t,g,d),n!==null&&(ol(n,t,d,u),sx(n,t,d))},enqueueForceUpdate:function(t,n){t=t._reactInternals;var o=_s(),u=zu(t),d=bc(o,u);d.tag=2,n!=null&&(d.callback=n),n=Ru(t,d,u),n!==null&&(ol(n,t,u,o),sx(n,t,u))}};function sR(t,n,o,u,d,g,x){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(u,g,x):n.prototype&&n.prototype.isPureReactComponent?!P_(o,u)||!P_(d,g):!0}function CN(t,n,o){var u=!1,d=Gu,g=n.contextType;return typeof g=="object"&&g!==null?g=Oa(g):(d=Fs(n)?id:ss.current,u=n.contextTypes,g=(u=u!=null)?cp(t,d):Gu),n=new n(o,g),t.memoizedState=n.state!==null&&n.state!==void 0?n.state:null,n.updater=b1,t.stateNode=n,n._reactInternals=t,u&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=d,t.__reactInternalMemoizedMaskedChildContext=g),n}function aR(t,n,o,u){t=n.state,typeof n.componentWillReceiveProps=="function"&&n.componentWillReceiveProps(o,u),typeof n.UNSAFE_componentWillReceiveProps=="function"&&n.UNSAFE_componentWillReceiveProps(o,u),n.state!==t&&b1.enqueueReplaceState(n,n.state,null)}function HT(t,n,o,u){var d=t.stateNode;d.props=o,d.state=t.memoizedState,d.refs=TN,LM(t);var g=n.contextType;typeof g=="object"&&g!==null?d.context=Oa(g):(g=Fs(n)?id:ss.current,d.context=cp(t,g)),d.state=t.memoizedState,g=n.getDerivedStateFromProps,typeof g=="function"&&(WT(t,n,g,o),d.state=t.memoizedState),typeof n.getDerivedStateFromProps=="function"||typeof d.getSnapshotBeforeUpdate=="function"||typeof d.UNSAFE_componentWillMount!="function"&&typeof d.componentWillMount!="function"||(n=d.state,typeof d.componentWillMount=="function"&&d.componentWillMount(),typeof d.UNSAFE_componentWillMount=="function"&&d.UNSAFE_componentWillMount(),n!==d.state&&b1.enqueueReplaceState(d,d.state,null),Ux(t,o,d,u),d.state=t.memoizedState),typeof d.componentDidMount=="function"&&(t.flags|=4194308)}function hg(t,n,o){if(t=o.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(o._owner){if(o=o._owner,o){if(o.tag!==1)throw Error(Kt(309));var u=o.stateNode}if(!u)throw Error(Kt(147,t));var d=u,g=""+t;return n!==null&&n.ref!==null&&typeof n.ref=="function"&&n.ref._stringRef===g?n.ref:(n=function(x){var T=d.refs;T===TN&&(T=d.refs={}),x===null?delete T[g]:T[g]=x},n._stringRef=g,n)}if(typeof t!="string")throw Error(Kt(284));if(!o._owner)throw Error(Kt(290,t))}return t}function M0(t,n){throw t=Object.prototype.toString.call(n),Error(Kt(31,t==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":t))}function lR(t){var n=t._init;return n(t._payload)}function MN(t){function n(H,U){if(t){var q=H.deletions;q===null?(H.deletions=[U],H.flags|=16):q.push(U)}}function o(H,U){if(!t)return null;for(;U!==null;)n(H,U),U=U.sibling;return null}function u(H,U){for(H=new Map;U!==null;)U.key!==null?H.set(U.key,U):H.set(U.index,U),U=U.sibling;return H}function d(H,U){return H=Nu(H,U),H.index=0,H.sibling=null,H}function g(H,U,q){return H.index=q,t?(q=H.alternate,q!==null?(q=q.index,q<U?(H.flags|=2,U):q):(H.flags|=2,U)):(H.flags|=1048576,U)}function x(H){return t&&H.alternate===null&&(H.flags|=2),H}function T(H,U,q,J){return U===null||U.tag!==6?(U=GE(q,H.mode,J),U.return=H,U):(U=d(U,q),U.return=H,U)}function s(H,U,q,J){var pe=q.type;return pe===Lf?O(H,U,q.props.children,J,q.key):U!==null&&(U.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===wu&&lR(pe)===U.type)?(J=d(U,q.props),J.ref=hg(H,U,q),J.return=H,J):(J=dx(q.type,q.key,q.props,null,H.mode,J),J.ref=hg(H,U,q),J.return=H,J)}function I(H,U,q,J){return U===null||U.tag!==4||U.stateNode.containerInfo!==q.containerInfo||U.stateNode.implementation!==q.implementation?(U=qE(q,H.mode,J),U.return=H,U):(U=d(U,q.children||[]),U.return=H,U)}function O(H,U,q,J,pe){return U===null||U.tag!==7?(U=ed(q,H.mode,J,pe),U.return=H,U):(U=d(U,q),U.return=H,U)}function D(H,U,q){if(typeof U=="string"&&U!==""||typeof U=="number")return U=GE(""+U,H.mode,q),U.return=H,U;if(typeof U=="object"&&U!==null){switch(U.$$typeof){case g0:return q=dx(U.type,U.key,U.props,null,H.mode,q),q.ref=hg(H,null,U),q.return=H,q;case Rf:return U=qE(U,H.mode,q),U.return=H,U;case wu:var J=U._init;return D(H,J(U._payload),q)}if(Jg(U)||sg(U))return U=ed(U,H.mode,q,null),U.return=H,U;M0(H,U)}return null}function N(H,U,q,J){var pe=U!==null?U.key:null;if(typeof q=="string"&&q!==""||typeof q=="number")return pe!==null?null:T(H,U,""+q,J);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case g0:return q.key===pe?s(H,U,q,J):null;case Rf:return q.key===pe?I(H,U,q,J):null;case wu:return pe=q._init,N(H,U,pe(q._payload),J)}if(Jg(q)||sg(q))return pe!==null?null:O(H,U,q,J,null);M0(H,q)}return null}function j(H,U,q,J,pe){if(typeof J=="string"&&J!==""||typeof J=="number")return H=H.get(q)||null,T(U,H,""+J,pe);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case g0:return H=H.get(J.key===null?q:J.key)||null,s(U,H,J,pe);case Rf:return H=H.get(J.key===null?q:J.key)||null,I(U,H,J,pe);case wu:var ue=J._init;return j(H,U,q,ue(J._payload),pe)}if(Jg(J)||sg(J))return H=H.get(q)||null,O(U,H,J,pe,null);M0(U,J)}return null}function G(H,U,q,J){for(var pe=null,ue=null,Me=U,Se=U=0,ge=null;Me!==null&&Se<q.length;Se++){Me.index>Se?(ge=Me,Me=null):ge=Me.sibling;var se=N(H,Me,q[Se],J);if(se===null){Me===null&&(Me=ge);break}t&&Me&&se.alternate===null&&n(H,Me),U=g(se,U,Se),ue===null?pe=se:ue.sibling=se,ue=se,Me=ge}if(Se===q.length)return o(H,Me),Pi&&Vh(H,Se),pe;if(Me===null){for(;Se<q.length;Se++)Me=D(H,q[Se],J),Me!==null&&(U=g(Me,U,Se),ue===null?pe=Me:ue.sibling=Me,ue=Me);return Pi&&Vh(H,Se),pe}for(Me=u(H,Me);Se<q.length;Se++)ge=j(Me,H,Se,q[Se],J),ge!==null&&(t&&ge.alternate!==null&&Me.delete(ge.key===null?Se:ge.key),U=g(ge,U,Se),ue===null?pe=ge:ue.sibling=ge,ue=ge);return t&&Me.forEach(function(Ie){return n(H,Ie)}),Pi&&Vh(H,Se),pe}function X(H,U,q,J){var pe=sg(q);if(typeof pe!="function")throw Error(Kt(150));if(q=pe.call(q),q==null)throw Error(Kt(151));for(var ue=pe=null,Me=U,Se=U=0,ge=null,se=q.next();Me!==null&&!se.done;Se++,se=q.next()){Me.index>Se?(ge=Me,Me=null):ge=Me.sibling;var Ie=N(H,Me,se.value,J);if(Ie===null){Me===null&&(Me=ge);break}t&&Me&&Ie.alternate===null&&n(H,Me),U=g(Ie,U,Se),ue===null?pe=Ie:ue.sibling=Ie,ue=Ie,Me=ge}if(se.done)return o(H,Me),Pi&&Vh(H,Se),pe;if(Me===null){for(;!se.done;Se++,se=q.next())se=D(H,se.value,J),se!==null&&(U=g(se,U,Se),ue===null?pe=se:ue.sibling=se,ue=se);return Pi&&Vh(H,Se),pe}for(Me=u(H,Me);!se.done;Se++,se=q.next())se=j(Me,H,Se,se.value,J),se!==null&&(t&&se.alternate!==null&&Me.delete(se.key===null?Se:se.key),U=g(se,U,Se),ue===null?pe=se:ue.sibling=se,ue=se);return t&&Me.forEach(function(We){return n(H,We)}),Pi&&Vh(H,Se),pe}function te(H,U,q,J){if(typeof q=="object"&&q!==null&&q.type===Lf&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case g0:e:{for(var pe=q.key,ue=U;ue!==null;){if(ue.key===pe){if(pe=q.type,pe===Lf){if(ue.tag===7){o(H,ue.sibling),U=d(ue,q.props.children),U.return=H,H=U;break e}}else if(ue.elementType===pe||typeof pe=="object"&&pe!==null&&pe.$$typeof===wu&&lR(pe)===ue.type){o(H,ue.sibling),U=d(ue,q.props),U.ref=hg(H,ue,q),U.return=H,H=U;break e}o(H,ue);break}else n(H,ue);ue=ue.sibling}q.type===Lf?(U=ed(q.props.children,H.mode,J,q.key),U.return=H,H=U):(J=dx(q.type,q.key,q.props,null,H.mode,J),J.ref=hg(H,U,q),J.return=H,H=J)}return x(H);case Rf:e:{for(ue=q.key;U!==null;){if(U.key===ue)if(U.tag===4&&U.stateNode.containerInfo===q.containerInfo&&U.stateNode.implementation===q.implementation){o(H,U.sibling),U=d(U,q.children||[]),U.return=H,H=U;break e}else{o(H,U);break}else n(H,U);U=U.sibling}U=qE(q,H.mode,J),U.return=H,H=U}return x(H);case wu:return ue=q._init,te(H,U,ue(q._payload),J)}if(Jg(q))return G(H,U,q,J);if(sg(q))return X(H,U,q,J);M0(H,q)}return typeof q=="string"&&q!==""||typeof q=="number"?(q=""+q,U!==null&&U.tag===6?(o(H,U.sibling),U=d(U,q),U.return=H,H=U):(o(H,U),U=GE(q,H.mode,J),U.return=H,H=U),x(H)):o(H,U)}return te}var hp=MN(!0),IN=MN(!1),sy={},Nl=Yu(sy),L_=Yu(sy),z_=Yu(sy);function Yh(t){if(t===sy)throw Error(Kt(174));return t}function zM(t,n){switch(bi(z_,n),bi(L_,t),bi(Nl,sy),t=n.nodeType,t){case 9:case 11:n=(n=n.documentElement)?n.namespaceURI:TT(null,"");break;default:t=t===8?n.parentNode:n,n=t.namespaceURI||null,t=t.tagName,n=TT(n,t)}Mi(Nl),bi(Nl,n)}function dp(){Mi(Nl),Mi(L_),Mi(z_)}function AN(t){Yh(z_.current);var n=Yh(Nl.current),o=TT(n,t.type);n!==o&&(bi(L_,t),bi(Nl,o))}function NM(t){L_.current===t&&(Mi(Nl),Mi(L_))}var Ni=Yu(0);function Vx(t){for(var n=t;n!==null;){if(n.tag===13){var o=n.memoizedState;if(o!==null&&(o=o.dehydrated,o===null||o.data==="$?"||o.data==="$!"))return n}else if(n.tag===19&&n.memoizedProps.revealOrder!==void 0){if(n.flags&128)return n}else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return null;n=n.return}n.sibling.return=n.return,n=n.sibling}return null}var FE=[];function FM(){for(var t=0;t<FE.length;t++)FE[t]._workInProgressVersionPrimary=null;FE.length=0}var ax=Rc.ReactCurrentDispatcher,BE=Rc.ReactCurrentBatchConfig,sd=0,Fi=null,go=null,Co=null,Gx=!1,h_=!1,N_=0,Xq=0;function es(){throw Error(Kt(321))}function BM(t,n){if(n===null)return!1;for(var o=0;o<n.length&&o<t.length;o++)if(!sl(t[o],n[o]))return!1;return!0}function jM(t,n,o,u,d,g){if(sd=g,Fi=n,n.memoizedState=null,n.updateQueue=null,n.lanes=0,ax.current=t===null||t.memoizedState===null?Jq:eW,t=o(u,d),h_){g=0;do{if(h_=!1,N_=0,25<=g)throw Error(Kt(301));g+=1,Co=go=null,n.updateQueue=null,ax.current=tW,t=o(u,d)}while(h_)}if(ax.current=qx,n=go!==null&&go.next!==null,sd=0,Co=go=Fi=null,Gx=!1,n)throw Error(Kt(300));return t}function $M(){var t=N_!==0;return N_=0,t}function Ol(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Co===null?Fi.memoizedState=Co=t:Co=Co.next=t,Co}function Da(){if(go===null){var t=Fi.alternate;t=t!==null?t.memoizedState:null}else t=go.next;var n=Co===null?Fi.memoizedState:Co.next;if(n!==null)Co=n,go=t;else{if(t===null)throw Error(Kt(310));go=t,t={memoizedState:go.memoizedState,baseState:go.baseState,baseQueue:go.baseQueue,queue:go.queue,next:null},Co===null?Fi.memoizedState=Co=t:Co=Co.next=t}return Co}function F_(t,n){return typeof n=="function"?n(t):n}function jE(t){var n=Da(),o=n.queue;if(o===null)throw Error(Kt(311));o.lastRenderedReducer=t;var u=go,d=u.baseQueue,g=o.pending;if(g!==null){if(d!==null){var x=d.next;d.next=g.next,g.next=x}u.baseQueue=d=g,o.pending=null}if(d!==null){g=d.next,u=u.baseState;var T=x=null,s=null,I=g;do{var O=I.lane;if((sd&O)===O)s!==null&&(s=s.next={lane:0,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null}),u=I.hasEagerState?I.eagerState:t(u,I.action);else{var D={lane:O,action:I.action,hasEagerState:I.hasEagerState,eagerState:I.eagerState,next:null};s===null?(T=s=D,x=u):s=s.next=D,Fi.lanes|=O,ad|=O}I=I.next}while(I!==null&&I!==g);s===null?x=u:s.next=T,sl(u,n.memoizedState)||(zs=!0),n.memoizedState=u,n.baseState=x,n.baseQueue=s,o.lastRenderedState=u}if(t=o.interleaved,t!==null){d=t;do g=d.lane,Fi.lanes|=g,ad|=g,d=d.next;while(d!==t)}else d===null&&(o.lanes=0);return[n.memoizedState,o.dispatch]}function $E(t){var n=Da(),o=n.queue;if(o===null)throw Error(Kt(311));o.lastRenderedReducer=t;var u=o.dispatch,d=o.pending,g=n.memoizedState;if(d!==null){o.pending=null;var x=d=d.next;do g=t(g,x.action),x=x.next;while(x!==d);sl(g,n.memoizedState)||(zs=!0),n.memoizedState=g,n.baseQueue===null&&(n.baseState=g),o.lastRenderedState=g}return[g,u]}function kN(){}function PN(t,n){var o=Fi,u=Da(),d=n(),g=!sl(u.memoizedState,d);if(g&&(u.memoizedState=d,zs=!0),u=u.queue,UM(RN.bind(null,o,u,t),[t]),u.getSnapshot!==n||g||Co!==null&&Co.memoizedState.tag&1){if(o.flags|=2048,B_(9,DN.bind(null,o,u,d,n),void 0,null),Ao===null)throw Error(Kt(349));sd&30||ON(o,n,d)}return d}function ON(t,n,o){t.flags|=16384,t={getSnapshot:n,value:o},n=Fi.updateQueue,n===null?(n={lastEffect:null,stores:null},Fi.updateQueue=n,n.stores=[t]):(o=n.stores,o===null?n.stores=[t]:o.push(t))}function DN(t,n,o,u){n.value=o,n.getSnapshot=u,LN(n)&&zN(t)}function RN(t,n,o){return o(function(){LN(n)&&zN(t)})}function LN(t){var n=t.getSnapshot;t=t.value;try{var o=n();return!sl(t,o)}catch{return!0}}function zN(t){var n=Mc(t,1);n!==null&&ol(n,t,1,-1)}function cR(t){var n=Ol();return typeof t=="function"&&(t=t()),n.memoizedState=n.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:F_,lastRenderedState:t},n.queue=t,t=t.dispatch=Kq.bind(null,Fi,t),[n.memoizedState,t]}function B_(t,n,o,u){return t={tag:t,create:n,destroy:o,deps:u,next:null},n=Fi.updateQueue,n===null?(n={lastEffect:null,stores:null},Fi.updateQueue=n,n.lastEffect=t.next=t):(o=n.lastEffect,o===null?n.lastEffect=t.next=t:(u=o.next,o.next=t,t.next=u,n.lastEffect=t)),t}function NN(){return Da().memoizedState}function lx(t,n,o,u){var d=Ol();Fi.flags|=t,d.memoizedState=B_(1|n,o,void 0,u===void 0?null:u)}function w1(t,n,o,u){var d=Da();u=u===void 0?null:u;var g=void 0;if(go!==null){var x=go.memoizedState;if(g=x.destroy,u!==null&&BM(u,x.deps)){d.memoizedState=B_(n,o,g,u);return}}Fi.flags|=t,d.memoizedState=B_(1|n,o,g,u)}function uR(t,n){return lx(8390656,8,t,n)}function UM(t,n){return w1(2048,8,t,n)}function FN(t,n){return w1(4,2,t,n)}function BN(t,n){return w1(4,4,t,n)}function jN(t,n){if(typeof n=="function")return t=t(),n(t),function(){n(null)};if(n!=null)return t=t(),n.current=t,function(){n.current=null}}function $N(t,n,o){return o=o!=null?o.concat([t]):null,w1(4,4,jN.bind(null,n,t),o)}function VM(){}function UN(t,n){var o=Da();n=n===void 0?null:n;var u=o.memoizedState;return u!==null&&n!==null&&BM(n,u[1])?u[0]:(o.memoizedState=[t,n],t)}function VN(t,n){var o=Da();n=n===void 0?null:n;var u=o.memoizedState;return u!==null&&n!==null&&BM(n,u[1])?u[0]:(t=t(),o.memoizedState=[t,n],t)}function GN(t,n,o){return sd&21?(sl(o,n)||(o=Hz(),Fi.lanes|=o,ad|=o,t.baseState=!0),n):(t.baseState&&(t.baseState=!1,zs=!0),t.memoizedState=o)}function Yq(t,n){var o=ni;ni=o!==0&&4>o?o:4,t(!0);var u=BE.transition;BE.transition={};try{t(!1),n()}finally{ni=o,BE.transition=u}}function qN(){return Da().memoizedState}function Qq(t,n,o){var u=zu(t);if(o={lane:u,action:o,hasEagerState:!1,eagerState:null,next:null},WN(t))HN(n,o);else if(o=EN(t,n,o,u),o!==null){var d=_s();ol(o,t,u,d),ZN(o,n,u)}}function Kq(t,n,o){var u=zu(t),d={lane:u,action:o,hasEagerState:!1,eagerState:null,next:null};if(WN(t))HN(n,d);else{var g=t.alternate;if(t.lanes===0&&(g===null||g.lanes===0)&&(g=n.lastRenderedReducer,g!==null))try{var x=n.lastRenderedState,T=g(x,o);if(d.hasEagerState=!0,d.eagerState=T,sl(T,x)){var s=n.interleaved;s===null?(d.next=d,RM(n)):(d.next=s.next,s.next=d),n.interleaved=d;return}}catch{}finally{}o=EN(t,n,d,u),o!==null&&(d=_s(),ol(o,t,u,d),ZN(o,n,u))}}function WN(t){var n=t.alternate;return t===Fi||n!==null&&n===Fi}function HN(t,n){h_=Gx=!0;var o=t.pending;o===null?n.next=n:(n.next=o.next,o.next=n),t.pending=n}function ZN(t,n,o){if(o&4194240){var u=n.lanes;u&=t.pendingLanes,o|=u,n.lanes=o,xM(t,o)}}var qx={readContext:Oa,useCallback:es,useContext:es,useEffect:es,useImperativeHandle:es,useInsertionEffect:es,useLayoutEffect:es,useMemo:es,useReducer:es,useRef:es,useState:es,useDebugValue:es,useDeferredValue:es,useTransition:es,useMutableSource:es,useSyncExternalStore:es,useId:es,unstable_isNewReconciler:!1},Jq={readContext:Oa,useCallback:function(t,n){return Ol().memoizedState=[t,n===void 0?null:n],t},useContext:Oa,useEffect:uR,useImperativeHandle:function(t,n,o){return o=o!=null?o.concat([t]):null,lx(4194308,4,jN.bind(null,n,t),o)},useLayoutEffect:function(t,n){return lx(4194308,4,t,n)},useInsertionEffect:function(t,n){return lx(4,2,t,n)},useMemo:function(t,n){var o=Ol();return n=n===void 0?null:n,t=t(),o.memoizedState=[t,n],t},useReducer:function(t,n,o){var u=Ol();return n=o!==void 0?o(n):n,u.memoizedState=u.baseState=n,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:n},u.queue=t,t=t.dispatch=Qq.bind(null,Fi,t),[u.memoizedState,t]},useRef:function(t){var n=Ol();return t={current:t},n.memoizedState=t},useState:cR,useDebugValue:VM,useDeferredValue:function(t){return Ol().memoizedState=t},useTransition:function(){var t=cR(!1),n=t[0];return t=Yq.bind(null,t[1]),Ol().memoizedState=t,[n,t]},useMutableSource:function(){},useSyncExternalStore:function(t,n,o){var u=Fi,d=Ol();if(Pi){if(o===void 0)throw Error(Kt(407));o=o()}else{if(o=n(),Ao===null)throw Error(Kt(349));sd&30||ON(u,n,o)}d.memoizedState=o;var g={value:o,getSnapshot:n};return d.queue=g,uR(RN.bind(null,u,g,t),[t]),u.flags|=2048,B_(9,DN.bind(null,u,g,o,n),void 0,null),o},useId:function(){var t=Ol(),n=Ao.identifierPrefix;if(Pi){var o=vc,u=yc;o=(u&~(1<<32-il(u)-1)).toString(32)+o,n=":"+n+"R"+o,o=N_++,0<o&&(n+="H"+o.toString(32)),n+=":"}else o=Xq++,n=":"+n+"r"+o.toString(32)+":";return t.memoizedState=n},unstable_isNewReconciler:!1},eW={readContext:Oa,useCallback:UN,useContext:Oa,useEffect:UM,useImperativeHandle:$N,useInsertionEffect:FN,useLayoutEffect:BN,useMemo:VN,useReducer:jE,useRef:NN,useState:function(){return jE(F_)},useDebugValue:VM,useDeferredValue:function(t){var n=Da();return GN(n,go.memoizedState,t)},useTransition:function(){var t=jE(F_)[0],n=Da().memoizedState;return[t,n]},useMutableSource:kN,useSyncExternalStore:PN,useId:qN,unstable_isNewReconciler:!1},tW={readContext:Oa,useCallback:UN,useContext:Oa,useEffect:UM,useImperativeHandle:$N,useInsertionEffect:FN,useLayoutEffect:BN,useMemo:VN,useReducer:$E,useRef:NN,useState:function(){return $E(F_)},useDebugValue:VM,useDeferredValue:function(t){var n=Da();return go===null?n.memoizedState=t:GN(n,go.memoizedState,t)},useTransition:function(){var t=$E(F_)[0],n=Da().memoizedState;return[t,n]},useMutableSource:kN,useSyncExternalStore:PN,useId:qN,unstable_isNewReconciler:!1};function fp(t,n){try{var o="",u=n;do o+=AG(u),u=u.return;while(u);var d=o}catch(g){d=`
Error generating stack: `+g.message+`
`+g.stack}return{value:t,source:n,stack:d,digest:null}}function UE(t,n,o){return{value:t,source:null,stack:o??null,digest:n??null}}function ZT(t,n){try{console.error(n.value)}catch(o){setTimeout(function(){throw o})}}var rW=typeof WeakMap=="function"?WeakMap:Map;function XN(t,n,o){o=bc(-1,o),o.tag=3,o.payload={element:null};var u=n.value;return o.callback=function(){Hx||(Hx=!0,iC=u),ZT(t,n)},o}function YN(t,n,o){o=bc(-1,o),o.tag=3;var u=t.type.getDerivedStateFromError;if(typeof u=="function"){var d=n.value;o.payload=function(){return u(d)},o.callback=function(){ZT(t,n)}}var g=t.stateNode;return g!==null&&typeof g.componentDidCatch=="function"&&(o.callback=function(){ZT(t,n),typeof u!="function"&&(Lu===null?Lu=new Set([this]):Lu.add(this));var x=n.stack;this.componentDidCatch(n.value,{componentStack:x!==null?x:""})}),o}function hR(t,n,o){var u=t.pingCache;if(u===null){u=t.pingCache=new rW;var d=new Set;u.set(n,d)}else d=u.get(n),d===void 0&&(d=new Set,u.set(n,d));d.has(o)||(d.add(o),t=gW.bind(null,t,n,o),n.then(t,t))}function dR(t){do{var n;if((n=t.tag===13)&&(n=t.memoizedState,n=n!==null?n.dehydrated!==null:!0),n)return t;t=t.return}while(t!==null);return null}function fR(t,n,o,u,d){return t.mode&1?(t.flags|=65536,t.lanes=d,t):(t===n?t.flags|=65536:(t.flags|=128,o.flags|=131072,o.flags&=-52805,o.tag===1&&(o.alternate===null?o.tag=17:(n=bc(-1,1),n.tag=2,Ru(o,n,1))),o.lanes|=1),t)}var nW=Rc.ReactCurrentOwner,zs=!1;function gs(t,n,o,u){n.child=t===null?IN(n,null,o,u):hp(n,t.child,o,u)}function pR(t,n,o,u,d){o=o.render;var g=n.ref;return tp(n,d),u=jM(t,n,o,u,g,d),o=$M(),t!==null&&!zs?(n.updateQueue=t.updateQueue,n.flags&=-2053,t.lanes&=~d,Ic(t,n,d)):(Pi&&o&&IM(n),n.flags|=1,gs(t,n,u,d),n.child)}function mR(t,n,o,u,d){if(t===null){var g=o.type;return typeof g=="function"&&!QM(g)&&g.defaultProps===void 0&&o.compare===null&&o.defaultProps===void 0?(n.tag=15,n.type=g,QN(t,n,g,u,d)):(t=dx(o.type,null,u,n,n.mode,d),t.ref=n.ref,t.return=n,n.child=t)}if(g=t.child,!(t.lanes&d)){var x=g.memoizedProps;if(o=o.compare,o=o!==null?o:P_,o(x,u)&&t.ref===n.ref)return Ic(t,n,d)}return n.flags|=1,t=Nu(g,u),t.ref=n.ref,t.return=n,n.child=t}function QN(t,n,o,u,d){if(t!==null){var g=t.memoizedProps;if(P_(g,u)&&t.ref===n.ref)if(zs=!1,n.pendingProps=u=g,(t.lanes&d)!==0)t.flags&131072&&(zs=!0);else return n.lanes=t.lanes,Ic(t,n,d)}return XT(t,n,o,u,d)}function KN(t,n,o){var u=n.pendingProps,d=u.children,g=t!==null?t.memoizedState:null;if(u.mode==="hidden")if(!(n.mode&1))n.memoizedState={baseLanes:0,cachePool:null,transitions:null},bi(qf,ra),ra|=o;else{if(!(o&1073741824))return t=g!==null?g.baseLanes|o:o,n.lanes=n.childLanes=1073741824,n.memoizedState={baseLanes:t,cachePool:null,transitions:null},n.updateQueue=null,bi(qf,ra),ra|=t,null;n.memoizedState={baseLanes:0,cachePool:null,transitions:null},u=g!==null?g.baseLanes:o,bi(qf,ra),ra|=u}else g!==null?(u=g.baseLanes|o,n.memoizedState=null):u=o,bi(qf,ra),ra|=u;return gs(t,n,d,o),n.child}function JN(t,n){var o=n.ref;(t===null&&o!==null||t!==null&&t.ref!==o)&&(n.flags|=512,n.flags|=2097152)}function XT(t,n,o,u,d){var g=Fs(o)?id:ss.current;return g=cp(n,g),tp(n,d),o=jM(t,n,o,u,g,d),u=$M(),t!==null&&!zs?(n.updateQueue=t.updateQueue,n.flags&=-2053,t.lanes&=~d,Ic(t,n,d)):(Pi&&u&&IM(n),n.flags|=1,gs(t,n,o,d),n.child)}function gR(t,n,o,u,d){if(Fs(o)){var g=!0;Nx(n)}else g=!1;if(tp(n,d),n.stateNode===null)cx(t,n),CN(n,o,u),HT(n,o,u,d),u=!0;else if(t===null){var x=n.stateNode,T=n.memoizedProps;x.props=T;var s=x.context,I=o.contextType;typeof I=="object"&&I!==null?I=Oa(I):(I=Fs(o)?id:ss.current,I=cp(n,I));var O=o.getDerivedStateFromProps,D=typeof O=="function"||typeof x.getSnapshotBeforeUpdate=="function";D||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(T!==u||s!==I)&&aR(n,x,u,I),Eu=!1;var N=n.memoizedState;x.state=N,Ux(n,u,x,d),s=n.memoizedState,T!==u||N!==s||Ns.current||Eu?(typeof O=="function"&&(WT(n,o,O,u),s=n.memoizedState),(T=Eu||sR(n,o,T,u,N,s,I))?(D||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(n.flags|=4194308)):(typeof x.componentDidMount=="function"&&(n.flags|=4194308),n.memoizedProps=u,n.memoizedState=s),x.props=u,x.state=s,x.context=I,u=T):(typeof x.componentDidMount=="function"&&(n.flags|=4194308),u=!1)}else{x=n.stateNode,SN(t,n),T=n.memoizedProps,I=n.type===n.elementType?T:Ka(n.type,T),x.props=I,D=n.pendingProps,N=x.context,s=o.contextType,typeof s=="object"&&s!==null?s=Oa(s):(s=Fs(o)?id:ss.current,s=cp(n,s));var j=o.getDerivedStateFromProps;(O=typeof j=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(T!==D||N!==s)&&aR(n,x,u,s),Eu=!1,N=n.memoizedState,x.state=N,Ux(n,u,x,d);var G=n.memoizedState;T!==D||N!==G||Ns.current||Eu?(typeof j=="function"&&(WT(n,o,j,u),G=n.memoizedState),(I=Eu||sR(n,o,I,u,N,G,s)||!1)?(O||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(u,G,s),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(u,G,s)),typeof x.componentDidUpdate=="function"&&(n.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(n.flags|=1024)):(typeof x.componentDidUpdate!="function"||T===t.memoizedProps&&N===t.memoizedState||(n.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||T===t.memoizedProps&&N===t.memoizedState||(n.flags|=1024),n.memoizedProps=u,n.memoizedState=G),x.props=u,x.state=G,x.context=s,u=I):(typeof x.componentDidUpdate!="function"||T===t.memoizedProps&&N===t.memoizedState||(n.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||T===t.memoizedProps&&N===t.memoizedState||(n.flags|=1024),u=!1)}return YT(t,n,o,u,g,d)}function YT(t,n,o,u,d,g){JN(t,n);var x=(n.flags&128)!==0;if(!u&&!x)return d&&tR(n,o,!1),Ic(t,n,g);u=n.stateNode,nW.current=n;var T=x&&typeof o.getDerivedStateFromError!="function"?null:u.render();return n.flags|=1,t!==null&&x?(n.child=hp(n,t.child,null,g),n.child=hp(n,null,T,g)):gs(t,n,T,g),n.memoizedState=u.state,d&&tR(n,o,!0),n.child}function eF(t){var n=t.stateNode;n.pendingContext?eR(t,n.pendingContext,n.pendingContext!==n.context):n.context&&eR(t,n.context,!1),zM(t,n.containerInfo)}function _R(t,n,o,u,d){return up(),kM(d),n.flags|=256,gs(t,n,o,u),n.child}var QT={dehydrated:null,treeContext:null,retryLane:0};function KT(t){return{baseLanes:t,cachePool:null,transitions:null}}function tF(t,n,o){var u=n.pendingProps,d=Ni.current,g=!1,x=(n.flags&128)!==0,T;if((T=x)||(T=t!==null&&t.memoizedState===null?!1:(d&2)!==0),T?(g=!0,n.flags&=-129):(t===null||t.memoizedState!==null)&&(d|=1),bi(Ni,d&1),t===null)return GT(n),t=n.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(n.mode&1?t.data==="$!"?n.lanes=8:n.lanes=1073741824:n.lanes=1,null):(x=u.children,t=u.fallback,g?(u=n.mode,g=n.child,x={mode:"hidden",children:x},!(u&1)&&g!==null?(g.childLanes=0,g.pendingProps=x):g=T1(x,u,0,null),t=ed(t,u,o,null),g.return=n,t.return=n,g.sibling=t,n.child=g,n.child.memoizedState=KT(o),n.memoizedState=QT,t):GM(n,x));if(d=t.memoizedState,d!==null&&(T=d.dehydrated,T!==null))return iW(t,n,x,u,T,d,o);if(g){g=u.fallback,x=n.mode,d=t.child,T=d.sibling;var s={mode:"hidden",children:u.children};return!(x&1)&&n.child!==d?(u=n.child,u.childLanes=0,u.pendingProps=s,n.deletions=null):(u=Nu(d,s),u.subtreeFlags=d.subtreeFlags&14680064),T!==null?g=Nu(T,g):(g=ed(g,x,o,null),g.flags|=2),g.return=n,u.return=n,u.sibling=g,n.child=u,u=g,g=n.child,x=t.child.memoizedState,x=x===null?KT(o):{baseLanes:x.baseLanes|o,cachePool:null,transitions:x.transitions},g.memoizedState=x,g.childLanes=t.childLanes&~o,n.memoizedState=QT,u}return g=t.child,t=g.sibling,u=Nu(g,{mode:"visible",children:u.children}),!(n.mode&1)&&(u.lanes=o),u.return=n,u.sibling=null,t!==null&&(o=n.deletions,o===null?(n.deletions=[t],n.flags|=16):o.push(t)),n.child=u,n.memoizedState=null,u}function GM(t,n){return n=T1({mode:"visible",children:n},t.mode,0,null),n.return=t,t.child=n}function I0(t,n,o,u){return u!==null&&kM(u),hp(n,t.child,null,o),t=GM(n,n.pendingProps.children),t.flags|=2,n.memoizedState=null,t}function iW(t,n,o,u,d,g,x){if(o)return n.flags&256?(n.flags&=-257,u=UE(Error(Kt(422))),I0(t,n,x,u)):n.memoizedState!==null?(n.child=t.child,n.flags|=128,null):(g=u.fallback,d=n.mode,u=T1({mode:"visible",children:u.children},d,0,null),g=ed(g,d,x,null),g.flags|=2,u.return=n,g.return=n,u.sibling=g,n.child=u,n.mode&1&&hp(n,t.child,null,x),n.child.memoizedState=KT(x),n.memoizedState=QT,g);if(!(n.mode&1))return I0(t,n,x,null);if(d.data==="$!"){if(u=d.nextSibling&&d.nextSibling.dataset,u)var T=u.dgst;return u=T,g=Error(Kt(419)),u=UE(g,u,void 0),I0(t,n,x,u)}if(T=(x&t.childLanes)!==0,zs||T){if(u=Ao,u!==null){switch(x&-x){case 4:d=2;break;case 16:d=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:d=32;break;case 536870912:d=268435456;break;default:d=0}d=d&(u.suspendedLanes|x)?0:d,d!==0&&d!==g.retryLane&&(g.retryLane=d,Mc(t,d),ol(u,t,d,-1))}return YM(),u=UE(Error(Kt(421))),I0(t,n,x,u)}return d.data==="$?"?(n.flags|=128,n.child=t.child,n=_W.bind(null,t),d._reactRetry=n,null):(t=g.treeContext,oa=Du(d.nextSibling),sa=n,Pi=!0,rl=null,t!==null&&(Sa[Ta++]=yc,Sa[Ta++]=vc,Sa[Ta++]=od,yc=t.id,vc=t.overflow,od=n),n=GM(n,u.children),n.flags|=4096,n)}function yR(t,n,o){t.lanes|=n;var u=t.alternate;u!==null&&(u.lanes|=n),qT(t.return,n,o)}function VE(t,n,o,u,d){var g=t.memoizedState;g===null?t.memoizedState={isBackwards:n,rendering:null,renderingStartTime:0,last:u,tail:o,tailMode:d}:(g.isBackwards=n,g.rendering=null,g.renderingStartTime=0,g.last=u,g.tail=o,g.tailMode=d)}function rF(t,n,o){var u=n.pendingProps,d=u.revealOrder,g=u.tail;if(gs(t,n,u.children,o),u=Ni.current,u&2)u=u&1|2,n.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=n.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&yR(t,o,n);else if(t.tag===19)yR(t,o,n);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===n)break e;for(;t.sibling===null;){if(t.return===null||t.return===n)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}u&=1}if(bi(Ni,u),!(n.mode&1))n.memoizedState=null;else switch(d){case"forwards":for(o=n.child,d=null;o!==null;)t=o.alternate,t!==null&&Vx(t)===null&&(d=o),o=o.sibling;o=d,o===null?(d=n.child,n.child=null):(d=o.sibling,o.sibling=null),VE(n,!1,d,o,g);break;case"backwards":for(o=null,d=n.child,n.child=null;d!==null;){if(t=d.alternate,t!==null&&Vx(t)===null){n.child=d;break}t=d.sibling,d.sibling=o,o=d,d=t}VE(n,!0,o,null,g);break;case"together":VE(n,!1,null,null,void 0);break;default:n.memoizedState=null}return n.child}function cx(t,n){!(n.mode&1)&&t!==null&&(t.alternate=null,n.alternate=null,n.flags|=2)}function Ic(t,n,o){if(t!==null&&(n.dependencies=t.dependencies),ad|=n.lanes,!(o&n.childLanes))return null;if(t!==null&&n.child!==t.child)throw Error(Kt(153));if(n.child!==null){for(t=n.child,o=Nu(t,t.pendingProps),n.child=o,o.return=n;t.sibling!==null;)t=t.sibling,o=o.sibling=Nu(t,t.pendingProps),o.return=n;o.sibling=null}return n.child}function oW(t,n,o){switch(n.tag){case 3:eF(n),up();break;case 5:AN(n);break;case 1:Fs(n.type)&&Nx(n);break;case 4:zM(n,n.stateNode.containerInfo);break;case 10:var u=n.type._context,d=n.memoizedProps.value;bi(jx,u._currentValue),u._currentValue=d;break;case 13:if(u=n.memoizedState,u!==null)return u.dehydrated!==null?(bi(Ni,Ni.current&1),n.flags|=128,null):o&n.child.childLanes?tF(t,n,o):(bi(Ni,Ni.current&1),t=Ic(t,n,o),t!==null?t.sibling:null);bi(Ni,Ni.current&1);break;case 19:if(u=(o&n.childLanes)!==0,t.flags&128){if(u)return rF(t,n,o);n.flags|=128}if(d=n.memoizedState,d!==null&&(d.rendering=null,d.tail=null,d.lastEffect=null),bi(Ni,Ni.current),u)break;return null;case 22:case 23:return n.lanes=0,KN(t,n,o)}return Ic(t,n,o)}var nF,JT,iF,oF;nF=function(t,n){for(var o=n.child;o!==null;){if(o.tag===5||o.tag===6)t.appendChild(o.stateNode);else if(o.tag!==4&&o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return;o=o.return}o.sibling.return=o.return,o=o.sibling}};JT=function(){};iF=function(t,n,o,u){var d=t.memoizedProps;if(d!==u){t=n.stateNode,Yh(Nl.current);var g=null;switch(o){case"input":d=bT(t,d),u=bT(t,u),g=[];break;case"select":d=Bi({},d,{value:void 0}),u=Bi({},u,{value:void 0}),g=[];break;case"textarea":d=ST(t,d),u=ST(t,u),g=[];break;default:typeof d.onClick!="function"&&typeof u.onClick=="function"&&(t.onclick=Lx)}CT(o,u);var x;o=null;for(I in d)if(!u.hasOwnProperty(I)&&d.hasOwnProperty(I)&&d[I]!=null)if(I==="style"){var T=d[I];for(x in T)T.hasOwnProperty(x)&&(o||(o={}),o[x]="")}else I!=="dangerouslySetInnerHTML"&&I!=="children"&&I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&I!=="autoFocus"&&(S_.hasOwnProperty(I)?g||(g=[]):(g=g||[]).push(I,null));for(I in u){var s=u[I];if(T=d!=null?d[I]:void 0,u.hasOwnProperty(I)&&s!==T&&(s!=null||T!=null))if(I==="style")if(T){for(x in T)!T.hasOwnProperty(x)||s&&s.hasOwnProperty(x)||(o||(o={}),o[x]="");for(x in s)s.hasOwnProperty(x)&&T[x]!==s[x]&&(o||(o={}),o[x]=s[x])}else o||(g||(g=[]),g.push(I,o)),o=s;else I==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,T=T?T.__html:void 0,s!=null&&T!==s&&(g=g||[]).push(I,s)):I==="children"?typeof s!="string"&&typeof s!="number"||(g=g||[]).push(I,""+s):I!=="suppressContentEditableWarning"&&I!=="suppressHydrationWarning"&&(S_.hasOwnProperty(I)?(s!=null&&I==="onScroll"&&Si("scroll",t),g||T===s||(g=[])):(g=g||[]).push(I,s))}o&&(g=g||[]).push("style",o);var I=g;(n.updateQueue=I)&&(n.flags|=4)}};oF=function(t,n,o,u){o!==u&&(n.flags|=4)};function dg(t,n){if(!Pi)switch(t.tailMode){case"hidden":n=t.tail;for(var o=null;n!==null;)n.alternate!==null&&(o=n),n=n.sibling;o===null?t.tail=null:o.sibling=null;break;case"collapsed":o=t.tail;for(var u=null;o!==null;)o.alternate!==null&&(u=o),o=o.sibling;u===null?n||t.tail===null?t.tail=null:t.tail.sibling=null:u.sibling=null}}function ts(t){var n=t.alternate!==null&&t.alternate.child===t.child,o=0,u=0;if(n)for(var d=t.child;d!==null;)o|=d.lanes|d.childLanes,u|=d.subtreeFlags&14680064,u|=d.flags&14680064,d.return=t,d=d.sibling;else for(d=t.child;d!==null;)o|=d.lanes|d.childLanes,u|=d.subtreeFlags,u|=d.flags,d.return=t,d=d.sibling;return t.subtreeFlags|=u,t.childLanes=o,n}function sW(t,n,o){var u=n.pendingProps;switch(AM(n),n.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ts(n),null;case 1:return Fs(n.type)&&zx(),ts(n),null;case 3:return u=n.stateNode,dp(),Mi(Ns),Mi(ss),FM(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(t===null||t.child===null)&&(C0(n)?n.flags|=4:t===null||t.memoizedState.isDehydrated&&!(n.flags&256)||(n.flags|=1024,rl!==null&&(aC(rl),rl=null))),JT(t,n),ts(n),null;case 5:NM(n);var d=Yh(z_.current);if(o=n.type,t!==null&&n.stateNode!=null)iF(t,n,o,u,d),t.ref!==n.ref&&(n.flags|=512,n.flags|=2097152);else{if(!u){if(n.stateNode===null)throw Error(Kt(166));return ts(n),null}if(t=Yh(Nl.current),C0(n)){u=n.stateNode,o=n.type;var g=n.memoizedProps;switch(u[Dl]=n,u[R_]=g,t=(n.mode&1)!==0,o){case"dialog":Si("cancel",u),Si("close",u);break;case"iframe":case"object":case"embed":Si("load",u);break;case"video":case"audio":for(d=0;d<t_.length;d++)Si(t_[d],u);break;case"source":Si("error",u);break;case"img":case"image":case"link":Si("error",u),Si("load",u);break;case"details":Si("toggle",u);break;case"input":M3(u,g),Si("invalid",u);break;case"select":u._wrapperState={wasMultiple:!!g.multiple},Si("invalid",u);break;case"textarea":A3(u,g),Si("invalid",u)}CT(o,g),d=null;for(var x in g)if(g.hasOwnProperty(x)){var T=g[x];x==="children"?typeof T=="string"?u.textContent!==T&&(g.suppressHydrationWarning!==!0&&T0(u.textContent,T,t),d=["children",T]):typeof T=="number"&&u.textContent!==""+T&&(g.suppressHydrationWarning!==!0&&T0(u.textContent,T,t),d=["children",""+T]):S_.hasOwnProperty(x)&&T!=null&&x==="onScroll"&&Si("scroll",u)}switch(o){case"input":_0(u),I3(u,g,!0);break;case"textarea":_0(u),k3(u);break;case"select":case"option":break;default:typeof g.onClick=="function"&&(u.onclick=Lx)}u=d,n.updateQueue=u,u!==null&&(n.flags|=4)}else{x=d.nodeType===9?d:d.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Oz(o)),t==="http://www.w3.org/1999/xhtml"?o==="script"?(t=x.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof u.is=="string"?t=x.createElement(o,{is:u.is}):(t=x.createElement(o),o==="select"&&(x=t,u.multiple?x.multiple=!0:u.size&&(x.size=u.size))):t=x.createElementNS(t,o),t[Dl]=n,t[R_]=u,nF(t,n,!1,!1),n.stateNode=t;e:{switch(x=MT(o,u),o){case"dialog":Si("cancel",t),Si("close",t),d=u;break;case"iframe":case"object":case"embed":Si("load",t),d=u;break;case"video":case"audio":for(d=0;d<t_.length;d++)Si(t_[d],t);d=u;break;case"source":Si("error",t),d=u;break;case"img":case"image":case"link":Si("error",t),Si("load",t),d=u;break;case"details":Si("toggle",t),d=u;break;case"input":M3(t,u),d=bT(t,u),Si("invalid",t);break;case"option":d=u;break;case"select":t._wrapperState={wasMultiple:!!u.multiple},d=Bi({},u,{value:void 0}),Si("invalid",t);break;case"textarea":A3(t,u),d=ST(t,u),Si("invalid",t);break;default:d=u}CT(o,d),T=d;for(g in T)if(T.hasOwnProperty(g)){var s=T[g];g==="style"?Lz(t,s):g==="dangerouslySetInnerHTML"?(s=s?s.__html:void 0,s!=null&&Dz(t,s)):g==="children"?typeof s=="string"?(o!=="textarea"||s!=="")&&T_(t,s):typeof s=="number"&&T_(t,""+s):g!=="suppressContentEditableWarning"&&g!=="suppressHydrationWarning"&&g!=="autoFocus"&&(S_.hasOwnProperty(g)?s!=null&&g==="onScroll"&&Si("scroll",t):s!=null&&pM(t,g,s,x))}switch(o){case"input":_0(t),I3(t,u,!1);break;case"textarea":_0(t),k3(t);break;case"option":u.value!=null&&t.setAttribute("value",""+Vu(u.value));break;case"select":t.multiple=!!u.multiple,g=u.value,g!=null?Qf(t,!!u.multiple,g,!1):u.defaultValue!=null&&Qf(t,!!u.multiple,u.defaultValue,!0);break;default:typeof d.onClick=="function"&&(t.onclick=Lx)}switch(o){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}}u&&(n.flags|=4)}n.ref!==null&&(n.flags|=512,n.flags|=2097152)}return ts(n),null;case 6:if(t&&n.stateNode!=null)oF(t,n,t.memoizedProps,u);else{if(typeof u!="string"&&n.stateNode===null)throw Error(Kt(166));if(o=Yh(z_.current),Yh(Nl.current),C0(n)){if(u=n.stateNode,o=n.memoizedProps,u[Dl]=n,(g=u.nodeValue!==o)&&(t=sa,t!==null))switch(t.tag){case 3:T0(u.nodeValue,o,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&T0(u.nodeValue,o,(t.mode&1)!==0)}g&&(n.flags|=4)}else u=(o.nodeType===9?o:o.ownerDocument).createTextNode(u),u[Dl]=n,n.stateNode=u}return ts(n),null;case 13:if(Mi(Ni),u=n.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Pi&&oa!==null&&n.mode&1&&!(n.flags&128))wN(),up(),n.flags|=98560,g=!1;else if(g=C0(n),u!==null&&u.dehydrated!==null){if(t===null){if(!g)throw Error(Kt(318));if(g=n.memoizedState,g=g!==null?g.dehydrated:null,!g)throw Error(Kt(317));g[Dl]=n}else up(),!(n.flags&128)&&(n.memoizedState=null),n.flags|=4;ts(n),g=!1}else rl!==null&&(aC(rl),rl=null),g=!0;if(!g)return n.flags&65536?n:null}return n.flags&128?(n.lanes=o,n):(u=u!==null,u!==(t!==null&&t.memoizedState!==null)&&u&&(n.child.flags|=8192,n.mode&1&&(t===null||Ni.current&1?_o===0&&(_o=3):YM())),n.updateQueue!==null&&(n.flags|=4),ts(n),null);case 4:return dp(),JT(t,n),t===null&&O_(n.stateNode.containerInfo),ts(n),null;case 10:return DM(n.type._context),ts(n),null;case 17:return Fs(n.type)&&zx(),ts(n),null;case 19:if(Mi(Ni),g=n.memoizedState,g===null)return ts(n),null;if(u=(n.flags&128)!==0,x=g.rendering,x===null)if(u)dg(g,!1);else{if(_o!==0||t!==null&&t.flags&128)for(t=n.child;t!==null;){if(x=Vx(t),x!==null){for(n.flags|=128,dg(g,!1),u=x.updateQueue,u!==null&&(n.updateQueue=u,n.flags|=4),n.subtreeFlags=0,u=o,o=n.child;o!==null;)g=o,t=u,g.flags&=14680066,x=g.alternate,x===null?(g.childLanes=0,g.lanes=t,g.child=null,g.subtreeFlags=0,g.memoizedProps=null,g.memoizedState=null,g.updateQueue=null,g.dependencies=null,g.stateNode=null):(g.childLanes=x.childLanes,g.lanes=x.lanes,g.child=x.child,g.subtreeFlags=0,g.deletions=null,g.memoizedProps=x.memoizedProps,g.memoizedState=x.memoizedState,g.updateQueue=x.updateQueue,g.type=x.type,t=x.dependencies,g.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),o=o.sibling;return bi(Ni,Ni.current&1|2),n.child}t=t.sibling}g.tail!==null&&ro()>pp&&(n.flags|=128,u=!0,dg(g,!1),n.lanes=4194304)}else{if(!u)if(t=Vx(x),t!==null){if(n.flags|=128,u=!0,o=t.updateQueue,o!==null&&(n.updateQueue=o,n.flags|=4),dg(g,!0),g.tail===null&&g.tailMode==="hidden"&&!x.alternate&&!Pi)return ts(n),null}else 2*ro()-g.renderingStartTime>pp&&o!==1073741824&&(n.flags|=128,u=!0,dg(g,!1),n.lanes=4194304);g.isBackwards?(x.sibling=n.child,n.child=x):(o=g.last,o!==null?o.sibling=x:n.child=x,g.last=x)}return g.tail!==null?(n=g.tail,g.rendering=n,g.tail=n.sibling,g.renderingStartTime=ro(),n.sibling=null,o=Ni.current,bi(Ni,u?o&1|2:o&1),n):(ts(n),null);case 22:case 23:return XM(),u=n.memoizedState!==null,t!==null&&t.memoizedState!==null!==u&&(n.flags|=8192),u&&n.mode&1?ra&1073741824&&(ts(n),n.subtreeFlags&6&&(n.flags|=8192)):ts(n),null;case 24:return null;case 25:return null}throw Error(Kt(156,n.tag))}function aW(t,n){switch(AM(n),n.tag){case 1:return Fs(n.type)&&zx(),t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 3:return dp(),Mi(Ns),Mi(ss),FM(),t=n.flags,t&65536&&!(t&128)?(n.flags=t&-65537|128,n):null;case 5:return NM(n),null;case 13:if(Mi(Ni),t=n.memoizedState,t!==null&&t.dehydrated!==null){if(n.alternate===null)throw Error(Kt(340));up()}return t=n.flags,t&65536?(n.flags=t&-65537|128,n):null;case 19:return Mi(Ni),null;case 4:return dp(),null;case 10:return DM(n.type._context),null;case 22:case 23:return XM(),null;case 24:return null;default:return null}}var A0=!1,is=!1,lW=typeof WeakSet=="function"?WeakSet:Set,_r=null;function Gf(t,n){var o=t.ref;if(o!==null)if(typeof o=="function")try{o(null)}catch(u){qi(t,n,u)}else o.current=null}function eC(t,n,o){try{o()}catch(u){qi(t,n,u)}}var vR=!1;function cW(t,n){if(NT=Ox,t=cN(),MM(t)){if("selectionStart"in t)var o={start:t.selectionStart,end:t.selectionEnd};else e:{o=(o=t.ownerDocument)&&o.defaultView||window;var u=o.getSelection&&o.getSelection();if(u&&u.rangeCount!==0){o=u.anchorNode;var d=u.anchorOffset,g=u.focusNode;u=u.focusOffset;try{o.nodeType,g.nodeType}catch{o=null;break e}var x=0,T=-1,s=-1,I=0,O=0,D=t,N=null;t:for(;;){for(var j;D!==o||d!==0&&D.nodeType!==3||(T=x+d),D!==g||u!==0&&D.nodeType!==3||(s=x+u),D.nodeType===3&&(x+=D.nodeValue.length),(j=D.firstChild)!==null;)N=D,D=j;for(;;){if(D===t)break t;if(N===o&&++I===d&&(T=x),N===g&&++O===u&&(s=x),(j=D.nextSibling)!==null)break;D=N,N=D.parentNode}D=j}o=T===-1||s===-1?null:{start:T,end:s}}else o=null}o=o||{start:0,end:0}}else o=null;for(FT={focusedElem:t,selectionRange:o},Ox=!1,_r=n;_r!==null;)if(n=_r,t=n.child,(n.subtreeFlags&1028)!==0&&t!==null)t.return=n,_r=t;else for(;_r!==null;){n=_r;try{var G=n.alternate;if(n.flags&1024)switch(n.tag){case 0:case 11:case 15:break;case 1:if(G!==null){var X=G.memoizedProps,te=G.memoizedState,H=n.stateNode,U=H.getSnapshotBeforeUpdate(n.elementType===n.type?X:Ka(n.type,X),te);H.__reactInternalSnapshotBeforeUpdate=U}break;case 3:var q=n.stateNode.containerInfo;q.nodeType===1?q.textContent="":q.nodeType===9&&q.documentElement&&q.removeChild(q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Kt(163))}}catch(J){qi(n,n.return,J)}if(t=n.sibling,t!==null){t.return=n.return,_r=t;break}_r=n.return}return G=vR,vR=!1,G}function d_(t,n,o){var u=n.updateQueue;if(u=u!==null?u.lastEffect:null,u!==null){var d=u=u.next;do{if((d.tag&t)===t){var g=d.destroy;d.destroy=void 0,g!==void 0&&eC(n,o,g)}d=d.next}while(d!==u)}}function E1(t,n){if(n=n.updateQueue,n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&t)===t){var u=o.create;o.destroy=u()}o=o.next}while(o!==n)}}function tC(t){var n=t.ref;if(n!==null){var o=t.stateNode;switch(t.tag){case 5:t=o;break;default:t=o}typeof n=="function"?n(t):n.current=t}}function sF(t){var n=t.alternate;n!==null&&(t.alternate=null,sF(n)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(n=t.stateNode,n!==null&&(delete n[Dl],delete n[R_],delete n[$T],delete n[qq],delete n[Wq])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function aF(t){return t.tag===5||t.tag===3||t.tag===4}function xR(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||aF(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function rC(t,n,o){var u=t.tag;if(u===5||u===6)t=t.stateNode,n?o.nodeType===8?o.parentNode.insertBefore(t,n):o.insertBefore(t,n):(o.nodeType===8?(n=o.parentNode,n.insertBefore(t,o)):(n=o,n.appendChild(t)),o=o._reactRootContainer,o!=null||n.onclick!==null||(n.onclick=Lx));else if(u!==4&&(t=t.child,t!==null))for(rC(t,n,o),t=t.sibling;t!==null;)rC(t,n,o),t=t.sibling}function nC(t,n,o){var u=t.tag;if(u===5||u===6)t=t.stateNode,n?o.insertBefore(t,n):o.appendChild(t);else if(u!==4&&(t=t.child,t!==null))for(nC(t,n,o),t=t.sibling;t!==null;)nC(t,n,o),t=t.sibling}var jo=null,Ja=!1;function hu(t,n,o){for(o=o.child;o!==null;)lF(t,n,o),o=o.sibling}function lF(t,n,o){if(zl&&typeof zl.onCommitFiberUnmount=="function")try{zl.onCommitFiberUnmount(m1,o)}catch{}switch(o.tag){case 5:is||Gf(o,n);case 6:var u=jo,d=Ja;jo=null,hu(t,n,o),jo=u,Ja=d,jo!==null&&(Ja?(t=jo,o=o.stateNode,t.nodeType===8?t.parentNode.removeChild(o):t.removeChild(o)):jo.removeChild(o.stateNode));break;case 18:jo!==null&&(Ja?(t=jo,o=o.stateNode,t.nodeType===8?zE(t.parentNode,o):t.nodeType===1&&zE(t,o),A_(t)):zE(jo,o.stateNode));break;case 4:u=jo,d=Ja,jo=o.stateNode.containerInfo,Ja=!0,hu(t,n,o),jo=u,Ja=d;break;case 0:case 11:case 14:case 15:if(!is&&(u=o.updateQueue,u!==null&&(u=u.lastEffect,u!==null))){d=u=u.next;do{var g=d,x=g.destroy;g=g.tag,x!==void 0&&(g&2||g&4)&&eC(o,n,x),d=d.next}while(d!==u)}hu(t,n,o);break;case 1:if(!is&&(Gf(o,n),u=o.stateNode,typeof u.componentWillUnmount=="function"))try{u.props=o.memoizedProps,u.state=o.memoizedState,u.componentWillUnmount()}catch(T){qi(o,n,T)}hu(t,n,o);break;case 21:hu(t,n,o);break;case 22:o.mode&1?(is=(u=is)||o.memoizedState!==null,hu(t,n,o),is=u):hu(t,n,o);break;default:hu(t,n,o)}}function bR(t){var n=t.updateQueue;if(n!==null){t.updateQueue=null;var o=t.stateNode;o===null&&(o=t.stateNode=new lW),n.forEach(function(u){var d=yW.bind(null,t,u);o.has(u)||(o.add(u),u.then(d,d))})}}function Qa(t,n){var o=n.deletions;if(o!==null)for(var u=0;u<o.length;u++){var d=o[u];try{var g=t,x=n,T=x;e:for(;T!==null;){switch(T.tag){case 5:jo=T.stateNode,Ja=!1;break e;case 3:jo=T.stateNode.containerInfo,Ja=!0;break e;case 4:jo=T.stateNode.containerInfo,Ja=!0;break e}T=T.return}if(jo===null)throw Error(Kt(160));lF(g,x,d),jo=null,Ja=!1;var s=d.alternate;s!==null&&(s.return=null),d.return=null}catch(I){qi(d,n,I)}}if(n.subtreeFlags&12854)for(n=n.child;n!==null;)cF(n,t),n=n.sibling}function cF(t,n){var o=t.alternate,u=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Qa(n,t),Il(t),u&4){try{d_(3,t,t.return),E1(3,t)}catch(X){qi(t,t.return,X)}try{d_(5,t,t.return)}catch(X){qi(t,t.return,X)}}break;case 1:Qa(n,t),Il(t),u&512&&o!==null&&Gf(o,o.return);break;case 5:if(Qa(n,t),Il(t),u&512&&o!==null&&Gf(o,o.return),t.flags&32){var d=t.stateNode;try{T_(d,"")}catch(X){qi(t,t.return,X)}}if(u&4&&(d=t.stateNode,d!=null)){var g=t.memoizedProps,x=o!==null?o.memoizedProps:g,T=t.type,s=t.updateQueue;if(t.updateQueue=null,s!==null)try{T==="input"&&g.type==="radio"&&g.name!=null&&kz(d,g),MT(T,x);var I=MT(T,g);for(x=0;x<s.length;x+=2){var O=s[x],D=s[x+1];O==="style"?Lz(d,D):O==="dangerouslySetInnerHTML"?Dz(d,D):O==="children"?T_(d,D):pM(d,O,D,I)}switch(T){case"input":wT(d,g);break;case"textarea":Pz(d,g);break;case"select":var N=d._wrapperState.wasMultiple;d._wrapperState.wasMultiple=!!g.multiple;var j=g.value;j!=null?Qf(d,!!g.multiple,j,!1):N!==!!g.multiple&&(g.defaultValue!=null?Qf(d,!!g.multiple,g.defaultValue,!0):Qf(d,!!g.multiple,g.multiple?[]:"",!1))}d[R_]=g}catch(X){qi(t,t.return,X)}}break;case 6:if(Qa(n,t),Il(t),u&4){if(t.stateNode===null)throw Error(Kt(162));d=t.stateNode,g=t.memoizedProps;try{d.nodeValue=g}catch(X){qi(t,t.return,X)}}break;case 3:if(Qa(n,t),Il(t),u&4&&o!==null&&o.memoizedState.isDehydrated)try{A_(n.containerInfo)}catch(X){qi(t,t.return,X)}break;case 4:Qa(n,t),Il(t);break;case 13:Qa(n,t),Il(t),d=t.child,d.flags&8192&&(g=d.memoizedState!==null,d.stateNode.isHidden=g,!g||d.alternate!==null&&d.alternate.memoizedState!==null||(HM=ro())),u&4&&bR(t);break;case 22:if(O=o!==null&&o.memoizedState!==null,t.mode&1?(is=(I=is)||O,Qa(n,t),is=I):Qa(n,t),Il(t),u&8192){if(I=t.memoizedState!==null,(t.stateNode.isHidden=I)&&!O&&t.mode&1)for(_r=t,O=t.child;O!==null;){for(D=_r=O;_r!==null;){switch(N=_r,j=N.child,N.tag){case 0:case 11:case 14:case 15:d_(4,N,N.return);break;case 1:Gf(N,N.return);var G=N.stateNode;if(typeof G.componentWillUnmount=="function"){u=N,o=N.return;try{n=u,G.props=n.memoizedProps,G.state=n.memoizedState,G.componentWillUnmount()}catch(X){qi(u,o,X)}}break;case 5:Gf(N,N.return);break;case 22:if(N.memoizedState!==null){ER(D);continue}}j!==null?(j.return=N,_r=j):ER(D)}O=O.sibling}e:for(O=null,D=t;;){if(D.tag===5){if(O===null){O=D;try{d=D.stateNode,I?(g=d.style,typeof g.setProperty=="function"?g.setProperty("display","none","important"):g.display="none"):(T=D.stateNode,s=D.memoizedProps.style,x=s!=null&&s.hasOwnProperty("display")?s.display:null,T.style.display=Rz("display",x))}catch(X){qi(t,t.return,X)}}}else if(D.tag===6){if(O===null)try{D.stateNode.nodeValue=I?"":D.memoizedProps}catch(X){qi(t,t.return,X)}}else if((D.tag!==22&&D.tag!==23||D.memoizedState===null||D===t)&&D.child!==null){D.child.return=D,D=D.child;continue}if(D===t)break e;for(;D.sibling===null;){if(D.return===null||D.return===t)break e;O===D&&(O=null),D=D.return}O===D&&(O=null),D.sibling.return=D.return,D=D.sibling}}break;case 19:Qa(n,t),Il(t),u&4&&bR(t);break;case 21:break;default:Qa(n,t),Il(t)}}function Il(t){var n=t.flags;if(n&2){try{e:{for(var o=t.return;o!==null;){if(aF(o)){var u=o;break e}o=o.return}throw Error(Kt(160))}switch(u.tag){case 5:var d=u.stateNode;u.flags&32&&(T_(d,""),u.flags&=-33);var g=xR(t);nC(t,g,d);break;case 3:case 4:var x=u.stateNode.containerInfo,T=xR(t);rC(t,T,x);break;default:throw Error(Kt(161))}}catch(s){qi(t,t.return,s)}t.flags&=-3}n&4096&&(t.flags&=-4097)}function uW(t,n,o){_r=t,uF(t)}function uF(t,n,o){for(var u=(t.mode&1)!==0;_r!==null;){var d=_r,g=d.child;if(d.tag===22&&u){var x=d.memoizedState!==null||A0;if(!x){var T=d.alternate,s=T!==null&&T.memoizedState!==null||is;T=A0;var I=is;if(A0=x,(is=s)&&!I)for(_r=d;_r!==null;)x=_r,s=x.child,x.tag===22&&x.memoizedState!==null?SR(d):s!==null?(s.return=x,_r=s):SR(d);for(;g!==null;)_r=g,uF(g),g=g.sibling;_r=d,A0=T,is=I}wR(t)}else d.subtreeFlags&8772&&g!==null?(g.return=d,_r=g):wR(t)}}function wR(t){for(;_r!==null;){var n=_r;if(n.flags&8772){var o=n.alternate;try{if(n.flags&8772)switch(n.tag){case 0:case 11:case 15:is||E1(5,n);break;case 1:var u=n.stateNode;if(n.flags&4&&!is)if(o===null)u.componentDidMount();else{var d=n.elementType===n.type?o.memoizedProps:Ka(n.type,o.memoizedProps);u.componentDidUpdate(d,o.memoizedState,u.__reactInternalSnapshotBeforeUpdate)}var g=n.updateQueue;g!==null&&oR(n,g,u);break;case 3:var x=n.updateQueue;if(x!==null){if(o=null,n.child!==null)switch(n.child.tag){case 5:o=n.child.stateNode;break;case 1:o=n.child.stateNode}oR(n,x,o)}break;case 5:var T=n.stateNode;if(o===null&&n.flags&4){o=T;var s=n.memoizedProps;switch(n.type){case"button":case"input":case"select":case"textarea":s.autoFocus&&o.focus();break;case"img":s.src&&(o.src=s.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(n.memoizedState===null){var I=n.alternate;if(I!==null){var O=I.memoizedState;if(O!==null){var D=O.dehydrated;D!==null&&A_(D)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Kt(163))}is||n.flags&512&&tC(n)}catch(N){qi(n,n.return,N)}}if(n===t){_r=null;break}if(o=n.sibling,o!==null){o.return=n.return,_r=o;break}_r=n.return}}function ER(t){for(;_r!==null;){var n=_r;if(n===t){_r=null;break}var o=n.sibling;if(o!==null){o.return=n.return,_r=o;break}_r=n.return}}function SR(t){for(;_r!==null;){var n=_r;try{switch(n.tag){case 0:case 11:case 15:var o=n.return;try{E1(4,n)}catch(s){qi(n,o,s)}break;case 1:var u=n.stateNode;if(typeof u.componentDidMount=="function"){var d=n.return;try{u.componentDidMount()}catch(s){qi(n,d,s)}}var g=n.return;try{tC(n)}catch(s){qi(n,g,s)}break;case 5:var x=n.return;try{tC(n)}catch(s){qi(n,x,s)}}}catch(s){qi(n,n.return,s)}if(n===t){_r=null;break}var T=n.sibling;if(T!==null){T.return=n.return,_r=T;break}_r=n.return}}var hW=Math.ceil,Wx=Rc.ReactCurrentDispatcher,qM=Rc.ReactCurrentOwner,Aa=Rc.ReactCurrentBatchConfig,zn=0,Ao=null,lo=null,Uo=0,ra=0,qf=Yu(0),_o=0,j_=null,ad=0,S1=0,WM=0,f_=null,Ls=null,HM=0,pp=1/0,gc=null,Hx=!1,iC=null,Lu=null,k0=!1,Mu=null,Zx=0,p_=0,oC=null,ux=-1,hx=0;function _s(){return zn&6?ro():ux!==-1?ux:ux=ro()}function zu(t){return t.mode&1?zn&2&&Uo!==0?Uo&-Uo:Zq.transition!==null?(hx===0&&(hx=Hz()),hx):(t=ni,t!==0||(t=window.event,t=t===void 0?16:eN(t.type)),t):1}function ol(t,n,o,u){if(50<p_)throw p_=0,oC=null,Error(Kt(185));ny(t,o,u),(!(zn&2)||t!==Ao)&&(t===Ao&&(!(zn&2)&&(S1|=o),_o===4&&Tu(t,Uo)),Bs(t,u),o===1&&zn===0&&!(n.mode&1)&&(pp=ro()+500,x1&&Qu()))}function Bs(t,n){var o=t.callbackNode;ZG(t,n);var u=Px(t,t===Ao?Uo:0);if(u===0)o!==null&&D3(o),t.callbackNode=null,t.callbackPriority=0;else if(n=u&-u,t.callbackPriority!==n){if(o!=null&&D3(o),n===1)t.tag===0?Hq(TR.bind(null,t)):vN(TR.bind(null,t)),Vq(function(){!(zn&6)&&Qu()}),o=null;else{switch(Zz(u)){case 1:o=vM;break;case 4:o=qz;break;case 16:o=kx;break;case 536870912:o=Wz;break;default:o=kx}o=yF(o,hF.bind(null,t))}t.callbackPriority=n,t.callbackNode=o}}function hF(t,n){if(ux=-1,hx=0,zn&6)throw Error(Kt(327));var o=t.callbackNode;if(rp()&&t.callbackNode!==o)return null;var u=Px(t,t===Ao?Uo:0);if(u===0)return null;if(u&30||u&t.expiredLanes||n)n=Xx(t,u);else{n=u;var d=zn;zn|=2;var g=fF();(Ao!==t||Uo!==n)&&(gc=null,pp=ro()+500,Jh(t,n));do try{pW();break}catch(T){dF(t,T)}while(!0);OM(),Wx.current=g,zn=d,lo!==null?n=0:(Ao=null,Uo=0,n=_o)}if(n!==0){if(n===2&&(d=OT(t),d!==0&&(u=d,n=sC(t,d))),n===1)throw o=j_,Jh(t,0),Tu(t,u),Bs(t,ro()),o;if(n===6)Tu(t,u);else{if(d=t.current.alternate,!(u&30)&&!dW(d)&&(n=Xx(t,u),n===2&&(g=OT(t),g!==0&&(u=g,n=sC(t,g))),n===1))throw o=j_,Jh(t,0),Tu(t,u),Bs(t,ro()),o;switch(t.finishedWork=d,t.finishedLanes=u,n){case 0:case 1:throw Error(Kt(345));case 2:Gh(t,Ls,gc);break;case 3:if(Tu(t,u),(u&130023424)===u&&(n=HM+500-ro(),10<n)){if(Px(t,0)!==0)break;if(d=t.suspendedLanes,(d&u)!==u){_s(),t.pingedLanes|=t.suspendedLanes&d;break}t.timeoutHandle=jT(Gh.bind(null,t,Ls,gc),n);break}Gh(t,Ls,gc);break;case 4:if(Tu(t,u),(u&4194240)===u)break;for(n=t.eventTimes,d=-1;0<u;){var x=31-il(u);g=1<<x,x=n[x],x>d&&(d=x),u&=~g}if(u=d,u=ro()-u,u=(120>u?120:480>u?480:1080>u?1080:1920>u?1920:3e3>u?3e3:4320>u?4320:1960*hW(u/1960))-u,10<u){t.timeoutHandle=jT(Gh.bind(null,t,Ls,gc),u);break}Gh(t,Ls,gc);break;case 5:Gh(t,Ls,gc);break;default:throw Error(Kt(329))}}}return Bs(t,ro()),t.callbackNode===o?hF.bind(null,t):null}function sC(t,n){var o=f_;return t.current.memoizedState.isDehydrated&&(Jh(t,n).flags|=256),t=Xx(t,n),t!==2&&(n=Ls,Ls=o,n!==null&&aC(n)),t}function aC(t){Ls===null?Ls=t:Ls.push.apply(Ls,t)}function dW(t){for(var n=t;;){if(n.flags&16384){var o=n.updateQueue;if(o!==null&&(o=o.stores,o!==null))for(var u=0;u<o.length;u++){var d=o[u],g=d.getSnapshot;d=d.value;try{if(!sl(g(),d))return!1}catch{return!1}}}if(o=n.child,n.subtreeFlags&16384&&o!==null)o.return=n,n=o;else{if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return!0;n=n.return}n.sibling.return=n.return,n=n.sibling}}return!0}function Tu(t,n){for(n&=~WM,n&=~S1,t.suspendedLanes|=n,t.pingedLanes&=~n,t=t.expirationTimes;0<n;){var o=31-il(n),u=1<<o;t[o]=-1,n&=~u}}function TR(t){if(zn&6)throw Error(Kt(327));rp();var n=Px(t,0);if(!(n&1))return Bs(t,ro()),null;var o=Xx(t,n);if(t.tag!==0&&o===2){var u=OT(t);u!==0&&(n=u,o=sC(t,u))}if(o===1)throw o=j_,Jh(t,0),Tu(t,n),Bs(t,ro()),o;if(o===6)throw Error(Kt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=n,Gh(t,Ls,gc),Bs(t,ro()),null}function ZM(t,n){var o=zn;zn|=1;try{return t(n)}finally{zn=o,zn===0&&(pp=ro()+500,x1&&Qu())}}function ld(t){Mu!==null&&Mu.tag===0&&!(zn&6)&&rp();var n=zn;zn|=1;var o=Aa.transition,u=ni;try{if(Aa.transition=null,ni=1,t)return t()}finally{ni=u,Aa.transition=o,zn=n,!(zn&6)&&Qu()}}function XM(){ra=qf.current,Mi(qf)}function Jh(t,n){t.finishedWork=null,t.finishedLanes=0;var o=t.timeoutHandle;if(o!==-1&&(t.timeoutHandle=-1,Uq(o)),lo!==null)for(o=lo.return;o!==null;){var u=o;switch(AM(u),u.tag){case 1:u=u.type.childContextTypes,u!=null&&zx();break;case 3:dp(),Mi(Ns),Mi(ss),FM();break;case 5:NM(u);break;case 4:dp();break;case 13:Mi(Ni);break;case 19:Mi(Ni);break;case 10:DM(u.type._context);break;case 22:case 23:XM()}o=o.return}if(Ao=t,lo=t=Nu(t.current,null),Uo=ra=n,_o=0,j_=null,WM=S1=ad=0,Ls=f_=null,Xh!==null){for(n=0;n<Xh.length;n++)if(o=Xh[n],u=o.interleaved,u!==null){o.interleaved=null;var d=u.next,g=o.pending;if(g!==null){var x=g.next;g.next=d,u.next=x}o.pending=u}Xh=null}return t}function dF(t,n){do{var o=lo;try{if(OM(),ax.current=qx,Gx){for(var u=Fi.memoizedState;u!==null;){var d=u.queue;d!==null&&(d.pending=null),u=u.next}Gx=!1}if(sd=0,Co=go=Fi=null,h_=!1,N_=0,qM.current=null,o===null||o.return===null){_o=1,j_=n,lo=null;break}e:{var g=t,x=o.return,T=o,s=n;if(n=Uo,T.flags|=32768,s!==null&&typeof s=="object"&&typeof s.then=="function"){var I=s,O=T,D=O.tag;if(!(O.mode&1)&&(D===0||D===11||D===15)){var N=O.alternate;N?(O.updateQueue=N.updateQueue,O.memoizedState=N.memoizedState,O.lanes=N.lanes):(O.updateQueue=null,O.memoizedState=null)}var j=dR(x);if(j!==null){j.flags&=-257,fR(j,x,T,g,n),j.mode&1&&hR(g,I,n),n=j,s=I;var G=n.updateQueue;if(G===null){var X=new Set;X.add(s),n.updateQueue=X}else G.add(s);break e}else{if(!(n&1)){hR(g,I,n),YM();break e}s=Error(Kt(426))}}else if(Pi&&T.mode&1){var te=dR(x);if(te!==null){!(te.flags&65536)&&(te.flags|=256),fR(te,x,T,g,n),kM(fp(s,T));break e}}g=s=fp(s,T),_o!==4&&(_o=2),f_===null?f_=[g]:f_.push(g),g=x;do{switch(g.tag){case 3:g.flags|=65536,n&=-n,g.lanes|=n;var H=XN(g,s,n);iR(g,H);break e;case 1:T=s;var U=g.type,q=g.stateNode;if(!(g.flags&128)&&(typeof U.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Lu===null||!Lu.has(q)))){g.flags|=65536,n&=-n,g.lanes|=n;var J=YN(g,T,n);iR(g,J);break e}}g=g.return}while(g!==null)}mF(o)}catch(pe){n=pe,lo===o&&o!==null&&(lo=o=o.return);continue}break}while(!0)}function fF(){var t=Wx.current;return Wx.current=qx,t===null?qx:t}function YM(){(_o===0||_o===3||_o===2)&&(_o=4),Ao===null||!(ad&268435455)&&!(S1&268435455)||Tu(Ao,Uo)}function Xx(t,n){var o=zn;zn|=2;var u=fF();(Ao!==t||Uo!==n)&&(gc=null,Jh(t,n));do try{fW();break}catch(d){dF(t,d)}while(!0);if(OM(),zn=o,Wx.current=u,lo!==null)throw Error(Kt(261));return Ao=null,Uo=0,_o}function fW(){for(;lo!==null;)pF(lo)}function pW(){for(;lo!==null&&!BG();)pF(lo)}function pF(t){var n=_F(t.alternate,t,ra);t.memoizedProps=t.pendingProps,n===null?mF(t):lo=n,qM.current=null}function mF(t){var n=t;do{var o=n.alternate;if(t=n.return,n.flags&32768){if(o=aW(o,n),o!==null){o.flags&=32767,lo=o;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{_o=6,lo=null;return}}else if(o=sW(o,n,ra),o!==null){lo=o;return}if(n=n.sibling,n!==null){lo=n;return}lo=n=t}while(n!==null);_o===0&&(_o=5)}function Gh(t,n,o){var u=ni,d=Aa.transition;try{Aa.transition=null,ni=1,mW(t,n,o,u)}finally{Aa.transition=d,ni=u}return null}function mW(t,n,o,u){do rp();while(Mu!==null);if(zn&6)throw Error(Kt(327));o=t.finishedWork;var d=t.finishedLanes;if(o===null)return null;if(t.finishedWork=null,t.finishedLanes=0,o===t.current)throw Error(Kt(177));t.callbackNode=null,t.callbackPriority=0;var g=o.lanes|o.childLanes;if(XG(t,g),t===Ao&&(lo=Ao=null,Uo=0),!(o.subtreeFlags&2064)&&!(o.flags&2064)||k0||(k0=!0,yF(kx,function(){return rp(),null})),g=(o.flags&15990)!==0,o.subtreeFlags&15990||g){g=Aa.transition,Aa.transition=null;var x=ni;ni=1;var T=zn;zn|=4,qM.current=null,cW(t,o),cF(o,t),Lq(FT),Ox=!!NT,FT=NT=null,t.current=o,uW(o),jG(),zn=T,ni=x,Aa.transition=g}else t.current=o;if(k0&&(k0=!1,Mu=t,Zx=d),g=t.pendingLanes,g===0&&(Lu=null),VG(o.stateNode),Bs(t,ro()),n!==null)for(u=t.onRecoverableError,o=0;o<n.length;o++)d=n[o],u(d.value,{componentStack:d.stack,digest:d.digest});if(Hx)throw Hx=!1,t=iC,iC=null,t;return Zx&1&&t.tag!==0&&rp(),g=t.pendingLanes,g&1?t===oC?p_++:(p_=0,oC=t):p_=0,Qu(),null}function rp(){if(Mu!==null){var t=Zz(Zx),n=Aa.transition,o=ni;try{if(Aa.transition=null,ni=16>t?16:t,Mu===null)var u=!1;else{if(t=Mu,Mu=null,Zx=0,zn&6)throw Error(Kt(331));var d=zn;for(zn|=4,_r=t.current;_r!==null;){var g=_r,x=g.child;if(_r.flags&16){var T=g.deletions;if(T!==null){for(var s=0;s<T.length;s++){var I=T[s];for(_r=I;_r!==null;){var O=_r;switch(O.tag){case 0:case 11:case 15:d_(8,O,g)}var D=O.child;if(D!==null)D.return=O,_r=D;else for(;_r!==null;){O=_r;var N=O.sibling,j=O.return;if(sF(O),O===I){_r=null;break}if(N!==null){N.return=j,_r=N;break}_r=j}}}var G=g.alternate;if(G!==null){var X=G.child;if(X!==null){G.child=null;do{var te=X.sibling;X.sibling=null,X=te}while(X!==null)}}_r=g}}if(g.subtreeFlags&2064&&x!==null)x.return=g,_r=x;else e:for(;_r!==null;){if(g=_r,g.flags&2048)switch(g.tag){case 0:case 11:case 15:d_(9,g,g.return)}var H=g.sibling;if(H!==null){H.return=g.return,_r=H;break e}_r=g.return}}var U=t.current;for(_r=U;_r!==null;){x=_r;var q=x.child;if(x.subtreeFlags&2064&&q!==null)q.return=x,_r=q;else e:for(x=U;_r!==null;){if(T=_r,T.flags&2048)try{switch(T.tag){case 0:case 11:case 15:E1(9,T)}}catch(pe){qi(T,T.return,pe)}if(T===x){_r=null;break e}var J=T.sibling;if(J!==null){J.return=T.return,_r=J;break e}_r=T.return}}if(zn=d,Qu(),zl&&typeof zl.onPostCommitFiberRoot=="function")try{zl.onPostCommitFiberRoot(m1,t)}catch{}u=!0}return u}finally{ni=o,Aa.transition=n}}return!1}function CR(t,n,o){n=fp(o,n),n=XN(t,n,1),t=Ru(t,n,1),n=_s(),t!==null&&(ny(t,1,n),Bs(t,n))}function qi(t,n,o){if(t.tag===3)CR(t,t,o);else for(;n!==null;){if(n.tag===3){CR(n,t,o);break}else if(n.tag===1){var u=n.stateNode;if(typeof n.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Lu===null||!Lu.has(u))){t=fp(o,t),t=YN(n,t,1),n=Ru(n,t,1),t=_s(),n!==null&&(ny(n,1,t),Bs(n,t));break}}n=n.return}}function gW(t,n,o){var u=t.pingCache;u!==null&&u.delete(n),n=_s(),t.pingedLanes|=t.suspendedLanes&o,Ao===t&&(Uo&o)===o&&(_o===4||_o===3&&(Uo&130023424)===Uo&&500>ro()-HM?Jh(t,0):WM|=o),Bs(t,n)}function gF(t,n){n===0&&(t.mode&1?(n=x0,x0<<=1,!(x0&130023424)&&(x0=4194304)):n=1);var o=_s();t=Mc(t,n),t!==null&&(ny(t,n,o),Bs(t,o))}function _W(t){var n=t.memoizedState,o=0;n!==null&&(o=n.retryLane),gF(t,o)}function yW(t,n){var o=0;switch(t.tag){case 13:var u=t.stateNode,d=t.memoizedState;d!==null&&(o=d.retryLane);break;case 19:u=t.stateNode;break;default:throw Error(Kt(314))}u!==null&&u.delete(n),gF(t,o)}var _F;_F=function(t,n,o){if(t!==null)if(t.memoizedProps!==n.pendingProps||Ns.current)zs=!0;else{if(!(t.lanes&o)&&!(n.flags&128))return zs=!1,oW(t,n,o);zs=!!(t.flags&131072)}else zs=!1,Pi&&n.flags&1048576&&xN(n,Bx,n.index);switch(n.lanes=0,n.tag){case 2:var u=n.type;cx(t,n),t=n.pendingProps;var d=cp(n,ss.current);tp(n,o),d=jM(null,n,u,t,d,o);var g=$M();return n.flags|=1,typeof d=="object"&&d!==null&&typeof d.render=="function"&&d.$$typeof===void 0?(n.tag=1,n.memoizedState=null,n.updateQueue=null,Fs(u)?(g=!0,Nx(n)):g=!1,n.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,LM(n),d.updater=b1,n.stateNode=d,d._reactInternals=n,HT(n,u,t,o),n=YT(null,n,u,!0,g,o)):(n.tag=0,Pi&&g&&IM(n),gs(null,n,d,o),n=n.child),n;case 16:u=n.elementType;e:{switch(cx(t,n),t=n.pendingProps,d=u._init,u=d(u._payload),n.type=u,d=n.tag=xW(u),t=Ka(u,t),d){case 0:n=XT(null,n,u,t,o);break e;case 1:n=gR(null,n,u,t,o);break e;case 11:n=pR(null,n,u,t,o);break e;case 14:n=mR(null,n,u,Ka(u.type,t),o);break e}throw Error(Kt(306,u,""))}return n;case 0:return u=n.type,d=n.pendingProps,d=n.elementType===u?d:Ka(u,d),XT(t,n,u,d,o);case 1:return u=n.type,d=n.pendingProps,d=n.elementType===u?d:Ka(u,d),gR(t,n,u,d,o);case 3:e:{if(eF(n),t===null)throw Error(Kt(387));u=n.pendingProps,g=n.memoizedState,d=g.element,SN(t,n),Ux(n,u,null,o);var x=n.memoizedState;if(u=x.element,g.isDehydrated)if(g={element:u,isDehydrated:!1,cache:x.cache,pendingSuspenseBoundaries:x.pendingSuspenseBoundaries,transitions:x.transitions},n.updateQueue.baseState=g,n.memoizedState=g,n.flags&256){d=fp(Error(Kt(423)),n),n=_R(t,n,u,o,d);break e}else if(u!==d){d=fp(Error(Kt(424)),n),n=_R(t,n,u,o,d);break e}else for(oa=Du(n.stateNode.containerInfo.firstChild),sa=n,Pi=!0,rl=null,o=IN(n,null,u,o),n.child=o;o;)o.flags=o.flags&-3|4096,o=o.sibling;else{if(up(),u===d){n=Ic(t,n,o);break e}gs(t,n,u,o)}n=n.child}return n;case 5:return AN(n),t===null&&GT(n),u=n.type,d=n.pendingProps,g=t!==null?t.memoizedProps:null,x=d.children,BT(u,d)?x=null:g!==null&&BT(u,g)&&(n.flags|=32),JN(t,n),gs(t,n,x,o),n.child;case 6:return t===null&&GT(n),null;case 13:return tF(t,n,o);case 4:return zM(n,n.stateNode.containerInfo),u=n.pendingProps,t===null?n.child=hp(n,null,u,o):gs(t,n,u,o),n.child;case 11:return u=n.type,d=n.pendingProps,d=n.elementType===u?d:Ka(u,d),pR(t,n,u,d,o);case 7:return gs(t,n,n.pendingProps,o),n.child;case 8:return gs(t,n,n.pendingProps.children,o),n.child;case 12:return gs(t,n,n.pendingProps.children,o),n.child;case 10:e:{if(u=n.type._context,d=n.pendingProps,g=n.memoizedProps,x=d.value,bi(jx,u._currentValue),u._currentValue=x,g!==null)if(sl(g.value,x)){if(g.children===d.children&&!Ns.current){n=Ic(t,n,o);break e}}else for(g=n.child,g!==null&&(g.return=n);g!==null;){var T=g.dependencies;if(T!==null){x=g.child;for(var s=T.firstContext;s!==null;){if(s.context===u){if(g.tag===1){s=bc(-1,o&-o),s.tag=2;var I=g.updateQueue;if(I!==null){I=I.shared;var O=I.pending;O===null?s.next=s:(s.next=O.next,O.next=s),I.pending=s}}g.lanes|=o,s=g.alternate,s!==null&&(s.lanes|=o),qT(g.return,o,n),T.lanes|=o;break}s=s.next}}else if(g.tag===10)x=g.type===n.type?null:g.child;else if(g.tag===18){if(x=g.return,x===null)throw Error(Kt(341));x.lanes|=o,T=x.alternate,T!==null&&(T.lanes|=o),qT(x,o,n),x=g.sibling}else x=g.child;if(x!==null)x.return=g;else for(x=g;x!==null;){if(x===n){x=null;break}if(g=x.sibling,g!==null){g.return=x.return,x=g;break}x=x.return}g=x}gs(t,n,d.children,o),n=n.child}return n;case 9:return d=n.type,u=n.pendingProps.children,tp(n,o),d=Oa(d),u=u(d),n.flags|=1,gs(t,n,u,o),n.child;case 14:return u=n.type,d=Ka(u,n.pendingProps),d=Ka(u.type,d),mR(t,n,u,d,o);case 15:return QN(t,n,n.type,n.pendingProps,o);case 17:return u=n.type,d=n.pendingProps,d=n.elementType===u?d:Ka(u,d),cx(t,n),n.tag=1,Fs(u)?(t=!0,Nx(n)):t=!1,tp(n,o),CN(n,u,d),HT(n,u,d,o),YT(null,n,u,!0,t,o);case 19:return rF(t,n,o);case 22:return KN(t,n,o)}throw Error(Kt(156,n.tag))};function yF(t,n){return Gz(t,n)}function vW(t,n,o,u){this.tag=t,this.key=o,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=n,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ca(t,n,o,u){return new vW(t,n,o,u)}function QM(t){return t=t.prototype,!(!t||!t.isReactComponent)}function xW(t){if(typeof t=="function")return QM(t)?1:0;if(t!=null){if(t=t.$$typeof,t===gM)return 11;if(t===_M)return 14}return 2}function Nu(t,n){var o=t.alternate;return o===null?(o=Ca(t.tag,n,t.key,t.mode),o.elementType=t.elementType,o.type=t.type,o.stateNode=t.stateNode,o.alternate=t,t.alternate=o):(o.pendingProps=n,o.type=t.type,o.flags=0,o.subtreeFlags=0,o.deletions=null),o.flags=t.flags&14680064,o.childLanes=t.childLanes,o.lanes=t.lanes,o.child=t.child,o.memoizedProps=t.memoizedProps,o.memoizedState=t.memoizedState,o.updateQueue=t.updateQueue,n=t.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext},o.sibling=t.sibling,o.index=t.index,o.ref=t.ref,o}function dx(t,n,o,u,d,g){var x=2;if(u=t,typeof t=="function")QM(t)&&(x=1);else if(typeof t=="string")x=5;else e:switch(t){case Lf:return ed(o.children,d,g,n);case mM:x=8,d|=8;break;case _T:return t=Ca(12,o,n,d|2),t.elementType=_T,t.lanes=g,t;case yT:return t=Ca(13,o,n,d),t.elementType=yT,t.lanes=g,t;case vT:return t=Ca(19,o,n,d),t.elementType=vT,t.lanes=g,t;case Mz:return T1(o,d,g,n);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Tz:x=10;break e;case Cz:x=9;break e;case gM:x=11;break e;case _M:x=14;break e;case wu:x=16,u=null;break e}throw Error(Kt(130,t==null?t:typeof t,""))}return n=Ca(x,o,n,d),n.elementType=t,n.type=u,n.lanes=g,n}function ed(t,n,o,u){return t=Ca(7,t,u,n),t.lanes=o,t}function T1(t,n,o,u){return t=Ca(22,t,u,n),t.elementType=Mz,t.lanes=o,t.stateNode={isHidden:!1},t}function GE(t,n,o){return t=Ca(6,t,null,n),t.lanes=o,t}function qE(t,n,o){return n=Ca(4,t.children!==null?t.children:[],t.key,n),n.lanes=o,n.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},n}function bW(t,n,o,u,d){this.tag=n,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=TE(0),this.expirationTimes=TE(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=TE(0),this.identifierPrefix=u,this.onRecoverableError=d,this.mutableSourceEagerHydrationData=null}function KM(t,n,o,u,d,g,x,T,s){return t=new bW(t,n,o,T,s),n===1?(n=1,g===!0&&(n|=8)):n=0,g=Ca(3,null,null,n),t.current=g,g.stateNode=t,g.memoizedState={element:u,isDehydrated:o,cache:null,transitions:null,pendingSuspenseBoundaries:null},LM(g),t}function wW(t,n,o){var u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Rf,key:u==null?null:""+u,children:t,containerInfo:n,implementation:o}}function vF(t){if(!t)return Gu;t=t._reactInternals;e:{if(md(t)!==t||t.tag!==1)throw Error(Kt(170));var n=t;do{switch(n.tag){case 3:n=n.stateNode.context;break e;case 1:if(Fs(n.type)){n=n.stateNode.__reactInternalMemoizedMergedChildContext;break e}}n=n.return}while(n!==null);throw Error(Kt(171))}if(t.tag===1){var o=t.type;if(Fs(o))return yN(t,o,n)}return n}function xF(t,n,o,u,d,g,x,T,s){return t=KM(o,u,!0,t,d,g,x,T,s),t.context=vF(null),o=t.current,u=_s(),d=zu(o),g=bc(u,d),g.callback=n??null,Ru(o,g,d),t.current.lanes=d,ny(t,d,u),Bs(t,u),t}function C1(t,n,o,u){var d=n.current,g=_s(),x=zu(d);return o=vF(o),n.context===null?n.context=o:n.pendingContext=o,n=bc(g,x),n.payload={element:t},u=u===void 0?null:u,u!==null&&(n.callback=u),t=Ru(d,n,x),t!==null&&(ol(t,d,x,g),sx(t,d,x)),x}function Yx(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function MR(t,n){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var o=t.retryLane;t.retryLane=o!==0&&o<n?o:n}}function JM(t,n){MR(t,n),(t=t.alternate)&&MR(t,n)}function EW(){return null}var bF=typeof reportError=="function"?reportError:function(t){console.error(t)};function eI(t){this._internalRoot=t}M1.prototype.render=eI.prototype.render=function(t){var n=this._internalRoot;if(n===null)throw Error(Kt(409));C1(t,n,null,null)};M1.prototype.unmount=eI.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var n=t.containerInfo;ld(function(){C1(null,t,null,null)}),n[Cc]=null}};function M1(t){this._internalRoot=t}M1.prototype.unstable_scheduleHydration=function(t){if(t){var n=Qz();t={blockedOn:null,target:t,priority:n};for(var o=0;o<Su.length&&n!==0&&n<Su[o].priority;o++);Su.splice(o,0,t),o===0&&Jz(t)}};function tI(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function I1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function IR(){}function SW(t,n,o,u,d){if(d){if(typeof u=="function"){var g=u;u=function(){var I=Yx(x);g.call(I)}}var x=xF(n,u,t,0,null,!1,!1,"",IR);return t._reactRootContainer=x,t[Cc]=x.current,O_(t.nodeType===8?t.parentNode:t),ld(),x}for(;d=t.lastChild;)t.removeChild(d);if(typeof u=="function"){var T=u;u=function(){var I=Yx(s);T.call(I)}}var s=KM(t,0,!1,null,null,!1,!1,"",IR);return t._reactRootContainer=s,t[Cc]=s.current,O_(t.nodeType===8?t.parentNode:t),ld(function(){C1(n,s,o,u)}),s}function A1(t,n,o,u,d){var g=o._reactRootContainer;if(g){var x=g;if(typeof d=="function"){var T=d;d=function(){var s=Yx(x);T.call(s)}}C1(n,x,t,d)}else x=SW(o,n,t,d,u);return Yx(x)}Xz=function(t){switch(t.tag){case 3:var n=t.stateNode;if(n.current.memoizedState.isDehydrated){var o=e_(n.pendingLanes);o!==0&&(xM(n,o|1),Bs(n,ro()),!(zn&6)&&(pp=ro()+500,Qu()))}break;case 13:ld(function(){var u=Mc(t,1);if(u!==null){var d=_s();ol(u,t,1,d)}}),JM(t,1)}};bM=function(t){if(t.tag===13){var n=Mc(t,134217728);if(n!==null){var o=_s();ol(n,t,134217728,o)}JM(t,134217728)}};Yz=function(t){if(t.tag===13){var n=zu(t),o=Mc(t,n);if(o!==null){var u=_s();ol(o,t,n,u)}JM(t,n)}};Qz=function(){return ni};Kz=function(t,n){var o=ni;try{return ni=t,n()}finally{ni=o}};AT=function(t,n,o){switch(n){case"input":if(wT(t,o),n=o.name,o.type==="radio"&&n!=null){for(o=t;o.parentNode;)o=o.parentNode;for(o=o.querySelectorAll("input[name="+JSON.stringify(""+n)+'][type="radio"]'),n=0;n<o.length;n++){var u=o[n];if(u!==t&&u.form===t.form){var d=v1(u);if(!d)throw Error(Kt(90));Az(u),wT(u,d)}}}break;case"textarea":Pz(t,o);break;case"select":n=o.value,n!=null&&Qf(t,!!o.multiple,n,!1)}};Fz=ZM;Bz=ld;var TW={usingClientEntryPoint:!1,Events:[oy,Bf,v1,zz,Nz,ZM]},fg={findFiberByHostInstance:Zh,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},CW={bundleType:fg.bundleType,version:fg.version,rendererPackageName:fg.rendererPackageName,rendererConfig:fg.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Rc.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Uz(t),t===null?null:t.stateNode},findFiberByHostInstance:fg.findFiberByHostInstance||EW,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var P0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!P0.isDisabled&&P0.supportsFiber)try{m1=P0.inject(CW),zl=P0}catch{}}ca.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=TW;ca.createPortal=function(t,n){var o=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!tI(n))throw Error(Kt(200));return wW(t,n,null,o)};ca.createRoot=function(t,n){if(!tI(t))throw Error(Kt(299));var o=!1,u="",d=bF;return n!=null&&(n.unstable_strictMode===!0&&(o=!0),n.identifierPrefix!==void 0&&(u=n.identifierPrefix),n.onRecoverableError!==void 0&&(d=n.onRecoverableError)),n=KM(t,1,!1,null,null,o,!1,u,d),t[Cc]=n.current,O_(t.nodeType===8?t.parentNode:t),new eI(n)};ca.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var n=t._reactInternals;if(n===void 0)throw typeof t.render=="function"?Error(Kt(188)):(t=Object.keys(t).join(","),Error(Kt(268,t)));return t=Uz(n),t=t===null?null:t.stateNode,t};ca.flushSync=function(t){return ld(t)};ca.hydrate=function(t,n,o){if(!I1(n))throw Error(Kt(200));return A1(null,t,n,!0,o)};ca.hydrateRoot=function(t,n,o){if(!tI(t))throw Error(Kt(405));var u=o!=null&&o.hydratedSources||null,d=!1,g="",x=bF;if(o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(g=o.identifierPrefix),o.onRecoverableError!==void 0&&(x=o.onRecoverableError)),n=xF(n,null,t,1,o??null,d,!1,g,x),t[Cc]=n.current,O_(t),u)for(t=0;t<u.length;t++)o=u[t],d=o._getVersion,d=d(o._source),n.mutableSourceEagerHydrationData==null?n.mutableSourceEagerHydrationData=[o,d]:n.mutableSourceEagerHydrationData.push(o,d);return new M1(n)};ca.render=function(t,n,o){if(!I1(n))throw Error(Kt(200));return A1(null,t,n,!1,o)};ca.unmountComponentAtNode=function(t){if(!I1(t))throw Error(Kt(40));return t._reactRootContainer?(ld(function(){A1(null,null,t,!1,function(){t._reactRootContainer=null,t[Cc]=null})}),!0):!1};ca.unstable_batchedUpdates=ZM;ca.unstable_renderSubtreeIntoContainer=function(t,n,o,u){if(!I1(o))throw Error(Kt(200));if(t==null||t._reactInternals===void 0)throw Error(Kt(38));return A1(t,n,o,!1,u)};ca.version="18.2.0-next-9e3b772b8-20220608";function wF(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(wF)}catch(t){console.error(t)}}wF(),xz.exports=ca;var gd=xz.exports;const EF=vp(gd),MW=RC({__proto__:null,default:EF},[gd]);var SF,AR=gd;SF=AR.createRoot,AR.hydrateRoot;function bn(){return bn=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(t[u]=o[u])}return t},bn.apply(this,arguments)}function Ci(t,n,{checkForDefaultPrevented:o=!0}={}){return function(d){if(t==null||t(d),o===!1||!d.defaultPrevented)return n==null?void 0:n(d)}}function IW(t,n){typeof t=="function"?t(n):t!=null&&(t.current=n)}function TF(...t){return n=>t.forEach(o=>IW(o,n))}function La(...t){return W.useCallback(TF(...t),t)}function ay(t,n=[]){let o=[];function u(g,x){const T=W.createContext(x),s=o.length;o=[...o,x];function I(D){const{scope:N,children:j,...G}=D,X=(N==null?void 0:N[t][s])||T,te=W.useMemo(()=>G,Object.values(G));return W.createElement(X.Provider,{value:te},j)}function O(D,N){const j=(N==null?void 0:N[t][s])||T,G=W.useContext(j);if(G)return G;if(x!==void 0)return x;throw new Error(`\`${D}\` must be used within \`${g}\``)}return I.displayName=g+"Provider",[I,O]}const d=()=>{const g=o.map(x=>W.createContext(x));return function(T){const s=(T==null?void 0:T[t])||g;return W.useMemo(()=>({[`__scope${t}`]:{...T,[t]:s}}),[T,s])}};return d.scopeName=t,[u,AW(d,...n)]}function AW(...t){const n=t[0];if(t.length===1)return n;const o=()=>{const u=t.map(d=>({useScope:d(),scopeName:d.scopeName}));return function(g){const x=u.reduce((T,{useScope:s,scopeName:I})=>{const D=s(g)[`__scope${I}`];return{...T,...D}},{});return W.useMemo(()=>({[`__scope${n.scopeName}`]:x}),[x])}};return o.scopeName=n.scopeName,o}const rI=W.forwardRef((t,n)=>{const{children:o,...u}=t,d=W.Children.toArray(o),g=d.find(kW);if(g){const x=g.props.children,T=d.map(s=>s===g?W.Children.count(x)>1?W.Children.only(null):W.isValidElement(x)?x.props.children:null:s);return W.createElement(lC,bn({},u,{ref:n}),W.isValidElement(x)?W.cloneElement(x,void 0,T):null)}return W.createElement(lC,bn({},u,{ref:n}),o)});rI.displayName="Slot";const lC=W.forwardRef((t,n)=>{const{children:o,...u}=t;return W.isValidElement(o)?W.cloneElement(o,{...PW(u,o.props),ref:n?TF(n,o.ref):o.ref}):W.Children.count(o)>1?W.Children.only(null):null});lC.displayName="SlotClone";const CF=({children:t})=>W.createElement(W.Fragment,null,t);function kW(t){return W.isValidElement(t)&&t.type===CF}function PW(t,n){const o={...n};for(const u in n){const d=t[u],g=n[u];/^on[A-Z]/.test(u)?d&&g?o[u]=(...T)=>{g(...T),d(...T)}:d&&(o[u]=d):u==="style"?o[u]={...d,...g}:u==="className"&&(o[u]=[d,g].filter(Boolean).join(" "))}return{...t,...o}}const OW=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],js=OW.reduce((t,n)=>{const o=W.forwardRef((u,d)=>{const{asChild:g,...x}=u,T=g?rI:n;return W.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),W.createElement(T,bn({},x,{ref:d}))});return o.displayName=`Primitive.${n}`,{...t,[n]:o}},{});function DW(t,n){t&&gd.flushSync(()=>t.dispatchEvent(n))}function qu(t){const n=W.useRef(t);return W.useEffect(()=>{n.current=t}),W.useMemo(()=>(...o)=>{var u;return(u=n.current)===null||u===void 0?void 0:u.call(n,...o)},[])}function RW(t,n=globalThis==null?void 0:globalThis.document){const o=qu(t);W.useEffect(()=>{const u=d=>{d.key==="Escape"&&o(d)};return n.addEventListener("keydown",u),()=>n.removeEventListener("keydown",u)},[o,n])}const cC="dismissableLayer.update",LW="dismissableLayer.pointerDownOutside",zW="dismissableLayer.focusOutside";let kR;const NW=W.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),nI=W.forwardRef((t,n)=>{var o;const{disableOutsidePointerEvents:u=!1,onEscapeKeyDown:d,onPointerDownOutside:g,onFocusOutside:x,onInteractOutside:T,onDismiss:s,...I}=t,O=W.useContext(NW),[D,N]=W.useState(null),j=(o=D==null?void 0:D.ownerDocument)!==null&&o!==void 0?o:globalThis==null?void 0:globalThis.document,[,G]=W.useState({}),X=La(n,Se=>N(Se)),te=Array.from(O.layers),[H]=[...O.layersWithOutsidePointerEventsDisabled].slice(-1),U=te.indexOf(H),q=D?te.indexOf(D):-1,J=O.layersWithOutsidePointerEventsDisabled.size>0,pe=q>=U,ue=FW(Se=>{const ge=Se.target,se=[...O.branches].some(Ie=>Ie.contains(ge));!pe||se||(g==null||g(Se),T==null||T(Se),Se.defaultPrevented||s==null||s())},j),Me=BW(Se=>{const ge=Se.target;[...O.branches].some(Ie=>Ie.contains(ge))||(x==null||x(Se),T==null||T(Se),Se.defaultPrevented||s==null||s())},j);return RW(Se=>{q===O.layers.size-1&&(d==null||d(Se),!Se.defaultPrevented&&s&&(Se.preventDefault(),s()))},j),W.useEffect(()=>{if(D)return u&&(O.layersWithOutsidePointerEventsDisabled.size===0&&(kR=j.body.style.pointerEvents,j.body.style.pointerEvents="none"),O.layersWithOutsidePointerEventsDisabled.add(D)),O.layers.add(D),PR(),()=>{u&&O.layersWithOutsidePointerEventsDisabled.size===1&&(j.body.style.pointerEvents=kR)}},[D,j,u,O]),W.useEffect(()=>()=>{D&&(O.layers.delete(D),O.layersWithOutsidePointerEventsDisabled.delete(D),PR())},[D,O]),W.useEffect(()=>{const Se=()=>G({});return document.addEventListener(cC,Se),()=>document.removeEventListener(cC,Se)},[]),W.createElement(js.div,bn({},I,{ref:X,style:{pointerEvents:J?pe?"auto":"none":void 0,...t.style},onFocusCapture:Ci(t.onFocusCapture,Me.onFocusCapture),onBlurCapture:Ci(t.onBlurCapture,Me.onBlurCapture),onPointerDownCapture:Ci(t.onPointerDownCapture,ue.onPointerDownCapture)}))});function FW(t,n=globalThis==null?void 0:globalThis.document){const o=qu(t),u=W.useRef(!1),d=W.useRef(()=>{});return W.useEffect(()=>{const g=T=>{if(T.target&&!u.current){let O=function(){MF(LW,o,I,{discrete:!0})};var s=O;const I={originalEvent:T};T.pointerType==="touch"?(n.removeEventListener("click",d.current),d.current=O,n.addEventListener("click",d.current,{once:!0})):O()}else n.removeEventListener("click",d.current);u.current=!1},x=window.setTimeout(()=>{n.addEventListener("pointerdown",g)},0);return()=>{window.clearTimeout(x),n.removeEventListener("pointerdown",g),n.removeEventListener("click",d.current)}},[n,o]),{onPointerDownCapture:()=>u.current=!0}}function BW(t,n=globalThis==null?void 0:globalThis.document){const o=qu(t),u=W.useRef(!1);return W.useEffect(()=>{const d=g=>{g.target&&!u.current&&MF(zW,o,{originalEvent:g},{discrete:!1})};return n.addEventListener("focusin",d),()=>n.removeEventListener("focusin",d)},[n,o]),{onFocusCapture:()=>u.current=!0,onBlurCapture:()=>u.current=!1}}function PR(){const t=new CustomEvent(cC);document.dispatchEvent(t)}function MF(t,n,o,{discrete:u}){const d=o.originalEvent.target,g=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:o});n&&d.addEventListener(t,n,{once:!0}),u?DW(d,g):d.dispatchEvent(g)}const mp=globalThis!=null&&globalThis.document?W.useLayoutEffect:()=>{},jW=i5.useId||(()=>{});let $W=0;function fx(t){const[n,o]=W.useState(jW());return mp(()=>{t||o(u=>u??String($W++))},[t]),t||(n?`radix-${n}`:"")}const UW=["top","right","bottom","left"],Wu=Math.min,na=Math.max,Qx=Math.round,O0=Math.floor,Hu=t=>({x:t,y:t}),VW={left:"right",right:"left",bottom:"top",top:"bottom"},GW={start:"end",end:"start"};function uC(t,n,o){return na(t,Wu(n,o))}function Ac(t,n){return typeof t=="function"?t(n):t}function kc(t){return t.split("-")[0]}function Tp(t){return t.split("-")[1]}function iI(t){return t==="x"?"y":"x"}function oI(t){return t==="y"?"height":"width"}function Cp(t){return["top","bottom"].includes(kc(t))?"y":"x"}function sI(t){return iI(Cp(t))}function qW(t,n,o){o===void 0&&(o=!1);const u=Tp(t),d=sI(t),g=oI(d);let x=d==="x"?u===(o?"end":"start")?"right":"left":u==="start"?"bottom":"top";return n.reference[g]>n.floating[g]&&(x=Kx(x)),[x,Kx(x)]}function WW(t){const n=Kx(t);return[hC(t),n,hC(n)]}function hC(t){return t.replace(/start|end/g,n=>GW[n])}function HW(t,n,o){const u=["left","right"],d=["right","left"],g=["top","bottom"],x=["bottom","top"];switch(t){case"top":case"bottom":return o?n?d:u:n?u:d;case"left":case"right":return n?g:x;default:return[]}}function ZW(t,n,o,u){const d=Tp(t);let g=HW(kc(t),o==="start",u);return d&&(g=g.map(x=>x+"-"+d),n&&(g=g.concat(g.map(hC)))),g}function Kx(t){return t.replace(/left|right|bottom|top/g,n=>VW[n])}function XW(t){return{top:0,right:0,bottom:0,left:0,...t}}function IF(t){return typeof t!="number"?XW(t):{top:t,right:t,bottom:t,left:t}}function Jx(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}function OR(t,n,o){let{reference:u,floating:d}=t;const g=Cp(n),x=sI(n),T=oI(x),s=kc(n),I=g==="y",O=u.x+u.width/2-d.width/2,D=u.y+u.height/2-d.height/2,N=u[T]/2-d[T]/2;let j;switch(s){case"top":j={x:O,y:u.y-d.height};break;case"bottom":j={x:O,y:u.y+u.height};break;case"right":j={x:u.x+u.width,y:D};break;case"left":j={x:u.x-d.width,y:D};break;default:j={x:u.x,y:u.y}}switch(Tp(n)){case"start":j[x]-=N*(o&&I?-1:1);break;case"end":j[x]+=N*(o&&I?-1:1);break}return j}const YW=async(t,n,o)=>{const{placement:u="bottom",strategy:d="absolute",middleware:g=[],platform:x}=o,T=g.filter(Boolean),s=await(x.isRTL==null?void 0:x.isRTL(n));let I=await x.getElementRects({reference:t,floating:n,strategy:d}),{x:O,y:D}=OR(I,u,s),N=u,j={},G=0;for(let X=0;X<T.length;X++){const{name:te,fn:H}=T[X],{x:U,y:q,data:J,reset:pe}=await H({x:O,y:D,initialPlacement:u,placement:N,strategy:d,middlewareData:j,rects:I,platform:x,elements:{reference:t,floating:n}});O=U??O,D=q??D,j={...j,[te]:{...j[te],...J}},pe&&G<=50&&(G++,typeof pe=="object"&&(pe.placement&&(N=pe.placement),pe.rects&&(I=pe.rects===!0?await x.getElementRects({reference:t,floating:n,strategy:d}):pe.rects),{x:O,y:D}=OR(I,N,s)),X=-1)}return{x:O,y:D,placement:N,strategy:d,middlewareData:j}};async function $_(t,n){var o;n===void 0&&(n={});const{x:u,y:d,platform:g,rects:x,elements:T,strategy:s}=t,{boundary:I="clippingAncestors",rootBoundary:O="viewport",elementContext:D="floating",altBoundary:N=!1,padding:j=0}=Ac(n,t),G=IF(j),te=T[N?D==="floating"?"reference":"floating":D],H=Jx(await g.getClippingRect({element:(o=await(g.isElement==null?void 0:g.isElement(te)))==null||o?te:te.contextElement||await(g.getDocumentElement==null?void 0:g.getDocumentElement(T.floating)),boundary:I,rootBoundary:O,strategy:s})),U=D==="floating"?{...x.floating,x:u,y:d}:x.reference,q=await(g.getOffsetParent==null?void 0:g.getOffsetParent(T.floating)),J=await(g.isElement==null?void 0:g.isElement(q))?await(g.getScale==null?void 0:g.getScale(q))||{x:1,y:1}:{x:1,y:1},pe=Jx(g.convertOffsetParentRelativeRectToViewportRelativeRect?await g.convertOffsetParentRelativeRectToViewportRelativeRect({elements:T,rect:U,offsetParent:q,strategy:s}):U);return{top:(H.top-pe.top+G.top)/J.y,bottom:(pe.bottom-H.bottom+G.bottom)/J.y,left:(H.left-pe.left+G.left)/J.x,right:(pe.right-H.right+G.right)/J.x}}const QW=t=>({name:"arrow",options:t,async fn(n){const{x:o,y:u,placement:d,rects:g,platform:x,elements:T,middlewareData:s}=n,{element:I,padding:O=0}=Ac(t,n)||{};if(I==null)return{};const D=IF(O),N={x:o,y:u},j=sI(d),G=oI(j),X=await x.getDimensions(I),te=j==="y",H=te?"top":"left",U=te?"bottom":"right",q=te?"clientHeight":"clientWidth",J=g.reference[G]+g.reference[j]-N[j]-g.floating[G],pe=N[j]-g.reference[j],ue=await(x.getOffsetParent==null?void 0:x.getOffsetParent(I));let Me=ue?ue[q]:0;(!Me||!await(x.isElement==null?void 0:x.isElement(ue)))&&(Me=T.floating[q]||g.floating[G]);const Se=J/2-pe/2,ge=Me/2-X[G]/2-1,se=Wu(D[H],ge),Ie=Wu(D[U],ge),We=se,ze=Me-X[G]-Ie,De=Me/2-X[G]/2+Se,nt=uC(We,De,ze),It=!s.arrow&&Tp(d)!=null&&De!==nt&&g.reference[G]/2-(De<We?se:Ie)-X[G]/2<0,Ot=It?De<We?De-We:De-ze:0;return{[j]:N[j]+Ot,data:{[j]:nt,centerOffset:De-nt-Ot,...It&&{alignmentOffset:Ot}},reset:It}}}),KW=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(n){var o,u;const{placement:d,middlewareData:g,rects:x,initialPlacement:T,platform:s,elements:I}=n,{mainAxis:O=!0,crossAxis:D=!0,fallbackPlacements:N,fallbackStrategy:j="bestFit",fallbackAxisSideDirection:G="none",flipAlignment:X=!0,...te}=Ac(t,n);if((o=g.arrow)!=null&&o.alignmentOffset)return{};const H=kc(d),U=kc(T)===T,q=await(s.isRTL==null?void 0:s.isRTL(I.floating)),J=N||(U||!X?[Kx(T)]:WW(T));!N&&G!=="none"&&J.push(...ZW(T,X,G,q));const pe=[T,...J],ue=await $_(n,te),Me=[];let Se=((u=g.flip)==null?void 0:u.overflows)||[];if(O&&Me.push(ue[H]),D){const We=qW(d,x,q);Me.push(ue[We[0]],ue[We[1]])}if(Se=[...Se,{placement:d,overflows:Me}],!Me.every(We=>We<=0)){var ge,se;const We=(((ge=g.flip)==null?void 0:ge.index)||0)+1,ze=pe[We];if(ze)return{data:{index:We,overflows:Se},reset:{placement:ze}};let De=(se=Se.filter(nt=>nt.overflows[0]<=0).sort((nt,It)=>nt.overflows[1]-It.overflows[1])[0])==null?void 0:se.placement;if(!De)switch(j){case"bestFit":{var Ie;const nt=(Ie=Se.map(It=>[It.placement,It.overflows.filter(Ot=>Ot>0).reduce((Ot,bt)=>Ot+bt,0)]).sort((It,Ot)=>It[1]-Ot[1])[0])==null?void 0:Ie[0];nt&&(De=nt);break}case"initialPlacement":De=T;break}if(d!==De)return{reset:{placement:De}}}return{}}}};function DR(t,n){return{top:t.top-n.height,right:t.right-n.width,bottom:t.bottom-n.height,left:t.left-n.width}}function RR(t){return UW.some(n=>t[n]>=0)}const JW=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(n){const{rects:o}=n,{strategy:u="referenceHidden",...d}=Ac(t,n);switch(u){case"referenceHidden":{const g=await $_(n,{...d,elementContext:"reference"}),x=DR(g,o.reference);return{data:{referenceHiddenOffsets:x,referenceHidden:RR(x)}}}case"escaped":{const g=await $_(n,{...d,altBoundary:!0}),x=DR(g,o.floating);return{data:{escapedOffsets:x,escaped:RR(x)}}}default:return{}}}}};async function eH(t,n){const{placement:o,platform:u,elements:d}=t,g=await(u.isRTL==null?void 0:u.isRTL(d.floating)),x=kc(o),T=Tp(o),s=Cp(o)==="y",I=["left","top"].includes(x)?-1:1,O=g&&s?-1:1,D=Ac(n,t);let{mainAxis:N,crossAxis:j,alignmentAxis:G}=typeof D=="number"?{mainAxis:D,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...D};return T&&typeof G=="number"&&(j=T==="end"?G*-1:G),s?{x:j*O,y:N*I}:{x:N*I,y:j*O}}const tH=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(n){var o,u;const{x:d,y:g,placement:x,middlewareData:T}=n,s=await eH(n,t);return x===((o=T.offset)==null?void 0:o.placement)&&(u=T.arrow)!=null&&u.alignmentOffset?{}:{x:d+s.x,y:g+s.y,data:{...s,placement:x}}}}},rH=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(n){const{x:o,y:u,placement:d}=n,{mainAxis:g=!0,crossAxis:x=!1,limiter:T={fn:te=>{let{x:H,y:U}=te;return{x:H,y:U}}},...s}=Ac(t,n),I={x:o,y:u},O=await $_(n,s),D=Cp(kc(d)),N=iI(D);let j=I[N],G=I[D];if(g){const te=N==="y"?"top":"left",H=N==="y"?"bottom":"right",U=j+O[te],q=j-O[H];j=uC(U,j,q)}if(x){const te=D==="y"?"top":"left",H=D==="y"?"bottom":"right",U=G+O[te],q=G-O[H];G=uC(U,G,q)}const X=T.fn({...n,[N]:j,[D]:G});return{...X,data:{x:X.x-o,y:X.y-u}}}}},nH=function(t){return t===void 0&&(t={}),{options:t,fn(n){const{x:o,y:u,placement:d,rects:g,middlewareData:x}=n,{offset:T=0,mainAxis:s=!0,crossAxis:I=!0}=Ac(t,n),O={x:o,y:u},D=Cp(d),N=iI(D);let j=O[N],G=O[D];const X=Ac(T,n),te=typeof X=="number"?{mainAxis:X,crossAxis:0}:{mainAxis:0,crossAxis:0,...X};if(s){const q=N==="y"?"height":"width",J=g.reference[N]-g.floating[q]+te.mainAxis,pe=g.reference[N]+g.reference[q]-te.mainAxis;j<J?j=J:j>pe&&(j=pe)}if(I){var H,U;const q=N==="y"?"width":"height",J=["top","left"].includes(kc(d)),pe=g.reference[D]-g.floating[q]+(J&&((H=x.offset)==null?void 0:H[D])||0)+(J?0:te.crossAxis),ue=g.reference[D]+g.reference[q]+(J?0:((U=x.offset)==null?void 0:U[D])||0)-(J?te.crossAxis:0);G<pe?G=pe:G>ue&&(G=ue)}return{[N]:j,[D]:G}}}},iH=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(n){const{placement:o,rects:u,platform:d,elements:g}=n,{apply:x=()=>{},...T}=Ac(t,n),s=await $_(n,T),I=kc(o),O=Tp(o),D=Cp(o)==="y",{width:N,height:j}=u.floating;let G,X;I==="top"||I==="bottom"?(G=I,X=O===(await(d.isRTL==null?void 0:d.isRTL(g.floating))?"start":"end")?"left":"right"):(X=I,G=O==="end"?"top":"bottom");const te=j-s[G],H=N-s[X],U=!n.middlewareData.shift;let q=te,J=H;if(D){const ue=N-s.left-s.right;J=O||U?Wu(H,ue):ue}else{const ue=j-s.top-s.bottom;q=O||U?Wu(te,ue):ue}if(U&&!O){const ue=na(s.left,0),Me=na(s.right,0),Se=na(s.top,0),ge=na(s.bottom,0);D?J=N-2*(ue!==0||Me!==0?ue+Me:na(s.left,s.right)):q=j-2*(Se!==0||ge!==0?Se+ge:na(s.top,s.bottom))}await x({...n,availableWidth:J,availableHeight:q});const pe=await d.getDimensions(g.floating);return N!==pe.width||j!==pe.height?{reset:{rects:!0}}:{}}}};function Zu(t){return AF(t)?(t.nodeName||"").toLowerCase():"#document"}function aa(t){var n;return(t==null||(n=t.ownerDocument)==null?void 0:n.defaultView)||window}function Lc(t){var n;return(n=(AF(t)?t.ownerDocument:t.document)||window.document)==null?void 0:n.documentElement}function AF(t){return t instanceof Node||t instanceof aa(t).Node}function Pc(t){return t instanceof Element||t instanceof aa(t).Element}function Bl(t){return t instanceof HTMLElement||t instanceof aa(t).HTMLElement}function LR(t){return typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof aa(t).ShadowRoot}function ly(t){const{overflow:n,overflowX:o,overflowY:u,display:d}=Ra(t);return/auto|scroll|overlay|hidden|clip/.test(n+u+o)&&!["inline","contents"].includes(d)}function oH(t){return["table","td","th"].includes(Zu(t))}function aI(t){const n=lI(),o=Ra(t);return o.transform!=="none"||o.perspective!=="none"||(o.containerType?o.containerType!=="normal":!1)||!n&&(o.backdropFilter?o.backdropFilter!=="none":!1)||!n&&(o.filter?o.filter!=="none":!1)||["transform","perspective","filter"].some(u=>(o.willChange||"").includes(u))||["paint","layout","strict","content"].some(u=>(o.contain||"").includes(u))}function sH(t){let n=gp(t);for(;Bl(n)&&!k1(n);){if(aI(n))return n;n=gp(n)}return null}function lI(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function k1(t){return["html","body","#document"].includes(Zu(t))}function Ra(t){return aa(t).getComputedStyle(t)}function P1(t){return Pc(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function gp(t){if(Zu(t)==="html")return t;const n=t.assignedSlot||t.parentNode||LR(t)&&t.host||Lc(t);return LR(n)?n.host:n}function kF(t){const n=gp(t);return k1(n)?t.ownerDocument?t.ownerDocument.body:t.body:Bl(n)&&ly(n)?n:kF(n)}function U_(t,n,o){var u;n===void 0&&(n=[]),o===void 0&&(o=!0);const d=kF(t),g=d===((u=t.ownerDocument)==null?void 0:u.body),x=aa(d);return g?n.concat(x,x.visualViewport||[],ly(d)?d:[],x.frameElement&&o?U_(x.frameElement):[]):n.concat(d,U_(d,[],o))}function PF(t){const n=Ra(t);let o=parseFloat(n.width)||0,u=parseFloat(n.height)||0;const d=Bl(t),g=d?t.offsetWidth:o,x=d?t.offsetHeight:u,T=Qx(o)!==g||Qx(u)!==x;return T&&(o=g,u=x),{width:o,height:u,$:T}}function cI(t){return Pc(t)?t:t.contextElement}function np(t){const n=cI(t);if(!Bl(n))return Hu(1);const o=n.getBoundingClientRect(),{width:u,height:d,$:g}=PF(n);let x=(g?Qx(o.width):o.width)/u,T=(g?Qx(o.height):o.height)/d;return(!x||!Number.isFinite(x))&&(x=1),(!T||!Number.isFinite(T))&&(T=1),{x,y:T}}const aH=Hu(0);function OF(t){const n=aa(t);return!lI()||!n.visualViewport?aH:{x:n.visualViewport.offsetLeft,y:n.visualViewport.offsetTop}}function lH(t,n,o){return n===void 0&&(n=!1),!o||n&&o!==aa(t)?!1:n}function cd(t,n,o,u){n===void 0&&(n=!1),o===void 0&&(o=!1);const d=t.getBoundingClientRect(),g=cI(t);let x=Hu(1);n&&(u?Pc(u)&&(x=np(u)):x=np(t));const T=lH(g,o,u)?OF(g):Hu(0);let s=(d.left+T.x)/x.x,I=(d.top+T.y)/x.y,O=d.width/x.x,D=d.height/x.y;if(g){const N=aa(g),j=u&&Pc(u)?aa(u):u;let G=N,X=G.frameElement;for(;X&&u&&j!==G;){const te=np(X),H=X.getBoundingClientRect(),U=Ra(X),q=H.left+(X.clientLeft+parseFloat(U.paddingLeft))*te.x,J=H.top+(X.clientTop+parseFloat(U.paddingTop))*te.y;s*=te.x,I*=te.y,O*=te.x,D*=te.y,s+=q,I+=J,G=aa(X),X=G.frameElement}}return Jx({width:O,height:D,x:s,y:I})}const cH=[":popover-open",":modal"];function DF(t){return cH.some(n=>{try{return t.matches(n)}catch{return!1}})}function uH(t){let{elements:n,rect:o,offsetParent:u,strategy:d}=t;const g=d==="fixed",x=Lc(u),T=n?DF(n.floating):!1;if(u===x||T&&g)return o;let s={scrollLeft:0,scrollTop:0},I=Hu(1);const O=Hu(0),D=Bl(u);if((D||!D&&!g)&&((Zu(u)!=="body"||ly(x))&&(s=P1(u)),Bl(u))){const N=cd(u);I=np(u),O.x=N.x+u.clientLeft,O.y=N.y+u.clientTop}return{width:o.width*I.x,height:o.height*I.y,x:o.x*I.x-s.scrollLeft*I.x+O.x,y:o.y*I.y-s.scrollTop*I.y+O.y}}function hH(t){return Array.from(t.getClientRects())}function RF(t){return cd(Lc(t)).left+P1(t).scrollLeft}function dH(t){const n=Lc(t),o=P1(t),u=t.ownerDocument.body,d=na(n.scrollWidth,n.clientWidth,u.scrollWidth,u.clientWidth),g=na(n.scrollHeight,n.clientHeight,u.scrollHeight,u.clientHeight);let x=-o.scrollLeft+RF(t);const T=-o.scrollTop;return Ra(u).direction==="rtl"&&(x+=na(n.clientWidth,u.clientWidth)-d),{width:d,height:g,x,y:T}}function fH(t,n){const o=aa(t),u=Lc(t),d=o.visualViewport;let g=u.clientWidth,x=u.clientHeight,T=0,s=0;if(d){g=d.width,x=d.height;const I=lI();(!I||I&&n==="fixed")&&(T=d.offsetLeft,s=d.offsetTop)}return{width:g,height:x,x:T,y:s}}function pH(t,n){const o=cd(t,!0,n==="fixed"),u=o.top+t.clientTop,d=o.left+t.clientLeft,g=Bl(t)?np(t):Hu(1),x=t.clientWidth*g.x,T=t.clientHeight*g.y,s=d*g.x,I=u*g.y;return{width:x,height:T,x:s,y:I}}function zR(t,n,o){let u;if(n==="viewport")u=fH(t,o);else if(n==="document")u=dH(Lc(t));else if(Pc(n))u=pH(n,o);else{const d=OF(t);u={...n,x:n.x-d.x,y:n.y-d.y}}return Jx(u)}function LF(t,n){const o=gp(t);return o===n||!Pc(o)||k1(o)?!1:Ra(o).position==="fixed"||LF(o,n)}function mH(t,n){const o=n.get(t);if(o)return o;let u=U_(t,[],!1).filter(T=>Pc(T)&&Zu(T)!=="body"),d=null;const g=Ra(t).position==="fixed";let x=g?gp(t):t;for(;Pc(x)&&!k1(x);){const T=Ra(x),s=aI(x);!s&&T.position==="fixed"&&(d=null),(g?!s&&!d:!s&&T.position==="static"&&!!d&&["absolute","fixed"].includes(d.position)||ly(x)&&!s&&LF(t,x))?u=u.filter(O=>O!==x):d=T,x=gp(x)}return n.set(t,u),u}function gH(t){let{element:n,boundary:o,rootBoundary:u,strategy:d}=t;const x=[...o==="clippingAncestors"?mH(n,this._c):[].concat(o),u],T=x[0],s=x.reduce((I,O)=>{const D=zR(n,O,d);return I.top=na(D.top,I.top),I.right=Wu(D.right,I.right),I.bottom=Wu(D.bottom,I.bottom),I.left=na(D.left,I.left),I},zR(n,T,d));return{width:s.right-s.left,height:s.bottom-s.top,x:s.left,y:s.top}}function _H(t){const{width:n,height:o}=PF(t);return{width:n,height:o}}function yH(t,n,o){const u=Bl(n),d=Lc(n),g=o==="fixed",x=cd(t,!0,g,n);let T={scrollLeft:0,scrollTop:0};const s=Hu(0);if(u||!u&&!g)if((Zu(n)!=="body"||ly(d))&&(T=P1(n)),u){const D=cd(n,!0,g,n);s.x=D.x+n.clientLeft,s.y=D.y+n.clientTop}else d&&(s.x=RF(d));const I=x.left+T.scrollLeft-s.x,O=x.top+T.scrollTop-s.y;return{x:I,y:O,width:x.width,height:x.height}}function NR(t,n){return!Bl(t)||Ra(t).position==="fixed"?null:n?n(t):t.offsetParent}function zF(t,n){const o=aa(t);if(!Bl(t)||DF(t))return o;let u=NR(t,n);for(;u&&oH(u)&&Ra(u).position==="static";)u=NR(u,n);return u&&(Zu(u)==="html"||Zu(u)==="body"&&Ra(u).position==="static"&&!aI(u))?o:u||sH(t)||o}const vH=async function(t){const n=this.getOffsetParent||zF,o=this.getDimensions;return{reference:yH(t.reference,await n(t.floating),t.strategy),floating:{x:0,y:0,...await o(t.floating)}}};function xH(t){return Ra(t).direction==="rtl"}const bH={convertOffsetParentRelativeRectToViewportRelativeRect:uH,getDocumentElement:Lc,getClippingRect:gH,getOffsetParent:zF,getElementRects:vH,getClientRects:hH,getDimensions:_H,getScale:np,isElement:Pc,isRTL:xH};function wH(t,n){let o=null,u;const d=Lc(t);function g(){var T;clearTimeout(u),(T=o)==null||T.disconnect(),o=null}function x(T,s){T===void 0&&(T=!1),s===void 0&&(s=1),g();const{left:I,top:O,width:D,height:N}=t.getBoundingClientRect();if(T||n(),!D||!N)return;const j=O0(O),G=O0(d.clientWidth-(I+D)),X=O0(d.clientHeight-(O+N)),te=O0(I),U={rootMargin:-j+"px "+-G+"px "+-X+"px "+-te+"px",threshold:na(0,Wu(1,s))||1};let q=!0;function J(pe){const ue=pe[0].intersectionRatio;if(ue!==s){if(!q)return x();ue?x(!1,ue):u=setTimeout(()=>{x(!1,1e-7)},100)}q=!1}try{o=new IntersectionObserver(J,{...U,root:d.ownerDocument})}catch{o=new IntersectionObserver(J,U)}o.observe(t)}return x(!0),g}function EH(t,n,o,u){u===void 0&&(u={});const{ancestorScroll:d=!0,ancestorResize:g=!0,elementResize:x=typeof ResizeObserver=="function",layoutShift:T=typeof IntersectionObserver=="function",animationFrame:s=!1}=u,I=cI(t),O=d||g?[...I?U_(I):[],...U_(n)]:[];O.forEach(H=>{d&&H.addEventListener("scroll",o,{passive:!0}),g&&H.addEventListener("resize",o)});const D=I&&T?wH(I,o):null;let N=-1,j=null;x&&(j=new ResizeObserver(H=>{let[U]=H;U&&U.target===I&&j&&(j.unobserve(n),cancelAnimationFrame(N),N=requestAnimationFrame(()=>{var q;(q=j)==null||q.observe(n)})),o()}),I&&!s&&j.observe(I),j.observe(n));let G,X=s?cd(t):null;s&&te();function te(){const H=cd(t);X&&(H.x!==X.x||H.y!==X.y||H.width!==X.width||H.height!==X.height)&&o(),X=H,G=requestAnimationFrame(te)}return o(),()=>{var H;O.forEach(U=>{d&&U.removeEventListener("scroll",o),g&&U.removeEventListener("resize",o)}),D==null||D(),(H=j)==null||H.disconnect(),j=null,s&&cancelAnimationFrame(G)}}const SH=rH,TH=KW,CH=iH,MH=JW,FR=QW,IH=nH,AH=(t,n,o)=>{const u=new Map,d={platform:bH,...o},g={...d.platform,_c:u};return YW(t,n,{...d,platform:g})},kH=t=>{function n(o){return{}.hasOwnProperty.call(o,"current")}return{name:"arrow",options:t,fn(o){const{element:u,padding:d}=typeof t=="function"?t(o):t;return u&&n(u)?u.current!=null?FR({element:u.current,padding:d}).fn(o):{}:u?FR({element:u,padding:d}).fn(o):{}}}};var px=typeof document<"u"?W.useLayoutEffect:W.useEffect;function e1(t,n){if(t===n)return!0;if(typeof t!=typeof n)return!1;if(typeof t=="function"&&t.toString()===n.toString())return!0;let o,u,d;if(t&&n&&typeof t=="object"){if(Array.isArray(t)){if(o=t.length,o!==n.length)return!1;for(u=o;u--!==0;)if(!e1(t[u],n[u]))return!1;return!0}if(d=Object.keys(t),o=d.length,o!==Object.keys(n).length)return!1;for(u=o;u--!==0;)if(!{}.hasOwnProperty.call(n,d[u]))return!1;for(u=o;u--!==0;){const g=d[u];if(!(g==="_owner"&&t.$$typeof)&&!e1(t[g],n[g]))return!1}return!0}return t!==t&&n!==n}function NF(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function BR(t,n){const o=NF(t);return Math.round(n*o)/o}function jR(t){const n=W.useRef(t);return px(()=>{n.current=t}),n}function PH(t){t===void 0&&(t={});const{placement:n="bottom",strategy:o="absolute",middleware:u=[],platform:d,elements:{reference:g,floating:x}={},transform:T=!0,whileElementsMounted:s,open:I}=t,[O,D]=W.useState({x:0,y:0,strategy:o,placement:n,middlewareData:{},isPositioned:!1}),[N,j]=W.useState(u);e1(N,u)||j(u);const[G,X]=W.useState(null),[te,H]=W.useState(null),U=W.useCallback(Ot=>{Ot!==ue.current&&(ue.current=Ot,X(Ot))},[]),q=W.useCallback(Ot=>{Ot!==Me.current&&(Me.current=Ot,H(Ot))},[]),J=g||G,pe=x||te,ue=W.useRef(null),Me=W.useRef(null),Se=W.useRef(O),ge=s!=null,se=jR(s),Ie=jR(d),We=W.useCallback(()=>{if(!ue.current||!Me.current)return;const Ot={placement:n,strategy:o,middleware:N};Ie.current&&(Ot.platform=Ie.current),AH(ue.current,Me.current,Ot).then(bt=>{const rt={...bt,isPositioned:!0};ze.current&&!e1(Se.current,rt)&&(Se.current=rt,gd.flushSync(()=>{D(rt)}))})},[N,n,o,Ie]);px(()=>{I===!1&&Se.current.isPositioned&&(Se.current.isPositioned=!1,D(Ot=>({...Ot,isPositioned:!1})))},[I]);const ze=W.useRef(!1);px(()=>(ze.current=!0,()=>{ze.current=!1}),[]),px(()=>{if(J&&(ue.current=J),pe&&(Me.current=pe),J&&pe){if(se.current)return se.current(J,pe,We);We()}},[J,pe,We,se,ge]);const De=W.useMemo(()=>({reference:ue,floating:Me,setReference:U,setFloating:q}),[U,q]),nt=W.useMemo(()=>({reference:J,floating:pe}),[J,pe]),It=W.useMemo(()=>{const Ot={position:o,left:0,top:0};if(!nt.floating)return Ot;const bt=BR(nt.floating,O.x),rt=BR(nt.floating,O.y);return T?{...Ot,transform:"translate("+bt+"px, "+rt+"px)",...NF(nt.floating)>=1.5&&{willChange:"transform"}}:{position:o,left:bt,top:rt}},[o,T,nt.floating,O.x,O.y]);return W.useMemo(()=>({...O,update:We,refs:De,elements:nt,floatingStyles:It}),[O,We,De,nt,It])}const OH=W.forwardRef((t,n)=>{const{children:o,width:u=10,height:d=5,...g}=t;return W.createElement(js.svg,bn({},g,{ref:n,width:u,height:d,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),t.asChild?o:W.createElement("polygon",{points:"0,0 30,0 15,10"}))}),DH=OH;function FF(t){const[n,o]=W.useState(void 0);return mp(()=>{if(t){o({width:t.offsetWidth,height:t.offsetHeight});const u=new ResizeObserver(d=>{if(!Array.isArray(d)||!d.length)return;const g=d[0];let x,T;if("borderBoxSize"in g){const s=g.borderBoxSize,I=Array.isArray(s)?s[0]:s;x=I.inlineSize,T=I.blockSize}else x=t.offsetWidth,T=t.offsetHeight;o({width:x,height:T})});return u.observe(t,{box:"border-box"}),()=>u.unobserve(t)}else o(void 0)},[t]),n}const BF="Popper",[jF,O1]=ay(BF),[RH,$F]=jF(BF),LH=t=>{const{__scopePopper:n,children:o}=t,[u,d]=W.useState(null);return W.createElement(RH,{scope:n,anchor:u,onAnchorChange:d},o)},zH="PopperAnchor",NH=W.forwardRef((t,n)=>{const{__scopePopper:o,virtualRef:u,...d}=t,g=$F(zH,o),x=W.useRef(null),T=La(n,x);return W.useEffect(()=>{g.onAnchorChange((u==null?void 0:u.current)||x.current)}),u?null:W.createElement(js.div,bn({},d,{ref:T}))}),UF="PopperContent",[FH,BH]=jF(UF),jH=W.forwardRef((t,n)=>{var o,u,d,g,x,T,s,I;const{__scopePopper:O,side:D="bottom",sideOffset:N=0,align:j="center",alignOffset:G=0,arrowPadding:X=0,avoidCollisions:te=!0,collisionBoundary:H=[],collisionPadding:U=0,sticky:q="partial",hideWhenDetached:J=!1,updatePositionStrategy:pe="optimized",onPlaced:ue,...Me}=t,Se=$F(UF,O),[ge,se]=W.useState(null),Ie=La(n,Mn=>se(Mn)),[We,ze]=W.useState(null),De=FF(We),nt=(o=De==null?void 0:De.width)!==null&&o!==void 0?o:0,It=(u=De==null?void 0:De.height)!==null&&u!==void 0?u:0,Ot=D+(j!=="center"?"-"+j:""),bt=typeof U=="number"?U:{top:0,right:0,bottom:0,left:0,...U},rt=Array.isArray(H)?H:[H],Gt=rt.length>0,Vt={padding:bt,boundary:rt.filter(GH),altBoundary:Gt},{refs:Jt,floatingStyles:wr,placement:or,isPositioned:et,middlewareData:At}=PH({strategy:"fixed",placement:Ot,whileElementsMounted:(...Mn)=>EH(...Mn,{animationFrame:pe==="always"}),elements:{reference:Se.anchor},middleware:[tH({mainAxis:N+It,alignmentAxis:G}),te&&SH({mainAxis:!0,crossAxis:!1,limiter:q==="partial"?IH():void 0,...Vt}),te&&TH({...Vt}),CH({...Vt,apply:({elements:Mn,rects:mr,availableWidth:vt,availableHeight:_e})=>{const{width:xe,height:Re}=mr.reference,ft=Mn.floating.style;ft.setProperty("--radix-popper-available-width",`${vt}px`),ft.setProperty("--radix-popper-available-height",`${_e}px`),ft.setProperty("--radix-popper-anchor-width",`${xe}px`),ft.setProperty("--radix-popper-anchor-height",`${Re}px`)}}),We&&kH({element:We,padding:X}),qH({arrowWidth:nt,arrowHeight:It}),J&&MH({strategy:"referenceHidden",...Vt})]}),[Qt,gr]=VF(or),Nt=qu(ue);mp(()=>{et&&(Nt==null||Nt())},[et,Nt]);const Er=(d=At.arrow)===null||d===void 0?void 0:d.x,Tr=(g=At.arrow)===null||g===void 0?void 0:g.y,$r=((x=At.arrow)===null||x===void 0?void 0:x.centerOffset)!==0,[Xr,cn]=W.useState();return mp(()=>{ge&&cn(window.getComputedStyle(ge).zIndex)},[ge]),W.createElement("div",{ref:Jt.setFloating,"data-radix-popper-content-wrapper":"",style:{...wr,transform:et?wr.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Xr,"--radix-popper-transform-origin":[(T=At.transformOrigin)===null||T===void 0?void 0:T.x,(s=At.transformOrigin)===null||s===void 0?void 0:s.y].join(" ")},dir:t.dir},W.createElement(FH,{scope:O,placedSide:Qt,onArrowChange:ze,arrowX:Er,arrowY:Tr,shouldHideArrow:$r},W.createElement(js.div,bn({"data-side":Qt,"data-align":gr},Me,{ref:Ie,style:{...Me.style,animation:et?void 0:"none",opacity:(I=At.hide)!==null&&I!==void 0&&I.referenceHidden?0:void 0}}))))}),$H="PopperArrow",UH={top:"bottom",right:"left",bottom:"top",left:"right"},VH=W.forwardRef(function(n,o){const{__scopePopper:u,...d}=n,g=BH($H,u),x=UH[g.placedSide];return W.createElement("span",{ref:g.onArrowChange,style:{position:"absolute",left:g.arrowX,top:g.arrowY,[x]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[g.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[g.placedSide],visibility:g.shouldHideArrow?"hidden":void 0}},W.createElement(DH,bn({},d,{ref:o,style:{...d.style,display:"block"}})))});function GH(t){return t!==null}const qH=t=>({name:"transformOrigin",options:t,fn(n){var o,u,d,g,x;const{placement:T,rects:s,middlewareData:I}=n,D=((o=I.arrow)===null||o===void 0?void 0:o.centerOffset)!==0,N=D?0:t.arrowWidth,j=D?0:t.arrowHeight,[G,X]=VF(T),te={start:"0%",center:"50%",end:"100%"}[X],H=((u=(d=I.arrow)===null||d===void 0?void 0:d.x)!==null&&u!==void 0?u:0)+N/2,U=((g=(x=I.arrow)===null||x===void 0?void 0:x.y)!==null&&g!==void 0?g:0)+j/2;let q="",J="";return G==="bottom"?(q=D?te:`${H}px`,J=`${-j}px`):G==="top"?(q=D?te:`${H}px`,J=`${s.floating.height+j}px`):G==="right"?(q=`${-j}px`,J=D?te:`${U}px`):G==="left"&&(q=`${s.floating.width+j}px`,J=D?te:`${U}px`),{data:{x:q,y:J}}}});function VF(t){const[n,o="center"]=t.split("-");return[n,o]}const GF=LH,qF=NH,WF=jH,HF=VH,uI=W.forwardRef((t,n)=>{var o;const{container:u=globalThis==null||(o=globalThis.document)===null||o===void 0?void 0:o.body,...d}=t;return u?EF.createPortal(W.createElement(js.div,bn({},d,{ref:n})),u):null});function WH(t,n){return W.useReducer((o,u)=>{const d=n[o][u];return d??o},t)}const zc=t=>{const{present:n,children:o}=t,u=HH(n),d=typeof o=="function"?o({present:u.isPresent}):W.Children.only(o),g=La(u.ref,d.ref);return typeof o=="function"||u.isPresent?W.cloneElement(d,{ref:g}):null};zc.displayName="Presence";function HH(t){const[n,o]=W.useState(),u=W.useRef({}),d=W.useRef(t),g=W.useRef("none"),x=t?"mounted":"unmounted",[T,s]=WH(x,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return W.useEffect(()=>{const I=D0(u.current);g.current=T==="mounted"?I:"none"},[T]),mp(()=>{const I=u.current,O=d.current;if(O!==t){const N=g.current,j=D0(I);t?s("MOUNT"):j==="none"||(I==null?void 0:I.display)==="none"?s("UNMOUNT"):s(O&&N!==j?"ANIMATION_OUT":"UNMOUNT"),d.current=t}},[t,s]),mp(()=>{if(n){const I=D=>{const j=D0(u.current).includes(D.animationName);D.target===n&&j&&gd.flushSync(()=>s("ANIMATION_END"))},O=D=>{D.target===n&&(g.current=D0(u.current))};return n.addEventListener("animationstart",O),n.addEventListener("animationcancel",I),n.addEventListener("animationend",I),()=>{n.removeEventListener("animationstart",O),n.removeEventListener("animationcancel",I),n.removeEventListener("animationend",I)}}else s("ANIMATION_END")},[n,s]),{isPresent:["mounted","unmountSuspended"].includes(T),ref:W.useCallback(I=>{I&&(u.current=getComputedStyle(I)),o(I)},[])}}function D0(t){return(t==null?void 0:t.animationName)||"none"}function D1({prop:t,defaultProp:n,onChange:o=()=>{}}){const[u,d]=ZH({defaultProp:n,onChange:o}),g=t!==void 0,x=g?t:u,T=qu(o),s=W.useCallback(I=>{if(g){const D=typeof I=="function"?I(t):I;D!==t&&T(D)}else d(I)},[g,t,d,T]);return[x,s]}function ZH({defaultProp:t,onChange:n}){const o=W.useState(t),[u]=o,d=W.useRef(u),g=qu(n);return W.useEffect(()=>{d.current!==u&&(g(u),d.current=u)},[u,d,g]),o}const XH=W.forwardRef((t,n)=>W.createElement(js.span,bn({},t,{ref:n,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}))),YH=XH,[R1,ule]=ay("Tooltip",[O1]),L1=O1(),QH="TooltipProvider",KH=700,dC="tooltip.open",[JH,hI]=R1(QH),eZ=t=>{const{__scopeTooltip:n,delayDuration:o=KH,skipDelayDuration:u=300,disableHoverableContent:d=!1,children:g}=t,[x,T]=W.useState(!0),s=W.useRef(!1),I=W.useRef(0);return W.useEffect(()=>{const O=I.current;return()=>window.clearTimeout(O)},[]),W.createElement(JH,{scope:n,isOpenDelayed:x,delayDuration:o,onOpen:W.useCallback(()=>{window.clearTimeout(I.current),T(!1)},[]),onClose:W.useCallback(()=>{window.clearTimeout(I.current),I.current=window.setTimeout(()=>T(!0),u)},[u]),isPointerInTransitRef:s,onPointerInTransitChange:W.useCallback(O=>{s.current=O},[]),disableHoverableContent:d},g)},dI="Tooltip",[tZ,cy]=R1(dI),rZ=t=>{const{__scopeTooltip:n,children:o,open:u,defaultOpen:d=!1,onOpenChange:g,disableHoverableContent:x,delayDuration:T}=t,s=hI(dI,t.__scopeTooltip),I=L1(n),[O,D]=W.useState(null),N=fx(),j=W.useRef(0),G=x??s.disableHoverableContent,X=T??s.delayDuration,te=W.useRef(!1),[H=!1,U]=D1({prop:u,defaultProp:d,onChange:Me=>{Me?(s.onOpen(),document.dispatchEvent(new CustomEvent(dC))):s.onClose(),g==null||g(Me)}}),q=W.useMemo(()=>H?te.current?"delayed-open":"instant-open":"closed",[H]),J=W.useCallback(()=>{window.clearTimeout(j.current),te.current=!1,U(!0)},[U]),pe=W.useCallback(()=>{window.clearTimeout(j.current),U(!1)},[U]),ue=W.useCallback(()=>{window.clearTimeout(j.current),j.current=window.setTimeout(()=>{te.current=!0,U(!0)},X)},[X,U]);return W.useEffect(()=>()=>window.clearTimeout(j.current),[]),W.createElement(GF,I,W.createElement(tZ,{scope:n,contentId:N,open:H,stateAttribute:q,trigger:O,onTriggerChange:D,onTriggerEnter:W.useCallback(()=>{s.isOpenDelayed?ue():J()},[s.isOpenDelayed,ue,J]),onTriggerLeave:W.useCallback(()=>{G?pe():window.clearTimeout(j.current)},[pe,G]),onOpen:J,onClose:pe,disableHoverableContent:G},o))},$R="TooltipTrigger",nZ=W.forwardRef((t,n)=>{const{__scopeTooltip:o,...u}=t,d=cy($R,o),g=hI($R,o),x=L1(o),T=W.useRef(null),s=La(n,T,d.onTriggerChange),I=W.useRef(!1),O=W.useRef(!1),D=W.useCallback(()=>I.current=!1,[]);return W.useEffect(()=>()=>document.removeEventListener("pointerup",D),[D]),W.createElement(qF,bn({asChild:!0},x),W.createElement(js.button,bn({"aria-describedby":d.open?d.contentId:void 0,"data-state":d.stateAttribute},u,{ref:s,onPointerMove:Ci(t.onPointerMove,N=>{N.pointerType!=="touch"&&!O.current&&!g.isPointerInTransitRef.current&&(d.onTriggerEnter(),O.current=!0)}),onPointerLeave:Ci(t.onPointerLeave,()=>{d.onTriggerLeave(),O.current=!1}),onPointerDown:Ci(t.onPointerDown,()=>{I.current=!0,document.addEventListener("pointerup",D,{once:!0})}),onFocus:Ci(t.onFocus,()=>{I.current||d.onOpen()}),onBlur:Ci(t.onBlur,d.onClose),onClick:Ci(t.onClick,d.onClose)})))}),ZF="TooltipPortal",[iZ,oZ]=R1(ZF,{forceMount:void 0}),sZ=t=>{const{__scopeTooltip:n,forceMount:o,children:u,container:d}=t,g=cy(ZF,n);return W.createElement(iZ,{scope:n,forceMount:o},W.createElement(zc,{present:o||g.open},W.createElement(uI,{asChild:!0,container:d},u)))},V_="TooltipContent",aZ=W.forwardRef((t,n)=>{const o=oZ(V_,t.__scopeTooltip),{forceMount:u=o.forceMount,side:d="top",...g}=t,x=cy(V_,t.__scopeTooltip);return W.createElement(zc,{present:u||x.open},x.disableHoverableContent?W.createElement(XF,bn({side:d},g,{ref:n})):W.createElement(lZ,bn({side:d},g,{ref:n})))}),lZ=W.forwardRef((t,n)=>{const o=cy(V_,t.__scopeTooltip),u=hI(V_,t.__scopeTooltip),d=W.useRef(null),g=La(n,d),[x,T]=W.useState(null),{trigger:s,onClose:I}=o,O=d.current,{onPointerInTransitChange:D}=u,N=W.useCallback(()=>{T(null),D(!1)},[D]),j=W.useCallback((G,X)=>{const te=G.currentTarget,H={x:G.clientX,y:G.clientY},U=fZ(H,te.getBoundingClientRect()),q=pZ(H,U),J=mZ(X.getBoundingClientRect()),pe=_Z([...q,...J]);T(pe),D(!0)},[D]);return W.useEffect(()=>()=>N(),[N]),W.useEffect(()=>{if(s&&O){const G=te=>j(te,O),X=te=>j(te,s);return s.addEventListener("pointerleave",G),O.addEventListener("pointerleave",X),()=>{s.removeEventListener("pointerleave",G),O.removeEventListener("pointerleave",X)}}},[s,O,j,N]),W.useEffect(()=>{if(x){const G=X=>{const te=X.target,H={x:X.clientX,y:X.clientY},U=(s==null?void 0:s.contains(te))||(O==null?void 0:O.contains(te)),q=!gZ(H,x);U?N():q&&(N(),I())};return document.addEventListener("pointermove",G),()=>document.removeEventListener("pointermove",G)}},[s,O,x,I,N]),W.createElement(XF,bn({},t,{ref:g}))}),[cZ,uZ]=R1(dI,{isInside:!1}),XF=W.forwardRef((t,n)=>{const{__scopeTooltip:o,children:u,"aria-label":d,onEscapeKeyDown:g,onPointerDownOutside:x,...T}=t,s=cy(V_,o),I=L1(o),{onClose:O}=s;return W.useEffect(()=>(document.addEventListener(dC,O),()=>document.removeEventListener(dC,O)),[O]),W.useEffect(()=>{if(s.trigger){const D=N=>{const j=N.target;j!=null&&j.contains(s.trigger)&&O()};return window.addEventListener("scroll",D,{capture:!0}),()=>window.removeEventListener("scroll",D,{capture:!0})}},[s.trigger,O]),W.createElement(nI,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:g,onPointerDownOutside:x,onFocusOutside:D=>D.preventDefault(),onDismiss:O},W.createElement(WF,bn({"data-state":s.stateAttribute},I,T,{ref:n,style:{...T.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"}}),W.createElement(CF,null,u),W.createElement(cZ,{scope:o,isInside:!0},W.createElement(YH,{id:s.contentId,role:"tooltip"},d||u))))}),hZ="TooltipArrow",dZ=W.forwardRef((t,n)=>{const{__scopeTooltip:o,...u}=t,d=L1(o);return uZ(hZ,o).isInside?null:W.createElement(HF,bn({},d,u,{ref:n}))});function fZ(t,n){const o=Math.abs(n.top-t.y),u=Math.abs(n.bottom-t.y),d=Math.abs(n.right-t.x),g=Math.abs(n.left-t.x);switch(Math.min(o,u,d,g)){case g:return"left";case d:return"right";case o:return"top";case u:return"bottom";default:throw new Error("unreachable")}}function pZ(t,n,o=5){const u=[];switch(n){case"top":u.push({x:t.x-o,y:t.y+o},{x:t.x+o,y:t.y+o});break;case"bottom":u.push({x:t.x-o,y:t.y-o},{x:t.x+o,y:t.y-o});break;case"left":u.push({x:t.x+o,y:t.y-o},{x:t.x+o,y:t.y+o});break;case"right":u.push({x:t.x-o,y:t.y-o},{x:t.x-o,y:t.y+o});break}return u}function mZ(t){const{top:n,right:o,bottom:u,left:d}=t;return[{x:d,y:n},{x:o,y:n},{x:o,y:u},{x:d,y:u}]}function gZ(t,n){const{x:o,y:u}=t;let d=!1;for(let g=0,x=n.length-1;g<n.length;x=g++){const T=n[g].x,s=n[g].y,I=n[x].x,O=n[x].y;s>u!=O>u&&o<(I-T)*(u-s)/(O-s)+T&&(d=!d)}return d}function _Z(t){const n=t.slice();return n.sort((o,u)=>o.x<u.x?-1:o.x>u.x?1:o.y<u.y?-1:o.y>u.y?1:0),yZ(n)}function yZ(t){if(t.length<=1)return t.slice();const n=[];for(let u=0;u<t.length;u++){const d=t[u];for(;n.length>=2;){const g=n[n.length-1],x=n[n.length-2];if((g.x-x.x)*(d.y-x.y)>=(g.y-x.y)*(d.x-x.x))n.pop();else break}n.push(d)}n.pop();const o=[];for(let u=t.length-1;u>=0;u--){const d=t[u];for(;o.length>=2;){const g=o[o.length-1],x=o[o.length-2];if((g.x-x.x)*(d.y-x.y)>=(g.y-x.y)*(d.x-x.x))o.pop();else break}o.push(d)}return o.pop(),n.length===1&&o.length===1&&n[0].x===o[0].x&&n[0].y===o[0].y?n:n.concat(o)}const vZ=eZ,uy=rZ,hy=nZ,dy=sZ,fy=aZ,py=dZ,Nn=BC.createContext({});function xZ({iconProps:t,children:n}){return BC.createElement(Nn.Provider,{value:t||{},children:n})}var bZ=Object.defineProperty,UR=Object.getOwnPropertySymbols,wZ=Object.prototype.hasOwnProperty,EZ=Object.prototype.propertyIsEnumerable,VR=(t,n,o)=>n in t?bZ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,WE=(t,n)=>{for(var o in n||(n={}))wZ.call(n,o)&&VR(t,o,n[o]);if(UR)for(var o of UR(n))EZ.call(n,o)&&VR(t,o,n[o]);return t};const SZ=(t,n)=>{const o=W.useContext(Nn),u=WE(WE({},o),t);return W.createElement("svg",WE({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M3 12L21 12M21 12L12.5 3.5M21 12L12.5 20.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},TZ=W.forwardRef(SZ);var Rl=TZ,CZ=Object.defineProperty,GR=Object.getOwnPropertySymbols,MZ=Object.prototype.hasOwnProperty,IZ=Object.prototype.propertyIsEnumerable,qR=(t,n,o)=>n in t?CZ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,HE=(t,n)=>{for(var o in n||(n={}))MZ.call(n,o)&&qR(t,o,n[o]);if(GR)for(var o of GR(n))IZ.call(n,o)&&qR(t,o,n[o]);return t};const AZ=(t,n)=>{const o=W.useContext(Nn),u=HE(HE({},o),t);return W.createElement("svg",HE({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M17 8L12 3L7 8",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M17 16L12 21L7 16",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},kZ=W.forwardRef(AZ);var fI=kZ,PZ=Object.defineProperty,WR=Object.getOwnPropertySymbols,OZ=Object.prototype.hasOwnProperty,DZ=Object.prototype.propertyIsEnumerable,HR=(t,n,o)=>n in t?PZ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,ZE=(t,n)=>{for(var o in n||(n={}))OZ.call(n,o)&&HR(t,o,n[o]);if(WR)for(var o of WR(n))DZ.call(n,o)&&HR(t,o,n[o]);return t};const RZ=(t,n)=>{const o=W.useContext(Nn),u=ZE(ZE({},o),t);return W.createElement("svg",ZE({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M17 4L12 9L7 4",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M17 20L12 15L7 20",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},LZ=W.forwardRef(RZ);var YF=LZ,zZ=Object.defineProperty,ZR=Object.getOwnPropertySymbols,NZ=Object.prototype.hasOwnProperty,FZ=Object.prototype.propertyIsEnumerable,XR=(t,n,o)=>n in t?zZ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,XE=(t,n)=>{for(var o in n||(n={}))NZ.call(n,o)&&XR(t,o,n[o]);if(ZR)for(var o of ZR(n))FZ.call(n,o)&&XR(t,o,n[o]);return t};const BZ=(t,n)=>{const o=W.useContext(Nn),u=XE(XE({},o),t);return W.createElement("svg",XE({width:"1.5em",strokeWidth:1.5,height:"1.5em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M4 19V5C4 3.89543 4.89543 3 6 3H19.4C19.7314 3 20 3.26863 20 3.6V16.7143",stroke:"currentColor",strokeLinecap:"round"}),W.createElement("path",{d:"M6 17L20 17",stroke:"currentColor",strokeLinecap:"round"}),W.createElement("path",{d:"M6 21L20 21",stroke:"currentColor",strokeLinecap:"round"}),W.createElement("path",{d:"M6 21C4.89543 21 4 20.1046 4 19C4 17.8954 4.89543 17 6 17",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M9 7L15 7",stroke:"currentColor",strokeLinecap:"round"}))},jZ=W.forwardRef(BZ);var $Z=jZ,UZ=Object.defineProperty,YR=Object.getOwnPropertySymbols,VZ=Object.prototype.hasOwnProperty,GZ=Object.prototype.propertyIsEnumerable,QR=(t,n,o)=>n in t?UZ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,YE=(t,n)=>{for(var o in n||(n={}))VZ.call(n,o)&&QR(t,o,n[o]);if(YR)for(var o of YR(n))GZ.call(n,o)&&QR(t,o,n[o]);return t};const qZ=(t,n)=>{const o=W.useContext(Nn),u=YE(YE({},o),t);return W.createElement("svg",YE({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M13 21H5C3.89543 21 3 20.1046 3 19V10H21V13M15 4V2M15 4V6M15 4H10.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M3 10V6C3 4.89543 3.89543 4 5 4H7",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M7 2V6",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M21 10V6C21 4.89543 20.1046 4 19 4H18.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M14.9922 18H17.9922M21 18H17.9922M17.9922 18V15M17.9922 18V21",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},WZ=W.forwardRef(qZ);var HZ=WZ,ZZ=Object.defineProperty,KR=Object.getOwnPropertySymbols,XZ=Object.prototype.hasOwnProperty,YZ=Object.prototype.propertyIsEnumerable,JR=(t,n,o)=>n in t?ZZ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,QE=(t,n)=>{for(var o in n||(n={}))XZ.call(n,o)&&JR(t,o,n[o]);if(KR)for(var o of KR(n))YZ.call(n,o)&&JR(t,o,n[o]);return t};const QZ=(t,n)=>{const o=W.useContext(Nn),u=QE(QE({},o),t);return W.createElement("svg",QE({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M15 4V2M15 4V6M15 4H10.5M3 10V19C3 20.1046 3.89543 21 5 21H19C20.1046 21 21 20.1046 21 19V10H3Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M3 10V6C3 4.89543 3.89543 4 5 4H7",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M7 2V6",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M21 10V6C21 4.89543 20.1046 4 19 4H18.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},KZ=W.forwardRef(QZ);var JZ=KZ,eX=Object.defineProperty,eL=Object.getOwnPropertySymbols,tX=Object.prototype.hasOwnProperty,rX=Object.prototype.propertyIsEnumerable,tL=(t,n,o)=>n in t?eX(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,KE=(t,n)=>{for(var o in n||(n={}))tX.call(n,o)&&tL(t,o,n[o]);if(eL)for(var o of eL(n))rX.call(n,o)&&tL(t,o,n[o]);return t};const nX=(t,n)=>{const o=W.useContext(Nn),u=KE(KE({},o),t);return W.createElement("svg",KE({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M5 13L9 17L19 7",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},iX=W.forwardRef(nX);var Nh=iX,oX=Object.defineProperty,rL=Object.getOwnPropertySymbols,sX=Object.prototype.hasOwnProperty,aX=Object.prototype.propertyIsEnumerable,nL=(t,n,o)=>n in t?oX(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,JE=(t,n)=>{for(var o in n||(n={}))sX.call(n,o)&&nL(t,o,n[o]);if(rL)for(var o of rL(n))aX.call(n,o)&&nL(t,o,n[o]);return t};const lX=(t,n)=>{const o=W.useContext(Nn),u=JE(JE({},o),t);return W.createElement("svg",JE({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M8.5 4H6C4.89543 4 4 4.89543 4 6V20C4 21.1046 4.89543 22 6 22H12",stroke:"currentColor",strokeLinecap:"round"}),W.createElement("path",{d:"M15.5 4H18C19.1046 4 20 4.89543 20 6V15",stroke:"currentColor",strokeLinecap:"round"}),W.createElement("path",{d:"M8 6.4V4.5C8 4.22386 8.22386 4 8.5 4C8.77614 4 9.00422 3.77604 9.05152 3.50398C9.19968 2.65171 9.77399 1 12 1C14.226 1 14.8003 2.65171 14.9485 3.50398C14.9958 3.77604 15.2239 4 15.5 4C15.7761 4 16 4.22386 16 4.5V6.4C16 6.73137 15.7314 7 15.4 7H8.6C8.26863 7 8 6.73137 8 6.4Z",stroke:"currentColor",strokeLinecap:"round"}),W.createElement("path",{d:"M15.5 20.5L17.5 22.5L22.5 17.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},cX=W.forwardRef(lX);var uX=cX,hX=Object.defineProperty,iL=Object.getOwnPropertySymbols,dX=Object.prototype.hasOwnProperty,fX=Object.prototype.propertyIsEnumerable,oL=(t,n,o)=>n in t?hX(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,eS=(t,n)=>{for(var o in n||(n={}))dX.call(n,o)&&oL(t,o,n[o]);if(iL)for(var o of iL(n))fX.call(n,o)&&oL(t,o,n[o]);return t};const pX=(t,n)=>{const o=W.useContext(Nn),u=eS(eS({},o),t);return W.createElement("svg",eS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M12 6L12 12L18 12",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},mX=W.forwardRef(pX);var gX=mX,_X=Object.defineProperty,sL=Object.getOwnPropertySymbols,yX=Object.prototype.hasOwnProperty,vX=Object.prototype.propertyIsEnumerable,aL=(t,n,o)=>n in t?_X(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,tS=(t,n)=>{for(var o in n||(n={}))yX.call(n,o)&&aL(t,o,n[o]);if(sL)for(var o of sL(n))vX.call(n,o)&&aL(t,o,n[o]);return t};const xX=(t,n)=>{const o=W.useContext(Nn),u=tS(tS({},o),t);return W.createElement("svg",tS({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M5.5 16C10.5 18.5 13.5 18.5 18.5 16",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M15.5 17.5L16.5 19.5C16.5 19.5 20.6713 18.1717 22 16C22 15 22.5301 7.85339 19 5.5C17.5 4.5 15 4 15 4L14 6H12",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M8.52832 17.5L7.52832 19.5C7.52832 19.5 3.35699 18.1717 2.02832 16C2.02832 15 1.49823 7.85339 5.02832 5.5C6.52832 4.5 9.02832 4 9.02832 4L10.0283 6H12.0283",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M8.5 14C7.67157 14 7 13.1046 7 12C7 10.8954 7.67157 10 8.5 10C9.32843 10 10 10.8954 10 12C10 13.1046 9.32843 14 8.5 14Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M15.5 14C14.6716 14 14 13.1046 14 12C14 10.8954 14.6716 10 15.5 10C16.3284 10 17 10.8954 17 12C17 13.1046 16.3284 14 15.5 14Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},bX=W.forwardRef(xX);var wX=bX,EX=Object.defineProperty,lL=Object.getOwnPropertySymbols,SX=Object.prototype.hasOwnProperty,TX=Object.prototype.propertyIsEnumerable,cL=(t,n,o)=>n in t?EX(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,rS=(t,n)=>{for(var o in n||(n={}))SX.call(n,o)&&cL(t,o,n[o]);if(lL)for(var o of lL(n))TX.call(n,o)&&cL(t,o,n[o]);return t};const CX=(t,n)=>{const o=W.useContext(Nn),u=rS(rS({},o),t);return W.createElement("svg",rS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M17 2H14C12.6739 2 11.4021 2.52678 10.4645 3.46447C9.52678 4.40215 9 5.67392 9 7V10H6V14H9V22H13V14H16L17 10H13V7C13 6.73478 13.1054 6.48043 13.2929 6.29289C13.4804 6.10536 13.7348 6 14 6H17V2Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},MX=W.forwardRef(CX);var IX=MX,AX=Object.defineProperty,uL=Object.getOwnPropertySymbols,kX=Object.prototype.hasOwnProperty,PX=Object.prototype.propertyIsEnumerable,hL=(t,n,o)=>n in t?AX(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,nS=(t,n)=>{for(var o in n||(n={}))kX.call(n,o)&&hL(t,o,n[o]);if(uL)for(var o of uL(n))PX.call(n,o)&&hL(t,o,n[o]);return t};const OX=(t,n)=>{const o=W.useContext(Nn),u=nS(nS({},o),t);return W.createElement("svg",nS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M3.99961 3H19.9997C20.552 3 20.9997 3.44764 20.9997 3.99987L20.9999 5.58569C21 5.85097 20.8946 6.10538 20.707 6.29295L14.2925 12.7071C14.105 12.8946 13.9996 13.149 13.9996 13.4142L13.9996 19.7192C13.9996 20.3698 13.3882 20.8472 12.7571 20.6894L10.7571 20.1894C10.3119 20.0781 9.99961 19.6781 9.99961 19.2192L9.99961 13.4142C9.99961 13.149 9.89425 12.8946 9.70672 12.7071L3.2925 6.29289C3.10496 6.10536 2.99961 5.851 2.99961 5.58579V4C2.99961 3.44772 3.44732 3 3.99961 3Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},DX=W.forwardRef(OX);var RX=DX,LX=Object.defineProperty,dL=Object.getOwnPropertySymbols,zX=Object.prototype.hasOwnProperty,NX=Object.prototype.propertyIsEnumerable,fL=(t,n,o)=>n in t?LX(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,iS=(t,n)=>{for(var o in n||(n={}))zX.call(n,o)&&fL(t,o,n[o]);if(dL)for(var o of dL(n))NX.call(n,o)&&fL(t,o,n[o]);return t};const FX=(t,n)=>{const o=W.useContext(Nn),u=iS(iS({},o),t);return W.createElement("svg",iS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M6 3L6 21",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M18 3L18 21",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M3 6L21 6",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M3 18L21 18",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},BX=W.forwardRef(FX);var QF=BX,jX=Object.defineProperty,pL=Object.getOwnPropertySymbols,$X=Object.prototype.hasOwnProperty,UX=Object.prototype.propertyIsEnumerable,mL=(t,n,o)=>n in t?jX(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,oS=(t,n)=>{for(var o in n||(n={}))$X.call(n,o)&&mL(t,o,n[o]);if(pL)for(var o of pL(n))UX.call(n,o)&&mL(t,o,n[o]);return t};const VX=(t,n)=>{const o=W.useContext(Nn),u=oS(oS({},o),t);return W.createElement("svg",oS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M16 22.0268V19.1568C16.0375 18.68 15.9731 18.2006 15.811 17.7506C15.6489 17.3006 15.3929 16.8902 15.06 16.5468C18.2 16.1968 21.5 15.0068 21.5 9.54679C21.4997 8.15062 20.9627 6.80799 20 5.79679C20.4558 4.5753 20.4236 3.22514 19.91 2.02679C19.91 2.02679 18.73 1.67679 16 3.50679C13.708 2.88561 11.292 2.88561 8.99999 3.50679C6.26999 1.67679 5.08999 2.02679 5.08999 2.02679C4.57636 3.22514 4.54413 4.5753 4.99999 5.79679C4.03011 6.81549 3.49251 8.17026 3.49999 9.57679C3.49999 14.9968 6.79998 16.1868 9.93998 16.5768C9.61098 16.9168 9.35725 17.3222 9.19529 17.7667C9.03334 18.2112 8.96679 18.6849 8.99999 19.1568V22.0268",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M9 20.0267C6 20.9999 3.5 20.0267 2 17.0267",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},GX=W.forwardRef(VX);var qX=GX,WX=Object.defineProperty,gL=Object.getOwnPropertySymbols,HX=Object.prototype.hasOwnProperty,ZX=Object.prototype.propertyIsEnumerable,_L=(t,n,o)=>n in t?WX(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,sS=(t,n)=>{for(var o in n||(n={}))HX.call(n,o)&&_L(t,o,n[o]);if(gL)for(var o of gL(n))ZX.call(n,o)&&_L(t,o,n[o]);return t};const XX=(t,n)=>{const o=W.useContext(Nn),u=sS(sS({},o),t);return W.createElement("svg",sS({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M10 3L6 21",stroke:"currentColor",strokeLinecap:"round"}),W.createElement("path",{d:"M20.5 16H2.5",stroke:"currentColor",strokeLinecap:"round"}),W.createElement("path",{d:"M22 7H4",stroke:"currentColor",strokeLinecap:"round"}),W.createElement("path",{d:"M18 3L14 21",stroke:"currentColor",strokeLinecap:"round"}))},YX=W.forwardRef(XX);var QX=YX,KX=Object.defineProperty,yL=Object.getOwnPropertySymbols,JX=Object.prototype.hasOwnProperty,eY=Object.prototype.propertyIsEnumerable,vL=(t,n,o)=>n in t?KX(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,aS=(t,n)=>{for(var o in n||(n={}))JX.call(n,o)&&vL(t,o,n[o]);if(yL)for(var o of yL(n))eY.call(n,o)&&vL(t,o,n[o]);return t};const tY=(t,n)=>{const o=W.useContext(Nn),u=aS(aS({},o),t);return W.createElement("svg",aS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M22 8.86222C22 10.4087 21.4062 11.8941 20.3458 12.9929C17.9049 15.523 15.5374 18.1613 13.0053 20.5997C12.4249 21.1505 11.5042 21.1304 10.9488 20.5547L3.65376 12.9929C1.44875 10.7072 1.44875 7.01723 3.65376 4.73157C5.88044 2.42345 9.50794 2.42345 11.7346 4.73157L11.9998 5.00642L12.2648 4.73173C13.3324 3.6245 14.7864 3 16.3053 3C17.8242 3 19.2781 3.62444 20.3458 4.73157C21.4063 5.83045 22 7.31577 22 8.86222Z",stroke:"currentColor",strokeLinejoin:"round"}))},rY=W.forwardRef(tY);var nY=rY,iY=Object.defineProperty,xL=Object.getOwnPropertySymbols,oY=Object.prototype.hasOwnProperty,sY=Object.prototype.propertyIsEnumerable,bL=(t,n,o)=>n in t?iY(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,lS=(t,n)=>{for(var o in n||(n={}))oY.call(n,o)&&bL(t,o,n[o]);if(xL)for(var o of xL(n))sY.call(n,o)&&bL(t,o,n[o]);return t};const aY=(t,n)=>{const o=W.useContext(Nn),u=lS(lS({},o),t);return W.createElement("svg",lS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M3 16V8C3 5.23858 5.23858 3 8 3H16C18.7614 3 21 5.23858 21 8V16C21 18.7614 18.7614 21 16 21H8C5.23858 21 3 18.7614 3 16Z",stroke:"currentColor"}),W.createElement("path",{d:"M17.5 6.51L17.51 6.49889",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},lY=W.forwardRef(aY);var cY=lY,uY=Object.defineProperty,wL=Object.getOwnPropertySymbols,hY=Object.prototype.hasOwnProperty,dY=Object.prototype.propertyIsEnumerable,EL=(t,n,o)=>n in t?uY(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,cS=(t,n)=>{for(var o in n||(n={}))hY.call(n,o)&&EL(t,o,n[o]);if(wL)for(var o of wL(n))dY.call(n,o)&&EL(t,o,n[o]);return t};const fY=(t,n)=>{const o=W.useContext(Nn),u=cS(cS({},o),t);return W.createElement("svg",cS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M3 5H21",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M3 12H21",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M3 19H21",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},pY=W.forwardRef(fY);var mY=pY,gY=Object.defineProperty,SL=Object.getOwnPropertySymbols,_Y=Object.prototype.hasOwnProperty,yY=Object.prototype.propertyIsEnumerable,TL=(t,n,o)=>n in t?gY(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,uS=(t,n)=>{for(var o in n||(n={}))_Y.call(n,o)&&TL(t,o,n[o]);if(SL)for(var o of SL(n))yY.call(n,o)&&TL(t,o,n[o]);return t};const vY=(t,n)=>{const o=W.useContext(Nn),u=uS(uS({},o),t);return W.createElement("svg",uS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M7 12L17 12",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M7 8L13 8",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M3 20.2895V5C3 3.89543 3.89543 3 5 3H19C20.1046 3 21 3.89543 21 5V15C21 16.1046 20.1046 17 19 17H7.96125C7.35368 17 6.77906 17.2762 6.39951 17.7506L4.06852 20.6643C3.71421 21.1072 3 20.8567 3 20.2895Z",stroke:"currentColor"}))},xY=W.forwardRef(vY);var bY=xY,wY=Object.defineProperty,CL=Object.getOwnPropertySymbols,EY=Object.prototype.hasOwnProperty,SY=Object.prototype.propertyIsEnumerable,ML=(t,n,o)=>n in t?wY(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,hS=(t,n)=>{for(var o in n||(n={}))EY.call(n,o)&&ML(t,o,n[o]);if(CL)for(var o of CL(n))SY.call(n,o)&&ML(t,o,n[o]);return t};const TY=(t,n)=>{const o=W.useContext(Nn),u=hS(hS({},o),t);return W.createElement("svg",hS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M6 12H18",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},CY=W.forwardRef(TY);var dS=CY,MY=Object.defineProperty,IL=Object.getOwnPropertySymbols,IY=Object.prototype.hasOwnProperty,AY=Object.prototype.propertyIsEnumerable,AL=(t,n,o)=>n in t?MY(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,fS=(t,n)=>{for(var o in n||(n={}))IY.call(n,o)&&AL(t,o,n[o]);if(IL)for(var o of IL(n))AY.call(n,o)&&AL(t,o,n[o]);return t};const kY=(t,n)=>{const o=W.useContext(Nn),u=fS(fS({},o),t);return W.createElement("svg",fS({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M21 3L15 3M21 3L12 12M21 3V9",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M21 13V19C21 20.1046 20.1046 21 19 21H5C3.89543 21 3 20.1046 3 19V5C3 3.89543 3.89543 3 5 3H11",stroke:"currentColor",strokeLinecap:"round"}))},PY=W.forwardRef(kY);var KF=PY,OY=Object.defineProperty,kL=Object.getOwnPropertySymbols,DY=Object.prototype.hasOwnProperty,RY=Object.prototype.propertyIsEnumerable,PL=(t,n,o)=>n in t?OY(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,pS=(t,n)=>{for(var o in n||(n={}))DY.call(n,o)&&PL(t,o,n[o]);if(kL)for(var o of kL(n))RY.call(n,o)&&PL(t,o,n[o]);return t};const LY=(t,n)=>{const o=W.useContext(Nn),u=pS(pS({},o),t);return W.createElement("svg",pS({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M8.5 4H6C4.89543 4 4 4.89543 4 6V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V6C20 4.89543 19.1046 4 18 4H15.5",stroke:"currentColor",strokeLinecap:"round"}),W.createElement("path",{d:"M8 6.4V4.5C8 4.22386 8.22386 4 8.5 4C8.77614 4 9.00422 3.77604 9.05152 3.50398C9.19968 2.65171 9.77399 1 12 1C14.226 1 14.8003 2.65171 14.9485 3.50398C14.9958 3.77604 15.2239 4 15.5 4C15.7761 4 16 4.22386 16 4.5V6.4C16 6.73137 15.7314 7 15.4 7H8.6C8.26863 7 8 6.73137 8 6.4Z",stroke:"currentColor",strokeLinecap:"round"}))},zY=W.forwardRef(LY);var NY=zY,FY=Object.defineProperty,OL=Object.getOwnPropertySymbols,BY=Object.prototype.hasOwnProperty,jY=Object.prototype.propertyIsEnumerable,DL=(t,n,o)=>n in t?FY(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,mS=(t,n)=>{for(var o in n||(n={}))BY.call(n,o)&&DL(t,o,n[o]);if(OL)for(var o of OL(n))jY.call(n,o)&&DL(t,o,n[o]);return t};const $Y=(t,n)=>{const o=W.useContext(Nn),u=mS(mS({},o),t);return W.createElement("svg",mS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M6 12H12M18 12H12M12 12V6M12 12V18",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},UY=W.forwardRef($Y);var m_=UY,VY=Object.defineProperty,RL=Object.getOwnPropertySymbols,GY=Object.prototype.hasOwnProperty,qY=Object.prototype.propertyIsEnumerable,LL=(t,n,o)=>n in t?VY(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,gS=(t,n)=>{for(var o in n||(n={}))GY.call(n,o)&&LL(t,o,n[o]);if(RL)for(var o of RL(n))qY.call(n,o)&&LL(t,o,n[o]);return t};const WY=(t,n)=>{const o=W.useContext(Nn),u=gS(gS({},o),t);return W.createElement("svg",gS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M20 13V19C20 20.1046 19.1046 21 18 21H6C4.89543 21 4 20.1046 4 19V13",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M12 15V3M12 3L8.5 6.5M12 3L15.5 6.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},HY=W.forwardRef(WY);var ZY=HY,XY=Object.defineProperty,zL=Object.getOwnPropertySymbols,YY=Object.prototype.hasOwnProperty,QY=Object.prototype.propertyIsEnumerable,NL=(t,n,o)=>n in t?XY(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,_S=(t,n)=>{for(var o in n||(n={}))YY.call(n,o)&&NL(t,o,n[o]);if(zL)for(var o of zL(n))QY.call(n,o)&&NL(t,o,n[o]);return t};const KY=(t,n)=>{const o=W.useContext(Nn),u=_S(_S({},o),t);return W.createElement("svg",_S({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M8 15C12.8747 15 15 12.949 15 8C15 12.949 17.1104 15 22 15C17.1104 15 15 17.1104 15 22C15 17.1104 12.8747 15 8 15Z",stroke:"currentColor",strokeLinejoin:"round"}),W.createElement("path",{d:"M2 6.5C5.13376 6.5 6.5 5.18153 6.5 2C6.5 5.18153 7.85669 6.5 11 6.5C7.85669 6.5 6.5 7.85669 6.5 11C6.5 7.85669 5.13376 6.5 2 6.5Z",stroke:"currentColor",strokeLinejoin:"round"}))},JY=W.forwardRef(KY);var eQ=JY,tQ=Object.defineProperty,FL=Object.getOwnPropertySymbols,rQ=Object.prototype.hasOwnProperty,nQ=Object.prototype.propertyIsEnumerable,BL=(t,n,o)=>n in t?tQ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,yS=(t,n)=>{for(var o in n||(n={}))rQ.call(n,o)&&BL(t,o,n[o]);if(FL)for(var o of FL(n))nQ.call(n,o)&&BL(t,o,n[o]);return t};const iQ=(t,n)=>{const o=W.useContext(Nn),u=yS(yS({},o),t);return W.createElement("svg",yS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M5 20V19C5 15.134 8.13401 12 12 12V12C15.866 12 19 15.134 19 19V20",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M12 12C14.2091 12 16 10.2091 16 8C16 5.79086 14.2091 4 12 4C9.79086 4 8 5.79086 8 8C8 10.2091 9.79086 12 12 12Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},oQ=W.forwardRef(iQ);var JF=oQ,sQ=Object.defineProperty,jL=Object.getOwnPropertySymbols,aQ=Object.prototype.hasOwnProperty,lQ=Object.prototype.propertyIsEnumerable,$L=(t,n,o)=>n in t?sQ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,vS=(t,n)=>{for(var o in n||(n={}))aQ.call(n,o)&&$L(t,o,n[o]);if(jL)for(var o of jL(n))lQ.call(n,o)&&$L(t,o,n[o]);return t};const cQ=(t,n)=>{const o=W.useContext(Nn),u=vS(vS({},o),t);return W.createElement("svg",vS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M12.4409 9.12717L11.0322 14.7618L15.9626 21.1008",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M10.3278 18.2835L8.21484 21.1008",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M8.21484 13.3532C8.21484 9.40889 11.0323 9.12714 12.4409 9.12717L13.8494 9.12714C14.0842 10.301 15.1172 12.7897 17.3711 13.3531",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M13 7C14.1046 7 15 6.10457 15 5C15 3.89543 14.1046 3 13 3C11.8954 3 11 3.89543 11 5C11 6.10457 11.8954 7 13 7Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},uQ=W.forwardRef(cQ);var UL=uQ,hQ=Object.defineProperty,VL=Object.getOwnPropertySymbols,dQ=Object.prototype.hasOwnProperty,fQ=Object.prototype.propertyIsEnumerable,GL=(t,n,o)=>n in t?hQ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,xS=(t,n)=>{for(var o in n||(n={}))dQ.call(n,o)&&GL(t,o,n[o]);if(VL)for(var o of VL(n))fQ.call(n,o)&&GL(t,o,n[o]);return t};const pQ=(t,n)=>{const o=W.useContext(Nn),u=xS(xS({},o),t);return W.createElement("svg",xS({width:"1.5em",height:"1.5em",strokeWidth:1.5,viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M6.75827 17.2426L12.0009 12M17.2435 6.75736L12.0009 12M12.0009 12L6.75827 6.75736M12.0009 12L17.2435 17.2426",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},mQ=W.forwardRef(pQ);var pI=mQ,gQ=Object.defineProperty,qL=Object.getOwnPropertySymbols,_Q=Object.prototype.hasOwnProperty,yQ=Object.prototype.propertyIsEnumerable,WL=(t,n,o)=>n in t?gQ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,bS=(t,n)=>{for(var o in n||(n={}))_Q.call(n,o)&&WL(t,o,n[o]);if(qL)for(var o of qL(n))yQ.call(n,o)&&WL(t,o,n[o]);return t};const vQ=(t,n)=>{const o=W.useContext(Nn),u=bS(bS({},o),t);return W.createElement("svg",bS({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M8 11H11M14 11H11M11 11V8M11 11V14",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M17 17L21 21",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M3 11C3 15.4183 6.58172 19 11 19C13.213 19 15.2161 18.1015 16.6644 16.6493C18.1077 15.2022 19 13.2053 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},xQ=W.forwardRef(vQ);var bQ=xQ,wQ=Object.defineProperty,HL=Object.getOwnPropertySymbols,EQ=Object.prototype.hasOwnProperty,SQ=Object.prototype.propertyIsEnumerable,ZL=(t,n,o)=>n in t?wQ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,wS=(t,n)=>{for(var o in n||(n={}))EQ.call(n,o)&&ZL(t,o,n[o]);if(HL)for(var o of HL(n))SQ.call(n,o)&&ZL(t,o,n[o]);return t};const TQ=(t,n)=>{const o=W.useContext(Nn),u=wS(wS({},o),t);return W.createElement("svg",wS({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",strokeWidth:1.5,fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M17 17L21 21",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M3 11C3 15.4183 6.58172 19 11 19C13.213 19 15.2161 18.1015 16.6644 16.6493C18.1077 15.2022 19 13.2053 19 11C19 6.58172 15.4183 3 11 3C6.58172 3 3 6.58172 3 11Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),W.createElement("path",{d:"M8 11L14 11",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},CQ=W.forwardRef(TQ);var MQ=CQ,IQ=Object.defineProperty,XL=Object.getOwnPropertySymbols,AQ=Object.prototype.hasOwnProperty,kQ=Object.prototype.propertyIsEnumerable,YL=(t,n,o)=>n in t?IQ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,ES=(t,n)=>{for(var o in n||(n={}))AQ.call(n,o)&&YL(t,o,n[o]);if(XL)for(var o of XL(n))kQ.call(n,o)&&YL(t,o,n[o]);return t};const PQ=(t,n)=>{const o=W.useContext(Nn),u=ES(ES({},o),t);return W.createElement("svg",ES({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M5 21V5C5 3.89543 5.89543 3 7 3H17C18.1046 3 19 3.89543 19 5V21L13.0815 17.1953C12.4227 16.7717 11.5773 16.7717 10.9185 17.1953L5 21Z",fill:"currentColor",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},OQ=W.forwardRef(PQ);var DQ=OQ,RQ=Object.defineProperty,QL=Object.getOwnPropertySymbols,LQ=Object.prototype.hasOwnProperty,zQ=Object.prototype.propertyIsEnumerable,KL=(t,n,o)=>n in t?RQ(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o,SS=(t,n)=>{for(var o in n||(n={}))LQ.call(n,o)&&KL(t,o,n[o]);if(QL)for(var o of QL(n))zQ.call(n,o)&&KL(t,o,n[o]);return t};const NQ=(t,n)=>{const o=W.useContext(Nn),u=SS(SS({},o),t);return W.createElement("svg",SS({width:"1.5em",height:"1.5em",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",color:"currentColor",ref:n},u),W.createElement("path",{d:"M4.0001 3H20.0002C20.5525 3 21.0002 3.44764 21.0002 3.99987L21.0004 5.58569C21.0005 5.85097 20.8951 6.10538 20.7075 6.29295L14.293 12.7071C14.1055 12.8946 14.0001 13.149 14.0001 13.4142L14.0001 19.7192C14.0001 20.3698 13.3887 20.8472 12.7576 20.6894L10.7576 20.1894C10.3124 20.0781 10.0001 19.6781 10.0001 19.2192L10.0001 13.4142C10.0001 13.149 9.89474 12.8946 9.7072 12.7071L3.29299 6.29289C3.10545 6.10536 3.0001 5.851 3.0001 5.58579V4C3.0001 3.44772 3.44781 3 4.0001 3Z",fill:"currentColor",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}))},FQ=W.forwardRef(NQ);var BQ=FQ;/**
 * @remix-run/router v1.15.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wi(){return Wi=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(t[u]=o[u])}return t},Wi.apply(this,arguments)}var to;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(to||(to={}));const JL="popstate";function jQ(t){t===void 0&&(t={});function n(u,d){let{pathname:g,search:x,hash:T}=u.location;return G_("",{pathname:g,search:x,hash:T},d.state&&d.state.usr||null,d.state&&d.state.key||"default")}function o(u,d){return typeof d=="string"?d:hd(d)}return UQ(n,o,null,t)}function fn(t,n){if(t===!1||t===null||typeof t>"u")throw new Error(n)}function ud(t,n){if(!t){typeof console<"u"&&console.warn(n);try{throw new Error(n)}catch{}}}function $Q(){return Math.random().toString(36).substr(2,8)}function e4(t,n){return{usr:t.state,key:t.key,idx:n}}function G_(t,n,o,u){return o===void 0&&(o=null),Wi({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof n=="string"?Nc(n):n,{state:o,key:n&&n.key||u||$Q()})}function hd(t){let{pathname:n="/",search:o="",hash:u=""}=t;return o&&o!=="?"&&(n+=o.charAt(0)==="?"?o:"?"+o),u&&u!=="#"&&(n+=u.charAt(0)==="#"?u:"#"+u),n}function Nc(t){let n={};if(t){let o=t.indexOf("#");o>=0&&(n.hash=t.substr(o),t=t.substr(0,o));let u=t.indexOf("?");u>=0&&(n.search=t.substr(u),t=t.substr(0,u)),t&&(n.pathname=t)}return n}function UQ(t,n,o,u){u===void 0&&(u={});let{window:d=document.defaultView,v5Compat:g=!1}=u,x=d.history,T=to.Pop,s=null,I=O();I==null&&(I=0,x.replaceState(Wi({},x.state,{idx:I}),""));function O(){return(x.state||{idx:null}).idx}function D(){T=to.Pop;let te=O(),H=te==null?null:te-I;I=te,s&&s({action:T,location:X.location,delta:H})}function N(te,H){T=to.Push;let U=G_(X.location,te,H);o&&o(U,te),I=O()+1;let q=e4(U,I),J=X.createHref(U);try{x.pushState(q,"",J)}catch(pe){if(pe instanceof DOMException&&pe.name==="DataCloneError")throw pe;d.location.assign(J)}g&&s&&s({action:T,location:X.location,delta:1})}function j(te,H){T=to.Replace;let U=G_(X.location,te,H);o&&o(U,te),I=O();let q=e4(U,I),J=X.createHref(U);x.replaceState(q,"",J),g&&s&&s({action:T,location:X.location,delta:0})}function G(te){let H=d.location.origin!=="null"?d.location.origin:d.location.href,U=typeof te=="string"?te:hd(te);return fn(H,"No window.location.(origin|href) available to create URL for href: "+U),new URL(U,H)}let X={get action(){return T},get location(){return t(d,x)},listen(te){if(s)throw new Error("A history only accepts one active listener");return d.addEventListener(JL,D),s=te,()=>{d.removeEventListener(JL,D),s=null}},createHref(te){return n(d,te)},createURL:G,encodeLocation(te){let H=G(te);return{pathname:H.pathname,search:H.search,hash:H.hash}},push:N,replace:j,go(te){return x.go(te)}};return X}var Gi;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Gi||(Gi={}));const VQ=new Set(["lazy","caseSensitive","path","id","index","children"]);function GQ(t){return t.index===!0}function fC(t,n,o,u){return o===void 0&&(o=[]),u===void 0&&(u={}),t.map((d,g)=>{let x=[...o,g],T=typeof d.id=="string"?d.id:x.join("-");if(fn(d.index!==!0||!d.children,"Cannot specify children on an index route"),fn(!u[T],'Found a route id collision on id "'+T+`".  Route id's must be globally unique within Data Router usages`),GQ(d)){let s=Wi({},d,n(d),{id:T});return u[T]=s,s}else{let s=Wi({},d,n(d),{id:T,children:void 0});return u[T]=s,d.children&&(s.children=fC(d.children,n,x,u)),s}})}function Wf(t,n,o){o===void 0&&(o="/");let u=typeof n=="string"?Nc(n):n,d=Oc(u.pathname||"/",o);if(d==null)return null;let g=eB(t);WQ(g);let x=null;for(let T=0;x==null&&T<g.length;++T)x=tK(g[T],nK(d));return x}function qQ(t,n){let{route:o,pathname:u,params:d}=t;return{id:o.id,pathname:u,params:d,data:n[o.id],handle:o.handle}}function eB(t,n,o,u){n===void 0&&(n=[]),o===void 0&&(o=[]),u===void 0&&(u="");let d=(g,x,T)=>{let s={relativePath:T===void 0?g.path||"":T,caseSensitive:g.caseSensitive===!0,childrenIndex:x,route:g};s.relativePath.startsWith("/")&&(fn(s.relativePath.startsWith(u),'Absolute route path "'+s.relativePath+'" nested under path '+('"'+u+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),s.relativePath=s.relativePath.slice(u.length));let I=wc([u,s.relativePath]),O=o.concat(s);g.children&&g.children.length>0&&(fn(g.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+I+'".')),eB(g.children,n,O,I)),!(g.path==null&&!g.index)&&n.push({path:I,score:JQ(I,g.index),routesMeta:O})};return t.forEach((g,x)=>{var T;if(g.path===""||!((T=g.path)!=null&&T.includes("?")))d(g,x);else for(let s of tB(g.path))d(g,x,s)}),n}function tB(t){let n=t.split("/");if(n.length===0)return[];let[o,...u]=n,d=o.endsWith("?"),g=o.replace(/\?$/,"");if(u.length===0)return d?[g,""]:[g];let x=tB(u.join("/")),T=[];return T.push(...x.map(s=>s===""?g:[g,s].join("/"))),d&&T.push(...x),T.map(s=>t.startsWith("/")&&s===""?"/":s)}function WQ(t){t.sort((n,o)=>n.score!==o.score?o.score-n.score:eK(n.routesMeta.map(u=>u.childrenIndex),o.routesMeta.map(u=>u.childrenIndex)))}const HQ=/^:[\w-]+$/,ZQ=3,XQ=2,YQ=1,QQ=10,KQ=-2,t4=t=>t==="*";function JQ(t,n){let o=t.split("/"),u=o.length;return o.some(t4)&&(u+=KQ),n&&(u+=XQ),o.filter(d=>!t4(d)).reduce((d,g)=>d+(HQ.test(g)?ZQ:g===""?YQ:QQ),u)}function eK(t,n){return t.length===n.length&&t.slice(0,-1).every((u,d)=>u===n[d])?t[t.length-1]-n[n.length-1]:0}function tK(t,n){let{routesMeta:o}=t,u={},d="/",g=[];for(let x=0;x<o.length;++x){let T=o[x],s=x===o.length-1,I=d==="/"?n:n.slice(d.length)||"/",O=pC({path:T.relativePath,caseSensitive:T.caseSensitive,end:s},I);if(!O)return null;Object.assign(u,O.params);let D=T.route;g.push({params:u,pathname:wc([d,O.pathname]),pathnameBase:aK(wc([d,O.pathnameBase])),route:D}),O.pathnameBase!=="/"&&(d=wc([d,O.pathnameBase]))}return g}function pC(t,n){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[o,u]=rK(t.path,t.caseSensitive,t.end),d=n.match(o);if(!d)return null;let g=d[0],x=g.replace(/(.)\/+$/,"$1"),T=d.slice(1);return{params:u.reduce((I,O,D)=>{let{paramName:N,isOptional:j}=O;if(N==="*"){let X=T[D]||"";x=g.slice(0,g.length-X.length).replace(/(.)\/+$/,"$1")}const G=T[D];return j&&!G?I[N]=void 0:I[N]=iK(G||"",N),I},{}),pathname:g,pathnameBase:x,pattern:t}}function rK(t,n,o){n===void 0&&(n=!1),o===void 0&&(o=!0),ud(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let u=[],d="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(x,T,s)=>(u.push({paramName:T,isOptional:s!=null}),s?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(u.push({paramName:"*"}),d+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?d+="\\/*$":t!==""&&t!=="/"&&(d+="(?:(?=\\/|$))"),[new RegExp(d,n?void 0:"i"),u]}function nK(t){try{return decodeURI(t)}catch(n){return ud(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+n+").")),t}}function iK(t,n){try{return decodeURIComponent(t)}catch(o){return ud(!1,'The value for the URL param "'+n+'" will not be decoded because'+(' the string "'+t+'" is a malformed URL segment. This is probably')+(" due to a bad percent encoding ("+o+").")),t}}function Oc(t,n){if(n==="/")return t;if(!t.toLowerCase().startsWith(n.toLowerCase()))return null;let o=n.endsWith("/")?n.length-1:n.length,u=t.charAt(o);return u&&u!=="/"?null:t.slice(o)||"/"}function oK(t,n){n===void 0&&(n="/");let{pathname:o,search:u="",hash:d=""}=typeof t=="string"?Nc(t):t;return{pathname:o?o.startsWith("/")?o:sK(o,n):n,search:lK(u),hash:cK(d)}}function sK(t,n){let o=n.replace(/\/+$/,"").split("/");return t.split("/").forEach(d=>{d===".."?o.length>1&&o.pop():d!=="."&&o.push(d)}),o.length>1?o.join("/"):"/"}function TS(t,n,o,u){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+n+"` field ["+JSON.stringify(u)+"].  Please separate it out to the ")+("`to."+o+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function rB(t){return t.filter((n,o)=>o===0||n.route.path&&n.route.path.length>0)}function mI(t,n){let o=rB(t);return n?o.map((u,d)=>d===t.length-1?u.pathname:u.pathnameBase):o.map(u=>u.pathnameBase)}function gI(t,n,o,u){u===void 0&&(u=!1);let d;typeof t=="string"?d=Nc(t):(d=Wi({},t),fn(!d.pathname||!d.pathname.includes("?"),TS("?","pathname","search",d)),fn(!d.pathname||!d.pathname.includes("#"),TS("#","pathname","hash",d)),fn(!d.search||!d.search.includes("#"),TS("#","search","hash",d)));let g=t===""||d.pathname==="",x=g?"/":d.pathname,T;if(x==null)T=o;else{let D=n.length-1;if(!u&&x.startsWith("..")){let N=x.split("/");for(;N[0]==="..";)N.shift(),D-=1;d.pathname=N.join("/")}T=D>=0?n[D]:"/"}let s=oK(d,T),I=x&&x!=="/"&&x.endsWith("/"),O=(g||x===".")&&o.endsWith("/");return!s.pathname.endsWith("/")&&(I||O)&&(s.pathname+="/"),s}const wc=t=>t.join("/").replace(/\/\/+/g,"/"),aK=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),lK=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,cK=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;class _I{constructor(n,o,u,d){d===void 0&&(d=!1),this.status=n,this.statusText=o||"",this.internal=d,u instanceof Error?(this.data=u.toString(),this.error=u):this.data=u}}function nB(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const iB=["post","put","patch","delete"],uK=new Set(iB),hK=["get",...iB],dK=new Set(hK),fK=new Set([301,302,303,307,308]),pK=new Set([307,308]),CS={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},mK={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},pg={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},oB=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,gK=t=>({hasErrorBoundary:!!t.hasErrorBoundary}),sB="remix-router-transitions";function _K(t){const n=t.window?t.window:typeof window<"u"?window:void 0,o=typeof n<"u"&&typeof n.document<"u"&&typeof n.document.createElement<"u",u=!o;fn(t.routes.length>0,"You must provide a non-empty routes array to createRouter");let d;if(t.mapRouteProperties)d=t.mapRouteProperties;else if(t.detectErrorBoundary){let qe=t.detectErrorBoundary;d=we=>({hasErrorBoundary:qe(we)})}else d=gK;let g={},x=fC(t.routes,d,void 0,g),T,s=t.basename||"/",I=Wi({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1},t.future),O=null,D=new Set,N=null,j=null,G=null,X=t.hydrationData!=null,te=Wf(x,t.history.location,s),H=null;if(te==null){let qe=Ea(404,{pathname:t.history.location.pathname}),{matches:we,route:ke}=c4(x);te=we,H={[ke.id]:qe}}let U,q=te.some(qe=>qe.route.lazy),J=te.some(qe=>qe.route.loader);if(q)U=!1;else if(!J)U=!0;else if(I.v7_partialHydration){let qe=t.hydrationData?t.hydrationData.loaderData:null,we=t.hydrationData?t.hydrationData.errors:null;U=te.every(ke=>ke.route.loader&&ke.route.loader.hydrate!==!0&&(qe&&qe[ke.route.id]!==void 0||we&&we[ke.route.id]!==void 0))}else U=t.hydrationData!=null;let pe,ue={historyAction:t.history.action,location:t.history.location,matches:te,initialized:U,navigation:CS,restoreScrollPosition:t.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:t.hydrationData&&t.hydrationData.loaderData||{},actionData:t.hydrationData&&t.hydrationData.actionData||null,errors:t.hydrationData&&t.hydrationData.errors||H,fetchers:new Map,blockers:new Map},Me=to.Pop,Se=!1,ge,se=!1,Ie=new Map,We=null,ze=!1,De=!1,nt=[],It=[],Ot=new Map,bt=0,rt=-1,Gt=new Map,Vt=new Set,Jt=new Map,wr=new Map,or=new Set,et=new Map,At=new Map,Qt=!1;function gr(){if(O=t.history.listen(qe=>{let{action:we,location:ke,delta:Ue}=qe;if(Qt){Qt=!1;return}ud(At.size===0||Ue!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Ze=Fn({currentLocation:ue.location,nextLocation:ke,historyAction:we});if(Ze&&Ue!=null){Qt=!0,t.history.go(Ue*-1),jn(Ze,{state:"blocked",location:ke,proceed(){jn(Ze,{state:"proceeding",proceed:void 0,reset:void 0,location:ke}),t.history.go(Ue)},reset(){let tt=new Map(ue.blockers);tt.set(Ze,pg),Tr({blockers:tt})}});return}return Mn(we,ke)}),o){IK(n,Ie);let qe=()=>AK(n,Ie);n.addEventListener("pagehide",qe),We=()=>n.removeEventListener("pagehide",qe)}return ue.initialized||Mn(to.Pop,ue.location,{initialHydration:!0}),pe}function Nt(){O&&O(),We&&We(),D.clear(),ge&&ge.abort(),ue.fetchers.forEach((qe,we)=>lr(we)),ue.blockers.forEach((qe,we)=>Rr(we))}function Er(qe){return D.add(qe),()=>D.delete(qe)}function Tr(qe,we){we===void 0&&(we={}),ue=Wi({},ue,qe);let ke=[],Ue=[];I.v7_fetcherPersist&&ue.fetchers.forEach((Ze,tt)=>{Ze.state==="idle"&&(or.has(tt)?Ue.push(tt):ke.push(tt))}),[...D].forEach(Ze=>Ze(ue,{deletedFetchers:Ue,unstable_viewTransitionOpts:we.viewTransitionOpts,unstable_flushSync:we.flushSync===!0})),I.v7_fetcherPersist&&(ke.forEach(Ze=>ue.fetchers.delete(Ze)),Ue.forEach(Ze=>lr(Ze)))}function $r(qe,we,ke){var Ue,Ze;let{flushSync:tt}=ke===void 0?{}:ke,it=ue.actionData!=null&&ue.navigation.formMethod!=null&&el(ue.navigation.formMethod)&&ue.navigation.state==="loading"&&((Ue=qe.state)==null?void 0:Ue._isRedirect)!==!0,at;we.actionData?Object.keys(we.actionData).length>0?at=we.actionData:at=null:it?at=ue.actionData:at=null;let Ke=we.loaderData?l4(ue.loaderData,we.loaderData,we.matches||[],we.errors):ue.loaderData,xt=ue.blockers;xt.size>0&&(xt=new Map(xt),xt.forEach((pr,Ut)=>xt.set(Ut,pg)));let _t=Se===!0||ue.navigation.formMethod!=null&&el(ue.navigation.formMethod)&&((Ze=qe.state)==null?void 0:Ze._isRedirect)!==!0;T&&(x=T,T=void 0),ze||Me===to.Pop||(Me===to.Push?t.history.push(qe,qe.state):Me===to.Replace&&t.history.replace(qe,qe.state));let Ft;if(Me===to.Pop){let pr=Ie.get(ue.location.pathname);pr&&pr.has(qe.pathname)?Ft={currentLocation:ue.location,nextLocation:qe}:Ie.has(qe.pathname)&&(Ft={currentLocation:qe,nextLocation:ue.location})}else if(se){let pr=Ie.get(ue.location.pathname);pr?pr.add(qe.pathname):(pr=new Set([qe.pathname]),Ie.set(ue.location.pathname,pr)),Ft={currentLocation:ue.location,nextLocation:qe}}Tr(Wi({},we,{actionData:at,loaderData:Ke,historyAction:Me,location:qe,initialized:!0,navigation:CS,revalidation:"idle",restoreScrollPosition:no(qe,we.matches||ue.matches),preventScrollReset:_t,blockers:xt}),{viewTransitionOpts:Ft,flushSync:tt===!0}),Me=to.Pop,Se=!1,se=!1,ze=!1,De=!1,nt=[],It=[]}async function Xr(qe,we){if(typeof qe=="number"){t.history.go(qe);return}let ke=mC(ue.location,ue.matches,s,I.v7_prependBasename,qe,I.v7_relativeSplatPath,we==null?void 0:we.fromRouteId,we==null?void 0:we.relative),{path:Ue,submission:Ze,error:tt}=r4(I.v7_normalizeFormMethod,!1,ke,we),it=ue.location,at=G_(ue.location,Ue,we&&we.state);at=Wi({},at,t.history.encodeLocation(at));let Ke=we&&we.replace!=null?we.replace:void 0,xt=to.Push;Ke===!0?xt=to.Replace:Ke===!1||Ze!=null&&el(Ze.formMethod)&&Ze.formAction===ue.location.pathname+ue.location.search&&(xt=to.Replace);let _t=we&&"preventScrollReset"in we?we.preventScrollReset===!0:void 0,Ft=(we&&we.unstable_flushSync)===!0,pr=Fn({currentLocation:it,nextLocation:at,historyAction:xt});if(pr){jn(pr,{state:"blocked",location:at,proceed(){jn(pr,{state:"proceeding",proceed:void 0,reset:void 0,location:at}),Xr(qe,we)},reset(){let Ut=new Map(ue.blockers);Ut.set(pr,pg),Tr({blockers:Ut})}});return}return await Mn(xt,at,{submission:Ze,pendingError:tt,preventScrollReset:_t,replace:we&&we.replace,enableViewTransition:we&&we.unstable_viewTransition,flushSync:Ft})}function cn(){if(jt(),Tr({revalidation:"loading"}),ue.navigation.state!=="submitting"){if(ue.navigation.state==="idle"){Mn(ue.historyAction,ue.location,{startUninterruptedRevalidation:!0});return}Mn(Me||ue.historyAction,ue.navigation.location,{overrideNavigation:ue.navigation})}}async function Mn(qe,we,ke){ge&&ge.abort(),ge=null,Me=qe,ze=(ke&&ke.startUninterruptedRevalidation)===!0,ii(ue.location,ue.matches),Se=(ke&&ke.preventScrollReset)===!0,se=(ke&&ke.enableViewTransition)===!0;let Ue=T||x,Ze=ke&&ke.overrideNavigation,tt=Wf(Ue,we,s),it=(ke&&ke.flushSync)===!0;if(!tt){let Ut=Ea(404,{pathname:we.pathname}),{matches:Or,route:Lr}=c4(Ue);Ii(),$r(we,{matches:Or,loaderData:{},errors:{[Lr.id]:Ut}},{flushSync:it});return}if(ue.initialized&&!De&&wK(ue.location,we)&&!(ke&&ke.submission&&el(ke.submission.formMethod))){$r(we,{matches:tt},{flushSync:it});return}ge=new AbortController;let at=gg(t.history,we,ge.signal,ke&&ke.submission),Ke,xt;if(ke&&ke.pendingError)xt={[g_(tt).route.id]:ke.pendingError};else if(ke&&ke.submission&&el(ke.submission.formMethod)){let Ut=await mr(at,we,ke.submission,tt,{replace:ke.replace,flushSync:it});if(Ut.shortCircuited)return;Ke=Ut.pendingActionData,xt=Ut.pendingActionError,Ze=MS(we,ke.submission),it=!1,at=new Request(at.url,{signal:at.signal})}let{shortCircuited:_t,loaderData:Ft,errors:pr}=await vt(at,we,tt,Ze,ke&&ke.submission,ke&&ke.fetcherSubmission,ke&&ke.replace,ke&&ke.initialHydration===!0,it,Ke,xt);_t||(ge=null,$r(we,Wi({matches:tt},Ke?{actionData:Ke}:{},{loaderData:Ft,errors:pr})))}async function mr(qe,we,ke,Ue,Ze){Ze===void 0&&(Ze={}),jt();let tt=CK(we,ke);Tr({navigation:tt},{flushSync:Ze.flushSync===!0});let it,at=_C(Ue,we);if(!at.route.action&&!at.route.lazy)it={type:Gi.error,error:Ea(405,{method:qe.method,pathname:we.pathname,routeId:at.route.id})};else if(it=await mg("action",qe,at,Ue,g,d,s,I.v7_relativeSplatPath),qe.signal.aborted)return{shortCircuited:!0};if(Kh(it)){let Ke;return Ze&&Ze.replace!=null?Ke=Ze.replace:Ke=it.location===ue.location.pathname+ue.location.search,await ft(ue,it,{submission:ke,replace:Ke}),{shortCircuited:!0}}if(Hf(it)){let Ke=g_(Ue,at.route.id);return(Ze&&Ze.replace)!==!0&&(Me=to.Push),{pendingActionData:{},pendingActionError:{[Ke.route.id]:it.error}}}if(Qh(it))throw Ea(400,{type:"defer-action"});return{pendingActionData:{[at.route.id]:it.data}}}async function vt(qe,we,ke,Ue,Ze,tt,it,at,Ke,xt,_t){let Ft=Ue||MS(we,Ze),pr=Ze||tt||d4(Ft),Ut=T||x,[Or,Lr]=n4(t.history,ue,ke,pr,we,I.v7_partialHydration&&at===!0,De,nt,It,or,Jt,Vt,Ut,s,xt,_t);if(Ii(yn=>!(ke&&ke.some(wn=>wn.route.id===yn))||Or&&Or.some(wn=>wn.route.id===yn)),rt=++bt,Or.length===0&&Lr.length===0){let yn=In();return $r(we,Wi({matches:ke,loaderData:{},errors:_t||null},xt?{actionData:xt}:{},yn?{fetchers:new Map(ue.fetchers)}:{}),{flushSync:Ke}),{shortCircuited:!0}}if(!ze&&(!I.v7_partialHydration||!at)){Lr.forEach(wn=>{let Xi=ue.fetchers.get(wn.key),io=_g(void 0,Xi?Xi.data:void 0);ue.fetchers.set(wn.key,io)});let yn=xt||ue.actionData;Tr(Wi({navigation:Ft},yn?Object.keys(yn).length===0?{actionData:null}:{actionData:yn}:{},Lr.length>0?{fetchers:new Map(ue.fetchers)}:{}),{flushSync:Ke})}Lr.forEach(yn=>{Ot.has(yn.key)&&Gr(yn.key),yn.controller&&Ot.set(yn.key,yn.controller)});let Kr=()=>Lr.forEach(yn=>Gr(yn.key));ge&&ge.signal.addEventListener("abort",Kr);let{results:an,loaderResults:Zn,fetcherResults:oi}=await gt(ue.matches,ke,Or,Lr,qe);if(qe.signal.aborted)return{shortCircuited:!0};ge&&ge.signal.removeEventListener("abort",Kr),Lr.forEach(yn=>Ot.delete(yn.key));let fi=u4(an);if(fi){if(fi.idx>=Or.length){let yn=Lr[fi.idx-Or.length].key;Vt.add(yn)}return await ft(ue,fi.result,{replace:it}),{shortCircuited:!0}}let{loaderData:Oi,errors:si}=a4(ue,ke,Or,Zn,_t,Lr,oi,et);et.forEach((yn,wn)=>{yn.subscribe(Xi=>{(Xi||yn.done)&&et.delete(wn)})});let Bn=In(),Di=sn(rt),ko=Bn||Di||Lr.length>0;return Wi({loaderData:Oi,errors:si},ko?{fetchers:new Map(ue.fetchers)}:{})}function _e(qe,we,ke,Ue){if(u)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");Ot.has(qe)&&Gr(qe);let Ze=(Ue&&Ue.unstable_flushSync)===!0,tt=T||x,it=mC(ue.location,ue.matches,s,I.v7_prependBasename,ke,I.v7_relativeSplatPath,we,Ue==null?void 0:Ue.relative),at=Wf(tt,it,s);if(!at){yt(qe,we,Ea(404,{pathname:it}),{flushSync:Ze});return}let{path:Ke,submission:xt,error:_t}=r4(I.v7_normalizeFormMethod,!0,it,Ue);if(_t){yt(qe,we,_t,{flushSync:Ze});return}let Ft=_C(at,Ke);if(Se=(Ue&&Ue.preventScrollReset)===!0,xt&&el(xt.formMethod)){xe(qe,we,Ke,Ft,at,Ze,xt);return}Jt.set(qe,{routeId:we,path:Ke}),Re(qe,we,Ke,Ft,at,Ze,xt)}async function xe(qe,we,ke,Ue,Ze,tt,it){if(jt(),Jt.delete(qe),!Ue.route.action&&!Ue.route.lazy){let wn=Ea(405,{method:it.formMethod,pathname:ke,routeId:we});yt(qe,we,wn,{flushSync:tt});return}let at=ue.fetchers.get(qe);$t(qe,MK(it,at),{flushSync:tt});let Ke=new AbortController,xt=gg(t.history,ke,Ke.signal,it);Ot.set(qe,Ke);let _t=bt,Ft=await mg("action",xt,Ue,Ze,g,d,s,I.v7_relativeSplatPath);if(xt.signal.aborted){Ot.get(qe)===Ke&&Ot.delete(qe);return}if(I.v7_fetcherPersist&&or.has(qe)){if(Kh(Ft)||Hf(Ft)){$t(qe,gu(void 0));return}}else{if(Kh(Ft))if(Ot.delete(qe),rt>_t){$t(qe,gu(void 0));return}else return Vt.add(qe),$t(qe,_g(it)),ft(ue,Ft,{fetcherSubmission:it});if(Hf(Ft)){yt(qe,we,Ft.error);return}}if(Qh(Ft))throw Ea(400,{type:"defer-action"});let pr=ue.navigation.location||ue.location,Ut=gg(t.history,pr,Ke.signal),Or=T||x,Lr=ue.navigation.state!=="idle"?Wf(Or,ue.navigation.location,s):ue.matches;fn(Lr,"Didn't find any matches after fetcher action");let Kr=++bt;Gt.set(qe,Kr);let an=_g(it,Ft.data);ue.fetchers.set(qe,an);let[Zn,oi]=n4(t.history,ue,Lr,it,pr,!1,De,nt,It,or,Jt,Vt,Or,s,{[Ue.route.id]:Ft.data},void 0);oi.filter(wn=>wn.key!==qe).forEach(wn=>{let Xi=wn.key,io=ue.fetchers.get(Xi),bs=_g(void 0,io?io.data:void 0);ue.fetchers.set(Xi,bs),Ot.has(Xi)&&Gr(Xi),wn.controller&&Ot.set(Xi,wn.controller)}),Tr({fetchers:new Map(ue.fetchers)});let fi=()=>oi.forEach(wn=>Gr(wn.key));Ke.signal.addEventListener("abort",fi);let{results:Oi,loaderResults:si,fetcherResults:Bn}=await gt(ue.matches,Lr,Zn,oi,Ut);if(Ke.signal.aborted)return;Ke.signal.removeEventListener("abort",fi),Gt.delete(qe),Ot.delete(qe),oi.forEach(wn=>Ot.delete(wn.key));let Di=u4(Oi);if(Di){if(Di.idx>=Zn.length){let wn=oi[Di.idx-Zn.length].key;Vt.add(wn)}return ft(ue,Di.result)}let{loaderData:ko,errors:yn}=a4(ue,ue.matches,Zn,si,void 0,oi,Bn,et);if(ue.fetchers.has(qe)){let wn=gu(Ft.data);ue.fetchers.set(qe,wn)}sn(Kr),ue.navigation.state==="loading"&&Kr>rt?(fn(Me,"Expected pending action"),ge&&ge.abort(),$r(ue.navigation.location,{matches:Lr,loaderData:ko,errors:yn,fetchers:new Map(ue.fetchers)})):(Tr({errors:yn,loaderData:l4(ue.loaderData,ko,Lr,yn),fetchers:new Map(ue.fetchers)}),De=!1)}async function Re(qe,we,ke,Ue,Ze,tt,it){let at=ue.fetchers.get(qe);$t(qe,_g(it,at?at.data:void 0),{flushSync:tt});let Ke=new AbortController,xt=gg(t.history,ke,Ke.signal);Ot.set(qe,Ke);let _t=bt,Ft=await mg("loader",xt,Ue,Ze,g,d,s,I.v7_relativeSplatPath);if(Qh(Ft)&&(Ft=await cB(Ft,xt.signal,!0)||Ft),Ot.get(qe)===Ke&&Ot.delete(qe),!xt.signal.aborted){if(or.has(qe)){$t(qe,gu(void 0));return}if(Kh(Ft))if(rt>_t){$t(qe,gu(void 0));return}else{Vt.add(qe),await ft(ue,Ft);return}if(Hf(Ft)){yt(qe,we,Ft.error);return}fn(!Qh(Ft),"Unhandled fetcher deferred data"),$t(qe,gu(Ft.data))}}async function ft(qe,we,ke){let{submission:Ue,fetcherSubmission:Ze,replace:tt}=ke===void 0?{}:ke;we.revalidate&&(De=!0);let it=G_(qe.location,we.location,{_isRedirect:!0});if(fn(it,"Expected a location on the redirect navigation"),o){let pr=!1;if(we.reloadDocument)pr=!0;else if(oB.test(we.location)){const Ut=t.history.createURL(we.location);pr=Ut.origin!==n.location.origin||Oc(Ut.pathname,s)==null}if(pr){tt?n.location.replace(we.location):n.location.assign(we.location);return}}ge=null;let at=tt===!0?to.Replace:to.Push,{formMethod:Ke,formAction:xt,formEncType:_t}=qe.navigation;!Ue&&!Ze&&Ke&&xt&&_t&&(Ue=d4(qe.navigation));let Ft=Ue||Ze;if(pK.has(we.status)&&Ft&&el(Ft.formMethod))await Mn(at,it,{submission:Wi({},Ft,{formAction:we.location}),preventScrollReset:Se});else{let pr=MS(it,Ue);await Mn(at,it,{overrideNavigation:pr,fetcherSubmission:Ze,preventScrollReset:Se})}}async function gt(qe,we,ke,Ue,Ze){let tt=await Promise.all([...ke.map(Ke=>mg("loader",Ze,Ke,we,g,d,s,I.v7_relativeSplatPath)),...Ue.map(Ke=>Ke.matches&&Ke.match&&Ke.controller?mg("loader",gg(t.history,Ke.path,Ke.controller.signal),Ke.match,Ke.matches,g,d,s,I.v7_relativeSplatPath):{type:Gi.error,error:Ea(404,{pathname:Ke.path})})]),it=tt.slice(0,ke.length),at=tt.slice(ke.length);return await Promise.all([h4(qe,ke,it,it.map(()=>Ze.signal),!1,ue.loaderData),h4(qe,Ue.map(Ke=>Ke.match),at,Ue.map(Ke=>Ke.controller?Ke.controller.signal:null),!0)]),{results:tt,loaderResults:it,fetcherResults:at}}function jt(){De=!0,nt.push(...Ii()),Jt.forEach((qe,we)=>{Ot.has(we)&&(It.push(we),Gr(we))})}function $t(qe,we,ke){ke===void 0&&(ke={}),ue.fetchers.set(qe,we),Tr({fetchers:new Map(ue.fetchers)},{flushSync:(ke&&ke.flushSync)===!0})}function yt(qe,we,ke,Ue){Ue===void 0&&(Ue={});let Ze=g_(ue.matches,we);lr(qe),Tr({errors:{[Ze.route.id]:ke},fetchers:new Map(ue.fetchers)},{flushSync:(Ue&&Ue.flushSync)===!0})}function ir(qe){return I.v7_fetcherPersist&&(wr.set(qe,(wr.get(qe)||0)+1),or.has(qe)&&or.delete(qe)),ue.fetchers.get(qe)||mK}function lr(qe){let we=ue.fetchers.get(qe);Ot.has(qe)&&!(we&&we.state==="loading"&&Gt.has(qe))&&Gr(qe),Jt.delete(qe),Gt.delete(qe),Vt.delete(qe),or.delete(qe),ue.fetchers.delete(qe)}function fr(qe){if(I.v7_fetcherPersist){let we=(wr.get(qe)||0)-1;we<=0?(wr.delete(qe),or.add(qe)):wr.set(qe,we)}else lr(qe);Tr({fetchers:new Map(ue.fetchers)})}function Gr(qe){let we=Ot.get(qe);fn(we,"Expected fetch controller: "+qe),we.abort(),Ot.delete(qe)}function pn(qe){for(let we of qe){let ke=ir(we),Ue=gu(ke.data);ue.fetchers.set(we,Ue)}}function In(){let qe=[],we=!1;for(let ke of Vt){let Ue=ue.fetchers.get(ke);fn(Ue,"Expected fetcher: "+ke),Ue.state==="loading"&&(Vt.delete(ke),qe.push(ke),we=!0)}return pn(qe),we}function sn(qe){let we=[];for(let[ke,Ue]of Gt)if(Ue<qe){let Ze=ue.fetchers.get(ke);fn(Ze,"Expected fetcher: "+ke),Ze.state==="loading"&&(Gr(ke),Gt.delete(ke),we.push(ke))}return pn(we),we.length>0}function mn(qe,we){let ke=ue.blockers.get(qe)||pg;return At.get(qe)!==we&&At.set(qe,we),ke}function Rr(qe){ue.blockers.delete(qe),At.delete(qe)}function jn(qe,we){let ke=ue.blockers.get(qe)||pg;fn(ke.state==="unblocked"&&we.state==="blocked"||ke.state==="blocked"&&we.state==="blocked"||ke.state==="blocked"&&we.state==="proceeding"||ke.state==="blocked"&&we.state==="unblocked"||ke.state==="proceeding"&&we.state==="unblocked","Invalid blocker state transition: "+ke.state+" -> "+we.state);let Ue=new Map(ue.blockers);Ue.set(qe,we),Tr({blockers:Ue})}function Fn(qe){let{currentLocation:we,nextLocation:ke,historyAction:Ue}=qe;if(At.size===0)return;At.size>1&&ud(!1,"A router only supports one blocker at a time");let Ze=Array.from(At.entries()),[tt,it]=Ze[Ze.length-1],at=ue.blockers.get(tt);if(!(at&&at.state==="proceeding")&&it({currentLocation:we,nextLocation:ke,historyAction:Ue}))return tt}function Ii(qe){let we=[];return et.forEach((ke,Ue)=>{(!qe||qe(Ue))&&(ke.cancel(),we.push(Ue),et.delete(Ue))}),we}function ci(qe,we,ke){if(N=qe,G=we,j=ke||null,!X&&ue.navigation===CS){X=!0;let Ue=no(ue.location,ue.matches);Ue!=null&&Tr({restoreScrollPosition:Ue})}return()=>{N=null,G=null,j=null}}function $n(qe,we){return j&&j(qe,we.map(Ue=>qQ(Ue,ue.loaderData)))||qe.key}function ii(qe,we){if(N&&G){let ke=$n(qe,we);N[ke]=G()}}function no(qe,we){if(N){let ke=$n(qe,we),Ue=N[ke];if(typeof Ue=="number")return Ue}return null}function Go(qe){g={},T=fC(qe,d,void 0,g)}return pe={get basename(){return s},get future(){return I},get state(){return ue},get routes(){return x},get window(){return n},initialize:gr,subscribe:Er,enableScrollRestoration:ci,navigate:Xr,fetch:_e,revalidate:cn,createHref:qe=>t.history.createHref(qe),encodeLocation:qe=>t.history.encodeLocation(qe),getFetcher:ir,deleteFetcher:fr,dispose:Nt,getBlocker:mn,deleteBlocker:Rr,_internalFetchControllers:Ot,_internalActiveDeferreds:et,_internalSetRoutes:Go},pe}function yK(t){return t!=null&&("formData"in t&&t.formData!=null||"body"in t&&t.body!==void 0)}function mC(t,n,o,u,d,g,x,T){let s,I;if(x){s=[];for(let D of n)if(s.push(D),D.route.id===x){I=D;break}}else s=n,I=n[n.length-1];let O=gI(d||".",mI(s,g),Oc(t.pathname,o)||t.pathname,T==="path");return d==null&&(O.search=t.search,O.hash=t.hash),(d==null||d===""||d===".")&&I&&I.route.index&&!yI(O.search)&&(O.search=O.search?O.search.replace(/^\?/,"?index&"):"?index"),u&&o!=="/"&&(O.pathname=O.pathname==="/"?o:wc([o,O.pathname])),hd(O)}function r4(t,n,o,u){if(!u||!yK(u))return{path:o};if(u.formMethod&&!TK(u.formMethod))return{path:o,error:Ea(405,{method:u.formMethod})};let d=()=>({path:o,error:Ea(400,{type:"invalid-body"})}),g=u.formMethod||"get",x=t?g.toUpperCase():g.toLowerCase(),T=lB(o);if(u.body!==void 0){if(u.formEncType==="text/plain"){if(!el(x))return d();let N=typeof u.body=="string"?u.body:u.body instanceof FormData||u.body instanceof URLSearchParams?Array.from(u.body.entries()).reduce((j,G)=>{let[X,te]=G;return""+j+X+"="+te+`
`},""):String(u.body);return{path:o,submission:{formMethod:x,formAction:T,formEncType:u.formEncType,formData:void 0,json:void 0,text:N}}}else if(u.formEncType==="application/json"){if(!el(x))return d();try{let N=typeof u.body=="string"?JSON.parse(u.body):u.body;return{path:o,submission:{formMethod:x,formAction:T,formEncType:u.formEncType,formData:void 0,json:N,text:void 0}}}catch{return d()}}}fn(typeof FormData=="function","FormData is not available in this environment");let s,I;if(u.formData)s=gC(u.formData),I=u.formData;else if(u.body instanceof FormData)s=gC(u.body),I=u.body;else if(u.body instanceof URLSearchParams)s=u.body,I=s4(s);else if(u.body==null)s=new URLSearchParams,I=new FormData;else try{s=new URLSearchParams(u.body),I=s4(s)}catch{return d()}let O={formMethod:x,formAction:T,formEncType:u&&u.formEncType||"application/x-www-form-urlencoded",formData:I,json:void 0,text:void 0};if(el(O.formMethod))return{path:o,submission:O};let D=Nc(o);return n&&D.search&&yI(D.search)&&s.append("index",""),D.search="?"+s,{path:hd(D),submission:O}}function vK(t,n){let o=t;if(n){let u=t.findIndex(d=>d.route.id===n);u>=0&&(o=t.slice(0,u))}return o}function n4(t,n,o,u,d,g,x,T,s,I,O,D,N,j,G,X){let te=X?Object.values(X)[0]:G?Object.values(G)[0]:void 0,H=t.createURL(n.location),U=t.createURL(d),q=X?Object.keys(X)[0]:void 0,pe=vK(o,q).filter((Me,Se)=>{let{route:ge}=Me;if(ge.lazy)return!0;if(ge.loader==null)return!1;if(g)return ge.loader.hydrate?!0:n.loaderData[ge.id]===void 0&&(!n.errors||n.errors[ge.id]===void 0);if(xK(n.loaderData,n.matches[Se],Me)||T.some(We=>We===Me.route.id))return!0;let se=n.matches[Se],Ie=Me;return i4(Me,Wi({currentUrl:H,currentParams:se.params,nextUrl:U,nextParams:Ie.params},u,{actionResult:te,defaultShouldRevalidate:x||H.pathname+H.search===U.pathname+U.search||H.search!==U.search||aB(se,Ie)}))}),ue=[];return O.forEach((Me,Se)=>{if(g||!o.some(ze=>ze.route.id===Me.routeId)||I.has(Se))return;let ge=Wf(N,Me.path,j);if(!ge){ue.push({key:Se,routeId:Me.routeId,path:Me.path,matches:null,match:null,controller:null});return}let se=n.fetchers.get(Se),Ie=_C(ge,Me.path),We=!1;D.has(Se)?We=!1:s.includes(Se)?We=!0:se&&se.state!=="idle"&&se.data===void 0?We=x:We=i4(Ie,Wi({currentUrl:H,currentParams:n.matches[n.matches.length-1].params,nextUrl:U,nextParams:o[o.length-1].params},u,{actionResult:te,defaultShouldRevalidate:x})),We&&ue.push({key:Se,routeId:Me.routeId,path:Me.path,matches:ge,match:Ie,controller:new AbortController})}),[pe,ue]}function xK(t,n,o){let u=!n||o.route.id!==n.route.id,d=t[o.route.id]===void 0;return u||d}function aB(t,n){let o=t.route.path;return t.pathname!==n.pathname||o!=null&&o.endsWith("*")&&t.params["*"]!==n.params["*"]}function i4(t,n){if(t.route.shouldRevalidate){let o=t.route.shouldRevalidate(n);if(typeof o=="boolean")return o}return n.defaultShouldRevalidate}async function o4(t,n,o){if(!t.lazy)return;let u=await t.lazy();if(!t.lazy)return;let d=o[t.id];fn(d,"No route found in manifest");let g={};for(let x in u){let s=d[x]!==void 0&&x!=="hasErrorBoundary";ud(!s,'Route "'+d.id+'" has a static property "'+x+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+x+'" will be ignored.')),!s&&!VQ.has(x)&&(g[x]=u[x])}Object.assign(d,g),Object.assign(d,Wi({},n(d),{lazy:void 0}))}async function mg(t,n,o,u,d,g,x,T,s){s===void 0&&(s={});let I,O,D,N=X=>{let te,H=new Promise((U,q)=>te=q);return D=()=>te(),n.signal.addEventListener("abort",D),Promise.race([X({request:n,params:o.params,context:s.requestContext}),H])};try{let X=o.route[t];if(o.route.lazy)if(X){let te,H=await Promise.all([N(X).catch(U=>{te=U}),o4(o.route,g,d)]);if(te)throw te;O=H[0]}else if(await o4(o.route,g,d),X=o.route[t],X)O=await N(X);else if(t==="action"){let te=new URL(n.url),H=te.pathname+te.search;throw Ea(405,{method:n.method,pathname:H,routeId:o.route.id})}else return{type:Gi.data,data:void 0};else if(X)O=await N(X);else{let te=new URL(n.url),H=te.pathname+te.search;throw Ea(404,{pathname:H})}fn(O!==void 0,"You defined "+(t==="action"?"an action":"a loader")+" for route "+('"'+o.route.id+"\" but didn't return anything from your `"+t+"` ")+"function. Please return a value or `null`.")}catch(X){I=Gi.error,O=X}finally{D&&n.signal.removeEventListener("abort",D)}if(SK(O)){let X=O.status;if(fK.has(X)){let H=O.headers.get("Location");if(fn(H,"Redirects returned/thrown from loaders/actions must have a Location header"),!oB.test(H))H=mC(new URL(n.url),u.slice(0,u.indexOf(o)+1),x,!0,H,T);else if(!s.isStaticRequest){let U=new URL(n.url),q=H.startsWith("//")?new URL(U.protocol+H):new URL(H),J=Oc(q.pathname,x)!=null;q.origin===U.origin&&J&&(H=q.pathname+q.search+q.hash)}if(s.isStaticRequest)throw O.headers.set("Location",H),O;return{type:Gi.redirect,status:X,location:H,revalidate:O.headers.get("X-Remix-Revalidate")!==null,reloadDocument:O.headers.get("X-Remix-Reload-Document")!==null}}if(s.isRouteRequest)throw{type:I===Gi.error?Gi.error:Gi.data,response:O};let te;try{let H=O.headers.get("Content-Type");H&&/\bapplication\/json\b/.test(H)?O.body==null?te=null:te=await O.json():te=await O.text()}catch(H){return{type:Gi.error,error:H}}return I===Gi.error?{type:I,error:new _I(X,O.statusText,te),headers:O.headers}:{type:Gi.data,data:te,statusCode:O.status,headers:O.headers}}if(I===Gi.error)return{type:I,error:O};if(EK(O)){var j,G;return{type:Gi.deferred,deferredData:O,statusCode:(j=O.init)==null?void 0:j.status,headers:((G=O.init)==null?void 0:G.headers)&&new Headers(O.init.headers)}}return{type:Gi.data,data:O}}function gg(t,n,o,u){let d=t.createURL(lB(n)).toString(),g={signal:o};if(u&&el(u.formMethod)){let{formMethod:x,formEncType:T}=u;g.method=x.toUpperCase(),T==="application/json"?(g.headers=new Headers({"Content-Type":T}),g.body=JSON.stringify(u.json)):T==="text/plain"?g.body=u.text:T==="application/x-www-form-urlencoded"&&u.formData?g.body=gC(u.formData):g.body=u.formData}return new Request(d,g)}function gC(t){let n=new URLSearchParams;for(let[o,u]of t.entries())n.append(o,typeof u=="string"?u:u.name);return n}function s4(t){let n=new FormData;for(let[o,u]of t.entries())n.append(o,u);return n}function bK(t,n,o,u,d){let g={},x=null,T,s=!1,I={};return o.forEach((O,D)=>{let N=n[D].route.id;if(fn(!Kh(O),"Cannot handle redirect results in processLoaderData"),Hf(O)){let j=g_(t,N),G=O.error;u&&(G=Object.values(u)[0],u=void 0),x=x||{},x[j.route.id]==null&&(x[j.route.id]=G),g[N]=void 0,s||(s=!0,T=nB(O.error)?O.error.status:500),O.headers&&(I[N]=O.headers)}else Qh(O)?(d.set(N,O.deferredData),g[N]=O.deferredData.data):g[N]=O.data,O.statusCode!=null&&O.statusCode!==200&&!s&&(T=O.statusCode),O.headers&&(I[N]=O.headers)}),u&&(x=u,g[Object.keys(u)[0]]=void 0),{loaderData:g,errors:x,statusCode:T||200,loaderHeaders:I}}function a4(t,n,o,u,d,g,x,T){let{loaderData:s,errors:I}=bK(n,o,u,d,T);for(let O=0;O<g.length;O++){let{key:D,match:N,controller:j}=g[O];fn(x!==void 0&&x[O]!==void 0,"Did not find corresponding fetcher result");let G=x[O];if(!(j&&j.signal.aborted))if(Hf(G)){let X=g_(t.matches,N==null?void 0:N.route.id);I&&I[X.route.id]||(I=Wi({},I,{[X.route.id]:G.error})),t.fetchers.delete(D)}else if(Kh(G))fn(!1,"Unhandled fetcher revalidation redirect");else if(Qh(G))fn(!1,"Unhandled fetcher deferred data");else{let X=gu(G.data);t.fetchers.set(D,X)}}return{loaderData:s,errors:I}}function l4(t,n,o,u){let d=Wi({},n);for(let g of o){let x=g.route.id;if(n.hasOwnProperty(x)?n[x]!==void 0&&(d[x]=n[x]):t[x]!==void 0&&g.route.loader&&(d[x]=t[x]),u&&u.hasOwnProperty(x))break}return d}function g_(t,n){return(n?t.slice(0,t.findIndex(u=>u.route.id===n)+1):[...t]).reverse().find(u=>u.route.hasErrorBoundary===!0)||t[0]}function c4(t){let n=t.length===1?t[0]:t.find(o=>o.index||!o.path||o.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:n}],route:n}}function Ea(t,n){let{pathname:o,routeId:u,method:d,type:g}=n===void 0?{}:n,x="Unknown Server Error",T="Unknown @remix-run/router error";return t===400?(x="Bad Request",d&&o&&u?T="You made a "+d+' request to "'+o+'" but '+('did not provide a `loader` for route "'+u+'", ')+"so there is no way to handle the request.":g==="defer-action"?T="defer() is not supported in actions":g==="invalid-body"&&(T="Unable to encode submission body")):t===403?(x="Forbidden",T='Route "'+u+'" does not match URL "'+o+'"'):t===404?(x="Not Found",T='No route matches URL "'+o+'"'):t===405&&(x="Method Not Allowed",d&&o&&u?T="You made a "+d.toUpperCase()+' request to "'+o+'" but '+('did not provide an `action` for route "'+u+'", ')+"so there is no way to handle the request.":d&&(T='Invalid request method "'+d.toUpperCase()+'"')),new _I(t||500,x,new Error(T),!0)}function u4(t){for(let n=t.length-1;n>=0;n--){let o=t[n];if(Kh(o))return{result:o,idx:n}}}function lB(t){let n=typeof t=="string"?Nc(t):t;return hd(Wi({},n,{hash:""}))}function wK(t,n){return t.pathname!==n.pathname||t.search!==n.search?!1:t.hash===""?n.hash!=="":t.hash===n.hash?!0:n.hash!==""}function Qh(t){return t.type===Gi.deferred}function Hf(t){return t.type===Gi.error}function Kh(t){return(t&&t.type)===Gi.redirect}function EK(t){let n=t;return n&&typeof n=="object"&&typeof n.data=="object"&&typeof n.subscribe=="function"&&typeof n.cancel=="function"&&typeof n.resolveData=="function"}function SK(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.headers=="object"&&typeof t.body<"u"}function TK(t){return dK.has(t.toLowerCase())}function el(t){return uK.has(t.toLowerCase())}async function h4(t,n,o,u,d,g){for(let x=0;x<o.length;x++){let T=o[x],s=n[x];if(!s)continue;let I=t.find(D=>D.route.id===s.route.id),O=I!=null&&!aB(I,s)&&(g&&g[s.route.id])!==void 0;if(Qh(T)&&(d||O)){let D=u[x];fn(D,"Expected an AbortSignal for revalidating fetcher deferred result"),await cB(T,D,d).then(N=>{N&&(o[x]=N||o[x])})}}}async function cB(t,n,o){if(o===void 0&&(o=!1),!await t.deferredData.resolveData(n)){if(o)try{return{type:Gi.data,data:t.deferredData.unwrappedData}}catch(d){return{type:Gi.error,error:d}}return{type:Gi.data,data:t.deferredData.data}}}function yI(t){return new URLSearchParams(t).getAll("index").some(n=>n==="")}function _C(t,n){let o=typeof n=="string"?Nc(n).search:n.search;if(t[t.length-1].route.index&&yI(o||""))return t[t.length-1];let u=rB(t);return u[u.length-1]}function d4(t){let{formMethod:n,formAction:o,formEncType:u,text:d,formData:g,json:x}=t;if(!(!n||!o||!u)){if(d!=null)return{formMethod:n,formAction:o,formEncType:u,formData:void 0,json:void 0,text:d};if(g!=null)return{formMethod:n,formAction:o,formEncType:u,formData:g,json:void 0,text:void 0};if(x!==void 0)return{formMethod:n,formAction:o,formEncType:u,formData:void 0,json:x,text:void 0}}}function MS(t,n){return n?{state:"loading",location:t,formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text}:{state:"loading",location:t,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function CK(t,n){return{state:"submitting",location:t,formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text}}function _g(t,n){return t?{state:"loading",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:n}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n}}function MK(t,n){return{state:"submitting",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:n?n.data:void 0}}function gu(t){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function IK(t,n){try{let o=t.sessionStorage.getItem(sB);if(o){let u=JSON.parse(o);for(let[d,g]of Object.entries(u||{}))g&&Array.isArray(g)&&n.set(d,new Set(g||[]))}}catch{}}function AK(t,n){if(n.size>0){let o={};for(let[u,d]of n)o[u]=[...d];try{t.sessionStorage.setItem(sB,JSON.stringify(o))}catch(u){ud(!1,"Failed to save applied view transitions in sessionStorage ("+u+").")}}}/**
 * React Router v6.22.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function q_(){return q_=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(t[u]=o[u])}return t},q_.apply(this,arguments)}const my=W.createContext(null),vI=W.createContext(null),Ku=W.createContext(null),z1=W.createContext(null),Fc=W.createContext({outlet:null,matches:[],isDataRoute:!1}),uB=W.createContext(null);function kK(t,n){let{relative:o}=n===void 0?{}:n;gy()||fn(!1);let{basename:u,navigator:d}=W.useContext(Ku),{hash:g,pathname:x,search:T}=N1(t,{relative:o}),s=x;return u!=="/"&&(s=x==="/"?u:wc([u,x])),d.createHref({pathname:s,search:T,hash:g})}function gy(){return W.useContext(z1)!=null}function Mp(){return gy()||fn(!1),W.useContext(z1).location}function hB(t){W.useContext(Ku).static||W.useLayoutEffect(t)}function xI(){let{isDataRoute:t}=W.useContext(Fc);return t?qK():PK()}function PK(){gy()||fn(!1);let t=W.useContext(my),{basename:n,future:o,navigator:u}=W.useContext(Ku),{matches:d}=W.useContext(Fc),{pathname:g}=Mp(),x=JSON.stringify(mI(d,o.v7_relativeSplatPath)),T=W.useRef(!1);return hB(()=>{T.current=!0}),W.useCallback(function(I,O){if(O===void 0&&(O={}),!T.current)return;if(typeof I=="number"){u.go(I);return}let D=gI(I,JSON.parse(x),g,O.relative==="path");t==null&&n!=="/"&&(D.pathname=D.pathname==="/"?n:wc([n,D.pathname])),(O.replace?u.replace:u.push)(D,O.state,O)},[n,u,x,g,t])}const OK=W.createContext(null);function DK(t){let n=W.useContext(Fc).outlet;return n&&W.createElement(OK.Provider,{value:t},n)}function RK(){let{matches:t}=W.useContext(Fc),n=t[t.length-1];return n?n.params:{}}function N1(t,n){let{relative:o}=n===void 0?{}:n,{future:u}=W.useContext(Ku),{matches:d}=W.useContext(Fc),{pathname:g}=Mp(),x=JSON.stringify(mI(d,u.v7_relativeSplatPath));return W.useMemo(()=>gI(t,JSON.parse(x),g,o==="path"),[t,x,g,o])}function LK(t,n,o,u){gy()||fn(!1);let{navigator:d}=W.useContext(Ku),{matches:g}=W.useContext(Fc),x=g[g.length-1],T=x?x.params:{};x&&x.pathname;let s=x?x.pathnameBase:"/";x&&x.route;let I=Mp(),O;if(n){var D;let te=typeof n=="string"?Nc(n):n;s==="/"||(D=te.pathname)!=null&&D.startsWith(s)||fn(!1),O=te}else O=I;let N=O.pathname||"/",j=s==="/"?N:N.slice(s.length)||"/",G=Wf(t,{pathname:j}),X=jK(G&&G.map(te=>Object.assign({},te,{params:Object.assign({},T,te.params),pathname:wc([s,d.encodeLocation?d.encodeLocation(te.pathname).pathname:te.pathname]),pathnameBase:te.pathnameBase==="/"?s:wc([s,d.encodeLocation?d.encodeLocation(te.pathnameBase).pathname:te.pathnameBase])})),g,o,u);return n&&X?W.createElement(z1.Provider,{value:{location:q_({pathname:"/",search:"",hash:"",state:null,key:"default"},O),navigationType:to.Pop}},X):X}function zK(){let t=GK(),n=nB(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),o=t instanceof Error?t.stack:null,d={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return W.createElement(W.Fragment,null,W.createElement("h2",null,"Unexpected Application Error!"),W.createElement("h3",{style:{fontStyle:"italic"}},n),o?W.createElement("pre",{style:d},o):null,null)}const NK=W.createElement(zK,null);class FK extends W.Component{constructor(n){super(n),this.state={location:n.location,revalidation:n.revalidation,error:n.error}}static getDerivedStateFromError(n){return{error:n}}static getDerivedStateFromProps(n,o){return o.location!==n.location||o.revalidation!=="idle"&&n.revalidation==="idle"?{error:n.error,location:n.location,revalidation:n.revalidation}:{error:n.error!==void 0?n.error:o.error,location:o.location,revalidation:n.revalidation||o.revalidation}}componentDidCatch(n,o){console.error("React Router caught the following error during render",n,o)}render(){return this.state.error!==void 0?W.createElement(Fc.Provider,{value:this.props.routeContext},W.createElement(uB.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function BK(t){let{routeContext:n,match:o,children:u}=t,d=W.useContext(my);return d&&d.static&&d.staticContext&&(o.route.errorElement||o.route.ErrorBoundary)&&(d.staticContext._deepestRenderedBoundaryId=o.route.id),W.createElement(Fc.Provider,{value:n},u)}function jK(t,n,o,u){var d;if(n===void 0&&(n=[]),o===void 0&&(o=null),u===void 0&&(u=null),t==null){var g;if((g=o)!=null&&g.errors)t=o.matches;else return null}let x=t,T=(d=o)==null?void 0:d.errors;if(T!=null){let O=x.findIndex(D=>D.route.id&&(T==null?void 0:T[D.route.id]));O>=0||fn(!1),x=x.slice(0,Math.min(x.length,O+1))}let s=!1,I=-1;if(o&&u&&u.v7_partialHydration)for(let O=0;O<x.length;O++){let D=x[O];if((D.route.HydrateFallback||D.route.hydrateFallbackElement)&&(I=O),D.route.id){let{loaderData:N,errors:j}=o,G=D.route.loader&&N[D.route.id]===void 0&&(!j||j[D.route.id]===void 0);if(D.route.lazy||G){s=!0,I>=0?x=x.slice(0,I+1):x=[x[0]];break}}}return x.reduceRight((O,D,N)=>{let j,G=!1,X=null,te=null;o&&(j=T&&D.route.id?T[D.route.id]:void 0,X=D.route.errorElement||NK,s&&(I<0&&N===0?(WK("route-fallback",!1),G=!0,te=null):I===N&&(G=!0,te=D.route.hydrateFallbackElement||null)));let H=n.concat(x.slice(0,N+1)),U=()=>{let q;return j?q=X:G?q=te:D.route.Component?q=W.createElement(D.route.Component,null):D.route.element?q=D.route.element:q=O,W.createElement(BK,{match:D,routeContext:{outlet:O,matches:H,isDataRoute:o!=null},children:q})};return o&&(D.route.ErrorBoundary||D.route.errorElement||N===0)?W.createElement(FK,{location:o.location,revalidation:o.revalidation,component:X,error:j,children:U(),routeContext:{outlet:null,matches:H,isDataRoute:!0}}):U()},null)}var dB=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(dB||{}),W_=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(W_||{});function $K(t){let n=W.useContext(my);return n||fn(!1),n}function fB(t){let n=W.useContext(vI);return n||fn(!1),n}function UK(t){let n=W.useContext(Fc);return n||fn(!1),n}function pB(t){let n=UK(),o=n.matches[n.matches.length-1];return o.route.id||fn(!1),o.route.id}function VK(){return fB(W_.UseNavigation).navigation}function GK(){var t;let n=W.useContext(uB),o=fB(W_.UseRouteError),u=pB(W_.UseRouteError);return n!==void 0?n:(t=o.errors)==null?void 0:t[u]}function qK(){let{router:t}=$K(dB.UseNavigateStable),n=pB(W_.UseNavigateStable),o=W.useRef(!1);return hB(()=>{o.current=!0}),W.useCallback(function(d,g){g===void 0&&(g={}),o.current&&(typeof d=="number"?t.navigate(d):t.navigate(d,q_({fromRouteId:n},g)))},[t,n])}const f4={};function WK(t,n,o){!n&&!f4[t]&&(f4[t]=!0)}function HK(t){return DK(t.context)}function ZK(t){let{basename:n="/",children:o=null,location:u,navigationType:d=to.Pop,navigator:g,static:x=!1,future:T}=t;gy()&&fn(!1);let s=n.replace(/^\/*/,"/"),I=W.useMemo(()=>({basename:s,navigator:g,static:x,future:q_({v7_relativeSplatPath:!1},T)}),[s,T,g,x]);typeof u=="string"&&(u=Nc(u));let{pathname:O="/",search:D="",hash:N="",state:j=null,key:G="default"}=u,X=W.useMemo(()=>{let te=Oc(O,s);return te==null?null:{location:{pathname:te,search:D,hash:N,state:j,key:G},navigationType:d}},[s,O,D,N,j,G,d]);return X==null?null:W.createElement(Ku.Provider,{value:I},W.createElement(z1.Provider,{children:o,value:X}))}new Promise(()=>{});function XK(t){let n={hasErrorBoundary:t.ErrorBoundary!=null||t.errorElement!=null};return t.Component&&Object.assign(n,{element:W.createElement(t.Component),Component:void 0}),t.HydrateFallback&&Object.assign(n,{hydrateFallbackElement:W.createElement(t.HydrateFallback),HydrateFallback:void 0}),t.ErrorBoundary&&Object.assign(n,{errorElement:W.createElement(t.ErrorBoundary),ErrorBoundary:void 0}),n}/**
 * React Router DOM v6.22.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function _p(){return _p=Object.assign?Object.assign.bind():function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var u in o)Object.prototype.hasOwnProperty.call(o,u)&&(t[u]=o[u])}return t},_p.apply(this,arguments)}function mB(t,n){if(t==null)return{};var o={},u=Object.keys(t),d,g;for(g=0;g<u.length;g++)d=u[g],!(n.indexOf(d)>=0)&&(o[d]=t[d]);return o}function YK(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function QK(t,n){return t.button===0&&(!n||n==="_self")&&!YK(t)}function yC(t){return t===void 0&&(t=""),new URLSearchParams(typeof t=="string"||Array.isArray(t)||t instanceof URLSearchParams?t:Object.keys(t).reduce((n,o)=>{let u=t[o];return n.concat(Array.isArray(u)?u.map(d=>[o,d]):[[o,u]])},[]))}function KK(t,n){let o=yC(t);return n&&n.forEach((u,d)=>{o.has(d)||n.getAll(d).forEach(g=>{o.append(d,g)})}),o}const JK=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],eJ=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],tJ="6";try{window.__reactRouterVersion=tJ}catch{}function rJ(t,n){return _K({basename:n==null?void 0:n.basename,future:_p({},n==null?void 0:n.future,{v7_prependBasename:!0}),history:jQ({window:n==null?void 0:n.window}),hydrationData:(n==null?void 0:n.hydrationData)||nJ(),routes:t,mapRouteProperties:XK,window:n==null?void 0:n.window}).initialize()}function nJ(){var t;let n=(t=window)==null?void 0:t.__staticRouterHydrationData;return n&&n.errors&&(n=_p({},n,{errors:iJ(n.errors)})),n}function iJ(t){if(!t)return null;let n=Object.entries(t),o={};for(let[u,d]of n)if(d&&d.__type==="RouteErrorResponse")o[u]=new _I(d.status,d.statusText,d.data,d.internal===!0);else if(d&&d.__type==="Error"){if(d.__subType){let g=window[d.__subType];if(typeof g=="function")try{let x=new g(d.message);x.stack="",o[u]=x}catch{}}if(o[u]==null){let g=new Error(d.message);g.stack="",o[u]=g}}else o[u]=d;return o}const gB=W.createContext({isTransitioning:!1}),oJ=W.createContext(new Map),sJ="startTransition",p4=i5[sJ],aJ="flushSync",m4=MW[aJ];function lJ(t){p4?p4(t):t()}function yg(t){m4?m4(t):t()}class cJ{constructor(){this.status="pending",this.promise=new Promise((n,o)=>{this.resolve=u=>{this.status==="pending"&&(this.status="resolved",n(u))},this.reject=u=>{this.status==="pending"&&(this.status="rejected",o(u))}})}}function uJ(t){let{fallbackElement:n,router:o,future:u}=t,[d,g]=W.useState(o.state),[x,T]=W.useState(),[s,I]=W.useState({isTransitioning:!1}),[O,D]=W.useState(),[N,j]=W.useState(),[G,X]=W.useState(),te=W.useRef(new Map),{v7_startTransition:H}=u||{},U=W.useCallback(Me=>{H?lJ(Me):Me()},[H]),q=W.useCallback((Me,Se)=>{let{deletedFetchers:ge,unstable_flushSync:se,unstable_viewTransitionOpts:Ie}=Se;ge.forEach(ze=>te.current.delete(ze)),Me.fetchers.forEach((ze,De)=>{ze.data!==void 0&&te.current.set(De,ze.data)});let We=o.window==null||typeof o.window.document.startViewTransition!="function";if(!Ie||We){se?yg(()=>g(Me)):U(()=>g(Me));return}if(se){yg(()=>{N&&(O&&O.resolve(),N.skipTransition()),I({isTransitioning:!0,flushSync:!0,currentLocation:Ie.currentLocation,nextLocation:Ie.nextLocation})});let ze=o.window.document.startViewTransition(()=>{yg(()=>g(Me))});ze.finished.finally(()=>{yg(()=>{D(void 0),j(void 0),T(void 0),I({isTransitioning:!1})})}),yg(()=>j(ze));return}N?(O&&O.resolve(),N.skipTransition(),X({state:Me,currentLocation:Ie.currentLocation,nextLocation:Ie.nextLocation})):(T(Me),I({isTransitioning:!0,flushSync:!1,currentLocation:Ie.currentLocation,nextLocation:Ie.nextLocation}))},[o.window,N,O,te,U]);W.useLayoutEffect(()=>o.subscribe(q),[o,q]),W.useEffect(()=>{s.isTransitioning&&!s.flushSync&&D(new cJ)},[s]),W.useEffect(()=>{if(O&&x&&o.window){let Me=x,Se=O.promise,ge=o.window.document.startViewTransition(async()=>{U(()=>g(Me)),await Se});ge.finished.finally(()=>{D(void 0),j(void 0),T(void 0),I({isTransitioning:!1})}),j(ge)}},[U,x,O,o.window]),W.useEffect(()=>{O&&x&&d.location.key===x.location.key&&O.resolve()},[O,N,d.location,x]),W.useEffect(()=>{!s.isTransitioning&&G&&(T(G.state),I({isTransitioning:!0,flushSync:!1,currentLocation:G.currentLocation,nextLocation:G.nextLocation}),X(void 0))},[s.isTransitioning,G]),W.useEffect(()=>{},[]);let J=W.useMemo(()=>({createHref:o.createHref,encodeLocation:o.encodeLocation,go:Me=>o.navigate(Me),push:(Me,Se,ge)=>o.navigate(Me,{state:Se,preventScrollReset:ge==null?void 0:ge.preventScrollReset}),replace:(Me,Se,ge)=>o.navigate(Me,{replace:!0,state:Se,preventScrollReset:ge==null?void 0:ge.preventScrollReset})}),[o]),pe=o.basename||"/",ue=W.useMemo(()=>({router:o,navigator:J,static:!1,basename:pe}),[o,J,pe]);return W.createElement(W.Fragment,null,W.createElement(my.Provider,{value:ue},W.createElement(vI.Provider,{value:d},W.createElement(oJ.Provider,{value:te.current},W.createElement(gB.Provider,{value:s},W.createElement(ZK,{basename:pe,location:d.location,navigationType:d.historyAction,navigator:J,future:{v7_relativeSplatPath:o.future.v7_relativeSplatPath}},d.initialized||o.future.v7_partialHydration?W.createElement(hJ,{routes:o.routes,future:o.future,state:d}):n))))),null)}function hJ(t){let{routes:n,future:o,state:u}=t;return LK(n,void 0,u,o)}const dJ=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",fJ=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,So=W.forwardRef(function(n,o){let{onClick:u,relative:d,reloadDocument:g,replace:x,state:T,target:s,to:I,preventScrollReset:O,unstable_viewTransition:D}=n,N=mB(n,JK),{basename:j}=W.useContext(Ku),G,X=!1;if(typeof I=="string"&&fJ.test(I)&&(G=I,dJ))try{let q=new URL(window.location.href),J=I.startsWith("//")?new URL(q.protocol+I):new URL(I),pe=Oc(J.pathname,j);J.origin===q.origin&&pe!=null?I=pe+J.search+J.hash:X=!0}catch{}let te=kK(I,{relative:d}),H=mJ(I,{replace:x,state:T,target:s,preventScrollReset:O,relative:d,unstable_viewTransition:D});function U(q){u&&u(q),q.defaultPrevented||H(q)}return W.createElement("a",_p({},N,{href:G||te,onClick:X||g?u:U,ref:o,target:s}))}),R0=W.forwardRef(function(n,o){let{"aria-current":u="page",caseSensitive:d=!1,className:g="",end:x=!1,style:T,to:s,unstable_viewTransition:I,children:O}=n,D=mB(n,eJ),N=N1(s,{relative:D.relative}),j=Mp(),G=W.useContext(vI),{navigator:X,basename:te}=W.useContext(Ku),H=G!=null&&gJ(N)&&I===!0,U=X.encodeLocation?X.encodeLocation(N).pathname:N.pathname,q=j.pathname,J=G&&G.navigation&&G.navigation.location?G.navigation.location.pathname:null;d||(q=q.toLowerCase(),J=J?J.toLowerCase():null,U=U.toLowerCase()),J&&te&&(J=Oc(J,te)||J);const pe=U!=="/"&&U.endsWith("/")?U.length-1:U.length;let ue=q===U||!x&&q.startsWith(U)&&q.charAt(pe)==="/",Me=J!=null&&(J===U||!x&&J.startsWith(U)&&J.charAt(U.length)==="/"),Se={isActive:ue,isPending:Me,isTransitioning:H},ge=ue?u:void 0,se;typeof g=="function"?se=g(Se):se=[g,ue?"active":null,Me?"pending":null,H?"transitioning":null].filter(Boolean).join(" ");let Ie=typeof T=="function"?T(Se):T;return W.createElement(So,_p({},D,{"aria-current":ge,className:se,ref:o,style:Ie,to:s,unstable_viewTransition:I}),typeof O=="function"?O(Se):O)});var vC;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(vC||(vC={}));var g4;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(g4||(g4={}));function pJ(t){let n=W.useContext(my);return n||fn(!1),n}function mJ(t,n){let{target:o,replace:u,state:d,preventScrollReset:g,relative:x,unstable_viewTransition:T}=n===void 0?{}:n,s=xI(),I=Mp(),O=N1(t,{relative:x});return W.useCallback(D=>{if(QK(D,o)){D.preventDefault();let N=u!==void 0?u:hd(I)===hd(O);s(t,{replace:N,state:d,preventScrollReset:g,relative:x,unstable_viewTransition:T})}},[I,s,O,u,d,o,t,g,x,T])}function Ip(t){let n=W.useRef(yC(t)),o=W.useRef(!1),u=Mp(),d=W.useMemo(()=>KK(u.search,o.current?null:n.current),[u.search]),g=xI(),x=W.useCallback((T,s)=>{const I=yC(typeof T=="function"?T(d):T);o.current=!0,g("?"+I,s)},[g,d]);return[d,x]}function gJ(t,n){n===void 0&&(n={});let o=W.useContext(gB);o==null&&fn(!1);let{basename:u}=pJ(vC.useViewTransitionState),d=N1(t,{relative:n.relative});if(!o.isTransitioning)return!1;let g=Oc(o.currentLocation.pathname,u)||o.currentLocation.pathname,x=Oc(o.nextLocation.pathname,u)||o.nextLocation.pathname;return pC(d.pathname,x)!=null||pC(d.pathname,g)!=null}function _J(){return Y.jsx("div",{style:{flexGrow:1}})}const yJ="_root_1wfbt_1",vJ={root:yJ};function _B({children:t}){return Y.jsx("div",{className:vJ.root,children:t})}var yB={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var n={}.hasOwnProperty;function o(){for(var g="",x=0;x<arguments.length;x++){var T=arguments[x];T&&(g=d(g,u(T)))}return g}function u(g){if(typeof g=="string"||typeof g=="number")return g;if(typeof g!="object")return"";if(Array.isArray(g))return o.apply(null,g);if(g.toString!==Object.prototype.toString&&!g.toString.toString().includes("[native code]"))return g.toString();var x="";for(var T in g)n.call(g,T)&&g[T]&&(x=d(x,T));return x}function d(g,x){return x?g?g+" "+x:g+x:g}t.exports?(o.default=o,t.exports=o):window.classNames=o})()})(yB);var xJ=yB.exports;const xi=vp(xJ);function Dc(t){return Array.isArray?Array.isArray(t):bB(t)==="[object Array]"}const bJ=1/0;function wJ(t){if(typeof t=="string")return t;let n=t+"";return n=="0"&&1/t==-bJ?"-0":n}function EJ(t){return t==null?"":wJ(t)}function Ll(t){return typeof t=="string"}function vB(t){return typeof t=="number"}function SJ(t){return t===!0||t===!1||TJ(t)&&bB(t)=="[object Boolean]"}function xB(t){return typeof t=="object"}function TJ(t){return xB(t)&&t!==null}function ia(t){return t!=null}function IS(t){return!t.trim().length}function bB(t){return t==null?t===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(t)}const CJ="Incorrect 'index' type",MJ=t=>`Invalid value for key ${t}`,IJ=t=>`Pattern length exceeds max of ${t}.`,AJ=t=>`Missing ${t} property in key`,kJ=t=>`Property 'weight' in key '${t}' must be a positive integer`,_4=Object.prototype.hasOwnProperty;class PJ{constructor(n){this._keys=[],this._keyMap={};let o=0;n.forEach(u=>{let d=wB(u);this._keys.push(d),this._keyMap[d.id]=d,o+=d.weight}),this._keys.forEach(u=>{u.weight/=o})}get(n){return this._keyMap[n]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}}function wB(t){let n=null,o=null,u=null,d=1,g=null;if(Ll(t)||Dc(t))u=t,n=y4(t),o=xC(t);else{if(!_4.call(t,"name"))throw new Error(AJ("name"));const x=t.name;if(u=x,_4.call(t,"weight")&&(d=t.weight,d<=0))throw new Error(kJ(x));n=y4(x),o=xC(x),g=t.getFn}return{path:n,id:o,weight:d,src:u,getFn:g}}function y4(t){return Dc(t)?t:t.split(".")}function xC(t){return Dc(t)?t.join("."):t}function OJ(t,n){let o=[],u=!1;const d=(g,x,T)=>{if(ia(g))if(!x[T])o.push(g);else{let s=x[T];const I=g[s];if(!ia(I))return;if(T===x.length-1&&(Ll(I)||vB(I)||SJ(I)))o.push(EJ(I));else if(Dc(I)){u=!0;for(let O=0,D=I.length;O<D;O+=1)d(I[O],x,T+1)}else x.length&&d(I,x,T+1)}};return d(t,Ll(n)?n.split("."):n,0),u?o:o[0]}const DJ={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},RJ={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(t,n)=>t.score===n.score?t.idx<n.idx?-1:1:t.score<n.score?-1:1},LJ={location:0,threshold:.6,distance:100},zJ={useExtendedSearch:!1,getFn:OJ,ignoreLocation:!1,ignoreFieldNorm:!1,fieldNormWeight:1};var en={...RJ,...DJ,...LJ,...zJ};const NJ=/[^ ]+/g;function FJ(t=1,n=3){const o=new Map,u=Math.pow(10,n);return{get(d){const g=d.match(NJ).length;if(o.has(g))return o.get(g);const x=1/Math.pow(g,.5*t),T=parseFloat(Math.round(x*u)/u);return o.set(g,T),T},clear(){o.clear()}}}class bI{constructor({getFn:n=en.getFn,fieldNormWeight:o=en.fieldNormWeight}={}){this.norm=FJ(o,3),this.getFn=n,this.isCreated=!1,this.setIndexRecords()}setSources(n=[]){this.docs=n}setIndexRecords(n=[]){this.records=n}setKeys(n=[]){this.keys=n,this._keysMap={},n.forEach((o,u)=>{this._keysMap[o.id]=u})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,Ll(this.docs[0])?this.docs.forEach((n,o)=>{this._addString(n,o)}):this.docs.forEach((n,o)=>{this._addObject(n,o)}),this.norm.clear())}add(n){const o=this.size();Ll(n)?this._addString(n,o):this._addObject(n,o)}removeAt(n){this.records.splice(n,1);for(let o=n,u=this.size();o<u;o+=1)this.records[o].i-=1}getValueForItemAtKeyId(n,o){return n[this._keysMap[o]]}size(){return this.records.length}_addString(n,o){if(!ia(n)||IS(n))return;let u={v:n,i:o,n:this.norm.get(n)};this.records.push(u)}_addObject(n,o){let u={i:o,$:{}};this.keys.forEach((d,g)=>{let x=d.getFn?d.getFn(n):this.getFn(n,d.path);if(ia(x)){if(Dc(x)){let T=[];const s=[{nestedArrIndex:-1,value:x}];for(;s.length;){const{nestedArrIndex:I,value:O}=s.pop();if(ia(O))if(Ll(O)&&!IS(O)){let D={v:O,i:I,n:this.norm.get(O)};T.push(D)}else Dc(O)&&O.forEach((D,N)=>{s.push({nestedArrIndex:N,value:D})})}u.$[g]=T}else if(Ll(x)&&!IS(x)){let T={v:x,n:this.norm.get(x)};u.$[g]=T}}}),this.records.push(u)}toJSON(){return{keys:this.keys,records:this.records}}}function EB(t,n,{getFn:o=en.getFn,fieldNormWeight:u=en.fieldNormWeight}={}){const d=new bI({getFn:o,fieldNormWeight:u});return d.setKeys(t.map(wB)),d.setSources(n),d.create(),d}function BJ(t,{getFn:n=en.getFn,fieldNormWeight:o=en.fieldNormWeight}={}){const{keys:u,records:d}=t,g=new bI({getFn:n,fieldNormWeight:o});return g.setKeys(u),g.setIndexRecords(d),g}function L0(t,{errors:n=0,currentLocation:o=0,expectedLocation:u=0,distance:d=en.distance,ignoreLocation:g=en.ignoreLocation}={}){const x=n/t.length;if(g)return x;const T=Math.abs(u-o);return d?x+T/d:T?1:x}function jJ(t=[],n=en.minMatchCharLength){let o=[],u=-1,d=-1,g=0;for(let x=t.length;g<x;g+=1){let T=t[g];T&&u===-1?u=g:!T&&u!==-1&&(d=g-1,d-u+1>=n&&o.push([u,d]),u=-1)}return t[g-1]&&g-u>=n&&o.push([u,g-1]),o}const Wh=32;function $J(t,n,o,{location:u=en.location,distance:d=en.distance,threshold:g=en.threshold,findAllMatches:x=en.findAllMatches,minMatchCharLength:T=en.minMatchCharLength,includeMatches:s=en.includeMatches,ignoreLocation:I=en.ignoreLocation}={}){if(n.length>Wh)throw new Error(IJ(Wh));const O=n.length,D=t.length,N=Math.max(0,Math.min(u,D));let j=g,G=N;const X=T>1||s,te=X?Array(D):[];let H;for(;(H=t.indexOf(n,G))>-1;){let Me=L0(n,{currentLocation:H,expectedLocation:N,distance:d,ignoreLocation:I});if(j=Math.min(Me,j),G=H+O,X){let Se=0;for(;Se<O;)te[H+Se]=1,Se+=1}}G=-1;let U=[],q=1,J=O+D;const pe=1<<O-1;for(let Me=0;Me<O;Me+=1){let Se=0,ge=J;for(;Se<ge;)L0(n,{errors:Me,currentLocation:N+ge,expectedLocation:N,distance:d,ignoreLocation:I})<=j?Se=ge:J=ge,ge=Math.floor((J-Se)/2+Se);J=ge;let se=Math.max(1,N-ge+1),Ie=x?D:Math.min(N+ge,D)+O,We=Array(Ie+2);We[Ie+1]=(1<<Me)-1;for(let De=Ie;De>=se;De-=1){let nt=De-1,It=o[t.charAt(nt)];if(X&&(te[nt]=+!!It),We[De]=(We[De+1]<<1|1)&It,Me&&(We[De]|=(U[De+1]|U[De])<<1|1|U[De+1]),We[De]&pe&&(q=L0(n,{errors:Me,currentLocation:nt,expectedLocation:N,distance:d,ignoreLocation:I}),q<=j)){if(j=q,G=nt,G<=N)break;se=Math.max(1,2*N-G)}}if(L0(n,{errors:Me+1,currentLocation:N,expectedLocation:N,distance:d,ignoreLocation:I})>j)break;U=We}const ue={isMatch:G>=0,score:Math.max(.001,q)};if(X){const Me=jJ(te,T);Me.length?s&&(ue.indices=Me):ue.isMatch=!1}return ue}function UJ(t){let n={};for(let o=0,u=t.length;o<u;o+=1){const d=t.charAt(o);n[d]=(n[d]||0)|1<<u-o-1}return n}class SB{constructor(n,{location:o=en.location,threshold:u=en.threshold,distance:d=en.distance,includeMatches:g=en.includeMatches,findAllMatches:x=en.findAllMatches,minMatchCharLength:T=en.minMatchCharLength,isCaseSensitive:s=en.isCaseSensitive,ignoreLocation:I=en.ignoreLocation}={}){if(this.options={location:o,threshold:u,distance:d,includeMatches:g,findAllMatches:x,minMatchCharLength:T,isCaseSensitive:s,ignoreLocation:I},this.pattern=s?n:n.toLowerCase(),this.chunks=[],!this.pattern.length)return;const O=(N,j)=>{this.chunks.push({pattern:N,alphabet:UJ(N),startIndex:j})},D=this.pattern.length;if(D>Wh){let N=0;const j=D%Wh,G=D-j;for(;N<G;)O(this.pattern.substr(N,Wh),N),N+=Wh;if(j){const X=D-Wh;O(this.pattern.substr(X),X)}}else O(this.pattern,0)}searchIn(n){const{isCaseSensitive:o,includeMatches:u}=this.options;if(o||(n=n.toLowerCase()),this.pattern===n){let G={isMatch:!0,score:0};return u&&(G.indices=[[0,n.length-1]]),G}const{location:d,distance:g,threshold:x,findAllMatches:T,minMatchCharLength:s,ignoreLocation:I}=this.options;let O=[],D=0,N=!1;this.chunks.forEach(({pattern:G,alphabet:X,startIndex:te})=>{const{isMatch:H,score:U,indices:q}=$J(n,G,X,{location:d+te,distance:g,threshold:x,findAllMatches:T,minMatchCharLength:s,includeMatches:u,ignoreLocation:I});H&&(N=!0),D+=U,H&&q&&(O=[...O,...q])});let j={isMatch:N,score:N?D/this.chunks.length:1};return N&&u&&(j.indices=O),j}}class Ju{constructor(n){this.pattern=n}static isMultiMatch(n){return v4(n,this.multiRegex)}static isSingleMatch(n){return v4(n,this.singleRegex)}search(){}}function v4(t,n){const o=t.match(n);return o?o[1]:null}class VJ extends Ju{constructor(n){super(n)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(n){const o=n===this.pattern;return{isMatch:o,score:o?0:1,indices:[0,this.pattern.length-1]}}}class GJ extends Ju{constructor(n){super(n)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(n){const u=n.indexOf(this.pattern)===-1;return{isMatch:u,score:u?0:1,indices:[0,n.length-1]}}}class qJ extends Ju{constructor(n){super(n)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(n){const o=n.startsWith(this.pattern);return{isMatch:o,score:o?0:1,indices:[0,this.pattern.length-1]}}}class WJ extends Ju{constructor(n){super(n)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(n){const o=!n.startsWith(this.pattern);return{isMatch:o,score:o?0:1,indices:[0,n.length-1]}}}class HJ extends Ju{constructor(n){super(n)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(n){const o=n.endsWith(this.pattern);return{isMatch:o,score:o?0:1,indices:[n.length-this.pattern.length,n.length-1]}}}class ZJ extends Ju{constructor(n){super(n)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(n){const o=!n.endsWith(this.pattern);return{isMatch:o,score:o?0:1,indices:[0,n.length-1]}}}class TB extends Ju{constructor(n,{location:o=en.location,threshold:u=en.threshold,distance:d=en.distance,includeMatches:g=en.includeMatches,findAllMatches:x=en.findAllMatches,minMatchCharLength:T=en.minMatchCharLength,isCaseSensitive:s=en.isCaseSensitive,ignoreLocation:I=en.ignoreLocation}={}){super(n),this._bitapSearch=new SB(n,{location:o,threshold:u,distance:d,includeMatches:g,findAllMatches:x,minMatchCharLength:T,isCaseSensitive:s,ignoreLocation:I})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(n){return this._bitapSearch.searchIn(n)}}class CB extends Ju{constructor(n){super(n)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(n){let o=0,u;const d=[],g=this.pattern.length;for(;(u=n.indexOf(this.pattern,o))>-1;)o=u+g,d.push([u,o-1]);const x=!!d.length;return{isMatch:x,score:x?0:1,indices:d}}}const bC=[VJ,CB,qJ,WJ,ZJ,HJ,GJ,TB],x4=bC.length,XJ=/ +(?=(?:[^\"]*\"[^\"]*\")*[^\"]*$)/,YJ="|";function QJ(t,n={}){return t.split(YJ).map(o=>{let u=o.trim().split(XJ).filter(g=>g&&!!g.trim()),d=[];for(let g=0,x=u.length;g<x;g+=1){const T=u[g];let s=!1,I=-1;for(;!s&&++I<x4;){const O=bC[I];let D=O.isMultiMatch(T);D&&(d.push(new O(D,n)),s=!0)}if(!s)for(I=-1;++I<x4;){const O=bC[I];let D=O.isSingleMatch(T);if(D){d.push(new O(D,n));break}}}return d})}const KJ=new Set([TB.type,CB.type]);class JJ{constructor(n,{isCaseSensitive:o=en.isCaseSensitive,includeMatches:u=en.includeMatches,minMatchCharLength:d=en.minMatchCharLength,ignoreLocation:g=en.ignoreLocation,findAllMatches:x=en.findAllMatches,location:T=en.location,threshold:s=en.threshold,distance:I=en.distance}={}){this.query=null,this.options={isCaseSensitive:o,includeMatches:u,minMatchCharLength:d,findAllMatches:x,ignoreLocation:g,location:T,threshold:s,distance:I},this.pattern=o?n:n.toLowerCase(),this.query=QJ(this.pattern,this.options)}static condition(n,o){return o.useExtendedSearch}searchIn(n){const o=this.query;if(!o)return{isMatch:!1,score:1};const{includeMatches:u,isCaseSensitive:d}=this.options;n=d?n:n.toLowerCase();let g=0,x=[],T=0;for(let s=0,I=o.length;s<I;s+=1){const O=o[s];x.length=0,g=0;for(let D=0,N=O.length;D<N;D+=1){const j=O[D],{isMatch:G,indices:X,score:te}=j.search(n);if(G){if(g+=1,T+=te,u){const H=j.constructor.type;KJ.has(H)?x=[...x,...X]:x.push(X)}}else{T=0,g=0,x.length=0;break}}if(g){let D={isMatch:!0,score:T/g};return u&&(D.indices=x),D}}return{isMatch:!1,score:1}}}const wC=[];function e2(...t){wC.push(...t)}function EC(t,n){for(let o=0,u=wC.length;o<u;o+=1){let d=wC[o];if(d.condition(t,n))return new d(t,n)}return new SB(t,n)}const t1={AND:"$and",OR:"$or"},SC={PATH:"$path",PATTERN:"$val"},TC=t=>!!(t[t1.AND]||t[t1.OR]),t2=t=>!!t[SC.PATH],r2=t=>!Dc(t)&&xB(t)&&!TC(t),b4=t=>({[t1.AND]:Object.keys(t).map(n=>({[n]:t[n]}))});function MB(t,n,{auto:o=!0}={}){const u=d=>{let g=Object.keys(d);const x=t2(d);if(!x&&g.length>1&&!TC(d))return u(b4(d));if(r2(d)){const s=x?d[SC.PATH]:g[0],I=x?d[SC.PATTERN]:d[s];if(!Ll(I))throw new Error(MJ(s));const O={keyId:xC(s),pattern:I};return o&&(O.searcher=EC(I,n)),O}let T={children:[],operator:g[0]};return g.forEach(s=>{const I=d[s];Dc(I)&&I.forEach(O=>{T.children.push(u(O))})}),T};return TC(t)||(t=b4(t)),u(t)}function n2(t,{ignoreFieldNorm:n=en.ignoreFieldNorm}){t.forEach(o=>{let u=1;o.matches.forEach(({key:d,norm:g,score:x})=>{const T=d?d.weight:null;u*=Math.pow(x===0&&T?Number.EPSILON:x,(T||1)*(n?1:g))}),o.score=u})}function i2(t,n){const o=t.matches;n.matches=[],ia(o)&&o.forEach(u=>{if(!ia(u.indices)||!u.indices.length)return;const{indices:d,value:g}=u;let x={indices:d,value:g};u.key&&(x.key=u.key.src),u.idx>-1&&(x.refIndex=u.idx),n.matches.push(x)})}function o2(t,n){n.score=t.score}function s2(t,n,{includeMatches:o=en.includeMatches,includeScore:u=en.includeScore}={}){const d=[];return o&&d.push(i2),u&&d.push(o2),t.map(g=>{const{idx:x}=g,T={item:n[x],refIndex:x};return d.length&&d.forEach(s=>{s(g,T)}),T})}class Ap{constructor(n,o={},u){this.options={...en,...o},this.options.useExtendedSearch,this._keyStore=new PJ(this.options.keys),this.setCollection(n,u)}setCollection(n,o){if(this._docs=n,o&&!(o instanceof bI))throw new Error(CJ);this._myIndex=o||EB(this.options.keys,this._docs,{getFn:this.options.getFn,fieldNormWeight:this.options.fieldNormWeight})}add(n){ia(n)&&(this._docs.push(n),this._myIndex.add(n))}remove(n=()=>!1){const o=[];for(let u=0,d=this._docs.length;u<d;u+=1){const g=this._docs[u];n(g,u)&&(this.removeAt(u),u-=1,d-=1,o.push(g))}return o}removeAt(n){this._docs.splice(n,1),this._myIndex.removeAt(n)}getIndex(){return this._myIndex}search(n,{limit:o=-1}={}){const{includeMatches:u,includeScore:d,shouldSort:g,sortFn:x,ignoreFieldNorm:T}=this.options;let s=Ll(n)?Ll(this._docs[0])?this._searchStringList(n):this._searchObjectList(n):this._searchLogical(n);return n2(s,{ignoreFieldNorm:T}),g&&s.sort(x),vB(o)&&o>-1&&(s=s.slice(0,o)),s2(s,this._docs,{includeMatches:u,includeScore:d})}_searchStringList(n){const o=EC(n,this.options),{records:u}=this._myIndex,d=[];return u.forEach(({v:g,i:x,n:T})=>{if(!ia(g))return;const{isMatch:s,score:I,indices:O}=o.searchIn(g);s&&d.push({item:g,idx:x,matches:[{score:I,value:g,norm:T,indices:O}]})}),d}_searchLogical(n){const o=MB(n,this.options),u=(T,s,I)=>{if(!T.children){const{keyId:D,searcher:N}=T,j=this._findMatches({key:this._keyStore.get(D),value:this._myIndex.getValueForItemAtKeyId(s,D),searcher:N});return j&&j.length?[{idx:I,item:s,matches:j}]:[]}const O=[];for(let D=0,N=T.children.length;D<N;D+=1){const j=T.children[D],G=u(j,s,I);if(G.length)O.push(...G);else if(T.operator===t1.AND)return[]}return O},d=this._myIndex.records,g={},x=[];return d.forEach(({$:T,i:s})=>{if(ia(T)){let I=u(o,T,s);I.length&&(g[s]||(g[s]={idx:s,item:T,matches:[]},x.push(g[s])),I.forEach(({matches:O})=>{g[s].matches.push(...O)}))}}),x}_searchObjectList(n){const o=EC(n,this.options),{keys:u,records:d}=this._myIndex,g=[];return d.forEach(({$:x,i:T})=>{if(!ia(x))return;let s=[];u.forEach((I,O)=>{s.push(...this._findMatches({key:I,value:x[O],searcher:o}))}),s.length&&g.push({idx:T,item:x,matches:s})}),g}_findMatches({key:n,value:o,searcher:u}){if(!ia(o))return[];let d=[];if(Dc(o))o.forEach(({v:g,i:x,n:T})=>{if(!ia(g))return;const{isMatch:s,score:I,indices:O}=u.searchIn(g);s&&d.push({score:I,key:n,value:g,idx:x,norm:T,indices:O})});else{const{v:g,n:x}=o,{isMatch:T,score:s,indices:I}=u.searchIn(g);T&&d.push({score:s,key:n,value:g,norm:x,indices:I})}return d}}Ap.version="7.0.0";Ap.createIndex=EB;Ap.parseIndex=BJ;Ap.config=en;Ap.parseQuery=MB;e2(JJ);function wI(){const[t,n]=W.useState(window.innerHeight),[o,u]=W.useState(window.innerWidth);return W.useEffect(()=>{const d=()=>{n(window.innerHeight),u(window.innerWidth)};return window.addEventListener("resize",d),()=>window.removeEventListener("resize",d)},[]),{height:t,width:o}}const a2={astron:{abbreviations:["astro"],name:"Astronomy"},compsci:{abbreviations:["cs","comp sci","computer science"],name:"Computer Science"},mcellbi:{abbreviations:["mcb"],name:"Molecular and Cell Biology"},nusctx:{abbreviations:["nutrisci"],name:"Nutritional Sciences and Toxicology"},bioeng:{abbreviations:["bioe","bio e","bio p","bio eng"],name:"Bioengineering"},biology:{abbreviations:["bio"],name:"Biology"},civeng:{abbreviations:["cive","civ e","civ eng"],name:"Civil and Environmental Engineering"},chmeng:{abbreviations:["cheme","chm eng"],name:"Chemical Engineering"},classic:{abbreviations:["classics"],name:"Classics"},cogsci:{abbreviations:["cogsci"],name:"Cognitive Science"},colwrit:{abbreviations:["college writing","col writ"],name:"College Writing"},comlit:{abbreviations:["complit","com lit"],name:"Comparative Literature"},cyplan:{abbreviations:["cy plan","cp"],name:"City and Regional Planning"},desinv:{abbreviations:["des inv","design"],name:"Design Innovation"},deveng:{abbreviations:["dev eng"],name:"Development Engineering"},devstd:{abbreviations:["dev std"],name:"Development Studies"},datasci:{abbreviations:["ds","data","data sci"],name:"Data Science"},data:{abbreviations:["ds","data","data sci"],name:"Data Science, Undergraduate"},ealang:{abbreviations:["ea lang"],name:"East Asian Languages and Cultures"},envdes:{abbreviations:["ed","env des"],name:"Environmental Design"},eleng:{abbreviations:["ee","electrical engineering","el eng"],name:"Electrical Engineering"},eecs:{abbreviations:["eecs"],name:"Electrical Engineering and Computer Sciences"},eneres:{abbreviations:["erg","er","ene,res"],name:"Energy and Resources Group"},engin:{abbreviations:["e","engineering"],name:"Engineering"},envsci:{abbreviations:["env sci"],name:"Environmental Sciences"},ethstd:{abbreviations:["eth std"],name:"Ethnic Studies"},geog:{abbreviations:["geology","geo"],name:"Geography"},hinurd:{abbreviations:["hin urd","hin-urd"],name:"Hindi-Urdu"},integbi:{abbreviations:["ib"],name:"Integrative Biology"},indeng:{abbreviations:["ie","ieor","ind eng"],name:"Industrial Engineering and Operations Research"},linguis:{abbreviations:["ling"],name:"Linguistics"},"l&s":{abbreviations:["l & s","ls","lns"],name:"Letters and Science"},indones:{abbreviations:["indonesian"],name:"Indonesian"},matsci:{abbreviations:["mat sci","ms","mse"],name:"Materials Science and Engineering"},meceng:{abbreviations:["mec eng","meche","mech e","me"],name:"Mechanical Engineering"},medst:{abbreviations:["med st"],name:"Medical Studies"},mestu:{abbreviations:["me stu","middle eastern studies"],name:"Middle Eastern Studies"},milaff:{abbreviations:["mil aff"],name:"Military Affairs"},milsci:{abbreviations:["mil sci"],name:"Military Science"},natamst:{abbreviations:["native american studies","nat am st"],name:"Native American Studies"},neurosc:{abbreviations:["neurosci"],name:"Neuroscience"},nuceng:{abbreviations:["ne","nuc eng"],name:"Nuclear Engineering"},mediast:{abbreviations:["media","media st"],name:"Media Studies"},music:{abbreviations:["mus"],name:"Music"},pbhlth:{abbreviations:["pb hlth","ph","pub hlth","public health"],name:"Public Health"},physed:{abbreviations:["pe","phys ed"],name:"Physical Education"},polecon:{abbreviations:["poliecon"],name:"Political Economy"},philo:{abbreviations:["philosophy","philos","phil"],name:"Philosophy"},plantbi:{abbreviations:["pmb"],name:"Plant and Microbial Biology"},polsci:{abbreviations:["poli","pol sci","polisci","poli sci","ps"],name:"Political Science"},pubpol:{abbreviations:["pub pol","pp","public policy"],name:"Public Policy"},pubaff:{abbreviations:["pubaff","public affaris"],name:"Public Affairs"},psych:{abbreviations:["psychology"],name:"Psychology"},rhetor:{abbreviations:["rhetoric"],name:"Rhetoric"},sasian:{abbreviations:["s asian"],name:"South Asian Studies"},seasian:{abbreviations:["se asian"],name:"Southeast Asian Studies"},stat:{abbreviations:["stats"],name:"Statistics"},theater:{abbreviations:["tdps"],name:"Theater, Dance, and Performance Studies"},ugba:{abbreviations:["haas"],name:"Undergraduate Business Administration"},vietnms:{abbreviations:["vietnamese"],name:"Vietnamese"},vissci:{abbreviations:["vis sci"],name:"Vision Science"},visstd:{abbreviations:["vis std"],name:"Visual Studies"}},l2="_root_pw6ka_1",c2="_block_pw6ka_6",w4={root:l2,block:c2};function u2(t){const n=W.useRef({value:t,previous:t});return W.useMemo(()=>(n.current.value!==t&&(n.current.previous=n.current.value,n.current.value=t),n.current.previous),[t])}const IB="Checkbox",[h2,hle]=ay(IB),[d2,f2]=h2(IB),p2=W.forwardRef((t,n)=>{const{__scopeCheckbox:o,name:u,checked:d,defaultChecked:g,required:x,disabled:T,value:s="on",onCheckedChange:I,...O}=t,[D,N]=W.useState(null),j=La(n,q=>N(q)),G=W.useRef(!1),X=D?!!D.closest("form"):!0,[te=!1,H]=D1({prop:d,defaultProp:g,onChange:I}),U=W.useRef(te);return W.useEffect(()=>{const q=D==null?void 0:D.form;if(q){const J=()=>H(U.current);return q.addEventListener("reset",J),()=>q.removeEventListener("reset",J)}},[D,H]),W.createElement(d2,{scope:o,state:te,disabled:T},W.createElement(js.button,bn({type:"button",role:"checkbox","aria-checked":td(te)?"mixed":te,"aria-required":x,"data-state":AB(te),"data-disabled":T?"":void 0,disabled:T,value:s},O,{ref:j,onKeyDown:Ci(t.onKeyDown,q=>{q.key==="Enter"&&q.preventDefault()}),onClick:Ci(t.onClick,q=>{H(J=>td(J)?!0:!J),X&&(G.current=q.isPropagationStopped(),G.current||q.stopPropagation())})})),X&&W.createElement(_2,{control:D,bubbles:!G.current,name:u,value:s,checked:te,required:x,disabled:T,style:{transform:"translateX(-100%)"}}))}),m2="CheckboxIndicator",g2=W.forwardRef((t,n)=>{const{__scopeCheckbox:o,forceMount:u,...d}=t,g=f2(m2,o);return W.createElement(zc,{present:u||td(g.state)||g.state===!0},W.createElement(js.span,bn({"data-state":AB(g.state),"data-disabled":g.disabled?"":void 0},d,{ref:n,style:{pointerEvents:"none",...t.style}})))}),_2=t=>{const{control:n,checked:o,bubbles:u=!0,...d}=t,g=W.useRef(null),x=u2(o),T=FF(n);return W.useEffect(()=>{const s=g.current,I=window.HTMLInputElement.prototype,D=Object.getOwnPropertyDescriptor(I,"checked").set;if(x!==o&&D){const N=new Event("click",{bubbles:u});s.indeterminate=td(o),D.call(s,td(o)?!1:o),s.dispatchEvent(N)}},[x,o,u]),W.createElement("input",bn({type:"checkbox","aria-hidden":!0,defaultChecked:td(o)?!1:o},d,{tabIndex:-1,ref:g,style:{...t.style,...T,position:"absolute",pointerEvents:"none",opacity:0,margin:0}}))};function td(t){return t==="indeterminate"}function AB(t){return td(t)?"indeterminate":t?"checked":"unchecked"}const Fh=p2,Bh=g2,y2="_root_1thqt_1",v2="_block_1thqt_10",x2="_overlay_1thqt_16",b2="_label_1thqt_22",w2="_row_1thqt_31",E2="_description_1thqt_39",S2="_checkbox_1thqt_45",vi={root:y2,block:v2,overlay:x2,label:b2,row:w2,description:E2,checkbox:S2};function T2({overlay:t,block:n}){return Y.jsxs("div",{className:xi(vi.root,{[vi.overlay]:t,[vi.block]:n}),children:[Y.jsx("p",{className:vi.label,children:"Units"}),Y.jsxs("div",{className:vi.row,children:[Y.jsx(Fh,{className:vi.checkbox,defaultChecked:!0,id:"c1",children:Y.jsx(Bh,{asChild:!0,children:Y.jsx(Nh,{width:12,height:12})})}),Y.jsx("label",{className:vi.description,htmlFor:"c1",children:"4 units"})]}),Y.jsxs("div",{className:vi.row,children:[Y.jsx(Fh,{className:vi.checkbox,defaultChecked:!0,id:"c1",children:Y.jsx(Bh,{asChild:!0,children:Y.jsx(Nh,{width:12,height:12})})}),Y.jsx("label",{className:vi.description,htmlFor:"c1",children:"3 units"})]}),Y.jsxs("div",{className:vi.row,children:[Y.jsx(Fh,{className:vi.checkbox,defaultChecked:!0,id:"c1",children:Y.jsx(Bh,{asChild:!0,children:Y.jsx(Nh,{width:12,height:12})})}),Y.jsx("label",{className:vi.description,htmlFor:"c1",children:"2 units"})]}),Y.jsxs("div",{className:vi.row,children:[Y.jsx(Fh,{className:vi.checkbox,defaultChecked:!0,id:"c1",children:Y.jsx(Bh,{asChild:!0,children:Y.jsx(Nh,{width:12,height:12})})}),Y.jsx("label",{className:vi.description,htmlFor:"c1",children:"1 unit"})]}),Y.jsx("p",{className:vi.label,children:"Level"}),Y.jsxs("div",{className:vi.row,children:[Y.jsx(Fh,{className:vi.checkbox,defaultChecked:!0,id:"c1",children:Y.jsx(Bh,{asChild:!0,children:Y.jsx(Nh,{width:12,height:12})})}),Y.jsx("label",{className:vi.description,htmlFor:"c1",children:"Lower division"})]}),Y.jsxs("div",{className:vi.row,children:[Y.jsx(Fh,{className:vi.checkbox,defaultChecked:!0,id:"c1",children:Y.jsx(Bh,{asChild:!0,children:Y.jsx(Nh,{width:12,height:12})})}),Y.jsx("label",{className:vi.description,htmlFor:"c1",children:"Upper division"})]}),Y.jsxs("div",{className:vi.row,children:[Y.jsx(Fh,{className:vi.checkbox,defaultChecked:!0,id:"c1",children:Y.jsx(Bh,{asChild:!0,children:Y.jsx(Nh,{width:12,height:12})})}),Y.jsx("label",{className:vi.description,htmlFor:"c1",children:"Graduate"})]})]})}function gf(t,n,o){let u=o.initialDeps??[],d;return()=>{var g,x,T,s;let I;o.key&&((g=o.debug)!=null&&g.call(o))&&(I=Date.now());const O=t();if(!(O.length!==u.length||O.some((j,G)=>u[G]!==j)))return d;u=O;let N;if(o.key&&((x=o.debug)!=null&&x.call(o))&&(N=Date.now()),d=n(...O),o.key&&((T=o.debug)!=null&&T.call(o))){const j=Math.round((Date.now()-I)*100)/100,G=Math.round((Date.now()-N)*100)/100,X=G/16,te=(H,U)=>{for(H=String(H);H.length<U;)H=" "+H;return H};console.info(`%c⏱ ${te(G,5)} /${te(j,5)} ms`,`
            font-size: .6rem;
            font-weight: bold;
            color: hsl(${Math.max(0,Math.min(120-120*X,120))}deg 100% 31%);`,o==null?void 0:o.key)}return(s=o==null?void 0:o.onChange)==null||s.call(o,d),d}}function AS(t,n){if(t===void 0)throw new Error(`Unexpected undefined${n?`: ${n}`:""}`);return t}const C2=(t,n)=>Math.abs(t-n)<1,M2=t=>t,I2=t=>{const n=Math.max(t.startIndex-t.overscan,0),o=Math.min(t.endIndex+t.overscan,t.count-1),u=[];for(let d=n;d<=o;d++)u.push(d);return u},A2=(t,n)=>{const o=t.scrollElement;if(!o)return;const u=g=>{const{width:x,height:T}=g;n({width:Math.round(x),height:Math.round(T)})};if(u(o.getBoundingClientRect()),typeof ResizeObserver>"u")return()=>{};const d=new ResizeObserver(g=>{const x=g[0];if(x!=null&&x.borderBoxSize){const T=x.borderBoxSize[0];if(T){u({width:T.inlineSize,height:T.blockSize});return}}u(o.getBoundingClientRect())});return d.observe(o,{box:"border-box"}),()=>{d.unobserve(o)}},k2=(t,n)=>{const o=t.scrollElement;if(!o)return;const u=()=>{n(o[t.options.horizontal?"scrollLeft":"scrollTop"])};return u(),o.addEventListener("scroll",u,{passive:!0}),()=>{o.removeEventListener("scroll",u)}},P2=(t,n,o)=>{if(n!=null&&n.borderBoxSize){const u=n.borderBoxSize[0];if(u)return Math.round(u[o.options.horizontal?"inlineSize":"blockSize"])}return Math.round(t.getBoundingClientRect()[o.options.horizontal?"width":"height"])},O2=(t,{adjustments:n=0,behavior:o},u)=>{var d,g;const x=t+n;(g=(d=u.scrollElement)==null?void 0:d.scrollTo)==null||g.call(d,{[u.options.horizontal?"left":"top"]:x,behavior:o})};class D2{constructor(n){this.unsubs=[],this.scrollElement=null,this.isScrolling=!1,this.isScrollingTimeoutId=null,this.scrollToIndexTimeoutId=null,this.measurementsCache=[],this.itemSizeCache=new Map,this.pendingMeasuredCacheIndexes=[],this.scrollDirection=null,this.scrollAdjustments=0,this.measureElementCache=new Map,this.observer=(()=>{let o=null;const u=()=>o||(typeof ResizeObserver<"u"?o=new ResizeObserver(d=>{d.forEach(g=>{this._measureElement(g.target,g)})}):null);return{disconnect:()=>{var d;return(d=u())==null?void 0:d.disconnect()},observe:d=>{var g;return(g=u())==null?void 0:g.observe(d,{box:"border-box"})},unobserve:d=>{var g;return(g=u())==null?void 0:g.unobserve(d)}}})(),this.range=null,this.setOptions=o=>{Object.entries(o).forEach(([u,d])=>{typeof d>"u"&&delete o[u]}),this.options={debug:!1,initialOffset:0,overscan:1,paddingStart:0,paddingEnd:0,scrollPaddingStart:0,scrollPaddingEnd:0,horizontal:!1,getItemKey:M2,rangeExtractor:I2,onChange:()=>{},measureElement:P2,initialRect:{width:0,height:0},scrollMargin:0,scrollingDelay:150,indexAttribute:"data-index",initialMeasurementsCache:[],lanes:1,...o}},this.notify=o=>{var u,d;(d=(u=this.options).onChange)==null||d.call(u,this,o)},this.maybeNotify=gf(()=>(this.calculateRange(),[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]),o=>{this.notify(o)},{key:!1,debug:()=>this.options.debug,initialDeps:[this.isScrolling,this.range?this.range.startIndex:null,this.range?this.range.endIndex:null]}),this.cleanup=()=>{this.unsubs.filter(Boolean).forEach(o=>o()),this.unsubs=[],this.scrollElement=null},this._didMount=()=>(this.measureElementCache.forEach(this.observer.observe),()=>{this.observer.disconnect(),this.cleanup()}),this._willUpdate=()=>{const o=this.options.getScrollElement();this.scrollElement!==o&&(this.cleanup(),this.scrollElement=o,this._scrollToOffset(this.scrollOffset,{adjustments:void 0,behavior:void 0}),this.unsubs.push(this.options.observeElementRect(this,u=>{this.scrollRect=u,this.maybeNotify()})),this.unsubs.push(this.options.observeElementOffset(this,u=>{this.scrollAdjustments=0,this.scrollOffset!==u&&(this.isScrollingTimeoutId!==null&&(clearTimeout(this.isScrollingTimeoutId),this.isScrollingTimeoutId=null),this.isScrolling=!0,this.scrollDirection=this.scrollOffset<u?"forward":"backward",this.scrollOffset=u,this.maybeNotify(),this.isScrollingTimeoutId=setTimeout(()=>{this.isScrollingTimeoutId=null,this.isScrolling=!1,this.scrollDirection=null,this.maybeNotify()},this.options.scrollingDelay))})))},this.getSize=()=>this.scrollRect[this.options.horizontal?"width":"height"],this.memoOptions=gf(()=>[this.options.count,this.options.paddingStart,this.options.scrollMargin,this.options.getItemKey],(o,u,d,g)=>(this.pendingMeasuredCacheIndexes=[],{count:o,paddingStart:u,scrollMargin:d,getItemKey:g}),{key:!1}),this.getFurthestMeasurement=(o,u)=>{const d=new Map,g=new Map;for(let x=u-1;x>=0;x--){const T=o[x];if(d.has(T.lane))continue;const s=g.get(T.lane);if(s==null||T.end>s.end?g.set(T.lane,T):T.end<s.end&&d.set(T.lane,!0),d.size===this.options.lanes)break}return g.size===this.options.lanes?Array.from(g.values()).sort((x,T)=>x.end===T.end?x.index-T.index:x.end-T.end)[0]:void 0},this.getMeasurements=gf(()=>[this.memoOptions(),this.itemSizeCache],({count:o,paddingStart:u,scrollMargin:d,getItemKey:g},x)=>{const T=this.pendingMeasuredCacheIndexes.length>0?Math.min(...this.pendingMeasuredCacheIndexes):0;this.pendingMeasuredCacheIndexes=[];const s=this.measurementsCache.slice(0,T);for(let I=T;I<o;I++){const O=g(I),D=this.options.lanes===1?s[I-1]:this.getFurthestMeasurement(s,I),N=D?D.end:u+d,j=x.get(O),G=typeof j=="number"?j:this.options.estimateSize(I),X=N+G,te=D?D.lane:I%this.options.lanes;s[I]={index:I,start:N,size:G,end:X,key:O,lane:te}}return this.measurementsCache=s,s},{key:!1,debug:()=>this.options.debug}),this.calculateRange=gf(()=>[this.getMeasurements(),this.getSize(),this.scrollOffset],(o,u,d)=>this.range=o.length>0&&u>0?R2({measurements:o,outerSize:u,scrollOffset:d}):null,{key:!1,debug:()=>this.options.debug}),this.getIndexes=gf(()=>[this.options.rangeExtractor,this.calculateRange(),this.options.overscan,this.options.count],(o,u,d,g)=>u===null?[]:o({...u,overscan:d,count:g}),{key:!1,debug:()=>this.options.debug}),this.indexFromElement=o=>{const u=this.options.indexAttribute,d=o.getAttribute(u);return d?parseInt(d,10):(console.warn(`Missing attribute name '${u}={index}' on measured element.`),-1)},this._measureElement=(o,u)=>{const d=this.measurementsCache[this.indexFromElement(o)];if(!d||!o.isConnected){this.measureElementCache.forEach((T,s)=>{T===o&&(this.observer.unobserve(o),this.measureElementCache.delete(s))});return}const g=this.measureElementCache.get(d.key);g!==o&&(g&&this.observer.unobserve(g),this.observer.observe(o),this.measureElementCache.set(d.key,o));const x=this.options.measureElement(o,u,this);this.resizeItem(d,x)},this.resizeItem=(o,u)=>{const d=this.itemSizeCache.get(o.key)??o.size,g=u-d;g!==0&&(o.start<this.scrollOffset+this.scrollAdjustments&&this._scrollToOffset(this.scrollOffset,{adjustments:this.scrollAdjustments+=g,behavior:void 0}),this.pendingMeasuredCacheIndexes.push(o.index),this.itemSizeCache=new Map(this.itemSizeCache.set(o.key,u)),this.notify(!1))},this.measureElement=o=>{o&&this._measureElement(o,void 0)},this.getVirtualItems=gf(()=>[this.getIndexes(),this.getMeasurements()],(o,u)=>{const d=[];for(let g=0,x=o.length;g<x;g++){const T=o[g],s=u[T];d.push(s)}return d},{key:!1,debug:()=>this.options.debug}),this.getVirtualItemForOffset=o=>{const u=this.getMeasurements();return AS(u[kB(0,u.length-1,d=>AS(u[d]).start,o)])},this.getOffsetForAlignment=(o,u)=>{const d=this.getSize();u==="auto"&&(o<=this.scrollOffset?u="start":o>=this.scrollOffset+d?u="end":u="start"),u==="start"?o=o:u==="end"?o=o-d:u==="center"&&(o=o-d/2);const g=this.options.horizontal?"scrollWidth":"scrollHeight",T=(this.scrollElement?"document"in this.scrollElement?this.scrollElement.document.documentElement[g]:this.scrollElement[g]:0)-this.getSize();return Math.max(Math.min(T,o),0)},this.getOffsetForIndex=(o,u="auto")=>{o=Math.max(0,Math.min(o,this.options.count-1));const d=AS(this.getMeasurements()[o]);if(u==="auto")if(d.end>=this.scrollOffset+this.getSize()-this.options.scrollPaddingEnd)u="end";else if(d.start<=this.scrollOffset+this.options.scrollPaddingStart)u="start";else return[this.scrollOffset,u];const g=u==="end"?d.end+this.options.scrollPaddingEnd:d.start-this.options.scrollPaddingStart;return[this.getOffsetForAlignment(g,u),u]},this.isDynamicMode=()=>this.measureElementCache.size>0,this.cancelScrollToIndex=()=>{this.scrollToIndexTimeoutId!==null&&(clearTimeout(this.scrollToIndexTimeoutId),this.scrollToIndexTimeoutId=null)},this.scrollToOffset=(o,{align:u="start",behavior:d}={})=>{this.cancelScrollToIndex(),d==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.getOffsetForAlignment(o,u),{adjustments:void 0,behavior:d})},this.scrollToIndex=(o,{align:u="auto",behavior:d}={})=>{o=Math.max(0,Math.min(o,this.options.count-1)),this.cancelScrollToIndex(),d==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size.");const[g,x]=this.getOffsetForIndex(o,u);this._scrollToOffset(g,{adjustments:void 0,behavior:d}),d!=="smooth"&&this.isDynamicMode()&&(this.scrollToIndexTimeoutId=setTimeout(()=>{if(this.scrollToIndexTimeoutId=null,this.measureElementCache.has(this.options.getItemKey(o))){const[s]=this.getOffsetForIndex(o,x);C2(s,this.scrollOffset)||this.scrollToIndex(o,{align:x,behavior:d})}else this.scrollToIndex(o,{align:x,behavior:d})}))},this.scrollBy=(o,{behavior:u}={})=>{this.cancelScrollToIndex(),u==="smooth"&&this.isDynamicMode()&&console.warn("The `smooth` scroll behavior is not fully supported with dynamic size."),this._scrollToOffset(this.scrollOffset+o,{adjustments:void 0,behavior:u})},this.getTotalSize=()=>{var o;const u=this.getMeasurements();let d;return u.length===0?d=this.options.paddingStart:d=this.options.lanes===1?((o=u[u.length-1])==null?void 0:o.end)??0:Math.max(...u.slice(-this.options.lanes).map(g=>g.end)),d-this.options.scrollMargin+this.options.paddingEnd},this._scrollToOffset=(o,{adjustments:u,behavior:d})=>{this.options.scrollToFn(o,{behavior:d,adjustments:u},this)},this.measure=()=>{this.itemSizeCache=new Map,this.notify(!1)},this.setOptions(n),this.scrollRect=this.options.initialRect,this.scrollOffset=this.options.initialOffset,this.measurementsCache=this.options.initialMeasurementsCache,this.measurementsCache.forEach(o=>{this.itemSizeCache.set(o.key,o.size)}),this.maybeNotify()}}const kB=(t,n,o,u)=>{for(;t<=n;){const d=(t+n)/2|0,g=o(d);if(g<u)t=d+1;else if(g>u)n=d-1;else return d}return t>0?t-1:0};function R2({measurements:t,outerSize:n,scrollOffset:o}){const u=t.length-1,g=kB(0,u,T=>t[T].start,o);let x=g;for(;x<u&&t[x].end<o+n;)x++;return{startIndex:g,endIndex:x}}const L2=typeof document<"u"?W.useLayoutEffect:W.useEffect;function z2(t){const n=W.useReducer(()=>({}),{})[1],o={...t,onChange:(d,g)=>{var x;g?gd.flushSync(n):n(),(x=t.onChange)==null||x.call(t,d,g)}},[u]=W.useState(()=>new D2(o));return u.setOptions(o),W.useEffect(()=>u._didMount(),[]),L2(()=>u._willUpdate()),u}function N2(t){return z2({observeElementRect:A2,observeElementOffset:k2,scrollToFn:O2,...t})}const F2="_root_194sf_1",B2="_invert_194sf_22",kS={root:F2,invert:B2};function os({active:t,children:n,className:o,invert:u,as:d,...g}){const x=d??"button";return Y.jsx(x,{className:xi(kS.root,{[kS.active]:t,[kS.invert]:u},o),...g,children:n})}const j2="_trigger_1d3r8_1",$2="_content_1d3r8_7",U2="_fadeIn_1d3r8_1",V2="_arrow_1d3r8_17",G2="_title_1d3r8_20",q2="_description_1d3r8_26",_f={trigger:j2,content:$2,fadeIn:U2,arrow:V2,title:G2,description:q2};function _y({gradeAverage:t}){const n=W.useMemo(()=>t?t>4?"A+":t>3.7?"A":t>3.5?"A-":t>3?"B+":t>2.7?"B":t>2.5?"B-":t>2?"C+":t>1.7?"C":t>1.5?"C-":t>1?"D+":t>.7?"D":t?"D-":"F":"N/A",[t]),o=W.useMemo(()=>t?t>3.5?"var(--green-500)":t>2.5?"var(--yellow-500)":"var(--red-500)":"var(--paragraph-color)",[t]);return Y.jsxs(uy,{disableHoverableContent:!0,children:[Y.jsx(hy,{asChild:!0,children:Y.jsx("div",{className:_f.trigger,style:{color:o},children:n})}),Y.jsx(dy,{children:Y.jsx(fy,{asChild:!0,side:"bottom",sideOffset:8,collisionPadding:8,children:Y.jsxs("div",{className:_f.content,children:[Y.jsx(py,{className:_f.arrow}),Y.jsx("p",{className:_f.title,children:"Average grade"}),t?Y.jsxs("p",{className:_f.description,children:["Students have received"," ",["A","F"].includes(n[0])?"an ":"a ",Y.jsxs("span",{style:{color:o},children:[n," (",t.toLocaleString(),")"]})," ","in this course on average based on performance across all semesters this course has been offered."]}):Y.jsx("p",{className:_f.description,children:"Either this course has not been previously offered, or the average grade is not available."})]})})})]})}const W2="_trigger_i1h7t_1",H2="_text_i1h7t_12",Z2="_value_i1h7t_16",X2="_content_i1h7t_20",Y2="_fadeIn_i1h7t_1",Q2="_arrow_i1h7t_28",K2="_divider_i1h7t_31",J2="_row_i1h7t_36",eee="_key_i1h7t_43",Al={trigger:W2,text:H2,value:Z2,content:X2,fadeIn:Y2,arrow:Q2,divider:K2,row:J2,key:eee},E4=(t,n)=>{const o=t/n;return o>=.75?"var(--red-500)":o>.5?"var(--yellow-500)":"var(--green-500)"};function H_({enrollCount:t,enrollMax:n,waitlistCount:o,waitlistMax:u}){const d=W.useMemo(()=>E4(t,n),[t,n]),g=W.useMemo(()=>E4(o,u),[o,u]);return Y.jsxs(uy,{disableHoverableContent:!0,children:[Y.jsx(hy,{asChild:!0,children:Y.jsxs("div",{className:Al.trigger,children:[Y.jsx(JF,{}),Y.jsxs("p",{className:Al.text,children:[Y.jsx("span",{style:{color:d},children:t.toLocaleString()})," / ",n.toLocaleString()]})]})}),Y.jsx(dy,{children:Y.jsx(fy,{asChild:!0,side:"bottom",sideOffset:8,collisionPadding:8,children:Y.jsxs("div",{className:Al.content,children:[Y.jsx(py,{className:Al.arrow}),Y.jsxs("div",{className:Al.row,children:[Y.jsx("p",{className:Al.key,children:"Enrolled"}),Y.jsxs("p",{children:[Y.jsx("span",{style:{color:d},children:t.toLocaleString()})," / ",Y.jsx("span",{className:Al.value,children:n.toLocaleString()})," (",Y.jsxs("span",{style:{color:d},children:[n===0?0:Math.round(t/n*100).toLocaleString(),"%"]}),")"]})]}),Y.jsx("div",{className:Al.divider}),Y.jsxs("div",{className:Al.row,children:[Y.jsx("p",{className:Al.key,children:"Waitlisted"}),Y.jsxs("p",{children:[Y.jsx("span",{style:{color:g},children:o.toLocaleString()})," / ",u.toLocaleString()," (",Y.jsxs("span",{style:{color:g},children:[u===0?0:Math.round(o/u*100).toLocaleString(),"%"]}),")"]})]})]})})})]})}const tee="_root_jtiom_1",ree={root:tee};function dd({unitsMin:t,unitsMax:n}){const o=W.useMemo(()=>n===t?`${t} ${t===1?"unit":"units"}`:`${t} - ${n} units`,[n,t]);return Y.jsx("p",{className:ree.root,children:o})}const Z_={Discussion:{name:"Discussion",plural:"Discussions",shorthand:"dis"},Lecture:{name:"Lecture",plural:"Lectures",shorthand:"lec"},Laboratory:{name:"Lab",plural:"Labs",shorthand:"lab"},Seminar:{name:"Seminar",plural:"Seminars",shorthand:"sem"},"Independent Study":{name:"Independent Study",plural:"Independent Studies",shorthand:"ind"},"Directed Group Study":{name:"Directed Group Study",plural:"Directed Group Studies",shorthand:"grp"},"Field Work":{name:"Field Work",plural:"Field Works",shorthand:"fld"}},PB=(t,n,o,u,d,g)=>{var x;return g=((x=Z_[g])==null?void 0:x.shorthand)||g.toLowerCase(),`https://classes.berkeley.edu/content/${t}-${n.toLowerCase()}-${o.toLowerCase()}-${u}-${d}-${g}-${d}`},nee="_root_uxgpw_1",iee="_course_uxgpw_4",oee="_column_uxgpw_20",see="_icon_uxgpw_20",aee="_text_uxgpw_36",lee="_heading_uxgpw_40",cee="_title_uxgpw_40",uee="_description_uxgpw_51",hee="_row_uxgpw_55",rs={root:nee,course:iee,class:"_class_uxgpw_13",column:oee,icon:see,text:aee,heading:lee,title:cee,description:uee,row:hee},dee=W.forwardRef(({title:t,subject:n,classes:o,number:u,gradeAverage:d,expanded:g,setExpanded:x,onClassSelect:T,index:s},I)=>{const O=W.useMemo(()=>o.length===1,[o]),{courseCount:D,courseCapacity:N,courseWaitlistCount:j,courseWaitlistCapacity:G,courseMinimum:X,courseMaximum:te}=W.useMemo(()=>o.reduce(({courseCount:U,courseCapacity:q,courseWaitlistCount:J,courseWaitlistCapacity:pe,courseMinimum:ue,courseMaximum:Me},{waitlistCount:Se,waitlistMax:ge,enrollCount:se,enrollMax:Ie,unitsMax:We,unitsMin:ze})=>({courseWaitlistCount:J+Se,courseWaitlistCapacity:pe+ge,courseCount:U+se,courseCapacity:q+Ie,courseMinimum:Math.min(ue,ze),courseMaximum:Math.max(Me,We)}),{courseCount:0,courseCapacity:0,courseWaitlistCount:0,courseWaitlistCapacity:0,courseMinimum:10,courseMaximum:0}),[o]),H=U=>{U?T(U):O?T(o[0].number):x(!g)};return Y.jsx("div",{className:rs.root,ref:I,"data-index":s,children:Y.jsxs("div",{className:rs.course,children:[Y.jsxs("div",{className:rs.class,onClick:()=>H(),children:[Y.jsxs("div",{className:rs.text,children:[Y.jsxs("p",{className:rs.heading,children:[n," ",u]}),Y.jsx("p",{className:rs.description,children:O&&o[0].title?o[0].title:t}),Y.jsxs("div",{className:rs.row,children:[Y.jsx(_y,{gradeAverage:d}),Y.jsx(H_,{enrollCount:D,enrollMax:N,waitlistCount:j,waitlistMax:G}),Y.jsx(dd,{unitsMin:X,unitsMax:te})]})]}),Y.jsx("div",{className:rs.column,children:Y.jsx("div",{className:rs.icon,children:O?Y.jsx(Rl,{}):g?Y.jsx(YF,{}):Y.jsx(fI,{})})})]}),g&&o.map(({unitsMax:U,unitsMin:q,enrollCount:J,enrollMax:pe,waitlistCount:ue,waitlistMax:Me,title:Se,number:ge,primarySection:{kind:se}})=>{var Ie;return Y.jsxs("div",{className:rs.class,onClick:()=>H(ge),children:[Y.jsxs("div",{className:rs.text,children:[Y.jsxs("p",{className:rs.title,children:[((Ie=Z_[se])==null?void 0:Ie.name)??se," ",ge]}),Y.jsx("p",{className:rs.description,children:Se||t}),Y.jsxs("div",{className:rs.row,children:[Y.jsx(H_,{enrollCount:J,enrollMax:pe,waitlistCount:ue,waitlistMax:Me}),Y.jsx(dd,{unitsMin:q,unitsMax:U})]})]}),Y.jsx("div",{className:rs.column,children:Y.jsx("div",{className:rs.icon,children:Y.jsx(Rl,{})})})]},ge)})]})})}),fee="_root_lwm1b_1",pee="_block_lwm1b_8",mee="_overlay_lwm1b_14",gee="_view_lwm1b_14",_ee="_header_lwm1b_14",yee="_form_lwm1b_14",vee="_body_lwm1b_24",xee="_placeholder_lwm1b_31",bee="_heading_lwm1b_43",wee="_description_lwm1b_48",Eee="_footer_lwm1b_51",See="_button_lwm1b_66",Tee="_text_lwm1b_79",Cee="_input_lwm1b_106",Mee="_label_lwm1b_109",ns={root:fee,block:pee,overlay:mee,view:gee,header:_ee,form:yee,body:vee,placeholder:xee,heading:bee,description:wee,footer:Eee,button:See,text:Tee,input:Cee,label:Mee};function Iee({currentCourses:t,onClassSelect:n,currentSemester:o,currentYear:u,open:d,overlay:g,block:x,setOpen:T,currentQuery:s,expandedCourses:I,setExpanded:O}){var U;const D=W.useRef(null),[N,j]=Ip(),G=N2({count:t.length,getScrollElement:()=>D.current,estimateSize:()=>136,paddingStart:72,paddingEnd:60}),X=q=>{var J;q?N.set("query",q):N.delete("query"),j(N),(J=D.current)==null||J.scrollTo({top:0})},te=G.getVirtualItems(),H=G.getTotalSize();return Y.jsx("div",{className:xi(ns.root,{[ns.block]:x,[ns.overlay]:g}),ref:D,children:Y.jsxs("div",{className:ns.view,style:{height:H},children:[Y.jsx("div",{className:ns.header,children:Y.jsxs("div",{className:ns.form,children:[Y.jsx("input",{className:ns.input,type:"text",autoFocus:!0,value:s,onChange:q=>X(q.target.value),placeholder:`Search ${o} ${u} courses...`}),Y.jsx("div",{className:ns.label,children:t.length.toLocaleString()}),g&&Y.jsx(os,{onClick:()=>T(!d),children:d?Y.jsx(BQ,{}):Y.jsx(RX,{})})]})}),te.length===0?Y.jsxs("div",{className:ns.placeholder,children:[Y.jsx(QF,{width:32,height:32}),Y.jsxs("div",{className:ns.text,children:[Y.jsx("p",{className:ns.heading,children:"No courses found"}),Y.jsx("p",{className:ns.description,children:"Find more courses by broadening your search or entering a different query."})]})]}):Y.jsx("div",{className:ns.body,style:{transform:`translateY(${((U=te[0])==null?void 0:U.start)??0}px)`},children:te.map(({key:q,index:J})=>{const pe=t[J];return W.createElement(dee,{...pe,index:J,key:q,ref:G.measureElement,expanded:I[J],setExpanded:ue=>O(J,ue),onClassSelect:ue=>n(pe,ue)})})}),Y.jsx("div",{className:ns.footer,children:Y.jsxs(So,{to:"/explore",className:ns.button,children:[Y.jsx(eQ,{}),Y.jsx("p",{className:ns.text,children:"Try exploring courses"}),Y.jsx(Rl,{})]})})]})})}const Aee=t=>{const n=t.map(u=>{var N;const{title:d,subject:g,number:x,classes:T}=u,s=/^[a-zA-Z].*/.test(x),I=x.slice(1),O=g.toLowerCase(),D=(N=a2[O])==null?void 0:N.abbreviations.reduce((j,G)=>{const X=[`${G}${x}`,`${G} ${x}`];return s&&X.push(`${G}${I}`,`${G} ${I}`),[...j,...X]},s?[`${g}${x}`,`${g} ${I}`,`${g}${I}`]:[`${g}${x}`]);return{title:d,subject:g,number:x,name:`${g} ${x}`,alternateNames:D,classes:T}}),o={includeScore:!0,findAllMatches:!0,threshold:.25,keys:[{name:"number",weight:1.2},"name","title","classes.title",{name:"alternateNames",weight:2},{name:"subject",weight:1.5}],sortFn:(u,d)=>u.score-d.score?u.score-d.score:u.item[0].v.toLowerCase().localeCompare(d.item[0].v.toLowerCase())};return new Ap(n,o)};function EI({courses:t,onClassSelect:n,responsive:o=!0,currentSemester:u,currentYear:d}){const[g,x]=W.useState(!1),[T]=Ip(),[s,I]=W.useState([]),[O,D]=W.useState([]),{width:N}=wI(),j=W.useMemo(()=>Aee(t),[t]),G=W.useMemo(()=>T.get("query")??"",[T]),X=(U,q)=>{D(J=>{const pe=structuredClone(J);return pe[U]=q,pe})};W.useEffect(()=>{const U=G?j.search(G).map(({refIndex:q})=>t[q]):t;I(U),D(new Array(U.length).fill(!1))},[G,j,t]);const te=W.useMemo(()=>N<=992,[N]),H=W.useMemo(()=>o&&N<=1400||te,[N,o,te]);return Y.jsxs("div",{className:xi(w4.root,{[w4.block]:te}),children:[(g||!H)&&Y.jsx(T2,{overlay:H,block:te}),Y.jsx(Iee,{currentCourses:s,onClassSelect:n,setOpen:x,currentSemester:u,expandedCourses:O,setExpanded:X,currentQuery:G,currentYear:d,open:g,overlay:H,block:te})]})}const kee="_root_j3nw4_9",Pee="_spin_j3nw4_1",Oee={root:kee,spin:Pee};function SI({size:t=32}){return Y.jsx("div",{className:Oee.root,style:{width:`${t}px`}})}var Io=(t=>(t.Fall="Fall",t.Spring="Spring",t.Summer="Summer",t))(Io||{});const Dee=Sc`
  query GetCourse($subject: String!, $courseNumber: String!) {
    course(subject: $subject, courseNumber: $courseNumber) {
      title
      classes {
        year
        semester
        number
        unitsMax
        unitsMin
      }
      level
      description
      gradeAverage
      gradingBasis
      subjectName
      subject
      prereqs
      number
    }
  }
`,OB=Sc`
  query GetClass(
    $term: TermInput!
    $subject: String!
    $courseNumber: String!
    $classNumber: String!
  ) {
    class(
      term: $term
      subject: $subject
      courseNumber: $courseNumber
      classNumber: $classNumber
    ) {
      title
      description
      enrollCount
      enrollMax
      unitsMax
      unitsMin
      waitlistCount
      waitlistMax
      number
      course {
        title
        description
        gradeAverage
        gradingBasis
        subject
        subjectName
        level
        prereqs
        number
        classes {
          year
          semester
          number
        }
      }
      primarySection {
        course {
          subject
          number
        }
        ccn
        dateEnd
        dateStart
        days
        enrollCount
        enrollMax
        instructors {
          familyName
          givenName
        }
        kind
        location
        notes
        primary
        timeEnd
        timeStart
        waitlistCount
        waitlistMax
        number
      }
      sections {
        course {
          subject
          number
        }
        ccn
        dateEnd
        dateStart
        days
        enrollCount
        enrollMax
        instructors {
          familyName
          givenName
        }
        kind
        location
        notes
        primary
        timeEnd
        timeStart
        waitlistCount
        waitlistMax
        number
      }
    }
  }
`,TI=Sc`
  query GetCourses($term: TermInput!) {
    catalog(term: $term) {
      subject
      number
      title
      gradeAverage
      classes {
        number
        title
        enrollCount
        enrollMax
        waitlistCount
        waitlistMax
        unitsMax
        unitsMin
        primarySection {
          kind
        }
      }
    }
  }
`,Ree=Sc`
  query GetAccount {
    user {
      email
    }
  }
`,Lee="_root_1g82n_1",zee={root:Lee},Nee="_root_15pop_1",Fee="_secondary_15pop_23",PS={root:Nee,secondary:Fee},al=W.forwardRef(({active:t,children:n,className:o,secondary:u,as:d,...g},x)=>{const T=d??"button";return Y.jsx(T,{ref:x,className:xi(PS.root,{[PS.active]:t,[PS.secondary]:u},o),...g,children:n})});al.displayName="Button";const Bee="_trigger_6w39n_1",jee="_content_6w39n_12",$ee="_fadeIn_6w39n_1",Uee="_arrow_6w39n_22",Vee="_title_6w39n_25",Gee="_description_6w39n_31",vg={trigger:Bee,content:jee,fadeIn:$ee,arrow:Uee,title:Vee,description:Gee};function CI({ccn:t,tooltip:n}){const o=W.useRef(null),[u,d]=W.useState(!1),[g,x]=W.useState(!1),[T,s]=W.useState(null),I=O=>{if(O.stopPropagation(),!o.current)return;T&&clearTimeout(T);const D=window.getSelection(),N=document.createRange();N.selectNodeContents(o.current),D==null||D.removeAllRanges(),D==null||D.addRange(N),navigator.clipboard.writeText(t),x(!0);const j=setTimeout(()=>x(!1),1e3);s(j)};return Y.jsxs(uy,{disableHoverableContent:!0,open:n,children:[Y.jsx(hy,{asChild:!0,children:Y.jsxs("div",{className:vg.trigger,onClick:I,onMouseOver:()=>d(!0),onMouseOut:()=>d(!1),children:[g?Y.jsx(uX,{}):u?Y.jsx(NY,{}):Y.jsx(QX,{}),Y.jsx("span",{ref:o,children:t})]})}),Y.jsx(dy,{children:Y.jsx(fy,{asChild:!0,side:"bottom",sideOffset:8,collisionPadding:8,children:Y.jsxs("div",{className:vg.content,children:[Y.jsx(py,{className:vg.arrow}),Y.jsx("p",{className:vg.title,children:"Class number"}),Y.jsx("p",{className:vg.description,children:"Use this number to search for and enroll in this class within the CalCentral Enrollment Center."})]})})})]})}const qee="_root_1emir_1",Wee={root:qee},Iu=W.forwardRef(({active:t,children:n,className:o,as:u,...d},g)=>{const x=u??"button";return Y.jsx(x,{ref:g,...d,className:xi(Wee.root,{active:t},o),children:n})});Iu.displayName="MenuItem";const Hee="_content_1odd5_1",Zee="_root_1odd5_7",Xee="_header_1odd5_21",Yee="_row_1odd5_25",Qee="_group_1odd5_30",Kee="_heading_1odd5_35",Jee="_description_1odd5_42",ete="_menu_1odd5_48",pc={content:Hee,root:Zee,header:Xee,row:Yee,group:Qee,heading:Kee,description:Jee,menu:ete},DB={"Berkeley Way West":{location:[-122.26840181226721,37.87341082732256],name:"Berkeley Way West",link:"https://maps.app.goo.gl/zNbknDXSgV5471ZWA"},Latimer:{location:[-122.25599531409944,37.87312578450188],name:"Latimer Hall",link:"https://maps.app.goo.gl/4GuSAkkBckU87vTV8"},Dwinelle:{location:[-122.26060684824738,37.87056638999202],name:"Dwinelle Hall",link:"https://maps.app.goo.gl/f42kYmyfuqUQ4Urv7"},Giannini:{location:[-122.26229667155725,37.87354568917771],name:"Giannini Hall",link:"https://maps.app.goo.gl/XFQpN8hsnr8XzvYz7"},"Moffitt Library":{location:[-122.26083662991704,37.872543936658765],name:"Moffitt Library",link:"https://maps.app.goo.gl/NGAetKPTgYRrwJecA"},Evans:{location:[-122.25759413529791,37.873621559931614],name:"Evans Hall",link:"https://maps.app.goo.gl/XdwKVCKwo5eV7qsu6"},"Genetics & Plant Bio":{location:[-122.26474920629475,37.873442572098185],name:"Genetics and Plant Biology Building",link:"https://maps.app.goo.gl/MJEptPwUVCpQr2rk7"},"Hearst Mining":{location:[-122.2571920861028,37.87416437917678],name:"Hearst Memorial Mining Building",link:"https://maps.app.goo.gl/265AgZFbA1KEZL7i8"},"Valley Life Sciences":{location:[-122.26220645353504,37.87142462552724],name:"Valley Life Sciences Building",link:"https://maps.app.goo.gl/gAUL3doGGsB2fqxA7"},"Off Campus":{name:"Off campus"},Hildebrand:{location:[-122.25534011894594,37.872593339541446],name:"Hildebrand Hall",link:"https://maps.app.goo.gl/ErfgqYTvYuD8iF3E9"},Morgan:{location:[-122.2642069563565,37.87332050803642],name:"Morgan Hall",link:"https://maps.app.goo.gl/pa6x67fXANhfqEXw6"},"Hearst Field Annex":{location:[-122.25755748098894,37.869243966493414],name:"Hearst Field Annex",link:"https://maps.app.goo.gl/aj69ELTGUn6SfBoXA"},"Sproul Hall":{location:[-122.25874696852213,37.86924395748092],name:"Sproul Hall",link:"https://maps.app.goo.gl/GD7E8czb7xGVyzK39"},"Social Sciences Building":{location:[-122.25798819237231,37.870063802351076],name:"Social Sciences Building",link:"https://maps.app.goo.gl/181jSwt8zAK6qVcAA"},Barker:{location:[-122.2654706550479,37.873949032493385],name:"Barker Hall",link:"https://maps.app.goo.gl/Z7Z5ts18ZQtQcFaj8"},Wheeler:{location:[-122.25915062833967,37.87130919316681],name:"Wheeler Hall",link:"https://maps.app.goo.gl/yBmC2Do44oTxqMbT6"},Etcheverry:{location:[-122.25928093175008,37.875681116395],name:"Etcheverry Hall",link:"https://maps.app.goo.gl/6TRaiEmGTko1PNZx5"},"Anthro/Art Practice Bldg":{location:[-122.25534492286732,37.86986991079993],name:"Anthropology and Art Practice Building",link:"https://maps.app.goo.gl/kA5LcjADWEsLMbog9"},Wurster:{location:[-122.25489197607627,37.87074044380782],name:"Wurster Hall",link:"https://maps.app.goo.gl/iVJxYu7GoCMtZsoZ9"},"Physics Building":{location:[-122.25682010086159,37.872480670347336],name:"Physics Building",link:"https://maps.app.goo.gl/tVLb7dBb538MjNqRA"},Hesse:{location:[-122.25935446250307,37.874322866992514],name:"Hesse Hall",link:"https://maps.app.goo.gl/f3Cv1Hd5F5rNuha19"},Mulford:{location:[-122.26447768214827,37.87261701869861],name:"Mulford Hall",link:"https://maps.app.goo.gl/Yh3aAhHTCgMAeNyQ6"},"Li Ka Shing":{location:[-122.26528001690815,37.87262266777717],name:"Li Ka Shing Center",link:"https://maps.app.goo.gl/8FpVG3RXy8DPVc7J9"},Cheit:{location:[-122.2543379032442,37.87168904984896],name:"Cheit Hall",link:"https://maps.app.goo.gl/keLxkYXFnPcKgGrL8"},Cory:{location:[-122.25780468934755,37.87509213485355],name:"Cory Hall",link:"https://maps.app.goo.gl/jLZYsoST8TtE9y1G7"},"Campbell Hall":{location:[-122.25709767500017,37.87312763387514],name:"Campbell Hall",link:"https://maps.app.goo.gl/Ea3AntkJVr1UXF2u9"},Hilgard:{location:[-122.26340306795208,37.87331983963479],name:"Hilgard Hall",link:"https://maps.app.goo.gl/LijbW6fezg358m7U8"},Haviland:{location:[-122.26100851764237,37.87371692436061],name:"Haviland Hall",link:"https://maps.app.goo.gl/FKqPcqZQaTE6iyhX7"},"Doe Library":{location:[-122.2592358273592,37.8722145126222],name:"Doe Library",link:"https://maps.app.goo.gl/GudMeULid1ocEbaw7"},Pimentel:{location:[-122.25602833267033,37.87342920998079],name:"Pimentel Hall",link:"https://maps.app.goo.gl/wjmaQrXvN693bBxV7"},GSPP:{location:[-122.25790926224941,37.87572256387491],name:"Richard & Rhoda Goldman School",link:"https://maps.app.goo.gl/8tHo874r1SmPjWbX7"},Stephens:{location:[-122.25750797500021,37.87147064119593],name:"Stephens Hall",link:"https://maps.app.goo.gl/wGgMqX36qYzKR3CX7"},Davis:{location:[-122.25801209495167,37.8745786463717],name:"Davis Hall",link:"https://maps.app.goo.gl/ZrgWVDVvBJYDxnLEA"},"Woo Han Fai Hall":{location:[-122.25586439151184,37.86874548208747],name:"Woo Han Fai Hall",link:"https://maps.app.goo.gl/DrimtkfkXTWjBfnb9"},Birge:{location:[-122.25716535675937,37.872172511655855],name:"Birge Hall",link:"https://maps.app.goo.gl/tuXqvxSmuPTgFsTp8"},Stanley:{location:[-122.25640023093717,37.873858606089705],name:"Stanley Hall",link:"https://maps.app.goo.gl/PMijJrCeTFP9NPn8A"},Tan:{location:[-122.25651115723869,37.873281595855836],name:"Tan Kee Kee Hall",link:"https://maps.app.goo.gl/w45simSmLwXzh3q58"},McEnerney:{location:[-122.2644821947179,37.87666241423979],name:"CNMAT",link:"https://maps.app.goo.gl/4naDUT6Mp3C3kLh88"},Lewis:{location:[-122.25488562927272,37.872756450742145],name:"Lewis Hall",link:"https://maps.app.goo.gl/y2TeJdNji1CkYjM3A"},Wellman:{location:[-122.2627907229642,37.87317782345241],name:"Wellman Hall",link:"https://maps.app.goo.gl/Aue7cgmmXsv5u8Fd7"},McCone:{location:[-122.25967790769536,37.87409189531322],name:"McCone Hall",link:"https://maps.app.goo.gl/rpxt4kbxrrTRhnNb7"},"Jacobs Hall":{location:[-122.25882193535269,37.87602971606913],name:"Jacobs Hall",link:"https://maps.app.goo.gl/xZ9AxhnG5saW1Epf7"},"North Gate":{location:[-122.25990173190104,37.87497525022868],name:"North Gate Hall",link:"https://maps.app.goo.gl/MPGKJJMv6TMrdQRw8"},Hertz:{location:[-122.25569849398121,37.87108130391847],name:"Hertz Hall",link:"https://maps.app.goo.gl/p9gLFh1JR31jSgNF8"},Hargrove:{location:[-122.25618934462244,37.87045013995676],name:"Jean Gray Hargrove Music Library",link:"https://maps.app.goo.gl/z2CtVqLqRSF73dvy8"},Morrison:{location:[-122.25649720028268,37.87085305022676],name:"Morrison Hall",link:"https://maps.app.goo.gl/mkcYcrrb3evvNGjq8"},"Chou Hall":{location:[-122.25454360383524,37.8723166102369],name:"Chou Hall",link:"https://maps.app.goo.gl/xyS4LwD9m8nsBmRM7"},"South Hall":{location:[-122.25850563373693,37.87129997946342],name:"South Hall",link:"https://maps.app.goo.gl/qnT9xCkWiS2vs1cSA"},Soda:{location:[-122.25879005808657,37.87558462382853],name:"Soda Hall",link:"https://maps.app.goo.gl/fxcPJG7eJs7Yznr28"},"Hearst Gym":{location:[-122.25639058707237,37.869926045495006],name:"Hearst Gymnasium",link:"https://maps.app.goo.gl/KhHLrcdosZSCjVwUA"},"Haas Faculty Wing":{location:[-122.25334752655445,37.871632438551494],name:"Haas School of Business",link:"https://maps.app.goo.gl/MUdpvxs5Yg8AsQC36"},"Berkeley Art Museum":{location:[-122.26647977944991,37.87073521843178],name:"Berkeley Art Museum and Pacific Film Archive",link:"https://maps.app.goo.gl/sgG289Qa36AXSB4B6"},"Requested General Assignment":{name:"Requested general assignment"},Chavez:{location:[-122.26033260383534,37.86955061087345],name:"César Chávez Student Center",link:"https://maps.app.goo.gl/rBzJmqoHz13cxKef9"},"Graduate Theological Union":{location:[-122.26186544616492,37.87569417196013],name:"Graduate Theological Union",link:"https://maps.app.goo.gl/WXYqfaqup1bJNFRP8"},"GTU Student Services Center":{location:[-122.26144510383497,37.87707940337083],name:"GTU Student Services Center",link:"https://maps.app.goo.gl/WqPaiQqrA5dKjQLa8"},"Starr Library":{location:[-122.25998112731321,37.87359100039992],name:"East Asian Library",link:"https://maps.app.goo.gl/pLTHbyKNre5cMKmv9"},"Sutardja Dai":{location:[-122.25831352863513,37.87503515928838],name:"Sutardja Dai Hall",link:"https://maps.app.goo.gl/su2AuVn4g2uMfWBp8"},"Joan and Sanford I. Weill":{name:"UCSF Joan and Sanford I. Weill Neurosciences Building"},"2251 College":{location:[-122.25391110710783,37.870166332980034],name:"Archaeological Research Facility",link:"https://maps.app.goo.gl/31dzRoRnPyT189Py5"},"2401 Bancroft":{location:[-122.26116005869203,37.86869499663926],name:"Bancroft Dance Studio",link:"https://maps.app.goo.gl/m6jzQ5xh9d3yCfsp9"},"Wheeler Hall":{location:[-122.25914745072348,37.87130186176894],name:"Wheeler Hall",link:"https://maps.app.goo.gl/HikpBF5dGi3Ku8cT9"},"O'Brien":{location:[-122.2590577968863,37.87428341581882],name:"O'Brien Hall",link:"https://maps.app.goo.gl/ZrgWVDVvBJYDxnLEA"},Zellerbach:{location:[-122.26133456732288,37.86927674211004],name:"Zellerbach Playhouse",link:"https://maps.app.goo.gl/3Jxn1wkwEeo2hcmN8"},"UC LAW":{location:[-122.25401475499672,37.86950825416665],name:"UC Berkeley School of Law",link:"https://maps.app.goo.gl/dfWiaU9b6usgQzx27"},"Bancroft Library":{location:[-122.25866103267037,37.87231304109882],name:"The Bancroft Library",link:"https://maps.app.goo.gl/crRxb7m3C56ZkbP67"},"Philosophy Hall":{location:[-122.25810876150558,37.871015571961365],name:"Philosophy Hall",link:"https://maps.app.goo.gl/5spQqggAbSp3Lqcx5"},"Rec Sports Facility":{location:[-122.2627939038355,37.86859167196196],name:"Recreational Sports Facility",link:"https://maps.app.goo.gl/NKHX1M3wvLdKcy9eA"},"Hearst Gym North Field":{location:[-122.2569165044859,37.870280891945036],name:"Hearst North Field",link:"https://maps.app.goo.gl/XuRh7APFD256fJ5L7"},"Hearst Pool":{location:[-122.25694684709053,37.86969165728141],name:"Hearst Gym Pool",link:"https://maps.app.goo.gl/wXoxqAmjcLaUhT1j7"},"RSF Fieldhouse":{name:"Recreational Sports Facility Fieldhouse"},"Hearst Gym Tennis Cts":{location:[-122.25580180383541,37.869568533057866],name:"Hearst Tennis Courts",link:"https://maps.app.goo.gl/vJJuUph72exgrSvQ9"},"Donner Lab":{location:[-122.25630500383518,37.87446848531557],name:"Donner Lab",link:"https://maps.app.goo.gl/gWLtENgxK8yWN4hW8"},Blum:{location:[-122.25879005335187,37.87504783275099],name:"Blum Hall",link:"https://maps.app.goo.gl/PfueMBhoB7mkeyURA"},"HAAS Faculty Wing":{name:"Haas School of Business"},Gilman:{location:[-122.25622839210698,37.87261381887259],name:"Gilman Hall",link:"https://maps.app.goo.gl/ZPZYam2tjLoWAhpdA"},"2521 Channing":{location:[-122.25780997028515,37.867224873257776],name:"Institute for Research on Labor & Employment",link:"https://maps.app.goo.gl/v5Vqvkf26JLfsRyY9"},"2240 Piedmont":{location:[-122.25287235365637,37.87039854622979],name:"Center for the Study of Law and Society",link:"https://maps.app.goo.gl/eyaq4h7aaEvs4aJWA"}},tte="_trigger_1n5tg_1",rte="_root_1n5tg_5",nte="_content_1n5tg_20",ite="_fadeIn_1n5tg_1",ote="_arrow_1n5tg_29",ste="_map_1n5tg_32",ate="_title_1n5tg_37",lte="_description_1n5tg_43",yf={trigger:tte,root:rte,content:nte,fadeIn:ite,arrow:ote,map:ste,title:ate,description:lte};function cte({location:t}){const n=W.useMemo(()=>{if(!t)return;const u=t.split(" ").slice(0,-1).join(" ");return DB[u]},[t]),o=W.useMemo(()=>{if(t)return t.split(" ").pop()},[t]);return n!=null&&n.location&&(n!=null&&n.link)&&o?Y.jsx("a",{target:"_blank",href:n.link,className:yf.root,children:n.name+" "+o}):Y.jsxs(uy,{disableHoverableContent:!0,children:[Y.jsx(hy,{asChild:!0,children:Y.jsx("p",{className:yf.trigger,children:"To be determined"})}),Y.jsx(dy,{children:Y.jsx(fy,{asChild:!0,side:"bottom",sideOffset:8,collisionPadding:8,children:Y.jsxs("div",{className:yf.content,children:[Y.jsx(py,{className:yf.arrow}),Y.jsx("p",{className:yf.title,children:"Location"}),Y.jsx("p",{className:yf.description,children:"The location for this class has not been determined yet."})]})})})]})}const ute="_trigger_16exw_1",hte="_content_16exw_8",dte="_fadeIn_16exw_1",fte="_arrow_16exw_20",pte="_day_16exw_23",mte="_label_16exw_28",gte="_event_16exw_33",_te="_divider_16exw_40",du={trigger:ute,content:hte,fadeIn:dte,arrow:fte,day:pte,label:mte,event:gte,divider:_te},yte=(t,n)=>{if(!t||!n)return;const[o,u]=t.split(":").map(T=>parseInt(T)),[d,g]=n.split(":").map(T=>parseInt(T));if(o===0)return;let x=`${o%12||12}`;return u>0&&(x+=`:${u.toString().padStart(2,"0")}`),x+=` - ${d%12||12}`,g>0&&(x+=`:${g.toString().padStart(2,"0")}`),x+=d<12?" AM":" PM",x},MI=W.forwardRef(({days:t,timeStart:n,timeEnd:o,tooltip:u,className:d,...g},x)=>{const T=W.useRef(null);W.useImperativeHandle(x,()=>T.current);const s=W.useMemo(()=>{if(!o)return;const[D,N]=o.split(":").map(j=>parseInt(j));return 170-((D-6)*10+N/6)},[o]),I=W.useMemo(()=>{if(!n||!o)return;const[D,N]=n.split(":").map(X=>parseInt(X)),[j,G]=o.split(":").map(X=>parseInt(X));return(j-D)*10+(G-N)/6},[n,o]),O=W.useMemo(()=>{const D=yte(n,o);if(!(!(t!=null&&t.some(N=>N))||!D))return t.reduce((N,j,G)=>j?[...N,["Su","M","Tu","W","Th","F","Sa"][G]]:N,[]).join("")+", "+D},[t,n,o]);return O?Y.jsxs(uy,{disableHoverableContent:!0,open:u,children:[Y.jsx(hy,{asChild:!0,ref:T,children:Y.jsx("p",{className:xi(du.trigger,d),...g,children:O})}),Y.jsx(dy,{children:Y.jsx(fy,{asChild:!0,side:"bottom",sideOffset:8,collisionPadding:8,children:Y.jsxs("div",{className:du.content,children:[Y.jsx(py,{className:du.arrow}),t.map((D,N)=>Y.jsxs(W.Fragment,{children:[N>0&&Y.jsx("div",{className:du.divider}),Y.jsxs("div",{className:du.day,children:[Y.jsx("div",{className:du.label,children:["Su","M","Tu","W","Th","F","Sa"][N]}),D&&Y.jsx("div",{className:du.event,style:{bottom:`${s}px`,height:`${I}px`}})]})]},N))]})})})]}):Y.jsx("p",{className:xi(du.trigger,d),...g,children:"To be determined"})});MI.displayName="Time";const vte="_root_1i2u4_1",xte="_divider_1i2u4_10",bte="_column_1i2u4_19",wte="_title_1i2u4_23",Ete="_description_1i2u4_28",kl={root:vte,divider:xte,column:bte,title:wte,description:Ete};function RB({days:t,timeStart:n,timeEnd:o,location:u,instructors:d}){return Y.jsxs("div",{className:kl.root,children:[Y.jsxs("div",{className:kl.column,children:[Y.jsx("p",{className:kl.title,children:"Time"}),Y.jsx(MI,{days:t,timeStart:n,timeEnd:o})]}),Y.jsx("div",{className:kl.divider}),Y.jsxs("div",{className:kl.column,children:[Y.jsx("p",{className:kl.title,children:"Location"}),Y.jsx(cte,{location:u})]}),Y.jsx("div",{className:kl.divider}),Y.jsxs("div",{className:kl.column,children:[Y.jsx("p",{className:kl.title,children:d&&(d==null?void 0:d.length)>1?"Instructors":"Instructor"}),Y.jsx("p",{className:kl.description,style:{WebkitLineClamp:2,display:"-webkit-box",WebkitBoxOrient:"vertical"},children:d!=null&&d[0]?d.length===1?`${d[0].givenName} ${d[0].familyName}`:`${d[0].givenName} ${d[0].familyName}, et al.`:"To be determined"})]})]})}const Ste="_root_myq0a_1",Tte="_label_myq0a_5",Cte="_description_myq0a_10",xg={root:Ste,label:Tte,description:Cte};function Mte({currentClass:t}){return t?Y.jsxs("div",{className:xg.root,children:[Y.jsx(RB,{...t.primarySection}),Y.jsx("p",{className:xg.label,children:"Description"}),Y.jsx("p",{className:xg.description,children:t.description??t.course.description}),t.course.prereqs&&Y.jsxs(Y.Fragment,{children:[Y.jsx("p",{className:xg.label,children:"Prerequisites"}),Y.jsx("p",{className:xg.description,children:t.course.prereqs})]})]}):null}const Ite="_placeholder_1rws3_1",Ate="_title_1rws3_13",kte="_description_1rws3_18",Pte="_root_1rws3_24",Ote="_view_1rws3_40",Dte="_section_1rws3_43",Rte="_header_1rws3_51",Lte="_text_1rws3_56",zte="_menu_1rws3_66",Nte="_item_1rws3_75",wa={placeholder:Ite,title:Ate,description:kte,root:Pte,view:Ote,section:Dte,header:Rte,text:Lte,menu:zte,item:Nte};function Fte({currentClass:t,currentYear:n,currentSemester:o}){const u=W.useMemo(()=>Array.from(new Set(t==null?void 0:t.sections.map(d=>d.kind))),[t]);return t?t.sections.length===0?Y.jsxs("div",{className:wa.placeholder,children:[Y.jsx(QF,{width:32,height:32}),Y.jsx("p",{className:wa.title,children:"No associated sections"}),Y.jsx("p",{className:wa.description,children:"Please refer to the class syllabus or instructor for the most accurate information regarding class attendance requirements."})]}):Y.jsxs("div",{className:wa.root,children:[Y.jsx("div",{className:wa.menu,children:u.map(d=>Y.jsxs("div",{className:wa.item,children:[d==="Laboratory"?"Lab":"Discussion","s"]}))}),Y.jsx("div",{className:wa.view,children:t.sections.map(d=>Y.jsxs("div",{className:wa.section,children:[Y.jsxs("div",{className:wa.header,children:[Y.jsxs("div",{className:wa.text,children:[Y.jsxs("p",{className:wa.title,children:[d.kind==="Laboratory"?"Lab":d.kind," ",d.number]}),Y.jsx(CI,{ccn:d.ccn})]}),Y.jsx(H_,{enrollCount:d.enrollCount,enrollMax:d.enrollMax,waitlistCount:d.waitlistCount,waitlistMax:d.waitlistMax}),t&&Y.jsx(os,{as:"a",href:PB(n,o,t.course.subject,t.course.number,d.number,d.kind),target:"_blank",children:Y.jsx(KF,{})})]}),Y.jsx(RB,{days:d.days??[],timeStart:d.timeStart,timeEnd:d.timeEnd,location:d.location,instructors:d.instructors??[]})]},d.ccn))})]}):Y.jsx("div",{className:wa.placeholder,children:Y.jsx(SI,{size:32})})}const S4=[{text:"Overview",Component:Mte},{text:"Sections",Component:Fte},{text:"Grades",Component:()=>null},{text:"Enrollment",Component:()=>null}];function Bte({partialCurrentCourse:t,currentSemester:n,currentYear:o,currentClassNumber:u,currentCourseNumber:d,currentSubject:g}){var j;const[x]=Ip(),[T,s]=W.useState(0),{data:I}=ry(OB,{variables:{term:{semester:n,year:o},subject:g,courseNumber:d,classNumber:u}}),O=W.useMemo(()=>t.classes.find(G=>G.number===u),[t,u]),D=W.useMemo(()=>I==null?void 0:I.class,[I]),N=W.useMemo(()=>S4[T].Component,[T]);return Y.jsxs("div",{className:pc.root,children:[Y.jsxs("div",{className:pc.header,children:[Y.jsxs("div",{className:pc.row,children:[Y.jsxs("div",{className:pc.group,children:[Y.jsxs(al,{secondary:!0,children:[Y.jsx(nY,{}),"23"]}),Y.jsx(os,{children:Y.jsx(DQ,{})}),Y.jsx(os,{children:Y.jsx(HZ,{})})]}),Y.jsxs("div",{className:pc.group,children:[D&&Y.jsx(os,{as:"a",href:PB(o,n,g,d,D.primarySection.number,D.primarySection.kind),target:"_blank",children:Y.jsx(KF,{})}),Y.jsx(So,{to:{pathname:`/catalog/${o}/${n}`,search:x.toString()},children:Y.jsx(os,{children:Y.jsx(pI,{})})})]})]}),Y.jsxs("h1",{className:pc.heading,children:[g," ",d]}),Y.jsx("p",{className:pc.description,children:(D==null?void 0:D.title)??O.title??t.title}),Y.jsxs("div",{className:pc.group,children:[Y.jsx(_y,{gradeAverage:((j=D==null?void 0:D.course)==null?void 0:j.gradeAverage)??t.gradeAverage}),Y.jsx(H_,{enrollCount:(D==null?void 0:D.enrollCount)??O.enrollCount,enrollMax:(D==null?void 0:D.enrollMax)??O.enrollMax,waitlistCount:(D==null?void 0:D.waitlistCount)??O.waitlistCount,waitlistMax:(D==null?void 0:D.waitlistMax)??O.waitlistMax}),Y.jsx(dd,{unitsMax:(D==null?void 0:D.unitsMax)??O.unitsMax,unitsMin:(D==null?void 0:D.unitsMin)??O.unitsMin}),D&&Y.jsx(CI,{ccn:D.primarySection.ccn})]})]}),Y.jsx("div",{className:pc.menu,children:S4.map(({text:G},X)=>Y.jsx(Iu,{active:X===T,onClick:()=>s(X),children:G},X))}),Y.jsx(N,{currentClass:D,currentYear:o,currentSemester:n})]})}function jte(){const{year:t,semester:n,subject:o,courseNumber:u,classNumber:d}=RK(),g=xI(),[x]=Ip(),T=W.useMemo(()=>t&&parseInt(t)||2024,[t]),s=W.useMemo(()=>n?n[0].toUpperCase()+n.slice(1).toLowerCase():Io.Spring,[n]),I=W.useMemo(()=>o==null?void 0:o.toUpperCase(),[o]),{loading:O,error:D,data:N}=ry(TI,{variables:{term:{semester:s,year:T}}}),j=W.useMemo(()=>(N==null?void 0:N.catalog)??[],[N==null?void 0:N.catalog]),G=W.useMemo(()=>j.find(({subject:H,number:U,classes:q})=>H===I&&U===u&&q.some(J=>J.number===d)),[j,I,u,d]),X=W.useCallback((H,U)=>{g({pathname:`/catalog/${T}/${s}/${H.subject}/${H.number}/${U}`,search:x.toString()})},[g,T,s,x]),te=W.useMemo(()=>d&&u&&I&&G,[d,u,I,G]);return O||D?Y.jsx(_B,{children:Y.jsx(SI,{})}):Y.jsxs("div",{className:zee.root,children:[Y.jsx(EI,{courses:j,onClassSelect:X,currentSemester:s,currentYear:T}),te?Y.jsx(Bte,{partialCurrentCourse:G,currentSemester:s,currentYear:T,currentClassNumber:d,currentCourseNumber:u,currentSubject:I}):Y.jsx(Y.Fragment,{})]})}const $te="_root_3hclh_1",Ute={root:$te};function F1({children:t,className:n}){return Y.jsx("div",{className:xi(Ute.root,n),children:t})}const Vte="_root_1h3t6_1",Gte="_invert_1h3t6_13",qte="_group_1h3t6_16",Wte="_description_1h3t6_16",Hte="_column_1h3t6_16",Zte="_label_1h3t6_16",Xte="_link_1h3t6_19",Yte="_row_1h3t6_46",Qte="_brand_1h3t6_64",Vi={root:Vte,invert:Gte,group:qte,description:Wte,column:Hte,label:Zte,link:Xte,row:Yte,brand:Qte};function II({invert:t}){return Y.jsx(F1,{children:Y.jsxs("div",{className:xi(Vi.root,{[Vi.invert]:t}),children:[Y.jsxs("div",{className:Vi.group,children:[Y.jsx(So,{to:"/",className:Vi.brand,children:"Berkeleytime"}),Y.jsxs("p",{className:Vi.description,children:["An"," ",Y.jsx("a",{href:"https://octo.asuc.org/",target:"_blank",className:Vi.link,children:"ASUC OCTO"})," ","project"]}),Y.jsxs("div",{className:Vi.row,children:[Y.jsx(os,{invert:t,as:"a",href:"https://www.instagram.com/",target:"_blank",children:Y.jsx(cY,{})}),Y.jsx(os,{invert:t,as:"a",href:"https://discord.gg/uP2bTPh99U",target:"_blank",children:Y.jsx(wX,{})}),Y.jsx(os,{invert:t,as:"a",href:"https://facebook.com/berkeleytime",target:"_blank",children:Y.jsx(IX,{})}),Y.jsx(os,{invert:t,as:"a",href:"https://github.com/asuc-octo/berkeleytime",target:"_blank",children:Y.jsx(qX,{})})]})]}),Y.jsxs("div",{className:Vi.column,children:[Y.jsx("p",{className:Vi.label,children:"Offerings"}),Y.jsx(So,{to:"/catalog",className:Vi.link,children:"Courses"}),Y.jsx(So,{to:"/scheduler",className:Vi.link,children:"My schedules"}),Y.jsx(So,{to:"/grades",className:Vi.link,children:"Grades"}),Y.jsx(So,{to:"/enrollment",className:Vi.link,children:"Enrollment"})]}),Y.jsxs("div",{className:Vi.column,children:[Y.jsx("p",{className:Vi.label,children:"Organization"}),Y.jsx(So,{to:"/about",className:Vi.link,children:"About us"}),Y.jsx(So,{to:"/scheduler",className:Vi.link,children:"Frequently asked questions"}),Y.jsx(So,{to:"/grades",className:Vi.link,children:"Resources"})]}),Y.jsxs("div",{className:Vi.column,children:[Y.jsx("p",{className:Vi.label,children:"Legal"}),Y.jsx(So,{to:"/catalog",className:Vi.link,children:"Terms of service"}),Y.jsx(So,{to:"/scheduler",className:Vi.link,children:"Privacy policy"})]})]})})}const LB=W.createContext(null),Kte=()=>{const t=W.useContext(LB);if(!t)throw new Error("useAccount has to be used within AccountProvider");return t},Jte="_root_1yfmy_1",ere="_brand_1yfmy_7",tre="_menu_1yfmy_19",rre="_invert_1yfmy_24",nre="_item_1yfmy_38",ire="_button_1yfmy_54",Pl={root:Jte,brand:ere,menu:tre,invert:rre,item:nre,button:ire};function AI({invert:t}){const{width:n}=wI(),{account:o,signIn:u,signOut:d}=Kte();return Y.jsxs("div",{className:xi(Pl.root,{[Pl.invert]:t}),children:[Y.jsx(So,{className:Pl.brand,to:"/",children:"Berkeleytime"}),n<=992?Y.jsx(os,{invert:t,children:Y.jsx(mY,{})}):Y.jsxs(Y.Fragment,{children:[Y.jsxs("div",{className:Pl.menu,children:[Y.jsx(Iu,{as:R0,to:"/catalog",className:Pl.item,children:"Catalog"}),Y.jsx(Iu,{as:R0,to:"/schedules",className:Pl.item,children:"My schedules"}),Y.jsx(Iu,{as:R0,to:"/plan",className:Pl.item,children:"My plan"}),Y.jsx(Iu,{as:R0,to:"/explore",className:Pl.item,children:"Explore"})]}),o?Y.jsxs(al,{onClick:()=>d(),className:Pl.button,children:[o.email,Y.jsx(JF,{})]}):Y.jsxs(al,{onClick:()=>u(),className:Pl.button,children:["Sign in",Y.jsx(Rl,{})]})]})]})}const ore="_root_1e0n4_1",sre="_body_1e0n4_1",are="_sideBar_1e0n4_6",lre="_view_1e0n4_10",cre="_course_1e0n4_16",ure="_title_1e0n4_25",hre="_description_1e0n4_32",dre="_row_1e0n4_38",fre="_badge_1e0n4_44",pre="_header_1e0n4_56",mre="_container_1e0n4_61",gre="_form_1e0n4_67",_re="_input_1e0n4_79",yre="_placeholder_1e0n4_79",ps={root:ore,body:sre,sideBar:are,view:lre,course:cre,title:ure,description:hre,row:dre,badge:fre,header:pre,container:mre,form:gre,input:_re,placeholder:yre},vre="_root_13ert_1",xre={root:vre},vf=["Explore courses...","Computational methods for science and engineering","Environmental policy and resource management","Bioinformatics and computational biology","Quantum mechanics and mathematical physics","Public health epidemiology and data analysis"];function bre({className:t}){const[n,o]=W.useState(vf[0]),u=W.useRef(vf[0].length-1),d=W.useRef(0);return W.useEffect(()=>{let g;const x=()=>{let T=u.current+1;T===vf[d.current].length*2&&(d.current=(d.current+1)%vf.length,T=0),u.current=T;const s=vf[d.current],I=T>s.length?-(T%s.length):T,O=vf[d.current].slice(0,I);o(O),g=setTimeout(x,O.length===s.length?1e3:75)};return g=setTimeout(x,100),()=>clearInterval(g)},[]),Y.jsx("p",{className:xi(xre.root,t),children:n})}function wre(){const[t,n]=W.useState(""),[o,u]=W.useState([]),d=hM(),g=async T=>{const[s,I]=T.split(" "),{data:O}=await d.query({query:Dee,variables:{subject:s,courseNumber:I}});if(O)return O.course},x=async T=>{T.preventDefault();const s=await fetch(`http://localhost:3002/query?input=${encodeURIComponent(t)}&topK=24`);if(!s.ok)return;const{matches:I}=await s.json(),O=await Promise.all(I.map(({id:D})=>g(D)));u(O.filter(D=>D&&D.classes.length!==0))};return Y.jsxs("div",{className:ps.root,children:[Y.jsxs("div",{className:ps.header,children:[Y.jsx(AI,{invert:!0}),Y.jsx("div",{className:ps.container,children:Y.jsxs("form",{className:ps.form,onSubmit:x,children:[Y.jsx("input",{className:ps.input,value:t,placeholder:"",onChange:T=>n(T.target.value)}),Y.jsx(bre,{className:ps.placeholder}),Y.jsxs(al,{className:ps.button,children:["Search",Y.jsx(Rl,{})]})]})})]}),Y.jsx(F1,{children:Y.jsxs("div",{className:ps.body,children:[Y.jsx("div",{className:ps.sideBar}),Y.jsx("div",{className:ps.view,children:o.sort((T,s)=>{const I={[Io.Fall]:3,[Io.Summer]:2,[Io.Spring]:1},O=D=>[...D.classes].sort((N,j)=>N.year-j.year||I[N.semester]-I[j.semester])[0];return O(s).year-O(T).year||I[O(s).semester]-I[O(T).semester]}).map(T=>{const s={[Io.Fall]:3,[Io.Summer]:2,[Io.Spring]:1},{year:I,semester:O}=[...T.classes].sort((j,G)=>j.year-G.year||s[j.semester]-s[G.semester])[0],{unitsMax:D,unitsMin:N}=T.classes.reduce((j,{unitsMax:G,unitsMin:X})=>({unitsMax:Math.max(j.unitsMax,G),unitsMin:Math.min(j.unitsMin,X)}),{unitsMax:0,unitsMin:0});return Y.jsxs("div",{className:ps.course,children:[Y.jsxs("p",{className:ps.title,children:[T.subject," ",T.number]}),Y.jsx("p",{className:ps.description,children:T.title}),Y.jsxs("div",{className:ps.row,children:[Y.jsx(_y,{gradeAverage:T.gradeAverage}),Y.jsxs("div",{className:ps.badge,children:[Y.jsx(JZ,{}),O," ",I]}),Y.jsx(dd,{unitsMax:D,unitsMin:N})]})]},T.number)})})]})}),Y.jsx(II,{})]})}const Ere="_root_k7ij1_1",Sre="_row_k7ij1_13",Tre="_gallery_k7ij1_18",Cre="_image_k7ij1_27",Mre="_graph_k7ij1_35",Ire="_enrollment1_k7ij1_42",Are="_enrollment2_k7ij1_47",kre="_grades1_k7ij1_52",Pre="_grades2_k7ij1_57",Ore="_calendar_k7ij1_62",Dre="_schedule_k7ij1_67",Rre="_filters_k7ij1_73",Lre="_courses_k7ij1_78",zre="_course_k7ij1_78",Nre="_text_k7ij1_90",Fre="_link_k7ij1_99",Bre="_description_k7ij1_113",jre="_heading_k7ij1_119",$re="_badge_k7ij1_127",Qr={root:Ere,row:Sre,gallery:Tre,image:Cre,graph:Mre,enrollment1:Ire,enrollment2:Are,grades1:kre,grades2:Pre,calendar:Ore,schedule:Dre,filters:Rre,courses:Lre,course:zre,text:Nre,link:Fre,description:Bre,heading:jre,badge:$re},Ure="/assets/calendar-B8s_1M18.png",Vre="/assets/course-yMdxhX9X.png",Gre="/assets/courses-DmMvvqKC.png",qre="/assets/enrollment-1-Dcbym0yW.png",Wre="/assets/enrollment-2-jKXr0wnx.png",Hre="/assets/filters-DXwgWLj7.png",Zre="/assets/grades-1-A1WjmTt6.png",Xre="/assets/grades-2-DqLgve9d.png",Yre="/assets/graph-1-DQULNuLb.png",Qre="/assets/graph-2-CX39XgQ4.png",Kre="/assets/schedule-DmDOHIMQ.png";function Jre(){return Y.jsxs(F1,{className:Qr.root,children:[Y.jsxs("div",{className:Qr.row,children:[Y.jsxs("div",{className:Qr.gallery,children:[Y.jsx("img",{src:Ure,className:xi(Qr.image,Qr.calendar)}),Y.jsx("img",{src:Kre,className:xi(Qr.image,Qr.schedule)})]}),Y.jsxs("div",{className:Qr.text,children:[Y.jsx("div",{className:Qr.badge,children:"New"}),Y.jsx("h3",{className:Qr.heading,children:"Simple schedule planning"}),Y.jsx("p",{className:Qr.description,children:"Plan, save, and share schedules. An alternative to CalCentral, Berkeleytime makes scheduling your semester easy and user-friendly."}),Y.jsxs(So,{to:"/schedules",className:Qr.link,children:["Start planning",Y.jsx(Rl,{})]})]})]}),Y.jsxs("div",{className:Qr.row,children:[Y.jsxs("div",{className:Qr.gallery,children:[Y.jsx("img",{src:Hre,className:xi(Qr.image,Qr.filters)}),Y.jsx("img",{src:Gre,className:xi(Qr.image,Qr.courses)}),Y.jsx("img",{src:Vre,className:xi(Qr.image,Qr.course)})]}),Y.jsxs("div",{className:Qr.text,children:[Y.jsx("h3",{className:Qr.heading,children:"Find the right classes for you"}),Y.jsx("p",{className:Qr.description,children:"Instead of spending hours sifting through courses on the Berkeley course catalog, instantly filter and sort courses by average grade, number of open seats, and more."}),Y.jsxs(So,{to:"/schedules",className:Qr.link,children:["Browse courses",Y.jsx(Rl,{})]})]})]}),Y.jsxs("div",{className:Qr.row,children:[Y.jsxs("div",{className:Qr.gallery,children:[Y.jsx("img",{src:Qre,className:xi(Qr.image,Qr.graph)}),Y.jsx("img",{src:Zre,className:xi(Qr.image,Qr.grades1)}),Y.jsx("img",{src:Xre,className:xi(Qr.image,Qr.grades2)})]}),Y.jsxs("div",{className:Qr.text,children:[Y.jsx("h3",{className:Qr.heading,children:"Get ahead of the curve"}),Y.jsx("p",{className:Qr.description,children:"View grade distributions for classes based on the semester and professor. Stop worrying about the A, and make informed decisions about your schedule."}),Y.jsxs(So,{to:"/schedules",className:Qr.link,children:["Go to Grades",Y.jsx(Rl,{})]})]})]}),Y.jsxs("div",{className:Qr.row,children:[Y.jsxs("div",{className:Qr.gallery,children:[Y.jsx("img",{src:Yre,className:xi(Qr.image,Qr.graph)}),Y.jsx("img",{src:qre,className:xi(Qr.image,Qr.enrollment1)}),Y.jsx("img",{src:Wre,className:xi(Qr.image,Qr.enrollment2)})]}),Y.jsxs("div",{className:Qr.text,children:[Y.jsx("h3",{className:Qr.heading,children:"Secure your seat"}),Y.jsx("p",{className:Qr.description,children:"Track enrollment for courses and sections in real-time. View enrollment history over time and know when to enroll, and when you can wait."}),Y.jsxs(So,{to:"/schedules",className:Qr.link,children:["Go to Enrollment",Y.jsx(Rl,{})]})]})]})]})}const ene="_root_1022u_1",tne="_wave_1022u_8",rne="_container_1022u_22",nne="_text_1022u_31",ine="_heading_1022u_46",one="_description_1022u_61",sne="_form_1022u_68",ane="_input_1022u_79",lne="_clock_1022u_87",cne="_campanile_1022u_110",ea={root:ene,wave:tne,container:rne,text:nne,heading:ine,description:one,form:sne,input:ane,clock:lne,campanile:cne},une="/assets/afternoon-Bcc_IZmB.svg",hne="/assets/dawn-BNE7tL-3.svg",dne="/assets/dusk-B-fW6hCG.svg",fne="/assets/morning-B72BCF0m.svg",pne="/assets/sunrise-CM8Sjc_v.svg",mne="/assets/sunset-0kJ5b2H4.svg",gne="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201440%20250'%3e%3cpath%20fill='%23f8fafc'%20fill-opacity='1'%20d='M0,160L80,138.7C160,117,320,75,480,96C640,117,800,203,960,213.3C1120,224,1280,160,1360,128L1440,96L1440,320L1360,320C1280,320,1120,320,960,320C800,320,640,320,480,320C320,320,160,320,80,320L0,320Z'%3e%3c/path%3e%3c/svg%3e",_ne=[{colors:["#CFADD4","#B5B2D9"],image:hne},{colors:["#D3A4BF","#EEC9C1"],image:pne},{colors:["#DCD6C4","#C8DCD9"],image:fne},{gradient:["var(--blue-500)","var(--sky-500)"],colors:["#3b82f6","#0ea5e9"],image:une},{colors:["#D25950","#EE8A1F"],image:mne},{colors:["#10101B","#202036"],angle:"to bottom right",image:dne}];function yne(){const t=W.useRef(null),[n,o]=W.useState(()=>Date.now()-10*60*1e3),u=W.useMemo(()=>_ne[3],[]);W.useEffect(()=>{const g=setInterval(()=>o(x=>x+1e3),1e3);return()=>clearInterval(g)},[]),W.useEffect(()=>{const g=t.current;if(!g)return;const[x,T]=u.gradient??u.colors,{angle:s}=u;if(g.style.setProperty("--landing-gradient-start",x),g.style.setProperty("--landing-gradient-stop",T),s){g.style.setProperty("--landing-gradient-angle",s);return}g.style.removeProperty("--landing-gradient-angle")},[u]);const d=g=>{g.preventDefault()};return Y.jsxs("div",{className:ea.root,ref:t,children:[Y.jsx(AI,{invert:!0}),Y.jsxs("div",{className:ea.container,children:[Y.jsxs("div",{className:ea.text,children:[Y.jsx("h1",{className:ea.heading,children:"Confidently plan and manage your schedule"}),Y.jsx("h2",{className:ea.description,children:"Berkeley's largest course discovery platform built and run by students, for students"}),Y.jsxs("form",{className:ea.form,onSubmit:d,children:[Y.jsx("input",{className:ea.input,type:"text",autoFocus:!0,placeholder:"Search for courses..."}),Y.jsxs(al,{className:ea.button,children:["Go",Y.jsx(Rl,{})]})]})]}),Y.jsxs("div",{className:ea.clock,children:[Y.jsx(gX,{height:24,width:24}),Y.jsx("p",{className:ea.heading,children:new Date(n).toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric",second:"numeric"})}),Y.jsx("p",{className:ea.description,children:"Berkeley time"})]}),Y.jsx("img",{className:ea.campanile,src:u.image})]}),Y.jsx("img",{className:ea.wave,src:gne})]})}const vne="_root_wl82h_1",xne="_heading_wl82h_5",bne="_accordion_wl82h_21",wne="_content_wl82h_41",Ene="_title_wl82h_54",ms={root:vne,heading:xne,accordion:bne,content:wne,title:Ene};function Sne(){return Y.jsxs("div",{className:ms.root,children:[Y.jsxs(F1,{children:[Y.jsx("h3",{className:ms.heading,children:"Get involved"}),Y.jsxs("div",{className:ms.accordion,children:[Y.jsxs("details",{className:ms.details,children:[Y.jsxs("summary",{className:ms.summary,children:[Y.jsx("h3",{className:ms.title,children:"Join our team"}),Y.jsx(m_,{height:24,width:24}),Y.jsx(dS,{height:24,width:24})]}),Y.jsx("p",{className:ms.content,children:"Become part of a dynamic and innovative group dedicated to helping students navigate Berkeley! Roles on the Berkeleytime team include backend & frontend development, product design, user research, and marketing. We are always looking for passionate and talented students."})]}),Y.jsxs("details",{className:ms.details,children:[Y.jsxs("summary",{className:ms.summary,children:[Y.jsx("h3",{className:ms.title,children:"Contribute"}),Y.jsx(m_,{height:24,width:24}),Y.jsx(dS,{height:24,width:24})]}),Y.jsx("p",{className:ms.description,children:"Become part of a dynamic and innovative group dedicated to helping students navigate Berkeley! Roles on the Berkeleytime team include backend & frontend development, product design, user research, and marketing. We are always looking for passionate and talented students."})]}),Y.jsxs("details",{className:ms.details,children:[Y.jsxs("summary",{className:ms.summary,children:[Y.jsx("h3",{className:ms.title,children:"Provide feedback"}),Y.jsx(m_,{height:24,width:24}),Y.jsx(dS,{height:24,width:24})]}),Y.jsx("p",{className:ms.description,children:"Berkeleytime is an open-source project. If you are interested in contributing to the project, check out our"})]})]})]}),Y.jsx(II,{invert:!0})]})}const Tne="_root_15h7r_1",Cne={root:Tne},Mne=()=>Y.jsxs("div",{className:Cne.root,children:[Y.jsx(yne,{}),Y.jsx(Jre,{}),Y.jsx(Sne,{})]}),Ine="_root_1fi9b_1",Ane="_trigger_1fi9b_7",kne="_button_1fi9b_16",Pne="_slideOut_1fi9b_1",OS={root:Ine,trigger:Ane,button:kne,slideOut:Pne};function DS({header:t=!0,footer:n=!0}){const{state:o}=VK();return Y.jsxs("div",{className:OS.root,children:[t&&Y.jsx(AI,{}),o==="loading"?Y.jsx(_B,{children:Y.jsx(SI,{})}):Y.jsx(HK,{}),n&&Y.jsx(II,{}),Y.jsx("div",{className:OS.trigger,children:Y.jsxs(al,{as:"a",href:"https://forms.gle/zeAUQAHrMcrRJyhK6",target:"_blank",className:OS.button,children:[Y.jsx(bY,{}),"Provide feedback"]})})]})}class ll{constructor(n){this._canceled=!1,this.data=n}get type(){return this.constructor.type}get cancelable(){return this.constructor.cancelable}cancel(){this._canceled=!0}canceled(){return this._canceled}clone(n){return new this.constructor({...this.data,...n})}}ll.type="event";ll.cancelable=!1;class eh{constructor(n){this.draggable=n}attach(){throw new Error("Not Implemented")}detach(){throw new Error("Not Implemented")}}const xf={mouse:0,drag:0,touch:100};class zB{constructor(n=[],o={}){this.containers=[...n],this.options={...o},this.dragging=!1,this.currentContainer=null,this.originalSource=null,this.startEvent=null,this.delay=One(o.delay)}attach(){return this}detach(){return this}addContainer(...n){this.containers=[...this.containers,...n]}removeContainer(...n){this.containers=this.containers.filter(o=>!n.includes(o))}trigger(n,o){const u=document.createEvent("Event");return u.detail=o,u.initEvent(o.type,!0,!0),n.dispatchEvent(u),this.lastEvent=o,o}}function One(t){const n={};if(t===void 0)return{...xf};if(typeof t=="number"){for(const o in xf)Object.prototype.hasOwnProperty.call(xf,o)&&(n[o]=t);return n}for(const o in xf)Object.prototype.hasOwnProperty.call(xf,o)&&(t[o]===void 0?n[o]=xf[o]:n[o]=t[o]);return n}function Ma(t,n){if(t==null)return null;function o(d){return d==null||n==null?!1:Dne(n)?Element.prototype.matches.call(d,n):Rne(n)?[...n].includes(d):Lne(n)?n===d:zne(n)?n(d):!1}let u=t;do{if(u=u.correspondingUseElement||u.correspondingElement||u,o(u))return u;u=(u==null?void 0:u.parentNode)||null}while(u!=null&&u!==document.body&&u!==document);return null}function Dne(t){return typeof t=="string"}function Rne(t){return t instanceof NodeList||t instanceof Array}function Lne(t){return t instanceof Node}function zne(t){return typeof t=="function"}function NB(t,n,o,u){return Math.sqrt((o-t)**2+(u-n)**2)}class B1 extends ll{get originalEvent(){return this.data.originalEvent}get clientX(){return this.data.clientX}get clientY(){return this.data.clientY}get target(){return this.data.target}get container(){return this.data.container}get originalSource(){return this.data.originalSource}get pressure(){return this.data.pressure}}class kI extends B1{}kI.type="drag:start";class PI extends B1{}PI.type="drag:move";class OI extends B1{}OI.type="drag:stop";class Nne extends B1{}Nne.type="drag:pressure";const bg=Symbol("onContextMenuWhileDragging"),wg=Symbol("onMouseDown"),Eg=Symbol("onMouseMove"),Sg=Symbol("onMouseUp"),z0=Symbol("startDrag"),fu=Symbol("onDistanceChange");class Fne extends zB{constructor(n=[],o={}){super(n,o),this.mouseDownTimeout=null,this.pageX=null,this.pageY=null,this[bg]=this[bg].bind(this),this[wg]=this[wg].bind(this),this[Eg]=this[Eg].bind(this),this[Sg]=this[Sg].bind(this),this[z0]=this[z0].bind(this),this[fu]=this[fu].bind(this)}attach(){document.addEventListener("mousedown",this[wg],!0)}detach(){document.removeEventListener("mousedown",this[wg],!0)}[wg](n){if(n.button!==0||n.ctrlKey||n.metaKey)return;const o=Ma(n.target,this.containers);if(!o||this.options.handle&&n.target&&!Ma(n.target,this.options.handle))return;const u=Ma(n.target,this.options.draggable);if(!u)return;const{delay:d}=this,{pageX:g,pageY:x}=n;Object.assign(this,{pageX:g,pageY:x}),this.onMouseDownAt=Date.now(),this.startEvent=n,this.currentContainer=o,this.originalSource=u,document.addEventListener("mouseup",this[Sg]),document.addEventListener("dragstart",T4),document.addEventListener("mousemove",this[fu]),this.mouseDownTimeout=window.setTimeout(()=>{this[fu]({pageX:this.pageX,pageY:this.pageY})},d.mouse)}[z0](){const n=this.startEvent,o=this.currentContainer,u=this.originalSource,d=new kI({clientX:n.clientX,clientY:n.clientY,target:n.target,container:o,originalSource:u,originalEvent:n});this.trigger(this.currentContainer,d),this.dragging=!d.canceled(),this.dragging&&(document.addEventListener("contextmenu",this[bg],!0),document.addEventListener("mousemove",this[Eg]))}[fu](n){const{pageX:o,pageY:u}=n,{distance:d}=this.options,{startEvent:g,delay:x}=this;if(Object.assign(this,{pageX:o,pageY:u}),!this.currentContainer)return;const T=Date.now()-this.onMouseDownAt,s=NB(g.pageX,g.pageY,o,u)||0;clearTimeout(this.mouseDownTimeout),T<x.mouse?document.removeEventListener("mousemove",this[fu]):s>=d&&(document.removeEventListener("mousemove",this[fu]),this[z0]())}[Eg](n){if(!this.dragging)return;const o=document.elementFromPoint(n.clientX,n.clientY),u=new PI({clientX:n.clientX,clientY:n.clientY,target:o,container:this.currentContainer,originalEvent:n});this.trigger(this.currentContainer,u)}[Sg](n){if(clearTimeout(this.mouseDownTimeout),n.button!==0||(document.removeEventListener("mouseup",this[Sg]),document.removeEventListener("dragstart",T4),document.removeEventListener("mousemove",this[fu]),!this.dragging))return;const o=document.elementFromPoint(n.clientX,n.clientY),u=new OI({clientX:n.clientX,clientY:n.clientY,target:o,container:this.currentContainer,originalEvent:n});this.trigger(this.currentContainer,u),document.removeEventListener("contextmenu",this[bg],!0),document.removeEventListener("mousemove",this[Eg]),this.currentContainer=null,this.dragging=!1,this.startEvent=null}[bg](n){n.preventDefault()}}function T4(t){t.preventDefault()}function bf(t){const{touches:n,changedTouches:o}=t;return n&&n[0]||o&&o[0]}const Tg=Symbol("onTouchStart"),jh=Symbol("onTouchEnd"),Cg=Symbol("onTouchMove"),N0=Symbol("startDrag"),pu=Symbol("onDistanceChange");let mx=!1;window.addEventListener("touchmove",t=>{mx&&t.preventDefault()},{passive:!1});class Bne extends zB{constructor(n=[],o={}){super(n,o),this.currentScrollableParent=null,this.tapTimeout=null,this.touchMoved=!1,this.pageX=null,this.pageY=null,this[Tg]=this[Tg].bind(this),this[jh]=this[jh].bind(this),this[Cg]=this[Cg].bind(this),this[N0]=this[N0].bind(this),this[pu]=this[pu].bind(this)}attach(){document.addEventListener("touchstart",this[Tg])}detach(){document.removeEventListener("touchstart",this[Tg])}[Tg](n){const o=Ma(n.target,this.containers);if(!o||this.options.handle&&n.target&&!Ma(n.target,this.options.handle))return;const u=Ma(n.target,this.options.draggable);if(!u)return;const{distance:d=0}=this.options,{delay:g}=this,{pageX:x,pageY:T}=bf(n);Object.assign(this,{pageX:x,pageY:T}),this.onTouchStartAt=Date.now(),this.startEvent=n,this.currentContainer=o,this.originalSource=u,document.addEventListener("touchend",this[jh]),document.addEventListener("touchcancel",this[jh]),document.addEventListener("touchmove",this[pu]),o.addEventListener("contextmenu",C4),d&&(mx=!0),this.tapTimeout=window.setTimeout(()=>{this[pu]({touches:[{pageX:this.pageX,pageY:this.pageY}]})},g.touch)}[N0](){const n=this.startEvent,o=this.currentContainer,u=bf(n),d=this.originalSource,g=new kI({clientX:u.pageX,clientY:u.pageY,target:n.target,container:o,originalSource:d,originalEvent:n});this.trigger(this.currentContainer,g),this.dragging=!g.canceled(),this.dragging&&document.addEventListener("touchmove",this[Cg]),mx=this.dragging}[pu](n){const{distance:o}=this.options,{startEvent:u,delay:d}=this,g=bf(u),x=bf(n),T=Date.now()-this.onTouchStartAt,s=NB(g.pageX,g.pageY,x.pageX,x.pageY);Object.assign(this,x),clearTimeout(this.tapTimeout),T<d.touch?document.removeEventListener("touchmove",this[pu]):s>=o&&(document.removeEventListener("touchmove",this[pu]),this[N0]())}[Cg](n){if(!this.dragging)return;const{pageX:o,pageY:u}=bf(n),d=document.elementFromPoint(o-window.scrollX,u-window.scrollY),g=new PI({clientX:o,clientY:u,target:d,container:this.currentContainer,originalEvent:n});this.trigger(this.currentContainer,g)}[jh](n){if(clearTimeout(this.tapTimeout),mx=!1,document.removeEventListener("touchend",this[jh]),document.removeEventListener("touchcancel",this[jh]),document.removeEventListener("touchmove",this[pu]),this.currentContainer&&this.currentContainer.removeEventListener("contextmenu",C4),!this.dragging)return;document.removeEventListener("touchmove",this[Cg]);const{pageX:o,pageY:u}=bf(n),d=document.elementFromPoint(o-window.scrollX,u-window.scrollY);n.preventDefault();const g=new OI({clientX:o,clientY:u,target:d,container:this.currentContainer,originalEvent:n});this.trigger(this.currentContainer,g),this.currentContainer=null,this.dragging=!1,this.startEvent=null}}function C4(t){t.preventDefault(),t.stopPropagation()}class DI extends ll{constructor(n){super(n),this.data=n}get dragEvent(){return this.data.dragEvent}}DI.type="collidable";class jne extends DI{get collidingElement(){return this.data.collidingElement}}jne.type="collidable:in";class $ne extends DI{get collidingElement(){return this.data.collidingElement}}$ne.type="collidable:out";function FB(t,n){return function(o){Vne(n,"addInitializer"),gx(o,"An initializer"),t.push(o)}}function RS(t,n){if(!t(n))throw new TypeError("Attempted to access private element on non-instance")}function Une(t,n,o,u,d,g,x,T,s,I,O){var D;switch(g){case 1:D="accessor";break;case 2:D="method";break;case 3:D="getter";break;case 4:D="setter";break;default:D="field"}var N,j,G={kind:D,name:T?"#"+o:o,static:x,private:T,metadata:O},X={v:!1};if(g!==0&&(G.addInitializer=FB(d,X)),T||g!==0&&g!==2)if(g===2)N=function(U){return RS(I,U),u.value};else{var te=g===0||g===1;(te||g===3)&&(N=T?function(U){return RS(I,U),u.get.call(U)}:function(U){return u.get.call(U)}),(te||g===4)&&(j=T?function(U,q){RS(I,U),u.set.call(U,q)}:function(U,q){u.set.call(U,q)})}else N=function(U){return U[o]},g===0&&(j=function(U,q){U[o]=q});var H=T?I.bind():function(U){return o in U};G.access=N&&j?{get:N,set:j,has:H}:N?{get:N,has:H}:{set:j,has:H};try{return t.call(n,s,G)}finally{X.v=!0}}function Vne(t,n){if(t.v)throw new Error("attempted to call "+n+" after decoration was finished")}function gx(t,n){if(typeof t!="function")throw new TypeError(n+" must be a function")}function BB(t,n){var o=typeof n;if(t===1){if(o!=="object"||n===null)throw new TypeError("accessor decorators must return an object with get, set, or init properties or void 0");n.get!==void 0&&gx(n.get,"accessor.get"),n.set!==void 0&&gx(n.set,"accessor.set"),n.init!==void 0&&gx(n.init,"accessor.init")}else if(o!=="function"){var u;throw u=t===0?"field":t===5?"class":"method",new TypeError(u+" decorators must return a function or void 0")}}function Gne(t){return function(){return t(this)}}function qne(t){return function(n){t(this,n)}}function Wne(t,n,o,u,d,g,x,T,s,I,O){var D,N,j,G,X,te,H=o[0];u||Array.isArray(H)||(H=[H]),T?D=g===0||g===1?{get:Gne(o[3]),set:qne(o[4])}:g===3?{get:o[3]}:g===4?{set:o[3]}:{value:o[3]}:g!==0&&(D=Object.getOwnPropertyDescriptor(n,d)),g===1?j={get:D.get,set:D.set}:g===2?j=D.value:g===3?j=D.get:g===4&&(j=D.set);for(var U=u?2:1,q=H.length-1;q>=0;q-=U){var J;(G=Une(H[q],u?H[q-1]:void 0,d,D,s,g,x,T,j,I,O))!==void 0&&(BB(g,G),g===0?J=G:g===1?(J=G.init,X=G.get||j.get,te=G.set||j.set,j={get:X,set:te}):j=G,J!==void 0&&(N===void 0?N=J:typeof N=="function"?N=[N,J]:N.push(J)))}if(g===0||g===1){if(N===void 0)N=function(Me,Se){return Se};else if(typeof N!="function"){var pe=N;N=function(Me,Se){for(var ge=Se,se=pe.length-1;se>=0;se--)ge=pe[se].call(Me,ge);return ge}}else{var ue=N;N=function(Me,Se){return ue.call(Me,Se)}}t.push(N)}g!==0&&(g===1?(D.get=j.get,D.set=j.set):g===2?D.value=j:g===3?D.get=j:g===4&&(D.set=j),T?g===1?(t.push(function(Me,Se){return j.get.call(Me,Se)}),t.push(function(Me,Se){return j.set.call(Me,Se)})):g===2?t.push(j):t.push(function(Me,Se){return j.call(Me,Se)}):Object.defineProperty(n,d,D))}function Hne(t,n,o,u){for(var d,g,x,T=[],s=new Map,I=new Map,O=0;O<n.length;O++){var D=n[O];if(Array.isArray(D)){var N,j,G=D[1],X=D[2],te=D.length>3,H=16&G,U=!!(8&G),q=o;if(G&=7,U?(N=t,G!==0&&(j=g=g||[]),te&&!x&&(x=function(ue){return Xne(ue)===t}),q=x):(N=t.prototype,G!==0&&(j=d=d||[])),G!==0&&!te){var J=U?I:s,pe=J.get(X)||0;if(pe===!0||pe===3&&G!==4||pe===4&&G!==3)throw new Error("Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: "+X);J.set(X,!(!pe&&G>2)||G)}Wne(T,N,D,H,X,G,U,te,j,q,u)}}return M4(T,d),M4(T,g),T}function M4(t,n){n&&t.push(function(o){for(var u=0;u<n.length;u++)n[u].call(o);return o})}function Zne(t,n,o,u){if(n.length){for(var d=[],g=t,x=t.name,T=o?2:1,s=n.length-1;s>=0;s-=T){var I={v:!1};try{var O=n[s].call(o?n[s-1]:void 0,g,{kind:"class",name:x,addInitializer:FB(d,I),metadata:u})}finally{I.v=!0}O!==void 0&&(BB(5,O),g=O)}return[jB(g,u),function(){for(var D=0;D<d.length;D++)d[D].call(g)}]}}function jB(t,n){return Object.defineProperty(t,Symbol.metadata||Symbol.for("Symbol.metadata"),{configurable:!0,enumerable:!0,value:n})}function $B(t,n,o,u,d,g){if(arguments.length>=6)var x=g[Symbol.metadata||Symbol.for("Symbol.metadata")];var T=Object.create(x===void 0?null:x),s=Hne(t,n,d,T);return o.length||jB(t,T),{e:s,get c(){return Zne(t,o,u,T)}}}function Xne(t){if(Object(t)!==t)throw TypeError("right-hand side of 'in' should be an object, got "+(t!==null?typeof t:"null"));return t}function _x(t,{name:n,addInitializer:o}){o(function(){this[n]=t.bind(this)})}function Yne(t){return requestAnimationFrame(()=>{requestAnimationFrame(t)})}class $l extends ll{constructor(n){super(n),this.data=n}get source(){return this.data.source}get originalSource(){return this.data.originalSource}get mirror(){return this.data.mirror}get sourceContainer(){return this.data.sourceContainer}get sensorEvent(){return this.data.sensorEvent}get originalEvent(){return this.sensorEvent?this.sensorEvent.originalEvent:null}}$l.type="drag";class RI extends $l{}RI.type="drag:start";RI.cancelable=!0;class UB extends $l{}UB.type="drag:move";class j1 extends $l{get overContainer(){return this.data.overContainer}get over(){return this.data.over}}j1.type="drag:over";j1.cancelable=!0;function Qne(t){return t.type===j1.type}class VB extends $l{get overContainer(){return this.data.overContainer}get over(){return this.data.over}}VB.type="drag:out";class GB extends $l{get overContainer(){return this.data.overContainer}}GB.type="drag:over:container";class qB extends $l{get overContainer(){return this.data.overContainer}}qB.type="drag:out:container";class WB extends $l{get pressure(){return this.data.pressure}}WB.type="drag:pressure";class LI extends $l{}LI.type="drag:stop";LI.cancelable=!0;class HB extends $l{}HB.type="drag:stopped";var ZB,XB;class YB extends eh{constructor(n){ZB(super(n)),this.lastWidth=0,this.lastHeight=0,this.mirror=null}attach(){this.draggable.on("mirror:created",this.onMirrorCreated).on("drag:over",this.onDragOver).on("drag:over:container",this.onDragOver)}detach(){this.draggable.off("mirror:created",this.onMirrorCreated).off("mirror:destroy",this.onMirrorDestroy).off("drag:over",this.onDragOver).off("drag:over:container",this.onDragOver)}getOptions(){return this.draggable.options.resizeMirror||{}}onMirrorCreated({mirror:n}){this.mirror=n}onMirrorDestroy(){this.mirror=null}onDragOver(n){this.resize(n)}resize(n){requestAnimationFrame(()=>{let o=null;const{overContainer:u}=n;if(this.mirror==null||this.mirror.parentNode==null)return;this.mirror.parentNode!==u&&u.appendChild(this.mirror),Qne(n)&&(o=n.over);const d=o||this.draggable.getDraggableElementsForContainer(u)[0];d&&Yne(()=>{const g=d.getBoundingClientRect();this.mirror==null||this.lastHeight===g.height&&this.lastWidth===g.width||(this.mirror.style.width=`${g.width}px`,this.mirror.style.height=`${g.height}px`,this.lastWidth=g.width,this.lastHeight=g.height)})})}}XB=YB;[ZB]=$B(XB,[[_x,2,"onMirrorCreated"],[_x,2,"onMirrorDestroy"],[_x,2,"onDragOver"]],[],0,void 0,eh).e;class zI extends ll{get dragEvent(){return this.data.dragEvent}get snappable(){return this.data.snappable}}zI.type="snap";class QB extends zI{}QB.type="snap:in";QB.cancelable=!0;class KB extends zI{}KB.type="snap:out";KB.cancelable=!0;var JB,ej;const Kne={duration:150,easingFunction:"ease-in-out",horizontal:!1};class Jne extends eh{constructor(n){JB(super(n)),this.options={...Kne,...this.getOptions()},this.lastAnimationFrame=null}attach(){this.draggable.on("sortable:sorted",this.onSortableSorted)}detach(){this.draggable.off("sortable:sorted",this.onSortableSorted)}getOptions(){return this.draggable.options.swapAnimation||{}}onSortableSorted({oldIndex:n,newIndex:o,dragEvent:u}){const{source:d,over:g}=u;this.lastAnimationFrame&&cancelAnimationFrame(this.lastAnimationFrame),this.lastAnimationFrame=requestAnimationFrame(()=>{n>=o?I4(d,g,this.options):I4(g,d,this.options)})}}ej=Jne;[JB]=$B(ej,[[_x,2,"onSortableSorted"]],[],0,void 0,eh).e;function I4(t,n,{duration:o,easingFunction:u,horizontal:d}){for(const g of[t,n])g.style.pointerEvents="none";if(d){const g=t.offsetWidth;t.style.transform=`translate3d(${g}px, 0, 0)`,n.style.transform=`translate3d(-${g}px, 0, 0)`}else{const g=t.offsetHeight;t.style.transform=`translate3d(0, ${g}px, 0)`,n.style.transform=`translate3d(0, -${g}px, 0)`}requestAnimationFrame(()=>{for(const g of[t,n])g.addEventListener("transitionend",tj),g.style.transition=`transform ${o}ms ${u}`,g.style.transform=""})}function tj(t){t.target==null||!eie(t.target)||(t.target.style.transition="",t.target.style.pointerEvents="",t.target.removeEventListener("transitionend",tj))}function eie(t){return"style"in t}const F0=Symbol("onInitialize"),B0=Symbol("onDestroy"),A4=Symbol("announceEvent"),LS=Symbol("announceMessage"),tie="aria-relevant",rie="aria-atomic",nie="aria-live",iie="role",oie={expire:7e3};class sie extends eh{constructor(n){super(n),this.options={...oie,...this.getOptions()},this.originalTriggerMethod=this.draggable.trigger,this[F0]=this[F0].bind(this),this[B0]=this[B0].bind(this)}attach(){this.draggable.on("draggable:initialize",this[F0])}detach(){this.draggable.off("draggable:destroy",this[B0])}getOptions(){return this.draggable.options.announcements||{}}[A4](n){const o=this.options[n.type];o&&typeof o=="string"&&this[LS](o),o&&typeof o=="function"&&this[LS](o(n))}[LS](n){aie(n,{expire:this.options.expire})}[F0](){this.draggable.trigger=n=>{try{this[A4](n)}finally{this.originalTriggerMethod.call(this.draggable,n)}}}[B0](){this.draggable.trigger=this.originalTriggerMethod}}const CC=lie();function aie(t,{expire:n}){const o=document.createElement("div");return o.textContent=t,CC.appendChild(o),setTimeout(()=>{CC.removeChild(o)},n)}function lie(){const t=document.createElement("div");return t.setAttribute("id","draggable-live-region"),t.setAttribute(tie,"additions"),t.setAttribute(rie,"true"),t.setAttribute(nie,"assertive"),t.setAttribute(iie,"log"),t.style.position="fixed",t.style.width="1px",t.style.height="1px",t.style.top="-1px",t.style.overflow="hidden",t}document.addEventListener("DOMContentLoaded",()=>{document.body.appendChild(CC)});const Mg=Symbol("onInitialize"),wf=Symbol("onDestroy"),cie={};class uie extends eh{constructor(n){super(n),this.options={...cie,...this.getOptions()},this[Mg]=this[Mg].bind(this),this[wf]=this[wf].bind(this)}attach(){this.draggable.on("draggable:initialize",this[Mg]).on("draggable:destroy",this[wf])}detach(){this.draggable.off("draggable:initialize",this[Mg]).off("draggable:destroy",this[wf]),this[wf]()}getOptions(){return this.draggable.options.focusable||{}}getElements(){return[...this.draggable.containers,...this.draggable.getDraggableElements()]}[Mg](){requestAnimationFrame(()=>{this.getElements().forEach(n=>hie(n))})}[wf](){requestAnimationFrame(()=>{this.getElements().forEach(n=>die(n))})}}const MC=[];function hie(t){!t.getAttribute("tabindex")&&t.tabIndex===-1&&(MC.push(t),t.tabIndex=0)}function die(t){const n=MC.indexOf(t);n!==-1&&(t.tabIndex=-1,MC.splice(n,1))}class kp extends ll{constructor(n){super(n),this.data=n}get source(){return this.data.source}get originalSource(){return this.data.originalSource}get sourceContainer(){return this.data.sourceContainer}get sensorEvent(){return this.data.sensorEvent}get dragEvent(){return this.data.dragEvent}get originalEvent(){return this.sensorEvent?this.sensorEvent.originalEvent:null}}class rj extends kp{}rj.type="mirror:create";class nj extends kp{get mirror(){return this.data.mirror}}nj.type="mirror:created";class ij extends kp{get mirror(){return this.data.mirror}}ij.type="mirror:attached";class NI extends kp{get mirror(){return this.data.mirror}get passedThreshX(){return this.data.passedThreshX}get passedThreshY(){return this.data.passedThreshY}}NI.type="mirror:move";NI.cancelable=!0;class oj extends kp{get mirror(){return this.data.mirror}get passedThreshX(){return this.data.passedThreshX}get passedThreshY(){return this.data.passedThreshY}}oj.type="mirror:moved";class FI extends kp{get mirror(){return this.data.mirror}}FI.type="mirror:destroy";FI.cancelable=!0;const Ig=Symbol("onDragStart"),Ag=Symbol("onDragMove"),kg=Symbol("onDragStop"),Pg=Symbol("onMirrorCreated"),Og=Symbol("onMirrorMove"),Dg=Symbol("onScroll"),k4=Symbol("getAppendableContainer"),fie={constrainDimensions:!1,xAxis:!0,yAxis:!0,cursorOffsetX:null,cursorOffsetY:null,thresholdX:null,thresholdY:null};class pie extends eh{constructor(n){super(n),this.options={...fie,...this.getOptions()},this.scrollOffset={x:0,y:0},this.initialScrollOffset={x:window.scrollX,y:window.scrollY},this[Ig]=this[Ig].bind(this),this[Ag]=this[Ag].bind(this),this[kg]=this[kg].bind(this),this[Pg]=this[Pg].bind(this),this[Og]=this[Og].bind(this),this[Dg]=this[Dg].bind(this)}attach(){this.draggable.on("drag:start",this[Ig]).on("drag:move",this[Ag]).on("drag:stop",this[kg]).on("mirror:created",this[Pg]).on("mirror:move",this[Og])}detach(){this.draggable.off("drag:start",this[Ig]).off("drag:move",this[Ag]).off("drag:stop",this[kg]).off("mirror:created",this[Pg]).off("mirror:move",this[Og])}getOptions(){return this.draggable.options.mirror||{}}[Ig](n){if(n.canceled())return;"ontouchstart"in window&&document.addEventListener("scroll",this[Dg],!0),this.initialScrollOffset={x:window.scrollX,y:window.scrollY};const{source:o,originalSource:u,sourceContainer:d,sensorEvent:g}=n;this.lastMirrorMovedClient={x:g.clientX,y:g.clientY};const x=new rj({source:o,originalSource:u,sourceContainer:d,sensorEvent:g,dragEvent:n});if(this.draggable.trigger(x),xie(g)||x.canceled())return;const T=this[k4](o)||d;this.mirror=o.cloneNode(!0);const s=new nj({source:o,originalSource:u,sourceContainer:d,sensorEvent:g,dragEvent:n,mirror:this.mirror}),I=new ij({source:o,originalSource:u,sourceContainer:d,sensorEvent:g,dragEvent:n,mirror:this.mirror});this.draggable.trigger(s),T.appendChild(this.mirror),this.draggable.trigger(I)}[Ag](n){if(!this.mirror||n.canceled())return;const{source:o,originalSource:u,sourceContainer:d,sensorEvent:g}=n;let x=!0,T=!0;if(this.options.thresholdX||this.options.thresholdY){const{x:I,y:O}=this.lastMirrorMovedClient;if(Math.abs(I-g.clientX)<this.options.thresholdX?x=!1:this.lastMirrorMovedClient.x=g.clientX,Math.abs(O-g.clientY)<this.options.thresholdY?T=!1:this.lastMirrorMovedClient.y=g.clientY,!x&&!T)return}const s=new NI({source:o,originalSource:u,sourceContainer:d,sensorEvent:g,dragEvent:n,mirror:this.mirror,passedThreshX:x,passedThreshY:T});this.draggable.trigger(s)}[kg](n){if("ontouchstart"in window&&document.removeEventListener("scroll",this[Dg],!0),this.initialScrollOffset={x:0,y:0},this.scrollOffset={x:0,y:0},!this.mirror)return;const{source:o,sourceContainer:u,sensorEvent:d}=n,g=new FI({source:o,mirror:this.mirror,sourceContainer:u,sensorEvent:d,dragEvent:n});this.draggable.trigger(g),g.canceled()||this.mirror.remove()}[Dg](){this.scrollOffset={x:window.scrollX-this.initialScrollOffset.x,y:window.scrollY-this.initialScrollOffset.y}}[Pg]({mirror:n,source:o,sensorEvent:u}){const d=this.draggable.getClassNamesFor("mirror"),g=({mirrorOffset:T,initialX:s,initialY:I,...O})=>(this.mirrorOffset=T,this.initialX=s,this.initialY=I,this.lastMovedX=s,this.lastMovedY=I,{mirrorOffset:T,initialX:s,initialY:I,...O});n.style.display="none";const x={mirror:n,source:o,sensorEvent:u,mirrorClasses:d,scrollOffset:this.scrollOffset,options:this.options,passedThreshX:!0,passedThreshY:!0};return Promise.resolve(x).then(mie).then(gie).then(_ie).then(yie).then(P4({initial:!0})).then(vie).then(g)}[Og](n){if(n.canceled())return null;const o=({lastMovedX:g,lastMovedY:x,...T})=>(this.lastMovedX=g,this.lastMovedY=x,{lastMovedX:g,lastMovedY:x,...T}),u=g=>{const x=new oj({source:n.source,originalSource:n.originalSource,sourceContainer:n.sourceContainer,sensorEvent:n.sensorEvent,dragEvent:n.dragEvent,mirror:this.mirror,passedThreshX:n.passedThreshX,passedThreshY:n.passedThreshY});return this.draggable.trigger(x),g},d={mirror:n.mirror,sensorEvent:n.sensorEvent,mirrorOffset:this.mirrorOffset,options:this.options,initialX:this.initialX,initialY:this.initialY,scrollOffset:this.scrollOffset,passedThreshX:n.passedThreshX,passedThreshY:n.passedThreshY,lastMovedX:this.lastMovedX,lastMovedY:this.lastMovedY};return Promise.resolve(d).then(P4({raf:!0})).then(o).then(u)}[k4](n){const o=this.options.appendTo;return typeof o=="string"?document.querySelector(o):o instanceof HTMLElement?o:typeof o=="function"?o(n):n.parentNode}}function mie({source:t,...n}){return Pp(o=>{const u=t.getBoundingClientRect();o({source:t,sourceRect:u,...n})})}function gie({sensorEvent:t,sourceRect:n,options:o,...u}){return Pp(d=>{const g=o.cursorOffsetY===null?t.clientY-n.top:o.cursorOffsetY,x=o.cursorOffsetX===null?t.clientX-n.left:o.cursorOffsetX;d({sensorEvent:t,sourceRect:n,mirrorOffset:{top:g,left:x},options:o,...u})})}function _ie({mirror:t,source:n,options:o,...u}){return Pp(d=>{let g,x;if(o.constrainDimensions){const T=getComputedStyle(n);g=T.getPropertyValue("height"),x=T.getPropertyValue("width")}t.style.display=null,t.style.position="fixed",t.style.pointerEvents="none",t.style.top=0,t.style.left=0,t.style.margin=0,o.constrainDimensions&&(t.style.height=g,t.style.width=x),d({mirror:t,source:n,options:o,...u})})}function yie({mirror:t,mirrorClasses:n,...o}){return Pp(u=>{t.classList.add(...n),u({mirror:t,mirrorClasses:n,...o})})}function vie({mirror:t,...n}){return Pp(o=>{t.removeAttribute("id"),delete t.id,o({mirror:t,...n})})}function P4({withFrame:t=!1,initial:n=!1}={}){return({mirror:o,sensorEvent:u,mirrorOffset:d,initialY:g,initialX:x,scrollOffset:T,options:s,passedThreshX:I,passedThreshY:O,lastMovedX:D,lastMovedY:N,...j})=>Pp(G=>{const X={mirror:o,sensorEvent:u,mirrorOffset:d,options:s,...j};if(d){const te=I?Math.round((u.clientX-d.left-T.x)/(s.thresholdX||1))*(s.thresholdX||1):Math.round(D),H=O?Math.round((u.clientY-d.top-T.y)/(s.thresholdY||1))*(s.thresholdY||1):Math.round(N);s.xAxis&&s.yAxis||n?o.style.transform=`translate3d(${te}px, ${H}px, 0)`:s.xAxis&&!s.yAxis?o.style.transform=`translate3d(${te}px, ${g}px, 0)`:s.yAxis&&!s.xAxis&&(o.style.transform=`translate3d(${x}px, ${H}px, 0)`),n&&(X.initialX=te,X.initialY=H),X.lastMovedX=te,X.lastMovedY=H}G(X)},{frame:t})}function Pp(t,{raf:n=!1}={}){return new Promise((o,u)=>{n?requestAnimationFrame(()=>{t(o,u)}):t(o,u)})}function xie(t){return/^drag/.test(t.originalEvent.type)}const Rg=Symbol("onDragStart"),Lg=Symbol("onDragMove"),zg=Symbol("onDragStop"),Ng=Symbol("scroll"),bie={speed:6,sensitivity:50,scrollableElements:[]};class wie extends eh{constructor(n){super(n),this.options={...bie,...this.getOptions()},this.currentMousePosition=null,this.scrollAnimationFrame=null,this.scrollableElement=null,this.findScrollableElementFrame=null,this[Rg]=this[Rg].bind(this),this[Lg]=this[Lg].bind(this),this[zg]=this[zg].bind(this),this[Ng]=this[Ng].bind(this)}attach(){this.draggable.on("drag:start",this[Rg]).on("drag:move",this[Lg]).on("drag:stop",this[zg])}detach(){this.draggable.off("drag:start",this[Rg]).off("drag:move",this[Lg]).off("drag:stop",this[zg])}getOptions(){return this.draggable.options.scrollable||{}}getScrollableElement(n){return this.hasDefinedScrollableElements()?Ma(n,this.options.scrollableElements)||document.documentElement:Tie(n)}hasDefinedScrollableElements(){return this.options.scrollableElements.length!==0}[Rg](n){this.findScrollableElementFrame=requestAnimationFrame(()=>{this.scrollableElement=this.getScrollableElement(n.source)})}[Lg](n){if(this.findScrollableElementFrame=requestAnimationFrame(()=>{this.scrollableElement=this.getScrollableElement(n.sensorEvent.target)}),!this.scrollableElement)return;const o=n.sensorEvent,u={x:0,y:0};"ontouchstart"in window&&(u.y=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0,u.x=window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0),this.currentMousePosition={clientX:o.clientX-u.x,clientY:o.clientY-u.y},this.scrollAnimationFrame=requestAnimationFrame(this[Ng])}[zg](){cancelAnimationFrame(this.scrollAnimationFrame),cancelAnimationFrame(this.findScrollableElementFrame),this.scrollableElement=null,this.scrollAnimationFrame=null,this.findScrollableElementFrame=null,this.currentMousePosition=null}[Ng](){if(!this.scrollableElement||!this.currentMousePosition)return;cancelAnimationFrame(this.scrollAnimationFrame);const{speed:n,sensitivity:o}=this.options,u=this.scrollableElement.getBoundingClientRect(),d=u.bottom>window.innerHeight,x=u.top<0||d,T=IC(),s=this.scrollableElement,I=this.currentMousePosition.clientX,O=this.currentMousePosition.clientY;if(s!==document.body&&s!==document.documentElement&&!x){const{offsetHeight:D,offsetWidth:N}=s;u.top+D-O<o?s.scrollTop+=n:O-u.top<o&&(s.scrollTop-=n),u.left+N-I<o?s.scrollLeft+=n:I-u.left<o&&(s.scrollLeft-=n)}else{const{innerHeight:D,innerWidth:N}=window;O<o?T.scrollTop-=n:D-O<o&&(T.scrollTop+=n),I<o?T.scrollLeft-=n:N-I<o&&(T.scrollLeft+=n)}this.scrollAnimationFrame=requestAnimationFrame(this[Ng])}}function Eie(t){const n=/(auto|scroll)/,o=getComputedStyle(t,null),u=o.getPropertyValue("overflow")+o.getPropertyValue("overflow-y")+o.getPropertyValue("overflow-x");return n.test(u)}function Sie(t){return getComputedStyle(t).getPropertyValue("position")==="static"}function Tie(t){if(!t)return IC();const n=getComputedStyle(t).getPropertyValue("position"),o=n==="absolute",u=Ma(t,d=>o&&Sie(d)?!1:Eie(d));return n==="fixed"||!u?IC():u}function IC(){return document.scrollingElement||document.documentElement}class Cie{constructor(){this.callbacks={}}on(n,...o){return this.callbacks[n]||(this.callbacks[n]=[]),this.callbacks[n].push(...o),this}off(n,o){if(!this.callbacks[n])return null;const u=this.callbacks[n].slice(0);for(let d=0;d<u.length;d++)o===u[d]&&this.callbacks[n].splice(d,1);return this}trigger(n){if(!this.callbacks[n.type])return null;const o=[...this.callbacks[n.type]],u=[];for(let d=o.length-1;d>=0;d--){const g=o[d];try{g(n)}catch(x){u.push(x)}}return u.length&&console.error(`Draggable caught errors while triggering '${n.type}'`,u),this}}class BI extends ll{get draggable(){return this.data.draggable}}BI.type="draggable";class sj extends BI{}sj.type="draggable:initialize";class aj extends BI{}aj.type="draggable:destroy";const Fg=Symbol("onDragStart"),Ef=Symbol("onDragMove"),Bg=Symbol("onDragStop"),jg=Symbol("onDragPressure"),$g=Symbol("dragStop"),Mie={"drag:start":t=>`Picked up ${t.source.textContent.trim()||t.source.id||"draggable element"}`,"drag:stop":t=>`Released ${t.source.textContent.trim()||t.source.id||"draggable element"}`},Iie={"container:dragging":"draggable-container--is-dragging","source:dragging":"draggable-source--is-dragging","source:placed":"draggable-source--placed","container:placed":"draggable-container--placed","body:dragging":"draggable--is-dragging","draggable:over":"draggable--over","container:over":"draggable-container--over","source:original":"draggable--original",mirror:"draggable-mirror"},Aie={draggable:".draggable-source",handle:null,delay:{},distance:0,placedTimeout:800,plugins:[],sensors:[],exclude:{plugins:[],sensors:[]}};class yp{constructor(n=[document.body],o={}){if(n instanceof NodeList||n instanceof Array)this.containers=[...n];else if(n instanceof HTMLElement)this.containers=[n];else throw new Error("Draggable containers are expected to be of type `NodeList`, `HTMLElement[]` or `HTMLElement`");this.options={...Aie,...o,classes:{...Iie,...o.classes||{}},announcements:{...Mie,...o.announcements||{}},exclude:{plugins:o.exclude&&o.exclude.plugins||[],sensors:o.exclude&&o.exclude.sensors||[]}},this.emitter=new Cie,this.dragging=!1,this.plugins=[],this.sensors=[],this[Fg]=this[Fg].bind(this),this[Ef]=this[Ef].bind(this),this[Bg]=this[Bg].bind(this),this[jg]=this[jg].bind(this),this[$g]=this[$g].bind(this),document.addEventListener("drag:start",this[Fg],!0),document.addEventListener("drag:move",this[Ef],!0),document.addEventListener("drag:stop",this[Bg],!0),document.addEventListener("drag:pressure",this[jg],!0);const u=Object.values(yp.Plugins).filter(x=>!this.options.exclude.plugins.includes(x)),d=Object.values(yp.Sensors).filter(x=>!this.options.exclude.sensors.includes(x));this.addPlugin(...u,...this.options.plugins),this.addSensor(...d,...this.options.sensors);const g=new sj({draggable:this});this.on("mirror:created",({mirror:x})=>this.mirror=x),this.on("mirror:destroy",()=>this.mirror=null),this.trigger(g)}destroy(){document.removeEventListener("drag:start",this[Fg],!0),document.removeEventListener("drag:move",this[Ef],!0),document.removeEventListener("drag:stop",this[Bg],!0),document.removeEventListener("drag:pressure",this[jg],!0);const n=new aj({draggable:this});this.trigger(n),this.removePlugin(...this.plugins.map(o=>o.constructor)),this.removeSensor(...this.sensors.map(o=>o.constructor))}addPlugin(...n){const o=n.map(u=>new u(this));return o.forEach(u=>u.attach()),this.plugins=[...this.plugins,...o],this}removePlugin(...n){return this.plugins.filter(u=>n.includes(u.constructor)).forEach(u=>u.detach()),this.plugins=this.plugins.filter(u=>!n.includes(u.constructor)),this}addSensor(...n){const o=n.map(u=>new u(this.containers,this.options));return o.forEach(u=>u.attach()),this.sensors=[...this.sensors,...o],this}removeSensor(...n){return this.sensors.filter(u=>n.includes(u.constructor)).forEach(u=>u.detach()),this.sensors=this.sensors.filter(u=>!n.includes(u.constructor)),this}addContainer(...n){return this.containers=[...this.containers,...n],this.sensors.forEach(o=>o.addContainer(...n)),this}removeContainer(...n){return this.containers=this.containers.filter(o=>!n.includes(o)),this.sensors.forEach(o=>o.removeContainer(...n)),this}on(n,...o){return this.emitter.on(n,...o),this}off(n,o){return this.emitter.off(n,o),this}trigger(n){return this.emitter.trigger(n),this}getClassNameFor(n){return this.getClassNamesFor(n)[0]}getClassNamesFor(n){const o=this.options.classes[n];return o instanceof Array?o:typeof o=="string"||o instanceof String?[o]:[]}isDragging(){return!!this.dragging}getDraggableElements(){return this.containers.reduce((n,o)=>[...n,...this.getDraggableElementsForContainer(o)],[])}getDraggableElementsForContainer(n){return[...n.querySelectorAll(this.options.draggable)].filter(u=>u!==this.originalSource&&u!==this.mirror)}cancel(){this[$g]()}[Fg](n){const o=j0(n),{target:u,container:d,originalSource:g}=o;if(!this.containers.includes(d))return;if(this.options.handle&&u&&!Ma(u,this.options.handle)){o.cancel();return}this.originalSource=g,this.sourceContainer=d,this.lastPlacedSource&&this.lastPlacedContainer&&(clearTimeout(this.placedTimeoutID),this.lastPlacedSource.classList.remove(...this.getClassNamesFor("source:placed")),this.lastPlacedContainer.classList.remove(...this.getClassNamesFor("container:placed"))),this.source=this.originalSource.cloneNode(!0),this.originalSource.parentNode.insertBefore(this.source,this.originalSource),this.originalSource.style.display="none";const x=new RI({source:this.source,originalSource:this.originalSource,sourceContainer:d,sensorEvent:o});if(this.trigger(x),this.dragging=!x.canceled(),x.canceled()){this.source.remove(),this.originalSource.style.display=null;return}this.originalSource.classList.add(...this.getClassNamesFor("source:original")),this.source.classList.add(...this.getClassNamesFor("source:dragging")),this.sourceContainer.classList.add(...this.getClassNamesFor("container:dragging")),document.body.classList.add(...this.getClassNamesFor("body:dragging")),O4(document.body,"none"),requestAnimationFrame(()=>{const s=j0(n).clone({target:this.source});this[Ef]({...n,detail:s})})}[Ef](n){if(!this.dragging)return;const o=j0(n),{container:u}=o;let d=o.target;const g=new UB({source:this.source,originalSource:this.originalSource,sourceContainer:u,sensorEvent:o});this.trigger(g),g.canceled()&&o.cancel(),d=Ma(d,this.options.draggable);const x=Ma(o.target,this.containers),T=o.overContainer||x,s=this.currentOverContainer&&T!==this.currentOverContainer,I=this.currentOver&&d!==this.currentOver,O=T&&this.currentOverContainer!==T,D=x&&d&&this.currentOver!==d;if(I){const N=new VB({source:this.source,originalSource:this.originalSource,sourceContainer:u,sensorEvent:o,over:this.currentOver,overContainer:this.currentOverContainer});this.currentOver.classList.remove(...this.getClassNamesFor("draggable:over")),this.currentOver=null,this.trigger(N)}if(s){const N=new qB({source:this.source,originalSource:this.originalSource,sourceContainer:u,sensorEvent:o,overContainer:this.currentOverContainer});this.currentOverContainer.classList.remove(...this.getClassNamesFor("container:over")),this.currentOverContainer=null,this.trigger(N)}if(O){T.classList.add(...this.getClassNamesFor("container:over"));const N=new GB({source:this.source,originalSource:this.originalSource,sourceContainer:u,sensorEvent:o,overContainer:T});this.currentOverContainer=T,this.trigger(N)}if(D){d.classList.add(...this.getClassNamesFor("draggable:over"));const N=new j1({source:this.source,originalSource:this.originalSource,sourceContainer:u,sensorEvent:o,overContainer:T,over:d});this.currentOver=d,this.trigger(N)}}[$g](n){if(!this.dragging)return;this.dragging=!1;const o=new LI({source:this.source,originalSource:this.originalSource,sensorEvent:n?n.sensorEvent:null,sourceContainer:this.sourceContainer});this.trigger(o),o.canceled()||this.source.parentNode.insertBefore(this.originalSource,this.source),this.source.remove(),this.originalSource.style.display="",this.source.classList.remove(...this.getClassNamesFor("source:dragging")),this.originalSource.classList.remove(...this.getClassNamesFor("source:original")),this.originalSource.classList.add(...this.getClassNamesFor("source:placed")),this.sourceContainer.classList.add(...this.getClassNamesFor("container:placed")),this.sourceContainer.classList.remove(...this.getClassNamesFor("container:dragging")),document.body.classList.remove(...this.getClassNamesFor("body:dragging")),O4(document.body,""),this.currentOver&&this.currentOver.classList.remove(...this.getClassNamesFor("draggable:over")),this.currentOverContainer&&this.currentOverContainer.classList.remove(...this.getClassNamesFor("container:over")),this.lastPlacedSource=this.originalSource,this.lastPlacedContainer=this.sourceContainer,this.placedTimeoutID=setTimeout(()=>{this.lastPlacedSource&&this.lastPlacedSource.classList.remove(...this.getClassNamesFor("source:placed")),this.lastPlacedContainer&&this.lastPlacedContainer.classList.remove(...this.getClassNamesFor("container:placed")),this.lastPlacedSource=null,this.lastPlacedContainer=null},this.options.placedTimeout);const u=new HB({source:this.source,originalSource:this.originalSource,sensorEvent:n?n.sensorEvent:null,sourceContainer:this.sourceContainer});this.trigger(u),this.source=null,this.originalSource=null,this.currentOverContainer=null,this.currentOver=null,this.sourceContainer=null}[Bg](n){this[$g](n)}[jg](n){if(!this.dragging)return;const o=j0(n),u=this.source||Ma(o.originalEvent.target,this.options.draggable),d=new WB({sensorEvent:o,source:u,pressure:o.pressure});this.trigger(d)}}yp.Plugins={Announcement:sie,Focusable:uie,Mirror:pie,Scrollable:wie};yp.Sensors={MouseSensor:Fne,TouchSensor:Bne};function j0(t){return t.detail}function O4(t,n){t.style.webkitUserSelect=n,t.style.mozUserSelect=n,t.style.msUserSelect=n,t.style.oUserSelect=n,t.style.userSelect=n}class yy extends ll{constructor(n){super(n),this.data=n}get dragEvent(){return this.data.dragEvent}}yy.type="droppable";class lj extends yy{get dropzone(){return this.data.dropzone}}lj.type="droppable:start";lj.cancelable=!0;class cj extends yy{get dropzone(){return this.data.dropzone}}cj.type="droppable:dropped";cj.cancelable=!0;class uj extends yy{get dropzone(){return this.data.dropzone}}uj.type="droppable:returned";uj.cancelable=!0;class hj extends yy{get dropzone(){return this.data.dropzone}}hj.type="droppable:stop";hj.cancelable=!0;class vy extends ll{constructor(n){super(n),this.data=n}get dragEvent(){return this.data.dragEvent}}vy.type="swappable";class dj extends vy{}dj.type="swappable:start";dj.cancelable=!0;class fj extends vy{get over(){return this.data.over}get overContainer(){return this.data.overContainer}}fj.type="swappable:swap";fj.cancelable=!0;class kie extends vy{get swappedElement(){return this.data.swappedElement}}kie.type="swappable:swapped";class Pie extends vy{}Pie.type="swappable:stop";class xy extends ll{constructor(n){super(n),this.data=n}get dragEvent(){return this.data.dragEvent}}xy.type="sortable";class jI extends xy{get startIndex(){return this.data.startIndex}get startContainer(){return this.data.startContainer}}jI.type="sortable:start";jI.cancelable=!0;class r1 extends xy{get currentIndex(){return this.data.currentIndex}get over(){return this.data.over}get overContainer(){return this.data.dragEvent.overContainer}}r1.type="sortable:sort";r1.cancelable=!0;class AC extends xy{get oldIndex(){return this.data.oldIndex}get newIndex(){return this.data.newIndex}get oldContainer(){return this.data.oldContainer}get newContainer(){return this.data.newContainer}}AC.type="sortable:sorted";class pj extends xy{get oldIndex(){return this.data.oldIndex}get newIndex(){return this.data.newIndex}get oldContainer(){return this.data.oldContainer}get newContainer(){return this.data.newContainer}}pj.type="sortable:stop";const Ug=Symbol("onDragStart"),Vg=Symbol("onDragOverContainer"),Gg=Symbol("onDragOver"),qg=Symbol("onDragStop");function Oie({dragEvent:t}){const n=t.source.textContent.trim()||t.source.id||"sortable element";if(t.over){const o=t.over.textContent.trim()||t.over.id||"sortable element";return t.source.compareDocumentPosition(t.over)&Node.DOCUMENT_POSITION_FOLLOWING?`Placed ${n} after ${o}`:`Placed ${n} before ${o}`}else return`Placed ${n} into a different container`}const Die={"sortable:sorted":Oie};class Rie extends yp{constructor(n=[],o={}){super(n,{...o,announcements:{...Die,...o.announcements||{}}}),this.startIndex=null,this.startContainer=null,this[Ug]=this[Ug].bind(this),this[Vg]=this[Vg].bind(this),this[Gg]=this[Gg].bind(this),this[qg]=this[qg].bind(this),this.on("drag:start",this[Ug]).on("drag:over:container",this[Vg]).on("drag:over",this[Gg]).on("drag:stop",this[qg])}destroy(){super.destroy(),this.off("drag:start",this[Ug]).off("drag:over:container",this[Vg]).off("drag:over",this[Gg]).off("drag:stop",this[qg])}index(n){return this.getSortableElementsForContainer(n.parentNode).indexOf(n)}getSortableElementsForContainer(n){return[...n.querySelectorAll(this.options.draggable)].filter(u=>u!==this.originalSource&&u!==this.mirror&&u.parentNode===n)}[Ug](n){this.startContainer=n.source.parentNode,this.startIndex=this.index(n.source);const o=new jI({dragEvent:n,startIndex:this.startIndex,startContainer:this.startContainer});this.trigger(o),o.canceled()&&n.cancel()}[Vg](n){if(n.canceled())return;const{source:o,over:u,overContainer:d}=n,g=this.index(o),x=new r1({dragEvent:n,currentIndex:g,source:o,over:u});if(this.trigger(x),x.canceled())return;const T=this.getSortableElementsForContainer(d),s=R4({source:o,over:u,overContainer:d,children:T});if(!s)return;const{oldContainer:I,newContainer:O}=s,D=this.index(n.source),N=new AC({dragEvent:n,oldIndex:g,newIndex:D,oldContainer:I,newContainer:O});this.trigger(N)}[Gg](n){if(n.over===n.originalSource||n.over===n.source)return;const{source:o,over:u,overContainer:d}=n,g=this.index(o),x=new r1({dragEvent:n,currentIndex:g,source:o,over:u});if(this.trigger(x),x.canceled())return;const T=this.getDraggableElementsForContainer(d),s=R4({source:o,over:u,overContainer:d,children:T});if(!s)return;const{oldContainer:I,newContainer:O}=s,D=this.index(o),N=new AC({dragEvent:n,oldIndex:g,newIndex:D,oldContainer:I,newContainer:O});this.trigger(N)}[qg](n){const o=new pj({dragEvent:n,oldIndex:this.startIndex,newIndex:this.index(n.source),oldContainer:this.startContainer,newContainer:n.source.parentNode});this.trigger(o),this.startIndex=null,this.startContainer=null}}function D4(t){return Array.prototype.indexOf.call(t.parentNode.children,t)}function R4({source:t,over:n,overContainer:o,children:u}){const d=!u.length,g=t.parentNode!==o,x=n&&t.parentNode===n.parentNode;return d?Lie(t,o):x?zie(t,n):g?Nie(t,n,o):null}function Lie(t,n){const o=t.parentNode;return n.appendChild(t),{oldContainer:o,newContainer:n}}function zie(t,n){const o=D4(t),u=D4(n);return o<u?t.parentNode.insertBefore(t,n.nextElementSibling):t.parentNode.insertBefore(t,n),{oldContainer:t.parentNode,newContainer:t.parentNode}}function Nie(t,n,o){const u=t.parentNode;return n?n.parentNode.insertBefore(t,n):o.appendChild(t),{oldContainer:u,newContainer:t.parentNode}}const Fie="_root_1thkj_1",Bie="_sideBar_1thkj_7",jie="_view_1thkj_14",$ie="_body_1thkj_20",$0={root:Fie,sideBar:Bie,view:jie,body:$ie},zS="focusScope.autoFocusOnMount",NS="focusScope.autoFocusOnUnmount",L4={bubbles:!1,cancelable:!0},Uie=W.forwardRef((t,n)=>{const{loop:o=!1,trapped:u=!1,onMountAutoFocus:d,onUnmountAutoFocus:g,...x}=t,[T,s]=W.useState(null),I=qu(d),O=qu(g),D=W.useRef(null),N=La(n,X=>s(X)),j=W.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;W.useEffect(()=>{if(u){let U=function(ue){if(j.paused||!T)return;const Me=ue.target;T.contains(Me)?D.current=Me:_u(D.current,{select:!0})},q=function(ue){if(j.paused||!T)return;const Me=ue.relatedTarget;Me!==null&&(T.contains(Me)||_u(D.current,{select:!0}))},J=function(ue){if(document.activeElement===document.body)for(const Se of ue)Se.removedNodes.length>0&&_u(T)};var X=U,te=q,H=J;document.addEventListener("focusin",U),document.addEventListener("focusout",q);const pe=new MutationObserver(J);return T&&pe.observe(T,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",U),document.removeEventListener("focusout",q),pe.disconnect()}}},[u,T,j.paused]),W.useEffect(()=>{if(T){N4.add(j);const X=document.activeElement;if(!T.contains(X)){const H=new CustomEvent(zS,L4);T.addEventListener(zS,I),T.dispatchEvent(H),H.defaultPrevented||(Vie(Zie(mj(T)),{select:!0}),document.activeElement===X&&_u(T))}return()=>{T.removeEventListener(zS,I),setTimeout(()=>{const H=new CustomEvent(NS,L4);T.addEventListener(NS,O),T.dispatchEvent(H),H.defaultPrevented||_u(X??document.body,{select:!0}),T.removeEventListener(NS,O),N4.remove(j)},0)}}},[T,I,O,j]);const G=W.useCallback(X=>{if(!o&&!u||j.paused)return;const te=X.key==="Tab"&&!X.altKey&&!X.ctrlKey&&!X.metaKey,H=document.activeElement;if(te&&H){const U=X.currentTarget,[q,J]=Gie(U);q&&J?!X.shiftKey&&H===J?(X.preventDefault(),o&&_u(q,{select:!0})):X.shiftKey&&H===q&&(X.preventDefault(),o&&_u(J,{select:!0})):H===U&&X.preventDefault()}},[o,u,j.paused]);return W.createElement(js.div,bn({tabIndex:-1},x,{ref:N,onKeyDown:G}))});function Vie(t,{select:n=!1}={}){const o=document.activeElement;for(const u of t)if(_u(u,{select:n}),document.activeElement!==o)return}function Gie(t){const n=mj(t),o=z4(n,t),u=z4(n.reverse(),t);return[o,u]}function mj(t){const n=[],o=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:u=>{const d=u.tagName==="INPUT"&&u.type==="hidden";return u.disabled||u.hidden||d?NodeFilter.FILTER_SKIP:u.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;o.nextNode();)n.push(o.currentNode);return n}function z4(t,n){for(const o of t)if(!qie(o,{upTo:n}))return o}function qie(t,{upTo:n}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(n!==void 0&&t===n)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function Wie(t){return t instanceof HTMLInputElement&&"select"in t}function _u(t,{select:n=!1}={}){if(t&&t.focus){const o=document.activeElement;t.focus({preventScroll:!0}),t!==o&&Wie(t)&&n&&t.select()}}const N4=Hie();function Hie(){let t=[];return{add(n){const o=t[0];n!==o&&(o==null||o.pause()),t=F4(t,n),t.unshift(n)},remove(n){var o;t=F4(t,n),(o=t[0])===null||o===void 0||o.resume()}}}function F4(t,n){const o=[...t],u=o.indexOf(n);return u!==-1&&o.splice(u,1),o}function Zie(t){return t.filter(n=>n.tagName!=="A")}let FS=0;function Xie(){W.useEffect(()=>{var t,n;const o=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(t=o[0])!==null&&t!==void 0?t:B4()),document.body.insertAdjacentElement("beforeend",(n=o[1])!==null&&n!==void 0?n:B4()),FS++,()=>{FS===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(u=>u.remove()),FS--}},[])}function B4(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",t}var yx="right-scroll-bar-position",vx="width-before-scroll-bar",Yie="with-scroll-bars-hidden",Qie="--removed-body-scroll-bar-size";function BS(t,n){return typeof t=="function"?t(n):t&&(t.current=n),t}function Kie(t,n){var o=W.useState(function(){return{value:t,callback:n,facade:{get current(){return o.value},set current(u){var d=o.value;d!==u&&(o.value=u,o.callback(u,d))}}}})[0];return o.callback=n,o.facade}var Jie=typeof window<"u"?W.useLayoutEffect:W.useEffect,j4=new WeakMap;function eoe(t,n){var o=Kie(n||null,function(u){return t.forEach(function(d){return BS(d,u)})});return Jie(function(){var u=j4.get(o);if(u){var d=new Set(u),g=new Set(t),x=o.current;d.forEach(function(T){g.has(T)||BS(T,null)}),g.forEach(function(T){d.has(T)||BS(T,x)})}j4.set(o,t)},[t]),o}function toe(t){return t}function roe(t,n){n===void 0&&(n=toe);var o=[],u=!1,d={read:function(){if(u)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return o.length?o[o.length-1]:t},useMedium:function(g){var x=n(g,u);return o.push(x),function(){o=o.filter(function(T){return T!==x})}},assignSyncMedium:function(g){for(u=!0;o.length;){var x=o;o=[],x.forEach(g)}o={push:function(T){return g(T)},filter:function(){return o}}},assignMedium:function(g){u=!0;var x=[];if(o.length){var T=o;o=[],T.forEach(g),x=o}var s=function(){var O=x;x=[],O.forEach(g)},I=function(){return Promise.resolve().then(s)};I(),o={push:function(O){x.push(O),I()},filter:function(O){return x=x.filter(O),o}}}};return d}function noe(t){t===void 0&&(t={});var n=roe(null);return n.options=ct({async:!0,ssr:!1},t),n}var gj=function(t){var n=t.sideCar,o=ka(t,["sideCar"]);if(!n)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var u=n.read();if(!u)throw new Error("Sidecar medium not found");return W.createElement(u,ct({},o))};gj.isSideCarExport=!0;function ioe(t,n){return t.useMedium(n),gj}var _j=noe(),jS=function(){},$1=W.forwardRef(function(t,n){var o=W.useRef(null),u=W.useState({onScrollCapture:jS,onWheelCapture:jS,onTouchMoveCapture:jS}),d=u[0],g=u[1],x=t.forwardProps,T=t.children,s=t.className,I=t.removeScrollBar,O=t.enabled,D=t.shards,N=t.sideCar,j=t.noIsolation,G=t.inert,X=t.allowPinchZoom,te=t.as,H=te===void 0?"div":te,U=ka(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),q=N,J=eoe([o,n]),pe=ct(ct({},U),d);return W.createElement(W.Fragment,null,O&&W.createElement(q,{sideCar:_j,removeScrollBar:I,shards:D,noIsolation:j,inert:G,setCallbacks:g,allowPinchZoom:!!X,lockRef:o}),x?W.cloneElement(W.Children.only(T),ct(ct({},pe),{ref:J})):W.createElement(H,ct({},pe,{className:s,ref:J}),T))});$1.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};$1.classNames={fullWidth:vx,zeroRight:yx};var ooe=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function soe(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var n=ooe();return n&&t.setAttribute("nonce",n),t}function aoe(t,n){t.styleSheet?t.styleSheet.cssText=n:t.appendChild(document.createTextNode(n))}function loe(t){var n=document.head||document.getElementsByTagName("head")[0];n.appendChild(t)}var coe=function(){var t=0,n=null;return{add:function(o){t==0&&(n=soe())&&(aoe(n,o),loe(n)),t++},remove:function(){t--,!t&&n&&(n.parentNode&&n.parentNode.removeChild(n),n=null)}}},uoe=function(){var t=coe();return function(n,o){W.useEffect(function(){return t.add(n),function(){t.remove()}},[n&&o])}},yj=function(){var t=uoe(),n=function(o){var u=o.styles,d=o.dynamic;return t(u,d),null};return n},hoe={left:0,top:0,right:0,gap:0},$S=function(t){return parseInt(t||"",10)||0},doe=function(t){var n=window.getComputedStyle(document.body),o=n[t==="padding"?"paddingLeft":"marginLeft"],u=n[t==="padding"?"paddingTop":"marginTop"],d=n[t==="padding"?"paddingRight":"marginRight"];return[$S(o),$S(u),$S(d)]},foe=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return hoe;var n=doe(t),o=document.documentElement.clientWidth,u=window.innerWidth;return{left:n[0],top:n[1],right:n[2],gap:Math.max(0,u-o+n[2]-n[0])}},poe=yj(),ip="data-scroll-locked",moe=function(t,n,o,u){var d=t.left,g=t.top,x=t.right,T=t.gap;return o===void 0&&(o="margin"),`
  .`.concat(Yie,` {
   overflow: hidden `).concat(u,`;
   padding-right: `).concat(T,"px ").concat(u,`;
  }
  body[`).concat(ip,`] {
    overflow: hidden `).concat(u,`;
    overscroll-behavior: contain;
    `).concat([n&&"position: relative ".concat(u,";"),o==="margin"&&`
    padding-left: `.concat(d,`px;
    padding-top: `).concat(g,`px;
    padding-right: `).concat(x,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(T,"px ").concat(u,`;
    `),o==="padding"&&"padding-right: ".concat(T,"px ").concat(u,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(yx,` {
    right: `).concat(T,"px ").concat(u,`;
  }
  
  .`).concat(vx,` {
    margin-right: `).concat(T,"px ").concat(u,`;
  }
  
  .`).concat(yx," .").concat(yx,` {
    right: 0 `).concat(u,`;
  }
  
  .`).concat(vx," .").concat(vx,` {
    margin-right: 0 `).concat(u,`;
  }
  
  body[`).concat(ip,`] {
    `).concat(Qie,": ").concat(T,`px;
  }
`)},$4=function(){var t=parseInt(document.body.getAttribute(ip)||"0",10);return isFinite(t)?t:0},goe=function(){W.useEffect(function(){return document.body.setAttribute(ip,($4()+1).toString()),function(){var t=$4()-1;t<=0?document.body.removeAttribute(ip):document.body.setAttribute(ip,t.toString())}},[])},_oe=function(t){var n=t.noRelative,o=t.noImportant,u=t.gapMode,d=u===void 0?"margin":u;goe();var g=W.useMemo(function(){return foe(d)},[d]);return W.createElement(poe,{styles:moe(g,!n,d,o?"":"!important")})},kC=!1;if(typeof window<"u")try{var U0=Object.defineProperty({},"passive",{get:function(){return kC=!0,!0}});window.addEventListener("test",U0,U0),window.removeEventListener("test",U0,U0)}catch{kC=!1}var Sf=kC?{passive:!1}:!1,yoe=function(t){return t.tagName==="TEXTAREA"},vj=function(t,n){var o=window.getComputedStyle(t);return o[n]!=="hidden"&&!(o.overflowY===o.overflowX&&!yoe(t)&&o[n]==="visible")},voe=function(t){return vj(t,"overflowY")},xoe=function(t){return vj(t,"overflowX")},U4=function(t,n){var o=n;do{typeof ShadowRoot<"u"&&o instanceof ShadowRoot&&(o=o.host);var u=xj(t,o);if(u){var d=bj(t,o),g=d[1],x=d[2];if(g>x)return!0}o=o.parentNode}while(o&&o!==document.body);return!1},boe=function(t){var n=t.scrollTop,o=t.scrollHeight,u=t.clientHeight;return[n,o,u]},woe=function(t){var n=t.scrollLeft,o=t.scrollWidth,u=t.clientWidth;return[n,o,u]},xj=function(t,n){return t==="v"?voe(n):xoe(n)},bj=function(t,n){return t==="v"?boe(n):woe(n)},Eoe=function(t,n){return t==="h"&&n==="rtl"?-1:1},Soe=function(t,n,o,u,d){var g=Eoe(t,window.getComputedStyle(n).direction),x=g*u,T=o.target,s=n.contains(T),I=!1,O=x>0,D=0,N=0;do{var j=bj(t,T),G=j[0],X=j[1],te=j[2],H=X-te-g*G;(G||H)&&xj(t,T)&&(D+=H,N+=G),T=T.parentNode}while(!s&&T!==document.body||s&&(n.contains(T)||n===T));return(O&&(d&&D===0||!d&&x>D)||!O&&(d&&N===0||!d&&-x>N))&&(I=!0),I},V0=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},V4=function(t){return[t.deltaX,t.deltaY]},G4=function(t){return t&&"current"in t?t.current:t},Toe=function(t,n){return t[0]===n[0]&&t[1]===n[1]},Coe=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},Moe=0,Tf=[];function Ioe(t){var n=W.useRef([]),o=W.useRef([0,0]),u=W.useRef(),d=W.useState(Moe++)[0],g=W.useState(function(){return yj()})[0],x=W.useRef(t);W.useEffect(function(){x.current=t},[t]),W.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(d));var X=Ia([t.lockRef.current],(t.shards||[]).map(G4),!0).filter(Boolean);return X.forEach(function(te){return te.classList.add("allow-interactivity-".concat(d))}),function(){document.body.classList.remove("block-interactivity-".concat(d)),X.forEach(function(te){return te.classList.remove("allow-interactivity-".concat(d))})}}},[t.inert,t.lockRef.current,t.shards]);var T=W.useCallback(function(X,te){if("touches"in X&&X.touches.length===2)return!x.current.allowPinchZoom;var H=V0(X),U=o.current,q="deltaX"in X?X.deltaX:U[0]-H[0],J="deltaY"in X?X.deltaY:U[1]-H[1],pe,ue=X.target,Me=Math.abs(q)>Math.abs(J)?"h":"v";if("touches"in X&&Me==="h"&&ue.type==="range")return!1;var Se=U4(Me,ue);if(!Se)return!0;if(Se?pe=Me:(pe=Me==="v"?"h":"v",Se=U4(Me,ue)),!Se)return!1;if(!u.current&&"changedTouches"in X&&(q||J)&&(u.current=pe),!pe)return!0;var ge=u.current||pe;return Soe(ge,te,X,ge==="h"?q:J,!0)},[]),s=W.useCallback(function(X){var te=X;if(!(!Tf.length||Tf[Tf.length-1]!==g)){var H="deltaY"in te?V4(te):V0(te),U=n.current.filter(function(pe){return pe.name===te.type&&pe.target===te.target&&Toe(pe.delta,H)})[0];if(U&&U.should){te.cancelable&&te.preventDefault();return}if(!U){var q=(x.current.shards||[]).map(G4).filter(Boolean).filter(function(pe){return pe.contains(te.target)}),J=q.length>0?T(te,q[0]):!x.current.noIsolation;J&&te.cancelable&&te.preventDefault()}}},[]),I=W.useCallback(function(X,te,H,U){var q={name:X,delta:te,target:H,should:U};n.current.push(q),setTimeout(function(){n.current=n.current.filter(function(J){return J!==q})},1)},[]),O=W.useCallback(function(X){o.current=V0(X),u.current=void 0},[]),D=W.useCallback(function(X){I(X.type,V4(X),X.target,T(X,t.lockRef.current))},[]),N=W.useCallback(function(X){I(X.type,V0(X),X.target,T(X,t.lockRef.current))},[]);W.useEffect(function(){return Tf.push(g),t.setCallbacks({onScrollCapture:D,onWheelCapture:D,onTouchMoveCapture:N}),document.addEventListener("wheel",s,Sf),document.addEventListener("touchmove",s,Sf),document.addEventListener("touchstart",O,Sf),function(){Tf=Tf.filter(function(X){return X!==g}),document.removeEventListener("wheel",s,Sf),document.removeEventListener("touchmove",s,Sf),document.removeEventListener("touchstart",O,Sf)}},[]);var j=t.removeScrollBar,G=t.inert;return W.createElement(W.Fragment,null,G?W.createElement(g,{styles:Coe(d)}):null,j?W.createElement(_oe,{gapMode:"margin"}):null)}const Aoe=ioe(_j,Ioe);var wj=W.forwardRef(function(t,n){return W.createElement($1,ct({},t,{ref:n,sideCar:Aoe}))});wj.classNames=$1.classNames;const koe=wj;var Poe=function(t){if(typeof document>"u")return null;var n=Array.isArray(t)?t[0]:t;return n.ownerDocument.body},Cf=new WeakMap,G0=new WeakMap,q0={},US=0,Ej=function(t){return t&&(t.host||Ej(t.parentNode))},Ooe=function(t,n){return n.map(function(o){if(t.contains(o))return o;var u=Ej(o);return u&&t.contains(u)?u:(console.error("aria-hidden",o,"in not contained inside",t,". Doing nothing"),null)}).filter(function(o){return!!o})},Doe=function(t,n,o,u){var d=Ooe(n,Array.isArray(t)?t:[t]);q0[o]||(q0[o]=new WeakMap);var g=q0[o],x=[],T=new Set,s=new Set(d),I=function(D){!D||T.has(D)||(T.add(D),I(D.parentNode))};d.forEach(I);var O=function(D){!D||s.has(D)||Array.prototype.forEach.call(D.children,function(N){if(T.has(N))O(N);else try{var j=N.getAttribute(u),G=j!==null&&j!=="false",X=(Cf.get(N)||0)+1,te=(g.get(N)||0)+1;Cf.set(N,X),g.set(N,te),x.push(N),X===1&&G&&G0.set(N,!0),te===1&&N.setAttribute(o,"true"),G||N.setAttribute(u,"true")}catch(H){console.error("aria-hidden: cannot operate on ",N,H)}})};return O(n),T.clear(),US++,function(){x.forEach(function(D){var N=Cf.get(D)-1,j=g.get(D)-1;Cf.set(D,N),g.set(D,j),N||(G0.has(D)||D.removeAttribute(u),G0.delete(D)),j||D.removeAttribute(o)}),US--,US||(Cf=new WeakMap,Cf=new WeakMap,G0=new WeakMap,q0={})}},Roe=function(t,n,o){o===void 0&&(o="data-aria-hidden");var u=Array.from(Array.isArray(t)?t:[t]),d=n||Poe(t);return d?(u.push.apply(u,Array.from(d.querySelectorAll("[aria-live]"))),Doe(u,d,o,"aria-hidden")):function(){return null}};const Sj="Dialog",[Tj,dle]=ay(Sj),[Loe,Bc]=Tj(Sj),zoe=t=>{const{__scopeDialog:n,children:o,open:u,defaultOpen:d,onOpenChange:g,modal:x=!0}=t,T=W.useRef(null),s=W.useRef(null),[I=!1,O]=D1({prop:u,defaultProp:d,onChange:g});return W.createElement(Loe,{scope:n,triggerRef:T,contentRef:s,contentId:fx(),titleId:fx(),descriptionId:fx(),open:I,onOpenChange:O,onOpenToggle:W.useCallback(()=>O(D=>!D),[O]),modal:x},o)},Noe="DialogTrigger",Foe=W.forwardRef((t,n)=>{const{__scopeDialog:o,...u}=t,d=Bc(Noe,o),g=La(n,d.triggerRef);return W.createElement(js.button,bn({type:"button","aria-haspopup":"dialog","aria-expanded":d.open,"aria-controls":d.contentId,"data-state":$I(d.open)},u,{ref:g,onClick:Ci(t.onClick,d.onOpenToggle)}))}),Cj="DialogPortal",[Boe,Mj]=Tj(Cj,{forceMount:void 0}),joe=t=>{const{__scopeDialog:n,forceMount:o,children:u,container:d}=t,g=Bc(Cj,n);return W.createElement(Boe,{scope:n,forceMount:o},W.Children.map(u,x=>W.createElement(zc,{present:o||g.open},W.createElement(uI,{asChild:!0,container:d},x))))},PC="DialogOverlay",$oe=W.forwardRef((t,n)=>{const o=Mj(PC,t.__scopeDialog),{forceMount:u=o.forceMount,...d}=t,g=Bc(PC,t.__scopeDialog);return g.modal?W.createElement(zc,{present:u||g.open},W.createElement(Uoe,bn({},d,{ref:n}))):null}),Uoe=W.forwardRef((t,n)=>{const{__scopeDialog:o,...u}=t,d=Bc(PC,o);return W.createElement(koe,{as:rI,allowPinchZoom:!0,shards:[d.contentRef]},W.createElement(js.div,bn({"data-state":$I(d.open)},u,{ref:n,style:{pointerEvents:"auto",...u.style}})))}),X_="DialogContent",Voe=W.forwardRef((t,n)=>{const o=Mj(X_,t.__scopeDialog),{forceMount:u=o.forceMount,...d}=t,g=Bc(X_,t.__scopeDialog);return W.createElement(zc,{present:u||g.open},g.modal?W.createElement(Goe,bn({},d,{ref:n})):W.createElement(qoe,bn({},d,{ref:n})))}),Goe=W.forwardRef((t,n)=>{const o=Bc(X_,t.__scopeDialog),u=W.useRef(null),d=La(n,o.contentRef,u);return W.useEffect(()=>{const g=u.current;if(g)return Roe(g)},[]),W.createElement(Ij,bn({},t,{ref:d,trapFocus:o.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ci(t.onCloseAutoFocus,g=>{var x;g.preventDefault(),(x=o.triggerRef.current)===null||x===void 0||x.focus()}),onPointerDownOutside:Ci(t.onPointerDownOutside,g=>{const x=g.detail.originalEvent,T=x.button===0&&x.ctrlKey===!0;(x.button===2||T)&&g.preventDefault()}),onFocusOutside:Ci(t.onFocusOutside,g=>g.preventDefault())}))}),qoe=W.forwardRef((t,n)=>{const o=Bc(X_,t.__scopeDialog),u=W.useRef(!1),d=W.useRef(!1);return W.createElement(Ij,bn({},t,{ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:g=>{var x;if((x=t.onCloseAutoFocus)===null||x===void 0||x.call(t,g),!g.defaultPrevented){var T;u.current||(T=o.triggerRef.current)===null||T===void 0||T.focus(),g.preventDefault()}u.current=!1,d.current=!1},onInteractOutside:g=>{var x,T;(x=t.onInteractOutside)===null||x===void 0||x.call(t,g),g.defaultPrevented||(u.current=!0,g.detail.originalEvent.type==="pointerdown"&&(d.current=!0));const s=g.target;((T=o.triggerRef.current)===null||T===void 0?void 0:T.contains(s))&&g.preventDefault(),g.detail.originalEvent.type==="focusin"&&d.current&&g.preventDefault()}}))}),Ij=W.forwardRef((t,n)=>{const{__scopeDialog:o,trapFocus:u,onOpenAutoFocus:d,onCloseAutoFocus:g,...x}=t,T=Bc(X_,o),s=W.useRef(null),I=La(n,s);return Xie(),W.createElement(W.Fragment,null,W.createElement(Uie,{asChild:!0,loop:!0,trapped:u,onMountAutoFocus:d,onUnmountAutoFocus:g},W.createElement(nI,bn({role:"dialog",id:T.contentId,"aria-describedby":T.descriptionId,"aria-labelledby":T.titleId,"data-state":$I(T.open)},x,{ref:I,onDismiss:()=>T.onOpenChange(!1)}))),!1)}),Woe="DialogClose",Hoe=W.forwardRef((t,n)=>{const{__scopeDialog:o,...u}=t,d=Bc(Woe,o);return W.createElement(js.button,bn({type:"button"},u,{ref:n,onClick:Ci(t.onClick,()=>d.onOpenChange(!1))}))});function $I(t){return t?"open":"closed"}const Aj=zoe,kj=Foe,Pj=joe,Oj=$oe,Dj=Voe,Rj=Hoe,Zoe="_overlay_wenvx_1",Xoe="_fadeIn_wenvx_1",Yoe="_content_wenvx_15",Qoe="_slideIn_wenvx_1",Koe="_body_wenvx_31",Joe="_header_wenvx_36",Wg={overlay:Zoe,fadeIn:Xoe,content:Yoe,slideIn:Qoe,body:Koe,header:Joe};function ese({onClick:t,children:n,semester:o,year:u}){const[d,g]=W.useState(!1),[x,T]=Ip(),{data:s}=ry(TI,{variables:{term:{semester:o,year:u}}}),I=W.useMemo(()=>(s==null?void 0:s.catalog)??[],[s==null?void 0:s.catalog]),O=N=>{g(N),!N&&(x.delete("query"),T(x))},D=(N,j)=>{t(N,j),g(!1),x.delete("query"),T(x)};return Y.jsxs(Aj,{onOpenChange:O,open:d,children:[Y.jsx(kj,{asChild:!0,children:n}),Y.jsxs(Pj,{children:[Y.jsx(Oj,{className:Wg.overlay}),Y.jsxs(Dj,{className:Wg.content,children:[Y.jsxs("div",{className:Wg.header,children:["Add a course to this semester",Y.jsx(Rj,{asChild:!0,children:Y.jsx(os,{className:Wg.close,children:Y.jsx(pI,{})})})]}),Y.jsx("div",{className:Wg.body,children:Y.jsx(EI,{courses:I,currentSemester:Io.Spring,currentYear:2024,onClassSelect:D,responsive:!1})})]})]})]})}const tse="_root_1827p_1",rse="_body_1827p_17",nse="_icon_1827p_29",ise="_text_1827p_32",ose="_title_1827p_35",sse="_description_1827p_42",ase="_row_1827p_48",lse="_basis_1827p_53",cse="_badge_1827p_58",$h={root:tse,body:rse,icon:nse,text:ise,title:ose,description:sse,row:ase,basis:lse,badge:cse};function use({subject:t,number:n,title:o,gradeAverage:u}){return Y.jsx("div",{className:xi($h.root,"draggable"),children:Y.jsx("div",{className:$h.body,children:Y.jsxs("div",{className:$h.text,children:[Y.jsxs("p",{className:$h.title,children:[t," ",n]}),Y.jsx("p",{className:$h.description,children:o}),Y.jsxs("div",{className:$h.row,children:[Y.jsx(_y,{gradeAverage:u}),Y.jsxs("div",{className:$h.badge,children:[Y.jsx($Z,{}),"Major"]}),Y.jsx(dd,{unitsMin:4,unitsMax:4})]})]})})})}const hse="_root_dlmtj_1",dse="_footer_dlmtj_9",fse="_header_dlmtj_15",pse="_title_dlmtj_25",mse="_body_dlmtj_31",Hg={root:hse,footer:dse,header:fse,title:pse,body:mse},Lj=W.forwardRef(({semester:t,year:n,courses:o,onClick:u},d)=>Y.jsxs("div",{className:Hg.root,children:[Y.jsxs("div",{className:Hg.header,children:[Y.jsxs("p",{className:Hg.title,children:[t," ",n]}),Y.jsx(dd,{unitsMin:12,unitsMax:20}),Y.jsx(os,{children:Y.jsx(m_,{})})]}),Y.jsx("div",{className:Hg.body,ref:d,children:o.map(g=>Y.jsx(use,{...g},`${g.subject} ${g.number}`))}),Y.jsx("div",{className:Hg.footer,children:Y.jsx(ese,{semester:Io.Spring,year:2024,onClick:u,children:Y.jsxs(al,{secondary:!0,children:[Y.jsx(m_,{}),"Add class"]})})})]}));Lj.displayName="Semester";const gse=[{semester:Io.Fall,year:2021,courses:[]},{semester:Io.Spring,year:2022,courses:[]},{semester:Io.Fall,year:2022,courses:[]},{semester:Io.Spring,year:2023,courses:[]},{semester:Io.Fall,year:2023,courses:[]},{semester:Io.Spring,year:2024,courses:[]},{semester:Io.Fall,year:2024,courses:[]}];function _se(){const t=W.useRef([]),[n,o]=W.useState(gse),u=(g,x)=>{o(T=>{const s=structuredClone(T);return s[x].courses.splice(0,0,g),s})},d=(g,x)=>{x?t.current.splice(g,0,x):t.current.splice(g,1)};return W.useEffect(()=>{const g=new Rie(t.current,{draggable:".draggable",distance:4,mirror:{constrainDimensions:!0},plugins:[YB]});return g.on("drag:stop",x=>{x.cancel()}),g.on("sortable:stop",x=>{const{oldIndex:T,newIndex:s,oldContainer:I,newContainer:O}=x;if(I===O&&T===s)return;const D=t.current.indexOf(I),N=t.current.indexOf(O);o(j=>{const G=structuredClone(j),X=G[D].courses.splice(T,1)[0];return G[N].courses.splice(s,0,X),G})}),()=>{g.destroy()}},[]),console.log(n),Y.jsxs("div",{className:$0.root,children:[Y.jsx("div",{className:$0.sideBar}),Y.jsx("div",{className:$0.view,children:Y.jsx("div",{className:$0.body,children:n.map(({semester:g,year:x,courses:T},s)=>Y.jsx(Lj,{courses:T,semester:g,year:x,onClick:I=>u(I,s),ref:I=>d(s,I)},`${g} ${x}`))})})]})}const nl=t=>{const[n,o]=t.split(":");return(parseInt(n)-6)*60+parseInt(o)},yse="_root_1pudw_1",vse="_header_1pudw_7",xse="_timeZone_1pudw_19",bse="_week_1pudw_31",wse="_day_1pudw_36",Ese="_view_1pudw_45",Sse="_line_1pudw_60",Tse="_hour_1pudw_68",Cse="_sideBar_1pudw_77",Mse="_time_1pudw_19",mo={root:yse,header:vse,timeZone:xse,week:bse,day:wse,view:Ese,line:Sse,hour:Tse,sideBar:Cse,time:Mse};let VS;const zj="HoverCard",[Nj,fle]=ay(zj,[O1]),U1=O1(),[Ise,V1]=Nj(zj),Ase=t=>{const{__scopeHoverCard:n,children:o,open:u,defaultOpen:d,onOpenChange:g,openDelay:x=700,closeDelay:T=300}=t,s=U1(n),I=W.useRef(0),O=W.useRef(0),D=W.useRef(!1),N=W.useRef(!1),[j=!1,G]=D1({prop:u,defaultProp:d,onChange:g}),X=W.useCallback(()=>{clearTimeout(O.current),I.current=window.setTimeout(()=>G(!0),x)},[x,G]),te=W.useCallback(()=>{clearTimeout(I.current),!D.current&&!N.current&&(O.current=window.setTimeout(()=>G(!1),T))},[T,G]),H=W.useCallback(()=>G(!1),[G]);return W.useEffect(()=>()=>{clearTimeout(I.current),clearTimeout(O.current)},[]),W.createElement(Ise,{scope:n,open:j,onOpenChange:G,onOpen:X,onClose:te,onDismiss:H,hasSelectionRef:D,isPointerDownOnContentRef:N},W.createElement(GF,s,o))},kse="HoverCardTrigger",Pse=W.forwardRef((t,n)=>{const{__scopeHoverCard:o,...u}=t,d=V1(kse,o),g=U1(o);return W.createElement(qF,bn({asChild:!0},g),W.createElement(js.a,bn({"data-state":d.open?"open":"closed"},u,{ref:n,onPointerEnter:Ci(t.onPointerEnter,n1(d.onOpen)),onPointerLeave:Ci(t.onPointerLeave,n1(d.onClose)),onFocus:Ci(t.onFocus,d.onOpen),onBlur:Ci(t.onBlur,d.onClose),onTouchStart:Ci(t.onTouchStart,x=>x.preventDefault())})))}),Fj="HoverCardPortal",[Ose,Dse]=Nj(Fj,{forceMount:void 0}),Rse=t=>{const{__scopeHoverCard:n,forceMount:o,children:u,container:d}=t,g=V1(Fj,n);return W.createElement(Ose,{scope:n,forceMount:o},W.createElement(zc,{present:o||g.open},W.createElement(uI,{asChild:!0,container:d},u)))},OC="HoverCardContent",Lse=W.forwardRef((t,n)=>{const o=Dse(OC,t.__scopeHoverCard),{forceMount:u=o.forceMount,...d}=t,g=V1(OC,t.__scopeHoverCard);return W.createElement(zc,{present:u||g.open},W.createElement(zse,bn({"data-state":g.open?"open":"closed"},d,{onPointerEnter:Ci(t.onPointerEnter,n1(g.onOpen)),onPointerLeave:Ci(t.onPointerLeave,n1(g.onClose)),ref:n})))}),zse=W.forwardRef((t,n)=>{const{__scopeHoverCard:o,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:g,onInteractOutside:x,...T}=t,s=V1(OC,o),I=U1(o),O=W.useRef(null),D=La(n,O),[N,j]=W.useState(!1);return W.useEffect(()=>{if(N){const G=document.body;return VS=G.style.userSelect||G.style.webkitUserSelect,G.style.userSelect="none",G.style.webkitUserSelect="none",()=>{G.style.userSelect=VS,G.style.webkitUserSelect=VS}}},[N]),W.useEffect(()=>{if(O.current){const G=()=>{j(!1),s.isPointerDownOnContentRef.current=!1,setTimeout(()=>{var X;((X=document.getSelection())===null||X===void 0?void 0:X.toString())!==""&&(s.hasSelectionRef.current=!0)})};return document.addEventListener("pointerup",G),()=>{document.removeEventListener("pointerup",G),s.hasSelectionRef.current=!1,s.isPointerDownOnContentRef.current=!1}}},[s.isPointerDownOnContentRef,s.hasSelectionRef]),W.useEffect(()=>{O.current&&Fse(O.current).forEach(X=>X.setAttribute("tabindex","-1"))}),W.createElement(nI,{asChild:!0,disableOutsidePointerEvents:!1,onInteractOutside:x,onEscapeKeyDown:u,onPointerDownOutside:d,onFocusOutside:Ci(g,G=>{G.preventDefault()}),onDismiss:s.onDismiss},W.createElement(WF,bn({},I,T,{onPointerDown:Ci(T.onPointerDown,G=>{G.currentTarget.contains(G.target)&&j(!0),s.hasSelectionRef.current=!1,s.isPointerDownOnContentRef.current=!0}),ref:D,style:{...T.style,userSelect:N?"text":void 0,WebkitUserSelect:N?"text":void 0,"--radix-hover-card-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-hover-card-content-available-width":"var(--radix-popper-available-width)","--radix-hover-card-content-available-height":"var(--radix-popper-available-height)","--radix-hover-card-trigger-width":"var(--radix-popper-anchor-width)","--radix-hover-card-trigger-height":"var(--radix-popper-anchor-height)"}})))}),Nse=W.forwardRef((t,n)=>{const{__scopeHoverCard:o,...u}=t,d=U1(o);return W.createElement(HF,bn({},d,u,{ref:n}))});function n1(t){return n=>n.pointerType==="touch"?void 0:t()}function Fse(t){const n=[],o=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:u=>u.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP});for(;o.nextNode();)n.push(o.currentNode);return n}const Bse=Ase,jse=Pse,$se=Rse,Use=Lse,Vse=Nse,Gse="_trigger_1dbuj_1",qse="_active_1dbuj_10",Wse="_heading_1dbuj_13",Hse="_description_1dbuj_20",Zse="_content_1dbuj_28",Xse="_fadeIn_1dbuj_1",Yse="_arrow_1dbuj_38",Mf={trigger:Gse,active:qse,heading:Wse,description:Hse,content:Zse,fadeIn:Xse,arrow:Yse};function Qse({columns:t,position:n,timeStart:o,timeEnd:u,course:d,kind:g,number:x,active:T}){var O;const s=W.useMemo(()=>nl(o),[o]),I=W.useMemo(()=>nl(u)-s+1,[s,u]);return Y.jsxs(Bse,{openDelay:0,closeDelay:100,children:[Y.jsx(jse,{asChild:!0,children:Y.jsxs("div",{className:xi(Mf.trigger,{[Mf.active]:T}),style:{top:`${s+1}px`,backgroundColor:"var(--red-500)",height:`${I-2}px`,width:`calc((100% - 4px - ${t-1} * 2px) / ${t})`,left:`calc(2px + calc((100% - 4px - ${t-1} * 2px) / ${t}) * ${n} + 2px * ${n})`},children:[Y.jsxs("div",{className:Mf.heading,children:[d.subject," ",d.number]}),Y.jsxs("div",{className:Mf.description,children:[((O=Z_[g])==null?void 0:O.name)??g," ",x]})]})}),Y.jsx($se,{children:Y.jsx(Use,{asChild:!0,collisionPadding:8,sideOffset:8,children:Y.jsx("div",{className:Mf.content,children:Y.jsx(Vse,{className:Mf.arrow})})})})]})}const xx=t=>`${t.course.subject} ${t.course.number} ${t.class.number} ${t.number}`,Kse=(t,n,o,u)=>{const d=[],g=x=>{if(d.includes(x))return;d.push(x),u[x][1]++;const T=t.find(O=>x===xx(O));if(!T)return;const s=nl(T.timeStart),I=nl(T.timeEnd)-s;for(let O=s;O<s+I;O++)for(const D of o[O])g(D)};for(const x of n)g(x)};function Jse({selectedSections:t,currentSection:n}){const o=W.useRef(null),[u,d]=W.useState(null),g=W.useMemo(()=>n?[...t,n]:t,[t,n]),x=W.useMemo(()=>[...Array(7)].map((I,O)=>{const D={},N=[...Array(1080)].map(()=>[]),j=g.filter(G=>{var X;return((X=G.days)==null?void 0:X[O])&&G.timeStart&&nl(G.timeStart)>0}).sort((G,X)=>nl(G.timeStart)-nl(X.timeStart));for(const G of j){const X=nl(G.timeStart),te=nl(G.timeEnd)-X,H=N[X];let U=0;for(;H.findIndex(J=>D[J][0]===U)!==-1;)U++;H.length>0&&Math.max(U,...H.map(J=>D[J][0]))===U&&Kse(j,H,N,D);const q=xx(G);D[q]=[U,H.length===0?1:D[H[0]][1]];for(let J=X;J<X+te;J++)N[J].push(q)}return j.map(G=>{const[X,te]=D[xx(G)];return{...G,position:X,active:G.ccn!==(n==null?void 0:n.ccn),columns:te}})}),[g,n]),T=W.useMemo(()=>{if(!o.current||!u)return;const I=(Math.floor(u/60)+6)%12||12,O=Math.floor(u%60);return`${I}:${O<10?`0${O}`:O}`},[u]),s=I=>{if(!o.current)return;const O=Math.max(15,Math.min(I.clientY-o.current.getBoundingClientRect().top,o.current.clientHeight-15));d(O)};return Y.jsxs("div",{className:mo.root,children:[Y.jsxs("div",{className:mo.header,children:[Y.jsx("div",{className:mo.timeZone,children:"PST"}),Y.jsxs("div",{className:mo.week,children:[Y.jsx("div",{className:mo.day,children:"Sunday"}),Y.jsx("div",{className:mo.day,children:"Monday"}),Y.jsx("div",{className:mo.day,children:"Tuesday"}),Y.jsx("div",{className:mo.day,children:"Wednesday"}),Y.jsx("div",{className:mo.day,children:"Thursday"}),Y.jsx("div",{className:mo.day,children:"Friday"}),Y.jsx("div",{className:mo.day,children:"Saturday"})]})]}),Y.jsxs("div",{className:mo.view,ref:o,onMouseMove:s,onMouseOver:s,onMouseOut:()=>d(null),children:[Y.jsxs("div",{className:mo.sideBar,children:[T&&u&&Y.jsx("div",{className:mo.time,style:{top:`${u-11.5}px`},children:T}),[...Array(17)].map((I,O)=>Y.jsx("div",{className:mo.hour,children:O+7<12?`${O+7} AM`:`${O+7===12?12:O-5} PM`},O))]}),Y.jsx("div",{className:mo.week,children:x.map((I,O)=>Y.jsxs("div",{className:mo.day,children:[[...Array(18)].map((D,N)=>Y.jsx("div",{className:mo.hour},N)),I.map(D=>Y.jsx(Qse,{...D},xx(D))),u&&Y.jsx("div",{className:mo.line,style:{top:`${u}px`}})]},O))})]})]})}function W0(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Bj={exports:{}};(function(t,n){(function(o){t.exports=o()})(function(){return function(){function o(u,d,g){function x(I,O){if(!d[I]){if(!u[I]){var D=typeof W0=="function"&&W0;if(!O&&D)return D(I,!0);if(T)return T(I,!0);var N=new Error("Cannot find module '"+I+"'");throw N.code="MODULE_NOT_FOUND",N}var j=d[I]={exports:{}};u[I][0].call(j.exports,function(G){var X=u[I][1][G];return x(X||G)},j,j.exports,o,u,d,g)}return d[I].exports}for(var T=typeof W0=="function"&&W0,s=0;s<g.length;s++)x(g[s]);return x}return o}()({1:[function(o,u,d){var g=o("./toPropertyKey.js");function x(T,s,I){return s=g(s),s in T?Object.defineProperty(T,s,{value:I,enumerable:!0,configurable:!0,writable:!0}):T[s]=I,T}u.exports=x,u.exports.__esModule=!0,u.exports.default=u.exports},{"./toPropertyKey.js":4}],2:[function(o,u,d){var g=o("./defineProperty.js");function x(s,I){var O=Object.keys(s);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(s);I&&(D=D.filter(function(N){return Object.getOwnPropertyDescriptor(s,N).enumerable})),O.push.apply(O,D)}return O}function T(s){for(var I=1;I<arguments.length;I++){var O=arguments[I]!=null?arguments[I]:{};I%2?x(Object(O),!0).forEach(function(D){g(s,D,O[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(O)):x(Object(O)).forEach(function(D){Object.defineProperty(s,D,Object.getOwnPropertyDescriptor(O,D))})}return s}u.exports=T,u.exports.__esModule=!0,u.exports.default=u.exports},{"./defineProperty.js":1}],3:[function(o,u,d){var g=o("./typeof.js").default;function x(T,s){if(g(T)!=="object"||T===null)return T;var I=T[Symbol.toPrimitive];if(I!==void 0){var O=I.call(T,s||"default");if(g(O)!=="object")return O;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(T)}u.exports=x,u.exports.__esModule=!0,u.exports.default=u.exports},{"./typeof.js":5}],4:[function(o,u,d){var g=o("./typeof.js").default,x=o("./toPrimitive.js");function T(s){var I=x(s,"string");return g(I)==="symbol"?I:String(I)}u.exports=T,u.exports.__esModule=!0,u.exports.default=u.exports},{"./toPrimitive.js":3,"./typeof.js":5}],5:[function(o,u,d){function g(x){"@babel/helpers - typeof";return u.exports=g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(T){return typeof T}:function(T){return T&&typeof Symbol=="function"&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},u.exports.__esModule=!0,u.exports.default=u.exports,g(x)}u.exports=g,u.exports.__esModule=!0,u.exports.default=u.exports},{}],6:[function(o,u,d){var g={};function x(I){return Math.floor(Math.abs(I)+.5)*(I>=0?1:-1)}function T(I,O,D){I=x(I*D),O=x(O*D);var N=I-O;N<<=1,I-O<0&&(N=~N);for(var j="";N>=32;)j+=String.fromCharCode((32|N&31)+63),N>>=5;return j+=String.fromCharCode(N+63),j}g.decode=function(I,O){for(var D=0,N=0,j=0,G=[],X=0,te=0,H=null,U,q,J=Math.pow(10,Number.isInteger(O)?O:5);D<I.length;){H=null,X=0,te=0;do H=I.charCodeAt(D++)-63,te|=(H&31)<<X,X+=5;while(H>=32);U=te&1?~(te>>1):te>>1,X=te=0;do H=I.charCodeAt(D++)-63,te|=(H&31)<<X,X+=5;while(H>=32);q=te&1?~(te>>1):te>>1,N+=U,j+=q,G.push([N/J,j/J])}return G},g.encode=function(I,O){if(!I.length)return"";for(var D=Math.pow(10,Number.isInteger(O)?O:5),N=T(I[0][0],0,D)+T(I[0][1],0,D),j=1;j<I.length;j++){var G=I[j],X=I[j-1];N+=T(G[0],X[0],D),N+=T(G[1],X[1],D)}return N};function s(I){for(var O=[],D=0;D<I.length;D++){var N=I[D].slice();O.push([N[1],N[0]])}return O}g.fromGeoJSON=function(I,O){if(I&&I.type==="Feature"&&(I=I.geometry),!I||I.type!=="LineString")throw new Error("Input must be a GeoJSON LineString");return g.encode(s(I.coordinates),O)},g.toGeoJSON=function(I,O){var D=g.decode(I,O);return{type:"LineString",coordinates:s(D)}},typeof u=="object"&&u.exports&&(u.exports=g)},{}],7:[function(o,u,d){var g=typeof Reflect=="object"?Reflect:null,x=g&&typeof g.apply=="function"?g.apply:function(se,Ie,We){return Function.prototype.apply.call(se,Ie,We)},T;g&&typeof g.ownKeys=="function"?T=g.ownKeys:Object.getOwnPropertySymbols?T=function(se){return Object.getOwnPropertyNames(se).concat(Object.getOwnPropertySymbols(se))}:T=function(se){return Object.getOwnPropertyNames(se)};function s(ge){console&&console.warn&&console.warn(ge)}var I=Number.isNaN||function(se){return se!==se};function O(){O.init.call(this)}u.exports=O,u.exports.once=ue,O.EventEmitter=O,O.prototype._events=void 0,O.prototype._eventsCount=0,O.prototype._maxListeners=void 0;var D=10;function N(ge){if(typeof ge!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof ge)}Object.defineProperty(O,"defaultMaxListeners",{enumerable:!0,get:function(){return D},set:function(ge){if(typeof ge!="number"||ge<0||I(ge))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+ge+".");D=ge}}),O.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},O.prototype.setMaxListeners=function(se){if(typeof se!="number"||se<0||I(se))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+se+".");return this._maxListeners=se,this};function j(ge){return ge._maxListeners===void 0?O.defaultMaxListeners:ge._maxListeners}O.prototype.getMaxListeners=function(){return j(this)},O.prototype.emit=function(se){for(var Ie=[],We=1;We<arguments.length;We++)Ie.push(arguments[We]);var ze=se==="error",De=this._events;if(De!==void 0)ze=ze&&De.error===void 0;else if(!ze)return!1;if(ze){var nt;if(Ie.length>0&&(nt=Ie[0]),nt instanceof Error)throw nt;var It=new Error("Unhandled error."+(nt?" ("+nt.message+")":""));throw It.context=nt,It}var Ot=De[se];if(Ot===void 0)return!1;if(typeof Ot=="function")x(Ot,this,Ie);else for(var bt=Ot.length,rt=q(Ot,bt),We=0;We<bt;++We)x(rt[We],this,Ie);return!0};function G(ge,se,Ie,We){var ze,De,nt;if(N(Ie),De=ge._events,De===void 0?(De=ge._events=Object.create(null),ge._eventsCount=0):(De.newListener!==void 0&&(ge.emit("newListener",se,Ie.listener?Ie.listener:Ie),De=ge._events),nt=De[se]),nt===void 0)nt=De[se]=Ie,++ge._eventsCount;else if(typeof nt=="function"?nt=De[se]=We?[Ie,nt]:[nt,Ie]:We?nt.unshift(Ie):nt.push(Ie),ze=j(ge),ze>0&&nt.length>ze&&!nt.warned){nt.warned=!0;var It=new Error("Possible EventEmitter memory leak detected. "+nt.length+" "+String(se)+" listeners added. Use emitter.setMaxListeners() to increase limit");It.name="MaxListenersExceededWarning",It.emitter=ge,It.type=se,It.count=nt.length,s(It)}return ge}O.prototype.addListener=function(se,Ie){return G(this,se,Ie,!1)},O.prototype.on=O.prototype.addListener,O.prototype.prependListener=function(se,Ie){return G(this,se,Ie,!0)};function X(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function te(ge,se,Ie){var We={fired:!1,wrapFn:void 0,target:ge,type:se,listener:Ie},ze=X.bind(We);return ze.listener=Ie,We.wrapFn=ze,ze}O.prototype.once=function(se,Ie){return N(Ie),this.on(se,te(this,se,Ie)),this},O.prototype.prependOnceListener=function(se,Ie){return N(Ie),this.prependListener(se,te(this,se,Ie)),this},O.prototype.removeListener=function(se,Ie){var We,ze,De,nt,It;if(N(Ie),ze=this._events,ze===void 0)return this;if(We=ze[se],We===void 0)return this;if(We===Ie||We.listener===Ie)--this._eventsCount===0?this._events=Object.create(null):(delete ze[se],ze.removeListener&&this.emit("removeListener",se,We.listener||Ie));else if(typeof We!="function"){for(De=-1,nt=We.length-1;nt>=0;nt--)if(We[nt]===Ie||We[nt].listener===Ie){It=We[nt].listener,De=nt;break}if(De<0)return this;De===0?We.shift():J(We,De),We.length===1&&(ze[se]=We[0]),ze.removeListener!==void 0&&this.emit("removeListener",se,It||Ie)}return this},O.prototype.off=O.prototype.removeListener,O.prototype.removeAllListeners=function(se){var Ie,We,ze;if(We=this._events,We===void 0)return this;if(We.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):We[se]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete We[se]),this;if(arguments.length===0){var De=Object.keys(We),nt;for(ze=0;ze<De.length;++ze)nt=De[ze],nt!=="removeListener"&&this.removeAllListeners(nt);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(Ie=We[se],typeof Ie=="function")this.removeListener(se,Ie);else if(Ie!==void 0)for(ze=Ie.length-1;ze>=0;ze--)this.removeListener(se,Ie[ze]);return this};function H(ge,se,Ie){var We=ge._events;if(We===void 0)return[];var ze=We[se];return ze===void 0?[]:typeof ze=="function"?Ie?[ze.listener||ze]:[ze]:Ie?pe(ze):q(ze,ze.length)}O.prototype.listeners=function(se){return H(this,se,!0)},O.prototype.rawListeners=function(se){return H(this,se,!1)},O.listenerCount=function(ge,se){return typeof ge.listenerCount=="function"?ge.listenerCount(se):U.call(ge,se)},O.prototype.listenerCount=U;function U(ge){var se=this._events;if(se!==void 0){var Ie=se[ge];if(typeof Ie=="function")return 1;if(Ie!==void 0)return Ie.length}return 0}O.prototype.eventNames=function(){return this._eventsCount>0?T(this._events):[]};function q(ge,se){for(var Ie=new Array(se),We=0;We<se;++We)Ie[We]=ge[We];return Ie}function J(ge,se){for(;se+1<ge.length;se++)ge[se]=ge[se+1];ge.pop()}function pe(ge){for(var se=new Array(ge.length),Ie=0;Ie<se.length;++Ie)se[Ie]=ge[Ie].listener||ge[Ie];return se}function ue(ge,se){return new Promise(function(Ie,We){function ze(nt){ge.removeListener(se,De),We(nt)}function De(){typeof ge.removeListener=="function"&&ge.removeListener("error",ze),Ie([].slice.call(arguments))}Se(ge,se,De,{once:!0}),se!=="error"&&Me(ge,ze,{once:!0})})}function Me(ge,se,Ie){typeof ge.on=="function"&&Se(ge,"error",se,Ie)}function Se(ge,se,Ie,We){if(typeof ge.on=="function")We.once?ge.once(se,Ie):ge.on(se,Ie);else if(typeof ge.addEventListener=="function")ge.addEventListener(se,function ze(De){We.once&&ge.removeEventListener(se,ze),Ie(De)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof ge)}},{}],8:[function(o,u,d){(function(){var g=this,x={};typeof d<"u"?u.exports=x:g.fuzzy=x,x.simpleFilter=function(T,s){return s.filter(function(I){return x.test(T,I)})},x.test=function(T,s){return x.match(T,s)!==null},x.match=function(T,s,I){I=I||{};var O=0,D=[],N=s.length,j=0,G=0,X=I.pre||"",te=I.post||"",H=I.caseSensitive&&s||s.toLowerCase(),U;T=I.caseSensitive&&T||T.toLowerCase();for(var q=0;q<N;q++)U=s[q],H[q]===T[O]?(U=X+U+te,O+=1,G+=1+G):G=0,j+=G,D[D.length]=U;return O===T.length?(j=H===T?1/0:j,{rendered:D.join(""),score:j}):null},x.filter=function(T,s,I){return!s||s.length===0?[]:typeof T!="string"?s:(I=I||{},s.reduce(function(O,D,N,j){var G=D;I.extract&&(G=I.extract(D));var X=x.match(T,G,I);return X!=null&&(O[O.length]={string:X.rendered,score:X.score,index:N,original:D}),O},[]).sort(function(O,D){var N=D.score-O.score;return N||O.index-D.index}))}})()},{}],9:[function(o,u,d){var g=/<%=([\s\S]+?)%>/g;u.exports=g},{}],10:[function(o,u,d){(function(g){(function(){var x="Expected a function",T=NaN,s="[object Symbol]",I=/^\s+|\s+$/g,O=/^[-+]0x[0-9a-f]+$/i,D=/^0b[01]+$/i,N=/^0o[0-7]+$/i,j=parseInt,G=typeof g=="object"&&g&&g.Object===Object&&g,X=typeof self=="object"&&self&&self.Object===Object&&self,te=G||X||Function("return this")(),H=Object.prototype,U=H.toString,q=Math.max,J=Math.min,pe=function(){return te.Date.now()};function ue(Ie,We,ze){var De,nt,It,Ot,bt,rt,Gt=0,Vt=!1,Jt=!1,wr=!0;if(typeof Ie!="function")throw new TypeError(x);We=se(We)||0,Me(ze)&&(Vt=!!ze.leading,Jt="maxWait"in ze,It=Jt?q(se(ze.maxWait)||0,We):It,wr="trailing"in ze?!!ze.trailing:wr);function or(Xr){var cn=De,Mn=nt;return De=nt=void 0,Gt=Xr,Ot=Ie.apply(Mn,cn),Ot}function et(Xr){return Gt=Xr,bt=setTimeout(gr,We),Vt?or(Xr):Ot}function At(Xr){var cn=Xr-rt,Mn=Xr-Gt,mr=We-cn;return Jt?J(mr,It-Mn):mr}function Qt(Xr){var cn=Xr-rt,Mn=Xr-Gt;return rt===void 0||cn>=We||cn<0||Jt&&Mn>=It}function gr(){var Xr=pe();if(Qt(Xr))return Nt(Xr);bt=setTimeout(gr,At(Xr))}function Nt(Xr){return bt=void 0,wr&&De?or(Xr):(De=nt=void 0,Ot)}function Er(){bt!==void 0&&clearTimeout(bt),Gt=0,De=rt=nt=bt=void 0}function Tr(){return bt===void 0?Ot:Nt(pe())}function $r(){var Xr=pe(),cn=Qt(Xr);if(De=arguments,nt=this,rt=Xr,cn){if(bt===void 0)return et(rt);if(Jt)return bt=setTimeout(gr,We),or(rt)}return bt===void 0&&(bt=setTimeout(gr,We)),Ot}return $r.cancel=Er,$r.flush=Tr,$r}function Me(Ie){var We=typeof Ie;return!!Ie&&(We=="object"||We=="function")}function Se(Ie){return!!Ie&&typeof Ie=="object"}function ge(Ie){return typeof Ie=="symbol"||Se(Ie)&&U.call(Ie)==s}function se(Ie){if(typeof Ie=="number")return Ie;if(ge(Ie))return T;if(Me(Ie)){var We=typeof Ie.valueOf=="function"?Ie.valueOf():Ie;Ie=Me(We)?We+"":We}if(typeof Ie!="string")return Ie===0?Ie:+Ie;Ie=Ie.replace(I,"");var ze=D.test(Ie);return ze||N.test(Ie)?j(Ie.slice(2),ze?2:8):O.test(Ie)?T:+Ie}u.exports=ue}).call(this)}).call(this,typeof mc<"u"?mc:typeof self<"u"?self:typeof window<"u"?window:{})},{}],11:[function(o,u,d){(function(g){(function(){var x=200,T="__lodash_hash_undefined__",s=1,I=2,O=9007199254740991,D="[object Arguments]",N="[object Array]",j="[object AsyncFunction]",G="[object Boolean]",X="[object Date]",te="[object Error]",H="[object Function]",U="[object GeneratorFunction]",q="[object Map]",J="[object Number]",pe="[object Null]",ue="[object Object]",Me="[object Promise]",Se="[object Proxy]",ge="[object RegExp]",se="[object Set]",Ie="[object String]",We="[object Symbol]",ze="[object Undefined]",De="[object WeakMap]",nt="[object ArrayBuffer]",It="[object DataView]",Ot="[object Float32Array]",bt="[object Float64Array]",rt="[object Int8Array]",Gt="[object Int16Array]",Vt="[object Int32Array]",Jt="[object Uint8Array]",wr="[object Uint8ClampedArray]",or="[object Uint16Array]",et="[object Uint32Array]",At=/[\\^$.*+?()[\]{}|]/g,Qt=/^\[object .+?Constructor\]$/,gr=/^(?:0|[1-9]\d*)$/,Nt={};Nt[Ot]=Nt[bt]=Nt[rt]=Nt[Gt]=Nt[Vt]=Nt[Jt]=Nt[wr]=Nt[or]=Nt[et]=!0,Nt[D]=Nt[N]=Nt[nt]=Nt[G]=Nt[It]=Nt[X]=Nt[te]=Nt[H]=Nt[q]=Nt[J]=Nt[ue]=Nt[ge]=Nt[se]=Nt[Ie]=Nt[De]=!1;var Er=typeof g=="object"&&g&&g.Object===Object&&g,Tr=typeof self=="object"&&self&&self.Object===Object&&self,$r=Er||Tr||Function("return this")(),Xr=typeof d=="object"&&d&&!d.nodeType&&d,cn=Xr&&typeof u=="object"&&u&&!u.nodeType&&u,Mn=cn&&cn.exports===Xr,mr=Mn&&Er.process,vt=function(){try{return mr&&mr.binding&&mr.binding("util")}catch{}}(),_e=vt&&vt.isTypedArray;function xe(Te,Xe){for(var Dt=-1,sr=Te==null?0:Te.length,Dn=0,Wr=[];++Dt<sr;){var vr=Te[Dt];Xe(vr,Dt,Te)&&(Wr[Dn++]=vr)}return Wr}function Re(Te,Xe){for(var Dt=-1,sr=Xe.length,Dn=Te.length;++Dt<sr;)Te[Dn+Dt]=Xe[Dt];return Te}function ft(Te,Xe){for(var Dt=-1,sr=Te==null?0:Te.length;++Dt<sr;)if(Xe(Te[Dt],Dt,Te))return!0;return!1}function gt(Te,Xe){for(var Dt=-1,sr=Array(Te);++Dt<Te;)sr[Dt]=Xe(Dt);return sr}function jt(Te){return function(Xe){return Te(Xe)}}function $t(Te,Xe){return Te.has(Xe)}function yt(Te,Xe){return Te==null?void 0:Te[Xe]}function ir(Te){var Xe=-1,Dt=Array(Te.size);return Te.forEach(function(sr,Dn){Dt[++Xe]=[Dn,sr]}),Dt}function lr(Te,Xe){return function(Dt){return Te(Xe(Dt))}}function fr(Te){var Xe=-1,Dt=Array(Te.size);return Te.forEach(function(sr){Dt[++Xe]=sr}),Dt}var Gr=Array.prototype,pn=Function.prototype,In=Object.prototype,sn=$r["__core-js_shared__"],mn=pn.toString,Rr=In.hasOwnProperty,jn=function(){var Te=/[^.]+$/.exec(sn&&sn.keys&&sn.keys.IE_PROTO||"");return Te?"Symbol(src)_1."+Te:""}(),Fn=In.toString,Ii=RegExp("^"+mn.call(Rr).replace(At,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ci=Mn?$r.Buffer:void 0,$n=$r.Symbol,ii=$r.Uint8Array,no=In.propertyIsEnumerable,Go=Gr.splice,qe=$n?$n.toStringTag:void 0,we=Object.getOwnPropertySymbols,ke=ci?ci.isBuffer:void 0,Ue=lr(Object.keys,Object),Ze=pi($r,"DataView"),tt=pi($r,"Map"),it=pi($r,"Promise"),at=pi($r,"Set"),Ke=pi($r,"WeakMap"),xt=pi(Object,"create"),_t=mi(Ze),Ft=mi(tt),pr=mi(it),Ut=mi(at),Or=mi(Ke),Lr=$n?$n.prototype:void 0,Kr=Lr?Lr.valueOf:void 0;function an(Te){var Xe=-1,Dt=Te==null?0:Te.length;for(this.clear();++Xe<Dt;){var sr=Te[Xe];this.set(sr[0],sr[1])}}function Zn(){this.__data__=xt?xt(null):{},this.size=0}function oi(Te){var Xe=this.has(Te)&&delete this.__data__[Te];return this.size-=Xe?1:0,Xe}function fi(Te){var Xe=this.__data__;if(xt){var Dt=Xe[Te];return Dt===T?void 0:Dt}return Rr.call(Xe,Te)?Xe[Te]:void 0}function Oi(Te){var Xe=this.__data__;return xt?Xe[Te]!==void 0:Rr.call(Xe,Te)}function si(Te,Xe){var Dt=this.__data__;return this.size+=this.has(Te)?0:1,Dt[Te]=xt&&Xe===void 0?T:Xe,this}an.prototype.clear=Zn,an.prototype.delete=oi,an.prototype.get=fi,an.prototype.has=Oi,an.prototype.set=si;function Bn(Te){var Xe=-1,Dt=Te==null?0:Te.length;for(this.clear();++Xe<Dt;){var sr=Te[Xe];this.set(sr[0],sr[1])}}function Di(){this.__data__=[],this.size=0}function ko(Te){var Xe=this.__data__,Dt=za(Xe,Te);if(Dt<0)return!1;var sr=Xe.length-1;return Dt==sr?Xe.pop():Go.call(Xe,Dt,1),--this.size,!0}function yn(Te){var Xe=this.__data__,Dt=za(Xe,Te);return Dt<0?void 0:Xe[Dt][1]}function wn(Te){return za(this.__data__,Te)>-1}function Xi(Te,Xe){var Dt=this.__data__,sr=za(Dt,Te);return sr<0?(++this.size,Dt.push([Te,Xe])):Dt[sr][1]=Xe,this}Bn.prototype.clear=Di,Bn.prototype.delete=ko,Bn.prototype.get=yn,Bn.prototype.has=wn,Bn.prototype.set=Xi;function io(Te){var Xe=-1,Dt=Te==null?0:Te.length;for(this.clear();++Xe<Dt;){var sr=Te[Xe];this.set(sr[0],sr[1])}}function bs(){this.size=0,this.__data__={hash:new an,map:new(tt||Bn),string:new an}}function ws(Te){var Xe=Ts(this,Te).delete(Te);return this.size-=Xe?1:0,Xe}function jc(Te){return Ts(this,Te).get(Te)}function ji(Te){return Ts(this,Te).has(Te)}function cl(Te,Xe){var Dt=Ts(this,Te),sr=Dt.size;return Dt.set(Te,Xe),this.size+=Dt.size==sr?0:1,this}io.prototype.clear=bs,io.prototype.delete=ws,io.prototype.get=jc,io.prototype.has=ji,io.prototype.set=cl;function qo(Te){var Xe=-1,Dt=Te==null?0:Te.length;for(this.__data__=new io;++Xe<Dt;)this.add(Te[Xe])}function Po(Te){return this.__data__.set(Te,T),this}function $s(Te){return this.__data__.has(Te)}qo.prototype.add=qo.prototype.push=Po,qo.prototype.has=$s;function Ri(Te){var Xe=this.__data__=new Bn(Te);this.size=Xe.size}function Ge(){this.__data__=new Bn,this.size=0}function qt(Te){var Xe=this.__data__,Dt=Xe.delete(Te);return this.size=Xe.size,Dt}function Wo(Te){return this.__data__.get(Te)}function yo(Te){return this.__data__.has(Te)}function Un(Te,Xe){var Dt=this.__data__;if(Dt instanceof Bn){var sr=Dt.__data__;if(!tt||sr.length<x-1)return sr.push([Te,Xe]),this.size=++Dt.size,this;Dt=this.__data__=new io(sr)}return Dt.set(Te,Xe),this.size=Dt.size,this}Ri.prototype.clear=Ge,Ri.prototype.delete=qt,Ri.prototype.get=Wo,Ri.prototype.has=yo,Ri.prototype.set=Un;function as(Te,Xe){var Dt=Cn(Te),sr=!Dt&&bo(Te),Dn=!Dt&&!sr&&Ai(Te),Wr=!Dt&&!sr&&!Dn&&ei(Te),vr=Dt||sr||Dn||Wr,Ui=vr?gt(Te.length,String):[],ki=Ui.length;for(var An in Te)(Xe||Rr.call(Te,An))&&!(vr&&(An=="length"||Dn&&(An=="offset"||An=="parent")||Wr&&(An=="buffer"||An=="byteLength"||An=="byteOffset")||Et(An,ki)))&&Ui.push(An);return Ui}function za(Te,Xe){for(var Dt=Te.length;Dt--;)if(Yn(Te[Dt][0],Xe))return Dt;return-1}function vo(Te,Xe,Dt){var sr=Xe(Te);return Cn(Te)?sr:Re(sr,Dt(Te))}function Es(Te){return Te==null?Te===void 0?ze:pe:qe&&qe in Object(Te)?ln(Te):Xn(Te)}function Na(Te){return Oo(Te)&&Es(Te)==D}function co(Te,Xe,Dt,sr,Dn){return Te===Xe?!0:Te==null||Xe==null||!Oo(Te)&&!Oo(Xe)?Te!==Te&&Xe!==Xe:mt(Te,Xe,Dt,sr,co,Dn)}function mt(Te,Xe,Dt,sr,Dn,Wr){var vr=Cn(Te),Ui=Cn(Xe),ki=vr?N:Fe(Te),An=Ui?N:Fe(Xe);ki=ki==D?ue:ki,An=An==D?ue:An;var wo=ki==ue,Do=An==ue,ui=ki==An;if(ui&&Ai(Te)){if(!Ai(Xe))return!1;vr=!0,wo=!1}if(ui&&!wo)return Wr||(Wr=new Ri),vr||ei(Te)?Ss(Te,Xe,Dt,sr,Dn,Wr):zr(Te,Xe,ki,Dt,sr,Dn,Wr);if(!(Dt&s)){var Ro=wo&&Rr.call(Te,"__wrapped__"),gi=Do&&Rr.call(Xe,"__wrapped__");if(Ro||gi){var Ho=Ro?Te.value():Te,cs=gi?Xe.value():Xe;return Wr||(Wr=new Ri),Dn(Ho,cs,Dt,sr,Wr)}}return ui?(Wr||(Wr=new Ri),Us(Te,Xe,Dt,sr,Dn,Wr)):!1}function Nr(Te){if(!ha(Te)||Ur(Te))return!1;var Xe=$i(Te)?Ii:Qt;return Xe.test(mi(Te))}function qr(Te){return Oo(Te)&&Yi(Te.length)&&!!Nt[Es(Te)]}function xo(Te){if(!tn(Te))return Ue(Te);var Xe=[];for(var Dt in Object(Te))Rr.call(Te,Dt)&&Dt!="constructor"&&Xe.push(Dt);return Xe}function Ss(Te,Xe,Dt,sr,Dn,Wr){var vr=Dt&s,Ui=Te.length,ki=Xe.length;if(Ui!=ki&&!(vr&&ki>Ui))return!1;var An=Wr.get(Te);if(An&&Wr.get(Xe))return An==Xe;var wo=-1,Do=!0,ui=Dt&I?new qo:void 0;for(Wr.set(Te,Xe),Wr.set(Xe,Te);++wo<Ui;){var Ro=Te[wo],gi=Xe[wo];if(sr)var Ho=vr?sr(gi,Ro,wo,Xe,Te,Wr):sr(Ro,gi,wo,Te,Xe,Wr);if(Ho!==void 0){if(Ho)continue;Do=!1;break}if(ui){if(!ft(Xe,function(cs,da){if(!$t(ui,da)&&(Ro===cs||Dn(Ro,cs,Dt,sr,Wr)))return ui.push(da)})){Do=!1;break}}else if(!(Ro===gi||Dn(Ro,gi,Dt,sr,Wr))){Do=!1;break}}return Wr.delete(Te),Wr.delete(Xe),Do}function zr(Te,Xe,Dt,sr,Dn,Wr,vr){switch(Dt){case It:if(Te.byteLength!=Xe.byteLength||Te.byteOffset!=Xe.byteOffset)return!1;Te=Te.buffer,Xe=Xe.buffer;case nt:return!(Te.byteLength!=Xe.byteLength||!Wr(new ii(Te),new ii(Xe)));case G:case X:case J:return Yn(+Te,+Xe);case te:return Te.name==Xe.name&&Te.message==Xe.message;case ge:case Ie:return Te==Xe+"";case q:var Ui=ir;case se:var ki=sr&s;if(Ui||(Ui=fr),Te.size!=Xe.size&&!ki)return!1;var An=vr.get(Te);if(An)return An==Xe;sr|=I,vr.set(Te,Xe);var wo=Ss(Ui(Te),Ui(Xe),sr,Dn,Wr,vr);return vr.delete(Te),wo;case We:if(Kr)return Kr.call(Te)==Kr.call(Xe)}return!1}function Us(Te,Xe,Dt,sr,Dn,Wr){var vr=Dt&s,Ui=ls(Te),ki=Ui.length,An=ls(Xe),wo=An.length;if(ki!=wo&&!vr)return!1;for(var Do=ki;Do--;){var ui=Ui[Do];if(!(vr?ui in Xe:Rr.call(Xe,ui)))return!1}var Ro=Wr.get(Te);if(Ro&&Wr.get(Xe))return Ro==Xe;var gi=!0;Wr.set(Te,Xe),Wr.set(Xe,Te);for(var Ho=vr;++Do<ki;){ui=Ui[Do];var cs=Te[ui],da=Xe[ui];if(sr)var Vl=vr?sr(da,cs,ui,Xe,Te,Wr):sr(cs,da,ui,Te,Xe,Wr);if(!(Vl===void 0?cs===da||Dn(cs,da,Dt,sr,Wr):Vl)){gi=!1;break}Ho||(Ho=ui=="constructor")}if(gi&&!Ho){var us=Te.constructor,hs=Xe.constructor;us!=hs&&"constructor"in Te&&"constructor"in Xe&&!(typeof us=="function"&&us instanceof us&&typeof hs=="function"&&hs instanceof hs)&&(gi=!1)}return Wr.delete(Te),Wr.delete(Xe),gi}function ls(Te){return vo(Te,Cs,th)}function Ts(Te,Xe){var Dt=Te.__data__;return zt(Xe)?Dt[typeof Xe=="string"?"string":"hash"]:Dt.map}function pi(Te,Xe){var Dt=yt(Te,Xe);return Nr(Dt)?Dt:void 0}function ln(Te){var Xe=Rr.call(Te,qe),Dt=Te[qe];try{Te[qe]=void 0;var sr=!0}catch{}var Dn=Fn.call(Te);return sr&&(Xe?Te[qe]=Dt:delete Te[qe]),Dn}var th=we?function(Te){return Te==null?[]:(Te=Object(Te),xe(we(Te),function(Xe){return no.call(Te,Xe)}))}:Ul,Fe=Es;(Ze&&Fe(new Ze(new ArrayBuffer(1)))!=It||tt&&Fe(new tt)!=q||it&&Fe(it.resolve())!=Me||at&&Fe(new at)!=se||Ke&&Fe(new Ke)!=De)&&(Fe=function(Te){var Xe=Es(Te),Dt=Xe==ue?Te.constructor:void 0,sr=Dt?mi(Dt):"";if(sr)switch(sr){case _t:return It;case Ft:return q;case pr:return Me;case Ut:return se;case Or:return De}return Xe});function Et(Te,Xe){return Xe=Xe??O,!!Xe&&(typeof Te=="number"||gr.test(Te))&&Te>-1&&Te%1==0&&Te<Xe}function zt(Te){var Xe=typeof Te;return Xe=="string"||Xe=="number"||Xe=="symbol"||Xe=="boolean"?Te!=="__proto__":Te===null}function Ur(Te){return!!jn&&jn in Te}function tn(Te){var Xe=Te&&Te.constructor,Dt=typeof Xe=="function"&&Xe.prototype||In;return Te===Dt}function Xn(Te){return Fn.call(Te)}function mi(Te){if(Te!=null){try{return mn.call(Te)}catch{}try{return Te+""}catch{}}return""}function Yn(Te,Xe){return Te===Xe||Te!==Te&&Xe!==Xe}var bo=Na(function(){return arguments}())?Na:function(Te){return Oo(Te)&&Rr.call(Te,"callee")&&!no.call(Te,"callee")},Cn=Array.isArray;function En(Te){return Te!=null&&Yi(Te.length)&&!$i(Te)}var Ai=ke||Gs;function Vs(Te,Xe){return co(Te,Xe)}function $i(Te){if(!ha(Te))return!1;var Xe=Es(Te);return Xe==H||Xe==U||Xe==j||Xe==Se}function Yi(Te){return typeof Te=="number"&&Te>-1&&Te%1==0&&Te<=O}function ha(Te){var Xe=typeof Te;return Te!=null&&(Xe=="object"||Xe=="function")}function Oo(Te){return Te!=null&&typeof Te=="object"}var ei=_e?jt(_e):qr;function Cs(Te){return En(Te)?as(Te):xo(Te)}function Ul(){return[]}function Gs(){return!1}u.exports=Vs}).call(this)}).call(this,typeof mc<"u"?mc:typeof self<"u"?self:typeof window<"u"?window:{})},{}],12:[function(o,u,d){(function(g){(function(){var x=o("lodash._reinterpolate"),T=o("lodash.templatesettings"),s=800,I=16,O=1/0,D=9007199254740991,N="[object Arguments]",j="[object Array]",G="[object AsyncFunction]",X="[object Boolean]",te="[object Date]",H="[object DOMException]",U="[object Error]",q="[object Function]",J="[object GeneratorFunction]",pe="[object Map]",ue="[object Number]",Me="[object Null]",Se="[object Object]",ge="[object Proxy]",se="[object RegExp]",Ie="[object Set]",We="[object String]",ze="[object Symbol]",De="[object Undefined]",nt="[object WeakMap]",It="[object ArrayBuffer]",Ot="[object DataView]",bt="[object Float32Array]",rt="[object Float64Array]",Gt="[object Int8Array]",Vt="[object Int16Array]",Jt="[object Int32Array]",wr="[object Uint8Array]",or="[object Uint8ClampedArray]",et="[object Uint16Array]",At="[object Uint32Array]",Qt=/\b__p \+= '';/g,gr=/\b(__p \+=) '' \+/g,Nt=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Er=/[\\^$.*+?()[\]{}|]/g,Tr=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,$r=/^\[object .+?Constructor\]$/,Xr=/^(?:0|[1-9]\d*)$/,cn=/($^)/,Mn=/['\n\r\u2028\u2029\\]/g,mr={};mr[bt]=mr[rt]=mr[Gt]=mr[Vt]=mr[Jt]=mr[wr]=mr[or]=mr[et]=mr[At]=!0,mr[N]=mr[j]=mr[It]=mr[X]=mr[Ot]=mr[te]=mr[U]=mr[q]=mr[pe]=mr[ue]=mr[Se]=mr[se]=mr[Ie]=mr[We]=mr[nt]=!1;var vt={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},_e=typeof g=="object"&&g&&g.Object===Object&&g,xe=typeof self=="object"&&self&&self.Object===Object&&self,Re=_e||xe||Function("return this")(),ft=typeof d=="object"&&d&&!d.nodeType&&d,gt=ft&&typeof u=="object"&&u&&!u.nodeType&&u,jt=gt&&gt.exports===ft,$t=jt&&_e.process,yt=function(){try{var Fe=gt&&gt.require&&gt.require("util").types;return Fe||$t&&$t.binding&&$t.binding("util")}catch{}}(),ir=yt&&yt.isTypedArray;function lr(Fe,Et,zt){switch(zt.length){case 0:return Fe.call(Et);case 1:return Fe.call(Et,zt[0]);case 2:return Fe.call(Et,zt[0],zt[1]);case 3:return Fe.call(Et,zt[0],zt[1],zt[2])}return Fe.apply(Et,zt)}function fr(Fe,Et){for(var zt=-1,Ur=Fe==null?0:Fe.length,tn=Array(Ur);++zt<Ur;)tn[zt]=Et(Fe[zt],zt,Fe);return tn}function Gr(Fe,Et){for(var zt=-1,Ur=Array(Fe);++zt<Fe;)Ur[zt]=Et(zt);return Ur}function pn(Fe){return function(Et){return Fe(Et)}}function In(Fe,Et){return fr(Et,function(zt){return Fe[zt]})}function sn(Fe){return"\\"+vt[Fe]}function mn(Fe,Et){return Fe==null?void 0:Fe[Et]}function Rr(Fe,Et){return function(zt){return Fe(Et(zt))}}var jn=Function.prototype,Fn=Object.prototype,Ii=Re["__core-js_shared__"],ci=jn.toString,$n=Fn.hasOwnProperty,ii=function(){var Fe=/[^.]+$/.exec(Ii&&Ii.keys&&Ii.keys.IE_PROTO||"");return Fe?"Symbol(src)_1."+Fe:""}(),no=Fn.toString,Go=ci.call(Object),qe=RegExp("^"+ci.call($n).replace(Er,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),we=jt?Re.Buffer:void 0,ke=Re.Symbol,Ue=Rr(Object.getPrototypeOf,Object),Ze=Fn.propertyIsEnumerable,tt=ke?ke.toStringTag:void 0,it=function(){try{var Fe=Xi(Object,"defineProperty");return Fe({},"",{}),Fe}catch{}}(),at=we?we.isBuffer:void 0,Ke=Rr(Object.keys,Object),xt=Math.max,_t=Date.now,Ft=ke?ke.prototype:void 0,pr=Ft?Ft.toString:void 0;function Ut(Fe,Et){var zt=yo(Fe),Ur=!zt&&Wo(Fe),tn=!zt&&!Ur&&as(Fe),Xn=!zt&&!Ur&&!tn&&qr(Fe),mi=zt||Ur||tn||Xn,Yn=mi?Gr(Fe.length,String):[],bo=Yn.length;for(var Cn in Fe)(Et||$n.call(Fe,Cn))&&!(mi&&(Cn=="length"||tn&&(Cn=="offset"||Cn=="parent")||Xn&&(Cn=="buffer"||Cn=="byteLength"||Cn=="byteOffset")||bs(Cn,bo)))&&Yn.push(Cn);return Yn}function Or(Fe,Et,zt){var Ur=Fe[Et];(!($n.call(Fe,Et)&&qt(Ur,zt))||zt===void 0&&!(Et in Fe))&&Lr(Fe,Et,zt)}function Lr(Fe,Et,zt){Et=="__proto__"&&it?it(Fe,Et,{configurable:!0,enumerable:!0,value:zt,writable:!0}):Fe[Et]=zt}function Kr(Fe){return Fe==null?Fe===void 0?De:Me:tt&&tt in Object(Fe)?io(Fe):qo(Fe)}function an(Fe){return co(Fe)&&Kr(Fe)==N}function Zn(Fe){if(!Na(Fe)||jc(Fe))return!1;var Et=vo(Fe)?qe:$r;return Et.test(Ge(Fe))}function oi(Fe){return co(Fe)&&Es(Fe.length)&&!!mr[Kr(Fe)]}function fi(Fe){if(!ji(Fe))return Ke(Fe);var Et=[];for(var zt in Object(Fe))$n.call(Fe,zt)&&zt!="constructor"&&Et.push(zt);return Et}function Oi(Fe){if(!Na(Fe))return cl(Fe);var Et=ji(Fe),zt=[];for(var Ur in Fe)Ur=="constructor"&&(Et||!$n.call(Fe,Ur))||zt.push(Ur);return zt}function si(Fe,Et){return $s(Po(Fe,Et,ln),Fe+"")}var Bn=it?function(Fe,Et){return it(Fe,"toString",{configurable:!0,enumerable:!1,value:pi(Et),writable:!0})}:ln;function Di(Fe){if(typeof Fe=="string")return Fe;if(yo(Fe))return fr(Fe,Di)+"";if(Nr(Fe))return pr?pr.call(Fe):"";var Et=Fe+"";return Et=="0"&&1/Fe==-O?"-0":Et}function ko(Fe,Et,zt,Ur){var tn=!zt;zt||(zt={});for(var Xn=-1,mi=Et.length;++Xn<mi;){var Yn=Et[Xn],bo=Ur?Ur(zt[Yn],Fe[Yn],Yn,zt,Fe):void 0;bo===void 0&&(bo=Fe[Yn]),tn?Lr(zt,Yn,bo):Or(zt,Yn,bo)}return zt}function yn(Fe){return si(function(Et,zt){var Ur=-1,tn=zt.length,Xn=tn>1?zt[tn-1]:void 0,mi=tn>2?zt[2]:void 0;for(Xn=Fe.length>3&&typeof Xn=="function"?(tn--,Xn):void 0,mi&&ws(zt[0],zt[1],mi)&&(Xn=tn<3?void 0:Xn,tn=1),Et=Object(Et);++Ur<tn;){var Yn=zt[Ur];Yn&&Fe(Et,Yn,Ur,Xn)}return Et})}function wn(Fe,Et,zt,Ur){return Fe===void 0||qt(Fe,Fn[zt])&&!$n.call(Ur,zt)?Et:Fe}function Xi(Fe,Et){var zt=mn(Fe,Et);return Zn(zt)?zt:void 0}function io(Fe){var Et=$n.call(Fe,tt),zt=Fe[tt];try{Fe[tt]=void 0;var Ur=!0}catch{}var tn=no.call(Fe);return Ur&&(Et?Fe[tt]=zt:delete Fe[tt]),tn}function bs(Fe,Et){var zt=typeof Fe;return Et=Et??D,!!Et&&(zt=="number"||zt!="symbol"&&Xr.test(Fe))&&Fe>-1&&Fe%1==0&&Fe<Et}function ws(Fe,Et,zt){if(!Na(zt))return!1;var Ur=typeof Et;return(Ur=="number"?Un(zt)&&bs(Et,zt.length):Ur=="string"&&Et in zt)?qt(zt[Et],Fe):!1}function jc(Fe){return!!ii&&ii in Fe}function ji(Fe){var Et=Fe&&Fe.constructor,zt=typeof Et=="function"&&Et.prototype||Fn;return Fe===zt}function cl(Fe){var Et=[];if(Fe!=null)for(var zt in Object(Fe))Et.push(zt);return Et}function qo(Fe){return no.call(Fe)}function Po(Fe,Et,zt){return Et=xt(Et===void 0?Fe.length-1:Et,0),function(){for(var Ur=arguments,tn=-1,Xn=xt(Ur.length-Et,0),mi=Array(Xn);++tn<Xn;)mi[tn]=Ur[Et+tn];tn=-1;for(var Yn=Array(Et+1);++tn<Et;)Yn[tn]=Ur[tn];return Yn[Et]=zt(mi),lr(Fe,this,Yn)}}var $s=Ri(Bn);function Ri(Fe){var Et=0,zt=0;return function(){var Ur=_t(),tn=I-(Ur-zt);if(zt=Ur,tn>0){if(++Et>=s)return arguments[0]}else Et=0;return Fe.apply(void 0,arguments)}}function Ge(Fe){if(Fe!=null){try{return ci.call(Fe)}catch{}try{return Fe+""}catch{}}return""}function qt(Fe,Et){return Fe===Et||Fe!==Fe&&Et!==Et}var Wo=an(function(){return arguments}())?an:function(Fe){return co(Fe)&&$n.call(Fe,"callee")&&!Ze.call(Fe,"callee")},yo=Array.isArray;function Un(Fe){return Fe!=null&&Es(Fe.length)&&!vo(Fe)}var as=at||th;function za(Fe){if(!co(Fe))return!1;var Et=Kr(Fe);return Et==U||Et==H||typeof Fe.message=="string"&&typeof Fe.name=="string"&&!mt(Fe)}function vo(Fe){if(!Na(Fe))return!1;var Et=Kr(Fe);return Et==q||Et==J||Et==G||Et==ge}function Es(Fe){return typeof Fe=="number"&&Fe>-1&&Fe%1==0&&Fe<=D}function Na(Fe){var Et=typeof Fe;return Fe!=null&&(Et=="object"||Et=="function")}function co(Fe){return Fe!=null&&typeof Fe=="object"}function mt(Fe){if(!co(Fe)||Kr(Fe)!=Se)return!1;var Et=Ue(Fe);if(Et===null)return!0;var zt=$n.call(Et,"constructor")&&Et.constructor;return typeof zt=="function"&&zt instanceof zt&&ci.call(zt)==Go}function Nr(Fe){return typeof Fe=="symbol"||co(Fe)&&Kr(Fe)==ze}var qr=ir?pn(ir):oi;function xo(Fe){return Fe==null?"":Di(Fe)}var Ss=yn(function(Fe,Et,zt,Ur){ko(Et,Us(Et),Fe,Ur)});function zr(Fe){return Un(Fe)?Ut(Fe):fi(Fe)}function Us(Fe){return Un(Fe)?Ut(Fe,!0):Oi(Fe)}function ls(Fe,Et,zt){var Ur=T.imports._.templateSettings||T;zt&&ws(Fe,Et,zt)&&(Et=void 0),Fe=xo(Fe),Et=Ss({},Et,Ur,wn);var tn=Ss({},Et.imports,Ur.imports,wn),Xn=zr(tn),mi=In(tn,Xn),Yn,bo,Cn=0,En=Et.interpolate||cn,Ai="__p += '",Vs=RegExp((Et.escape||cn).source+"|"+En.source+"|"+(En===x?Tr:cn).source+"|"+(Et.evaluate||cn).source+"|$","g"),$i=$n.call(Et,"sourceURL")?"//# sourceURL="+(Et.sourceURL+"").replace(/[\r\n]/g," ")+`
`:"";Fe.replace(Vs,function(Oo,ei,Cs,Ul,Gs,Te){return Cs||(Cs=Ul),Ai+=Fe.slice(Cn,Te).replace(Mn,sn),ei&&(Yn=!0,Ai+=`' +
__e(`+ei+`) +
'`),Gs&&(bo=!0,Ai+=`';
`+Gs+`;
__p += '`),Cs&&(Ai+=`' +
((__t = (`+Cs+`)) == null ? '' : __t) +
'`),Cn=Te+Oo.length,Oo}),Ai+=`';
`;var Yi=$n.call(Et,"variable")&&Et.variable;Yi||(Ai=`with (obj) {
`+Ai+`
}
`),Ai=(bo?Ai.replace(Qt,""):Ai).replace(gr,"$1").replace(Nt,"$1;"),Ai="function("+(Yi||"obj")+`) {
`+(Yi?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(Yn?", __e = _.escape":"")+(bo?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Ai+`return __p
}`;var ha=Ts(function(){return Function(Xn,$i+"return "+Ai).apply(void 0,mi)});if(ha.source=Ai,za(ha))throw ha;return ha}var Ts=si(function(Fe,Et){try{return lr(Fe,void 0,Et)}catch(zt){return za(zt)?zt:new Error(zt)}});function pi(Fe){return function(){return Fe}}function ln(Fe){return Fe}function th(){return!1}u.exports=ls}).call(this)}).call(this,typeof mc<"u"?mc:typeof self<"u"?self:typeof window<"u"?window:{})},{"lodash._reinterpolate":9,"lodash.templatesettings":13}],13:[function(o,u,d){(function(g){(function(){var x=o("lodash._reinterpolate"),T=1/0,s="[object Symbol]",I=/[&<>"'`]/g,O=RegExp(I.source),D=/<%-([\s\S]+?)%>/g,N=/<%([\s\S]+?)%>/g,j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},G=typeof g=="object"&&g&&g.Object===Object&&g,X=typeof self=="object"&&self&&self.Object===Object&&self,te=G||X||Function("return this")();function H(De){return function(nt){return De==null?void 0:De[nt]}}var U=H(j),q=Object.prototype,J=q.toString,pe=te.Symbol,ue=pe?pe.prototype:void 0,Me=ue?ue.toString:void 0,Se={escape:D,evaluate:N,interpolate:x,variable:"",imports:{_:{escape:ze}}};function ge(De){if(typeof De=="string")return De;if(Ie(De))return Me?Me.call(De):"";var nt=De+"";return nt=="0"&&1/De==-T?"-0":nt}function se(De){return!!De&&typeof De=="object"}function Ie(De){return typeof De=="symbol"||se(De)&&J.call(De)==s}function We(De){return De==null?"":ge(De)}function ze(De){return De=We(De),De&&O.test(De)?De.replace(I,U):De}u.exports=Se}).call(this)}).call(this,typeof mc<"u"?mc:typeof self<"u"?self:typeof window<"u"?window:{})},{"lodash._reinterpolate":9}],14:[function(o,u,d){const g=o("is-plain-obj"),{hasOwnProperty:x}=Object.prototype,{propertyIsEnumerable:T}=Object,s=(U,q,J)=>Object.defineProperty(U,q,{value:J,writable:!0,enumerable:!0,configurable:!0}),I=this,O={concatArrays:!1,ignoreUndefined:!1},D=U=>{const q=[];for(const J in U)x.call(U,J)&&q.push(J);if(Object.getOwnPropertySymbols){const J=Object.getOwnPropertySymbols(U);for(const pe of J)T.call(U,pe)&&q.push(pe)}return q};function N(U){return Array.isArray(U)?j(U):g(U)?G(U):U}function j(U){const q=U.slice(0,0);return D(U).forEach(J=>{s(q,J,N(U[J]))}),q}function G(U){const q=Object.getPrototypeOf(U)===null?Object.create(null):{};return D(U).forEach(J=>{s(q,J,N(U[J]))}),q}const X=(U,q,J,pe)=>(J.forEach(ue=>{typeof q[ue]>"u"&&pe.ignoreUndefined||(ue in U&&U[ue]!==Object.getPrototypeOf(U)?s(U,ue,H(U[ue],q[ue],pe)):s(U,ue,N(q[ue])))}),U),te=(U,q,J)=>{let pe=U.slice(0,0),ue=0;return[U,q].forEach(Me=>{const Se=[];for(let ge=0;ge<Me.length;ge++)x.call(Me,ge)&&(Se.push(String(ge)),Me===U?s(pe,ue++,Me[ge]):s(pe,ue++,N(Me[ge])));pe=X(pe,Me,D(Me).filter(ge=>!Se.includes(ge)),J)}),pe};function H(U,q,J){return J.concatArrays&&Array.isArray(U)&&Array.isArray(q)?te(U,q,J):!g(q)||!g(U)?N(q):X(U,q,D(q),J)}u.exports=function(...U){const q=H(N(O),this!==I&&this||{},O);let J={_:{}};for(const pe of U)if(pe!==void 0){if(!g(pe))throw new TypeError("`"+pe+"` is not an Option Object");J=H(J,{_:pe},q)}return J._}},{"is-plain-obj":15}],15:[function(o,u,d){u.exports=g=>{if(Object.prototype.toString.call(g)!=="[object Object]")return!1;const x=Object.getPrototypeOf(g);return x===null||x===Object.prototype}},{}],16:[function(o,u,d){var g=u.exports={},x,T;function s(){throw new Error("setTimeout has not been defined")}function I(){throw new Error("clearTimeout has not been defined")}(function(){try{typeof setTimeout=="function"?x=setTimeout:x=s}catch{x=s}try{typeof clearTimeout=="function"?T=clearTimeout:T=I}catch{T=I}})();function O(J){if(x===setTimeout)return setTimeout(J,0);if((x===s||!x)&&setTimeout)return x=setTimeout,setTimeout(J,0);try{return x(J,0)}catch{try{return x.call(null,J,0)}catch{return x.call(this,J,0)}}}function D(J){if(T===clearTimeout)return clearTimeout(J);if((T===I||!T)&&clearTimeout)return T=clearTimeout,clearTimeout(J);try{return T(J)}catch{try{return T.call(null,J)}catch{return T.call(this,J)}}}var N=[],j=!1,G,X=-1;function te(){!j||!G||(j=!1,G.length?N=G.concat(N):X=-1,N.length&&H())}function H(){if(!j){var J=O(te);j=!0;for(var pe=N.length;pe;){for(G=N,N=[];++X<pe;)G&&G[X].run();X=-1,pe=N.length}G=null,j=!1,D(J)}}g.nextTick=function(J){var pe=new Array(arguments.length-1);if(arguments.length>1)for(var ue=1;ue<arguments.length;ue++)pe[ue-1]=arguments[ue];N.push(new U(J,pe)),N.length===1&&!j&&O(H)};function U(J,pe){this.fun=J,this.array=pe}U.prototype.run=function(){this.fun.apply(null,this.array)},g.title="browser",g.browser=!0,g.env={},g.argv=[],g.version="",g.versions={};function q(){}g.on=q,g.addListener=q,g.once=q,g.off=q,g.removeListener=q,g.removeAllListeners=q,g.emit=q,g.prependListener=q,g.prependOnceListener=q,g.listeners=function(J){return[]},g.binding=function(J){throw new Error("process.binding is not supported")},g.cwd=function(){return"/"},g.chdir=function(J){throw new Error("process.chdir is not supported")},g.umask=function(){return 0}},{}],17:[function(o,u,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;function g(s){var I=function(D){var N=D.dispatch,j=D.getState;return function(G){return function(X){return typeof X=="function"?X(N,j,s):G(X)}}};return I}var x=g();x.withExtraArgument=g;var T=x;d.default=T},{}],18:[function(o,u,d){(function(g){(function(){Object.defineProperty(d,"__esModule",{value:!0});var x=o("@babel/runtime/helpers/objectSpread2");function T(De){return De&&typeof De=="object"&&"default"in De?De:{default:De}}var s=T(x);function I(De){return"Minified Redux error #"+De+"; visit https://redux.js.org/Errors?code="+De+" for the full message or use the non-minified dev environment for full errors. "}var O=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}(),D=function(){return Math.random().toString(36).substring(7).split("").join(".")},N={INIT:"@@redux/INIT"+D(),REPLACE:"@@redux/REPLACE"+D(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+D()}};function j(De){if(typeof De!="object"||De===null)return!1;for(var nt=De;Object.getPrototypeOf(nt)!==null;)nt=Object.getPrototypeOf(nt);return Object.getPrototypeOf(De)===nt}function G(De){if(De===void 0)return"undefined";if(De===null)return"null";var nt=typeof De;switch(nt){case"boolean":case"string":case"number":case"symbol":case"function":return nt}if(Array.isArray(De))return"array";if(H(De))return"date";if(te(De))return"error";var It=X(De);switch(It){case"Symbol":case"Promise":case"WeakMap":case"WeakSet":case"Map":case"Set":return It}return nt.slice(8,-1).toLowerCase().replace(/\s/g,"")}function X(De){return typeof De.constructor=="function"?De.constructor.name:null}function te(De){return De instanceof Error||typeof De.message=="string"&&De.constructor&&typeof De.constructor.stackTraceLimit=="number"}function H(De){return De instanceof Date?!0:typeof De.toDateString=="function"&&typeof De.getDate=="function"&&typeof De.setDate=="function"}function U(De){var nt=typeof De;return g.env.NODE_ENV!=="production"&&(nt=G(De)),nt}function q(De,nt,It){var Ot;if(typeof nt=="function"&&typeof It=="function"||typeof It=="function"&&typeof arguments[3]=="function")throw new Error(g.env.NODE_ENV==="production"?I(0):"It looks like you are passing several store enhancers to createStore(). This is not supported. Instead, compose them together to a single function. See https://redux.js.org/tutorials/fundamentals/part-4-store#creating-a-store-with-enhancers for an example.");if(typeof nt=="function"&&typeof It>"u"&&(It=nt,nt=void 0),typeof It<"u"){if(typeof It!="function")throw new Error(g.env.NODE_ENV==="production"?I(1):"Expected the enhancer to be a function. Instead, received: '"+U(It)+"'");return It(q)(De,nt)}if(typeof De!="function")throw new Error(g.env.NODE_ENV==="production"?I(2):"Expected the root reducer to be a function. Instead, received: '"+U(De)+"'");var bt=De,rt=nt,Gt=[],Vt=Gt,Jt=!1;function wr(){Vt===Gt&&(Vt=Gt.slice())}function or(){if(Jt)throw new Error(g.env.NODE_ENV==="production"?I(3):"You may not call store.getState() while the reducer is executing. The reducer has already received the state as an argument. Pass it down from the top reducer instead of reading it from the store.");return rt}function et(Nt){if(typeof Nt!="function")throw new Error(g.env.NODE_ENV==="production"?I(4):"Expected the listener to be a function. Instead, received: '"+U(Nt)+"'");if(Jt)throw new Error(g.env.NODE_ENV==="production"?I(5):"You may not call store.subscribe() while the reducer is executing. If you would like to be notified after the store has been updated, subscribe from a component and invoke store.getState() in the callback to access the latest state. See https://redux.js.org/api/store#subscribelistener for more details.");var Er=!0;return wr(),Vt.push(Nt),function(){if(Er){if(Jt)throw new Error(g.env.NODE_ENV==="production"?I(6):"You may not unsubscribe from a store listener while the reducer is executing. See https://redux.js.org/api/store#subscribelistener for more details.");Er=!1,wr();var $r=Vt.indexOf(Nt);Vt.splice($r,1),Gt=null}}}function At(Nt){if(!j(Nt))throw new Error(g.env.NODE_ENV==="production"?I(7):"Actions must be plain objects. Instead, the actual type was: '"+U(Nt)+"'. You may need to add middleware to your store setup to handle dispatching other values, such as 'redux-thunk' to handle dispatching functions. See https://redux.js.org/tutorials/fundamentals/part-4-store#middleware and https://redux.js.org/tutorials/fundamentals/part-6-async-logic#using-the-redux-thunk-middleware for examples.");if(typeof Nt.type>"u")throw new Error(g.env.NODE_ENV==="production"?I(8):'Actions may not have an undefined "type" property. You may have misspelled an action type string constant.');if(Jt)throw new Error(g.env.NODE_ENV==="production"?I(9):"Reducers may not dispatch actions.");try{Jt=!0,rt=bt(rt,Nt)}finally{Jt=!1}for(var Er=Gt=Vt,Tr=0;Tr<Er.length;Tr++){var $r=Er[Tr];$r()}return Nt}function Qt(Nt){if(typeof Nt!="function")throw new Error(g.env.NODE_ENV==="production"?I(10):"Expected the nextReducer to be a function. Instead, received: '"+U(Nt));bt=Nt,At({type:N.REPLACE})}function gr(){var Nt,Er=et;return Nt={subscribe:function($r){if(typeof $r!="object"||$r===null)throw new Error(g.env.NODE_ENV==="production"?I(11):"Expected the observer to be an object. Instead, received: '"+U($r)+"'");function Xr(){$r.next&&$r.next(or())}Xr();var cn=Er(Xr);return{unsubscribe:cn}}},Nt[O]=function(){return this},Nt}return At({type:N.INIT}),Ot={dispatch:At,subscribe:et,getState:or,replaceReducer:Qt},Ot[O]=gr,Ot}var J=q;function pe(De){typeof console<"u"&&typeof console.error=="function"&&console.error(De);try{throw new Error(De)}catch{}}function ue(De,nt,It,Ot){var bt=Object.keys(nt),rt=It&&It.type===N.INIT?"preloadedState argument passed to createStore":"previous state received by the reducer";if(bt.length===0)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!j(De))return"The "+rt+' has unexpected type of "'+U(De)+'". Expected argument to be an object with the following '+('keys: "'+bt.join('", "')+'"');var Gt=Object.keys(De).filter(function(Vt){return!nt.hasOwnProperty(Vt)&&!Ot[Vt]});if(Gt.forEach(function(Vt){Ot[Vt]=!0}),!(It&&It.type===N.REPLACE)&&Gt.length>0)return"Unexpected "+(Gt.length>1?"keys":"key")+" "+('"'+Gt.join('", "')+'" found in '+rt+". ")+"Expected to find one of the known reducer keys instead: "+('"'+bt.join('", "')+'". Unexpected keys will be ignored.')}function Me(De){Object.keys(De).forEach(function(nt){var It=De[nt],Ot=It(void 0,{type:N.INIT});if(typeof Ot>"u")throw new Error(g.env.NODE_ENV==="production"?I(12):'The slice reducer for key "'+nt+`" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined. If you don't want to set a value for this reducer, you can use null instead of undefined.`);if(typeof It(void 0,{type:N.PROBE_UNKNOWN_ACTION()})>"u")throw new Error(g.env.NODE_ENV==="production"?I(13):'The slice reducer for key "'+nt+'" returned undefined when probed with a random type. '+("Don't try to handle '"+N.INIT+`' or other actions in "redux/*" `)+"namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined, but can be null.")})}function Se(De){for(var nt=Object.keys(De),It={},Ot=0;Ot<nt.length;Ot++){var bt=nt[Ot];g.env.NODE_ENV!=="production"&&typeof De[bt]>"u"&&pe('No reducer provided for key "'+bt+'"'),typeof De[bt]=="function"&&(It[bt]=De[bt])}var rt=Object.keys(It),Gt;g.env.NODE_ENV!=="production"&&(Gt={});var Vt;try{Me(It)}catch(Jt){Vt=Jt}return function(wr,or){if(wr===void 0&&(wr={}),Vt)throw Vt;if(g.env.NODE_ENV!=="production"){var et=ue(wr,It,or,Gt);et&&pe(et)}for(var At=!1,Qt={},gr=0;gr<rt.length;gr++){var Nt=rt[gr],Er=It[Nt],Tr=wr[Nt],$r=Er(Tr,or);if(typeof $r>"u"){var Xr=or&&or.type;throw new Error(g.env.NODE_ENV==="production"?I(14):"When called with an action of type "+(Xr?'"'+String(Xr)+'"':"(unknown type)")+', the slice reducer for key "'+Nt+'" returned undefined. To ignore an action, you must explicitly return the previous state. If you want this reducer to hold no value, you can return null instead of undefined.')}Qt[Nt]=$r,At=At||$r!==Tr}return At=At||rt.length!==Object.keys(wr).length,At?Qt:wr}}function ge(De,nt){return function(){return nt(De.apply(this,arguments))}}function se(De,nt){if(typeof De=="function")return ge(De,nt);if(typeof De!="object"||De===null)throw new Error(g.env.NODE_ENV==="production"?I(16):"bindActionCreators expected an object or a function, but instead received: '"+U(De)+`'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?`);var It={};for(var Ot in De){var bt=De[Ot];typeof bt=="function"&&(It[Ot]=ge(bt,nt))}return It}function Ie(){for(var De=arguments.length,nt=new Array(De),It=0;It<De;It++)nt[It]=arguments[It];return nt.length===0?function(Ot){return Ot}:nt.length===1?nt[0]:nt.reduce(function(Ot,bt){return function(){return Ot(bt.apply(void 0,arguments))}})}function We(){for(var De=arguments.length,nt=new Array(De),It=0;It<De;It++)nt[It]=arguments[It];return function(Ot){return function(){var bt=Ot.apply(void 0,arguments),rt=function(){throw new Error(g.env.NODE_ENV==="production"?I(15):"Dispatching while constructing your middleware is not allowed. Other middleware would not be applied to this dispatch.")},Gt={getState:bt.getState,dispatch:function(){return rt.apply(void 0,arguments)}},Vt=nt.map(function(Jt){return Jt(Gt)});return rt=Ie.apply(void 0,Vt)(bt.dispatch),s.default(s.default({},bt),{},{dispatch:rt})}}}function ze(){}g.env.NODE_ENV!=="production"&&typeof ze.name=="string"&&ze.name!=="isCrushed"&&pe('You are currently using minified code outside of NODE_ENV === "production". This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or setting mode to production in webpack (https://webpack.js.org/concepts/mode/) to ensure you have the correct code for your production build.'),d.__DO_NOT_USE__ActionTypes=N,d.applyMiddleware=We,d.bindActionCreators=se,d.combineReducers=Se,d.compose=Ie,d.createStore=q,d.legacy_createStore=J}).call(this)}).call(this,o("_process"))},{"@babel/runtime/helpers/objectSpread2":2,_process:16}],19:[function(o,u,d){var g=o("./src/suggestions");u.exports=g,typeof window<"u"&&(window.Suggestions=g)},{"./src/suggestions":21}],20:[function(o,u,d){var g=function(x){return this.component=x,this.items=[],this.active=0,this.wrapper=document.createElement("div"),this.wrapper.className="suggestions-wrapper",this.element=document.createElement("ul"),this.element.className="suggestions",this.wrapper.appendChild(this.element),this.selectingListItem=!1,x.el.parentNode.insertBefore(this.wrapper,x.el.nextSibling),this};g.prototype.show=function(){this.element.style.display="block"},g.prototype.hide=function(){this.element.style.display="none"},g.prototype.add=function(x){this.items.push(x)},g.prototype.clear=function(){this.items=[],this.active=0},g.prototype.isEmpty=function(){return!this.items.length},g.prototype.isVisible=function(){return this.element.style.display==="block"},g.prototype.draw=function(){if(this.element.innerHTML="",this.items.length===0){this.hide();return}for(var x=0;x<this.items.length;x++)this.drawItem(this.items[x],this.active===x);this.show()},g.prototype.drawItem=function(x,T){var s=document.createElement("li"),I=document.createElement("a");T&&(s.className+=" active"),I.innerHTML=x.string,s.appendChild(I),this.element.appendChild(s),s.addEventListener("mousedown",(function(){this.selectingListItem=!0}).bind(this)),s.addEventListener("mouseup",(function(){this.handleMouseUp.call(this,x)}).bind(this))},g.prototype.handleMouseUp=function(x){this.selectingListItem=!1,this.component.value(x.original),this.clear(),this.draw()},g.prototype.move=function(x){this.active=x,this.draw()},g.prototype.previous=function(){this.move(this.active===0?this.items.length-1:this.active-1)},g.prototype.next=function(){this.move(this.active===this.items.length-1?0:this.active+1)},g.prototype.drawError=function(x){var T=document.createElement("li");T.innerHTML=x,this.element.appendChild(T),this.show()},u.exports=g},{}],21:[function(o,u,d){var g=o("xtend"),x=o("fuzzy"),T=o("./list"),s=function(I,O,D){return D=D||{},this.options=g({minLength:2,limit:5,filter:!0,hideOnBlur:!0},D),this.el=I,this.data=O||[],this.list=new T(this),this.query="",this.selected=null,this.list.draw(),this.el.addEventListener("keyup",(function(N){this.handleKeyUp(N.keyCode)}).bind(this),!1),this.el.addEventListener("keydown",(function(N){this.handleKeyDown(N)}).bind(this)),this.el.addEventListener("focus",(function(){this.handleFocus()}).bind(this)),this.el.addEventListener("blur",(function(){this.handleBlur()}).bind(this)),this.el.addEventListener("paste",(function(N){this.handlePaste(N)}).bind(this)),this.render=this.options.render?this.options.render.bind(this):this.render.bind(this),this.getItemValue=this.options.getItemValue?this.options.getItemValue.bind(this):this.getItemValue.bind(this),this};s.prototype.handleKeyUp=function(I){I===40||I===38||I===27||I===13||I===9||this.handleInputChange(this.el.value)},s.prototype.handleKeyDown=function(I){switch(I.keyCode){case 13:case 9:this.list.isEmpty()||(this.list.isVisible()&&I.preventDefault(),this.value(this.list.items[this.list.active].original),this.list.hide());break;case 27:this.list.isEmpty()||this.list.hide();break;case 38:this.list.previous();break;case 40:this.list.next();break}},s.prototype.handleBlur=function(){!this.list.selectingListItem&&this.options.hideOnBlur&&this.list.hide()},s.prototype.handlePaste=function(I){if(I.clipboardData)this.handleInputChange(I.clipboardData.getData("Text"));else{var O=this;setTimeout(function(){O.handleInputChange(I.target.value)},100)}},s.prototype.handleInputChange=function(I){if(this.query=this.normalize(I),this.list.clear(),this.query.length<this.options.minLength){this.list.draw();return}this.getCandidates((function(O){for(var D=0;D<O.length&&(this.list.add(O[D]),D!==this.options.limit-1);D++);this.list.draw()}).bind(this))},s.prototype.handleFocus=function(){this.list.isEmpty()||this.list.show(),this.list.selectingListItem=!1},s.prototype.update=function(I){this.data=I,this.handleKeyUp()},s.prototype.clear=function(){this.data=[],this.list.clear()},s.prototype.normalize=function(I){return I=I.toLowerCase(),I},s.prototype.match=function(I,O){return I.indexOf(O)>-1},s.prototype.value=function(I){if(this.selected=I,this.el.value=this.getItemValue(I),document.createEvent){var O=document.createEvent("HTMLEvents");O.initEvent("change",!0,!1),this.el.dispatchEvent(O)}else this.el.fireEvent("onchange")},s.prototype.getCandidates=function(I){var O={pre:"<strong>",post:"</strong>",extract:(function(N){return this.getItemValue(N)}).bind(this)},D;this.options.filter?(D=x.filter(this.query,this.data,O),D=D.map((function(N){return{original:N.original,string:this.render(N.original,N.string)}}).bind(this))):D=this.data.map((function(N){var j=this.render(N);return{original:N,string:j}}).bind(this)),I(D)},s.prototype.getItemValue=function(I){return I},s.prototype.render=function(I,O){if(O)return O;for(var D=I.original?this.getItemValue(I.original):this.getItemValue(I),N=this.normalize(D),j=N.lastIndexOf(this.query);j>-1;){var G=j+this.query.length;D=D.slice(0,j)+"<strong>"+D.slice(j,G)+"</strong>"+D.slice(G),j=N.slice(0,j).lastIndexOf(this.query)}return D},s.prototype.renderError=function(I){this.list.drawError(I)},u.exports=s},{"./list":20,fuzzy:8,xtend:24}],22:[function(o,u,d){var g=o("turf-meta").coordEach;u.exports=function(x){var T=[1/0,1/0,-1/0,-1/0];return g(x,function(s){T[0]>s[0]&&(T[0]=s[0]),T[1]>s[1]&&(T[1]=s[1]),T[2]<s[0]&&(T[2]=s[0]),T[3]<s[1]&&(T[3]=s[1])}),T}},{"turf-meta":23}],23:[function(o,u,d){function g(I,O,D){var N,j,G,X,te,H,U,q,J=0,pe,ue=I.type==="FeatureCollection",Me=I.type==="Feature",Se=ue?I.features.length:1;for(N=0;N<Se;N++)for(q=ue?I.features[N].geometry:Me?I.geometry:I,pe=q.type==="GeometryCollection",H=pe?q.geometries.length:1,X=0;X<H;X++)if(te=pe?q.geometries[X]:q,U=te.coordinates,J=D&&(te.type==="Polygon"||te.type==="MultiPolygon")?1:0,te.type==="Point")O(U);else if(te.type==="LineString"||te.type==="MultiPoint")for(j=0;j<U.length;j++)O(U[j]);else if(te.type==="Polygon"||te.type==="MultiLineString")for(j=0;j<U.length;j++)for(G=0;G<U[j].length-J;G++)O(U[j][G]);else if(te.type==="MultiPolygon")for(j=0;j<U.length;j++)for(G=0;G<U[j].length;G++)for(l=0;l<U[j][G].length-J;l++)O(U[j][G][l]);else throw new Error("Unknown Geometry Type")}u.exports.coordEach=g;function x(I,O,D,N){return g(I,function(j){D=O(D,j)},N),D}u.exports.coordReduce=x;function T(I,O){var D;switch(I.type){case"FeatureCollection":for(features=I.features,D=0;D<I.features.length;D++)O(I.features[D].properties);break;case"Feature":O(I.properties);break}}u.exports.propEach=T;function s(I,O,D){return T(I,function(N){D=O(D,N)}),D}u.exports.propReduce=s},{}],24:[function(o,u,d){u.exports=x;var g=Object.prototype.hasOwnProperty;function x(){for(var T={},s=0;s<arguments.length;s++){var I=arguments[s];for(var O in I)g.call(I,O)&&(T[O]=I[O])}return T}},{}],25:[function(o,u,d){function g(et){"@babel/helpers - typeof";return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(At){return typeof At}:function(At){return At&&typeof Symbol=="function"&&At.constructor===Symbol&&At!==Symbol.prototype?"symbol":typeof At},g(et)}Object.defineProperty(d,"__esModule",{value:!0}),d.addWaypoint=Gt,d.clearDestination=se,d.clearOrigin=ge,d.createDestination=nt,d.createOrigin=De,d.eventEmit=or,d.eventSubscribe=wr,d.hoverMarker=We,d.queryDestination=ue,d.queryDestinationCoordinates=Se,d.queryOrigin=pe,d.queryOriginCoordinates=Me,d.removeWaypoint=Jt,d.reverse=Ot,d.setDestinationFromCoordinates=rt,d.setOptions=Ie,d.setOriginFromCoordinates=bt,d.setProfile=It,d.setRouteIndex=ze,d.setWaypoint=Vt;var x=O(o("../constants/action_types")),T=s(o("../utils"));function s(et){return et&&et.__esModule?et:{default:et}}function I(et){if(typeof WeakMap!="function")return null;var At=new WeakMap,Qt=new WeakMap;return(I=function(Nt){return Nt?Qt:At})(et)}function O(et,At){if(!At&&et&&et.__esModule)return et;if(et===null||g(et)!=="object"&&typeof et!="function")return{default:et};var Qt=I(At);if(Qt&&Qt.has(et))return Qt.get(et);var gr={},Nt=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var Er in et)if(Er!=="default"&&Object.prototype.hasOwnProperty.call(et,Er)){var Tr=Nt?Object.getOwnPropertyDescriptor(et,Er):null;Tr&&(Tr.get||Tr.set)?Object.defineProperty(gr,Er,Tr):gr[Er]=et[Er]}return gr.default=et,Qt&&Qt.set(et,gr),gr}function D(et){return function(At){var Qt=T.default.createPoint(et,{id:"origin","marker-symbol":"A"});At({type:x.ORIGIN,origin:Qt}),At(or("origin",{feature:Qt}))}}function N(et){return function(At){var Qt=T.default.createPoint(et,{id:"destination","marker-symbol":"B"});At({type:x.DESTINATION,destination:Qt}),At(or("destination",{feature:Qt}))}}function j(et){return function(At){At({type:x.DIRECTIONS_REQUEST_START,request:et})}}function G(et){return function(At){At({type:x.DIRECTIONS,directions:et}),At(or("route",{route:et}))}}function X(et){return{type:x.WAYPOINTS,waypoints:et}}function te(et){return{type:x.HOVER_MARKER,hoverMarker:et}}function H(){return function(et,At){var Qt=At(),gr=Qt.api,Nt=Qt.accessToken,Er=Qt.routeIndex,Tr=Qt.profile,$r=Qt.alternatives,Xr=Qt.congestion,cn=Qt.destination,Mn=Qt.language,mr=Qt.exclude,vt=Qt.fetchDirectionsRequest;if(cn&&cn.geometry){vt&&vt.abort();var _e=U(At),xe=[];xe.push("geometries=polyline"),$r&&xe.push("alternatives=true"),Xr&&xe.push("annotations=congestion"),xe.push("steps=true"),xe.push("overview=full"),Mn&&xe.push("language="+Mn),mr&&xe.push("exclude="+mr),Nt&&xe.push("access_token="+Nt);var Re=new XMLHttpRequest;Re.open("GET","".concat(gr).concat(Tr,"/").concat(_e,".json?").concat(xe.join("&")),!0),et(j(Re)),Re.onload=function(){if(Re.status>=200&&Re.status<400){var ft=JSON.parse(Re.responseText);if(ft.error)return et(G([])),et(J(ft.error));if(ft.message==="No route found")return et(J("No route found"));et(J(null)),ft.routes[Er]||et(ze(0)),et(G(ft.routes)),et(D(ft.waypoints[0].location)),et(N(ft.waypoints[ft.waypoints.length-1].location))}else return et(G([])),et(J(JSON.parse(Re.responseText).message))},Re.onerror=function(){return et(G([])),Re.responseText?et(J(JSON.parse(Re.responseText).message)):et(J("Error"))},Re.send()}}}function U(et){var At=et(),Qt=At.origin,gr=At.destination,Nt=At.waypoints,Er=[];return Er.push(Qt.geometry.coordinates.join(",")),Er.push(";"),Nt.length&&Nt.forEach(function(Tr){Er.push(Tr.geometry.coordinates.join(",")),Er.push(";")}),Er.push(gr.geometry.coordinates.join(",")),encodeURIComponent(Er.join(""))}function q(et){var At={id:"waypoint"};return Object.assign(et,{properties:et.properties?Object.assign(et.properties,At):At})}function J(et){return function(At){At({type:"ERROR",error:et}),et&&At(or("error",{error:et}))}}function pe(et){return{type:x.ORIGIN_QUERY,query:et}}function ue(et){return{type:x.DESTINATION_QUERY,query:et}}function Me(et){return{type:x.ORIGIN_FROM_COORDINATES,coordinates:et}}function Se(et){return{type:x.DESTINATION_FROM_COORDINATES,coordinates:et}}function ge(){return function(et){et({type:x.ORIGIN_CLEAR}),et(or("clear",{type:"origin"})),et(J(null))}}function se(){return function(et,At){var Qt=At(),gr=Qt.fetchDirectionsRequest;gr&&gr.abort(),et({type:x.DESTINATION_CLEAR}),et(or("clear",{type:"destination"})),et(J(null))}}function Ie(et){return{type:x.SET_OPTIONS,options:et}}function We(et){return function(At){var Qt=et?T.default.createPoint(et,{id:"hover"}):{};At(te(Qt))}}function ze(et){return{type:x.ROUTE_INDEX,routeIndex:et}}function De(et){return function(At,Qt){var gr=Qt(),Nt=gr.destination;At(D(et)),Nt.geometry&&At(H())}}function nt(et){return function(At,Qt){var gr=Qt(),Nt=gr.origin;At(N(et)),Nt.geometry&&At(H())}}function It(et){return function(At,Qt){var gr=Qt(),Nt=gr.origin,Er=gr.destination;At({type:x.DIRECTIONS_PROFILE,profile:et}),At(or("profile",{profile:et})),Nt.geometry&&Er.geometry&&At(H())}}function Ot(){return function(et,At){var Qt=At();Qt.destination.geometry&&et(D(Qt.destination.geometry.coordinates)),Qt.origin.geometry&&et(N(Qt.origin.geometry.coordinates)),Qt.origin.geometry&&Qt.destination.geometry&&et(H());for(var gr=document.getElementsByClassName("suggestions"),Nt=0;Nt<gr.length;Nt++)gr[Nt].style.visibility="hidden"}}function bt(et){return function(At){if(T.default.validCoords(et)||(et=[T.default.wrap(et[0]),T.default.wrap(et[1])]),isNaN(et[0])&&isNaN(et[1]))return At(J(new Error("Coordinates are not valid")));At(Me(et)),At(De(et))}}function rt(et){return function(At){if(T.default.validCoords(et)||(et=[T.default.wrap(et[0]),T.default.wrap(et[1])]),isNaN(et[0])&&isNaN(et[1]))return At(J(new Error("Coordinates are not valid")));At(nt(et)),At(Se(et))}}function Gt(et,At){return function(Qt,gr){var Nt=gr(),Er=Nt.destination,Tr=Nt.waypoints;Tr.splice(et,0,q(At)),Qt(X(Tr)),Er.geometry&&Qt(H())}}function Vt(et,At){return function(Qt,gr){var Nt=gr(),Er=Nt.destination,Tr=Nt.waypoints;Tr[et]=q(At),Qt(X(Tr)),Er.geometry&&Qt(H())}}function Jt(et){return function(At,Qt){var gr=Qt(),Nt=gr.destination,Er=gr.waypoints;Er=Er.filter(function(Tr){return!T.default.coordinateMatch(Tr,et)}),At(X(Er)),Nt.geometry&&At(H())}}function wr(et,At){return function(Qt,gr){var Nt=gr(),Er=Nt.events;return Er[et]=Er[et]||[],Er[et].push(At),{type:x.EVENTS,events:Er}}}function or(et,At){var Qt=this;return function(gr,Nt){var Er=Nt(),Tr=Er.events;if(!Tr[et])return{type:x.EVENTS,events:Tr};for(var $r=Tr[et].slice(),Xr=0;Xr<$r.length;Xr++)$r[Xr].call(Qt,At)}}},{"../constants/action_types":26,"../utils":34}],26:[function(o,u,d){Object.defineProperty(d,"__esModule",{value:!0}),d.WAYPOINTS=d.SET_OPTIONS=d.ROUTE_INDEX=d.ORIGIN_QUERY=d.ORIGIN_FROM_COORDINATES=d.ORIGIN_CLEAR=d.ORIGIN=d.HOVER_MARKER=d.EVENTS=d.ERROR=d.DIRECTIONS_REQUEST_START=d.DIRECTIONS_PROFILE=d.DIRECTIONS=d.DESTINATION_QUERY=d.DESTINATION_FROM_COORDINATES=d.DESTINATION_CLEAR=d.DESTINATION=void 0;var g="DESTINATION";d.DESTINATION=g;var x="DESTINATION_CLEAR";d.DESTINATION_CLEAR=x;var T="DESTINATION_QUERY";d.DESTINATION_QUERY=T;var s="DESTINATION_FROM_COORDINATES";d.DESTINATION_FROM_COORDINATES=s;var I="DIRECTIONS";d.DIRECTIONS=I;var O="DIRECTIONS_REQUEST_START";d.DIRECTIONS_REQUEST_START=O;var D="DIRECTIONS_PROFILE";d.DIRECTIONS_PROFILE=D;var N="EVENTS";d.EVENTS=N;var j="ERROR";d.ERROR=j;var G="HOVER_MARKER";d.HOVER_MARKER=G;var X="ORIGIN";d.ORIGIN=X;var te="ORIGIN_CLEAR";d.ORIGIN_CLEAR=te;var H="ORIGIN_QUERY";d.ORIGIN_QUERY=H;var U="ORIGIN_FROM_COORDINATES";d.ORIGIN_FROM_COORDINATES=U;var q="ROUTE_INDEX";d.ROUTE_INDEX=q;var J="SET_OPTIONS";d.SET_OPTIONS=J;var pe="WAYPOINTS";d.WAYPOINTS=pe},{}],27:[function(o,u,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var g=I(o("suggestions")),x=I(o("lodash.debounce")),T=o("events"),s=I(o("../utils"));function I(H){return H&&H.__esModule?H:{default:H}}function O(H){"@babel/helpers - typeof";return O=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(U){return typeof U}:function(U){return U&&typeof Symbol=="function"&&U.constructor===Symbol&&U!==Symbol.prototype?"symbol":typeof U},O(H)}function D(H,U){if(!(H instanceof U))throw new TypeError("Cannot call a class as a function")}function N(H,U){for(var q=0;q<U.length;q++){var J=U[q];J.enumerable=J.enumerable||!1,J.configurable=!0,"value"in J&&(J.writable=!0),Object.defineProperty(H,G(J.key),J)}}function j(H,U,q){return U&&N(H.prototype,U),q&&N(H,q),Object.defineProperty(H,"prototype",{writable:!1}),H}function G(H){var U=X(H,"string");return O(U)==="symbol"?U:String(U)}function X(H,U){if(O(H)!=="object"||H===null)return H;var q=H[Symbol.toPrimitive];if(q!==void 0){var J=q.call(H,U||"default");if(O(J)!=="object")return J;throw new TypeError("@@toPrimitive must return a primitive value.")}return(U==="string"?String:Number)(H)}var te=function(){function H(U){D(this,H),this._ev=new T.EventEmitter,this.options=U,this.api=U&&U.api||"https://api.mapbox.com/geocoding/v5/mapbox.places/"}return j(H,[{key:"onAdd",value:function(q){this._map=q,this.request=new XMLHttpRequest;var J=document.createElement("div");J.className="mapboxgl-ctrl-geocoder";var pe=document.createElement("span");pe.className="geocoder-icon geocoder-icon-search";var ue=this._inputEl=document.createElement("input");ue.type="text",ue.placeholder=this.options.placeholder,ue.addEventListener("keydown",(0,x.default)((function(se){if(!se.target.value)return this._clearEl.classList.remove("active");se.metaKey||[9,27,37,39,13,38,40].indexOf(se.keyCode)!==-1||this._queryFromInput(se.target.value)}).bind(this)),200),ue.addEventListener("change",(function(se){se.target.value&&this._clearEl.classList.add("active");var Ie=this._typeahead.selected;if(Ie){if(this.options.flyTo)if(Ie.bbox&&Ie.context&&Ie.context.length<=3||Ie.bbox&&!Ie.context){var We=Ie.bbox;q.fitBounds([[We[0],We[1]],[We[2],We[3]]])}else q.flyTo({center:Ie.center,zoom:this.options.zoom});this._input=Ie,this.fire("result",{result:Ie})}}).bind(this));var Me=document.createElement("div");Me.classList.add("geocoder-pin-right");var Se=this._clearEl=document.createElement("button");Se.className="geocoder-icon geocoder-icon-close",Se.addEventListener("click",this._clear.bind(this));var ge=this._loadingEl=document.createElement("span");return ge.className="geocoder-icon geocoder-icon-loading",Me.appendChild(Se),Me.appendChild(ge),J.appendChild(pe),J.appendChild(ue),J.appendChild(Me),this.options.container&&(this.options.position=!1),this._typeahead=new g.default(ue,[],{filter:!1}),this._typeahead.getItemValue=function(se){return se.place_name},J}},{key:"_geocode",value:function(q,J){this._loadingEl.classList.add("active"),this.fire("loading");var pe=this.options,ue=["placeholder","zoom","flyTo","accessToken","api"],Me=Object.keys(this.options).filter(function(ge){return ue.indexOf(ge)===-1}).map(function(ge){return ge+"="+pe[ge]}),Se=this.options.accessToken?this.options.accessToken:mapboxgl.accessToken;Me.push("access_token="+Se),this.request.abort(),this.request.open("GET",this.api+encodeURIComponent(q.trim())+".json?"+Me.join("&"),!0),this.request.onload=(function(){if(this._loadingEl.classList.remove("active"),this.request.status>=200&&this.request.status<400){var ge=JSON.parse(this.request.responseText);return ge.features.length?this._clearEl.classList.add("active"):(this._clearEl.classList.remove("active"),this._typeahead.selected=null),this.fire("results",{results:ge.features}),this._typeahead.update(ge.features),J(ge.features)}else this.fire("error",{error:JSON.parse(this.request.responseText).message})}).bind(this),this.request.onerror=(function(){this._loadingEl.classList.remove("active"),this.fire("error",{error:JSON.parse(this.request.responseText).message})}).bind(this),this.request.send()}},{key:"_queryFromInput",value:function(q){q=q.trim(),q||this._clear(),q.length>2&&this._geocode(q,(function(J){this._results=J}).bind(this))}},{key:"_change",value:function(){var q=document.createEvent("HTMLEvents");q.initEvent("change",!0,!1),this._inputEl.dispatchEvent(q)}},{key:"_query",value:function(q){q&&(O(q)==="object"&&q.length&&(q=[s.default.wrap(q[0]),s.default.wrap(q[1])].join()),this._geocode(q,(function(J){if(J.length){var pe=J[0];this._results=J,this._typeahead.selected=pe,this._inputEl.value=pe.place_name,this._change()}}).bind(this)))}},{key:"_setInput",value:function(q){q&&(O(q)==="object"&&q.length&&(q=[s.default.roundWithOriginalPrecision(s.default.wrap(q[0]),q[0]),s.default.roundWithOriginalPrecision(s.default.wrap(q[1]),q[1])].join()),this._inputEl.value=q,this._input=null,this._typeahead.selected=null,this._typeahead.clear(),this._change())}},{key:"_clear",value:function(){this._input=null,this._inputEl.value="",this._typeahead.selected=null,this._typeahead.clear(),this._change(),this._inputEl.focus(),this._clearEl.classList.remove("active"),this.fire("clear")}},{key:"getResult",value:function(){return this._input}},{key:"query",value:function(q){return this._query(q),this}},{key:"setInput",value:function(q){return this._setInput(q),this}},{key:"on",value:function(q,J){return this._ev.on(q,J),this._ev.on("error",function(pe){console.log(pe)}),this}},{key:"fire",value:function(q,J){return this._ev.emit(q,J),this}},{key:"off",value:function(q,J){return this._ev.removeListener(q,J),this}}]),H}();d.default=te},{"../utils":34,events:7,"lodash.debounce":10,suggestions:19}],28:[function(o,u,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var g=I(o("./geocoder")),x=I(o("lodash.template")),T=I(o("lodash.isequal")),s=I(o("turf-extent"));function I(U){return U&&U.__esModule?U:{default:U}}function O(U){"@babel/helpers - typeof";return O=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(q){return typeof q}:function(q){return q&&typeof Symbol=="function"&&q.constructor===Symbol&&q!==Symbol.prototype?"symbol":typeof q},O(U)}function D(U,q){if(!(U instanceof q))throw new TypeError("Cannot call a class as a function")}function N(U,q){for(var J=0;J<q.length;J++){var pe=q[J];pe.enumerable=pe.enumerable||!1,pe.configurable=!0,"value"in pe&&(pe.writable=!0),Object.defineProperty(U,G(pe.key),pe)}}function j(U,q,J){return q&&N(U.prototype,q),J&&N(U,J),Object.defineProperty(U,"prototype",{writable:!1}),U}function G(U){var q=X(U,"string");return O(q)==="symbol"?q:String(q)}function X(U,q){if(O(U)!=="object"||U===null)return U;var J=U[Symbol.toPrimitive];if(J!==void 0){var pe=J.call(U,q||"default");if(O(pe)!=="object")return pe;throw new TypeError("@@toPrimitive must return a primitive value.")}return(q==="string"?String:Number)(U)}var te=(0,x.default)(`<div class='mapbox-directions-component mapbox-directions-inputs'>
  <div class='mapbox-directions-component-keyline'>
    <div class='mapbox-directions-origin'>
      <label class='mapbox-form-label'>
        <span class='directions-icon directions-icon-depart'></span>
      </label>
      <div id='mapbox-directions-origin-input'></div>
    </div>

    <button
      class='directions-icon directions-icon-reverse directions-reverse js-reverse-inputs'
      title='Reverse origin &amp; destination'>
    </button>

    <div class='mapbox-directions-destination'>
      <label class='mapbox-form-label'>
        <span class='directions-icon directions-icon-arrive'></span>
      </label>
      <div id='mapbox-directions-destination-input'></div>
    </div>
  </div>

  <% if (controls.profileSwitcher) { %>
  <div class='mapbox-directions-profile mapbox-directions-component-keyline mapbox-directions-clearfix'><input
      id='mapbox-directions-profile-driving-traffic'
      type='radio'
      name='profile'
      value='mapbox/driving-traffic'
      <% if (profile === 'mapbox/driving-traffic') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-driving-traffic'>Traffic</label>
    <input
      id='mapbox-directions-profile-driving'
      type='radio'
      name='profile'
      value='mapbox/driving'
      <% if (profile === 'mapbox/driving') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-driving'>Driving</label>
    <input
      id='mapbox-directions-profile-walking'
      type='radio'
      name='profile'
      value='mapbox/walking'
      <% if (profile === 'mapbox/walking') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-walking'>Walking</label>
    <input
      id='mapbox-directions-profile-cycling'
      type='radio'
      name='profile'
      value='mapbox/cycling'
      <% if (profile === 'mapbox/cycling') { %>checked<% } %>
    />
    <label for='mapbox-directions-profile-cycling'>Cycling</label>
  </div>
  <% } %>
</div>
`),H=function(){function U(q,J,pe,ue){D(this,U);var Me=J.getState(),Se=Me.originQuery,ge=Me.destinationQuery,se=Me.profile,Ie=Me.controls;q.innerHTML=te({originQuery:Se,destinationQuery:ge,profile:se,controls:Ie}),this.container=q,this.actions=pe,this.store=J,this._map=ue,this.onAdd(),this.render()}return j(U,[{key:"animateToCoordinates",value:function(J,pe){var ue=this.store.getState(),Me=ue.origin,Se=ue.destination,ge=ue.routePadding;if(Me.geometry&&Se.geometry&&!(0,T.default)(Me.geometry,Se.geometry)){var se=(0,s.default)({type:"FeatureCollection",features:[Me,Se]});this._map.fitBounds([[se[0],se[1]],[se[2],se[3]]],{padding:ge})}else this._map.flyTo({center:pe})}},{key:"onAdd",value:function(){var J=this,pe=this.actions,ue=pe.clearOrigin,Me=pe.clearDestination,Se=pe.createOrigin,ge=pe.createDestination,se=pe.setProfile,Ie=pe.reverse,We=this.store.getState(),ze=We.geocoder,De=We.accessToken,nt=We.flyTo,It=We.placeholderOrigin,Ot=We.placeholderDestination,bt=We.zoom;this.originInput=new g.default(Object.assign({},{accessToken:De},ze,{flyTo:nt,placeholder:It,zoom:bt}));var rt=this.originInput.onAdd(this._map),Gt=this.container.querySelector("#mapbox-directions-origin-input");Gt.appendChild(rt),this.destinationInput=new g.default(Object.assign({},{accessToken:De},ze,{flyTo:nt,placeholder:Ot,zoom:bt}));var Vt=this.destinationInput.onAdd(this._map);this.container.querySelector("#mapbox-directions-destination-input").appendChild(Vt),this.originInput.on("result",function(wr){var or=wr.result.center;Se(or),J.animateToCoordinates("origin",or)}),this.originInput.on("clear",ue),this.destinationInput.on("result",function(wr){var or=wr.result.center;ge(or),J.animateToCoordinates("destination",or)}),this.destinationInput.on("clear",Me);var Jt=this.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(Jt,function(wr){wr.addEventListener("change",function(){se(wr.value)})}),this.container.querySelector(".js-reverse-inputs").addEventListener("click",function(){var wr=J.store.getState(),or=wr.origin,et=wr.destination;or&&J.actions.queryDestination(or.geometry.coordinates),et&&J.actions.queryOrigin(et.geometry.coordinates),Ie()})}},{key:"render",value:function(){var J=this;this.store.subscribe(function(){var pe=J.store.getState(),ue=pe.originQuery,Me=pe.destinationQuery,Se=pe.originQueryCoordinates,ge=pe.destinationQueryCoordinates;ue&&(J.originInput.query(ue),J.actions.queryOrigin(null)),Me&&(J.destinationInput.query(Me),J.actions.queryDestination(null)),Se&&(J.originInput.setInput(Se),J.animateToCoordinates("origin",Se),J.actions.queryOriginCoordinates(null)),ge&&(J.destinationInput.setInput(ge),J.animateToCoordinates("destination",ge),J.actions.queryDestinationCoordinates(null))})}}]),U}();d.default=H},{"./geocoder":27,"lodash.isequal":11,"lodash.template":12,"turf-extent":22}],29:[function(o,u,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var g=s(o("../utils")),x=s(o("lodash.template")),T=s(o("lodash.isequal"));function s(U){return U&&U.__esModule?U:{default:U}}function I(U){"@babel/helpers - typeof";return I=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(q){return typeof q}:function(q){return q&&typeof Symbol=="function"&&q.constructor===Symbol&&q!==Symbol.prototype?"symbol":typeof q},I(U)}function O(U,q){if(!(U instanceof q))throw new TypeError("Cannot call a class as a function")}function D(U,q){for(var J=0;J<q.length;J++){var pe=q[J];pe.enumerable=pe.enumerable||!1,pe.configurable=!0,"value"in pe&&(pe.writable=!0),Object.defineProperty(U,j(pe.key),pe)}}function N(U,q,J){return q&&D(U.prototype,q),J&&D(U,J),Object.defineProperty(U,"prototype",{writable:!1}),U}function j(U){var q=G(U,"string");return I(q)==="symbol"?q:String(q)}function G(U,q){if(I(U)!=="object"||U===null)return U;var J=U[Symbol.toPrimitive];if(J!==void 0){var pe=J.call(U,q||"default");if(I(pe)!=="object")return pe;throw new TypeError("@@toPrimitive must return a primitive value.")}return(q==="string"?String:Number)(U)}var X=(0,x.default)(`<div class='directions-control directions-control-directions'>
  <div class='mapbox-directions-component mapbox-directions-route-summary<% if (routes > 1) { %> mapbox-directions-multiple<% } %>'>
    <% if (routes > 1) { %>
    <div class='mapbox-directions-routes mapbox-directions-clearfix'>
      <% for (var i = 0; i < routes; i++) { %>
        <input type='radio' name='routes' id='<%= i %>' <% if (i === routeIndex) { %>checked<% } %>>
        <label for='<%= i %>' class='mapbox-directions-route'><%= i + 1 %></label>
      <% } %>
    </div>
    <% } %>
    <h1><%- duration %></h1>
    <span><%- distance %></span>
  </div>

  <div class='mapbox-directions-instructions'>
    <div class='mapbox-directions-instructions-wrapper'>
      <ol class='mapbox-directions-steps'>
        <% steps.forEach(function(step) { %>
          <%
            var distance = step.distance ? format(step.distance) : false;
            var icon = step.maneuver.modifier ? step.maneuver.modifier.replace(/\\s+/g, '-').toLowerCase() : step.maneuver.type.replace(/\\s+/g, '-').toLowerCase();

            if (['arrive', 'depart', 'waypoint'].includes(step.maneuver.type)) {
              icon = step.maneuver.type;
            }

            if (step.maneuver.type === 'roundabout' || step.maneuver.type === 'rotary') {
              icon = 'roundabout';
            }

            var lng = step.maneuver.location[0];
            var lat = step.maneuver.location[1];
          %>
          <li
            data-lat='<%= lat %>'
            data-lng='<%= lng %>'
            class='mapbox-directions-step'>
            <span class='directions-icon directions-icon-<%= icon %>'></span>
            <div class='mapbox-directions-step-maneuver'>
              <%= step.maneuver.instruction %>
            </div>
            <% if (distance) { %>
              <div class='mapbox-directions-step-distance'>
                <%= distance %>
              </div>
            <% } %>
          </li>
        <% }); %>
      </ol>
    </div>
  </div>
</div>
`),te=(0,x.default)(`<div class='directions-control directions-control-directions'>
  <div class='mapbox-directions-error'>
    <%= error %>
  </div>
</div>
`),H=function(){function U(q,J,pe,ue){O(this,U),this.container=q,this.actions=pe,this.store=J,this._map=ue,this.directions={},this.render()}return N(U,[{key:"render",value:function(){var J=this;this.store.subscribe(function(){var pe=J.actions,ue=pe.hoverMarker,Me=pe.setRouteIndex,Se=J.store.getState(),ge=Se.routeIndex,se=Se.unit,Ie=Se.directions,We=Se.error,ze=Se.compile,De=Se.instructions,nt=!(0,T.default)(Ie[ge],J.directions);if(We){J.container.innerHTML=te({error:We});return}var It=De.showWaypointInstructions?void 0:function(Vt){return Vt.maneuver.type!=="waypoint"};if(Ie.length&&nt){var Ot=J.directions=Ie[ge],bt=g.default.getAllSteps(Ot,It);ze&&Ot.legs.forEach(function(Vt){Vt.steps.forEach(function(Jt){Jt.maneuver.instruction=ze("en",Jt)})}),J.container.innerHTML=X({routeIndex:ge,routes:Ie.length,steps:bt,format:g.default.format[se],duration:g.default.format.duration(Ot.duration),distance:g.default.format[se](Ot.distance)});var rt=J.container.querySelectorAll(".mapbox-directions-step");Array.prototype.forEach.call(rt,function(Vt){var Jt=Vt.getAttribute("data-lng"),wr=Vt.getAttribute("data-lat");Vt.addEventListener("mouseover",function(){ue([Jt,wr])}),Vt.addEventListener("mouseout",function(){ue(null)}),Vt.addEventListener("click",function(){J._map.flyTo({center:[Jt,wr],zoom:16})})});var Gt=J.container.querySelectorAll('input[type="radio"]');Array.prototype.forEach.call(Gt,function(Vt){Vt.addEventListener("change",function(Jt){Me(parseInt(Jt.target.id,10))})})}else J.container.innerHTML&&nt&&(J.container.innerHTML="")})}}]),U}();d.default=H},{"../utils":34,"lodash.isequal":11,"lodash.template":12}],30:[function(o,u,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var g=o("redux"),x=te(o("redux-thunk")),T=o("@mapbox/polyline"),s=te(o("./utils")),I=te(o("./reducers")),O=X(o("./actions")),D=te(o("./directions_style")),N=te(o("./controls/inputs")),j=te(o("./controls/instructions"));function G(Se){if(typeof WeakMap!="function")return null;var ge=new WeakMap,se=new WeakMap;return(G=function(We){return We?se:ge})(Se)}function X(Se,ge){if(!ge&&Se&&Se.__esModule)return Se;if(Se===null||H(Se)!=="object"&&typeof Se!="function")return{default:Se};var se=G(ge);if(se&&se.has(Se))return se.get(Se);var Ie={},We=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var ze in Se)if(ze!=="default"&&Object.prototype.hasOwnProperty.call(Se,ze)){var De=We?Object.getOwnPropertyDescriptor(Se,ze):null;De&&(De.get||De.set)?Object.defineProperty(Ie,ze,De):Ie[ze]=Se[ze]}return Ie.default=Se,se&&se.set(Se,Ie),Ie}function te(Se){return Se&&Se.__esModule?Se:{default:Se}}function H(Se){"@babel/helpers - typeof";return H=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ge){return typeof ge}:function(ge){return ge&&typeof Symbol=="function"&&ge.constructor===Symbol&&ge!==Symbol.prototype?"symbol":typeof ge},H(Se)}function U(Se,ge){if(!(Se instanceof ge))throw new TypeError("Cannot call a class as a function")}function q(Se,ge){for(var se=0;se<ge.length;se++){var Ie=ge[se];Ie.enumerable=Ie.enumerable||!1,Ie.configurable=!0,"value"in Ie&&(Ie.writable=!0),Object.defineProperty(Se,pe(Ie.key),Ie)}}function J(Se,ge,se){return ge&&q(Se.prototype,ge),se&&q(Se,se),Object.defineProperty(Se,"prototype",{writable:!1}),Se}function pe(Se){var ge=ue(Se,"string");return H(ge)==="symbol"?ge:String(ge)}function ue(Se,ge){if(H(Se)!=="object"||Se===null)return Se;var se=Se[Symbol.toPrimitive];if(se!==void 0){var Ie=se.call(Se,ge||"default");if(H(Ie)!=="object")return Ie;throw new TypeError("@@toPrimitive must return a primitive value.")}return(ge==="string"?String:Number)(Se)}var Me=function(){function Se(ge){U(this,Se),this._directions=null,this._stateSnapshot=null,this._store=this._initStore(),this.actions=(0,g.bindActionCreators)(O,this._store.dispatch),this.actions.setOptions(ge||{}),this.options=ge||{},this.onDragDown=this._onDragDown.bind(this),this.onDragMove=this._onDragMove.bind(this),this.onDragUp=this._onDragUp.bind(this),this.move=this._move.bind(this),this.onClick=this._clickHandler().bind(this)}return J(Se,[{key:"onAdd",value:function(se){var Ie=this;this._map=se;var We=this._store.getState(),ze=We.controls,De=this.container=document.createElement("div");De.className="mapboxgl-ctrl-directions mapboxgl-ctrl";var nt=document.createElement("div");nt.className="directions-control directions-control-inputs",new N.default(nt,this._store,this.actions,this._map);var It=document.createElement("div");return It.className="directions-control directions-control-instructions",new j.default(It,this._store,{hoverMarker:this.actions.hoverMarker,setRouteIndex:this.actions.setRouteIndex},this._map),ze.inputs&&De.appendChild(nt),ze.instructions&&De.appendChild(It),this.subscribedActions(),this._map.loaded()?this.mapState():this._map.on("load",function(){return Ie.mapState()}),De}},{key:"onRemove",value:function(se){return this.container.parentNode.removeChild(this.container),this.removeRoutes(),se.off("mousedown",this.onDragDown),se.off("mousemove",this.move),se.off("touchstart",this.onDragDown),se.off("touchstart",this.move),se.off("click",this.onClick),this.storeUnsubscribe&&(this.storeUnsubscribe(),delete this.storeUnsubscribe),D.default.forEach(function(Ie){se.getLayer(Ie.id)&&se.removeLayer(Ie.id)}),se.getSource("directions")&&se.removeSource("directions"),se.getSource("directions:markers")&&se.removeSource("directions:markers"),this._map=null,this}},{key:"mapState",value:function(){var se=this,Ie=this._store.getState(),We=Ie.profile;Ie.alternatives,Ie.congestion;var ze=Ie.styles,De=Ie.interactive;Ie.compile,this.actions.eventEmit("profile",{profile:We});var nt={type:"geojson",data:{type:"FeatureCollection",features:[]}};this._map.addSource("directions",nt),this._map.addSource("directions:markers",nt),ze&&ze.length&&ze.forEach(function(It){return se._map.addLayer(It)}),D.default.forEach(function(It){se._map.getLayer(It.id)||se._map.addLayer(It)}),De&&(this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick),this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown))}},{key:"_areMarkersChangedOnly",value:function(se){var Ie=this,We=[];return this._stateSnapshot?(Se.SUBSCRIPTION_FIELDS.forEach(function(ze){Ie._stateSnapshot[ze]!==se[ze]&&We.push(ze)}),We.length<=Se.MARKER_FIELDS.length&&We.every(function(ze){return Se.MARKER_FIELDS.includes(ze)})):!1}},{key:"subscribedActions",value:function(){var se=this;this.storeUnsubscribe=this._store.subscribe(function(){var Ie=se._store.getState(),We=Ie.origin,ze=Ie.destination,De=Ie.hoverMarker,nt=Ie.directions,It=Ie.routeIndex,Ot=se._areMarkersChangedOnly(Ie);se._stateSnapshot=Ie;var bt={type:"FeatureCollection",features:[We,ze,De].filter(function(Gt){return Gt.geometry})};if(se._map.style&&se._map.getSource("directions:markers")&&se._map.getSource("directions:markers").setData(bt),!Ot){var rt={type:"FeatureCollection",features:[]};nt.length&&nt.forEach(function(Gt,Vt){var Jt=[],wr=(0,T.decode)(Gt.geometry,5).map(function(et){return et.reverse()}),or=s.default.getAllSteps(Gt);wr.forEach(function(et,At){var Qt=Jt[Jt.length-1],gr=Gt.legs[0].annotation&&Gt.legs[0].annotation.congestion&&Gt.legs[0].annotation.congestion[At-1];if(Qt&&(!gr||Qt.properties.congestion===gr))Qt.geometry.coordinates.push(et);else{var Nt={geometry:{type:"LineString",coordinates:[]},properties:{"route-index":Vt,route:Vt===It?"selected":"alternate"}};Qt&&Nt.geometry.coordinates.push(Qt.geometry.coordinates[Qt.geometry.coordinates.length-1]),Nt.geometry.coordinates.push(et),gr&&(Nt.properties.congestion=Gt.legs[0].annotation.congestion[At-1]),Jt.push(Nt)}}),rt.features=rt.features.concat(Jt),Vt===It&&or.forEach(function(et){et.maneuver.type==="waypoint"&&rt.features.push({type:"Feature",geometry:{type:"Point",coordinates:et.maneuver.location},properties:{id:"waypoint"}})})}),se._map.style&&se._map.getSource("directions")&&se._map.getSource("directions").setData(rt)}})}},{key:"_initStore",value:function(){var se=(0,g.applyMiddleware)(x.default)(g.createStore);return se(I.default)}},{key:"_clickHandler",value:function(){var se=null,Ie=250;return function(We){if(se)clearTimeout(se),se=null,this._map.zoomIn();else{var ze=this._onSingleClick.bind(this);se=setTimeout(function(){ze(We),se=null},Ie)}}}},{key:"_onSingleClick",value:function(se){var Ie=this,We=this._store.getState(),ze=We.origin,De=[se.lngLat.lng,se.lngLat.lat];if(!ze.geometry)this.actions.setOriginFromCoordinates(De);else{var nt=this._map.queryRenderedFeatures(se.point,{layers:["directions-origin-point","directions-destination-point","directions-waypoint-point","directions-route-line-alt"]});if(nt.length){if(nt.forEach(function(Ot){Ot.layer.id==="directions-waypoint-point"&&Ie.actions.removeWaypoint(Ot)}),nt[0].properties.route==="alternate"){var It=nt[0].properties["route-index"];this.actions.setRouteIndex(It)}}else this.actions.setDestinationFromCoordinates(De),this._map.flyTo({center:De})}}},{key:"_move",value:function(se){var Ie=this,We=this._store.getState(),ze=We.hoverMarker,De=this._map.queryRenderedFeatures(se.point,{layers:["directions-route-line-alt","directions-route-line","directions-origin-point","directions-destination-point","directions-hover-point"]});this._map.getCanvas().style.cursor=De.length?"pointer":"",De.length?(this.isCursorOverPoint=De[0],this._map.dragPan.disable(),De.forEach(function(nt){nt.layer.id==="directions-route-line"?Ie.actions.hoverMarker([se.lngLat.lng,se.lngLat.lat]):ze.geometry&&Ie.actions.hoverMarker(null)})):this.isCursorOverPoint&&(this.isCursorOverPoint=!1,this._map.dragPan.enable())}},{key:"_onDragDown",value:function(){this.isCursorOverPoint&&(this.isDragging=this.isCursorOverPoint,this._map.getCanvas().style.cursor="grab",this._map.on("mousemove",this.onDragMove),this._map.on("mouseup",this.onDragUp),this._map.on("touchmove",this.onDragMove),this._map.on("touchend",this.onDragUp))}},{key:"_onDragMove",value:function(se){if(this.isDragging){var Ie=[se.lngLat.lng,se.lngLat.lat];switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.createOrigin(Ie);break;case"directions-destination-point":this.actions.createDestination(Ie);break;case"directions-hover-point":this.actions.hoverMarker(Ie);break}}}},{key:"_onDragUp",value:function(){if(this.isDragging){var se=this._store.getState(),Ie=se.hoverMarker,We=se.origin,ze=se.destination;switch(this.isDragging.layer.id){case"directions-origin-point":this.actions.setOriginFromCoordinates(We.geometry.coordinates);break;case"directions-destination-point":this.actions.setDestinationFromCoordinates(ze.geometry.coordinates);break;case"directions-hover-point":Ie.geometry&&!s.default.coordinateMatch(this.isDragging,Ie)&&this.actions.addWaypoint(0,Ie);break}this.isDragging=!1,this._map.getCanvas().style.cursor="",this._map.off("touchmove",this.onDragMove),this._map.off("touchend",this.onDragUp),this._map.off("mousemove",this.onDragMove),this._map.off("mouseup",this.onDragUp)}}},{key:"interactive",value:function(se){return se?(this._map.on("touchstart",this.move),this._map.on("touchstart",this.onDragDown),this._map.on("mousedown",this.onDragDown),this._map.on("mousemove",this.move),this._map.on("click",this.onClick)):(this._map.off("touchstart",this.move),this._map.off("touchstart",this.onDragDown),this._map.off("mousedown",this.onDragDown),this._map.off("mousemove",this.move),this._map.off("click",this.onClick)),this}},{key:"getOrigin",value:function(){return this._store.getState().origin}},{key:"setOrigin",value:function(se){return typeof se=="string"?this.actions.queryOrigin(se):this.actions.setOriginFromCoordinates(se),this}},{key:"getDestination",value:function(){return this._store.getState().destination}},{key:"setDestination",value:function(se){return typeof se=="string"?this.actions.queryDestination(se):this.actions.setDestinationFromCoordinates(se),this}},{key:"reverse",value:function(){return this.actions.reverse(),this}},{key:"addWaypoint",value:function(se,Ie){return Ie.type||(Ie=s.default.createPoint(Ie,{id:"waypoint"})),this.actions.addWaypoint(se,Ie),this}},{key:"setWaypoint",value:function(se,Ie){return Ie.type||(Ie=s.default.createPoint(Ie,{id:"waypoint"})),this.actions.setWaypoint(se,Ie),this}},{key:"removeWaypoint",value:function(se){var Ie=this._store.getState(),We=Ie.waypoints;return this.actions.removeWaypoint(We[se]),this}},{key:"getWaypoints",value:function(){return this._store.getState().waypoints}},{key:"removeRoutes",value:function(){return this.actions.clearOrigin(),this.actions.clearDestination(),this}},{key:"on",value:function(se,Ie){return this.actions.eventSubscribe(se,Ie),this}}]),Se}();d.default=Me,Me.MARKER_FIELDS=["origin","destination","hoverMarker"],Me.SUBSCRIPTION_FIELDS=["origin","destination","hovedMarker","directions","routeIndex"]},{"./actions":25,"./controls/inputs":28,"./controls/instructions":29,"./directions_style":31,"./reducers":33,"./utils":34,"@mapbox/polyline":6,redux:18,"redux-thunk":17}],31:[function(o,u,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var g=[{id:"directions-route-line-alt",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#bbb","line-width":4},filter:["all",["in","$type","LineString"],["in","route","alternate"]]},{id:"directions-route-line-casing",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#2d5f99","line-width":12},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-route-line",type:"line",source:"directions",layout:{"line-cap":"butt","line-join":"round"},paint:{"line-color":{property:"congestion",type:"categorical",default:"#4882c5",stops:[["unknown","#4882c5"],["low","#4882c5"],["moderate","#f09a46"],["heavy","#e34341"],["severe","#8b2342"]]},"line-width":7},filter:["all",["in","$type","LineString"],["in","route","selected"]]},{id:"directions-hover-point-casing",type:"circle",source:"directions:markers",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-hover-point",type:"circle",source:"directions:markers",paint:{"circle-radius":6,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","id","hover"]]},{id:"directions-waypoint-point-casing",type:"circle",source:"directions:markers",paint:{"circle-radius":8,"circle-color":"#fff"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-waypoint-point",type:"circle",source:"directions:markers",paint:{"circle-radius":6,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","id","waypoint"]]},{id:"directions-origin-point",type:"circle",source:"directions:markers",paint:{"circle-radius":18,"circle-color":"#3bb2d0"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-origin-label",type:"symbol",source:"directions:markers",layout:{"text-field":"A","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","A"]]},{id:"directions-destination-point",type:"circle",source:"directions:markers",paint:{"circle-radius":18,"circle-color":"#8a8bc9"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]},{id:"directions-destination-label",type:"symbol",source:"directions:markers",layout:{"text-field":"B","text-font":["Open Sans Bold","Arial Unicode MS Bold"],"text-size":12},paint:{"text-color":"#fff"},filter:["all",["in","$type","Point"],["in","marker-symbol","B"]]}],x=g;d.default=x},{}],32:[function(o,u,d){var g=x(o("./directions"));function x(T){return T&&T.__esModule?T:{default:T}}u.exports=g.default},{"./directions":30}],33:[function(o,u,d){function g(G){"@babel/helpers - typeof";return g=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(X){return typeof X}:function(X){return X&&typeof Symbol=="function"&&X.constructor===Symbol&&X!==Symbol.prototype?"symbol":typeof X},g(G)}Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;var x=O(o("../constants/action_types.js")),T=s(o("merge-options"));function s(G){return G&&G.__esModule?G:{default:G}}function I(G){if(typeof WeakMap!="function")return null;var X=new WeakMap,te=new WeakMap;return(I=function(U){return U?te:X})(G)}function O(G,X){if(!X&&G&&G.__esModule)return G;if(G===null||g(G)!=="object"&&typeof G!="function")return{default:G};var te=I(X);if(te&&te.has(G))return te.get(G);var H={},U=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var q in G)if(q!=="default"&&Object.prototype.hasOwnProperty.call(G,q)){var J=U?Object.getOwnPropertyDescriptor(G,q):null;J&&(J.get||J.set)?Object.defineProperty(H,q,J):H[q]=G[q]}return H.default=G,te&&te.set(G,H),H}var D=function(){return{api:"https://api.mapbox.com/directions/v5/",profile:"mapbox/driving-traffic",alternatives:!1,congestion:!1,unit:"imperial",flyTo:!0,placeholderOrigin:"Choose a starting place",placeholderDestination:"Choose destination",zoom:16,language:"en",compile:null,proximity:!1,styles:[],controls:{profileSwitcher:!0,inputs:!0,instructions:!0},instructions:{showWaypointInstructions:!0},geocoder:{},interactive:!0,events:{},origin:{},destination:{},hoverMarker:{},waypoints:[],originQuery:null,destinationQuery:null,originQueryCoordinates:null,destinationQueryCoordinates:null,directions:[],fetchDirectionsRequest:null,routeIndex:0,routePadding:80}};function N(){var G=arguments.length>0&&arguments[0]!==void 0?arguments[0]:D(),X=arguments.length>1?arguments[1]:void 0;switch(X.type){case x.SET_OPTIONS:return(0,T.default)({},G,X.options);case x.DIRECTIONS_PROFILE:return Object.assign({},G,{profile:X.profile});case x.ORIGIN:return Object.assign({},G,{origin:X.origin,hoverMarker:{}});case x.DESTINATION:return Object.assign({},G,{destination:X.destination,hoverMarker:{}});case x.HOVER_MARKER:return Object.assign({},G,{hoverMarker:X.hoverMarker});case x.WAYPOINTS:return Object.assign({},G,{waypoints:X.waypoints});case x.ORIGIN_QUERY:return Object.assign({},G,{originQuery:X.query});case x.DESTINATION_QUERY:return Object.assign({},G,{destinationQuery:X.query});case x.ORIGIN_FROM_COORDINATES:return Object.assign({},G,{originQueryCoordinates:X.coordinates});case x.DESTINATION_FROM_COORDINATES:return Object.assign({},G,{destinationQueryCoordinates:X.coordinates});case x.ORIGIN_CLEAR:return Object.assign({},G,{origin:{},originQuery:"",waypoints:[],directions:[]});case x.DESTINATION_CLEAR:return Object.assign({},G,{destination:{},destinationQuery:"",waypoints:[],directions:[]});case x.DIRECTIONS_REQUEST_START:return Object.assign({},G,{fetchDirectionsRequest:X.request});case x.DIRECTIONS:return Object.assign({},G,{directions:X.directions,fetchDirectionsRequest:null});case x.ROUTE_INDEX:return Object.assign({},G,{routeIndex:X.routeIndex});case x.ERROR:return Object.assign({},G,{error:X.error});default:return G}}var j=N;d.default=j},{"../constants/action_types.js":26,"merge-options":14}],34:[function(o,u,d){Object.defineProperty(d,"__esModule",{value:!0}),d.default=void 0;function g(j){return j[0]>=-180&&j[0]<=180&&j[1]>=-90&&j[1]<=90}function x(j,G){return j=j.geometry.coordinates,G=G.geometry.coordinates,j.join()===G.join()||j[0].toFixed(3)===G[0].toFixed(3)&&j[1].toFixed(3)===G[1].toFixed(3)}function T(j){var G=360,X=((j- -180)%G+G)%G+-180;return X===-180?180:X}function s(j,G){var X=0;return Math.floor(G)!==G&&(X=G.toString().split(".")[1].length),j.toFixed(Math.min(X,5))}function I(j,G){return{type:"Feature",geometry:{type:"Point",coordinates:j},properties:G||{}}}function O(j,G){return j.legs.reduce(function(X,te,H){H>0&&(X[X.length-1].maneuver.type="waypoint",te.steps[0].maneuver.type="");var U=X.concat(te.steps);return G?U.filter(G):U},[])}var D={duration:function(G){var X=Math.floor(G/60),te=Math.floor(X/60);return G%=60,X%=60,te===0&&X===0?G+"s":te===0?X+"min":te+"h "+X+"min"},imperial:function(G){var X=G/1609.344;return X>=100?X.toFixed(0)+"mi":X>=10?X.toFixed(1)+"mi":X>=.1?X.toFixed(2)+"mi":(X*5280).toFixed(0)+"ft"},metric:function(G){return G>=1e5?(G/1e3).toFixed(0)+"km":G>=1e4?(G/1e3).toFixed(1)+"km":G>=100?(G/1e3).toFixed(2)+"km":G.toFixed(0)+"m"}},N={format:D,coordinateMatch:x,createPoint:I,validCoords:g,wrap:T,roundWithOriginalPrecision:s,getAllSteps:O};d.default=N},{}]},{},[32])(32)})})(Bj);var eae=Bj.exports;const tae=vp(eae);var jj={exports:{}};(function(t,n){var o={};(function(u,d){t.exports=d()})(mc,function(){var u,d,g;function x(s,I){if(!u)u=I;else if(!d)d=I;else{var O="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+u+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",D={};u(D),g=I(D),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(g.workerUrl=window.URL.createObjectURL(new Blob([O],{type:"text/javascript"})))}}x(["exports"],function(s){var I="3.2.0";let O;const D={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(O==null){const r=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{O=o.API_URL_REGEX!=null?new RegExp(o.API_URL_REGEX):r}catch{O=r}}return O},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!D.API_URL)return null;try{const r=new URL(D.API_URL);return r.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":r.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},N={supported:!1,testSupport:function(r){!X&&G&&(te?U(r):j=r)}};let j,G,X=!1,te=!1;const H=typeof self<"u"?self:{};function U(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,G),r.isContextLost())return;N.supported=!0}catch{}r.deleteTexture(e),X=!0}H.document&&(G=H.document.createElement("img"),G.onload=function(){j&&U(j),j=null,te=!0},G.onerror=function(){X=!0,j=null},G.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const q="01";function J(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var pe=ue;function ue(r,e,i,a){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=i,this.p2y=a}ue.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var i=r,a=0;a<8;a++){var h=this.sampleCurveX(i)-r;if(Math.abs(h)<e)return i;var p=this.sampleCurveDerivativeX(i);if(Math.abs(p)<1e-6)break;i-=h/p}var m=0,y=1;for(i=r,a=0;a<20&&(h=this.sampleCurveX(i),!(Math.abs(h-r)<e));a++)r>h?m=i:y=i,i=.5*(y-m)+m;return i},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};var Me=J(pe),Se=ge;function ge(r,e){this.x=r,this.y=e}ge.prototype={clone:function(){return new ge(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),i=Math.sin(r),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround:function(r,e){var i=Math.cos(r),a=Math.sin(r),h=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ge.convert=function(r){return r instanceof ge?r:Array.isArray(r)?new ge(r[0],r[1]):r};var se=J(Se);const Ie=Math.PI/180,We=180/Math.PI;function ze(r){return r*Ie}function De(r){return r*We}const nt=[[0,0],[1,0],[1,1],[0,1]];function It(r){if(r<=0)return 0;if(r>=1)return 1;const e=r*r,i=e*r;return 4*(r<.5?i:3*(r-e)+i-.75)}function Ot(r,e,i,a){const h=new Me(r,e,i,a);return function(p){return h.solve(p)}}const bt=Ot(.25,.1,.25,1);function rt(r,e,i){return Math.min(i,Math.max(e,r))}function Gt(r,e,i){return(i=rt((i-r)/(e-r),0,1))*i*(3-2*i)}function Vt(r,e,i){const a=i-e,h=((r-e)%a+a)%a+e;return h===e?i:h}function Jt(r,e,i){if(!r.length)return i(null,[]);let a=r.length;const h=new Array(r.length);let p=null;r.forEach((m,y)=>{e(m,(b,E)=>{b&&(p=b),h[y]=E,--a==0&&i(p,h)})})}function wr(r){const e=[];for(const i in r)e.push(r[i]);return e}function or(r,...e){for(const i of e)for(const a in i)r[a]=i[a];return r}let et=1;function At(){return et++}function Qt(){return function r(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,r)}()}function gr(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function Nt(r){return!!r&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(r)}function Er(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Tr(r,e){return r.indexOf(e,r.length-e.length)!==-1}function $r(r,e,i){const a={};for(const h in r)a[h]=e.call(i||this,r[h],h,r);return a}function Xr(r,e,i){const a={};for(const h in r)e.call(i||this,r[h],h,r)&&(a[h]=r[h]);return a}function cn(r){return Array.isArray(r)?r.map(cn):typeof r=="object"&&r?$r(r,cn):r}const Mn={};function mr(r){Mn[r]||(typeof console<"u"&&console.warn(r),Mn[r]=!0)}function vt(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function _e(r){let e=0;for(let i,a,h=0,p=r.length,m=p-1;h<p;m=h++)i=r[h],a=r[m],e+=(a.x-i.x)*(i.y+a.y);return e}function xe([r,e,i]){const a=ze(e+90),h=ze(i);return{x:r*Math.cos(a)*Math.sin(h),y:r*Math.sin(a)*Math.sin(h),z:r*Math.cos(h),azimuthal:e,polar:i}}function Re(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function ft(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,h,p)=>{const m=h||p;return e[a]=!m||m.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let gt=null;function jt(r){try{const e=self[r];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function $t(r,e){return[r[4*e],r[4*e+1],r[4*e+2],r[4*e+3]]}function yt(r,e,i,a){for(;e<i;){const h=e+i>>1;r[h]<a?e=h+1:i=h}return e}function ir(r,e,i,a){for(;e<i;){const h=e+i>>1;r[h]<=a?e=h+1:i=h}return e}const lr="mapbox-tiles";let fr=500,Gr=50,pn,In;function sn(){try{return caches}catch{}}function mn(){const r=sn();r&&!pn&&(pn=r.open(lr))}function Rr(r){const e=r.indexOf("?");if(e<0)return r;const i=function(h){const p=h.indexOf("?");return p>0?h.slice(p+1).split("&"):[]}(r),a=i.filter(h=>{const p=h.split("=");return p[0]==="language"||p[0]==="worldview"});return a.length?`${r.slice(0,e)}?${a.join("&")}`:r.slice(0,e)}let jn=1/0;const Fn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Fn);class Ii extends Error{constructor(e,i,a){i===401&&tt(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const ci=Re()?()=>self.worker&&self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,$n=function(r,e){if(!(/^file:/.test(i=r.url)||/^file:/.test(ci())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,h){const p=new AbortController,m=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:ci(),referrerPolicy:a.referrerPolicy,signal:p.signal});let y=!1,b=!1;const E=(C=m.url).indexOf("sku=")>0&&tt(C);var C;a.type==="json"&&m.headers.set("Accept","application/json");const A=(R,z,B)=>{if(b)return;if(R&&R.message!=="SecurityError"&&mr(R.toString()),z&&B)return P(z);const V=Date.now();fetch(m).then(Q=>{if(Q.ok){const ae=E?Q.clone():null;return P(Q,ae,V)}return h(new Ii(Q.statusText,Q.status,a.url))}).catch(Q=>{Q.name!=="AbortError"&&h(new Error(`${Q.message} ${a.url}`))})},P=(R,z,B)=>{(a.type==="arrayBuffer"?R.arrayBuffer():a.type==="json"?R.json():R.text()).then(V=>{b||(z&&B&&function(Q,ae,le){if(mn(),!pn)return;const he={status:ae.status,statusText:ae.statusText,headers:new Headers};ae.headers.forEach((Pe,Ne)=>he.headers.set(Ne,Pe));const me=ft(ae.headers.get("Cache-Control")||"");if(me["no-store"])return;me["max-age"]&&he.headers.set("Expires",new Date(le+1e3*me["max-age"]).toUTCString());const ve=he.headers.get("Expires");ve&&(new Date(ve).getTime()-le<42e4||function(Pe,Ne){if(In===void 0)try{new Response(new ReadableStream),In=!0}catch{In=!1}In?Ne(Pe.body):Pe.blob().then(Ne)}(ae,Pe=>{const Ne=new Response(Pe,he);mn(),pn&&pn.then(je=>je.put(Rr(Q.url),Ne)).catch(je=>mr(je.message))}))}(m,z,B),y=!0,h(null,V,R.headers.get("Cache-Control"),R.headers.get("Expires")))}).catch(V=>{b||h(new Error(V.message))})};return E?function(R,z){if(mn(),!pn)return z(null);const B=Rr(R.url);pn.then(V=>{V.match(B).then(Q=>{const ae=function(le){if(!le)return!1;const he=new Date(le.headers.get("Expires")||0),me=ft(le.headers.get("Cache-Control")||"");return he>Date.now()&&!me["no-cache"]}(Q);V.delete(B),ae&&V.put(B,Q.clone()),z(null,Q,ae)}).catch(z)}).catch(z)}(m,A):A(null,null),{cancel:()=>{b=!0,y||p.abort()}}}(r,e);if(Re()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(a,h){const p=new XMLHttpRequest;p.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(p.responseType="arraybuffer");for(const m in a.headers)p.setRequestHeader(m,a.headers[m]);return a.type==="json"&&(p.responseType="text",p.setRequestHeader("Accept","application/json")),p.withCredentials=a.credentials==="include",p.onerror=()=>{h(new Error(p.statusText))},p.onload=()=>{if((p.status>=200&&p.status<300||p.status===0)&&p.response!==null){let m=p.response;if(a.type==="json")try{m=JSON.parse(p.response)}catch(y){return h(y)}h(null,m,p.getResponseHeader("Cache-Control"),p.getResponseHeader("Expires"))}else h(new Ii(p.statusText,p.status,a.url))},p.send(a.body),{cancel:()=>p.abort()}}(r,e)},ii=function(r,e){return $n(or(r,{type:"arrayBuffer"}),e)};function no(r){const e=document.createElement("a");return e.href=r,e.protocol===location.protocol&&e.host===location.host}const Go="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let qe,we;qe=[],we=0;const ke=function(r,e){if(N.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),we>=D.MAX_PARALLEL_IMAGE_REQUESTS){const p={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return qe.push(p),p}we++;let i=!1;const a=()=>{if(!i)for(i=!0,we--;qe.length&&we<D.MAX_PARALLEL_IMAGE_REQUESTS;){const p=qe.shift(),{requestParameters:m,callback:y,cancelled:b}=p;b||(p.cancel=ke(m,y).cancel)}},h=ii(r,(p,m,y,b)=>{a(),p?e(p):m&&(self.createImageBitmap?function(E,C){const A=new Blob([new Uint8Array(E)],{type:"image/png"});createImageBitmap(A).then(P=>{C(null,P)}).catch(P=>{C(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(E,C)=>e(E,C,y,b)):function(E,C){const A=new Image;A.onload=()=>{C(null,A),URL.revokeObjectURL(A.src),A.onload=null,requestAnimationFrame(()=>{A.src=Go})},A.onerror=()=>C(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const P=new Blob([new Uint8Array(E)],{type:"image/png"});A.src=E.byteLength?URL.createObjectURL(P):Go}(m,(E,C)=>e(E,C,y,b)))});return{cancel:()=>{h.cancel(),a()}}},Ue="NO_ACCESS_TOKEN";function Ze(r){return r.indexOf("mapbox:")===0}function tt(r){return D.API_URL_REGEX.test(r)}function it(r){return D.API_CDN_URL_REGEX.test(r)}function at(r){return D.API_STYLE_REGEX.test(r)&&!Ke(r)}function Ke(r){return D.API_SPRITE_REGEX.test(r)}const xt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function _t(r){const e=r.match(xt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Ft(r){const e=r.params.length?`?${r.params.join("&")}`:"";return`${r.protocol}://${r.authority}${r.path}${e}`}const pr="mapbox.eventData";function Ut(r){if(!r)return null;const e=r.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(atob(e[1]).split("").map(i=>"%"+("00"+i.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Or{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const i=Ut(D.ACCESS_TOKEN);let a="";return a=i&&i.u?btoa(encodeURIComponent(i.u).replace(/%([0-9A-F]{2})/g,(h,p)=>String.fromCharCode(+("0x"+p)))):D.ACCESS_TOKEN||"",e?`${pr}.${e}:${a}`:`${pr}:${a}`}fetchEventData(){const e=jt("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid");if(e)try{const h=localStorage.getItem(i);h&&(this.eventData=JSON.parse(h));const p=localStorage.getItem(a);p&&(this.anonId=p)}catch{mr("Unable to read from LocalStorage")}}saveEventData(){const e=jt("localStorage"),i=this.getStorageKey(),a=this.getStorageKey("uuid"),h=this.anonId;if(e&&h)try{localStorage.setItem(a,h),Object.keys(this.eventData).length>=1&&localStorage.setItem(i,JSON.stringify(this.eventData))}catch{mr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,i,a,h){if(!D.EVENTS_URL)return;const p=_t(D.EVENTS_URL);p.params.push(`access_token=${h||D.ACCESS_TOKEN||""}`);const m={event:this.type,created:new Date(e).toISOString()},y=i?or(m,i):m,b={url:Ft(p),headers:{"Content-Type":"text/plain"},body:JSON.stringify([y])};this.pendingRequest=function(E,C){return $n(or(E,{method:"POST"}),C)}(b,E=>{this.pendingRequest=null,a(E),this.saveEventData(),this.processRequests(h)})}queueRequest(e,i){this.queue.push(e),this.processRequests(i)}}const Lr=new class extends Or{constructor(r){super("appUserTurnstile"),this._customAccessToken=r}postTurnstileEvent(r,e){D.EVENTS_URL&&D.ACCESS_TOKEN&&Array.isArray(r)&&r.some(i=>Ze(i)||tt(i))&&this.queueRequest(Date.now(),e)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Ut(D.ACCESS_TOKEN),i=e?e.u:D.ACCESS_TOKEN;let a=i!==this.eventData.tokenU;Nt(this.anonId)||(this.anonId=Qt(),a=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const p=new Date(this.eventData.lastSuccess),m=new Date(h),y=(h-this.eventData.lastSuccess)/864e5;a=a||y>=1||y<-1||p.getDate()!==m.getDate()}else a=!0;a?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:q,"enabled.telemetry":!1,userId:this.anonId},p=>{p||(this.eventData.lastSuccess=h,this.eventData.tokenU=i)},r):this.processRequests()}},Kr=Lr.postTurnstileEvent.bind(Lr),an=new class extends Or{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(r,e,i,a){this.skuToken=e,this.errorCb=a,D.EVENTS_URL&&(i||D.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},i):this.errorCb(new Error(Ue)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Nt(this.anonId)||(this.anonId=Qt()),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:I,skuId:q,skuToken:this.skuToken,userId:this.anonId},a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},r))}},Zn=an.postMapLoadEvent.bind(an),oi=new class extends Or{constructor(){super("gljs.performance")}postPerformanceEvent(r,e){D.EVENTS_URL&&(r||D.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},r)}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:e,performanceData:i}=this.queue.shift(),a=function(h){const p=performance.getEntriesByType("resource"),m=performance.getEntriesByType("mark"),y=function(R){const z={};if(R){for(const B in R)if(B!=="other")for(const V of R[B]){const Q=`${B}ResolveRangeMin`,ae=`${B}ResolveRangeMax`,le=`${B}RequestCount`,he=`${B}RequestCachedCount`;z[Q]=Math.min(z[Q]||1/0,V.startTime),z[ae]=Math.max(z[ae]||-1/0,V.responseEnd);const me=ve=>{z[ve]===void 0&&(z[ve]=0),++z[ve]};V.transferSize!==void 0&&V.transferSize===0&&me(he),me(le)}}return z}(function(R,z){const B={};if(R)for(const V of R){const Q=z(V);B[Q]===void 0&&(B[Q]=[]),B[Q].push(V)}return B}(p,ko)),b=window.devicePixelRatio,E=navigator.connection||navigator.mozConnection||navigator.webkitConnection,C=E?E.effectiveType:void 0,A={counters:[],metadata:[],attributes:[]},P=(R,z,B)=>{B!=null&&R.push({name:z,value:B.toString()})};for(const R in y)P(A.counters,R,y[R]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(P(A.counters,"interactionRangeMin",h.interactionRange[0]),P(A.counters,"interactionRangeMax",h.interactionRange[1])),m)for(const R of Object.keys(Di)){const z=Di[R],B=m.find(V=>V.name===z);B&&P(A.counters,z,B.startTime)}return P(A.counters,"visibilityHidden",h.visibilityHidden),P(A.attributes,"style",function(R){if(R)for(const z of R){const B=z.name.split("?")[0];if(at(B)){const V=B.split("/").slice(-2);if(V.length===2)return`mapbox://styles/${V[0]}/${V[1]}`}}}(p)),P(A.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),P(A.attributes,"fogEnabled",h.fogEnabled?"true":"false"),P(A.attributes,"projection",h.projection),P(A.attributes,"zoom",h.zoom),P(A.metadata,"devicePixelRatio",b),P(A.metadata,"connectionEffectiveType",C),P(A.metadata,"navigatorUserAgent",navigator.userAgent),P(A.metadata,"screenWidth",window.screen.width),P(A.metadata,"screenHeight",window.screen.height),P(A.metadata,"windowWidth",window.innerWidth),P(A.metadata,"windowHeight",window.innerHeight),P(A.metadata,"mapWidth",h.width/b),P(A.metadata,"mapHeight",h.height/b),P(A.metadata,"webglRenderer",h.renderer),P(A.metadata,"webglVendor",h.vendor),P(A.metadata,"sdkVersion",I),P(A.metadata,"sdkIdentifier","mapbox-gl-js"),A}(i);for(const h of a.metadata);for(const h of a.counters);for(const h of a.attributes);this.postEvent(e,a,()=>{},r)}},fi=oi.postPerformanceEvent.bind(oi),Oi=new class extends Or{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(r,e,i,a){if(!D.API_URL||!D.SESSION_PATH)return;const h=_t(D.API_URL+D.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${a||D.ACCESS_TOKEN||""}`);const p={url:Ft(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(m,y){return $n(or(m,{method:"GET"}),y)}(p,m=>{this.pendingRequest=null,i(m),this.saveEventData(),this.processRequests(a)})}getSessionAPI(r,e,i,a){this.skuToken=e,this.errorCb=a,D.SESSION_PATH&&D.API_URL&&(i||D.ACCESS_TOKEN?this.queueRequest({id:r,timestamp:Date.now()},i):this.errorCb(new Error(Ue)))}processRequests(r){if(this.pendingRequest||this.queue.length===0)return;const{id:e,timestamp:i}=this.queue.shift();e&&this.success[e]||this.getSession(i,this.skuToken,a=>{a?this.errorCb(a):e&&(this.success[e]=!0)},r)}},si=Oi.getSessionAPI.bind(Oi),Bn=new Set,Di={create:"create",load:"load",fullLoad:"fullLoad"};function ko(r){const e=r.name.split("?")[0];return it(e)&&e.includes("mapbox-gl.js")?"javascript":it(e)&&e.includes("mapbox-gl.css")?"css":function(i){return D.API_FONTS_REGEX.test(i)}(e)?"fontRange":Ke(e)?"sprite":at(e)?"style":function(i){return D.API_TILEJSON_REGEX.test(i)}(e)?"tilejson":"other"}function yn(r){const e=r?r.url.toString():void 0;return e?performance.getEntriesByName(e):[]}let wn,Xi,io,bs,ws;function jc(){return wn==null&&(wn=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),wn}const ji={now:()=>bs!==void 0?bs:performance.now(),setNow(r){bs=r},restoreNow(){bs=void 0},frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const{width:i,height:a}=r;ws||(ws=document.createElement("canvas"));const h=ws.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>ws.width||a>ws.height)&&(ws.width=i,ws.height=a),h.clearRect(-e,-e,i+2*e,a+2*e),h.drawImage(r,0,0,i,a),h.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:r=>(Xi||(Xi=document.createElement("a")),Xi.href=r,Xi.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(io==null&&(io=window.matchMedia("(prefers-reduced-motion: reduce)")),io.matches)},hasCanvasFingerprintNoise(){if(!jc())return!1;const r=new OffscreenCanvas(85,1),e=r.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<r.width;++h)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(h,0,1,1);const a=e.getImageData(0,0,r.width,r.height);i=0;for(let h=0;h<a.data.length;++h)if(h%4!=3&&i++!==a.data[h])return!0;return!1}};function cl(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function qo(r,e,i){if(i&&i[r]){const a=i[r].indexOf(e);a!==-1&&i[r].splice(a,1)}}class Po{constructor(e,i={}){or(this,i),this.type=e}}class $s extends Po{constructor(e,i={}){super("error",or({error:e},i))}}class Ri{on(e,i){return this._listeners=this._listeners||{},cl(e,i,this._listeners),this}off(e,i){return qo(e,i,this._listeners),qo(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},cl(e,i,this._oneTimeListeners),this):new Promise(a=>this.once(e,a))}fire(e,i){typeof e=="string"&&(e=new Po(e,i||{}));const a=e.type;if(this.listens(a)){e.target=this;const h=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const y of h)y.call(this,e);const p=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const y of p)qo(a,y,this._oneTimeListeners),y.call(this,e);const m=this._eventedParent;m&&(or(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),m.fire(e))}else e instanceof $s&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var Ge=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class qt{constructor(e,i,a,h){this.message=(e?`${e}: `:"")+a,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}class Wo extends qt{}function yo(r,...e){for(const i of e)for(const a in i)r[a]=i[a];return r}function Un(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function as(r){if(Array.isArray(r))return r.map(as);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=as(r[i]);return e}return Un(r)}class za extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}var vo=za;class Es{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,h]of i)this.bindings[a]=h}concat(e){return new Es(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Na=Es;const co={kind:"null"},mt={kind:"number"},Nr={kind:"string"},qr={kind:"boolean"},xo={kind:"color"},Ss={kind:"object"},zr={kind:"value"},Us={kind:"collator"},ls={kind:"formatted"},Ts={kind:"resolvedImage"};function pi(r,e){return{kind:"array",itemType:r,N:e}}function ln(r){if(r.kind==="array"){const e=ln(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const th=[co,mt,Nr,qr,xo,ls,Ss,pi(zr),Ts];function Fe(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Fe(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of th)if(!Fe(i,e))return null}}return`Expected ${ln(r)} but found ${ln(e)} instead.`}function Et(r,e){return e.some(i=>i.kind===r.kind)}function zt(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}var Ur,tn={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Xn(r){return(r=Math.round(r))<0?0:r>255?255:r}function mi(r){return Xn(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function Yn(r){return(e=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:e>1?1:e;var e}function bo(r,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?r+(e-r)*i*6:2*i<1?e:3*i<2?r+(e-r)*(2/3-i)*6:r}try{Ur={}.parseCSSColor=function(r){var e,i=r.replace(/ /g,"").toLowerCase();if(i in tn)return tn[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=i.indexOf("("),h=i.indexOf(")");if(a!==-1&&h+1===i.length){var p=i.substr(0,a),m=i.substr(a+1,h-(a+1)).split(","),y=1;switch(p){case"rgba":if(m.length!==4)return null;y=Yn(m.pop());case"rgb":return m.length!==3?null:[mi(m[0]),mi(m[1]),mi(m[2]),y];case"hsla":if(m.length!==4)return null;y=Yn(m.pop());case"hsl":if(m.length!==3)return null;var b=(parseFloat(m[0])%360+360)%360/360,E=Yn(m[1]),C=Yn(m[2]),A=C<=.5?C*(E+1):C+E-C*E,P=2*C-A;return[Xn(255*bo(P,A,b+1/3)),Xn(255*bo(P,A,b)),Xn(255*bo(P,A,b-1/3)),y];default:return null}}return null}}catch{}class Cn{constructor(e,i,a,h=1){this.r=e,this.g=i,this.b=a,this.a=h}static parse(e){if(!e)return;if(e instanceof Cn)return e;if(typeof e!="string")return;const i=Ur(e);return i?new Cn(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,a,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(a)},${h})`}toArray(){const{r:e,g:i,b:a,a:h}=this;return h===0?[0,0,0,0]:[255*e/h,255*i/h,255*a/h,h]}toArray01(){const{r:e,g:i,b:a,a:h}=this;return h===0?[0,0,0,0]:[e/h,i/h,a/h,h]}toArray01Scaled(e){const{r:i,g:a,b:h,a:p}=this;return p===0?[0,0,0]:[i/p*e,a/p*e,h/p*e]}toArray01PremultipliedAlpha(){const{r:e,g:i,b:a,a:h}=this;return[e,i,a,h]}toArray01Linear(){const{r:e,g:i,b:a,a:h}=this;return h===0?[0,0,0,0]:[Math.pow(e/h,2.2),Math.pow(i/h,2.2),Math.pow(a/h,2.2),h]}}Cn.black=new Cn(0,0,0,1),Cn.white=new Cn(1,1,1,1),Cn.transparent=new Cn(0,0,0,0),Cn.red=new Cn(1,0,0,1),Cn.blue=new Cn(0,0,1,1);var En=Cn;class Ai{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Vs{constructor(e,i,a,h,p){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=h,this.textColor=p}}class $i{constructor(e){this.sections=e}static fromString(e){return new $i([new Vs(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof $i?e:$i.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){e.push(["image",i.image.namePrimary]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toArray())),e.push(a)}return e}}class Yi{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,i){return e?new Yi({namePrimary:e,nameSecondary:i,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function ha(r,e,i,a){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,e,i,a]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Oo(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof En||r instanceof Ai||r instanceof $i||r instanceof Yi)return!0;if(Array.isArray(r)){for(const e of r)if(!Oo(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Oo(r[e]))return!1;return!0}return!1}function ei(r){if(r===null)return co;if(typeof r=="string")return Nr;if(typeof r=="boolean")return qr;if(typeof r=="number")return mt;if(r instanceof En)return xo;if(r instanceof Ai)return Us;if(r instanceof $i)return ls;if(r instanceof Yi)return Ts;if(Array.isArray(r)){const e=r.length;let i;for(const a of r){const h=ei(a);if(i){if(i===h)continue;i=zr;break}i=h}return pi(i||zr,e)}return Ss}function Cs(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof En||r instanceof $i||r instanceof Yi?r.toString():JSON.stringify(r)}class Ul{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Oo(e[1]))return i.error("invalid value");const a=e[1];let h=ei(a);const p=i.expectedType;return h.kind!=="array"||h.N!==0||!p||p.kind!=="array"||typeof p.N=="number"&&p.N!==0||(h=p),new Ul(h,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof En?["rgba"].concat(this.value.toArray()):this.value instanceof $i?this.value.serialize():this.value}}var Gs=Ul,Te=class{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}};const Xe={string:Nr,number:mt,boolean:qr,object:Ss};class Dt{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,h=1;const p=e[0];if(p==="array"){let y,b;if(e.length>2){const E=e[1];if(typeof E!="string"||!(E in Xe)||E==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);y=Xe[E],h++}else y=zr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],h++}a=pi(y,b)}else a=Xe[p];const m=[];for(;h<e.length;h++){const y=i.parse(e[h],h,zr);if(!y)return null;m.push(y)}return new Dt(a,m)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!Fe(this.type,ei(a)))return a;if(i===this.args.length-1)throw new Te(`Expected value to be of type ${ln(this.type)}, but found ${ln(ei(a))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const h=e.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(a=>a.serialize()))}}var sr=Dt;class Dn{constructor(e){this.type=ls,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const h=[];let p=!1;for(let m=1;m<=e.length-1;++m){const y=e[m];if(p&&typeof y=="object"&&!Array.isArray(y)){p=!1;let b=null;if(y["font-scale"]&&(b=i.parse(y["font-scale"],1,mt),!b))return null;let E=null;if(y["text-font"]&&(E=i.parse(y["text-font"],1,pi(Nr)),!E))return null;let C=null;if(y["text-color"]&&(C=i.parse(y["text-color"],1,xo),!C))return null;const A=h[h.length-1];A.scale=b,A.font=E,A.textColor=C}else{const b=i.parse(e[m],1,zr);if(!b)return null;const E=b.type.kind;if(E!=="string"&&E!=="value"&&E!=="null"&&E!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");p=!0,h.push({content:b,scale:null,font:null,textColor:null})}}return new Dn(h)}evaluate(e){return new $i(this.sections.map(i=>{const a=i.content.evaluate(e);return ei(a)===Ts?new Vs("",a,null,null,null):new Vs(Cs(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class Wr{constructor(e,i){this.type=Ts,this.inputPrimary=e,this.inputSecondary=i}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");const a=i.parse(e[1],1,Nr);if(!a)return i.error("No image name provided.");if(e.length===2)return new Wr(a);const h=i.parse(e[2],1,Nr);return h?new Wr(a,h):i.error("Secondary image variant is not a string.")}evaluate(e){const i=Yi.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return i&&e.availableImages&&(i.available=e.availableImages.indexOf(i.namePrimary)>-1,i.nameSecondary&&i.available&&e.availableImages&&(i.available=e.availableImages.indexOf(i.nameSecondary)>-1)),i}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function vr(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}const Ui={"to-boolean":qr,"to-color":xo,"to-number":mt,"to-string":Nr};class ki{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0],h=[];let p=co;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);p=pi(i.expectedType.itemType,m)}else{if(!(m>0&&Oo(e[1][0])))return null;p=pi(ei(e[1][0]),m)}for(let y=0;y<m;y++){const b=e[1][y];let E;if(vr(b)==="array")E=i.parse(b,void 0,p.itemType);else{const C=vr(b);if(C!==p.itemType.kind)return i.error(`Expected ${p.itemType.kind} but found ${C}.`);E=i.registry.literal.parse(["literal",b===void 0?null:b],i)}if(!E)return null;h.push(E)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");p=Ui[a];for(let m=1;m<e.length;m++){const y=i.parse(e[m],m,zr);if(!y)return null;h.push(y)}}return new ki(p,h)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,a;for(const h of this.args){if(i=h.evaluate(e),a=null,i instanceof En)return i;if(typeof i=="string"){const p=e.parseColor(i);if(p)return p}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:ha(i[0],i[1],i[2],i[3]),!a))return new En(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Te(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Te(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?$i.fromString(Cs(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Yi.fromString(Cs(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):Cs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Dn([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Wr(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}var An=ki;const wo=["Unknown","Point","LineString","Polygon"];var Do=class{constructor(r,e){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=r,this.options=e}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?wo[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(r){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const r=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:i,y:a}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(i*e-r[0])+this.featureDistanceData.bearing[1]*(a*e-r[1])}return 0}parseColor(r){let e=this._parseColorCache[r];return e||(e=this._parseColorCache[r]=En.parse(r)),e}getConfig(r){return this.options?this.options.get(r):null}};class ui{constructor(e,i,a,h,p){this.name=e,this.type=i,this._evaluate=a,this.args=h,this._overloadIndex=p}evaluate(e){if(!this._evaluate){const i=ui.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const a=e[0],h=ui.definitions[a];if(!h)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const p=Array.isArray(h)?h[0]:h.type,m=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,y=[];let b=null,E=-1;for(const[C,A]of m){if(Array.isArray(C)&&C.length!==e.length-1)continue;y.push(C),E++,b=new qp(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const P=[];let R=!1;for(let z=1;z<e.length;z++){const B=e[z],V=Array.isArray(C)?C[z-1]:C.type,Q=b.parse(B,1+P.length,V);if(!Q){R=!0;break}P.push(Q)}if(!R)if(Array.isArray(C)&&C.length!==P.length)b.error(`Expected ${C.length} arguments, but found ${P.length} instead.`);else{for(let z=0;z<P.length;z++){const B=Array.isArray(C)?C[z]:C.type,V=P[z];b.concat(z+1).checkSubtype(B,V.type)}if(b.errors.length===0)return new ui(a,p,A,P,E)}}if(y.length===1)i.errors.push(...b.errors);else{const C=(y.length?y:m.map(([P])=>P)).map(Ro).join(" | "),A=[];for(let P=1;P<e.length;P++){const R=i.parse(e[P],1+A.length);if(!R)return null;A.push(ln(R.type))}i.error(`Expected arguments of type ${C}, but found (${A.join(", ")}) instead.`)}return null}static register(e,i){ui.definitions=i;for(const a in i)e[a]=ui}}function Ro(r){return Array.isArray(r)?`(${r.map(ln).join(", ")})`:`(${ln(r.type)}...)`}var gi=ui;class Ho{constructor(e,i,a){this.type=Us,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const h=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,qr);if(!h)return null;const p=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,qr);if(!p)return null;let m=null;return a.locale&&(m=i.parse(a.locale,1,Nr),!m)?null:new Ho(h,p,m)}evaluate(e){return new Ai(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var cs={exports:{}};cs.exports=function(){function r(a,h,p,m,y){for(;m>p;){if(m-p>600){var b=m-p+1,E=h-p+1,C=Math.log(b),A=.5*Math.exp(2*C/3),P=.5*Math.sqrt(C*A*(b-A)/b)*(E-b/2<0?-1:1);r(a,h,Math.max(p,Math.floor(h-E*A/b+P)),Math.min(m,Math.floor(h+(b-E)*A/b+P)),y)}var R=a[h],z=p,B=m;for(e(a,p,h),y(a[m],R)>0&&e(a,p,m);z<B;){for(e(a,z,B),z++,B--;y(a[z],R)<0;)z++;for(;y(a[B],R)>0;)B--}y(a[p],R)===0?e(a,p,B):e(a,++B,m),B<=h&&(p=B+1),h<=B&&(m=B-1)}}function e(a,h,p){var m=a[h];a[h]=a[p],a[p]=m}function i(a,h){return a<h?-1:a>h?1:0}return function(a,h,p,m,y){r(a,h,p||0,m||a.length-1,y||i)}}();var da=J(cs.exports);function Vl(r){let e=0;for(let i,a,h=0,p=r.length,m=p-1;h<p;m=h++)i=r[h],a=r[m],e+=(a.x-i.x)*(i.y+a.y);return e}function us(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function hs(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function by(r,e,i){const a=r[0]-e[0],h=r[1]-e[1],p=r[0]-i[0],m=r[1]-i[1];return a*m-p*h==0&&a*p<=0&&h*m<=0}function Gl(r,e,i=!1){let a=!1;for(let y=0,b=e.length;y<b;y++){const E=e[y];for(let C=0,A=E.length,P=A-1;C<A;P=C++){const R=E[P],z=E[C];if(by(r,R,z))return i;(p=R)[1]>(h=r)[1]!=(m=z)[1]>h[1]&&h[0]<(m[0]-p[0])*(h[1]-p[1])/(m[1]-p[1])+p[0]&&(a=!a)}}var h,p,m;return a}function Op(r,e,i,a){const h=a[0]-i[0],p=a[1]-i[1],m=(r[0]-i[0])*p-h*(r[1]-i[1]),y=(e[0]-i[0])*p-h*(e[1]-i[1]);return m>0&&y<0||m<0&&y>0}function Fa(r,e,i,a){return(h=[a[0]-i[0],a[1]-i[1]])[0]*(p=[e[0]-r[0],e[1]-r[1]])[1]-h[1]*p[0]!=0&&!(!Op(r,e,i,a)||!Op(i,a,r,e));var h,p}const Vr=8192;function G1(r,e){const i=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(i*h*Vr),Math.round(a*h*Vr)]}function q1(r,e){for(let i=0;i<e.length;i++)if(Gl(r,e[i]))return!0;return!1}function W1(r,e,i){for(const a of i)for(let h=0,p=a.length,m=p-1;h<p;m=h++)if(Fa(r,e,a[m],a[h]))return!0;return!1}function Dp(r,e){for(let i=0;i<r.length;++i)if(!Gl(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(W1(r[i],r[i+1],e))return!1;return!0}function H1(r,e){for(let i=0;i<e.length;i++)if(Dp(r,e[i]))return!0;return!1}function _d(r,e,i){const a=[];for(let h=0;h<r.length;h++){const p=[];for(let m=0;m<r[h].length;m++){const y=G1(r[h][m],i);us(e,y),p.push(y)}a.push(p)}return a}function Rp(r,e,i){const a=[];for(let h=0;h<r.length;h++){const p=_d(r[h],e,i);a.push(p)}return a}function Lp(r,e,i,a){if(r[0]<i[0]||r[0]>i[2]){const h=.5*a;let p=r[0]-i[0]>h?-a:i[0]-r[0]>h?a:0;p===0&&(p=r[0]-i[2]>h?-a:i[2]-r[0]>h?a:0),r[0]+=p}us(e,r)}function ql(r,e,i,a){const h=Math.pow(2,a.z)*Vr,p=[a.x*Vr,a.y*Vr],m=[];if(!r)return m;for(const y of r)for(const b of y){const E=[b.x+p[0],b.y+p[1]];Lp(E,e,i,h),m.push(E)}return m}function zp(r,e,i,a){const h=Math.pow(2,a.z)*Vr,p=[a.x*Vr,a.y*Vr],m=[];if(!r)return m;for(const b of r){const E=[];for(const C of b){const A=[C.x+p[0],C.y+p[1]];us(e,A),E.push(A)}m.push(E)}if(e[2]-e[0]<=h/2){(y=e)[0]=y[1]=1/0,y[2]=y[3]=-1/0;for(const b of m)for(const E of b)Lp(E,e,i,h)}var y;return m}class fa{constructor(e,i){this.type=qr,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Oo(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let h=0;h<a.features.length;++h){const p=a.features[h].geometry.type;if(p==="Polygon"||p==="MultiPolygon")return new fa(a,a.features[h].geometry)}else if(a.type==="Feature"){const h=a.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new fa(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new fa(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(a.type==="Polygon"){const y=_d(a.coordinates,p,m),b=ql(i.geometry(),h,p,m);if(!hs(h,p))return!1;for(const E of b)if(!Gl(E,y))return!1}if(a.type==="MultiPolygon"){const y=Rp(a.coordinates,p,m),b=ql(i.geometry(),h,p,m);if(!hs(h,p))return!1;for(const E of b)if(!q1(E,y))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){const h=[1/0,1/0,-1/0,-1/0],p=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(a.type==="Polygon"){const y=_d(a.coordinates,p,m),b=zp(i.geometry(),h,p,m);if(!hs(h,p))return!1;for(const E of b)if(!Dp(E,y))return!1}if(a.type==="MultiPolygon"){const y=Rp(a.coordinates,p,m),b=zp(i.geometry(),h,p,m);if(!hs(h,p))return!1;for(const E of b)if(!H1(E,y))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var yd=fa,Np={exports:{}};Np.exports=function(){var r={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,i=e*(2-e),a=Math.PI/180,h=function(E,C){if(E===void 0)throw new Error("No latitude given.");if(C&&!r[C])throw new Error("Unknown unit "+C+". Use one of: "+Object.keys(r).join(", "));var A=6378.137*a*(C?r[C]:1),P=Math.cos(E*a),R=1/(1-i*(1-P*P)),z=Math.sqrt(R);this.kx=A*z*P,this.ky=A*z*R*(1-i)},p={units:{configurable:!0}};function m(E,C){return E[0]===C[0]&&E[1]===C[1]}function y(E,C,A){var P=b(C[0]-E[0]);return[E[0]+P*A,E[1]+(C[1]-E[1])*A]}function b(E){for(;E<-180;)E+=360;for(;E>180;)E-=360;return E}return h.fromTile=function(E,C,A){var P=Math.PI*(1-2*(E+.5)/Math.pow(2,C)),R=Math.atan(.5*(Math.exp(P)-Math.exp(-P)))/a;return new h(R,A)},p.units.get=function(){return r},h.prototype.distance=function(E,C){var A=b(E[0]-C[0])*this.kx,P=(E[1]-C[1])*this.ky;return Math.sqrt(A*A+P*P)},h.prototype.bearing=function(E,C){var A=b(C[0]-E[0])*this.kx;return Math.atan2(A,(C[1]-E[1])*this.ky)/a},h.prototype.destination=function(E,C,A){var P=A*a;return this.offset(E,Math.sin(P)*C,Math.cos(P)*C)},h.prototype.offset=function(E,C,A){return[E[0]+C/this.kx,E[1]+A/this.ky]},h.prototype.lineDistance=function(E){for(var C=0,A=0;A<E.length-1;A++)C+=this.distance(E[A],E[A+1]);return C},h.prototype.area=function(E){for(var C=0,A=0;A<E.length;A++)for(var P=E[A],R=0,z=P.length,B=z-1;R<z;B=R++)C+=b(P[R][0]-P[B][0])*(P[R][1]+P[B][1])*(A?-1:1);return Math.abs(C)/2*this.kx*this.ky},h.prototype.along=function(E,C){var A=0;if(C<=0)return E[0];for(var P=0;P<E.length-1;P++){var R=E[P],z=E[P+1],B=this.distance(R,z);if((A+=B)>C)return y(R,z,(C-(A-B))/B)}return E[E.length-1]},h.prototype.pointToSegmentDistance=function(E,C,A){var P=C[0],R=C[1],z=b(A[0]-P)*this.kx,B=(A[1]-R)*this.ky,V=0;return z===0&&B===0||((V=(b(E[0]-P)*this.kx*z+(E[1]-R)*this.ky*B)/(z*z+B*B))>1?(P=A[0],R=A[1]):V>0&&(P+=z/this.kx*V,R+=B/this.ky*V)),z=b(E[0]-P)*this.kx,B=(E[1]-R)*this.ky,Math.sqrt(z*z+B*B)},h.prototype.pointOnLine=function(E,C){for(var A,P,R,z,B=1/0,V=0;V<E.length-1;V++){var Q=E[V][0],ae=E[V][1],le=b(E[V+1][0]-Q)*this.kx,he=(E[V+1][1]-ae)*this.ky,me=0;le===0&&he===0||((me=(b(C[0]-Q)*this.kx*le+(C[1]-ae)*this.ky*he)/(le*le+he*he))>1?(Q=E[V+1][0],ae=E[V+1][1]):me>0&&(Q+=le/this.kx*me,ae+=he/this.ky*me));var ve=(le=b(C[0]-Q)*this.kx)*le+(he=(C[1]-ae)*this.ky)*he;ve<B&&(B=ve,A=Q,P=ae,R=V,z=me)}return{point:[A,P],index:R,t:Math.max(0,Math.min(1,z))}},h.prototype.lineSlice=function(E,C,A){var P=this.pointOnLine(A,E),R=this.pointOnLine(A,C);if(P.index>R.index||P.index===R.index&&P.t>R.t){var z=P;P=R,R=z}var B=[P.point],V=P.index+1,Q=R.index;!m(A[V],B[0])&&V<=Q&&B.push(A[V]);for(var ae=V+1;ae<=Q;ae++)B.push(A[ae]);return m(A[Q],R.point)||B.push(R.point),B},h.prototype.lineSliceAlong=function(E,C,A){for(var P=0,R=[],z=0;z<A.length-1;z++){var B=A[z],V=A[z+1],Q=this.distance(B,V);if((P+=Q)>E&&R.length===0&&R.push(y(B,V,(E-(P-Q))/Q)),P>=C)return R.push(y(B,V,(C-(P-Q))/Q)),R;P>E&&R.push(V)}return R},h.prototype.bufferPoint=function(E,C){var A=C/this.ky,P=C/this.kx;return[E[0]-P,E[1]-A,E[0]+P,E[1]+A]},h.prototype.bufferBBox=function(E,C){var A=C/this.ky,P=C/this.kx;return[E[0]-P,E[1]-A,E[2]+P,E[3]+A]},h.prototype.insideBBox=function(E,C){return b(E[0]-C[0])>=0&&b(E[0]-C[2])<=0&&E[1]>=C[1]&&E[1]<=C[3]},Object.defineProperties(h,p),h}();var Fp=J(Np.exports),vd={exports:{}};vd.exports=function(){var r=function(i,a){if(i===void 0&&(i=[]),a===void 0&&(a=e),this.data=i,this.length=this.data.length,this.compare=a,this.length>0)for(var h=(this.length>>1)-1;h>=0;h--)this._down(h)};function e(i,a){return i<a?-1:i>a?1:0}return r.prototype.push=function(i){this.data.push(i),this.length++,this._up(this.length-1)},r.prototype.pop=function(){if(this.length!==0){var i=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),i}},r.prototype.peek=function(){return this.data[0]},r.prototype._up=function(i){for(var a=this.data,h=this.compare,p=a[i];i>0;){var m=i-1>>1,y=a[m];if(h(p,y)>=0)break;a[i]=y,i=m}a[i]=p},r.prototype._down=function(i){for(var a=this.data,h=this.compare,p=this.length>>1,m=a[i];i<p;){var y=1+(i<<1),b=a[y],E=y+1;if(E<this.length&&h(a[E],b)<0&&(y=E,b=a[E]),h(b,m)>=0)break;a[i]=b,i=y}a[i]=m},r}();var xd=J(vd.exports),kt=8192;function wy(r,e){return e.dist-r.dist}const bd=100,Bp=50;function Ey(r){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==r.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==r[i])return!1;return!0}function wd(r){return r[1]-r[0]+1}function Ba(r,e){const i=r[1]>=r[0]&&r[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Ed(r,e){if(r[0]>r[1])return[null,null];const i=wd(r);if(e){if(i===2)return[r,null];const a=Math.floor(i/2);return[[r[0],r[0]+a],[r[0]+a,r[1]]]}{if(i===1)return[r,null];const a=Math.floor(i/2)-1;return[[r[0],r[0]+a],[r[0]+a+1,r[1]]]}}function ul(r,e){const i=[1/0,1/0,-1/0,-1/0];if(!Ba(e,r.length))return i;for(let a=e[0];a<=e[1];++a)us(i,r[a]);return i}function Sd(r){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<r.length;++i)for(let a=0;a<r[i].length;++a)us(e,r[i][a]);return e}function Wl(r,e,i){if(Ey(r)||Ey(e))return NaN;let a=0,h=0;return r[2]<e[0]&&(a=e[0]-r[2]),r[0]>e[2]&&(a=r[0]-e[2]),r[1]>e[3]&&(h=r[1]-e[3]),r[3]<e[1]&&(h=e[1]-r[3]),i.distance([0,0],[a,h])}function jp(r,e){const i=Math.pow(2,e.z);return[(h=(r.x/kt+e.x)/i,360*h-180),(a=(r.y/kt+e.y)/i,360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90)];var a,h}function Z1(r,e){const i=[];for(let a=0;a<r.length;++a)i.push(jp(r[a],e));return i}function $p(r,e,i){const a=i.pointOnLine(e,r).point;return i.distance(r,a)}function Up(r,e,i,a,h){const p=i.slice(a[0],a[1]+1);let m=1/0;for(let y=e[0];y<=e[1];++y)if((m=Math.min(m,$p(r[y],p,h)))===0)return 0;return m}function Vp(r,e,i,a,h){const p=Math.min(h.pointToSegmentDistance(r,i,a),h.pointToSegmentDistance(e,i,a)),m=Math.min(h.pointToSegmentDistance(i,r,e),h.pointToSegmentDistance(a,r,e));return Math.min(p,m)}function X1(r,e,i,a,h){if(!Ba(e,r.length)||!Ba(a,i.length))return NaN;let p=1/0;for(let m=e[0];m<e[1];++m)for(let y=a[0];y<a[1];++y){if(Fa(r[m],r[m+1],i[y],i[y+1]))return 0;p=Math.min(p,Vp(r[m],r[m+1],i[y],i[y+1],h))}return p}function Y1(r,e,i,a,h){if(!Ba(e,r.length)||!Ba(a,i.length))return NaN;let p=1/0;for(let m=e[0];m<=e[1];++m)for(let y=a[0];y<=a[1];++y)if((p=Math.min(p,h.distance(r[m],i[y])))===0)return p;return p}function Sy(r,e,i){if(Gl(r,e,!0))return 0;let a=1/0;for(const h of e){const p=h.length;if(p<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[p-1]&&(a=Math.min(a,i.pointToSegmentDistance(r,h[p-1],h[0])))===0||(a=Math.min(a,$p(r,h,i)))===0)return a}return a}function Q1(r,e,i,a){if(!Ba(e,r.length))return NaN;for(let p=e[0];p<=e[1];++p)if(Gl(r[p],i,!0))return 0;let h=1/0;for(let p=e[0];p<e[1];++p)for(const m of i)for(let y=0,b=m.length,E=b-1;y<b;E=y++){if(Fa(r[p],r[p+1],m[E],m[y]))return 0;h=Math.min(h,Vp(r[p],r[p+1],m[E],m[y],a))}return h}function Ty(r,e){for(const i of r)for(let a=0;a<=i.length-1;++a)if(Gl(i[a],e,!0))return!0;return!1}function Cy(r,e,i,a=1/0){const h=Sd(r),p=Sd(e);if(a!==1/0&&Wl(h,p,i)>=a)return a;if(hs(h,p)){if(Ty(r,e))return 0}else if(Ty(e,r))return 0;let m=a;for(const y of r)for(let b=0,E=y.length,C=E-1;b<E;C=b++)for(const A of e)for(let P=0,R=A.length,z=R-1;P<R;z=P++){if(Fa(y[C],y[b],A[z],A[P]))return 0;m=Math.min(m,Vp(y[C],y[b],A[z],A[P],i))}return m}function Td(r,e,i,a,h,p,m){if(p===null||m===null)return;const y=Wl(ul(a,p),ul(h,m),i);y<e&&r.push({dist:y,range1:p,range2:m})}function K1(r,e,i,a,h=1/0){let p=Math.min(a.distance(r[0],i[0][0]),h);if(p===0)return p;const m=new xd([{dist:0,range1:[0,r.length-1],range2:[0,0]}],wy),y=e?Bp:bd,b=Sd(i);for(;m.length;){const E=m.pop();if(E.dist>=p)continue;const C=E.range1;if(wd(C)<=y){if(!Ba(C,r.length))return NaN;if(e){const A=Q1(r,C,i,a);if((p=Math.min(p,A))===0)return p}else for(let A=C[0];A<=C[1];++A){const P=Sy(r[A],i,a);if((p=Math.min(p,P))===0)return p}}else{const A=Ed(C,e);if(A[0]!==null){const P=Wl(ul(r,A[0]),b,a);P<p&&m.push({dist:P,range1:A[0],range2:[0,0]})}if(A[1]!==null){const P=Wl(ul(r,A[1]),b,a);P<p&&m.push({dist:P,range1:A[1],range2:[0,0]})}}}return p}function My(r,e,i,a,h,p=1/0){let m=Math.min(p,h.distance(r[0],i[0]));if(m===0)return m;const y=new xd([{dist:0,range1:[0,r.length-1],range2:[0,i.length-1]}],wy),b=e?Bp:bd,E=a?Bp:bd;for(;y.length;){const C=y.pop();if(C.dist>=m)continue;const A=C.range1,P=C.range2;if(wd(A)<=b&&wd(P)<=E){if(!Ba(A,r.length)||!Ba(P,i.length))return NaN;if(e&&a?m=Math.min(m,X1(r,A,i,P,h)):e||a?e&&!a?m=Math.min(m,Up(i,P,r,A,h)):!e&&a&&(m=Math.min(m,Up(r,A,i,P,h))):m=Math.min(m,Y1(r,A,i,P,h)),m===0)return m}else{const R=Ed(A,e),z=Ed(P,a);Td(y,m,h,r,i,R[0],z[0]),Td(y,m,h,r,i,R[0],z[1]),Td(y,m,h,r,i,R[1],z[0]),Td(y,m,h,r,i,R[1],z[1])}}return m}function Cd(r,e,i,a,h=1/0){let p=h;const m=ul(r,[0,r.length-1]);for(const y of i)if(!(p!==1/0&&Wl(m,ul(y,[0,y.length-1]),a)>=p)&&(p=Math.min(p,My(r,e,y,!0,a,p)),p===0))return p;return p}function rh(r,e,i,a,h=1/0){let p=h;const m=ul(r,[0,r.length-1]);for(const y of i){if(p!==1/0&&Wl(m,Sd(y),a)>=p)continue;const b=K1(r,e,y,a,p);if(isNaN(b))return b;if((p=Math.min(p,b))===0)return p}return p}function Md(r){return r==="Point"||r==="MultiPoint"||r==="LineString"||r==="MultiLineString"||r==="Polygon"||r==="MultiPolygon"}class nh{constructor(e,i){this.type=mt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Oo(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let h=0;h<a.features.length;++h)if(Md(a.features[h].geometry.type))return new nh(a,a.features[h].geometry)}else if(a.type==="Feature"){if(Md(a.geometry.type))return new nh(a,a.geometry)}else if(Md(a.type))return new nh(a,a)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),a=e.canonicalID();if(i!=null&&a!=null){if(e.geometryType()==="Point")return function(h,p,m){const y=[];for(const E of h)for(const C of E)y.push(jp(C,p));const b=new Fp(y[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?My(y,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",b):m.type==="MultiLineString"?Cd(y,!1,m.coordinates,b):m.type==="Polygon"||m.type==="MultiPolygon"?rh(y,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,b):null}(i,a,this.geometries);if(e.geometryType()==="LineString")return function(h,p,m){const y=[];for(const E of h){const C=[];for(const A of E)C.push(jp(A,p));y.push(C)}const b=new Fp(y[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return Cd(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",y,b);if(m.type==="MultiLineString"){let E=1/0;for(let C=0;C<m.coordinates.length;C++){const A=Cd(m.coordinates[C],!0,y,b,E);if(isNaN(A))return A;if((E=Math.min(E,A))===0)return E}return E}if(m.type==="Polygon"||m.type==="MultiPolygon"){let E=1/0;for(let C=0;C<y.length;C++){const A=rh(y[C],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,b,E);if(isNaN(A))return A;if((E=Math.min(E,A))===0)return E}return E}return null}(i,a,this.geometries);if(e.geometryType()==="Polygon")return function(h,p,m){const y=[];for(const E of function(C,A){const P=C.length;if(P<=1)return[C];const R=[];let z,B;for(let V=0;V<P;V++){const Q=Vl(C[V]);Q!==0&&(C[V].area=Math.abs(Q),B===void 0&&(B=Q<0),B===Q<0?(z&&R.push(z),z=[C[V]]):z.push(C[V]))}return z&&R.push(z),R}(h)){const C=[];for(let A=0;A<E.length;++A)C.push(Z1(E[A],p));y.push(C)}const b=new Fp(y[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return rh(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",y,b);if(m.type==="MultiLineString"){let E=1/0;for(let C=0;C<m.coordinates.length;C++){const A=rh(m.coordinates[C],!0,y,b,E);if(isNaN(A))return A;if((E=Math.min(E,A))===0)return E}return E}return m.type==="Polygon"||m.type==="MultiPolygon"?function(E,C,A){let P=1/0;for(const R of E)for(const z of C){const B=Cy(R,z,A,P);if(isNaN(B))return B;if((P=Math.min(P,B))===0)return P}return P}(m.type==="Polygon"?[m.coordinates]:m.coordinates,y,b):null}(i,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var Gp=nh;function $c(r){if(r instanceof gi&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof yd||r instanceof Gp)return!1;let e=!0;return r.eachChild(i=>{e&&!$c(i)&&(e=!1)}),e}function oo(r){if(r instanceof gi&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!oo(i)&&(e=!1)}),e}function ih(r){if(r instanceof gi&&r.name==="config")return!1;let e=!0;return r.eachChild(i=>{e&&!ih(i)&&(e=!1)}),e}function Hl(r,e){if(r instanceof gi&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(a=>{i&&!Hl(a,e)&&(i=!1)}),i}class Id{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new Id(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Iy=Id;class Uc{constructor(e,i=[],a,h=new Na,p=[],m,y){this.registry=e,this.path=i,this.key=i.map(b=>`[${b}]`).join(""),this.scope=h,this.errors=p,this.expectedType=a,this._scope=m,this.options=y}parse(e,i,a,h,p={}){return i||a?this.concat(i,a,h)._parse(e,p):this._parse(e,p)}_parse(e,i){function a(h,p,m){return m==="assert"?new sr(p,[h]):m==="coerce"?new An(p,[h]):h}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(h){let p=h.parse(e,this);if(!p)return null;if(this.expectedType){const m=this.expectedType,y=p.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||y.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||y.kind!=="value"&&y.kind!=="string"){if(this.checkSubtype(m,y))return null}else p=a(p,m,i.typeAnnotation||"coerce");else p=a(p,m,i.typeAnnotation||"assert")}if(!(p instanceof Gs)&&p.type.kind!=="resolvedImage"&&Ad(p)){const m=new Do(this._scope,this.options);try{p=new Gs(p.type,p.evaluate(m))}catch(y){return this.error(y.message),null}}return p}return An.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a){const h=typeof e=="number"?this.path.concat(e):this.path,p=a?this.scope.concat(a):this.scope;return new Uc(this.registry,h,i||null,p,this.errors,this._scope,this.options)}error(e,...i){const a=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new vo(a,e))}checkSubtype(e,i){const a=Fe(e,i);return a&&this.error(a),a}}var qp=Uc;function Ad(r){if(r instanceof Iy)return Ad(r.boundExpression);if(r instanceof gi&&r.name==="error"||r instanceof gi&&r.name==="config"||r instanceof Ho||r instanceof yd||r instanceof Gp)return!1;const e=r instanceof An||r instanceof sr;let i=!0;return r.eachChild(a=>{i=e?i&&Ad(a):i&&a instanceof Gs}),!!i&&$c(r)&&Hl(r,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function kd(r,e){const i=r.length-1;let a,h,p=0,m=i,y=0;for(;p<=m;)if(y=Math.floor((p+m)/2),a=r[y],h=r[y+1],a<=e){if(y===i||e<h)return y;p=y+1}else{if(!(a>e))throw new Te("Input is not a number.");m=y-1}return 0}class Wp{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[h,p]of a)this.labels.push(h),this.outputs.push(p)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,mt);if(!a)return null;const h=[];let p=null;i.expectedType&&i.expectedType.kind!=="value"&&(p=i.expectedType);for(let m=1;m<e.length;m+=2){const y=m===1?-1/0:e[m],b=e[m+1],E=m,C=m+1;if(typeof y!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',E);if(h.length&&h[h.length-1][0]>=y)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',E);const A=i.parse(b,C,p);if(!A)return null;p=p||A.type,h.push([y,A])}return new Wp(p,a,h)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return a[0].evaluate(e);const p=i.length;return h>=i[p-1]?a[p-1].evaluate(e):a[kd(i,h)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}var Hp=Wp;function Fr(r,e,i){return r*(1-i)+e*i}function Pd(r,e,i){return r.map((a,h)=>Fr(a,e[h],i))}var oh=Object.freeze({__proto__:null,array:Pd,color:function(r,e,i){return new En(Fr(r.r,e.r,i),Fr(r.g,e.g,i),Fr(r.b,e.b,i),Fr(r.a,e.a,i))},number:Fr});const sh=.95047,Zl=1.08883,Ay=4/29,Vc=6/29,ky=3*Vc*Vc,J1=Vc*Vc*Vc,eb=Math.PI/180,tb=180/Math.PI;function Zp(r){return r>J1?Math.pow(r,1/3):r/ky+Ay}function Xp(r){return r>Vc?r*r*r:ky*(r-Ay)}function Yp(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Qp(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Py(r){const e=Qp(r.r),i=Qp(r.g),a=Qp(r.b),h=Zp((.4124564*e+.3575761*i+.1804375*a)/sh),p=Zp((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*p-16,a:500*(h-p),b:200*(p-Zp((.0193339*e+.119192*i+.9503041*a)/Zl)),alpha:r.a}}function Xl(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,a=isNaN(r.b)?e:e-r.b/200;return e=1*Xp(e),i=sh*Xp(i),a=Zl*Xp(a),new En(Yp(3.2404542*i-1.5371385*e-.4985314*a),Yp(-.969266*i+1.8760108*e+.041556*a),Yp(.0556434*i-.2040259*e+1.0572252*a),r.alpha)}function Oy(r,e,i){const a=e-r;return r+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const Gc={forward:Py,reverse:Xl,interpolate:function(r,e,i){return{l:Fr(r.l,e.l,i),a:Fr(r.a,e.a,i),b:Fr(r.b,e.b,i),alpha:Fr(r.alpha,e.alpha,i)}}},hl={forward:function(r){const{l:e,a:i,b:a}=Py(r),h=Math.atan2(a,i)*tb;return{h:h<0?h+360:h,c:Math.sqrt(i*i+a*a),l:e,alpha:r.a}},reverse:function(r){const e=r.h*eb,i=r.c;return Xl({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:Oy(r.h,e.h,i),c:Fr(r.c,e.c,i),l:Fr(r.l,e.l,i),alpha:Fr(r.alpha,e.alpha,i)}}};var Dy=Object.freeze({__proto__:null,hcl:hl,lab:Gc});class Od{constructor(e,i,a,h,p){this.type=e,this.operator=i,this.interpolation=a,this.input=h,this.labels=[],this.outputs=[];for(const[m,y]of p)this.labels.push(m),this.outputs.push(y)}static interpolationFactor(e,i,a,h){let p=0;if(e.name==="exponential")p=pa(i,e.base,a,h);else if(e.name==="linear")p=pa(i,1,a,h);else if(e.name==="cubic-bezier"){const m=e.controlPoints;p=new Me(m[0],m[1],m[2],m[3]).solve(pa(i,1,a,h))}return p}static parse(e,i){let[a,h,p,...m]=e;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const E=h[1];if(typeof E!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:E}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const E=h.slice(1);if(E.length!==4||E.some(C=>typeof C!="number"||C<0||C>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:E}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(p=i.parse(p,2,mt),!p)return null;const y=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=xo:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType);for(let E=0;E<m.length;E+=2){const C=m[E],A=m[E+1],P=E+3,R=E+4;if(typeof C!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(y.length&&y[y.length-1][0]>=C)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const z=i.parse(A,R,b);if(!z)return null;b=b||z.type,y.push([C,z])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Od(b,a,h,p,y):i.error(`Type ${ln(b)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const h=this.input.evaluate(e);if(h<=i[0])return a[0].evaluate(e);const p=i.length;if(h>=i[p-1])return a[p-1].evaluate(e);const m=kd(i,h),y=Od.interpolationFactor(this.interpolation,h,i[m],i[m+1]),b=a[m].evaluate(e),E=a[m+1].evaluate(e);return this.operator==="interpolate"?oh[this.type.kind.toLowerCase()](b,E,y):this.operator==="interpolate-hcl"?hl.reverse(hl.interpolate(hl.forward(b),hl.forward(E),y)):Gc.reverse(Gc.interpolate(Gc.forward(b),Gc.forward(E),y))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function pa(r,e,i,a){const h=a-i,p=r-i;return h===0?0:e===1?p/h:(Math.pow(e,p)-1)/(Math.pow(e,h)-1)}var qs=Od;class dl{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const h=i.expectedType;h&&h.kind!=="value"&&(a=h);const p=[];for(const y of e.slice(1)){const b=i.parse(y,1+p.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,p.push(b)}const m=h&&p.some(y=>Fe(h,y.type));return new dl(m?zr:a,p)}evaluate(e){let i,a=null,h=0;for(const p of this.args){if(h++,a=p.evaluate(e),a&&a instanceof Yi&&!a.available&&(i||(i=a),a=null,h===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var Ry=dl;class Kp{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let p=1;p<e.length-1;p+=2){const m=e[p];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,p);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",p);const y=i.parse(e[p+1],p+1);if(!y)return null;a.push([m,y])}const h=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return h?new Kp(a,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}var Ly=Kp;class Jp{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,mt),h=i.parse(e[2],2,pi(i.expectedType||zr));return a&&h?new Jp(h.type.itemType,a,h):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Te(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Te(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Te(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var rb=Jp;class Dd{constructor(e,i){this.type=qr,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,zr),h=i.parse(e[2],2,zr);return a&&h?Et(a.type,[qr,Nr,mt,co,zr])?new Dd(a,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ln(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!zt(i,["boolean","string","number","null"]))throw new Te(`Expected first argument to be of type boolean, string, number or null, but found ${ln(ei(i))} instead.`);if(!zt(a,["string","array"]))throw new Te(`Expected second argument to be of type array or string, but found ${ln(ei(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var em=Dd;class Yl{constructor(e,i,a){this.type=mt,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,zr),h=i.parse(e[2],2,zr);if(!a||!h)return null;if(!Et(a.type,[qr,Nr,mt,co,zr]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${ln(a.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,mt);return p?new Yl(a,h,p):null}return new Yl(a,h)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!zt(i,["boolean","string","number","null"]))throw new Te(`Expected first argument to be of type boolean, string, number or null, but found ${ln(ei(i))} instead.`);if(!zt(a,["string","array"]))throw new Te(`Expected second argument to be of type array or string, but found ${ln(ei(a))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return a.indexOf(i,h)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var zy=Yl;class ah{constructor(e,i,a,h,p,m){this.inputType=e,this.type=i,this.input=a,this.cases=h,this.outputs=p,this.otherwise=m}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const p={},m=[];for(let E=2;E<e.length-1;E+=2){let C=e[E];const A=e[E+1];Array.isArray(C)||(C=[C]);const P=i.concat(E);if(C.length===0)return P.error("Expected at least one branch label.");for(const z of C){if(typeof z!="number"&&typeof z!="string")return P.error("Branch labels must be numbers or strings.");if(typeof z=="number"&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof z=="number"&&Math.floor(z)!==z)return P.error("Numeric branch labels must be integer values.");if(a){if(P.checkSubtype(a,ei(z)))return null}else a=ei(z);if(p[String(z)]!==void 0)return P.error("Branch labels must be unique.");p[String(z)]=m.length}const R=i.parse(A,E,h);if(!R)return null;h=h||R.type,m.push(R)}const y=i.parse(e[1],1,zr);if(!y)return null;const b=i.parse(e[e.length-1],e.length-1,h);return b?y.type.kind!=="value"&&i.concat(1).checkSubtype(a,y.type)?null:new ah(a,h,y,p,m,b):null}evaluate(e){const i=this.input.evaluate(e);return(ei(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],h={};for(const m of i){const y=h[this.cases[m]];y===void 0?(h[this.cases[m]]=a.length,a.push([this.cases[m],[m]])):a[y][1].push(m)}const p=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,y]of a)e.push(y.length===1?p(y[0]):y.map(p)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}var nb=ah;class Ms{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const h=[];for(let m=1;m<e.length-1;m+=2){const y=i.parse(e[m],m,qr);if(!y)return null;const b=i.parse(e[m+1],m+1,a);if(!b)return null;h.push([y,b]),a=a||b.type}const p=i.parse(e[e.length-1],e.length-1,a);return p?new Ms(a,h,p):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}var ib=Ms;class lh{constructor(e,i,a,h){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=h}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,zr),h=i.parse(e[2],2,mt);if(!a||!h)return null;if(!Et(a.type,[pi(zr),Nr,zr]))return i.error(`Expected first argument to be of type array or string, but found ${ln(a.type)} instead`);if(e.length===4){const p=i.parse(e[3],3,mt);return p?new lh(a.type,a,h,p):null}return new lh(a.type,a,h)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!zt(i,["string","array"]))throw new Te(`Expected first argument to be of type array or string, but found ${ln(ei(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return i.slice(a,h)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ob=lh;function Ny(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Fy(r,e,i,a){return a.compare(e,i)===0}function qc(r,e,i){const a=r!=="=="&&r!=="!=";return class $j{constructor(p,m,y){this.type=qr,this.lhs=p,this.rhs=m,this.collator=y,this.hasUntypedArgument=p.type.kind==="value"||m.type.kind==="value"}static parse(p,m){if(p.length!==3&&p.length!==4)return m.error("Expected two or three arguments.");const y=p[0];let b=m.parse(p[1],1,zr);if(!b)return null;if(!Ny(y,b.type))return m.concat(1).error(`"${y}" comparisons are not supported for type '${ln(b.type)}'.`);let E=m.parse(p[2],2,zr);if(!E)return null;if(!Ny(y,E.type))return m.concat(2).error(`"${y}" comparisons are not supported for type '${ln(E.type)}'.`);if(b.type.kind!==E.type.kind&&b.type.kind!=="value"&&E.type.kind!=="value")return m.error(`Cannot compare types '${ln(b.type)}' and '${ln(E.type)}'.`);a&&(b.type.kind==="value"&&E.type.kind!=="value"?b=new sr(E.type,[b]):b.type.kind!=="value"&&E.type.kind==="value"&&(E=new sr(b.type,[E])));let C=null;if(p.length===4){if(b.type.kind!=="string"&&E.type.kind!=="string"&&b.type.kind!=="value"&&E.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(C=m.parse(p[3],3,Us),!C)return null}return new $j(b,E,C)}evaluate(p){const m=this.lhs.evaluate(p),y=this.rhs.evaluate(p);if(a&&this.hasUntypedArgument){const b=ei(m),E=ei(y);if(b.kind!==E.kind||b.kind!=="string"&&b.kind!=="number")throw new Te(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${b.kind}, ${E.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=ei(m),E=ei(y);if(b.kind!=="string"||E.kind!=="string")return e(p,m,y)}return this.collator?i(p,m,y,this.collator.evaluate(p)):e(p,m,y)}eachChild(p){p(this.lhs),p(this.rhs),this.collator&&p(this.collator)}outputDefined(){return!0}serialize(){const p=[r];return this.eachChild(m=>{p.push(m.serialize())}),p}}}const By=qc("==",function(r,e,i){return e===i},Fy),tm=qc("!=",function(r,e,i){return e!==i},function(r,e,i,a){return!Fy(0,e,i,a)}),jy=qc("<",function(r,e,i){return e<i},function(r,e,i,a){return a.compare(e,i)<0}),sb=qc(">",function(r,e,i){return e>i},function(r,e,i,a){return a.compare(e,i)>0}),Zo=qc("<=",function(r,e,i){return e<=i},function(r,e,i,a){return a.compare(e,i)<=0}),ab=qc(">=",function(r,e,i){return e>=i},function(r,e,i,a){return a.compare(e,i)>=0});class rm{constructor(e,i,a,h,p,m){this.type=Nr,this.number=e,this.locale=i,this.currency=a,this.unit=h,this.minFractionDigits=p,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,mt);if(!a)return null;const h=e[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let p=null;if(h.locale&&(p=i.parse(h.locale,1,Nr),!p))return null;let m=null;if(h.currency&&(m=i.parse(h.currency,1,Nr),!m))return null;let y=null;if(h.unit&&(y=i.parse(h.unit,1,Nr),!y))return null;let b=null;if(h["min-fraction-digits"]&&(b=i.parse(h["min-fraction-digits"],1,mt),!b))return null;let E=null;return h["max-fraction-digits"]&&(E=i.parse(h["max-fraction-digits"],1,mt),!E)?null:new rm(a,p,m,y,b,E)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class nm{constructor(e){this.type=mt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${ln(a.type)} instead.`):new nm(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Te(`Expected value to be of type string or array, but found ${ln(ei(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function ch(r){return function(){r=1831565813+(r|=0)|0;let e=Math.imul(r^r>>>15,1|r);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const im={"==":By,"!=":tm,">":sb,"<":jy,">=":ab,"<=":Zo,array:sr,at:rb,boolean:sr,case:ib,coalesce:Ry,collator:Ho,format:Dn,image:Wr,in:em,"index-of":zy,interpolate:qs,"interpolate-hcl":qs,"interpolate-lab":qs,length:nm,let:Ly,literal:Gs,match:nb,number:sr,"number-format":rm,object:sr,slice:ob,step:Hp,string:sr,"to-boolean":An,"to-color":An,"to-number":An,"to-string":An,var:Iy,within:yd,distance:Gp};function Rd(r,[e,i,a,h]){e=e.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const p=h?h.evaluate(r):1,m=ha(e,i,a,p);if(m)throw new Te(m);return new En(e/255*p,i/255*p,a/255*p,p)}function $y(r,[e,i,a,h]){e=e.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const p=h?h.evaluate(r):1,m=function(E,C,A,P){return typeof E=="number"&&E>=0&&E<=360?typeof C=="number"&&C>=0&&C<=100&&typeof A=="number"&&A>=0&&A<=100?P===void 0||typeof P=="number"&&P>=0&&P<=1?null:`Invalid hsla value [${[E,C,A,P].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof P=="number"?[E,C,A,P]:[E,C,A]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof P=="number"?[E,C,A,P]:[E,C,A]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,a,p);if(m)throw new Te(m);const y=`hsla(${e}, ${i}%, ${a}%, ${p})`,b=En.parse(y);if(!b)throw new Te(`Failed to parse HSLA color: ${y}`);return b}function Uy(r,e){return r in e}function Ql(r,e){const i=e[r];return i===void 0?null:i}function Vy(r,e){switch(r){case"string":return String(e);case"number":return+e;case"boolean":return!!e;case"color":return En.parse(e)}return e}function Gy(r,e,i,a){return a!==void 0&&(r=a*Math.round(r/a)),e!==void 0&&r<e&&(r=e),i!==void 0&&r>i&&(r=i),r}function om(r,e,i){e=[e,i,r.scope].filter(Boolean).join("");const a=r.getConfig(e);if(!a)return null;const{type:h,value:p,values:m,minValue:y,maxValue:b,stepValue:E}=a,C=a.default.evaluate(r);let A=C;if(p){const P=r.scope;r.scope=(P||"").split("").slice(1).join(""),A=p.evaluate(r),r.scope=P}return h&&(A=Vy(h,A)),p!==void 0&&A!==void 0&&m&&!m.includes(A)&&(A=C,h&&(A=Vy(h,A))),A===void 0||y===void 0&&b===void 0&&E===void 0||(typeof A=="number"?A=Gy(A,y,b,E):Array.isArray(A)&&(A=A.map(P=>typeof P=="number"?Gy(P,y,b,E):P))),A}function fl(r){return{type:r}}gi.register(im,{error:[{kind:"error"},[Nr],(r,[e])=>{throw new Te(e.evaluate(r))}],typeof:[Nr,[zr],(r,[e])=>ln(ei(e.evaluate(r)))],"to-rgba":[pi(mt,4),[xo],(r,[e])=>e.evaluate(r).toArray()],rgb:[xo,[mt,mt,mt],Rd],rgba:[xo,[mt,mt,mt,mt],Rd],hsl:[xo,[mt,mt,mt],$y],hsla:[xo,[mt,mt,mt,mt],$y],has:{type:qr,overloads:[[[Nr],(r,[e])=>Uy(e.evaluate(r),r.properties())],[[Nr,Ss],(r,[e,i])=>Uy(e.evaluate(r),i.evaluate(r))]]},get:{type:zr,overloads:[[[Nr],(r,[e])=>Ql(e.evaluate(r),r.properties())],[[Nr,Ss],(r,[e,i])=>Ql(e.evaluate(r),i.evaluate(r))]]},config:{type:zr,overloads:[[[Nr],(r,[e])=>om(r,e.evaluate(r))],[[Nr,Nr],(r,[e,i])=>om(r,e.evaluate(r),i.evaluate(r))]]},"feature-state":[zr,[Nr],(r,[e])=>Ql(e.evaluate(r),r.featureState||{})],properties:[Ss,[],r=>r.properties()],"geometry-type":[Nr,[],r=>r.geometryType()],id:[zr,[],r=>r.id()],zoom:[mt,[],r=>r.globals.zoom],pitch:[mt,[],r=>r.globals.pitch||0],"distance-from-center":[mt,[],r=>r.distanceFromCenter()],"measure-light":[mt,[Nr],(r,[e])=>r.measureLight(e.evaluate(r))],"heatmap-density":[mt,[],r=>r.globals.heatmapDensity||0],"line-progress":[mt,[],r=>r.globals.lineProgress||0],"raster-value":[mt,[],r=>r.globals.rasterValue||0],"sky-radial-progress":[mt,[],r=>r.globals.skyRadialProgress||0],accumulated:[zr,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[mt,fl(mt),(r,e)=>{let i=0;for(const a of e)i+=a.evaluate(r);return i}],"*":[mt,fl(mt),(r,e)=>{let i=1;for(const a of e)i*=a.evaluate(r);return i}],"-":{type:mt,overloads:[[[mt,mt],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[mt],(r,[e])=>-e.evaluate(r)]]},"/":[mt,[mt,mt],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[mt,[mt,mt],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[mt,[],()=>Math.LN2],pi:[mt,[],()=>Math.PI],e:[mt,[],()=>Math.E],"^":[mt,[mt,mt],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[mt,[mt],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[mt,[mt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[mt,[mt],(r,[e])=>Math.log(e.evaluate(r))],log2:[mt,[mt],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[mt,[mt],(r,[e])=>Math.sin(e.evaluate(r))],cos:[mt,[mt],(r,[e])=>Math.cos(e.evaluate(r))],tan:[mt,[mt],(r,[e])=>Math.tan(e.evaluate(r))],asin:[mt,[mt],(r,[e])=>Math.asin(e.evaluate(r))],acos:[mt,[mt],(r,[e])=>Math.acos(e.evaluate(r))],atan:[mt,[mt],(r,[e])=>Math.atan(e.evaluate(r))],min:[mt,fl(mt),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[mt,fl(mt),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[mt,[mt],(r,[e])=>Math.abs(e.evaluate(r))],round:[mt,[mt],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[mt,[mt],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[mt,[mt],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[qr,[Nr,zr],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[qr,[zr],(r,[e])=>r.id()===e.value],"filter-type-==":[qr,[Nr],(r,[e])=>r.geometryType()===e.value],"filter-<":[qr,[Nr,zr],(r,[e,i])=>{const a=r.properties()[e.value],h=i.value;return typeof a==typeof h&&a<h}],"filter-id-<":[qr,[zr],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[qr,[Nr,zr],(r,[e,i])=>{const a=r.properties()[e.value],h=i.value;return typeof a==typeof h&&a>h}],"filter-id->":[qr,[zr],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[qr,[Nr,zr],(r,[e,i])=>{const a=r.properties()[e.value],h=i.value;return typeof a==typeof h&&a<=h}],"filter-id-<=":[qr,[zr],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[qr,[Nr,zr],(r,[e,i])=>{const a=r.properties()[e.value],h=i.value;return typeof a==typeof h&&a>=h}],"filter-id->=":[qr,[zr],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[qr,[zr],(r,[e])=>e.value in r.properties()],"filter-has-id":[qr,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[qr,[pi(Nr)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[qr,[pi(zr)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[qr,[Nr,pi(zr)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[qr,[Nr,pi(zr)],(r,[e,i])=>function(a,h,p,m){for(;p<=m;){const y=p+m>>1;if(h[y]===a)return!0;h[y]>a?m=y-1:p=y+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:qr,overloads:[[[qr,qr],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[fl(qr),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:qr,overloads:[[[qr,qr],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[fl(qr),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[qr,[qr],(r,[e])=>!e.evaluate(r)],"is-supported-script":[qr,[Nr],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[Nr,[Nr],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[Nr,[Nr],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[Nr,fl(zr),(r,e)=>e.map(i=>Cs(i.evaluate(r))).join("")],"resolved-locale":[Nr,[Us],(r,[e])=>e.evaluate(r).resolvedLocale()],random:[mt,[mt,mt,zr],(r,e)=>{const[i,a,h]=e.map(m=>m.evaluate(r));if(i>a||i===a)return i;let p;if(typeof h=="string")p=function(m){let y=0;if(m.length===0)return y;for(let b=0;b<m.length;b++)y=(y<<5)-y+m.charCodeAt(b),y&=y;return y}(h);else{if(typeof h!="number")throw new Te(`Invalid seed input: ${h}`);p=h}return i+ch(p)()*(a-i)}]});var uh=im;function Is(r){return{result:"success",value:r}}function pl(r){return{result:"error",value:r}}function qy(r,e){return!!r&&!!r.parameters&&r.parameters.indexOf(e)>-1}function ml(r){return r["property-type"]==="data-driven"}function hh(r){return qy(r.expression,"measure-light")}function sm(r){return qy(r.expression,"zoom")}function am(r){return!!r.expression&&r.expression.interpolated}function Ld(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function lb(r){return r}function Wy(r,e){const i=e.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",h=a||!(a||r.property!==void 0),p=r.type||(am(e)?"exponential":"interval");if(i&&((r=yo({},r)).stops&&(r.stops=r.stops.map(E=>[E[0],En.parse(E[1])])),r.default=En.parse(r.default?r.default:e.default)),r.colorSpace&&r.colorSpace!=="rgb"&&!Dy[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let m,y,b;if(p==="exponential")m=dh;else if(p==="interval")m=ds;else if(p==="categorical"){m=zd,y=Object.create(null);for(const E of r.stops)y[E[0]]=E[1];b=typeof r.stops[0][0]}else{if(p!=="identity")throw new Error(`Unknown function type "${p}"`);m=cb}if(a){const E={},C=[];for(let R=0;R<r.stops.length;R++){const z=r.stops[R],B=z[0].zoom;E[B]===void 0&&(E[B]={zoom:B,type:r.type,property:r.property,default:r.default,stops:[]},C.push(B)),E[B].stops.push([z[0].value,z[1]])}const A=[];for(const R of C)A.push([E[R].zoom,Wy(E[R],e)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:qs.interpolationFactor.bind(void 0,P),zoomStops:A.map(R=>R[0]),evaluate:({zoom:R},z)=>dh({stops:A,base:r.base},e,R).evaluate(R,z)}}if(h){const E=p==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:qs.interpolationFactor.bind(void 0,E),zoomStops:r.stops.map(C=>C[0]),evaluate:({zoom:C})=>m(r,e,C,y,b)}}return{kind:"source",evaluate(E,C){const A=C&&C.properties?C.properties[r.property]:void 0;return A===void 0?gl(r.default,e.default):m(r,e,A,y,b)}}}function gl(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function zd(r,e,i,a,h){return gl(typeof i===h?a[i]:void 0,r.default,e.default)}function ds(r,e,i){if(vr(i)!=="number")return gl(r.default,e.default);const a=r.stops.length;if(a===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[a-1][0])return r.stops[a-1][1];const h=kd(r.stops.map(p=>p[0]),i);return r.stops[h][1]}function dh(r,e,i){const a=r.base!==void 0?r.base:1;if(vr(i)!=="number")return gl(r.default,e.default);const h=r.stops.length;if(h===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[h-1][0])return r.stops[h-1][1];const p=kd(r.stops.map(C=>C[0]),i),m=function(C,A,P,R){const z=R-P,B=C-P;return z===0?0:A===1?B/z:(Math.pow(A,B)-1)/(Math.pow(A,z)-1)}(i,a,r.stops[p][0],r.stops[p+1][0]),y=r.stops[p][1],b=r.stops[p+1][1];let E=oh[e.type]||lb;if(r.colorSpace&&r.colorSpace!=="rgb"){const C=Dy[r.colorSpace];E=(A,P)=>C.reverse(C.interpolate(C.forward(A),C.forward(P),m))}return typeof y.evaluate=="function"?{evaluate(...C){const A=y.evaluate.apply(void 0,C),P=b.evaluate.apply(void 0,C);if(A!==void 0&&P!==void 0)return E(A,P,m)}}:E(y,b,m)}function cb(r,e,i){return e.type==="color"?i=En.parse(i):e.type==="formatted"?i=$i.fromString(i.toString()):e.type==="resolvedImage"?i=Yi.fromString(i.toString()):vr(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),gl(i,r.default,e.default)}class lm{constructor(e,i,a,h){this.expression=e,this._warningHistory={},this._evaluator=new Do(a,h),this._defaultValue=i?function(p){return p.type==="color"&&(Ld(p.default)||Array.isArray(p.default))?new En(0,0,0,0):p.type==="color"?En.parse(p.default)||null:p.default===void 0?null:p.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,a,h,p,m,y,b){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,h,p,m,y,b){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=p||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=y||null,this._evaluator.featureDistanceData=b||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new Te(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function Nd(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in uh}function fh(r,e,i,a){const h=new qp(uh,[],e?function(m){const y={color:xo,string:Nr,number:mt,enum:Nr,boolean:qr,formatted:ls,resolvedImage:Ts};return m.type==="array"?pi(y[m.value]||zr,m.length):y[m.type]}(e):void 0,void 0,void 0,i,a),p=h.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?Is(new lm(p,e,i,a)):pl(h.errors)}class ph{constructor(e,i,a){this.kind=e,this._styleExpression=i,this.isLightConstant=a,this.isStateDependent=e!=="constant"&&!oo(i.expression),this.isConfigDependent=!ih(i.expression)}evaluateWithoutErrorHandling(e,i,a,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,h,p,m)}evaluate(e,i,a,h,p,m){return this._styleExpression.evaluate(e,i,a,h,p,m)}}class mh{constructor(e,i,a,h,p){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!oo(i.expression),this.isLightConstant=p,this.isConfigDependent=!ih(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,i,a,h,p,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,h,p,m)}evaluate(e,i,a,h,p,m){return this._styleExpression.evaluate(e,i,a,h,p,m)}interpolationFactor(e,i,a){return this.interpolationType?qs.interpolationFactor(this.interpolationType,e,i,a):0}}function gh(r,e,i,a){if((r=fh(r,e,i,a)).result==="error")return r;const h=r.value.expression,p=$c(h);if(!p&&!ml(e))return pl([new vo("","data expressions not supported")]);const m=Hl(h,["zoom","pitch","distance-from-center"]);if(!m&&!sm(e))return pl([new vo("","zoom expressions not supported")]);const y=Hl(h,["measure-light"]);if(!y&&!hh(e))return pl([new vo("","measure-light expression not supported")]);const b=e.expression&&e.expression.relaxZoomRestriction,E=Bd(h);return E||m||b?E instanceof vo?pl([E]):E instanceof qs&&!am(e)?pl([new vo("",'"interpolate" expressions cannot be used with this property')]):Is(E?new mh(p?"camera":"composite",r.value,E.labels,E instanceof qs?E.interpolation:void 0,y):new ph(p?"constant":"source",r.value,y)):pl([new vo("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Fd{constructor(e,i){this._parameters=e,this._specification=i,yo(this,Wy(this._parameters,this._specification))}static deserialize(e){return new Fd(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Bd(r){let e=null;if(r instanceof Ly)e=Bd(r.result);else if(r instanceof Ry){for(const i of r.args)if(e=Bd(i),e)break}else(r instanceof Hp||r instanceof qs)&&r.input instanceof gi&&r.input.name==="zoom"&&(e=r);return e instanceof vo||r.eachChild(i=>{const a=Bd(i);a instanceof vo?e=a:e&&a&&e!==a&&(e=new vo("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Xo(r){const e=r.key,i=r.value,a=r.valueSpec||{},h=r.objectElementValidators||{},p=r.style,m=r.styleSpec;let y=[];const b=vr(i);if(b!=="object")return[new qt(e,i,`object expected, ${b} found`)];for(const E in i){const C=E.split(".")[0];let A;h[C]?A=h[C]:a[C]?A=Li:h["*"]?A=h["*"]:a["*"]&&(A=Li),A?y=y.concat(A({key:(e&&`${e}.`)+E,value:i[E],valueSpec:a[C]||a["*"],style:p,styleSpec:m,object:i,objectKey:E},i)):y.push(new Wo(e,i[E],`unknown property "${E}"`))}for(const E in a)h[E]||a[E].required&&a[E].default===void 0&&i[E]===void 0&&y.push(new qt(e,i,`missing required property "${E}"`));return y}function Hy(r){const e=r.value,i=r.valueSpec,a=r.style,h=r.styleSpec,p=r.key,m=r.arrayElementValidator||Li;if(vr(e)!=="array")return[new qt(p,e,`array expected, ${vr(e)} found`)];if(i.length&&e.length!==i.length)return[new qt(p,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new qt(p,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let y={type:i.value,values:i.values,minimum:i.minimum,maximum:i.maximum,function:void 0};h.$version<7&&(y.function=i.function),vr(i.value)==="object"&&(y=i.value);let b=[];for(let E=0;E<e.length;E++)b=b.concat(m({array:e,arrayIndex:E,value:e[E],valueSpec:y,style:a,styleSpec:h,key:`${p}[${E}]`},!0));return b}function cm(r){const e=r.key,i=r.value,a=r.valueSpec;let h=vr(i);if(h==="number"&&i!=i&&(h="NaN"),h!=="number")return[new qt(e,i,`number expected, ${h} found`)];if("minimum"in a){let p=a.minimum;if(vr(a.minimum)==="array"&&(p=a.minimum[r.arrayIndex]),i<p)return[new qt(e,i,`${i} is less than the minimum value ${p}`)]}if("maximum"in a){let p=a.maximum;if(vr(a.maximum)==="array"&&(p=a.maximum[r.arrayIndex]),i>p)return[new qt(e,i,`${i} is greater than the maximum value ${p}`)]}return[]}function um(r){const e=r.valueSpec,i=Un(r.value.type);let a,h,p,m={};const y=i!=="categorical"&&r.value.property===void 0,b=!y,E=vr(r.value.stops)==="array"&&vr(r.value.stops[0])==="array"&&vr(r.value.stops[0][0])==="object",C=Xo({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(R){if(i==="identity")return[new qt(R.key,R.value,'identity function may not have a "stops" property')];let z=[];const B=R.value;return z=z.concat(Hy({key:R.key,value:B,valueSpec:R.valueSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:A})),vr(B)==="array"&&B.length===0&&z.push(new qt(R.key,B,"array must have at least one stop")),z},default:function(R){return Li({key:R.key,value:R.value,valueSpec:e,style:R.style,styleSpec:R.styleSpec})}}});return i==="identity"&&y&&C.push(new qt(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||C.push(new qt(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!am(r.valueSpec)&&C.push(new qt(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(b&&!ml(r.valueSpec)?C.push(new qt(r.key,r.value,"property functions not supported")):y&&!sm(r.valueSpec)&&C.push(new qt(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!E||r.value.property!==void 0||C.push(new qt(r.key,r.value,'"property" property is required')),C;function A(R){let z=[];const B=R.value,V=R.key;if(vr(B)!=="array")return[new qt(V,B,`array expected, ${vr(B)} found`)];if(B.length!==2)return[new qt(V,B,`array length 2 expected, length ${B.length} found`)];if(E){if(vr(B[0])!=="object")return[new qt(V,B,`object expected, ${vr(B[0])} found`)];if(B[0].zoom===void 0)return[new qt(V,B,"object stop key must have zoom")];if(B[0].value===void 0)return[new qt(V,B,"object stop key must have value")];const Q=Un(B[0].zoom);if(typeof Q!="number")return[new qt(V,B[0].zoom,"stop zoom values must be numbers")];if(p&&p>Q)return[new qt(V,B[0].zoom,"stop zoom values must appear in ascending order")];Q!==p&&(p=Q,h=void 0,m={}),z=z.concat(Xo({key:`${V}[0]`,value:B[0],valueSpec:{zoom:{}},style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:cm,value:P}}))}else z=z.concat(P({key:`${V}[0]`,value:B[0],valueSpec:{},style:R.style,styleSpec:R.styleSpec},B));return Nd(as(B[1]))?z.concat([new qt(`${V}[1]`,B[1],"expressions are not allowed in function stops.")]):z.concat(Li({key:`${V}[1]`,value:B[1],valueSpec:e,style:R.style,styleSpec:R.styleSpec}))}function P(R,z){const B=vr(R.value),V=Un(R.value),Q=R.value!==null?R.value:z;if(a){if(B!==a)return[new qt(R.key,Q,`${B} stop domain type must match previous stop domain type ${a}`)]}else a=B;if(B!=="number"&&B!=="string"&&B!=="boolean"&&typeof V!="number"&&typeof V!="string"&&typeof V!="boolean")return[new qt(R.key,Q,"stop domain value must be a number, string, or boolean")];if(B!=="number"&&i!=="categorical"){let ae=`number expected, ${B} found`;return ml(e)&&i===void 0&&(ae+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new qt(R.key,Q,ae)]}return i!=="categorical"||B!=="number"||typeof V=="number"&&isFinite(V)&&Math.floor(V)===V?i!=="categorical"&&B==="number"&&typeof V=="number"&&typeof h=="number"&&h!==void 0&&V<h?[new qt(R.key,Q,"stop domain values must appear in ascending order")]:(h=V,i==="categorical"&&V in m?[new qt(R.key,Q,"stop domain values must be unique")]:(m[V]=!0,[])):[new qt(R.key,Q,`integer expected, found ${String(V)}`)]}}function Kl(r){const e=(r.expressionContext==="property"?gh:fh)(as(r.value),r.valueSpec);if(e.result==="error")return e.value.map(a=>new qt(`${r.key}${a.key}`,r.value,a.message));const i=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new qt(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!oo(i))return[new qt(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter")return jd(i,r);if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!Hl(i,["zoom","feature-state"]))return[new qt(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!$c(i))return[new qt(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function jd(r,e){const i=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const h of e.valueSpec.expression.parameters)i.delete(h);if(i.size===0)return[];const a=[];return r instanceof gi&&i.has(r.name)?[new qt(e.key,e.value,`["${r.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(r.eachChild(h=>{a.push(...jd(h,e))}),a)}function Jl(r){const e=r.key,i=r.value,a=r.valueSpec,h=[];return Array.isArray(a.values)?a.values.indexOf(Un(i))===-1&&h.push(new qt(e,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(Un(i))===-1&&h.push(new qt(e,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),h}function $d(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!$d(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Ud(r,e="fill"){if(r==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};$d(r)||(r=Vd(r));const i=r;let a=!0;try{a=function(E){if(!_l(E))return E;let C=as(E);return Zy(C),C=hm(C),C}(i)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(i,null,2)}
        `)}const h=Ge[`filter_${e}`],p=fh(a,h);let m=null;if(p.result==="error")throw new Error(p.value.map(E=>`${E.key}: ${E.message}`).join(", "));m=(E,C,A)=>p.value.evaluate(E,C,{},A);let y=null,b=null;if(a!==i){const E=fh(i,h);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));y=(C,A,P,R,z)=>E.value.evaluate(C,A,{},P,void 0,void 0,R,z),b=!$c(E.value.expression)}return{filter:m,dynamicFilter:y||void 0,needGeometry:Xy(a),needFeature:!!b}}function hm(r){if(!Array.isArray(r))return r;const e=function(i){if(ub.has(i[0])){for(let a=1;a<i.length;a++)if(_l(i[a]))return!0}return i}(r);return e===!0?e:e.map(i=>hm(i))}function Zy(r){let e=!1;const i=[];if(r[0]==="case"){for(let a=1;a<r.length-1;a+=2)e=e||_l(r[a]),i.push(r[a+1]);i.push(r[r.length-1])}else if(r[0]==="match"){e=e||_l(r[1]);for(let a=2;a<r.length-1;a+=2)i.push(r[a+1]);i.push(r[r.length-1])}else if(r[0]==="step"){e=e||_l(r[1]);for(let a=1;a<r.length-1;a+=2)i.push(r[a+1])}e&&(r.length=0,r.push("any",...i));for(let a=1;a<r.length;a++)Zy(r[a])}function _l(r){if(!Array.isArray(r))return!1;if((e=r[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<r.length;i++)if(_l(r[i]))return!0;return!1}const ub=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function hb(r,e){return r<e?-1:r>e?1:0}function Xy(r){if(!Array.isArray(r))return!1;if(r[0]==="within"||r[0]==="distance")return!0;for(let e=1;e<r.length;e++)if(Xy(r[e]))return!0;return!1}function Vd(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Gd(r[1],r[2],"=="):e==="!="?qd(Gd(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Gd(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map(Vd))):e==="all"?["all"].concat(r.slice(1).map(Vd)):e==="none"?["all"].concat(r.slice(1).map(Vd).map(qd)):e==="in"?Yy(r[1],r.slice(2)):e==="!in"?qd(Yy(r[1],r.slice(2))):e==="has"?Qy(r[1]):e!=="!has"||qd(Qy(r[1]));var i}function Gd(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function Yy(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(hb)]]:["filter-in-small",r,["literal",e]]}}function Qy(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function qd(r){return["!",r]}function dm(r){return $d(as(r.value))?Kl(yo({},r,{expressionContext:"filter",valueSpec:r.styleSpec[`filter_${r.layerType||"fill"}`]})):Ky(r)}function Ky(r){const e=r.value,i=r.key;if(vr(e)!=="array")return[new qt(i,e,`array expected, ${vr(e)} found`)];const a=r.styleSpec;let h,p=[];if(e.length<1)return[new qt(i,e,"filter array must have at least 1 element")];switch(p=p.concat(Jl({key:`${i}[0]`,value:e[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),Un(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Un(e[1])==="$type"&&p.push(new qt(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&p.push(new qt(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=vr(e[1]),h!=="string"&&p.push(new qt(`${i}[1]`,e[1],`string expected, ${h} found`)));for(let m=2;m<e.length;m++)h=vr(e[m]),Un(e[1])==="$type"?p=p.concat(Jl({key:`${i}[${m}]`,value:e[m],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&p.push(new qt(`${i}[${m}]`,e[m],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let m=1;m<e.length;m++)p=p.concat(Ky({key:`${i}[${m}]`,value:e[m],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":h=vr(e[1]),e.length!==2?p.push(new qt(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):h!=="string"&&p.push(new qt(`${i}[1]`,e[1],`string expected, ${h} found`))}return p}function Jy(r,e){const i=r.key,a=r.style,h=r.layer,p=r.styleSpec,m=r.value,y=r.objectKey,b=p[`${e}_${r.layerType}`];if(!b)return[];const E=y.match(/^(.*)-transition$/);if(e==="paint"&&E&&b[E[1]]&&b[E[1]].transition)return Li({key:i,value:m,valueSpec:p.transition,style:a,styleSpec:p});const C=r.valueSpec||b[y];if(!C)return[new Wo(i,m,`unknown property "${y}"`)];let A;if(vr(m)==="string"&&ml(C)&&!C.tokens&&(A=/^{([^}]+)}$/.exec(m))){const R=`\`{ "type": "identity", "property": ${A?JSON.stringify(A[1]):'"_"'} }\``;return[new qt(i,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: ${R}.`)]}const P=[];if(r.layerType==="symbol")y!=="text-field"||!a||a.glyphs||a.imports||P.push(new qt(i,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Ld(as(m))&&Un(m.type)==="identity"&&P.push(new qt(i,m,'"text-font" does not support identity functions'));else if(r.layerType==="model"&&e==="paint"&&h&&h.layout&&h.layout.hasOwnProperty("model-id")&&ml(C)&&(hh(C)||sm(C))){const R=gh(as(m),C),z=R.value.expression||R.value._styleExpression.expression;z&&!Hl(z,["measure-light"])&&(y==="model-emissive-strength"&&$c(z)&&oo(z)||P.push(new qt(i,m,`${y} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return P.concat(Li({key:r.key,value:m,valueSpec:C,style:a,styleSpec:p,expressionContext:"property",propertyType:e,propertyKey:y}))}function ev(r){return Jy(r,"paint")}function _h(r){return Jy(r,"layout")}function tv(r){let e=[];const i=r.value,a=r.key,h=r.style,p=r.styleSpec;i.type||i.ref||e.push(new qt(a,i,'either "type" or "ref" is required'));let m=Un(i.type);const y=Un(i.ref);if(i.id){const b=Un(i.id);for(let E=0;E<r.arrayIndex;E++){const C=h.layers[E];Un(C.id)===b&&e.push(new qt(a,i.id,`duplicate layer id "${i.id}", previously used at line ${C.id.__line__}`))}}if("ref"in i){let b;["type","source","source-layer","filter","layout"].forEach(E=>{E in i&&e.push(new qt(a,i[E],`"${E}" is prohibited for ref layers`))}),h.layers.forEach(E=>{Un(E.id)===y&&(b=E)}),b?b.ref?e.push(new qt(a,i.ref,"ref cannot reference another ref layer")):m=Un(b.type):typeof y=="string"&&e.push(new qt(a,i.ref,`ref layer "${y}" not found`))}else if(m!=="background"&&m!=="sky"&&m!=="slot")if(i.source){const b=h.sources&&h.sources[i.source],E=b&&Un(b.type);b?E==="vector"&&m==="raster"?e.push(new qt(a,i.source,`layer "${i.id}" requires a raster source`)):E==="raster"&&m!=="raster"?e.push(new qt(a,i.source,`layer "${i.id}" requires a vector source`)):E!=="vector"||i["source-layer"]?E==="raster-dem"&&m!=="hillshade"?e.push(new qt(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):m!=="line"||!i.paint||!i.paint["line-gradient"]&&!i.paint["line-trim-offset"]||E==="geojson"&&b.lineMetrics||e.push(new qt(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new qt(a,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new qt(a,i.source,`source "${i.source}" not found`))}else e.push(new qt(a,i,'missing required property "source"'));return e=e.concat(Xo({key:a,value:i,valueSpec:p.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Li({key:`${a}.type`,value:i.type,valueSpec:p.layer.type,style:r.style,styleSpec:r.styleSpec,object:i,objectKey:"type"}),filter:b=>dm(yo({layerType:m},b)),layout:b=>Xo({layer:i,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":E=>_h(yo({layerType:m},E))}}),paint:b=>Xo({layer:i,key:b.key,value:b.value,valueSpec:{},style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":E=>ev(yo({layerType:m,layer:i},E))}})}})),e}function Wc(r){const e=r.value,i=r.key,a=vr(e);return a!=="string"?[new qt(i,e,`string expected, ${a} found`)]:[]}const yh={promoteId:function({key:r,value:e}){if(vr(e)==="string")return Wc({key:r,value:e});{const i=[];for(const a in e)i.push(...Wc({key:`${r}.${a}`,value:e[a]}));return i}}};function rv(r){const e=r.value,i=r.key,a=r.styleSpec,h=r.style;if(!e.type)return[new qt(i,e,'"type" is required')];const p=Un(e.type);let m=[];switch(["vector","raster","raster-dem"].includes(p)&&(e.url||e.tiles||m.push(new Wo(i,e,'Either "url" or "tiles" is required.'))),p){case"vector":case"raster":case"raster-dem":return m=m.concat(Xo({key:i,value:e,valueSpec:a[`source_${p.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:yh})),m;case"geojson":if(m=Xo({key:i,value:e,valueSpec:a.source_geojson,style:h,styleSpec:a,objectElementValidators:yh}),e.cluster)for(const y in e.clusterProperties){const[b,E]=e.clusterProperties[y],C=typeof b=="string"?[b,["accumulated"],["get",y]]:b;m.push(...Kl({key:`${i}.${y}.map`,value:E,expressionContext:"cluster-map"})),m.push(...Kl({key:`${i}.${y}.reduce`,value:C,expressionContext:"cluster-reduce"}))}return m;case"video":return Xo({key:i,value:e,valueSpec:a.source_video,style:h,styleSpec:a});case"image":return Xo({key:i,value:e,valueSpec:a.source_image,style:h,styleSpec:a});case"canvas":return[new qt(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Jl({key:`${i}.type`,value:e.type,valueSpec:{values:nv(a)},style:h,styleSpec:a})}}function nv(r){return r.source.reduce((e,i)=>{const a=r[i];return a.type.type==="enum"&&(e=e.concat(Object.keys(a.type.values))),e},[])}function iv(r){const e=r.value;let i=[];if(!e)return i;const a=vr(e);return a!=="string"?(i=i.concat([new qt(r.key,e,`string expected, "${a}" found`)]),i):(function(h){const p=h.indexOf("://")===-1;try{return new URL(h,p?"http://example.com":void 0),!0}catch{return!1}}(e)||(i=i.concat([new qt(r.key,e,`invalid url "${e}"`)])),i)}function fm(r){const e=r.value,i=r.styleSpec,a=i.light,h=r.style;let p=[];const m=vr(e);if(e===void 0)return p;if(m!=="object")return p=p.concat([new qt("light",e,`object expected, ${m} found`)]),p;for(const y in e){const b=y.match(/^(.*)-transition$/);p=p.concat(b&&a[b[1]]&&a[b[1]].transition?Li({key:y,value:e[y],valueSpec:i.transition,style:h,styleSpec:i}):a[y]?Li({key:y,value:e[y],valueSpec:a[y],style:h,styleSpec:i}):[new qt(y,e[y],`unknown property "${y}"`)])}return p}function pm(r){const e=r.value;let i=[];if(!e)return i;const a=vr(e);if(a!=="object")return i=i.concat([new qt("light-3d",e,`object expected, ${a} found`)]),i;const h=r.styleSpec,p=h["light-3d"],m=r.key,y=r.style,b=r.style.lights;for(const A of["type","id"])if(!(A in e))return i=i.concat([new qt("light-3d",e,`missing property ${A} on light`)]),i;if(e.type&&b)for(let A=0;A<r.arrayIndex;A++){const P=Un(e.type),R=b[A];Un(R.type)===P&&i.push(new qt(m,e.id,`duplicate light type "${e.type}", previously defined at line ${R.id.__line__}`))}const E=`properties_light_${e.type}`;if(!(E in h))return i=i.concat([new qt("light-3d",e,`Invalid light type ${e.type}`)]),i;const C=h[E];for(const A in e)if(A==="properties"){const P=e[A],R=vr(P);if(R!=="object")return i=i.concat([new qt("properties",P,`object expected, ${R} found`)]),i;for(const z in P)i=i.concat(C[z]?Li({key:z,value:P[z],valueSpec:C[z],style:y,styleSpec:h}):[new Wo(r.key,P[z],`unknown property "${z}"`)])}else{const P=A.match(/^(.*)-transition$/);i=i.concat(P&&p[P[1]]&&p[P[1]].transition?Li({key:A,value:e[A],valueSpec:h.transition,style:y,styleSpec:h}):p[A]?Li({key:A,value:e[A],valueSpec:p[A],style:y,styleSpec:h}):[new Wo(A,e[A],`unknown property "${A}"`)])}return i}function mm(r){const e=r.value,i=r.key,a=r.style,h=r.styleSpec,p=h.terrain;let m=[];const y=vr(e);if(e===void 0||y==="null")return m;if(y!=="object")return m=m.concat([new qt("terrain",e,`object expected, ${y} found`)]),m;for(const b in e){const E=b.match(/^(.*)-transition$/);m=m.concat(E&&p[E[1]]&&p[E[1]].transition?Li({key:b,value:e[b],valueSpec:h.transition,style:a,styleSpec:h}):p[b]?Li({key:b,value:e[b],valueSpec:p[b],style:a,styleSpec:h}):[new Wo(b,e[b],`unknown property "${b}"`)])}if(e.source){const b=a.sources&&a.sources[e.source],E=b&&Un(b.type);b?E!=="raster-dem"&&m.push(new qt(i,e.source,`terrain cannot be used with a source of type ${String(E)}, it only be used with a "raster-dem" source type`)):m.push(new qt(i,e.source,`source "${e.source}" not found`))}else m.push(new qt(i,e,'terrain is missing required property "source"'));return m}function gm(r){const e=r.value,i=r.style,a=r.styleSpec,h=a.fog;let p=[];const m=vr(e);if(e===void 0)return p;if(m!=="object")return p=p.concat([new qt("fog",e,`object expected, ${m} found`)]),p;for(const y in e){const b=y.match(/^(.*)-transition$/);p=p.concat(b&&h[b[1]]&&h[b[1]].transition?Li({key:y,value:e[y],valueSpec:a.transition,style:i,styleSpec:a}):h[y]?Li({key:y,value:e[y],valueSpec:h[y],style:i,styleSpec:a}):[new Wo(y,e[y],`unknown property "${y}"`)])}return p}const Wd={"*":()=>[],array:Hy,boolean:function(r){const e=r.value,i=r.key,a=vr(e);return a!=="boolean"?[new qt(i,e,`boolean expected, ${a} found`)]:[]},number:cm,color:function(r){const e=r.key,i=r.value,a=vr(i);return a!=="string"?[new qt(e,i,`color expected, ${a} found`)]:Ur(i)===null?[new qt(e,i,`color expected, "${i}" found`)]:[]},enum:Jl,filter:dm,function:um,layer:tv,object:Xo,source:rv,model:iv,light:fm,"light-3d":pm,terrain:mm,fog:gm,string:Wc,formatted:function(r){return Wc(r).length===0?[]:Kl(r)},resolvedImage:function(r){return Wc(r).length===0?[]:Kl(r)},projection:function(r){const e=r.value,i=r.styleSpec,a=i.projection,h=r.style;let p=[];const m=vr(e);if(m==="object")for(const y in e)p=p.concat(Li({key:y,value:e[y],valueSpec:a[y],style:h,styleSpec:i}));else m!=="string"&&(p=p.concat([new qt("projection",e,`object or string expected, ${m} found`)]));return p},import:function(r){const{value:e,styleSpec:i}=r,{data:a,...h}=e;Object.defineProperty(h,"__line__",{value:e.__line__,enumerable:!1});let p=Xo(yo({},r,{value:h,valueSpec:i.import}));return Un(h.id)===""&&p.push(new qt(`${r.key}.id`,h,"import id can't be an empty string")),a&&(p=p.concat(ov(a,i,{key:`${r.key}.data`}))),p}};function Li(r,e=!1){const i=r.value,a=r.valueSpec,h=r.styleSpec;if(a.expression&&Ld(Un(i)))return um(r);if(a.expression&&Nd(as(i)))return Kl(r);if(a.type&&Wd[a.type]){const p=Wd[a.type](r);return e===!0&&p.length>0&&vr(r.value)==="array"?Kl(r):p}return Xo(yo({},r,{valueSpec:a.type?h[a.type]:a}))}function db(r){const e=r.value,i=r.key,a=Wc(r);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new qt(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new qt(i,e,'"glyphs" url must include a "{range}" token'))),a}function ov(r,e=Ge,i={}){return Li({key:i.key||"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:db,"*":()=>[]}})}function _m(r,e=Ge){return Ws(ov(r,e))}const fb=r=>Ws(ev(r)),pb=r=>Ws(_h(r));function Ws(r){return r.slice().sort((e,i)=>e.line&&i.line?e.line-i.line:0)}function sv(r,e){let i=!1;if(e&&e.length)for(const a of e)a instanceof Wo?mr(a.message):(r.fire(new $s(new Error(a.message))),i=!0);return i}var mb=ma,yl=3;function ma(r,e,i){var a=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;var h=new Int32Array(this.arrayBuffer);r=h[0],this.d=(e=h[1])+2*(i=h[2]);for(var p=0;p<this.d*this.d;p++){var m=h[yl+p],y=h[yl+p+1];a.push(m===y?null:h.subarray(m,y))}var b=h[yl+a.length+1];this.keys=h.subarray(h[yl+a.length],b),this.bboxes=h.subarray(b),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var E=0;E<this.d*this.d;E++)a.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=r,this.padding=i,this.scale=e/r,this.uid=0;var C=i/e*r;this.min=-C,this.max=r+C}ma.prototype.insert=function(r,e,i,a,h){this._forEachCell(e,i,a,h,this._insertCell,this.uid++),this.keys.push(r),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(h)},ma.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ma.prototype._insertCell=function(r,e,i,a,h,p){this.cells[h].push(p)},ma.prototype.query=function(r,e,i,a,h){var p=this.min,m=this.max;if(r<=p&&e<=p&&m<=i&&m<=a&&!h)return Array.prototype.slice.call(this.keys);var y=[];return this._forEachCell(r,e,i,a,this._queryCell,y,{},h),y},ma.prototype._queryCell=function(r,e,i,a,h,p,m,y){var b=this.cells[h];if(b!==null)for(var E=this.keys,C=this.bboxes,A=0;A<b.length;A++){var P=b[A];if(m[P]===void 0){var R=4*P;(y?y(C[R+0],C[R+1],C[R+2],C[R+3]):r<=C[R+2]&&e<=C[R+3]&&i>=C[R+0]&&a>=C[R+1])?(m[P]=!0,p.push(E[P])):m[P]=!1}}},ma.prototype._forEachCell=function(r,e,i,a,h,p,m,y){for(var b=this._convertToCellCoord(r),E=this._convertToCellCoord(e),C=this._convertToCellCoord(i),A=this._convertToCellCoord(a),P=b;P<=C;P++)for(var R=E;R<=A;R++){var z=this.d*R+P;if((!y||y(this._convertFromCellCoord(P),this._convertFromCellCoord(R),this._convertFromCellCoord(P+1),this._convertFromCellCoord(R+1)))&&h.call(this,r,e,i,a,z,p,m,y))return}},ma.prototype._convertFromCellCoord=function(r){return(r-this.padding)/this.scale},ma.prototype._convertToCellCoord=function(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))},ma.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var r=this.cells,e=yl+this.cells.length+1+1,i=0,a=0;a<this.cells.length;a++)i+=this.cells[a].length;var h=new Int32Array(e+i+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var p=e,m=0;m<r.length;m++){var y=r[m];h[yl+m]=p,h.set(y,p),p+=y.length}return h[yl+r.length]=p,h.set(this.keys,p),h[yl+r.length+1]=p+=this.keys.length,h.set(this.bboxes,p),p+=this.bboxes.length,h.buffer};var Hc=J(mb);const Hd={};function Zt(r,e,i={}){Object.defineProperty(r,"_classRegistryKey",{value:e,writeable:!1}),Hd[e]={klass:r,omit:i.omit||[]}}Zt(Object,"Object"),Hc.serialize=function(r,e){const i=r.toArrayBuffer();return e&&e.add(i),{buffer:i}},Hc.deserialize=function(r){return new Hc(r.buffer)},Object.defineProperty(Hc,"name",{value:"Grid"}),Zt(Hc,"Grid"),Zt(En,"Color"),Zt(Error,"Error"),Zt($i,"Formatted"),Zt(Vs,"FormattedSection"),Zt(Ii,"AJAXError"),Zt(Yi,"ResolvedImage"),Zt(Fd,"StylePropertyFunction"),Zt(lm,"StyleExpression",{omit:["_evaluator"]}),Zt(mh,"ZoomDependentExpression"),Zt(ph,"ZoomConstantExpression"),Zt(gi,"CompoundExpression",{omit:["_evaluate"]});for(const r in uh)Hd[uh[r]._classRegistryKey]||Zt(uh[r],`Expression${r}`);function _(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function c(r){return self.ImageBitmap&&r instanceof ImageBitmap}function f(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp)return r;if(_(r)||c(r))return e&&e.add(r),r;if(ArrayBuffer.isView(r)){const i=r;return e&&e.add(i.buffer),i}if(r instanceof ImageData)return e&&e.add(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const a of r)i.push(f(a,e));return i}if(r instanceof Map){const i={$name:"Map"};for(const[a,h]of r.entries())i[a]=f(h);return i}if(typeof r=="object"){const i=r.constructor,a=i._classRegistryKey;if(!a)throw new Error(`can't serialize object of unregistered class ${a}`);const h=i.serialize?i.serialize(r,e):{};if(!i.serialize){for(const p in r)r.hasOwnProperty(p)&&(Hd[a].omit.indexOf(p)>=0||(h[p]=f(r[p],e)));r instanceof Error&&(h.message=r.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(h.$name=a),h}throw new Error("can't serialize object of type "+typeof r)}function v(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||_(r)||c(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(v);if(typeof r=="object"){const e=r.$name||"Object";if(e==="Map"){const h=new Map;for(const p of Object.keys(r))p!=="$name"&&h.set(p,v(r[p]));return h}const{klass:i}=Hd[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(r);const a=Object.create(i.prototype);for(const h of Object.keys(r))h!=="$name"&&(a[h]=v(r[h]));return a}throw new Error("can't deserialize object of type "+typeof r)}const w={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519,"CJK Unified Ideographs Extension B":r=>r>=131072&&r<=173791};function S(r){for(const e of r)if(L(e.charCodeAt(0)))return!0;return!1}function M(r){for(const e of r)if(!k(e.charCodeAt(0)))return!1;return!0}function k(r){return!(w.Arabic(r)||w["Arabic Supplement"](r)||w["Arabic Extended-A"](r)||w["Arabic Presentation Forms-A"](r)||w["Arabic Presentation Forms-B"](r))}function L(r){return!(r!==746&&r!==747&&(r<4352||!(w["Bopomofo Extended"](r)||w.Bopomofo(r)||w["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||w["CJK Compatibility Ideographs"](r)||w["CJK Compatibility"](r)||w["CJK Radicals Supplement"](r)||w["CJK Strokes"](r)||!(!w["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||w["CJK Unified Ideographs Extension A"](r)||w["CJK Unified Ideographs"](r)||w["Enclosed CJK Letters and Months"](r)||w["Hangul Compatibility Jamo"](r)||w["Hangul Jamo Extended-A"](r)||w["Hangul Jamo Extended-B"](r)||w["Hangul Jamo"](r)||w["Hangul Syllables"](r)||w.Hiragana(r)||w["Ideographic Description Characters"](r)||w.Kanbun(r)||w["Kangxi Radicals"](r)||w["Katakana Phonetic Extensions"](r)||w.Katakana(r)&&r!==12540||!(!w["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!w["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||w["Unified Canadian Aboriginal Syllabics"](r)||w["Unified Canadian Aboriginal Syllabics Extended"](r)||w["Vertical Forms"](r)||w["Yijing Hexagram Symbols"](r)||w["Yi Syllables"](r)||w["Yi Radicals"](r))))}function F(r){return!(L(r)||function(e){return!!(w["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||w["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||w["Letterlike Symbols"](e)||w["Number Forms"](e)||w["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||w["Control Pictures"](e)&&e!==9251||w["Optical Character Recognition"](e)||w["Enclosed Alphanumerics"](e)||w["Geometric Shapes"](e)||w["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||w["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||w["CJK Symbols and Punctuation"](e)||w.Katakana(e)||w["Private Use Area"](e)||w["CJK Compatibility Forms"](e)||w["Small Form Variants"](e)||w["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function $(r){return r>=1424&&r<=2303||w["Arabic Presentation Forms-A"](r)||w["Arabic Presentation Forms-B"](r)}function Z(r,e){return!(!e&&$(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||w.Khmer(r))}function K(r){for(const e of r)if($(e.charCodeAt(0)))return!0;return!1}const ee="deferred",ne="loading",oe="loaded";let ie=null,re="unavailable",de=null;const be=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(re="error"),ie&&ie(r)};function Ee(){ce.fire(new Po("pluginStateChange",{pluginStatus:re,pluginURL:de}))}const ce=new Ri,fe=function(){return re},Ce=function(){if(re!==ee||!de)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");re=ne,Ee(),de&&ii({url:de},r=>{r?be(r):(re=oe,Ee())})},Oe={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>re===oe||Oe.applyArabicShaping!=null,isLoading:()=>re===ne,setState(r){re=r.pluginStatus,de=r.pluginURL},isParsed:()=>Oe.applyArabicShaping!=null&&Oe.processBidirectionalText!=null&&Oe.processStyledBidirectionalText!=null,getPluginURL:()=>de};class Ae{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,a){for(const h of i)if(!Z(h.charCodeAt(0),a))return!1;return!0}(e,Oe.isLoaded())}}class Le{constructor(e,i,a,h){this.property=e,this.value=i,this.expression=function(p,m,y,b){if(Ld(p))return new Fd(p,m);if(Nd(p)||Array.isArray(p)&&p.length>0){const E=gh(p,m,y,b);if(E.result==="error")throw new Error(E.value.map(C=>`${C.key}: ${C.message}`).join(", "));return E.value}{let E=p;return typeof p=="string"&&m.type==="color"&&(E=En.parse(p)),{kind:"constant",isConfigDependent:!1,evaluate:()=>E}}}(i===void 0?e.specification.default:i,e.specification,a,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a){return this.property.possiblyEvaluate(this,e,i,a)}}class ut{constructor(e,i,a){this.property=e,this.value=new Le(e,void 0,i,a)}transitioned(e,i){return new Je(this.property,this.value,i,or({},e.transition,this.transition),e.now)}untransitioned(){return new Je(this.property,this.value,null,{},0)}}class He{constructor(e,i,a){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=a,this.isConfigDependent=!1}getValue(e){return cn(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ut(this._values[e].property,this._scope,this._options)),this._values[e].value=new Le(this._values[e].property,i===null?void 0:cn(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,i){i&&(this._options=i);const a=this._properties.properties;if(e)for(const h in e){const p=e[h];if(Tr(h,"-transition")){const m=h.slice(0,-11);a[m]&&this.setTransition(m,p)}else a[h]&&this.setValue(h,p)}}getTransition(e){return cn(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ut(this._values[e].property)),this._values[e].transition=cn(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const h=this.getTransition(i);h!==void 0&&(e[`${i}-transition`]=h)}return e}transitioned(e,i){const a=new Be(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].transitioned(e,i._values[h]);return a}untransitioned(){const e=new Be(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class Je{constructor(e,i,a,h,p){const m=h.delay||0,y=h.duration||0;p=p||0,this.property=e,this.value=i,this.begin=p+m,this.end=this.begin+y,e.specification.transition&&(h.delay||h.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const h=e.now||0,p=this.value.possiblyEvaluate(e,i,a),m=this.prior;if(m){if(h>this.end)return this.prior=null,p;if(this.value.isDataDriven())return this.prior=null,p;if(h<this.begin)return m.possiblyEvaluate(e,i,a);{const y=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,i,a),p,It(y))}}return p}}class Be{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const h=new dt(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,i,a);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class lt{constructor(e,i,a){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=a,this.isConfigDependent=!1}getValue(e){return cn(this._values[e].value)}setValue(e,i){this._values[e]=new Le(this._values[e].property,i===null?void 0:cn(i),this._scope,this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a){const h=new dt(this._properties);for(const p of Object.keys(this._values))h._values[p]=this._values[p].possiblyEvaluate(e,i,a);return h}}class Qe{constructor(e,i,a){this.property=e,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,h){return this.property.evaluate(this.value,this.parameters,e,i,a,h)}}class dt{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ye{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const h=oh[this.specification.type];return h?h(e,i,a):e}}class $e{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,h){return new Qe(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},a,h)}:e.expression,i)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Qe(this,{kind:"constant",value:void 0},e.parameters);const h=oh[this.specification.type];return h?new Qe(this,{kind:"constant",value:h(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,h,p,m){return e.kind==="constant"?e.value:e.evaluate(i,a,h,p,m)}}class St{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,h){return!!e.expression.evaluate(i,null,{},a,h)}interpolate(){return!1}}class pt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Ae(0,{});for(const a in e){const h=e[a];h.specification.overridable&&this.overridableProperties.push(a);const p=this.defaultPropertyValues[a]=new Le(h,void 0),m=this.defaultTransitionablePropertyValues[a]=new ut(h);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=p.possiblyEvaluate(i)}}}Zt($e,"DataDrivenProperty"),Zt(ye,"DataConstantProperty"),Zt(St,"ColorRampProperty");const Xt="";function Bt(r,e){return e?`${r}${Xt}${e}`:r}const nr="-transition";class Wt extends Ri{constructor(e,i,a,h){if(super(),this.id=e.id,this.fqid=Bt(this.id,a),this.type=e.type,this.scope=a,this.options=h,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),e.slot&&(this.slot=e.slot),i.layout&&(this._unevaluatedLayout=new lt(i.layout,this.scope,h),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),i.paint)){this._transitionablePaint=new He(i.paint,this.scope,h);for(const p in e.paint)this.setPaintProperty(p,e.paint[p],{validate:!1});for(const p in e.layout)this.setLayoutProperty(p,e.layout[p],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new dt(i.paint)}}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,a={}){if(i!=null&&this._validate(pb,`layers.${this.id}.layout.${e}`,e,i,a))return;if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const h=this._unevaluatedLayout;h._properties.properties[e]&&(h.setValue(e,i),this.isConfigDependent=this.isConfigDependent||h.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return Tr(e,nr)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,a={}){if(i!=null&&this._validate(fb,`layers.${this.id}.paint.${e}`,e,i,a))return!1;const h=this._transitionablePaint,p=h._properties.properties;if(Tr(e,nr)){const P=e.slice(0,-11);return p[P]&&h.setTransition(P,i||void 0),!1}if(!p[e])return!1;const m=h._values[e],y=m.value.isDataDriven(),b=m.value;h.setValue(e,i),this.isConfigDependent=this.isConfigDependent||h.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);const E=h._values[e].value,C=E.isDataDriven(),A=Tr(e,"pattern")||e==="line-dasharray";return C||y||A||this._handleOverridablePaintPropertyUpdate(e,b,E)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){return Xr({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,i)=>!(e===void 0||i==="layout"&&!Object.keys(e).length||i==="paint"&&!Object.keys(e).length))}_validate(e,i,a,h,p={}){return(!p||p.validate!==!1)&&sv(this,e.call(_m,{key:i,layerType:this.type,objectKey:a,value:h,styleSpec:Ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Qe&&ml(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ud(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}const cr={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ur{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class er{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function tr(r,e=1){let i=0,a=0;return{members:r.map(h=>{const p=cr[h.type].BYTES_PER_ELEMENT,m=i=Yr(i,Math.max(e,p)),y=h.components||1;return a=Math.max(a,p),i+=p*y,{name:h.name,type:h.type,components:y,offset:m}}),size:Yr(i,Math.max(a,e)),alignment:e}}function Yr(r,e){return Math.ceil(r/e)*e}class Cr extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const h=2*e;return this.int16[h+0]=i,this.int16[h+1]=a,e}}Cr.prototype.bytesPerElement=4,Zt(Cr,"StructArrayLayout2i4");class kn extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const p=3*e;return this.int16[p+0]=i,this.int16[p+1]=a,this.int16[p+2]=h,e}}kn.prototype.bytesPerElement=6,Zt(kn,"StructArrayLayout3i6");class gn extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,h)}emplace(e,i,a,h,p){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=a,this.int16[m+2]=h,this.int16[m+3]=p,e}}gn.prototype.bytesPerElement=8,Zt(gn,"StructArrayLayout4i8");class Lo extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,h,p)}emplace(e,i,a,h,p,m){const y=5*e;return this.int16[y+0]=i,this.int16[y+1]=a,this.int16[y+2]=h,this.int16[y+3]=p,this.int16[y+4]=m,e}}Lo.prototype.bytesPerElement=10,Zt(Lo,"StructArrayLayout5i10");class As extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,h,p,m,y)}emplace(e,i,a,h,p,m,y,b){const E=6*e,C=12*e,A=3*e;return this.int16[E+0]=i,this.int16[E+1]=a,this.uint8[C+4]=h,this.uint8[C+5]=p,this.uint8[C+6]=m,this.uint8[C+7]=y,this.float32[A+2]=b,e}}As.prototype.bytesPerElement=12,Zt(As,"StructArrayLayout2i4ub1f12");class un extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,h)}emplace(e,i,a,h,p){const m=4*e;return this.float32[m+0]=i,this.float32[m+1]=a,this.float32[m+2]=h,this.float32[m+3]=p,e}}un.prototype.bytesPerElement=16,Zt(un,"StructArrayLayout4f16");class Jr extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,h,p)}emplace(e,i,a,h,p,m){const y=6*e,b=3*e;return this.uint16[y+0]=i,this.uint16[y+1]=a,this.uint16[y+2]=h,this.uint16[y+3]=p,this.float32[b+2]=m,e}}Jr.prototype.bytesPerElement=12,Zt(Jr,"StructArrayLayout4ui1f12");class rn extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,h)}emplace(e,i,a,h,p){const m=4*e;return this.uint16[m+0]=i,this.uint16[m+1]=a,this.uint16[m+2]=h,this.uint16[m+3]=p,e}}rn.prototype.bytesPerElement=8,Zt(rn,"StructArrayLayout4ui8");class Vn extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,h,p,m)}emplace(e,i,a,h,p,m,y){const b=6*e;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=h,this.int16[b+3]=p,this.int16[b+4]=m,this.int16[b+5]=y,e}}Vn.prototype.bytesPerElement=12,Zt(Vn,"StructArrayLayout6i12");class Qi extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p,m,y,b,E,C,A,P){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,a,h,p,m,y,b,E,C,A,P)}emplace(e,i,a,h,p,m,y,b,E,C,A,P,R){const z=12*e;return this.int16[z+0]=i,this.int16[z+1]=a,this.int16[z+2]=h,this.int16[z+3]=p,this.uint16[z+4]=m,this.uint16[z+5]=y,this.uint16[z+6]=b,this.uint16[z+7]=E,this.int16[z+8]=C,this.int16[z+9]=A,this.int16[z+10]=P,this.int16[z+11]=R,e}}Qi.prototype.bytesPerElement=24,Zt(Qi,"StructArrayLayout4i4ui4i24");class Rn extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,h,p,m)}emplace(e,i,a,h,p,m,y){const b=10*e,E=5*e;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=h,this.float32[E+2]=p,this.float32[E+3]=m,this.float32[E+4]=y,e}}Rn.prototype.bytesPerElement=20,Zt(Rn,"StructArrayLayout3i3f20");class uo extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}uo.prototype.bytesPerElement=4,Zt(uo,"StructArrayLayout1ul4");class zo extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const h=2*e;return this.uint16[h+0]=i,this.uint16[h+1]=a,e}}zo.prototype.bytesPerElement=4,Zt(zo,"StructArrayLayout2ui4");class ho extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p,m,y,b,E,C,A,P,R){const z=this.length;return this.resize(z+1),this.emplace(z,e,i,a,h,p,m,y,b,E,C,A,P,R)}emplace(e,i,a,h,p,m,y,b,E,C,A,P,R,z){const B=20*e,V=10*e;return this.int16[B+0]=i,this.int16[B+1]=a,this.int16[B+2]=h,this.int16[B+3]=p,this.int16[B+4]=m,this.float32[V+3]=y,this.float32[V+4]=b,this.float32[V+5]=E,this.float32[V+6]=C,this.int16[B+14]=A,this.uint32[V+8]=P,this.uint16[B+18]=R,this.uint16[B+19]=z,e}}ho.prototype.bytesPerElement=40,Zt(ho,"StructArrayLayout5i4f1i1ul2ui40");class ks extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,h,p,m,y)}emplace(e,i,a,h,p,m,y,b){const E=8*e;return this.int16[E+0]=i,this.int16[E+1]=a,this.int16[E+2]=h,this.int16[E+4]=p,this.int16[E+5]=m,this.int16[E+6]=y,this.int16[E+7]=b,e}}ks.prototype.bytesPerElement=16,Zt(ks,"StructArrayLayout3i2i2i16");class ja extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,h,p)}emplace(e,i,a,h,p,m){const y=4*e,b=8*e;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=h,this.int16[b+6]=p,this.int16[b+7]=m,e}}ja.prototype.bytesPerElement=16,Zt(ja,"StructArrayLayout2f1f2i16");class Hs extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,h)}emplace(e,i,a,h,p){const m=12*e,y=3*e;return this.uint8[m+0]=i,this.uint8[m+1]=a,this.float32[y+1]=h,this.float32[y+2]=p,e}}Hs.prototype.bytesPerElement=12,Zt(Hs,"StructArrayLayout2ub2f12");class vn extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const p=3*e;return this.uint16[p+0]=i,this.uint16[p+1]=a,this.uint16[p+2]=h,e}}vn.prototype.bytesPerElement=6,Zt(vn,"StructArrayLayout3ui6");class Zs extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p,m,y,b,E,C,A,P,R,z,B,V,Q,ae,le,he,me){const ve=this.length;return this.resize(ve+1),this.emplace(ve,e,i,a,h,p,m,y,b,E,C,A,P,R,z,B,V,Q,ae,le,he,me)}emplace(e,i,a,h,p,m,y,b,E,C,A,P,R,z,B,V,Q,ae,le,he,me,ve){const Pe=30*e,Ne=15*e,je=60*e;return this.int16[Pe+0]=i,this.int16[Pe+1]=a,this.int16[Pe+2]=h,this.float32[Ne+2]=p,this.float32[Ne+3]=m,this.uint16[Pe+8]=y,this.uint16[Pe+9]=b,this.uint32[Ne+5]=E,this.uint32[Ne+6]=C,this.uint32[Ne+7]=A,this.uint16[Pe+16]=P,this.uint16[Pe+17]=R,this.uint16[Pe+18]=z,this.float32[Ne+10]=B,this.float32[Ne+11]=V,this.uint8[je+48]=Q,this.uint8[je+49]=ae,this.uint8[je+50]=le,this.uint32[Ne+13]=he,this.int16[Pe+28]=me,this.uint8[je+58]=ve,e}}Zs.prototype.bytesPerElement=60,Zt(Zs,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class ga extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p,m,y,b,E,C,A,P,R,z,B,V,Q,ae,le,he,me,ve,Pe,Ne,je,Ye,Ve,ht,Ct,st,wt,ot){const Rt=this.length;return this.resize(Rt+1),this.emplace(Rt,e,i,a,h,p,m,y,b,E,C,A,P,R,z,B,V,Q,ae,le,he,me,ve,Pe,Ne,je,Ye,Ve,ht,Ct,st,wt,ot)}emplace(e,i,a,h,p,m,y,b,E,C,A,P,R,z,B,V,Q,ae,le,he,me,ve,Pe,Ne,je,Ye,Ve,ht,Ct,st,wt,ot,Rt){const Ht=20*e,Tt=40*e,hr=80*e;return this.float32[Ht+0]=i,this.float32[Ht+1]=a,this.int16[Tt+4]=h,this.int16[Tt+5]=p,this.int16[Tt+6]=m,this.int16[Tt+7]=y,this.int16[Tt+8]=b,this.int16[Tt+9]=E,this.int16[Tt+10]=C,this.int16[Tt+11]=A,this.int16[Tt+12]=P,this.uint16[Tt+13]=R,this.uint16[Tt+14]=z,this.uint16[Tt+15]=B,this.uint16[Tt+16]=V,this.uint16[Tt+17]=Q,this.uint16[Tt+18]=ae,this.uint16[Tt+19]=le,this.uint16[Tt+20]=he,this.uint16[Tt+21]=me,this.uint16[Tt+22]=ve,this.uint16[Tt+23]=Pe,this.uint16[Tt+24]=Ne,this.uint16[Tt+25]=je,this.uint16[Tt+26]=Ye,this.uint16[Tt+27]=Ve,this.uint32[Ht+14]=ht,this.float32[Ht+15]=Ct,this.float32[Ht+16]=st,this.float32[Ht+17]=wt,this.float32[Ht+18]=ot,this.uint8[hr+76]=Rt,e}}ga.prototype.bytesPerElement=80,Zt(ga,"StructArrayLayout2f9i15ui1ul4f1ub80");class $a extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}$a.prototype.bytesPerElement=4,Zt($a,"StructArrayLayout1f4");class vh extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,h,p)}emplace(e,i,a,h,p,m){const y=5*e;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=h,this.float32[y+3]=p,this.float32[y+4]=m,e}}vh.prototype.bytesPerElement=20,Zt(vh,"StructArrayLayout5f20");class gb extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,h,p,m,y)}emplace(e,i,a,h,p,m,y,b){const E=7*e;return this.float32[E+0]=i,this.float32[E+1]=a,this.float32[E+2]=h,this.float32[E+3]=p,this.float32[E+4]=m,this.float32[E+5]=y,this.float32[E+6]=b,e}}gb.prototype.bytesPerElement=28,Zt(gb,"StructArrayLayout7f28");class _b extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,i,a,h)}emplace(e,i,a,h,p){const m=6*e;return this.uint32[3*e+0]=i,this.uint16[m+2]=a,this.uint16[m+3]=h,this.uint16[m+4]=p,e}}_b.prototype.bytesPerElement=12,Zt(_b,"StructArrayLayout1ul3ui12");class ym extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}ym.prototype.bytesPerElement=2,Zt(ym,"StructArrayLayout1ui2");class xh extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const h=this.length;return this.resize(h+1),this.emplace(h,e,i,a)}emplace(e,i,a,h){const p=3*e;return this.float32[p+0]=i,this.float32[p+1]=a,this.float32[p+2]=h,e}}xh.prototype.bytesPerElement=12,Zt(xh,"StructArrayLayout3f12");class vm extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const h=2*e;return this.float32[h+0]=i,this.float32[h+1]=a,e}}vm.prototype.bytesPerElement=8,Zt(vm,"StructArrayLayout2f8");class yb extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p,m,y,b,E,C,A,P,R,z,B,V){const Q=this.length;return this.resize(Q+1),this.emplace(Q,e,i,a,h,p,m,y,b,E,C,A,P,R,z,B,V)}emplace(e,i,a,h,p,m,y,b,E,C,A,P,R,z,B,V,Q){const ae=16*e;return this.float32[ae+0]=i,this.float32[ae+1]=a,this.float32[ae+2]=h,this.float32[ae+3]=p,this.float32[ae+4]=m,this.float32[ae+5]=y,this.float32[ae+6]=b,this.float32[ae+7]=E,this.float32[ae+8]=C,this.float32[ae+9]=A,this.float32[ae+10]=P,this.float32[ae+11]=R,this.float32[ae+12]=z,this.float32[ae+13]=B,this.float32[ae+14]=V,this.float32[ae+15]=Q,e}}yb.prototype.bytesPerElement=64,Zt(yb,"StructArrayLayout16f64");class av extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,h,p,m,y){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,h,p,m,y)}emplace(e,i,a,h,p,m,y,b){const E=10*e,C=5*e;return this.uint16[E+0]=i,this.uint16[E+1]=a,this.uint16[E+2]=h,this.uint16[E+3]=p,this.float32[C+2]=m,this.float32[C+3]=y,this.float32[C+4]=b,e}}av.prototype.bytesPerElement=20,Zt(av,"StructArrayLayout4ui3f20");class vb extends er{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}vb.prototype.bytesPerElement=1,Zt(vb,"StructArrayLayout1ub1");class UI extends ur{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}UI.prototype.size=40;class xb extends ho{get(e){return new UI(this,e)}}Zt(xb,"CollisionBoxArray");class VI extends ur{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}VI.prototype.size=60;class GI extends Zs{get(e){return new VI(this,e)}}Zt(GI,"PlacedSymbolArray");class qI extends ur{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}qI.prototype.size=80;class WI extends ga{get(e){return new qI(this,e)}}Zt(WI,"SymbolInstanceArray");class HI extends $a{getoffsetX(e){return this.float32[1*e+0]}}Zt(HI,"GlyphOffsetArray");class ZI extends Cr{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Zt(ZI,"SymbolLineVertexArray");class XI extends ur{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}XI.prototype.size=12;class YI extends _b{get(e){return new XI(this,e)}}Zt(YI,"FeatureIndexArray");class QI extends zo{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Zt(QI,"FillExtrusionCentroidArray");const Vj=tr([{name:"a_pos",components:2,type:"Int16"}],4),Gj=tr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class Qn{constructor(e=[]){this.segments=e}_prepareSegment(e,i,a,h){let p=this.segments[this.segments.length-1];return e>Qn.MAX_VERTEX_ARRAY_LENGTH&&mr(`Max vertices per segment is ${Qn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!p||p.vertexLength+e>Qn.MAX_VERTEX_ARRAY_LENGTH||p.sortKey!==h)&&(p={vertexOffset:i,primitiveOffset:a,vertexLength:0,primitiveLength:0},h!==void 0&&(p.sortKey=h),this.segments.push(p)),p}prepareSegment(e,i,a,h){return this._prepareSegment(e,i.length,a.length,h)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,h){return new Qn([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:h,vaos:{},sortKey:0}])}}function KI(r,e){return 256*(r=rt(Math.floor(r),0,255))+rt(Math.floor(e),0,255)}Qn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Zt(Qn,"SegmentVector");const qj=tr([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Wj=tr([{name:"a_dash",components:4,type:"Uint16"}]);var lv={exports:{}},JI={exports:{}};(function(r){r.exports=function(e,i){var a,h,p,m,y,b,E,C;for(h=e.length-(a=3&e.length),p=i,y=3432918353,b=461845907,C=0;C<h;)E=255&e.charCodeAt(C)|(255&e.charCodeAt(++C))<<8|(255&e.charCodeAt(++C))<<16|(255&e.charCodeAt(++C))<<24,++C,p=27492+(65535&(m=5*(65535&(p=(p^=E=(65535&(E=(E=(65535&E)*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*b+(((E>>>16)*b&65535)<<16)&4294967295)<<13|p>>>19))+((5*(p>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(E=0,a){case 3:E^=(255&e.charCodeAt(C+2))<<16;case 2:E^=(255&e.charCodeAt(C+1))<<8;case 1:p^=E=(65535&(E=(E=(65535&(E^=255&e.charCodeAt(C)))*y+(((E>>>16)*y&65535)<<16)&4294967295)<<15|E>>>17))*b+(((E>>>16)*b&65535)<<16)&4294967295}return p^=e.length,p=2246822507*(65535&(p^=p>>>16))+((2246822507*(p>>>16)&65535)<<16)&4294967295,p=3266489909*(65535&(p^=p>>>13))+((3266489909*(p>>>16)&65535)<<16)&4294967295,(p^=p>>>16)>>>0}})(JI);var Hj=JI.exports,eA={exports:{}};(function(r){r.exports=function(e,i){for(var a,h=e.length,p=i^h,m=0;h>=4;)a=1540483477*(65535&(a=255&e.charCodeAt(m)|(255&e.charCodeAt(++m))<<8|(255&e.charCodeAt(++m))<<16|(255&e.charCodeAt(++m))<<24))+((1540483477*(a>>>16)&65535)<<16),p=1540483477*(65535&p)+((1540483477*(p>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),h-=4,++m;switch(h){case 3:p^=(255&e.charCodeAt(m+2))<<16;case 2:p^=(255&e.charCodeAt(m+1))<<8;case 1:p=1540483477*(65535&(p^=255&e.charCodeAt(m)))+((1540483477*(p>>>16)&65535)<<16)}return p=1540483477*(65535&(p^=p>>>13))+((1540483477*(p>>>16)&65535)<<16),(p^=p>>>15)>>>0}})(eA);var tA=Hj,Zj=eA.exports;lv.exports=tA,lv.exports.murmur3=tA,lv.exports.murmur2=Zj;var bb=J(lv.exports);class xm{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,a,h){this.ids.push(rA(e)),this.positions.push(i,a,h)}eachPosition(e,i){const a=rA(e);let h=0,p=this.ids.length-1;for(;h<p;){const m=h+p>>1;this.ids[m]>=a?p=m:h=m+1}for(;this.ids[h]===a;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(e,i){const a=new Float64Array(e.ids),h=new Uint32Array(e.positions);return wb(a,h,0,a.length-1),i&&(i.add(a.buffer),i.add(h.buffer)),{ids:a,positions:h}}static deserialize(e){const i=new xm;let a;i.ids=e.ids,i.positions=e.positions;for(const h of i.ids)h!==a&&i.uniqueIds.push(h),a=h;return i.indexed=!0,i}}function rA(r){const e=+r;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:bb(String(r))}function wb(r,e,i,a){for(;i<a;){const h=r[i+a>>1];let p=i-1,m=a+1;for(;;){do p++;while(r[p]<h);do m--;while(r[m]>h);if(p>=m)break;cv(r,p,m),cv(e,3*p,3*m),cv(e,3*p+1,3*m+1),cv(e,3*p+2,3*m+2)}m-i<a-m?(wb(r,e,i,m),i=m+1):(wb(r,e,m+1,a),a=m)}}function cv(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}Zt(xm,"FeaturePositionMap");class ec{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}}class uv extends ec{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Yo extends ec{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class bh extends ec{constructor(e){super(e),this.current=[0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class Eb extends ec{constructor(e){super(e),this.current=[0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class nA extends ec{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class iA extends ec{constructor(e){super(e),this.current=En.transparent}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const Xj=new Float32Array(16);class bm extends ec{constructor(e){super(e),this.current=Xj}set(e,i,a){if(this.fetchUniformLocation(e,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let h=1;h<16;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const Yj=new Float32Array(9),Qj=new Float32Array(4);class Sb extends ec{constructor(e){super(e),this.current=Qj}set(e,i,a){if(this.fetchUniformLocation(e,i)){for(let h=0;h<4;h++)if(a[h]!==this.current[h]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function Tb(r){return[KI(255*r.r,255*r.g),KI(255*r.b,255*r.a)]}class wm{constructor(e,i,a){this.value=e,this.uniformNames=i.map(h=>`u_${h}`),this.type=a}setUniform(e,i,a,h,p){i.set(e,p,h.constantOr(this.value))}getBinding(e,i){return this.type==="color"?new iA(e):new Yo(e)}}class Zd{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,i,a,h,p){const m=p==="u_pattern"||p==="u_dash"?this.pattern:p==="u_pixel_ratio"?this.pixelRatio:null;m&&i.set(e,p,m)}getBinding(e,i){return i==="u_pattern"||i==="u_dash"?new nA(e):new Yo(e)}}class tc{constructor(e,i,a,h){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(p=>({name:`a_${p}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,i,a,h,p,m,y){const b=this.paintVertexArray.length,E=this.expression.evaluate(new Ae(0,{brightness:m}),i,{},p,h,y);this.paintVertexArray.resize(e),this._setPaintValue(b,e,E)}updatePaintArray(e,i,a,h,p,m,y){const b=this.expression.evaluate({zoom:0,brightness:y},a,h,void 0,p);this._setPaintValue(e,i,b)}_setPaintValue(e,i,a){if(this.type==="color"){const h=Tb(a);for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,h[0],h[1])}else{for(let h=e;h<i;h++)this.paintVertexArray.emplace(h,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ua{constructor(e,i,a,h,p,m){this.expression=e,this.uniformNames=i.map(y=>`u_${y}_t`),this.type=a,this.useIntegerZoom=h,this.zoom=p,this.maxValue=0,this.paintVertexAttributes=i.map(y=>({name:`a_${y}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,i,a,h,p,m,y){const b=this.expression.evaluate(new Ae(this.zoom,{brightness:m}),i,{},p,h,y),E=this.expression.evaluate(new Ae(this.zoom+1,{brightness:m}),i,{},p,h,y),C=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(C,e,b,E)}updatePaintArray(e,i,a,h,p,m,y){const b=this.expression.evaluate({zoom:this.zoom,brightness:y},a,h,void 0,p),E=this.expression.evaluate({zoom:this.zoom+1,brightness:y},a,h,void 0,p);this._setPaintValue(e,i,b,E)}_setPaintValue(e,i,a,h){if(this.type==="color"){const p=Tb(a),m=Tb(h);for(let y=e;y<i;y++)this.paintVertexArray.emplace(y,p[0],p[1],m[0],m[1])}else{for(let p=e;p<i;p++)this.paintVertexArray.emplace(p,a,h);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,h,p){const m=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,y=rt(this.expression.interpolationFactor(m,this.zoom,this.zoom+1),0,1);i.set(e,p,y)}getBinding(e,i){return new Yo(e)}}class Zc{constructor(e,i,a,h,p){this.expression=e,this.layerId=p,this.paintVertexAttributes=(a==="array"?Wj:qj).members;for(let m=0;m<i.length;++m);this.paintVertexArray=new h}populatePaintArray(e,i,a){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,h,p,m,y){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(e,i,a,h){if(!h||!a)return;const p=h[a];if(!p)return;const{tl:m,br:y,pixelRatio:b}=p;for(let E=e;E<i;E++)this.paintVertexArray.emplace(E,m[0],m[1],y[0],y[1],b)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wh{constructor(e,i,a=()=>!0){this.binders={},this._buffers=[];const h=[];for(const p in e.paint._values){const m=e.paint.get(p);if(!a(p)||!(m instanceof Qe&&ml(m.property.specification)))continue;const y=Jj(p,e.type),b=m.value,E=m.property.specification.type,C=!!m.property.useIntegerZoom,A=p==="line-dasharray"||p.endsWith("pattern"),P=p==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(b.kind!=="constant"||P)if(b.kind==="source"||P||A){const R=oA(p,E,"source");this.binders[p]=A?new Zc(b,y,E,R,e.id):new tc(b,y,E,R),h.push(`/a_${p}`)}else{const R=oA(p,E,"composite");this.binders[p]=new Ua(b,y,E,C,i,R),h.push(`/z_${p}`)}else this.binders[p]=A?new Zd(b.value,y):new wm(b.value,y,E),h.push(`/u_${p}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof tc||i instanceof Ua?i.maxValue:0}populatePaintArrays(e,i,a,h,p,m,y){for(const b in this.binders){const E=this.binders[b];(E instanceof tc||E instanceof Ua||E instanceof Zc)&&E.populatePaintArray(e,i,a,h,p,m,y)}}setConstantPatternPositions(e){for(const i in this.binders){const a=this.binders[i];a instanceof Zd&&a.setConstantPatternPositions(e)}}updatePaintArrays(e,i,a,h,p,m,y,b){let E=!1;const C=Object.keys(e),A=C.length!==0,P=A?C:i.uniqueIds;for(const R in this.binders){const z=this.binders[R];if((z instanceof tc||z instanceof Ua||z instanceof Zc)&&(z.expression.isStateDependent===!0||z.expression.isLightConstant===!1)){const B=p.paint.get(R);z.expression=B.value;for(const V of P){const Q=e[V.toString()];i.eachPosition(V,(ae,le,he)=>{const me=h.feature(ae);z.updatePaintArray(le,he,me,Q,m,y,b)})}if(!A)for(const V of a.uniqueIds){const Q=e[V.toString()];a.eachPosition(V,(ae,le,he)=>{const me=h.feature(ae);z.updatePaintArray(le,he,me,Q,m,y,b)})}E=!0}}return E}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof wm||a instanceof Zd)&&e.push(...a.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof tc||a instanceof Ua||a instanceof Zc)for(let h=0;h<a.paintVertexAttributes.length;h++)e.push(a.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof wm||a instanceof Zd||a instanceof Ua)for(const h of a.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const h=this.binders[a];if(h instanceof wm||h instanceof Zd||h instanceof Ua)for(const p of h.uniformNames)i.push({name:p,property:a,binding:h.getBinding(e,p)})}return i}setUniforms(e,i,a,h,p){for(const{name:m,property:y,binding:b}of a)this.binders[y].setUniform(e,b,p,h.get(y),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof tc||i instanceof Ua||i instanceof Zc)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof tc||a instanceof Ua||a instanceof Zc)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof tc||i instanceof Ua||i instanceof Zc)&&i.destroy()}}}class Xc{constructor(e,i,a=()=>!0){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new wh(h,i,a);this.needsUpload=!1,this._featureMap=new xm,this._featureMapWithoutIds=new xm,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,a,h,p,m,y,b){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(e,i,h,p,m,y,b);i.id!==void 0?this._featureMap.add(i.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,h,p,m){for(const y of a)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,y,h,p,m||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Kj={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Jj(r,e){return Kj[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}const e6={"line-pattern":{source:Jr,composite:Jr},"fill-pattern":{source:Jr,composite:Jr},"fill-extrusion-pattern":{source:Jr,composite:Jr},"line-dasharray":{source:rn,composite:rn}},t6={color:{source:vm,composite:un},number:{source:$a,composite:vm}};function oA(r,e,i){const a=e6[r];return a&&a[i]||t6[e][i]}Zt(wm,"ConstantBinder"),Zt(Zd,"PatternConstantBinder"),Zt(tc,"SourceExpressionBinder"),Zt(Zc,"PatternCompositeBinder"),Zt(Ua,"CompositeExpressionBinder"),Zt(wh,"ProgramConfiguration",{omit:["_buffers"]}),Zt(Xc,"ProgramConfigurationSet");class Yc{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof hn?new hn(e.lng,e.lat):hn.convert(e),this}setSouthWest(e){return this._sw=e instanceof hn?new hn(e.lng,e.lat):hn.convert(e),this}extend(e){const i=this._sw,a=this._ne;let h,p;if(e instanceof hn)h=e,p=e;else{if(!(e instanceof Yc))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Yc.convert(e)):this.extend(hn.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(hn.convert(e)):this;if(h=e._sw,p=e._ne,!h||!p)return this}return i||a?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),a.lng=Math.max(p.lng,a.lng),a.lat=Math.max(p.lat,a.lat)):(this._sw=new hn(h.lng,h.lat),this._ne=new hn(p.lng,p.lat)),this}getCenter(){return new hn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new hn(this.getWest(),this.getNorth())}getSouthEast(){return new hn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=hn.convert(e);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&h}static convert(e){return!e||e instanceof Yc?e:new Yc(e)}}var Ki={},Ji={};Object.defineProperty(Ji,"__esModule",{value:!0}),Ji.setMatrixArrayType=function(r){Ji.ARRAY_TYPE=aA=r},Ji.toRadian=function(r){return r*n6},Ji.equals=function(r,e){return Math.abs(r-e)<=sA*Math.max(1,Math.abs(r),Math.abs(e))},Ji.RANDOM=Ji.ARRAY_TYPE=Ji.EPSILON=void 0;var sA=1e-6;Ji.EPSILON=sA;var aA=typeof Float32Array<"u"?Float32Array:Array;Ji.ARRAY_TYPE=aA;var r6=Math.random;Ji.RANDOM=r6;var n6=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var Kn={};function Cb(r){return Cb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Cb(r)}Object.defineProperty(Kn,"__esModule",{value:!0}),Kn.create=function(){var r=new Qc.ARRAY_TYPE(4);return Qc.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r},Kn.clone=function(r){var e=new Qc.ARRAY_TYPE(4);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e},Kn.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r},Kn.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r},Kn.fromValues=function(r,e,i,a){var h=new Qc.ARRAY_TYPE(4);return h[0]=r,h[1]=e,h[2]=i,h[3]=a,h},Kn.set=function(r,e,i,a,h){return r[0]=e,r[1]=i,r[2]=a,r[3]=h,r},Kn.transpose=function(r,e){if(r===e){var i=e[1];r[1]=e[2],r[2]=i}else r[0]=e[0],r[1]=e[2],r[2]=e[1],r[3]=e[3];return r},Kn.invert=function(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=i*p-h*a;return m?(r[0]=p*(m=1/m),r[1]=-a*m,r[2]=-h*m,r[3]=i*m,r):null},Kn.adjoint=function(r,e){var i=e[0];return r[0]=e[3],r[1]=-e[1],r[2]=-e[2],r[3]=i,r},Kn.determinant=function(r){return r[0]*r[3]-r[2]*r[1]},Kn.multiply=cA,Kn.rotate=function(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=Math.sin(i),b=Math.cos(i);return r[0]=a*b+p*y,r[1]=h*b+m*y,r[2]=a*-y+p*b,r[3]=h*-y+m*b,r},Kn.scale=function(r,e,i){var a=e[1],h=e[2],p=e[3],m=i[0],y=i[1];return r[0]=e[0]*m,r[1]=a*m,r[2]=h*y,r[3]=p*y,r},Kn.fromRotation=function(r,e){var i=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=i,r[2]=-i,r[3]=a,r},Kn.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=e[1],r},Kn.str=function(r){return"mat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},Kn.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3])},Kn.LDU=function(r,e,i,a){return r[2]=a[2]/a[0],i[0]=a[0],i[1]=a[1],i[3]=a[3]-r[2]*i[1],[r,e,i]},Kn.add=function(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r[3]=e[3]+i[3],r},Kn.subtract=uA,Kn.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},Kn.equals=function(r,e){var i=r[0],a=r[1],h=r[2],p=r[3],m=e[0],y=e[1],b=e[2],E=e[3];return Math.abs(i-m)<=Qc.EPSILON*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(a-y)<=Qc.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(h-b)<=Qc.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(p-E)<=Qc.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},Kn.multiplyScalar=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r},Kn.multiplyScalarAndAdd=function(r,e,i,a){return r[0]=e[0]+i[0]*a,r[1]=e[1]+i[1]*a,r[2]=e[2]+i[2]*a,r[3]=e[3]+i[3]*a,r},Kn.sub=Kn.mul=void 0;var Qc=function(r,e){if(r&&r.__esModule)return r;if(r===null||Cb(r)!=="object"&&typeof r!="function")return{default:r};var i=lA(void 0);if(i&&i.has(r))return i.get(r);var a={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in r)if(p!=="default"&&Object.prototype.hasOwnProperty.call(r,p)){var m=h?Object.getOwnPropertyDescriptor(r,p):null;m&&(m.get||m.set)?Object.defineProperty(a,p,m):a[p]=r[p]}return a.default=r,i&&i.set(r,a),a}(Ji);function lA(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(lA=function(a){return a?i:e})(r)}function cA(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=i[0],b=i[1],E=i[2],C=i[3];return r[0]=a*y+p*b,r[1]=h*y+m*b,r[2]=a*E+p*C,r[3]=h*E+m*C,r}function uA(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r[3]=e[3]-i[3],r}Kn.mul=cA,Kn.sub=uA;var ti={};function Mb(r){return Mb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Mb(r)}Object.defineProperty(ti,"__esModule",{value:!0}),ti.create=function(){var r=new vl.ARRAY_TYPE(6);return vl.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[4]=0,r[5]=0),r[0]=1,r[3]=1,r},ti.clone=function(r){var e=new vl.ARRAY_TYPE(6);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e},ti.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r},ti.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r},ti.fromValues=function(r,e,i,a,h,p){var m=new vl.ARRAY_TYPE(6);return m[0]=r,m[1]=e,m[2]=i,m[3]=a,m[4]=h,m[5]=p,m},ti.set=function(r,e,i,a,h,p,m){return r[0]=e,r[1]=i,r[2]=a,r[3]=h,r[4]=p,r[5]=m,r},ti.invert=function(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=e[4],y=e[5],b=i*p-a*h;return b?(r[0]=p*(b=1/b),r[1]=-a*b,r[2]=-h*b,r[3]=i*b,r[4]=(h*y-p*m)*b,r[5]=(a*m-i*y)*b,r):null},ti.determinant=function(r){return r[0]*r[3]-r[1]*r[2]},ti.multiply=dA,ti.rotate=function(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=e[4],b=e[5],E=Math.sin(i),C=Math.cos(i);return r[0]=a*C+p*E,r[1]=h*C+m*E,r[2]=a*-E+p*C,r[3]=h*-E+m*C,r[4]=y,r[5]=b,r},ti.scale=function(r,e,i){var a=e[1],h=e[2],p=e[3],m=e[4],y=e[5],b=i[0],E=i[1];return r[0]=e[0]*b,r[1]=a*b,r[2]=h*E,r[3]=p*E,r[4]=m,r[5]=y,r},ti.translate=function(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=e[4],b=e[5],E=i[0],C=i[1];return r[0]=a,r[1]=h,r[2]=p,r[3]=m,r[4]=a*E+p*C+y,r[5]=h*E+m*C+b,r},ti.fromRotation=function(r,e){var i=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=i,r[2]=-i,r[3]=a,r[4]=0,r[5]=0,r},ti.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=e[1],r[4]=0,r[5]=0,r},ti.fromTranslation=function(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=1,r[4]=e[0],r[5]=e[1],r},ti.str=function(r){return"mat2d("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+")"},ti.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],1)},ti.add=function(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r[3]=e[3]+i[3],r[4]=e[4]+i[4],r[5]=e[5]+i[5],r},ti.subtract=fA,ti.multiplyScalar=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*i,r[5]=e[5]*i,r},ti.multiplyScalarAndAdd=function(r,e,i,a){return r[0]=e[0]+i[0]*a,r[1]=e[1]+i[1]*a,r[2]=e[2]+i[2]*a,r[3]=e[3]+i[3]*a,r[4]=e[4]+i[4]*a,r[5]=e[5]+i[5]*a,r},ti.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]},ti.equals=function(r,e){var i=r[0],a=r[1],h=r[2],p=r[3],m=r[4],y=r[5],b=e[0],E=e[1],C=e[2],A=e[3],P=e[4],R=e[5];return Math.abs(i-b)<=vl.EPSILON*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(a-E)<=vl.EPSILON*Math.max(1,Math.abs(a),Math.abs(E))&&Math.abs(h-C)<=vl.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-A)<=vl.EPSILON*Math.max(1,Math.abs(p),Math.abs(A))&&Math.abs(m-P)<=vl.EPSILON*Math.max(1,Math.abs(m),Math.abs(P))&&Math.abs(y-R)<=vl.EPSILON*Math.max(1,Math.abs(y),Math.abs(R))},ti.sub=ti.mul=void 0;var vl=function(r,e){if(r&&r.__esModule)return r;if(r===null||Mb(r)!=="object"&&typeof r!="function")return{default:r};var i=hA(void 0);if(i&&i.has(r))return i.get(r);var a={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in r)if(p!=="default"&&Object.prototype.hasOwnProperty.call(r,p)){var m=h?Object.getOwnPropertyDescriptor(r,p):null;m&&(m.get||m.set)?Object.defineProperty(a,p,m):a[p]=r[p]}return a.default=r,i&&i.set(r,a),a}(Ji);function hA(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(hA=function(a){return a?i:e})(r)}function dA(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=e[4],b=e[5],E=i[0],C=i[1],A=i[2],P=i[3],R=i[4],z=i[5];return r[0]=a*E+p*C,r[1]=h*E+m*C,r[2]=a*A+p*P,r[3]=h*A+m*P,r[4]=a*R+p*z+y,r[5]=h*R+m*z+b,r}function fA(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r[3]=e[3]-i[3],r[4]=e[4]-i[4],r[5]=e[5]-i[5],r}ti.mul=dA,ti.sub=fA;var xn={};function Ib(r){return Ib=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ib(r)}Object.defineProperty(xn,"__esModule",{value:!0}),xn.create=function(){var r=new Xs.ARRAY_TYPE(9);return Xs.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r},xn.fromMat4=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],r},xn.clone=function(r){var e=new Xs.ARRAY_TYPE(9);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e},xn.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r},xn.fromValues=function(r,e,i,a,h,p,m,y,b){var E=new Xs.ARRAY_TYPE(9);return E[0]=r,E[1]=e,E[2]=i,E[3]=a,E[4]=h,E[5]=p,E[6]=m,E[7]=y,E[8]=b,E},xn.set=function(r,e,i,a,h,p,m,y,b,E){return r[0]=e,r[1]=i,r[2]=a,r[3]=h,r[4]=p,r[5]=m,r[6]=y,r[7]=b,r[8]=E,r},xn.identity=function(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},xn.transpose=function(r,e){if(r===e){var i=e[1],a=e[2],h=e[5];r[1]=e[3],r[2]=e[6],r[3]=i,r[5]=e[7],r[6]=a,r[7]=h}else r[0]=e[0],r[1]=e[3],r[2]=e[6],r[3]=e[1],r[4]=e[4],r[5]=e[7],r[6]=e[2],r[7]=e[5],r[8]=e[8];return r},xn.invert=function(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=e[4],y=e[5],b=e[6],E=e[7],C=e[8],A=C*m-y*E,P=-C*p+y*b,R=E*p-m*b,z=i*A+a*P+h*R;return z?(r[0]=A*(z=1/z),r[1]=(-C*a+h*E)*z,r[2]=(y*a-h*m)*z,r[3]=P*z,r[4]=(C*i-h*b)*z,r[5]=(-y*i+h*p)*z,r[6]=R*z,r[7]=(-E*i+a*b)*z,r[8]=(m*i-a*p)*z,r):null},xn.adjoint=function(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=e[4],y=e[5],b=e[6],E=e[7],C=e[8];return r[0]=m*C-y*E,r[1]=h*E-a*C,r[2]=a*y-h*m,r[3]=y*b-p*C,r[4]=i*C-h*b,r[5]=h*p-i*y,r[6]=p*E-m*b,r[7]=a*b-i*E,r[8]=i*m-a*p,r},xn.determinant=function(r){var e=r[3],i=r[4],a=r[5],h=r[6],p=r[7],m=r[8];return r[0]*(m*i-a*p)+r[1]*(-m*e+a*h)+r[2]*(p*e-i*h)},xn.multiply=mA,xn.translate=function(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=e[4],b=e[5],E=e[6],C=e[7],A=e[8],P=i[0],R=i[1];return r[0]=a,r[1]=h,r[2]=p,r[3]=m,r[4]=y,r[5]=b,r[6]=P*a+R*m+E,r[7]=P*h+R*y+C,r[8]=P*p+R*b+A,r},xn.rotate=function(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=e[4],b=e[5],E=e[6],C=e[7],A=e[8],P=Math.sin(i),R=Math.cos(i);return r[0]=R*a+P*m,r[1]=R*h+P*y,r[2]=R*p+P*b,r[3]=R*m-P*a,r[4]=R*y-P*h,r[5]=R*b-P*p,r[6]=E,r[7]=C,r[8]=A,r},xn.scale=function(r,e,i){var a=i[0],h=i[1];return r[0]=a*e[0],r[1]=a*e[1],r[2]=a*e[2],r[3]=h*e[3],r[4]=h*e[4],r[5]=h*e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r},xn.fromTranslation=function(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=1,r[5]=0,r[6]=e[0],r[7]=e[1],r[8]=1,r},xn.fromRotation=function(r,e){var i=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=i,r[2]=0,r[3]=-i,r[4]=a,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},xn.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=e[1],r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},xn.fromMat2d=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=0,r[3]=e[2],r[4]=e[3],r[5]=0,r[6]=e[4],r[7]=e[5],r[8]=1,r},xn.fromQuat=function(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=i+i,y=a+a,b=h+h,E=i*m,C=a*m,A=a*y,P=h*m,R=h*y,z=h*b,B=p*m,V=p*y,Q=p*b;return r[0]=1-A-z,r[3]=C-Q,r[6]=P+V,r[1]=C+Q,r[4]=1-E-z,r[7]=R-B,r[2]=P-V,r[5]=R+B,r[8]=1-E-A,r},xn.normalFromMat4=function(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=e[4],y=e[5],b=e[6],E=e[7],C=e[8],A=e[9],P=e[10],R=e[11],z=e[12],B=e[13],V=e[14],Q=e[15],ae=i*y-a*m,le=i*b-h*m,he=i*E-p*m,me=a*b-h*y,ve=a*E-p*y,Pe=h*E-p*b,Ne=C*B-A*z,je=C*V-P*z,Ye=C*Q-R*z,Ve=A*V-P*B,ht=A*Q-R*B,Ct=P*Q-R*V,st=ae*Ct-le*ht+he*Ve+me*Ye-ve*je+Pe*Ne;return st?(r[0]=(y*Ct-b*ht+E*Ve)*(st=1/st),r[1]=(b*Ye-m*Ct-E*je)*st,r[2]=(m*ht-y*Ye+E*Ne)*st,r[3]=(h*ht-a*Ct-p*Ve)*st,r[4]=(i*Ct-h*Ye+p*je)*st,r[5]=(a*Ye-i*ht-p*Ne)*st,r[6]=(B*Pe-V*ve+Q*me)*st,r[7]=(V*he-z*Pe-Q*le)*st,r[8]=(z*ve-B*he+Q*ae)*st,r):null},xn.projection=function(r,e,i){return r[0]=2/e,r[1]=0,r[2]=0,r[3]=0,r[4]=-2/i,r[5]=0,r[6]=-1,r[7]=1,r[8]=1,r},xn.str=function(r){return"mat3("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+")"},xn.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8])},xn.add=function(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r[3]=e[3]+i[3],r[4]=e[4]+i[4],r[5]=e[5]+i[5],r[6]=e[6]+i[6],r[7]=e[7]+i[7],r[8]=e[8]+i[8],r},xn.subtract=gA,xn.multiplyScalar=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*i,r},xn.multiplyScalarAndAdd=function(r,e,i,a){return r[0]=e[0]+i[0]*a,r[1]=e[1]+i[1]*a,r[2]=e[2]+i[2]*a,r[3]=e[3]+i[3]*a,r[4]=e[4]+i[4]*a,r[5]=e[5]+i[5]*a,r[6]=e[6]+i[6]*a,r[7]=e[7]+i[7]*a,r[8]=e[8]+i[8]*a,r},xn.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]},xn.equals=function(r,e){var i=r[0],a=r[1],h=r[2],p=r[3],m=r[4],y=r[5],b=r[6],E=r[7],C=r[8],A=e[0],P=e[1],R=e[2],z=e[3],B=e[4],V=e[5],Q=e[6],ae=e[7],le=e[8];return Math.abs(i-A)<=Xs.EPSILON*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(a-P)<=Xs.EPSILON*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(h-R)<=Xs.EPSILON*Math.max(1,Math.abs(h),Math.abs(R))&&Math.abs(p-z)<=Xs.EPSILON*Math.max(1,Math.abs(p),Math.abs(z))&&Math.abs(m-B)<=Xs.EPSILON*Math.max(1,Math.abs(m),Math.abs(B))&&Math.abs(y-V)<=Xs.EPSILON*Math.max(1,Math.abs(y),Math.abs(V))&&Math.abs(b-Q)<=Xs.EPSILON*Math.max(1,Math.abs(b),Math.abs(Q))&&Math.abs(E-ae)<=Xs.EPSILON*Math.max(1,Math.abs(E),Math.abs(ae))&&Math.abs(C-le)<=Xs.EPSILON*Math.max(1,Math.abs(C),Math.abs(le))},xn.sub=xn.mul=void 0;var Xs=function(r,e){if(r&&r.__esModule)return r;if(r===null||Ib(r)!=="object"&&typeof r!="function")return{default:r};var i=pA(void 0);if(i&&i.has(r))return i.get(r);var a={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in r)if(p!=="default"&&Object.prototype.hasOwnProperty.call(r,p)){var m=h?Object.getOwnPropertyDescriptor(r,p):null;m&&(m.get||m.set)?Object.defineProperty(a,p,m):a[p]=r[p]}return a.default=r,i&&i.set(r,a),a}(Ji);function pA(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(pA=function(a){return a?i:e})(r)}function mA(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=e[4],b=e[5],E=e[6],C=e[7],A=e[8],P=i[0],R=i[1],z=i[2],B=i[3],V=i[4],Q=i[5],ae=i[6],le=i[7],he=i[8];return r[0]=P*a+R*m+z*E,r[1]=P*h+R*y+z*C,r[2]=P*p+R*b+z*A,r[3]=B*a+V*m+Q*E,r[4]=B*h+V*y+Q*C,r[5]=B*p+V*b+Q*A,r[6]=ae*a+le*m+he*E,r[7]=ae*h+le*y+he*C,r[8]=ae*p+le*b+he*A,r}function gA(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r[3]=e[3]-i[3],r[4]=e[4]-i[4],r[5]=e[5]-i[5],r[6]=e[6]-i[6],r[7]=e[7]-i[7],r[8]=e[8]-i[8],r}xn.mul=mA,xn.sub=gA;var Ar={};function Ab(r){return Ab=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ab(r)}Object.defineProperty(Ar,"__esModule",{value:!0}),Ar.create=function(){var r=new hi.ARRAY_TYPE(16);return hi.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},Ar.clone=function(r){var e=new hi.ARRAY_TYPE(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},Ar.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},Ar.fromValues=function(r,e,i,a,h,p,m,y,b,E,C,A,P,R,z,B){var V=new hi.ARRAY_TYPE(16);return V[0]=r,V[1]=e,V[2]=i,V[3]=a,V[4]=h,V[5]=p,V[6]=m,V[7]=y,V[8]=b,V[9]=E,V[10]=C,V[11]=A,V[12]=P,V[13]=R,V[14]=z,V[15]=B,V},Ar.set=function(r,e,i,a,h,p,m,y,b,E,C,A,P,R,z,B,V){return r[0]=e,r[1]=i,r[2]=a,r[3]=h,r[4]=p,r[5]=m,r[6]=y,r[7]=b,r[8]=E,r[9]=C,r[10]=A,r[11]=P,r[12]=R,r[13]=z,r[14]=B,r[15]=V,r},Ar.identity=yA,Ar.transpose=function(r,e){if(r===e){var i=e[1],a=e[2],h=e[3],p=e[6],m=e[7],y=e[11];r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=i,r[6]=e[9],r[7]=e[13],r[8]=a,r[9]=p,r[11]=e[14],r[12]=h,r[13]=m,r[14]=y}else r[0]=e[0],r[1]=e[4],r[2]=e[8],r[3]=e[12],r[4]=e[1],r[5]=e[5],r[6]=e[9],r[7]=e[13],r[8]=e[2],r[9]=e[6],r[10]=e[10],r[11]=e[14],r[12]=e[3],r[13]=e[7],r[14]=e[11],r[15]=e[15];return r},Ar.invert=function(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=e[4],y=e[5],b=e[6],E=e[7],C=e[8],A=e[9],P=e[10],R=e[11],z=e[12],B=e[13],V=e[14],Q=e[15],ae=i*y-a*m,le=i*b-h*m,he=i*E-p*m,me=a*b-h*y,ve=a*E-p*y,Pe=h*E-p*b,Ne=C*B-A*z,je=C*V-P*z,Ye=C*Q-R*z,Ve=A*V-P*B,ht=A*Q-R*B,Ct=P*Q-R*V,st=ae*Ct-le*ht+he*Ve+me*Ye-ve*je+Pe*Ne;return st?(r[0]=(y*Ct-b*ht+E*Ve)*(st=1/st),r[1]=(h*ht-a*Ct-p*Ve)*st,r[2]=(B*Pe-V*ve+Q*me)*st,r[3]=(P*ve-A*Pe-R*me)*st,r[4]=(b*Ye-m*Ct-E*je)*st,r[5]=(i*Ct-h*Ye+p*je)*st,r[6]=(V*he-z*Pe-Q*le)*st,r[7]=(C*Pe-P*he+R*le)*st,r[8]=(m*ht-y*Ye+E*Ne)*st,r[9]=(a*Ye-i*ht-p*Ne)*st,r[10]=(z*ve-B*he+Q*ae)*st,r[11]=(A*he-C*ve-R*ae)*st,r[12]=(y*je-m*Ve-b*Ne)*st,r[13]=(i*Ve-a*je+h*Ne)*st,r[14]=(B*le-z*me-V*ae)*st,r[15]=(C*me-A*le+P*ae)*st,r):null},Ar.adjoint=function(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=e[4],y=e[5],b=e[6],E=e[7],C=e[8],A=e[9],P=e[10],R=e[11],z=e[12],B=e[13],V=e[14],Q=e[15];return r[0]=y*(P*Q-R*V)-A*(b*Q-E*V)+B*(b*R-E*P),r[1]=-(a*(P*Q-R*V)-A*(h*Q-p*V)+B*(h*R-p*P)),r[2]=a*(b*Q-E*V)-y*(h*Q-p*V)+B*(h*E-p*b),r[3]=-(a*(b*R-E*P)-y*(h*R-p*P)+A*(h*E-p*b)),r[4]=-(m*(P*Q-R*V)-C*(b*Q-E*V)+z*(b*R-E*P)),r[5]=i*(P*Q-R*V)-C*(h*Q-p*V)+z*(h*R-p*P),r[6]=-(i*(b*Q-E*V)-m*(h*Q-p*V)+z*(h*E-p*b)),r[7]=i*(b*R-E*P)-m*(h*R-p*P)+C*(h*E-p*b),r[8]=m*(A*Q-R*B)-C*(y*Q-E*B)+z*(y*R-E*A),r[9]=-(i*(A*Q-R*B)-C*(a*Q-p*B)+z*(a*R-p*A)),r[10]=i*(y*Q-E*B)-m*(a*Q-p*B)+z*(a*E-p*y),r[11]=-(i*(y*R-E*A)-m*(a*R-p*A)+C*(a*E-p*y)),r[12]=-(m*(A*V-P*B)-C*(y*V-b*B)+z*(y*P-b*A)),r[13]=i*(A*V-P*B)-C*(a*V-h*B)+z*(a*P-h*A),r[14]=-(i*(y*V-b*B)-m*(a*V-h*B)+z*(a*b-h*y)),r[15]=i*(y*P-b*A)-m*(a*P-h*A)+C*(a*b-h*y),r},Ar.determinant=function(r){var e=r[0],i=r[1],a=r[2],h=r[3],p=r[4],m=r[5],y=r[6],b=r[7],E=r[8],C=r[9],A=r[10],P=r[11],R=r[12],z=r[13],B=r[14],V=r[15];return(e*m-i*p)*(A*V-P*B)-(e*y-a*p)*(C*V-P*z)+(e*b-h*p)*(C*B-A*z)+(i*y-a*m)*(E*V-P*R)-(i*b-h*m)*(E*B-A*R)+(a*b-h*y)*(E*z-C*R)},Ar.multiply=vA,Ar.translate=function(r,e,i){var a,h,p,m,y,b,E,C,A,P,R,z,B=i[0],V=i[1],Q=i[2];return e===r?(r[12]=e[0]*B+e[4]*V+e[8]*Q+e[12],r[13]=e[1]*B+e[5]*V+e[9]*Q+e[13],r[14]=e[2]*B+e[6]*V+e[10]*Q+e[14],r[15]=e[3]*B+e[7]*V+e[11]*Q+e[15]):(h=e[1],p=e[2],m=e[3],y=e[4],b=e[5],E=e[6],C=e[7],A=e[8],P=e[9],R=e[10],z=e[11],r[0]=a=e[0],r[1]=h,r[2]=p,r[3]=m,r[4]=y,r[5]=b,r[6]=E,r[7]=C,r[8]=A,r[9]=P,r[10]=R,r[11]=z,r[12]=a*B+y*V+A*Q+e[12],r[13]=h*B+b*V+P*Q+e[13],r[14]=p*B+E*V+R*Q+e[14],r[15]=m*B+C*V+z*Q+e[15]),r},Ar.scale=function(r,e,i){var a=i[0],h=i[1],p=i[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*h,r[5]=e[5]*h,r[6]=e[6]*h,r[7]=e[7]*h,r[8]=e[8]*p,r[9]=e[9]*p,r[10]=e[10]*p,r[11]=e[11]*p,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},Ar.rotate=function(r,e,i,a){var h,p,m,y,b,E,C,A,P,R,z,B,V,Q,ae,le,he,me,ve,Pe,Ne,je,Ye,Ve,ht=a[0],Ct=a[1],st=a[2],wt=Math.hypot(ht,Ct,st);return wt<hi.EPSILON?null:(ht*=wt=1/wt,Ct*=wt,st*=wt,h=Math.sin(i),p=Math.cos(i),b=e[1],E=e[2],C=e[3],P=e[5],R=e[6],z=e[7],V=e[9],Q=e[10],ae=e[11],ve=ht*Ct*(m=1-p)-st*h,Pe=Ct*Ct*m+p,Ne=st*Ct*m+ht*h,je=ht*st*m+Ct*h,Ye=Ct*st*m-ht*h,Ve=st*st*m+p,r[0]=(y=e[0])*(le=ht*ht*m+p)+(A=e[4])*(he=Ct*ht*m+st*h)+(B=e[8])*(me=st*ht*m-Ct*h),r[1]=b*le+P*he+V*me,r[2]=E*le+R*he+Q*me,r[3]=C*le+z*he+ae*me,r[4]=y*ve+A*Pe+B*Ne,r[5]=b*ve+P*Pe+V*Ne,r[6]=E*ve+R*Pe+Q*Ne,r[7]=C*ve+z*Pe+ae*Ne,r[8]=y*je+A*Ye+B*Ve,r[9]=b*je+P*Ye+V*Ve,r[10]=E*je+R*Ye+Q*Ve,r[11]=C*je+z*Ye+ae*Ve,e!==r&&(r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r)},Ar.rotateX=function(r,e,i){var a=Math.sin(i),h=Math.cos(i),p=e[4],m=e[5],y=e[6],b=e[7],E=e[8],C=e[9],A=e[10],P=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=p*h+E*a,r[5]=m*h+C*a,r[6]=y*h+A*a,r[7]=b*h+P*a,r[8]=E*h-p*a,r[9]=C*h-m*a,r[10]=A*h-y*a,r[11]=P*h-b*a,r},Ar.rotateY=function(r,e,i){var a=Math.sin(i),h=Math.cos(i),p=e[0],m=e[1],y=e[2],b=e[3],E=e[8],C=e[9],A=e[10],P=e[11];return e!==r&&(r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*h-E*a,r[1]=m*h-C*a,r[2]=y*h-A*a,r[3]=b*h-P*a,r[8]=p*a+E*h,r[9]=m*a+C*h,r[10]=y*a+A*h,r[11]=b*a+P*h,r},Ar.rotateZ=function(r,e,i){var a=Math.sin(i),h=Math.cos(i),p=e[0],m=e[1],y=e[2],b=e[3],E=e[4],C=e[5],A=e[6],P=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=p*h+E*a,r[1]=m*h+C*a,r[2]=y*h+A*a,r[3]=b*h+P*a,r[4]=E*h-p*a,r[5]=C*h-m*a,r[6]=A*h-y*a,r[7]=P*h-b*a,r},Ar.fromTranslation=function(r,e){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=e[0],r[13]=e[1],r[14]=e[2],r[15]=1,r},Ar.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},Ar.fromRotation=function(r,e,i){var a,h,p,m=i[0],y=i[1],b=i[2],E=Math.hypot(m,y,b);return E<hi.EPSILON?null:(m*=E=1/E,y*=E,b*=E,a=Math.sin(e),h=Math.cos(e),r[0]=m*m*(p=1-h)+h,r[1]=y*m*p+b*a,r[2]=b*m*p-y*a,r[3]=0,r[4]=m*y*p-b*a,r[5]=y*y*p+h,r[6]=b*y*p+m*a,r[7]=0,r[8]=m*b*p+y*a,r[9]=y*b*p-m*a,r[10]=b*b*p+h,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r)},Ar.fromXRotation=function(r,e){var i=Math.sin(e),a=Math.cos(e);return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=a,r[6]=i,r[7]=0,r[8]=0,r[9]=-i,r[10]=a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},Ar.fromYRotation=function(r,e){var i=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=0,r[2]=-i,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=i,r[9]=0,r[10]=a,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},Ar.fromZRotation=function(r,e){var i=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=i,r[2]=0,r[3]=0,r[4]=-i,r[5]=a,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},Ar.fromRotationTranslation=xA,Ar.fromQuat2=function(r,e){var i=new hi.ARRAY_TYPE(3),a=-e[0],h=-e[1],p=-e[2],m=e[3],y=e[4],b=e[5],E=e[6],C=e[7],A=a*a+h*h+p*p+m*m;return A>0?(i[0]=2*(y*m+C*a+b*p-E*h)/A,i[1]=2*(b*m+C*h+E*a-y*p)/A,i[2]=2*(E*m+C*p+y*h-b*a)/A):(i[0]=2*(y*m+C*a+b*p-E*h),i[1]=2*(b*m+C*h+E*a-y*p),i[2]=2*(E*m+C*p+y*h-b*a)),xA(r,e,i),r},Ar.getTranslation=function(r,e){return r[0]=e[12],r[1]=e[13],r[2]=e[14],r},Ar.getScaling=bA,Ar.getRotation=function(r,e){var i=new hi.ARRAY_TYPE(3);bA(i,e);var a=1/i[0],h=1/i[1],p=1/i[2],m=e[0]*a,y=e[1]*h,b=e[2]*p,E=e[4]*a,C=e[5]*h,A=e[6]*p,P=e[8]*a,R=e[9]*h,z=e[10]*p,B=m+C+z,V=0;return B>0?(V=2*Math.sqrt(B+1),r[3]=.25*V,r[0]=(A-R)/V,r[1]=(P-b)/V,r[2]=(y-E)/V):m>C&&m>z?(V=2*Math.sqrt(1+m-C-z),r[3]=(A-R)/V,r[0]=.25*V,r[1]=(y+E)/V,r[2]=(P+b)/V):C>z?(V=2*Math.sqrt(1+C-m-z),r[3]=(P-b)/V,r[0]=(y+E)/V,r[1]=.25*V,r[2]=(A+R)/V):(V=2*Math.sqrt(1+z-m-C),r[3]=(y-E)/V,r[0]=(P+b)/V,r[1]=(A+R)/V,r[2]=.25*V),r},Ar.fromRotationTranslationScale=function(r,e,i,a){var h=e[0],p=e[1],m=e[2],y=e[3],b=h+h,E=p+p,C=m+m,A=h*b,P=h*E,R=h*C,z=p*E,B=p*C,V=m*C,Q=y*b,ae=y*E,le=y*C,he=a[0],me=a[1],ve=a[2];return r[0]=(1-(z+V))*he,r[1]=(P+le)*he,r[2]=(R-ae)*he,r[3]=0,r[4]=(P-le)*me,r[5]=(1-(A+V))*me,r[6]=(B+Q)*me,r[7]=0,r[8]=(R+ae)*ve,r[9]=(B-Q)*ve,r[10]=(1-(A+z))*ve,r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r},Ar.fromRotationTranslationScaleOrigin=function(r,e,i,a,h){var p=e[0],m=e[1],y=e[2],b=e[3],E=p+p,C=m+m,A=y+y,P=p*E,R=p*C,z=p*A,B=m*C,V=m*A,Q=y*A,ae=b*E,le=b*C,he=b*A,me=a[0],ve=a[1],Pe=a[2],Ne=h[0],je=h[1],Ye=h[2],Ve=(1-(B+Q))*me,ht=(R+he)*me,Ct=(z-le)*me,st=(R-he)*ve,wt=(1-(P+Q))*ve,ot=(V+ae)*ve,Rt=(z+le)*Pe,Ht=(V-ae)*Pe,Tt=(1-(P+B))*Pe;return r[0]=Ve,r[1]=ht,r[2]=Ct,r[3]=0,r[4]=st,r[5]=wt,r[6]=ot,r[7]=0,r[8]=Rt,r[9]=Ht,r[10]=Tt,r[11]=0,r[12]=i[0]+Ne-(Ve*Ne+st*je+Rt*Ye),r[13]=i[1]+je-(ht*Ne+wt*je+Ht*Ye),r[14]=i[2]+Ye-(Ct*Ne+ot*je+Tt*Ye),r[15]=1,r},Ar.fromQuat=function(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=i+i,y=a+a,b=h+h,E=i*m,C=a*m,A=a*y,P=h*m,R=h*y,z=h*b,B=p*m,V=p*y,Q=p*b;return r[0]=1-A-z,r[1]=C+Q,r[2]=P-V,r[3]=0,r[4]=C-Q,r[5]=1-E-z,r[6]=R+B,r[7]=0,r[8]=P+V,r[9]=R-B,r[10]=1-E-A,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},Ar.frustum=function(r,e,i,a,h,p,m){var y=1/(i-e),b=1/(h-a),E=1/(p-m);return r[0]=2*p*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=2*p*b,r[6]=0,r[7]=0,r[8]=(i+e)*y,r[9]=(h+a)*b,r[10]=(m+p)*E,r[11]=-1,r[12]=0,r[13]=0,r[14]=m*p*2*E,r[15]=0,r},Ar.perspectiveNO=wA,Ar.perspectiveZO=function(r,e,i,a,h){var p,m=1/Math.tan(e/2);return r[0]=m/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=h*(p=1/(a-h)),r[14]=h*a*p):(r[10]=-1,r[14]=-a),r},Ar.perspectiveFromFieldOfView=function(r,e,i,a){var h=Math.tan(e.upDegrees*Math.PI/180),p=Math.tan(e.downDegrees*Math.PI/180),m=Math.tan(e.leftDegrees*Math.PI/180),y=Math.tan(e.rightDegrees*Math.PI/180),b=2/(m+y),E=2/(h+p);return r[0]=b,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=E,r[6]=0,r[7]=0,r[8]=-(m-y)*b*.5,r[9]=(h-p)*E*.5,r[10]=a/(i-a),r[11]=-1,r[12]=0,r[13]=0,r[14]=a*i/(i-a),r[15]=0,r},Ar.orthoNO=EA,Ar.orthoZO=function(r,e,i,a,h,p,m){var y=1/(e-i),b=1/(a-h),E=1/(p-m);return r[0]=-2*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=E,r[11]=0,r[12]=(e+i)*y,r[13]=(h+a)*b,r[14]=p*E,r[15]=1,r},Ar.lookAt=function(r,e,i,a){var h,p,m,y,b,E,C,A,P,R,z=e[0],B=e[1],V=e[2],Q=a[0],ae=a[1],le=a[2],he=i[0],me=i[1],ve=i[2];return Math.abs(z-he)<hi.EPSILON&&Math.abs(B-me)<hi.EPSILON&&Math.abs(V-ve)<hi.EPSILON?yA(r):(C=z-he,A=B-me,P=V-ve,h=ae*(P*=R=1/Math.hypot(C,A,P))-le*(A*=R),p=le*(C*=R)-Q*P,m=Q*A-ae*C,(R=Math.hypot(h,p,m))?(h*=R=1/R,p*=R,m*=R):(h=0,p=0,m=0),y=A*m-P*p,b=P*h-C*m,E=C*p-A*h,(R=Math.hypot(y,b,E))?(y*=R=1/R,b*=R,E*=R):(y=0,b=0,E=0),r[0]=h,r[1]=y,r[2]=C,r[3]=0,r[4]=p,r[5]=b,r[6]=A,r[7]=0,r[8]=m,r[9]=E,r[10]=P,r[11]=0,r[12]=-(h*z+p*B+m*V),r[13]=-(y*z+b*B+E*V),r[14]=-(C*z+A*B+P*V),r[15]=1,r)},Ar.targetTo=function(r,e,i,a){var h=e[0],p=e[1],m=e[2],y=a[0],b=a[1],E=a[2],C=h-i[0],A=p-i[1],P=m-i[2],R=C*C+A*A+P*P;R>0&&(C*=R=1/Math.sqrt(R),A*=R,P*=R);var z=b*P-E*A,B=E*C-y*P,V=y*A-b*C;return(R=z*z+B*B+V*V)>0&&(z*=R=1/Math.sqrt(R),B*=R,V*=R),r[0]=z,r[1]=B,r[2]=V,r[3]=0,r[4]=A*V-P*B,r[5]=P*z-C*V,r[6]=C*B-A*z,r[7]=0,r[8]=C,r[9]=A,r[10]=P,r[11]=0,r[12]=h,r[13]=p,r[14]=m,r[15]=1,r},Ar.str=function(r){return"mat4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+", "+r[8]+", "+r[9]+", "+r[10]+", "+r[11]+", "+r[12]+", "+r[13]+", "+r[14]+", "+r[15]+")"},Ar.frob=function(r){return Math.hypot(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],r[9],r[10],r[11],r[12],r[13],r[14],r[15])},Ar.add=function(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r[3]=e[3]+i[3],r[4]=e[4]+i[4],r[5]=e[5]+i[5],r[6]=e[6]+i[6],r[7]=e[7]+i[7],r[8]=e[8]+i[8],r[9]=e[9]+i[9],r[10]=e[10]+i[10],r[11]=e[11]+i[11],r[12]=e[12]+i[12],r[13]=e[13]+i[13],r[14]=e[14]+i[14],r[15]=e[15]+i[15],r},Ar.subtract=SA,Ar.multiplyScalar=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r[8]=e[8]*i,r[9]=e[9]*i,r[10]=e[10]*i,r[11]=e[11]*i,r[12]=e[12]*i,r[13]=e[13]*i,r[14]=e[14]*i,r[15]=e[15]*i,r},Ar.multiplyScalarAndAdd=function(r,e,i,a){return r[0]=e[0]+i[0]*a,r[1]=e[1]+i[1]*a,r[2]=e[2]+i[2]*a,r[3]=e[3]+i[3]*a,r[4]=e[4]+i[4]*a,r[5]=e[5]+i[5]*a,r[6]=e[6]+i[6]*a,r[7]=e[7]+i[7]*a,r[8]=e[8]+i[8]*a,r[9]=e[9]+i[9]*a,r[10]=e[10]+i[10]*a,r[11]=e[11]+i[11]*a,r[12]=e[12]+i[12]*a,r[13]=e[13]+i[13]*a,r[14]=e[14]+i[14]*a,r[15]=e[15]+i[15]*a,r},Ar.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]&&r[8]===e[8]&&r[9]===e[9]&&r[10]===e[10]&&r[11]===e[11]&&r[12]===e[12]&&r[13]===e[13]&&r[14]===e[14]&&r[15]===e[15]},Ar.equals=function(r,e){var i=r[0],a=r[1],h=r[2],p=r[3],m=r[4],y=r[5],b=r[6],E=r[7],C=r[8],A=r[9],P=r[10],R=r[11],z=r[12],B=r[13],V=r[14],Q=r[15],ae=e[0],le=e[1],he=e[2],me=e[3],ve=e[4],Pe=e[5],Ne=e[6],je=e[7],Ye=e[8],Ve=e[9],ht=e[10],Ct=e[11],st=e[12],wt=e[13],ot=e[14],Rt=e[15];return Math.abs(i-ae)<=hi.EPSILON*Math.max(1,Math.abs(i),Math.abs(ae))&&Math.abs(a-le)<=hi.EPSILON*Math.max(1,Math.abs(a),Math.abs(le))&&Math.abs(h-he)<=hi.EPSILON*Math.max(1,Math.abs(h),Math.abs(he))&&Math.abs(p-me)<=hi.EPSILON*Math.max(1,Math.abs(p),Math.abs(me))&&Math.abs(m-ve)<=hi.EPSILON*Math.max(1,Math.abs(m),Math.abs(ve))&&Math.abs(y-Pe)<=hi.EPSILON*Math.max(1,Math.abs(y),Math.abs(Pe))&&Math.abs(b-Ne)<=hi.EPSILON*Math.max(1,Math.abs(b),Math.abs(Ne))&&Math.abs(E-je)<=hi.EPSILON*Math.max(1,Math.abs(E),Math.abs(je))&&Math.abs(C-Ye)<=hi.EPSILON*Math.max(1,Math.abs(C),Math.abs(Ye))&&Math.abs(A-Ve)<=hi.EPSILON*Math.max(1,Math.abs(A),Math.abs(Ve))&&Math.abs(P-ht)<=hi.EPSILON*Math.max(1,Math.abs(P),Math.abs(ht))&&Math.abs(R-Ct)<=hi.EPSILON*Math.max(1,Math.abs(R),Math.abs(Ct))&&Math.abs(z-st)<=hi.EPSILON*Math.max(1,Math.abs(z),Math.abs(st))&&Math.abs(B-wt)<=hi.EPSILON*Math.max(1,Math.abs(B),Math.abs(wt))&&Math.abs(V-ot)<=hi.EPSILON*Math.max(1,Math.abs(V),Math.abs(ot))&&Math.abs(Q-Rt)<=hi.EPSILON*Math.max(1,Math.abs(Q),Math.abs(Rt))},Ar.sub=Ar.mul=Ar.ortho=Ar.perspective=void 0;var hi=function(r,e){if(r&&r.__esModule)return r;if(r===null||Ab(r)!=="object"&&typeof r!="function")return{default:r};var i=_A(void 0);if(i&&i.has(r))return i.get(r);var a={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in r)if(p!=="default"&&Object.prototype.hasOwnProperty.call(r,p)){var m=h?Object.getOwnPropertyDescriptor(r,p):null;m&&(m.get||m.set)?Object.defineProperty(a,p,m):a[p]=r[p]}return a.default=r,i&&i.set(r,a),a}(Ji);function _A(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(_A=function(a){return a?i:e})(r)}function yA(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function vA(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=e[4],b=e[5],E=e[6],C=e[7],A=e[8],P=e[9],R=e[10],z=e[11],B=e[12],V=e[13],Q=e[14],ae=e[15],le=i[0],he=i[1],me=i[2],ve=i[3];return r[0]=le*a+he*y+me*A+ve*B,r[1]=le*h+he*b+me*P+ve*V,r[2]=le*p+he*E+me*R+ve*Q,r[3]=le*m+he*C+me*z+ve*ae,r[4]=(le=i[4])*a+(he=i[5])*y+(me=i[6])*A+(ve=i[7])*B,r[5]=le*h+he*b+me*P+ve*V,r[6]=le*p+he*E+me*R+ve*Q,r[7]=le*m+he*C+me*z+ve*ae,r[8]=(le=i[8])*a+(he=i[9])*y+(me=i[10])*A+(ve=i[11])*B,r[9]=le*h+he*b+me*P+ve*V,r[10]=le*p+he*E+me*R+ve*Q,r[11]=le*m+he*C+me*z+ve*ae,r[12]=(le=i[12])*a+(he=i[13])*y+(me=i[14])*A+(ve=i[15])*B,r[13]=le*h+he*b+me*P+ve*V,r[14]=le*p+he*E+me*R+ve*Q,r[15]=le*m+he*C+me*z+ve*ae,r}function xA(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=a+a,b=h+h,E=p+p,C=a*y,A=a*b,P=a*E,R=h*b,z=h*E,B=p*E,V=m*y,Q=m*b,ae=m*E;return r[0]=1-(R+B),r[1]=A+ae,r[2]=P-Q,r[3]=0,r[4]=A-ae,r[5]=1-(C+B),r[6]=z+V,r[7]=0,r[8]=P+Q,r[9]=z-V,r[10]=1-(C+R),r[11]=0,r[12]=i[0],r[13]=i[1],r[14]=i[2],r[15]=1,r}function bA(r,e){var i=e[4],a=e[5],h=e[6],p=e[8],m=e[9],y=e[10];return r[0]=Math.hypot(e[0],e[1],e[2]),r[1]=Math.hypot(i,a,h),r[2]=Math.hypot(p,m,y),r}function wA(r,e,i,a,h){var p,m=1/Math.tan(e/2);return r[0]=m/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=m,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,h!=null&&h!==1/0?(r[10]=(h+a)*(p=1/(a-h)),r[14]=2*h*a*p):(r[10]=-1,r[14]=-2*a),r}function EA(r,e,i,a,h,p,m){var y=1/(e-i),b=1/(a-h),E=1/(p-m);return r[0]=-2*y,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*E,r[11]=0,r[12]=(e+i)*y,r[13]=(h+a)*b,r[14]=(m+p)*E,r[15]=1,r}function SA(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r[3]=e[3]-i[3],r[4]=e[4]-i[4],r[5]=e[5]-i[5],r[6]=e[6]-i[6],r[7]=e[7]-i[7],r[8]=e[8]-i[8],r[9]=e[9]-i[9],r[10]=e[10]-i[10],r[11]=e[11]-i[11],r[12]=e[12]-i[12],r[13]=e[13]-i[13],r[14]=e[14]-i[14],r[15]=e[15]-i[15],r}Ar.perspective=wA,Ar.ortho=EA,Ar.mul=vA,Ar.sub=SA;var Sr={},Ir={};function kb(r){return kb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},kb(r)}Object.defineProperty(Ir,"__esModule",{value:!0}),Ir.create=CA,Ir.clone=function(r){var e=new rc.ARRAY_TYPE(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e},Ir.length=MA,Ir.fromValues=function(r,e,i){var a=new rc.ARRAY_TYPE(3);return a[0]=r,a[1]=e,a[2]=i,a},Ir.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r},Ir.set=function(r,e,i,a){return r[0]=e,r[1]=i,r[2]=a,r},Ir.add=function(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r},Ir.subtract=IA,Ir.multiply=AA,Ir.divide=kA,Ir.ceil=function(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r},Ir.floor=function(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r},Ir.min=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r},Ir.max=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r},Ir.round=function(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r},Ir.scale=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r},Ir.scaleAndAdd=function(r,e,i,a){return r[0]=e[0]+i[0]*a,r[1]=e[1]+i[1]*a,r[2]=e[2]+i[2]*a,r},Ir.distance=PA,Ir.squaredDistance=OA,Ir.squaredLength=DA,Ir.negate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r},Ir.inverse=function(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r},Ir.normalize=function(r,e){var i=e[0],a=e[1],h=e[2],p=i*i+a*a+h*h;return p>0&&(p=1/Math.sqrt(p)),r[0]=e[0]*p,r[1]=e[1]*p,r[2]=e[2]*p,r},Ir.dot=RA,Ir.cross=function(r,e,i){var a=e[0],h=e[1],p=e[2],m=i[0],y=i[1],b=i[2];return r[0]=h*b-p*y,r[1]=p*m-a*b,r[2]=a*y-h*m,r},Ir.lerp=function(r,e,i,a){var h=e[0],p=e[1],m=e[2];return r[0]=h+a*(i[0]-h),r[1]=p+a*(i[1]-p),r[2]=m+a*(i[2]-m),r},Ir.hermite=function(r,e,i,a,h,p){var m=p*p,y=m*(2*p-3)+1,b=m*(p-2)+p,E=m*(p-1),C=m*(3-2*p);return r[0]=e[0]*y+i[0]*b+a[0]*E+h[0]*C,r[1]=e[1]*y+i[1]*b+a[1]*E+h[1]*C,r[2]=e[2]*y+i[2]*b+a[2]*E+h[2]*C,r},Ir.bezier=function(r,e,i,a,h,p){var m=1-p,y=m*m,b=p*p,E=y*m,C=3*p*y,A=3*b*m,P=b*p;return r[0]=e[0]*E+i[0]*C+a[0]*A+h[0]*P,r[1]=e[1]*E+i[1]*C+a[1]*A+h[1]*P,r[2]=e[2]*E+i[2]*C+a[2]*A+h[2]*P,r},Ir.random=function(r,e){e=e||1;var i=2*rc.RANDOM()*Math.PI,a=2*rc.RANDOM()-1,h=Math.sqrt(1-a*a)*e;return r[0]=Math.cos(i)*h,r[1]=Math.sin(i)*h,r[2]=a*e,r},Ir.transformMat4=function(r,e,i){var a=e[0],h=e[1],p=e[2],m=i[3]*a+i[7]*h+i[11]*p+i[15];return r[0]=(i[0]*a+i[4]*h+i[8]*p+i[12])/(m=m||1),r[1]=(i[1]*a+i[5]*h+i[9]*p+i[13])/m,r[2]=(i[2]*a+i[6]*h+i[10]*p+i[14])/m,r},Ir.transformMat3=function(r,e,i){var a=e[0],h=e[1],p=e[2];return r[0]=a*i[0]+h*i[3]+p*i[6],r[1]=a*i[1]+h*i[4]+p*i[7],r[2]=a*i[2]+h*i[5]+p*i[8],r},Ir.transformQuat=function(r,e,i){var a=i[0],h=i[1],p=i[2],m=e[0],y=e[1],b=e[2],E=h*b-p*y,C=p*m-a*b,A=a*y-h*m,P=h*A-p*C,R=p*E-a*A,z=a*C-h*E,B=2*i[3];return C*=B,A*=B,R*=2,z*=2,r[0]=m+(E*=B)+(P*=2),r[1]=y+C+R,r[2]=b+A+z,r},Ir.rotateX=function(r,e,i,a){var h=[],p=[];return h[0]=e[0]-i[0],h[1]=e[1]-i[1],h[2]=e[2]-i[2],p[0]=h[0],p[1]=h[1]*Math.cos(a)-h[2]*Math.sin(a),p[2]=h[1]*Math.sin(a)+h[2]*Math.cos(a),r[0]=p[0]+i[0],r[1]=p[1]+i[1],r[2]=p[2]+i[2],r},Ir.rotateY=function(r,e,i,a){var h=[],p=[];return h[0]=e[0]-i[0],h[1]=e[1]-i[1],h[2]=e[2]-i[2],p[0]=h[2]*Math.sin(a)+h[0]*Math.cos(a),p[1]=h[1],p[2]=h[2]*Math.cos(a)-h[0]*Math.sin(a),r[0]=p[0]+i[0],r[1]=p[1]+i[1],r[2]=p[2]+i[2],r},Ir.rotateZ=function(r,e,i,a){var h=[],p=[];return h[0]=e[0]-i[0],h[1]=e[1]-i[1],h[2]=e[2]-i[2],p[0]=h[0]*Math.cos(a)-h[1]*Math.sin(a),p[1]=h[0]*Math.sin(a)+h[1]*Math.cos(a),p[2]=h[2],r[0]=p[0]+i[0],r[1]=p[1]+i[1],r[2]=p[2]+i[2],r},Ir.angle=function(r,e){var i=r[0],a=r[1],h=r[2],p=e[0],m=e[1],y=e[2],b=Math.sqrt(i*i+a*a+h*h)*Math.sqrt(p*p+m*m+y*y),E=b&&RA(r,e)/b;return Math.acos(Math.min(Math.max(E,-1),1))},Ir.zero=function(r){return r[0]=0,r[1]=0,r[2]=0,r},Ir.str=function(r){return"vec3("+r[0]+", "+r[1]+", "+r[2]+")"},Ir.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]},Ir.equals=function(r,e){var i=r[0],a=r[1],h=r[2],p=e[0],m=e[1],y=e[2];return Math.abs(i-p)<=rc.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(a-m)<=rc.EPSILON*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(h-y)<=rc.EPSILON*Math.max(1,Math.abs(h),Math.abs(y))},Ir.forEach=Ir.sqrLen=Ir.len=Ir.sqrDist=Ir.dist=Ir.div=Ir.mul=Ir.sub=void 0;var rc=function(r,e){if(r&&r.__esModule)return r;if(r===null||kb(r)!=="object"&&typeof r!="function")return{default:r};var i=TA(void 0);if(i&&i.has(r))return i.get(r);var a={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in r)if(p!=="default"&&Object.prototype.hasOwnProperty.call(r,p)){var m=h?Object.getOwnPropertyDescriptor(r,p):null;m&&(m.get||m.set)?Object.defineProperty(a,p,m):a[p]=r[p]}return a.default=r,i&&i.set(r,a),a}(Ji);function TA(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(TA=function(a){return a?i:e})(r)}function CA(){var r=new rc.ARRAY_TYPE(3);return rc.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function MA(r){return Math.hypot(r[0],r[1],r[2])}function IA(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r}function AA(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r}function kA(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r}function PA(r,e){return Math.hypot(e[0]-r[0],e[1]-r[1],e[2]-r[2])}function OA(r,e){var i=e[0]-r[0],a=e[1]-r[1],h=e[2]-r[2];return i*i+a*a+h*h}function DA(r){var e=r[0],i=r[1],a=r[2];return e*e+i*i+a*a}function RA(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]}Ir.sub=IA,Ir.mul=AA,Ir.div=kA,Ir.dist=PA,Ir.sqrDist=OA,Ir.len=MA,Ir.sqrLen=DA;var nc,i6=(nc=CA(),function(r,e,i,a,h,p){var m,y;for(e||(e=3),i||(i=0),y=a?Math.min(a*e+i,r.length):r.length,m=i;m<y;m+=e)nc[0]=r[m],nc[1]=r[m+1],nc[2]=r[m+2],h(nc,nc,p),r[m]=nc[0],r[m+1]=nc[1],r[m+2]=nc[2];return r});Ir.forEach=i6;var Br={};function Pb(r){return Pb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Pb(r)}Object.defineProperty(Br,"__esModule",{value:!0}),Br.create=zA,Br.clone=function(r){var e=new _a.ARRAY_TYPE(4);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e},Br.fromValues=function(r,e,i,a){var h=new _a.ARRAY_TYPE(4);return h[0]=r,h[1]=e,h[2]=i,h[3]=a,h},Br.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r},Br.set=function(r,e,i,a,h){return r[0]=e,r[1]=i,r[2]=a,r[3]=h,r},Br.add=function(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r[3]=e[3]+i[3],r},Br.subtract=NA,Br.multiply=FA,Br.divide=BA,Br.ceil=function(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r[2]=Math.ceil(e[2]),r[3]=Math.ceil(e[3]),r},Br.floor=function(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r[2]=Math.floor(e[2]),r[3]=Math.floor(e[3]),r},Br.min=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r[2]=Math.min(e[2],i[2]),r[3]=Math.min(e[3],i[3]),r},Br.max=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r[2]=Math.max(e[2],i[2]),r[3]=Math.max(e[3],i[3]),r},Br.round=function(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r[2]=Math.round(e[2]),r[3]=Math.round(e[3]),r},Br.scale=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r},Br.scaleAndAdd=function(r,e,i,a){return r[0]=e[0]+i[0]*a,r[1]=e[1]+i[1]*a,r[2]=e[2]+i[2]*a,r[3]=e[3]+i[3]*a,r},Br.distance=jA,Br.squaredDistance=$A,Br.length=UA,Br.squaredLength=VA,Br.negate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=-e[3],r},Br.inverse=function(r,e){return r[0]=1/e[0],r[1]=1/e[1],r[2]=1/e[2],r[3]=1/e[3],r},Br.normalize=function(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=i*i+a*a+h*h+p*p;return m>0&&(m=1/Math.sqrt(m)),r[0]=i*m,r[1]=a*m,r[2]=h*m,r[3]=p*m,r},Br.dot=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},Br.cross=function(r,e,i,a){var h=i[0]*a[1]-i[1]*a[0],p=i[0]*a[2]-i[2]*a[0],m=i[0]*a[3]-i[3]*a[0],y=i[1]*a[2]-i[2]*a[1],b=i[1]*a[3]-i[3]*a[1],E=i[2]*a[3]-i[3]*a[2],C=e[0],A=e[1],P=e[2],R=e[3];return r[0]=A*E-P*b+R*y,r[1]=-C*E+P*m-R*p,r[2]=C*b-A*m+R*h,r[3]=-C*y+A*p-P*h,r},Br.lerp=function(r,e,i,a){var h=e[0],p=e[1],m=e[2],y=e[3];return r[0]=h+a*(i[0]-h),r[1]=p+a*(i[1]-p),r[2]=m+a*(i[2]-m),r[3]=y+a*(i[3]-y),r},Br.random=function(r,e){var i,a,h,p,m,y;e=e||1;do m=(i=2*_a.RANDOM()-1)*i+(a=2*_a.RANDOM()-1)*a;while(m>=1);do y=(h=2*_a.RANDOM()-1)*h+(p=2*_a.RANDOM()-1)*p;while(y>=1);var b=Math.sqrt((1-m)/y);return r[0]=e*i,r[1]=e*a,r[2]=e*h*b,r[3]=e*p*b,r},Br.transformMat4=function(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3];return r[0]=i[0]*a+i[4]*h+i[8]*p+i[12]*m,r[1]=i[1]*a+i[5]*h+i[9]*p+i[13]*m,r[2]=i[2]*a+i[6]*h+i[10]*p+i[14]*m,r[3]=i[3]*a+i[7]*h+i[11]*p+i[15]*m,r},Br.transformQuat=function(r,e,i){var a=e[0],h=e[1],p=e[2],m=i[0],y=i[1],b=i[2],E=i[3],C=E*a+y*p-b*h,A=E*h+b*a-m*p,P=E*p+m*h-y*a,R=-m*a-y*h-b*p;return r[0]=C*E+R*-m+A*-b-P*-y,r[1]=A*E+R*-y+P*-m-C*-b,r[2]=P*E+R*-b+C*-y-A*-m,r[3]=e[3],r},Br.zero=function(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=0,r},Br.str=function(r){return"vec4("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},Br.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]},Br.equals=function(r,e){var i=r[0],a=r[1],h=r[2],p=r[3],m=e[0],y=e[1],b=e[2],E=e[3];return Math.abs(i-m)<=_a.EPSILON*Math.max(1,Math.abs(i),Math.abs(m))&&Math.abs(a-y)<=_a.EPSILON*Math.max(1,Math.abs(a),Math.abs(y))&&Math.abs(h-b)<=_a.EPSILON*Math.max(1,Math.abs(h),Math.abs(b))&&Math.abs(p-E)<=_a.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},Br.forEach=Br.sqrLen=Br.len=Br.sqrDist=Br.dist=Br.div=Br.mul=Br.sub=void 0;var _a=function(r,e){if(r&&r.__esModule)return r;if(r===null||Pb(r)!=="object"&&typeof r!="function")return{default:r};var i=LA(void 0);if(i&&i.has(r))return i.get(r);var a={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in r)if(p!=="default"&&Object.prototype.hasOwnProperty.call(r,p)){var m=h?Object.getOwnPropertyDescriptor(r,p):null;m&&(m.get||m.set)?Object.defineProperty(a,p,m):a[p]=r[p]}return a.default=r,i&&i.set(r,a),a}(Ji);function LA(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(LA=function(a){return a?i:e})(r)}function zA(){var r=new _a.ARRAY_TYPE(4);return _a.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[3]=0),r}function NA(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r[3]=e[3]-i[3],r}function FA(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r[3]=e[3]*i[3],r}function BA(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r[2]=e[2]/i[2],r[3]=e[3]/i[3],r}function jA(r,e){return Math.hypot(e[0]-r[0],e[1]-r[1],e[2]-r[2],e[3]-r[3])}function $A(r,e){var i=e[0]-r[0],a=e[1]-r[1],h=e[2]-r[2],p=e[3]-r[3];return i*i+a*a+h*h+p*p}function UA(r){return Math.hypot(r[0],r[1],r[2],r[3])}function VA(r){var e=r[0],i=r[1],a=r[2],h=r[3];return e*e+i*i+a*a+h*h}Br.sub=NA,Br.mul=FA,Br.div=BA,Br.dist=jA,Br.sqrDist=$A,Br.len=UA,Br.sqrLen=VA;var o6=function(){var r=zA();return function(e,i,a,h,p,m){var y,b;for(i||(i=4),a||(a=0),b=h?Math.min(h*i+a,e.length):e.length,y=a;y<b;y+=i)r[0]=e[y],r[1]=e[y+1],r[2]=e[y+2],r[3]=e[y+3],p(r,r,m),e[y]=r[0],e[y+1]=r[1],e[y+2]=r[2],e[y+3]=r[3];return e}}();function Ob(r){return Ob=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ob(r)}Br.forEach=o6,Object.defineProperty(Sr,"__esModule",{value:!0}),Sr.create=Db,Sr.identity=function(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r},Sr.setAxisAngle=qA,Sr.getAxisAngle=function(r,e){var i=2*Math.acos(e[3]),a=Math.sin(i/2);return a>Eh.EPSILON?(r[0]=e[0]/a,r[1]=e[1]/a,r[2]=e[2]/a):(r[0]=1,r[1]=0,r[2]=0),i},Sr.getAngle=function(r,e){var i=QA(r,e);return Math.acos(2*i*i-1)},Sr.multiply=WA,Sr.rotateX=function(r,e,i){i*=.5;var a=e[0],h=e[1],p=e[2],m=e[3],y=Math.sin(i),b=Math.cos(i);return r[0]=a*b+m*y,r[1]=h*b+p*y,r[2]=p*b-h*y,r[3]=m*b-a*y,r},Sr.rotateY=function(r,e,i){i*=.5;var a=e[0],h=e[1],p=e[2],m=e[3],y=Math.sin(i),b=Math.cos(i);return r[0]=a*b-p*y,r[1]=h*b+m*y,r[2]=p*b+a*y,r[3]=m*b-h*y,r},Sr.rotateZ=function(r,e,i){i*=.5;var a=e[0],h=e[1],p=e[2],m=e[3],y=Math.sin(i),b=Math.cos(i);return r[0]=a*b+h*y,r[1]=h*b-a*y,r[2]=p*b+m*y,r[3]=m*b-p*y,r},Sr.calculateW=function(r,e){var i=e[0],a=e[1],h=e[2];return r[0]=i,r[1]=a,r[2]=h,r[3]=Math.sqrt(Math.abs(1-i*i-a*a-h*h)),r},Sr.exp=HA,Sr.ln=ZA,Sr.pow=function(r,e,i){return ZA(r,e),YA(r,r,i),HA(r,r),r},Sr.slerp=dv,Sr.random=function(r){var e=Eh.RANDOM(),i=Eh.RANDOM(),a=Eh.RANDOM(),h=Math.sqrt(1-e),p=Math.sqrt(e);return r[0]=h*Math.sin(2*Math.PI*i),r[1]=h*Math.cos(2*Math.PI*i),r[2]=p*Math.sin(2*Math.PI*a),r[3]=p*Math.cos(2*Math.PI*a),r},Sr.invert=function(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=i*i+a*a+h*h+p*p,y=m?1/m:0;return r[0]=-i*y,r[1]=-a*y,r[2]=-h*y,r[3]=p*y,r},Sr.conjugate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r},Sr.fromMat3=XA,Sr.fromEuler=function(r,e,i,a){var h=.5*Math.PI/180;e*=h,i*=h,a*=h;var p=Math.sin(e),m=Math.cos(e),y=Math.sin(i),b=Math.cos(i),E=Math.sin(a),C=Math.cos(a);return r[0]=p*b*C-m*y*E,r[1]=m*y*C+p*b*E,r[2]=m*b*E-p*y*C,r[3]=m*b*C+p*y*E,r},Sr.str=function(r){return"quat("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+")"},Sr.setAxes=Sr.sqlerp=Sr.rotationTo=Sr.equals=Sr.exactEquals=Sr.normalize=Sr.sqrLen=Sr.squaredLength=Sr.len=Sr.length=Sr.lerp=Sr.dot=Sr.scale=Sr.mul=Sr.add=Sr.set=Sr.copy=Sr.fromValues=Sr.clone=void 0;var Eh=hv(Ji),s6=hv(xn),ic=hv(Ir),Ys=hv(Br);function GA(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(GA=function(a){return a?i:e})(r)}function hv(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||Ob(r)!=="object"&&typeof r!="function")return{default:r};var i=GA(e);if(i&&i.has(r))return i.get(r);var a={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in r)if(p!=="default"&&Object.prototype.hasOwnProperty.call(r,p)){var m=h?Object.getOwnPropertyDescriptor(r,p):null;m&&(m.get||m.set)?Object.defineProperty(a,p,m):a[p]=r[p]}return a.default=r,i&&i.set(r,a),a}function Db(){var r=new Eh.ARRAY_TYPE(4);return Eh.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function qA(r,e,i){i*=.5;var a=Math.sin(i);return r[0]=a*e[0],r[1]=a*e[1],r[2]=a*e[2],r[3]=Math.cos(i),r}function WA(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=i[0],b=i[1],E=i[2],C=i[3];return r[0]=a*C+m*y+h*E-p*b,r[1]=h*C+m*b+p*y-a*E,r[2]=p*C+m*E+a*b-h*y,r[3]=m*C-a*y-h*b-p*E,r}function HA(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=Math.sqrt(i*i+a*a+h*h),y=Math.exp(p),b=m>0?y*Math.sin(m)/m:0;return r[0]=i*b,r[1]=a*b,r[2]=h*b,r[3]=y*Math.cos(m),r}function ZA(r,e){var i=e[0],a=e[1],h=e[2],p=e[3],m=Math.sqrt(i*i+a*a+h*h),y=m>0?Math.atan2(m,p)/m:0;return r[0]=i*y,r[1]=a*y,r[2]=h*y,r[3]=.5*Math.log(i*i+a*a+h*h+p*p),r}function dv(r,e,i,a){var h,p,m,y,b,E=e[0],C=e[1],A=e[2],P=e[3],R=i[0],z=i[1],B=i[2],V=i[3];return(p=E*R+C*z+A*B+P*V)<0&&(p=-p,R=-R,z=-z,B=-B,V=-V),1-p>Eh.EPSILON?(h=Math.acos(p),m=Math.sin(h),y=Math.sin((1-a)*h)/m,b=Math.sin(a*h)/m):(y=1-a,b=a),r[0]=y*E+b*R,r[1]=y*C+b*z,r[2]=y*A+b*B,r[3]=y*P+b*V,r}function XA(r,e){var i,a=e[0]+e[4]+e[8];if(a>0)i=Math.sqrt(a+1),r[3]=.5*i,r[0]=(e[5]-e[7])*(i=.5/i),r[1]=(e[6]-e[2])*i,r[2]=(e[1]-e[3])*i;else{var h=0;e[4]>e[0]&&(h=1),e[8]>e[3*h+h]&&(h=2);var p=(h+1)%3,m=(h+2)%3;i=Math.sqrt(e[3*h+h]-e[3*p+p]-e[3*m+m]+1),r[h]=.5*i,r[3]=(e[3*p+m]-e[3*m+p])*(i=.5/i),r[p]=(e[3*p+h]+e[3*h+p])*i,r[m]=(e[3*m+h]+e[3*h+m])*i}return r}Sr.clone=Ys.clone,Sr.fromValues=Ys.fromValues,Sr.copy=Ys.copy,Sr.set=Ys.set,Sr.add=Ys.add,Sr.mul=WA;var YA=Ys.scale;Sr.scale=YA;var QA=Ys.dot;Sr.dot=QA,Sr.lerp=Ys.lerp;var KA=Ys.length;Sr.length=KA,Sr.len=KA;var JA=Ys.squaredLength;Sr.squaredLength=JA,Sr.sqrLen=JA;var Rb=Ys.normalize;Sr.normalize=Rb,Sr.exactEquals=Ys.exactEquals,Sr.equals=Ys.equals;var Va,ek,tk,a6=(Va=ic.create(),ek=ic.fromValues(1,0,0),tk=ic.fromValues(0,1,0),function(r,e,i){var a=ic.dot(e,i);return a<-.999999?(ic.cross(Va,ek,e),ic.len(Va)<1e-6&&ic.cross(Va,tk,e),ic.normalize(Va,Va),qA(r,Va,Math.PI),r):a>.999999?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(ic.cross(Va,e,i),r[0]=Va[0],r[1]=Va[1],r[2]=Va[2],r[3]=1+a,Rb(r,r))});Sr.rotationTo=a6;var Lb,zb,l6=(Lb=Db(),zb=Db(),function(r,e,i,a,h,p){return dv(Lb,e,h,p),dv(zb,i,a,p),dv(r,Lb,zb,2*p*(1-p)),r});Sr.sqlerp=l6;var Ga,c6=(Ga=s6.create(),function(r,e,i,a){return Ga[0]=i[0],Ga[3]=i[1],Ga[6]=i[2],Ga[1]=a[0],Ga[4]=a[1],Ga[7]=a[2],Ga[2]=-e[0],Ga[5]=-e[1],Ga[8]=-e[2],Rb(r,XA(r,Ga))});Sr.setAxes=c6;var Hr={};function Nb(r){return Nb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nb(r)}Object.defineProperty(Hr,"__esModule",{value:!0}),Hr.create=function(){var r=new fs.ARRAY_TYPE(8);return fs.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0,r[4]=0,r[5]=0,r[6]=0,r[7]=0),r[3]=1,r},Hr.clone=function(r){var e=new fs.ARRAY_TYPE(8);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e},Hr.fromValues=function(r,e,i,a,h,p,m,y){var b=new fs.ARRAY_TYPE(8);return b[0]=r,b[1]=e,b[2]=i,b[3]=a,b[4]=h,b[5]=p,b[6]=m,b[7]=y,b},Hr.fromRotationTranslationValues=function(r,e,i,a,h,p,m){var y=new fs.ARRAY_TYPE(8);y[0]=r,y[1]=e,y[2]=i,y[3]=a;var b=.5*h,E=.5*p,C=.5*m;return y[4]=b*a+E*i-C*e,y[5]=E*a+C*r-b*i,y[6]=C*a+b*e-E*r,y[7]=-b*r-E*e-C*i,y},Hr.fromRotationTranslation=ik,Hr.fromTranslation=function(r,e){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=.5*e[0],r[5]=.5*e[1],r[6]=.5*e[2],r[7]=0,r},Hr.fromRotation=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=0,r[5]=0,r[6]=0,r[7]=0,r},Hr.fromMat4=function(r,e){var i=oc.create();rk.getRotation(i,e);var a=new fs.ARRAY_TYPE(3);return rk.getTranslation(a,e),ik(r,i,a),r},Hr.copy=ok,Hr.identity=function(r){return r[0]=0,r[1]=0,r[2]=0,r[3]=1,r[4]=0,r[5]=0,r[6]=0,r[7]=0,r},Hr.set=function(r,e,i,a,h,p,m,y,b){return r[0]=e,r[1]=i,r[2]=a,r[3]=h,r[4]=p,r[5]=m,r[6]=y,r[7]=b,r},Hr.getDual=function(r,e){return r[0]=e[4],r[1]=e[5],r[2]=e[6],r[3]=e[7],r},Hr.setDual=function(r,e){return r[4]=e[0],r[5]=e[1],r[6]=e[2],r[7]=e[3],r},Hr.getTranslation=function(r,e){var i=e[4],a=e[5],h=e[6],p=e[7],m=-e[0],y=-e[1],b=-e[2],E=e[3];return r[0]=2*(i*E+p*m+a*b-h*y),r[1]=2*(a*E+p*y+h*m-i*b),r[2]=2*(h*E+p*b+i*y-a*m),r},Hr.translate=function(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=.5*i[0],b=.5*i[1],E=.5*i[2],C=e[4],A=e[5],P=e[6],R=e[7];return r[0]=a,r[1]=h,r[2]=p,r[3]=m,r[4]=m*y+h*E-p*b+C,r[5]=m*b+p*y-a*E+A,r[6]=m*E+a*b-h*y+P,r[7]=-a*y-h*b-p*E+R,r},Hr.rotateX=function(r,e,i){var a=-e[0],h=-e[1],p=-e[2],m=e[3],y=e[4],b=e[5],E=e[6],C=e[7],A=y*m+C*a+b*p-E*h,P=b*m+C*h+E*a-y*p,R=E*m+C*p+y*h-b*a,z=C*m-y*a-b*h-E*p;return oc.rotateX(r,e,i),r[4]=A*(m=r[3])+z*(a=r[0])+P*(p=r[2])-R*(h=r[1]),r[5]=P*m+z*h+R*a-A*p,r[6]=R*m+z*p+A*h-P*a,r[7]=z*m-A*a-P*h-R*p,r},Hr.rotateY=function(r,e,i){var a=-e[0],h=-e[1],p=-e[2],m=e[3],y=e[4],b=e[5],E=e[6],C=e[7],A=y*m+C*a+b*p-E*h,P=b*m+C*h+E*a-y*p,R=E*m+C*p+y*h-b*a,z=C*m-y*a-b*h-E*p;return oc.rotateY(r,e,i),r[4]=A*(m=r[3])+z*(a=r[0])+P*(p=r[2])-R*(h=r[1]),r[5]=P*m+z*h+R*a-A*p,r[6]=R*m+z*p+A*h-P*a,r[7]=z*m-A*a-P*h-R*p,r},Hr.rotateZ=function(r,e,i){var a=-e[0],h=-e[1],p=-e[2],m=e[3],y=e[4],b=e[5],E=e[6],C=e[7],A=y*m+C*a+b*p-E*h,P=b*m+C*h+E*a-y*p,R=E*m+C*p+y*h-b*a,z=C*m-y*a-b*h-E*p;return oc.rotateZ(r,e,i),r[4]=A*(m=r[3])+z*(a=r[0])+P*(p=r[2])-R*(h=r[1]),r[5]=P*m+z*h+R*a-A*p,r[6]=R*m+z*p+A*h-P*a,r[7]=z*m-A*a-P*h-R*p,r},Hr.rotateByQuatAppend=function(r,e,i){var a=i[0],h=i[1],p=i[2],m=i[3],y=e[0],b=e[1],E=e[2],C=e[3];return r[0]=y*m+C*a+b*p-E*h,r[1]=b*m+C*h+E*a-y*p,r[2]=E*m+C*p+y*h-b*a,r[3]=C*m-y*a-b*h-E*p,r[4]=(y=e[4])*m+(C=e[7])*a+(b=e[5])*p-(E=e[6])*h,r[5]=b*m+C*h+E*a-y*p,r[6]=E*m+C*p+y*h-b*a,r[7]=C*m-y*a-b*h-E*p,r},Hr.rotateByQuatPrepend=function(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=i[0],b=i[1],E=i[2],C=i[3];return r[0]=a*C+m*y+h*E-p*b,r[1]=h*C+m*b+p*y-a*E,r[2]=p*C+m*E+a*b-h*y,r[3]=m*C-a*y-h*b-p*E,r[4]=a*(C=i[7])+m*(y=i[4])+h*(E=i[6])-p*(b=i[5]),r[5]=h*C+m*b+p*y-a*E,r[6]=p*C+m*E+a*b-h*y,r[7]=m*C-a*y-h*b-p*E,r},Hr.rotateAroundAxis=function(r,e,i,a){if(Math.abs(a)<fs.EPSILON)return ok(r,e);var h=Math.hypot(i[0],i[1],i[2]);a*=.5;var p=Math.sin(a),m=p*i[0]/h,y=p*i[1]/h,b=p*i[2]/h,E=Math.cos(a),C=e[0],A=e[1],P=e[2],R=e[3];r[0]=C*E+R*m+A*b-P*y,r[1]=A*E+R*y+P*m-C*b,r[2]=P*E+R*b+C*y-A*m,r[3]=R*E-C*m-A*y-P*b;var z=e[4],B=e[5],V=e[6],Q=e[7];return r[4]=z*E+Q*m+B*b-V*y,r[5]=B*E+Q*y+V*m-z*b,r[6]=V*E+Q*b+z*y-B*m,r[7]=Q*E-z*m-B*y-V*b,r},Hr.add=function(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r[3]=e[3]+i[3],r[4]=e[4]+i[4],r[5]=e[5]+i[5],r[6]=e[6]+i[6],r[7]=e[7]+i[7],r},Hr.multiply=sk,Hr.scale=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*i,r[5]=e[5]*i,r[6]=e[6]*i,r[7]=e[7]*i,r},Hr.lerp=function(r,e,i,a){var h=1-a;return ak(e,i)<0&&(a=-a),r[0]=e[0]*h+i[0]*a,r[1]=e[1]*h+i[1]*a,r[2]=e[2]*h+i[2]*a,r[3]=e[3]*h+i[3]*a,r[4]=e[4]*h+i[4]*a,r[5]=e[5]*h+i[5]*a,r[6]=e[6]*h+i[6]*a,r[7]=e[7]*h+i[7]*a,r},Hr.invert=function(r,e){var i=fv(e);return r[0]=-e[0]/i,r[1]=-e[1]/i,r[2]=-e[2]/i,r[3]=e[3]/i,r[4]=-e[4]/i,r[5]=-e[5]/i,r[6]=-e[6]/i,r[7]=e[7]/i,r},Hr.conjugate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r[2]=-e[2],r[3]=e[3],r[4]=-e[4],r[5]=-e[5],r[6]=-e[6],r[7]=e[7],r},Hr.normalize=function(r,e){var i=fv(e);if(i>0){i=Math.sqrt(i);var a=e[0]/i,h=e[1]/i,p=e[2]/i,m=e[3]/i,y=e[4],b=e[5],E=e[6],C=e[7],A=a*y+h*b+p*E+m*C;r[0]=a,r[1]=h,r[2]=p,r[3]=m,r[4]=(y-a*A)/i,r[5]=(b-h*A)/i,r[6]=(E-p*A)/i,r[7]=(C-m*A)/i}return r},Hr.str=function(r){return"quat2("+r[0]+", "+r[1]+", "+r[2]+", "+r[3]+", "+r[4]+", "+r[5]+", "+r[6]+", "+r[7]+")"},Hr.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]&&r[2]===e[2]&&r[3]===e[3]&&r[4]===e[4]&&r[5]===e[5]&&r[6]===e[6]&&r[7]===e[7]},Hr.equals=function(r,e){var i=r[0],a=r[1],h=r[2],p=r[3],m=r[4],y=r[5],b=r[6],E=r[7],C=e[0],A=e[1],P=e[2],R=e[3],z=e[4],B=e[5],V=e[6],Q=e[7];return Math.abs(i-C)<=fs.EPSILON*Math.max(1,Math.abs(i),Math.abs(C))&&Math.abs(a-A)<=fs.EPSILON*Math.max(1,Math.abs(a),Math.abs(A))&&Math.abs(h-P)<=fs.EPSILON*Math.max(1,Math.abs(h),Math.abs(P))&&Math.abs(p-R)<=fs.EPSILON*Math.max(1,Math.abs(p),Math.abs(R))&&Math.abs(m-z)<=fs.EPSILON*Math.max(1,Math.abs(m),Math.abs(z))&&Math.abs(y-B)<=fs.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(b-V)<=fs.EPSILON*Math.max(1,Math.abs(b),Math.abs(V))&&Math.abs(E-Q)<=fs.EPSILON*Math.max(1,Math.abs(E),Math.abs(Q))},Hr.sqrLen=Hr.squaredLength=Hr.len=Hr.length=Hr.dot=Hr.mul=Hr.setReal=Hr.getReal=void 0;var fs=Fb(Ji),oc=Fb(Sr),rk=Fb(Ar);function nk(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(nk=function(a){return a?i:e})(r)}function Fb(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||Nb(r)!=="object"&&typeof r!="function")return{default:r};var i=nk(e);if(i&&i.has(r))return i.get(r);var a={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in r)if(p!=="default"&&Object.prototype.hasOwnProperty.call(r,p)){var m=h?Object.getOwnPropertyDescriptor(r,p):null;m&&(m.get||m.set)?Object.defineProperty(a,p,m):a[p]=r[p]}return a.default=r,i&&i.set(r,a),a}function ik(r,e,i){var a=.5*i[0],h=.5*i[1],p=.5*i[2],m=e[0],y=e[1],b=e[2],E=e[3];return r[0]=m,r[1]=y,r[2]=b,r[3]=E,r[4]=a*E+h*b-p*y,r[5]=h*E+p*m-a*b,r[6]=p*E+a*y-h*m,r[7]=-a*m-h*y-p*b,r}function ok(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r}function sk(r,e,i){var a=e[0],h=e[1],p=e[2],m=e[3],y=i[4],b=i[5],E=i[6],C=i[7],A=e[4],P=e[5],R=e[6],z=e[7],B=i[0],V=i[1],Q=i[2],ae=i[3];return r[0]=a*ae+m*B+h*Q-p*V,r[1]=h*ae+m*V+p*B-a*Q,r[2]=p*ae+m*Q+a*V-h*B,r[3]=m*ae-a*B-h*V-p*Q,r[4]=a*C+m*y+h*E-p*b+A*ae+z*B+P*Q-R*V,r[5]=h*C+m*b+p*y-a*E+P*ae+z*V+R*B-A*Q,r[6]=p*C+m*E+a*b-h*y+R*ae+z*Q+A*V-P*B,r[7]=m*C-a*y-h*b-p*E+z*ae-A*B-P*V-R*Q,r}Hr.getReal=oc.copy,Hr.setReal=oc.copy,Hr.mul=sk;var ak=oc.dot;Hr.dot=ak;var lk=oc.length;Hr.length=lk,Hr.len=lk;var fv=oc.squaredLength;Hr.squaredLength=fv,Hr.sqrLen=fv;var Dr={};function Bb(r){return Bb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Bb(r)}Object.defineProperty(Dr,"__esModule",{value:!0}),Dr.create=uk,Dr.clone=function(r){var e=new Sh.ARRAY_TYPE(2);return e[0]=r[0],e[1]=r[1],e},Dr.fromValues=function(r,e){var i=new Sh.ARRAY_TYPE(2);return i[0]=r,i[1]=e,i},Dr.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r},Dr.set=function(r,e,i){return r[0]=e,r[1]=i,r},Dr.add=function(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r},Dr.subtract=hk,Dr.multiply=dk,Dr.divide=fk,Dr.ceil=function(r,e){return r[0]=Math.ceil(e[0]),r[1]=Math.ceil(e[1]),r},Dr.floor=function(r,e){return r[0]=Math.floor(e[0]),r[1]=Math.floor(e[1]),r},Dr.min=function(r,e,i){return r[0]=Math.min(e[0],i[0]),r[1]=Math.min(e[1],i[1]),r},Dr.max=function(r,e,i){return r[0]=Math.max(e[0],i[0]),r[1]=Math.max(e[1],i[1]),r},Dr.round=function(r,e){return r[0]=Math.round(e[0]),r[1]=Math.round(e[1]),r},Dr.scale=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r},Dr.scaleAndAdd=function(r,e,i,a){return r[0]=e[0]+i[0]*a,r[1]=e[1]+i[1]*a,r},Dr.distance=pk,Dr.squaredDistance=mk,Dr.length=gk,Dr.squaredLength=_k,Dr.negate=function(r,e){return r[0]=-e[0],r[1]=-e[1],r},Dr.inverse=function(r,e){return r[0]=1/e[0],r[1]=1/e[1],r},Dr.normalize=function(r,e){var i=e[0],a=e[1],h=i*i+a*a;return h>0&&(h=1/Math.sqrt(h)),r[0]=e[0]*h,r[1]=e[1]*h,r},Dr.dot=function(r,e){return r[0]*e[0]+r[1]*e[1]},Dr.cross=function(r,e,i){var a=e[0]*i[1]-e[1]*i[0];return r[0]=r[1]=0,r[2]=a,r},Dr.lerp=function(r,e,i,a){var h=e[0],p=e[1];return r[0]=h+a*(i[0]-h),r[1]=p+a*(i[1]-p),r},Dr.random=function(r,e){e=e||1;var i=2*Sh.RANDOM()*Math.PI;return r[0]=Math.cos(i)*e,r[1]=Math.sin(i)*e,r},Dr.transformMat2=function(r,e,i){var a=e[0],h=e[1];return r[0]=i[0]*a+i[2]*h,r[1]=i[1]*a+i[3]*h,r},Dr.transformMat2d=function(r,e,i){var a=e[0],h=e[1];return r[0]=i[0]*a+i[2]*h+i[4],r[1]=i[1]*a+i[3]*h+i[5],r},Dr.transformMat3=function(r,e,i){var a=e[0],h=e[1];return r[0]=i[0]*a+i[3]*h+i[6],r[1]=i[1]*a+i[4]*h+i[7],r},Dr.transformMat4=function(r,e,i){var a=e[0],h=e[1];return r[0]=i[0]*a+i[4]*h+i[12],r[1]=i[1]*a+i[5]*h+i[13],r},Dr.rotate=function(r,e,i,a){var h=e[0]-i[0],p=e[1]-i[1],m=Math.sin(a),y=Math.cos(a);return r[0]=h*y-p*m+i[0],r[1]=h*m+p*y+i[1],r},Dr.angle=function(r,e){var i=r[0],a=r[1],h=e[0],p=e[1],m=Math.sqrt(i*i+a*a)*Math.sqrt(h*h+p*p);return Math.acos(Math.min(Math.max(m&&(i*h+a*p)/m,-1),1))},Dr.zero=function(r){return r[0]=0,r[1]=0,r},Dr.str=function(r){return"vec2("+r[0]+", "+r[1]+")"},Dr.exactEquals=function(r,e){return r[0]===e[0]&&r[1]===e[1]},Dr.equals=function(r,e){var i=r[0],a=r[1],h=e[0],p=e[1];return Math.abs(i-h)<=Sh.EPSILON*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-p)<=Sh.EPSILON*Math.max(1,Math.abs(a),Math.abs(p))},Dr.forEach=Dr.sqrLen=Dr.sqrDist=Dr.dist=Dr.div=Dr.mul=Dr.sub=Dr.len=void 0;var Sh=function(r,e){if(r&&r.__esModule)return r;if(r===null||Bb(r)!=="object"&&typeof r!="function")return{default:r};var i=ck(void 0);if(i&&i.has(r))return i.get(r);var a={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in r)if(p!=="default"&&Object.prototype.hasOwnProperty.call(r,p)){var m=h?Object.getOwnPropertyDescriptor(r,p):null;m&&(m.get||m.set)?Object.defineProperty(a,p,m):a[p]=r[p]}return a.default=r,i&&i.set(r,a),a}(Ji);function ck(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(ck=function(a){return a?i:e})(r)}function uk(){var r=new Sh.ARRAY_TYPE(2);return Sh.ARRAY_TYPE!=Float32Array&&(r[0]=0,r[1]=0),r}function hk(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r}function dk(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r}function fk(r,e,i){return r[0]=e[0]/i[0],r[1]=e[1]/i[1],r}function pk(r,e){return Math.hypot(e[0]-r[0],e[1]-r[1])}function mk(r,e){var i=e[0]-r[0],a=e[1]-r[1];return i*i+a*a}function gk(r){return Math.hypot(r[0],r[1])}function _k(r){var e=r[0],i=r[1];return e*e+i*i}Dr.len=gk,Dr.sub=hk,Dr.mul=dk,Dr.div=fk,Dr.dist=pk,Dr.sqrDist=mk,Dr.sqrLen=_k;var u6=function(){var r=uk();return function(e,i,a,h,p,m){var y,b;for(i||(i=2),a||(a=0),b=h?Math.min(h*i+a,e.length):e.length,y=a;y<b;y+=i)r[0]=e[y],r[1]=e[y+1],p(r,r,m),e[y]=r[0],e[y+1]=r[1];return e}}();function jb(r){return jb=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},jb(r)}Dr.forEach=u6,Object.defineProperty(Ki,"__esModule",{value:!0}),s.e=Ki.vec4=s.v=Ki.vec3=Ki.vec2=Ki.quat2=s.q=Ki.quat=s.m=Ki.mat4=s.bx=Ki.mat3=Ki.mat2d=s.h=Ki.mat2=Ki.glMatrix=void 0;var h6=xl(Ji);Ki.glMatrix=h6;var d6=xl(Kn);s.h=Ki.mat2=d6;var f6=xl(ti);Ki.mat2d=f6;var p6=xl(xn);s.bx=Ki.mat3=p6;var m6=xl(Ar);s.m=Ki.mat4=m6;var g6=xl(Sr);s.q=Ki.quat=g6;var _6=xl(Hr);Ki.quat2=_6;var y6=xl(Dr);Ki.vec2=y6;var v6=xl(Ir);s.v=Ki.vec3=v6;var x6=xl(Br);function yk(r){if(typeof WeakMap!="function")return null;var e=new WeakMap,i=new WeakMap;return(yk=function(a){return a?i:e})(r)}function xl(r,e){if(!e&&r&&r.__esModule)return r;if(r===null||jb(r)!=="object"&&typeof r!="function")return{default:r};var i=yk(e);if(i&&i.has(r))return i.get(r);var a={},h=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var p in r)if(p!=="default"&&Object.prototype.hasOwnProperty.call(r,p)){var m=h?Object.getOwnPropertyDescriptor(r,p):null;m&&(m.get||m.set)?Object.defineProperty(a,p,m):a[p]=r[p]}return a.default=r,i&&i.set(r,a),a}s.e=Ki.vec4=x6;const b6=tr([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:pv}=b6,vk=tr([{name:"a_pos_3",components:3,type:"Int16"}]);var Em=tr([{name:"a_pos",type:"Int16",components:2}]),xk={};(function(r,e){(function(i){function a(p,m,y){var b=h(256*p,256*(m=Math.pow(2,y)-m-1),y),E=h(256*(p+1),256*(m+1),y);return b[0]+","+b[1]+","+E[0]+","+E[1]}function h(p,m,y){var b=2*Math.PI*6378137/256/Math.pow(2,y);return[p*b-2*Math.PI*6378137/2,m*b-2*Math.PI*6378137/2]}i.getURL=function(p,m,y,b,E,C){return C=C||{},p+"?"+["bbox="+a(y,b,E),"format="+(C.format||"image/png"),"service="+(C.service||"WMS"),"version="+(C.version||"1.1.1"),"request="+(C.request||"GetMap"),"srs="+(C.srs||"EPSG:3857"),"width="+(C.width||256),"height="+(C.height||256),"layers="+m].join("&")},i.getTileBBox=a,i.getMercCoords=h,Object.defineProperty(i,"__esModule",{value:!0})})(e)})(0,xk);var w6=xk;class Th{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=Sm(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i){const a=w6.getTileBBox(this.x,this.y,this.z),h=function(p,m,y){let b,E="";for(let C=p;C>0;C--)b=1<<C-1,E+=(m&b?1:0)+(y&b?2:0);return E}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class bk{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Sm(e,i.z,i.z,i.x,i.y)}}class so{constructor(e,i,a,h,p){this.overscaledZ=e,this.wrap=i,this.canonical=new Th(a,+h,+p),this.key=i===0&&e===a?this.canonical.key:Sm(i,e,a,h,p)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new so(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new so(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Sm(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Sm(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new so(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,h=2*this.canonical.y;return[new so(i,this.wrap,i,a,h),new so(i,this.wrap,i,a+1,h),new so(i,this.wrap,i,a,h+1),new so(i,this.wrap,i,a+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new so(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new so(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new bk(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Sm(r,e,i,a,h){const p=1<<Math.min(i,22);let m=p*(h%p)+a%p;return r&&i<22&&(m+=p*p*((r<0?-2*r-1:2*r)%(1<<2*(22-i)))),16*(32*m+i)+(e-i)}const E6=[r=>{let e=r.canonical.x-1,i=r.wrap;return e<0&&(e=(1<<r.canonical.z)-1,i--),new so(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>{let e=r.canonical.x+1,i=r.wrap;return e===1<<r.canonical.z&&(e=0,i++),new so(r.overscaledZ,i,r.canonical.z,e,r.canonical.y)},r=>new so(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,(r.canonical.y===0?1<<r.canonical.z:r.canonical.y)-1),r=>new so(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y===(1<<r.canonical.z)-1?0:r.canonical.y+1)];Zt(Th,"CanonicalTileID"),Zt(so,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class $b{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const h=s.v.dot(i,this.dir);if(Math.abs(h)<1e-6)return!1;const p=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/h;return a[0]=this.pos[0]+this.dir[0]*p,a[1]=this.pos[1]+this.dir[1]*p,a[2]=this.pos[2]+this.dir[2]*p,!0}closestPointOnSphere(e,i,a){if(s.v.equals(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[h,p,m]=this.dir,y=this.pos[0]-e[0],b=this.pos[1]-e[1],E=this.pos[2]-e[2],C=h*h+p*p+m*m,A=2*(y*h+b*p+E*m),P=A*A-4*C*(y*y+b*b+E*E-i*i);if(P<0){const R=Math.max(-A/2,0),z=y+h*R,B=b+p*R,V=E+m*R,Q=Math.hypot(z,B,V);return a[0]=z*i/Q,a[1]=B*i/Q,a[2]=V*i/Q,!1}{const R=(-A-Math.sqrt(P))/(2*C);if(R<0){const z=Math.hypot(y,b,E);return a[0]=y*i/z,a[1]=b*i/z,a[2]=E*i/z,!1}return a[0]=y+h*R,a[1]=b+p*R,a[2]=E+m*R,!0}}}class Ub{constructor(e,i,a,h,p){this.TL=e,this.TR=i,this.BR=a,this.BL=h,this.horizon=p}static fromInvProjectionMatrix(e,i,a){const h=[-1,1,1],p=[1,1,1],m=[1,-1,1],y=[-1,-1,1],b=s.v.transformMat4(h,h,e),E=s.v.transformMat4(p,p,e),C=s.v.transformMat4(m,m,e),A=s.v.transformMat4(y,y,e);return new Ub(b,E,C,A,i/a)}}function Tm(r,e,i){let a=1/0,h=-1/0;const p=[];for(const m of r){s.v.sub(p,m,e);const y=s.v.dot(p,i);a=Math.min(a,y),h=Math.max(h,y)}return[a,h]}function wk(r,e){let i=!0;for(let a=0;a<r.planes.length;a++){const h=r.planes[a];let p=0;for(let m=0;m<e.length;m++)p+=s.v.dot(h,e[m])+h[3]>=0;if(p===0)return 0;p!==e.length&&(i=!1)}return i?2:1}function Ek(r,e){for(const i of r.projections){const a=Tm(e,r.points[0],i.axis);if(i.projection[1]<a[0]||i.projection[0]>a[1])return 0}return 1}function Sk(r,e){let i=0;const a=[0,0,0,0];for(let h=0;h<r.length;h++)a[0]=r[h][0],a[1]=r[h][1],a[2]=r[h][2],a[3]=1,s.e.dot(a,e)>=0&&i++;return i}class Vb{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=wi.fromPoints(this.points),this.projections=[],this.frustumEdges=[s.v.sub([],this.points[2],this.points[3]),s.v.sub([],this.points[0],this.points[3]),s.v.sub([],this.points[4],this.points[0]),s.v.sub([],this.points[5],this.points[1]),s.v.sub([],this.points[6],this.points[2]),s.v.sub([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const h=[0,-a[2],a[1]],p=[a[2],0,-a[0]];this.projections.push({axis:h,projection:Tm(this.points,this.points[0],h)}),this.projections.push({axis:p,projection:Tm(this.points,this.points[0],p)})}}static fromInvProjectionMatrix(e,i,a,h){const p=Math.pow(2,a),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(E=>{const C=s.e.transformMat4([],E,e),A=1/C[3]/i*p;return s.e.mul(C,C,[A,A,h?1/C[3]:A,A])}),y=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(E=>{const C=s.v.sub([],m[E[0]],m[E[1]]),A=s.v.sub([],m[E[2]],m[E[1]]),P=s.v.normalize([],s.v.cross([],C,A)),R=-s.v.dot(P,m[E[1]]);return P.concat(R)}),b=[];for(let E=0;E<m.length;E++)b.push([m[E][0],m[E][1],m[E][2]]);return new Vb(b,y)}intersectsPrecise(e,i,a){for(let h=0;h<i.length;h++)if(!Sk(e,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!Sk(e,this.planes[h]))return 0;for(const h of a)for(const p of this.frustumEdges){const m=s.v.cross([],h,p),y=s.v.length(m);if(y===0)continue;s.v.scale(m,m,1/y);const b=Tm(this.points,this.points[0],m),E=Tm(e,this.points[0],m);if(b[0]>E[1]||E[0]>b[1])return 0}return 1}}class wi{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const h of e)s.v.min(i,i,h),s.v.max(a,a,h);return new wi(i,a)}static fromTileIdAndHeight(e,i,a){const h=1<<e.canonical.z,p=e.canonical.x,m=e.canonical.y;return new wi([p/h,m/h,i],[(p+1)/h,(m+1)/h,a])}static applyTransform(e,i){const a=e.getCorners();for(let h=0;h<a.length;++h)s.v.transformMat4(a[h],a[h],i);return wi.fromPoints(a)}static projectAabbCorners(e,i){const a=e.getCorners();for(let h=0;h<a.length;++h)s.v.transformMat4(a[h],a[h],i);return a}constructor(e,i){this.min=e,this.max=i,this.center=s.v.scale([],s.v.add([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=s.v.clone(this.min),h=s.v.clone(this.max);for(let p=0;p<i.length;p++)a[p]=i[p]?this.min[p]:this.center[p],h[p]=i[p]?this.center[p]:this.max[p];return h[2]=this.max[2],new wi(a,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?wk(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?wk(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?Ek(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?Ek(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Zt(wi,"Aabb");const Gb=5,Tk=6,Qs=kt/Math.PI/2,S6=16383,Xd=64,qb=[Xd,32,16],ya=-Qs,va=Qs,T6=[new wi([ya,ya,ya],[va,va,va]),new wi([ya,ya,ya],[0,0,va]),new wi([0,ya,ya],[va,0,va]),new wi([ya,0,ya],[0,va,va]),new wi([0,0,ya],[va,va,va])];function mv(r){return r*Qs/Im}function Ck(r,e,i,a=!0){const h=s.v.scale([],r._camera.position,r.worldSize),p=[e,i,1,1];s.e.transformMat4(p,p,r.pixelMatrixInverse),s.e.scale(p,p,1/p[3]);const m=s.v.sub([],p,h),y=s.v.normalize([],m),b=r.globeMatrix,E=[b[12],b[13],b[14]],C=s.v.sub([],E,h),A=s.v.length(C),P=s.v.normalize([],C),R=r.worldSize/(2*Math.PI),z=s.v.dot(P,y),B=Math.asin(R/A);if(B<Math.acos(z)){if(!a)return null;const Ve=[],ht=[];s.v.scale(Ve,y,A/z),s.v.normalize(ht,s.v.sub(ht,Ve,C)),s.v.normalize(y,s.v.add(y,C,s.v.scale(y,ht,Math.tan(B)*A)))}const V=[];new $b(h,y).closestPointOnSphere(E,R,V);const Q=s.v.normalize([],$t(b,0)),ae=s.v.normalize([],$t(b,1)),le=s.v.normalize([],$t(b,2)),he=s.v.dot(Q,V),me=s.v.dot(ae,V),ve=s.v.dot(le,V),Pe=De(Math.asin(-me/R));let Ne=De(Math.atan2(he,ve));Ne=r.center.lng+function(Ve,ht){const Ct=(ht-Ve+180)%360-180;return Ct<-180?Ct+360:Ct}(r.center.lng,Ne);const je=wl(Ne),Ye=rt(El(Pe),0,1);return new Eo(je,Ye)}class C6{constructor(e,i,a){this.a=s.v.sub([],e,a),this.b=s.v.sub([],i,a),this.center=a;const h=s.v.normalize([],this.a),p=s.v.normalize([],this.b);this.angle=Math.acos(s.v.dot(h,p))}}function Wb(r,e){if(r.angle===0)return null;let i;return i=r.a[e]===0?1/r.angle*.5*Math.PI:1/r.angle*Math.atan(r.b[e]/r.a[e]/Math.sin(r.angle)-1/Math.tan(r.angle)),i<0||i>1?null:function(a,h,p,m){const y=Math.sin(p);return a*(Math.sin((1-m)*p)/y)+h*(Math.sin(m*p)/y)}(r.a[e],r.b[e],r.angle,rt(i,0,1))+r.center[e]}function bl(r){if(r.z<=1)return T6[r.z+2*r.y+r.x];const e=Hb(gv(r));return wi.fromPoints(e)}function sc(r,e,i){return s.v.scale(r,r,1-i),s.v.scaleAndAdd(r,r,e,i)}function Mk(r,e){const i=ac(e.zoom);if(i===0)return bl(r);const a=gv(r),h=Hb(a),p=wl(a.getWest())*e.worldSize,m=wl(a.getEast())*e.worldSize,y=El(a.getNorth())*e.worldSize,b=El(a.getSouth())*e.worldSize,E=[p,y,0],C=[m,y,0],A=[p,b,0],P=[m,b,0],R=s.m.invert([],e.globeMatrix);return s.v.transformMat4(E,E,R),s.v.transformMat4(C,C,R),s.v.transformMat4(A,A,R),s.v.transformMat4(P,P,R),h[0]=sc(h[0],A,i),h[1]=sc(h[1],P,i),h[2]=sc(h[2],C,i),h[3]=sc(h[3],E,i),wi.fromPoints(h)}function Ik(r,e,i){for(const a of r)s.v.transformMat4(a,a,e),s.v.scale(a,a,i)}function Ak(r,e,i,a){const h=e/r.worldSize,p=r.globeMatrix;if(i.z<=1){const je=bl(i).getCorners();return Ik(je,p,h),wi.fromPoints(je)}const m=gv(i,a),y=Hb(m);Ik(y,p,h);const b=Number.MAX_VALUE,E=[-b,-b,-b],C=[b,b,b];if(m.contains(r.center)){for(const Ve of y)s.v.min(C,C,Ve),s.v.max(E,E,Ve);E[2]=0;const je=r.point,Ye=[je.x*h,je.y*h,0];return s.v.min(C,C,Ye),s.v.max(E,E,Ye),new wi(C,E)}const A=[p[12]*h,p[13]*h,p[14]*h],P=m.getCenter(),R=rt(r.center.lat,-_i,_i),z=rt(P.lat,-_i,_i),B=wl(r.center.lng),V=El(R);let Q=B-wl(P.lng);const ae=V-El(z);Q>.5?Q-=1:Q<-.5&&(Q+=1);let le=0;if(Math.abs(Q)>Math.abs(ae))le=Q>=0?1:3;else{le=ae>=0?0:2;const je=[p[4]*h,p[5]*h,p[6]*h],Ye=-Math.sin(ze(ae>=0?m.getSouth():m.getNorth()))*Qs;s.v.scaleAndAdd(A,A,je,Ye)}const he=y[le],me=y[(le+1)%4],ve=new C6(he,me,A),Pe=[Wb(ve,0)||he[0],Wb(ve,1)||he[1],Wb(ve,2)||he[2]],Ne=ac(r.zoom);if(Ne>0){const je=function({x:Ve,y:ht,z:Ct},st,wt,ot,Rt){const Ht=1/(1<<Ct);let Tt=Ve*Ht,hr=Tt+Ht,Yt=ht*Ht,Pt=Yt+Ht,dr=0;const rr=(Tt+hr)/2-ot;return rr>.5?dr=-1:rr<-.5&&(dr=1),Tt=((Tt+dr)*st-(ot*=st))*wt+ot,hr=((hr+dr)*st-ot)*wt+ot,Yt=(Yt*st-(Rt*=st))*wt+Rt,Pt=(Pt*st-Rt)*wt+Rt,[[Tt,Pt,0],[hr,Pt,0],[hr,Yt,0],[Tt,Yt,0]]}(i,e,r._pixelsPerMercatorPixel,B,V);for(let Ve=0;Ve<y.length;Ve++)sc(y[Ve],je[Ve],Ne);const Ye=s.v.add([],je[le],je[(le+1)%4]);s.v.scale(Ye,Ye,.5),sc(Pe,Ye,Ne)}for(const je of y)s.v.min(C,C,je),s.v.max(E,E,je);return C[2]=Math.min(he[2],me[2]),s.v.min(C,C,Pe),s.v.max(E,E,Pe),new wi(C,E)}function gv({x:r,y:e,z:i},a=!1){const h=1/(1<<i),p=new hn(Ps(r*h),e===(1<<i)-1&&a?-90:fo((e+1)*h)),m=new hn(Ps((r+1)*h),e===0&&a?90:fo(e*h));return new Yc(p,m)}function Hb(r){const e=ze(r.getNorth()),i=ze(r.getSouth()),a=Math.cos(e),h=Math.cos(i),p=Math.sin(e),m=Math.sin(i),y=r.getWest(),b=r.getEast();return[Yd(h,m,y),Yd(h,m,b),Yd(a,p,b),Yd(a,p,y)]}function Yd(r,e,i,a=Qs){return i=ze(i),[r*Math.sin(i)*a,-e*a,r*Math.cos(i)*a]}function Ch(r,e,i){return Yd(Math.cos(ze(r)),Math.sin(ze(r)),e,i)}function Cm(r,e,i,a){const h=1<<i.z,p=(r/kt+i.x)/h;return Ch(fo((e/kt+i.y)/h),Ps(p),a)}function _v({min:r,max:e}){return S6/Math.max(e[0]-r[0],e[1]-r[1],e[2]-r[2])}const kk=new Float64Array(16);function Mm(r){const e=_v(r),i=s.m.fromScaling(kk,[e,e,e]);return s.m.translate(i,i,s.v.negate([],r.min))}function Zb(r){const e=s.m.fromTranslation(kk,r.min),i=1/_v(r);return s.m.scale(e,e,[i,i,i])}function Xb(r){const e=kt/(2*Math.PI);return r/(2*Math.PI)/e}function Pk(r,e){return kt/(512*Math.pow(2,r))*_v(bl(e))}function Ok(r,e,i,a,h){const p=Xb(i),m=[r,e,-i/(2*Math.PI)],y=s.m.identity(new Float64Array(16));return s.m.translate(y,y,m),s.m.scale(y,y,[p,p,p]),s.m.rotateX(y,y,ze(-h)),s.m.rotateY(y,y,ze(-a)),y}function ac(r){return Gt(Gb,Tk,r)}function Dk(r,e){const i=Ch(e.lat,e.lng),a=function(p){const m=Ch(p._center.lat,p._center.lng),y=s.v.fromValues(0,1,0);let b=s.v.cross([],y,m);const E=s.m.fromRotation([],-p.angle,m);b=s.v.transformMat4(b,b,E),s.m.fromRotation(E,-p._pitch,b);const C=s.v.normalize([],m);return s.v.scale(C,C,mv(p.cameraToCenterDistance/p.pixelsPerMeter)),s.v.transformMat4(C,C,E),s.v.add([],m,C)}(r),h=s.v.subtract([],a,i);return s.v.angle(h,i)}function Yb(r,e){return Dk(r,e)>Math.PI/2*1.01}const Rk=ze(85),M6=Math.cos(Rk),I6=Math.sin(Rk),Im=63710088e-1,Qb=2*Math.PI*Im;class Kc{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Kc(Vt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,h=e.lat*i,p=Math.sin(a)*Math.sin(h)+Math.cos(a)*Math.cos(h)*Math.cos((e.lng-this.lng)*i);return Im*Math.acos(Math.min(p,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new Yc(new Kc(this.lng-a,this.lat-i),new Kc(this.lng+a,this.lat+i))}toEcef(e){const i=mv(e);return Ch(this.lat,this.lng,Qs+i)}static convert(e){if(e instanceof Kc)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Kc(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Kc(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var hn=Kc;const A6=0,k6=25.5;function Kb(r){return Qb*Math.cos(r*Math.PI/180)}function wl(r){return(180+r)/360}function El(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function Qo(r,e){return r/Kb(e)}function Ps(r){return 360*r-180}function fo(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}function Lk(r,e){return r*Kb(fo(e))}const _i=85.051129;function zk(r){return Math.cos(ze(rt(r,-_i,_i)))}function Mh(r,e){const i=rt(e,A6,k6),a=Math.pow(2,i);return zk(r)*Qb/(512*a)}function Nk(r){return 1/Math.cos(r*Math.PI/180)}function yv(r,e=0){const i=Math.exp(Math.PI*(1-(r.y+e/kt)/(1<<r.z)*2));return 80150034*i/(i*i+1)/kt/(1<<r.z)}class Eo{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=hn.convert(e);return new Eo(wl(a.lng),El(a.lat),Qo(i,a.lat))}toLngLat(){return new hn(Ps(this.x),fo(this.y))}toAltitude(){return Lk(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Qb*Nk(fo(this.y))}}function Jb(r,e,i,a,h,p,m,y,b){const E=(e+a)/2,C=(i+h)/2,A=new se(E,C);y(A),function(P,R,z,B,V,Q){const ae=z-V,le=B-Q;return Math.abs((B-R)*ae-(z-P)*le)/Math.hypot(ae,le)}(A.x,A.y,p.x,p.y,m.x,m.y)>=b?(Jb(r,e,i,E,C,p,A,y,b),Jb(r,E,C,a,h,A,m,y,b)):r.push(m)}function Fk(r,e,i){let a=r[0],h=a.x,p=a.y;e(a);const m=[a];for(let y=1;y<r.length;y++){const b=r[y],{x:E,y:C}=b;e(b),Jb(m,h,p,E,C,a,b,e,i),h=E,p=C,a=b}return m}function ew(r,e,i,a){if(a(e,i)){const h=e.add(i)._mult(.5);ew(r,e,h,a),ew(r,h,i,a)}else r.push(i)}function P6(r,e){let i=r[0];const a=[i];for(let h=1;h<r.length;h++){const p=r[h];ew(a,i,p,e),i=p}return a}const tw=Math.pow(2,14)-1,Bk=-tw-1;function O6(r,e){const i=Math.round(r.x*e),a=Math.round(r.y*e);return r.x=rt(i,Bk,tw),r.y=rt(a,Bk,tw),(i<r.x||i>r.x+1||a<r.y||a>r.y+1)&&mr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),r}function Sl(r,e,i){const a=r.loadGeometry(),h=r.extent,p=kt/h;if(e&&i&&i.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:y,x:b,y:E,projection:C}=i,A=P=>{const R=Ps((e.x+P.x/h)/m),z=fo((e.y+P.y/h)/m),B=C.project(R,z);P.x=(B.x*y-b)*h,P.y=(B.y*y-E)*h};for(let P=0;P<a.length;P++)if(r.type!==1)a[P]=Fk(a[P],A,1);else{const R=[];for(const z of a[P])z.x<0||z.x>=h||z.y<0||z.y>=h||(A(z),R.push(z));a[P]=R}}for(const m of a)for(const y of m)O6(y,p);return a}function Jc(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?Sl(r):[]}}function vv(r,e,i,a,h){r.emplaceBack(2*e+(a+1)/2,2*i+(h+1)/2)}function xv(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class rw{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Cr,this.indexArray=new vn,this.segments=new Qn,this.programConfigurations=new Xc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a,h){const p=this.layers[0],m=[];let y=null;p.type==="circle"&&(y=p.layout.get("circle-sort-key"));for(const{feature:E,id:C,index:A,sourceLayerIndex:P}of e){const R=this.layers[0]._featureFilter.needGeometry,z=Jc(E,R);if(!this.layers[0]._featureFilter.filter(new Ae(this.zoom),z,a))continue;const B=y?y.evaluate(z,{},a):void 0,V={id:C,properties:E.properties,type:E.type,sourceLayerIndex:P,index:A,geometry:R?z.geometry:Sl(E,a,h),patterns:{},sortKey:B};m.push(V)}y&&m.sort((E,C)=>E.sortKey-C.sortKey);let b=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Vn,b=h.projection);for(const E of m){const{geometry:C,index:A,sourceLayerIndex:P}=E,R=e[A].feature;this.addFeature(E,C,A,i.availableImages,a,b,i.brightness),i.featureIndex.insert(R,C,A,P,this.index)}}update(e,i,a,h,p){const m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,m?this.stateDependentLayers:this.layers,a,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vj.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Gj.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,i,a,h,p,m,y){for(const b of i)for(const E of b){const C=E.x,A=E.y;if(C<0||C>=kt||A<0||A>=kt)continue;if(m){const z=m.projectTilePoint(C,A,p),B=m.upVector(p,C,A),V=this.globeExtVertexArray;xv(V,z,B),xv(V,z,B),xv(V,z,B),xv(V,z,B)}const P=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),R=P.vertexLength;vv(this.layoutVertexArray,C,A,-1,-1),vv(this.layoutVertexArray,C,A,1,-1),vv(this.layoutVertexArray,C,A,1,1),vv(this.layoutVertexArray,C,A,-1,1),this.indexArray.emplaceBack(R,R+1,R+2),this.indexArray.emplaceBack(R,R+2,R+3),P.vertexLength+=4,P.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},h,p,y)}}function jk(r,e){for(let i=0;i<r.length;i++)if(Ih(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(Ih(r,e[i]))return!0;return!!nw(r,e)}function D6(r,e,i){return!!Ih(r,e)||!!iw(e,r,i)}function $k(r,e){if(r.length===1)return Vk(e,r[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let h=0;h<a.length;h++)if(Ih(r,a[h]))return!0}for(let i=0;i<r.length;i++)if(Vk(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(nw(r,e[i]))return!0;return!1}function R6(r,e,i){if(r.length>1){if(nw(r,e))return!0;for(let a=0;a<e.length;a++)if(iw(e[a],r,i))return!0}for(let a=0;a<r.length;a++)if(iw(r[a],e,i))return!0;return!1}function nw(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const a=r[i],h=r[i+1];for(let p=0;p<e.length-1;p++)if(L6(a,h,e[p],e[p+1]))return!0}return!1}function L6(r,e,i,a){return vt(r,i,a)!==vt(e,i,a)&&vt(r,e,i)!==vt(r,e,a)}function iw(r,e,i){const a=i*i;if(e.length===1)return r.distSqr(e[0])<a;for(let h=1;h<e.length;h++)if(Uk(r,e[h-1],e[h])<a)return!0;return!1}function Uk(r,e,i){const a=e.distSqr(i);if(a===0)return r.distSqr(e);const h=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/a;return r.distSqr(h<0?e:h>1?i:i.sub(e)._mult(h)._add(e))}function Vk(r,e){let i,a,h,p=!1;for(let m=0;m<r.length;m++){i=r[m];for(let y=0,b=i.length-1;y<i.length;b=y++)a=i[y],h=i[b],a.y>e.y!=h.y>e.y&&e.x<(h.x-a.x)*(e.y-a.y)/(h.y-a.y)+a.x&&(p=!p)}return p}function Ih(r,e){let i=!1;for(let a=0,h=r.length-1;a<r.length;h=a++){const p=r[a],m=r[h];p.y>e.y!=m.y>e.y&&e.x<(m.x-p.x)*(e.y-p.y)/(m.y-p.y)+p.x&&(i=!i)}return i}function Gk(r,e,i,a,h){for(const m of r)if(e<=m.x&&i<=m.y&&a>=m.x&&h>=m.y)return!0;const p=[new se(e,i),new se(e,h),new se(a,h),new se(a,i)];if(r.length>2){for(const m of p)if(Ih(r,m))return!0}for(let m=0;m<r.length-1;m++)if(z6(r[m],r[m+1],p))return!0;return!1}function z6(r,e,i){const a=i[0],h=i[2];if(r.x<a.x&&e.x<a.x||r.x>h.x&&e.x>h.x||r.y<a.y&&e.y<a.y||r.y>h.y&&e.y>h.y)return!1;const p=vt(r,e,i[0]);return p!==vt(r,e,i[1])||p!==vt(r,e,i[2])||p!==vt(r,e,i[3])}function Qd(r,e,i,a,h,p){let m=e.y-r.y,y=r.x-e.x;if(p=p||0){const b=m*m+y*y;if(b===0)return!0;const E=Math.sqrt(b);m/=E,y/=E}return!((i.x-r.x)*m+(i.y-r.y)*y-p<0||(a.x-r.x)*m+(a.y-r.y)*y-p<0||(h.x-r.x)*m+(h.y-r.y)*y-p<0)}function ow(r,e,i,a,h,p,m){return!(Qd(r,e,a,h,p,m)||Qd(e,i,a,h,p,m)||Qd(i,r,a,h,p,m)||Qd(a,h,r,e,i,m)||Qd(h,p,r,e,i,m)||Qd(p,a,r,e,i,m))}function Kd(r,e,i){const a=e.paint.get(r).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(r)}function bv(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function qk(r,e,i,a,h){if(!e[0]&&!e[1])return r;const p=se.convert(e)._mult(h);i==="viewport"&&p._rotate(-a);const m=[];for(let y=0;y<r.length;y++)m.push(r[y].sub(p));return m}function Wk(r,e,i,a){const h=se.convert(r)._mult(a);return e==="viewport"&&h._rotate(-i),h}Zt(rw,"CircleBucket",{omit:["layers"]});const N6=new pt({"circle-sort-key":new $e(Ge.layout_circle["circle-sort-key"]),visibility:new ye(Ge.layout_circle.visibility)});var F6={paint:new pt({"circle-radius":new $e(Ge.paint_circle["circle-radius"]),"circle-color":new $e(Ge.paint_circle["circle-color"]),"circle-blur":new $e(Ge.paint_circle["circle-blur"]),"circle-opacity":new $e(Ge.paint_circle["circle-opacity"]),"circle-translate":new ye(Ge.paint_circle["circle-translate"]),"circle-translate-anchor":new ye(Ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ye(Ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ye(Ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new $e(Ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new $e(Ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new $e(Ge.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ye(Ge.paint_circle["circle-emissive-strength"])}),layout:N6};const B6=s.m.create(),Hk=r=>{const e=[];return r.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),r.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function Zk(r,e,i,a,h,p,m,y,b){if(p&&r.queryGeometry.isAboveHorizon)return!1;p&&(b*=r.pixelToTileUnitsFactor);const E=r.tileID.canonical,C=i.projection.upVectorScale(E,i.center.lat,i.worldSize).metersToTile;for(const A of e)for(const P of A){const R=P.add(y),z=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(R.x,R.y,!0):0,B=i.projection.projectTilePoint(R.x,R.y,E);if(z>0){const le=i.projection.upVector(E,R.x,R.y);B.x+=le[0]*C*z,B.y+=le[1]*C*z,B.z+=le[2]*C*z}const V=p?R:j6(B.x,B.y,B.z,a),Q=p?r.tilespaceRays.map(le=>U6(le,z)):r.queryGeometry.screenGeometry,ae=s.e.transformMat4([],[B.x,B.y,B.z,1],a);if(!m&&p?b*=ae[3]/i.cameraToCenterDistance:m&&!p&&(b*=i.cameraToCenterDistance/ae[3]),p){const le=fo((P.y/kt+E.y)/(1<<E.z));b/=i.projection.pixelsPerMeter(le,1)/Qo(1,le)}if(D6(Q,V,b))return!0}return!1}function j6(r,e,i,a){const h=s.e.transformMat4([],[r,e,i,1],a);return new se(h[0]/h[3],h[1]/h[3])}const Xk=s.v.fromValues(0,0,0),$6=s.v.fromValues(0,0,1);function U6(r,e){const i=s.v.create();return Xk[2]=e,r.intersectsPlane(Xk,$6,i),new se(i[0],i[1])}class Yk extends rw{}function Qk(r,{width:e,height:i},a,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*i*a)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*i*a);return r.width=e,r.height=i,r.data=h,r}function Kk(r,e,i){const{width:a,height:h}=e;a===r.width&&h===r.height||(sw(r,e,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,a),height:Math.min(r.height,h)},i),r.width=a,r.height=h,r.data=e.data)}function sw(r,e,i,a,h,p,m){if(h.width===0||h.height===0)return e;if(h.width>r.width||h.height>r.height||i.x>r.width-h.width||i.y>r.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||a.x>e.width-h.width||a.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,b=e.data,E=p===4&&m;for(let C=0;C<h.height;C++){const A=((i.y+C)*r.width+i.x)*p,P=((a.y+C)*e.width+a.x)*p;if(E)for(let R=0;R<h.width;R++){const z=A+R*p+3,B=P+R*p;b[B+0]=255,b[B+1]=255,b[B+2]=255,b[B+3]=y[z]}else for(let R=0;R<h.width*p;R++)b[P+R]=y[A+R]}return e}Zt(Yk,"HeatmapBucket",{omit:["layers"]});class lc{constructor(e,i){Qk(this,e,1,i)}resize(e){Kk(this,new lc(e),1)}clone(){return new lc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,h,p){sw(e,i,a,h,p,1)}}class Ks{constructor(e,i){Qk(this,e,4,i)}resize(e){Kk(this,new Ks(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Ks({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,h,p,m){sw(e,i,a,h,p,4,m)}}class Jk{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}Zt(lc,"AlphaImage"),Zt(Ks,"RGBAImage");const V6=new pt({visibility:new ye(Ge.layout_heatmap.visibility)});var G6={paint:new pt({"heatmap-radius":new $e(Ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new $e(Ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ye(Ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new St(Ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ye(Ge.paint_heatmap["heatmap-opacity"])}),layout:V6};function wv(r){const e={},i=r.resolution||256,a=r.clips?r.clips.length:1,h=r.image||new Ks({width:i,height:a}),p=(m,y,b)=>{e[r.evaluationKey]=b;const E=r.expression.evaluate(e);E&&(h.data[m+y+0]=Math.floor(255*E.r/E.a),h.data[m+y+1]=Math.floor(255*E.g/E.a),h.data[m+y+2]=Math.floor(255*E.b/E.a),h.data[m+y+3]=Math.floor(255*E.a))};if(r.clips)for(let m=0,y=0;m<a;++m,y+=4*i)for(let b=0,E=0;b<i;b++,E+=4){const C=b/(i-1),{start:A,end:P}=r.clips[m];p(y,E,A*(1-C)+P*C)}else for(let m=0,y=0;m<i;m++,y+=4)p(0,y,m/(i-1));return h}const q6=new pt({visibility:new ye(Ge.layout_hillshade.visibility)});var W6={paint:new pt({"hillshade-illumination-direction":new ye(Ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ye(Ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ye(Ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ye(Ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ye(Ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ye(Ge.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ye(Ge.paint_hillshade["hillshade-emissive-strength"])}),layout:q6};const H6=tr([{name:"a_pos",components:2,type:"Int16"}],4),{members:Z6}=H6;var aw={exports:{}};function Ev(r,e,i){i=i||2;var a,h,p,m,y,b,E,C=e&&e.length,A=C?e[0]*i:r.length,P=eP(r,0,A,i,!0),R=[];if(!P||P.next===P.prev)return R;if(C&&(P=function(B,V,Q,ae){var le,he,me,ve=[];for(le=0,he=V.length;le<he;le++)(me=eP(B,V[le]*ae,le<he-1?V[le+1]*ae:B.length,ae,!1))===me.next&&(me.steiner=!0),ve.push(r8(me));for(ve.sort(J6),le=0;le<ve.length;le++)Q=e8(ve[le],Q);return Q}(r,e,P,i)),r.length>80*i){a=p=r[0],h=m=r[1];for(var z=i;z<A;z+=i)(y=r[z])<a&&(a=y),(b=r[z+1])<h&&(h=b),y>p&&(p=y),b>m&&(m=b);E=(E=Math.max(p-a,m-h))!==0?32767/E:0}return Am(P,R,i,a,h,E,0),R}function eP(r,e,i,a,h){var p,m;if(h===uw(r,e,i,a)>0)for(p=e;p<i;p+=a)m=nP(p,r[p],r[p+1],m);else for(p=i-a;p>=e;p-=a)m=nP(p,r[p],r[p+1],m);return m&&Sv(m,m.next)&&(Pm(m),m=m.next),m}function Ah(r,e){if(!r)return r;e||(e=r);var i,a=r;do if(i=!1,a.steiner||!Sv(a,a.next)&&zi(a.prev,a,a.next)!==0)a=a.next;else{if(Pm(a),(a=e=a.prev)===a.next)break;i=!0}while(i||a!==e);return e}function Am(r,e,i,a,h,p,m){if(r){!m&&p&&function(C,A,P,R){var z=C;do z.z===0&&(z.z=lw(z.x,z.y,A,P,R)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==C);z.prevZ.nextZ=null,z.prevZ=null,function(B){var V,Q,ae,le,he,me,ve,Pe,Ne=1;do{for(Q=B,B=null,he=null,me=0;Q;){for(me++,ae=Q,ve=0,V=0;V<Ne&&(ve++,ae=ae.nextZ);V++);for(Pe=Ne;ve>0||Pe>0&&ae;)ve!==0&&(Pe===0||!ae||Q.z<=ae.z)?(le=Q,Q=Q.nextZ,ve--):(le=ae,ae=ae.nextZ,Pe--),he?he.nextZ=le:B=le,le.prevZ=he,he=le;Q=ae}he.nextZ=null,Ne*=2}while(me>1)}(z)}(r,a,h,p);for(var y,b,E=r;r.prev!==r.next;)if(y=r.prev,b=r.next,p?Y6(r,a,h,p):X6(r))e.push(y.i/i|0),e.push(r.i/i|0),e.push(b.i/i|0),Pm(r),r=b.next,E=b.next;else if((r=b)===E){m?m===1?Am(r=Q6(Ah(r),e,i),e,i,a,h,p,2):m===2&&K6(r,e,i,a,h,p):Am(Ah(r),e,i,a,h,p,1);break}}}function X6(r){var e=r.prev,i=r,a=r.next;if(zi(e,i,a)>=0)return!1;for(var h=e.x,p=i.x,m=a.x,y=e.y,b=i.y,E=a.y,C=h<p?h<m?h:m:p<m?p:m,A=y<b?y<E?y:E:b<E?b:E,P=h>p?h>m?h:m:p>m?p:m,R=y>b?y>E?y:E:b>E?b:E,z=a.next;z!==e;){if(z.x>=C&&z.x<=P&&z.y>=A&&z.y<=R&&Jd(h,y,p,b,m,E,z.x,z.y)&&zi(z.prev,z,z.next)>=0)return!1;z=z.next}return!0}function Y6(r,e,i,a){var h=r.prev,p=r,m=r.next;if(zi(h,p,m)>=0)return!1;for(var y=h.x,b=p.x,E=m.x,C=h.y,A=p.y,P=m.y,R=y<b?y<E?y:E:b<E?b:E,z=C<A?C<P?C:P:A<P?A:P,B=y>b?y>E?y:E:b>E?b:E,V=C>A?C>P?C:P:A>P?A:P,Q=lw(R,z,e,i,a),ae=lw(B,V,e,i,a),le=r.prevZ,he=r.nextZ;le&&le.z>=Q&&he&&he.z<=ae;){if(le.x>=R&&le.x<=B&&le.y>=z&&le.y<=V&&le!==h&&le!==m&&Jd(y,C,b,A,E,P,le.x,le.y)&&zi(le.prev,le,le.next)>=0||(le=le.prevZ,he.x>=R&&he.x<=B&&he.y>=z&&he.y<=V&&he!==h&&he!==m&&Jd(y,C,b,A,E,P,he.x,he.y)&&zi(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;le&&le.z>=Q;){if(le.x>=R&&le.x<=B&&le.y>=z&&le.y<=V&&le!==h&&le!==m&&Jd(y,C,b,A,E,P,le.x,le.y)&&zi(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;he&&he.z<=ae;){if(he.x>=R&&he.x<=B&&he.y>=z&&he.y<=V&&he!==h&&he!==m&&Jd(y,C,b,A,E,P,he.x,he.y)&&zi(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function Q6(r,e,i){var a=r;do{var h=a.prev,p=a.next.next;!Sv(h,p)&&tP(h,a,a.next,p)&&km(h,p)&&km(p,h)&&(e.push(h.i/i|0),e.push(a.i/i|0),e.push(p.i/i|0),Pm(a),Pm(a.next),a=r=p),a=a.next}while(a!==r);return Ah(a)}function K6(r,e,i,a,h,p){var m=r;do{for(var y=m.next.next;y!==m.prev;){if(m.i!==y.i&&n8(m,y)){var b=rP(m,y);return m=Ah(m,m.next),b=Ah(b,b.next),Am(m,e,i,a,h,p,0),void Am(b,e,i,a,h,p,0)}y=y.next}m=m.next}while(m!==r)}function J6(r,e){return r.x-e.x}function e8(r,e){var i=function(h,p){var m,y=p,b=h.x,E=h.y,C=-1/0;do{if(E<=y.y&&E>=y.next.y&&y.next.y!==y.y){var A=y.x+(E-y.y)*(y.next.x-y.x)/(y.next.y-y.y);if(A<=b&&A>C&&(C=A,m=y.x<y.next.x?y:y.next,A===b))return m}y=y.next}while(y!==p);if(!m)return null;var P,R=m,z=m.x,B=m.y,V=1/0;y=m;do b>=y.x&&y.x>=z&&b!==y.x&&Jd(E<B?b:C,E,z,B,E<B?C:b,E,y.x,y.y)&&(P=Math.abs(E-y.y)/(b-y.x),km(y,h)&&(P<V||P===V&&(y.x>m.x||y.x===m.x&&t8(m,y)))&&(m=y,V=P)),y=y.next;while(y!==R);return m}(r,e);if(!i)return e;var a=rP(i,r);return Ah(a,a.next),Ah(i,i.next)}function t8(r,e){return zi(r.prev,r,e.prev)<0&&zi(e.next,r,r.next)<0}function lw(r,e,i,a,h){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*h|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function r8(r){var e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Jd(r,e,i,a,h,p,m,y){return(h-m)*(e-y)>=(r-m)*(p-y)&&(r-m)*(a-y)>=(i-m)*(e-y)&&(i-m)*(p-y)>=(h-m)*(a-y)}function n8(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,a){var h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==a.i&&h.next.i!==a.i&&tP(h,h.next,i,a))return!0;h=h.next}while(h!==i);return!1}(r,e)&&(km(r,e)&&km(e,r)&&function(i,a){var h=i,p=!1,m=(i.x+a.x)/2,y=(i.y+a.y)/2;do h.y>y!=h.next.y>y&&h.next.y!==h.y&&m<(h.next.x-h.x)*(y-h.y)/(h.next.y-h.y)+h.x&&(p=!p),h=h.next;while(h!==i);return p}(r,e)&&(zi(r.prev,r,e.prev)||zi(r,e.prev,e))||Sv(r,e)&&zi(r.prev,r,r.next)>0&&zi(e.prev,e,e.next)>0)}function zi(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function Sv(r,e){return r.x===e.x&&r.y===e.y}function tP(r,e,i,a){var h=Cv(zi(r,e,i)),p=Cv(zi(r,e,a)),m=Cv(zi(i,a,r)),y=Cv(zi(i,a,e));return h!==p&&m!==y||!(h!==0||!Tv(r,i,e))||!(p!==0||!Tv(r,a,e))||!(m!==0||!Tv(i,r,a))||!(y!==0||!Tv(i,e,a))}function Tv(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function Cv(r){return r>0?1:r<0?-1:0}function km(r,e){return zi(r.prev,r,r.next)<0?zi(r,e,r.next)>=0&&zi(r,r.prev,e)>=0:zi(r,e,r.prev)<0||zi(r,r.next,e)<0}function rP(r,e){var i=new cw(r.i,r.x,r.y),a=new cw(e.i,e.x,e.y),h=r.next,p=e.prev;return r.next=e,e.prev=r,i.next=h,h.prev=i,a.next=i,i.prev=a,p.next=a,a.prev=p,a}function nP(r,e,i,a){var h=new cw(r,e,i);return a?(h.next=a.next,h.prev=a,a.next.prev=h,a.next=h):(h.prev=h,h.next=h),h}function Pm(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function cw(r,e,i){this.i=r,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function uw(r,e,i,a){for(var h=0,p=e,m=i-a;p<i;p+=a)h+=(r[m]-r[p])*(r[p+1]+r[m+1]),m=p;return h}aw.exports=Ev,aw.exports.default=Ev,Ev.deviation=function(r,e,i,a){var h=e&&e.length,p=Math.abs(uw(r,0,h?e[0]*i:r.length,i));if(h)for(var m=0,y=e.length;m<y;m++)p-=Math.abs(uw(r,e[m]*i,m<y-1?e[m+1]*i:r.length,i));var b=0;for(m=0;m<a.length;m+=3){var E=a[m]*i,C=a[m+1]*i,A=a[m+2]*i;b+=Math.abs((r[E]-r[A])*(r[C+1]-r[E+1])-(r[E]-r[C])*(r[A+1]-r[E+1]))}return p===0&&b===0?0:Math.abs((b-p)/p)},Ev.flatten=function(r){for(var e=r[0][0].length,i={vertices:[],holes:[],dimensions:e},a=0,h=0;h<r.length;h++){for(var p=0;p<r[h].length;p++)for(var m=0;m<e;m++)i.vertices.push(r[h][p][m]);h>0&&i.holes.push(a+=r[h-1].length)}return i};var Mv=J(aw.exports);function hw(r,e){const i=r.length;if(i<=1)return[r];const a=[];let h,p;for(let m=0;m<i;m++){const y=_e(r[m]);y!==0&&(r[m].area=Math.abs(y),p===void 0&&(p=y<0),p===y<0?(h&&a.push(h),h=[r[m]]):h.push(r[m]))}if(h&&a.push(h),e>1)for(let m=0;m<a.length;m++)a[m].length<=e||(da(a[m],e,1,a[m].length-1,i8),a[m]=a[m].slice(0,e));return a}function i8(r,e){return e.area-r.area}function dw(r,e,i){const a=i.patternDependencies;let h=!1;for(const p of e){const m=p.paint.get(`${r}-pattern`);m.isConstant()||(h=!0);const y=m.constantOr(null);y&&(h=!0,a[y]=!0)}return h}function fw(r,e,i,a,h){const p=h.patternDependencies;for(const m of e){const y=m.paint.get(`${r}-pattern`).value;if(y.kind!=="constant"){let b=y.evaluate({zoom:a},i,{},h.availableImages);b=b&&b.name?b.name:b,p[b]=!0,i.patterns[m.id]=b}}return i}class Iv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Cr,this.indexArray=new vn,this.indexArray2=new zo,this.programConfigurations=new Xc(e.layers,e.zoom),this.segments=new Qn,this.segments2=new Qn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection}populate(e,i,a,h){this.hasPattern=dw("fill",this.layers,i);const p=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:y,id:b,index:E,sourceLayerIndex:C}of e){const A=this.layers[0]._featureFilter.needGeometry,P=Jc(y,A);if(!this.layers[0]._featureFilter.filter(new Ae(this.zoom),P,a))continue;const R=p?p.evaluate(P,{},a,i.availableImages):void 0,z={id:b,properties:y.properties,type:y.type,sourceLayerIndex:C,index:E,geometry:A?P.geometry:Sl(y,a,h),patterns:{},sortKey:R};m.push(z)}p&&m.sort((y,b)=>y.sortKey-b.sortKey);for(const y of m){const{geometry:b,index:E,sourceLayerIndex:C}=y;if(this.hasPattern){const A=fw("fill",this.layers,y,this.zoom,i);this.patternFeatures.push(A)}else this.addFeature(y,b,E,a,{},i.availableImages,i.brightness);i.featureIndex.insert(e[E].feature,b,E,C,this.index)}}update(e,i,a,h,p){const m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,m?this.stateDependentLayers:this.layers,a,h,p)}addFeatures(e,i,a,h,p,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,a,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Z6),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,a,h,p,m=[],y){for(const b of hw(i,500)){let E=0;for(const B of b)E+=B.length;const C=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),A=C.vertexLength,P=[],R=[];for(const B of b){if(B.length===0)continue;B!==b[0]&&R.push(P.length/2);const V=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),Q=V.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(Q+B.length-1,Q),P.push(B[0].x),P.push(B[0].y);for(let ae=1;ae<B.length;ae++)this.layoutVertexArray.emplaceBack(B[ae].x,B[ae].y),this.indexArray2.emplaceBack(Q+ae-1,Q+ae),P.push(B[ae].x),P.push(B[ae].y);V.vertexLength+=B.length,V.primitiveLength+=B.length}const z=Mv(P,R);for(let B=0;B<z.length;B+=3)this.indexArray.emplaceBack(A+z[B],A+z[B+1],A+z[B+2]);C.vertexLength+=E,C.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,m,h,y)}}Zt(Iv,"FillBucket",{omit:["layers","patternFeatures"]});const o8=new pt({"fill-sort-key":new $e(Ge.layout_fill["fill-sort-key"]),visibility:new ye(Ge.layout_fill.visibility)});var s8={paint:new pt({"fill-antialias":new ye(Ge.paint_fill["fill-antialias"]),"fill-opacity":new $e(Ge.paint_fill["fill-opacity"]),"fill-color":new $e(Ge.paint_fill["fill-color"]),"fill-outline-color":new $e(Ge.paint_fill["fill-outline-color"]),"fill-translate":new ye(Ge.paint_fill["fill-translate"]),"fill-translate-anchor":new ye(Ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new $e(Ge.paint_fill["fill-pattern"]),"fill-emissive-strength":new ye(Ge.paint_fill["fill-emissive-strength"])}),layout:o8};const a8=tr([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),l8=tr([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),c8=tr([{name:"a_centroid_pos",components:2,type:"Uint16"}]),u8=tr([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),h8=tr([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:d8}=a8;var Av={},f8=Se,iP=ef;function ef(r,e,i,a,h){this.properties={},this.extent=i,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=h,r.readFields(p8,this,e)}function p8(r,e,i){r==1?e.id=i.readVarint():r==2?function(a,h){for(var p=a.readVarint()+a.pos;a.pos<p;){var m=h._keys[a.readVarint()],y=h._values[a.readVarint()];h.properties[m]=y}}(i,e):r==3?e.type=i.readVarint():r==4&&(e._geometry=i.pos)}function m8(r){for(var e,i,a=0,h=0,p=r.length,m=p-1;h<p;m=h++)a+=((i=r[m]).x-(e=r[h]).x)*(e.y+i.y);return a}ef.types=["Unknown","Point","LineString","Polygon"],ef.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,i=r.readVarint()+r.pos,a=1,h=0,p=0,m=0,y=[];r.pos<i;){if(h<=0){var b=r.readVarint();a=7&b,h=b>>3}if(h--,a===1||a===2)p+=r.readSVarint(),m+=r.readSVarint(),a===1&&(e&&y.push(e),e=[]),e.push(new f8(p,m));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&y.push(e),y},ef.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,i=1,a=0,h=0,p=0,m=1/0,y=-1/0,b=1/0,E=-1/0;r.pos<e;){if(a<=0){var C=r.readVarint();i=7&C,a=C>>3}if(a--,i===1||i===2)(h+=r.readSVarint())<m&&(m=h),h>y&&(y=h),(p+=r.readSVarint())<b&&(b=p),p>E&&(E=p);else if(i!==7)throw new Error("unknown command "+i)}return[m,b,y,E]},ef.prototype.toGeoJSON=function(r,e,i){var a,h,p=this.extent*Math.pow(2,i),m=this.extent*r,y=this.extent*e,b=this.loadGeometry(),E=ef.types[this.type];function C(R){for(var z=0;z<R.length;z++){var B=R[z];R[z]=[360*(B.x+m)/p-180,360/Math.PI*Math.atan(Math.exp((180-360*(B.y+y)/p)*Math.PI/180))-90]}}switch(this.type){case 1:var A=[];for(a=0;a<b.length;a++)A[a]=b[a][0];C(b=A);break;case 2:for(a=0;a<b.length;a++)C(b[a]);break;case 3:for(b=function(R){var z=R.length;if(z<=1)return[R];for(var B,V,Q=[],ae=0;ae<z;ae++){var le=m8(R[ae]);le!==0&&(V===void 0&&(V=le<0),V===le<0?(B&&Q.push(B),B=[R[ae]]):B.push(R[ae]))}return B&&Q.push(B),Q}(b),a=0;a<b.length;a++)for(h=0;h<b[a].length;h++)C(b[a][h])}b.length===1?b=b[0]:E="Multi"+E;var P={type:"Feature",geometry:{type:E,coordinates:b},properties:this.properties};return"id"in this&&(P.id=this.id),P};var g8=iP,oP=sP;function sP(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(_8,this,e),this.length=this._features.length}function _8(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push(function(a){for(var h=null,p=a.readVarint()+a.pos;a.pos<p;){var m=a.readVarint()>>3;h=m===1?a.readString():m===2?a.readFloat():m===3?a.readDouble():m===4?a.readVarint64():m===5?a.readVarint():m===6?a.readSVarint():m===7?a.readBoolean():null}return h}(i))}sP.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new g8(this._pbf,e,this.extent,this._keys,this._values)};var y8=oP;function v8(r,e,i){if(r===3){var a=new y8(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}var pw=Av.VectorTile=function(r,e){this.layers=r.readFields(v8,{},e)},kv=Av.VectorTileFeature=iP;function Pv(r,e,i,a){const h=[],p=a===0?(m,y,b,E,C,A)=>{m.push(new se(A,b+(A-y)/(E-y)*(C-b)))}:(m,y,b,E,C,A)=>{m.push(new se(y+(A-b)/(C-b)*(E-y),A))};for(const m of r){const y=[];for(const b of m){if(b.length<=2)continue;const E=[];for(let P=0;P<b.length-1;P++){const R=b[P].x,z=b[P].y,B=b[P+1].x,V=b[P+1].y,Q=a===0?R:z,ae=a===0?B:V;Q<e?ae>e&&p(E,R,z,B,V,e):Q>i?ae<i&&p(E,R,z,B,V,i):E.push(b[P]),ae<e&&Q>=e&&p(E,R,z,B,V,e),ae>i&&Q<=i&&p(E,R,z,B,V,i)}let C=b[b.length-1];const A=a===0?C.x:C.y;A>=e&&A<=i&&E.push(C),E.length&&(C=E[E.length-1],E[0].x===C.x&&E[0].y===C.y||E.push(E[0]),y.push(E))}y.length&&h.push(y)}return h}Av.VectorTileLayer=oP;class aP{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var x8={read:function(r,e,i,a,h){var p,m,y=8*h-a-1,b=(1<<y)-1,E=b>>1,C=-7,A=i?h-1:0,P=i?-1:1,R=r[e+A];for(A+=P,p=R&(1<<-C)-1,R>>=-C,C+=y;C>0;p=256*p+r[e+A],A+=P,C-=8);for(m=p&(1<<-C)-1,p>>=-C,C+=a;C>0;m=256*m+r[e+A],A+=P,C-=8);if(p===0)p=1-E;else{if(p===b)return m?NaN:1/0*(R?-1:1);m+=Math.pow(2,a),p-=E}return(R?-1:1)*m*Math.pow(2,p-a)},write:function(r,e,i,a,h,p){var m,y,b,E=8*p-h-1,C=(1<<E)-1,A=C>>1,P=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=a?0:p-1,z=a?1:-1,B=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(y=isNaN(e)?1:0,m=C):(m=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-m))<1&&(m--,b*=2),(e+=m+A>=1?P/b:P*Math.pow(2,1-A))*b>=2&&(m++,b/=2),m+A>=C?(y=0,m=C):m+A>=1?(y=(e*b-1)*Math.pow(2,h),m+=A):(y=e*Math.pow(2,A-1)*Math.pow(2,h),m=0));h>=8;r[i+R]=255&y,R+=z,y/=256,h-=8);for(m=m<<h|y,E+=h;E>0;r[i+R]=255&m,R+=z,m/=256,E-=8);r[i+R-z]|=128*B}},lP=Gn,Ov=x8;function Gn(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Gn.Varint=0,Gn.Fixed64=1,Gn.Bytes=2,Gn.Fixed32=5;var mw=4294967296,cP=1/mw,uP=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function cc(r){return r.type===Gn.Bytes?r.readVarint()+r.pos:r.pos+1}function tf(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function hP(r,e,i){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(var h=i.pos-1;h>=r;h--)i.buf[h+a]=i.buf[h]}function b8(r,e){for(var i=0;i<r.length;i++)e.writeVarint(r[i])}function w8(r,e){for(var i=0;i<r.length;i++)e.writeSVarint(r[i])}function E8(r,e){for(var i=0;i<r.length;i++)e.writeFloat(r[i])}function S8(r,e){for(var i=0;i<r.length;i++)e.writeDouble(r[i])}function T8(r,e){for(var i=0;i<r.length;i++)e.writeBoolean(r[i])}function C8(r,e){for(var i=0;i<r.length;i++)e.writeFixed32(r[i])}function M8(r,e){for(var i=0;i<r.length;i++)e.writeSFixed32(r[i])}function I8(r,e){for(var i=0;i<r.length;i++)e.writeFixed64(r[i])}function A8(r,e){for(var i=0;i<r.length;i++)e.writeSFixed64(r[i])}function Dv(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function rf(r,e,i){r[i]=e,r[i+1]=e>>>8,r[i+2]=e>>>16,r[i+3]=e>>>24}function dP(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}Gn.prototype={destroy:function(){this.buf=null},readFields:function(r,e,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),h=a>>3,p=this.pos;this.type=7&a,r(h,e,this),this.pos===p&&this.skip(a)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=Dv(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=dP(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=Dv(this.buf,this.pos)+Dv(this.buf,this.pos+4)*mw;return this.pos+=8,r},readSFixed64:function(){var r=Dv(this.buf,this.pos)+dP(this.buf,this.pos+4)*mw;return this.pos+=8,r},readFloat:function(){var r=Ov.read(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=Ov.read(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,i,a=this.buf;return e=127&(i=a[this.pos++]),i<128?e:(e|=(127&(i=a[this.pos++]))<<7,i<128?e:(e|=(127&(i=a[this.pos++]))<<14,i<128?e:(e|=(127&(i=a[this.pos++]))<<21,i<128?e:function(h,p,m){var y,b,E=m.buf;if(y=(112&(b=E[m.pos++]))>>4,b<128||(y|=(127&(b=E[m.pos++]))<<3,b<128)||(y|=(127&(b=E[m.pos++]))<<10,b<128)||(y|=(127&(b=E[m.pos++]))<<17,b<128)||(y|=(127&(b=E[m.pos++]))<<24,b<128)||(y|=(1&(b=E[m.pos++]))<<31,b<128))return tf(h,y,p);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&uP?function(i,a,h){return uP.decode(i.subarray(a,h))}(this.buf,e,r):function(i,a,h){for(var p="",m=a;m<h;){var y,b,E,C=i[m],A=null,P=C>239?4:C>223?3:C>191?2:1;if(m+P>h)break;P===1?C<128&&(A=C):P===2?(192&(y=i[m+1]))==128&&(A=(31&C)<<6|63&y)<=127&&(A=null):P===3?(b=i[m+2],(192&(y=i[m+1]))==128&&(192&b)==128&&((A=(15&C)<<12|(63&y)<<6|63&b)<=2047||A>=55296&&A<=57343)&&(A=null)):P===4&&(b=i[m+2],E=i[m+3],(192&(y=i[m+1]))==128&&(192&b)==128&&(192&E)==128&&((A=(15&C)<<18|(63&y)<<12|(63&b)<<6|63&E)<=65535||A>=1114112)&&(A=null)),A===null?(A=65533,P=1):A>65535&&(A-=65536,p+=String.fromCharCode(A>>>10&1023|55296),A=56320|1023&A),p+=String.fromCharCode(A),m+=P}return p}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Gn.Bytes)return r.push(this.readVarint(e));var i=cc(this);for(r=r||[];this.pos<i;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Gn.Bytes)return r.push(this.readSVarint());var e=cc(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Gn.Bytes)return r.push(this.readBoolean());var e=cc(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Gn.Bytes)return r.push(this.readFloat());var e=cc(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Gn.Bytes)return r.push(this.readDouble());var e=cc(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Gn.Bytes)return r.push(this.readFixed32());var e=cc(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Gn.Bytes)return r.push(this.readSFixed32());var e=cc(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Gn.Bytes)return r.push(this.readFixed64());var e=cc(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Gn.Bytes)return r.push(this.readSFixed64());var e=cc(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Gn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Gn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Gn.Fixed32)this.pos+=4;else{if(e!==Gn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),rf(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),rf(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),rf(this.buf,-1&r,this.pos),rf(this.buf,Math.floor(r*cP),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),rf(this.buf,-1&r,this.pos),rf(this.buf,Math.floor(r*cP),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,i){var a,h;if(e>=0?(a=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,h=h+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(p,m,y){y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,p>>>=7,y.buf[y.pos++]=127&p|128,y.buf[y.pos]=127&(p>>>=7)}(a,0,i),function(p,m){var y=(7&p)<<4;m.buf[m.pos++]|=y|((p>>>=3)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p|((p>>>=7)?128:0),p&&(m.buf[m.pos++]=127&p)))))}(h,i)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(!!r)},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(a,h,p){for(var m,y,b=0;b<h.length;b++){if((m=h.charCodeAt(b))>55295&&m<57344){if(!y){m>56319||b+1===h.length?(a[p++]=239,a[p++]=191,a[p++]=189):y=m;continue}if(m<56320){a[p++]=239,a[p++]=191,a[p++]=189,y=m;continue}m=y-55296<<10|m-56320|65536,y=null}else y&&(a[p++]=239,a[p++]=191,a[p++]=189,y=null);m<128?a[p++]=m:(m<2048?a[p++]=m>>6|192:(m<65536?a[p++]=m>>12|224:(a[p++]=m>>18|240,a[p++]=m>>12&63|128),a[p++]=m>>6&63|128),a[p++]=63&m|128)}return p}(this.buf,r,this.pos);var i=this.pos-e;i>=128&&hP(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(r){this.realloc(4),Ov.write(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),Ov.write(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=r[i]},writeRawMessage:function(r,e){this.pos++;var i=this.pos;r(e,this);var a=this.pos-i;a>=128&&hP(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,e,i){this.writeTag(r,Gn.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,b8,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,w8,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,T8,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,E8,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,S8,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,C8,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,M8,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,I8,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,A8,e)},writeBytesField:function(r,e){this.writeTag(r,Gn.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Gn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Gn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Gn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Gn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Gn.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Gn.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Gn.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Gn.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Gn.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,!!e)}};var Rv=J(lP);const k8=["tile","layer","source","sourceLayer","state"];class fP{constructor(e,i,a,h,p){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=h,this.properties=e.properties,this.id=p}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(const i of k8)this[i]!==void 0&&(e[i]=this[i]);return e}}class P8{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,i,a){const h=String(i);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},or(this.stateChanges[e][h],a),this.deletedStates[e]===null){this.deletedStates[e]={};for(const p in this.state[e])p!==h&&(this.deletedStates[e][p]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][h]===null){this.deletedStates[e][h]={};for(const p in this.state[e][h])a[p]||(this.deletedStates[e][h][p]=null)}else for(const p in a)this.deletedStates[e]&&this.deletedStates[e][h]&&this.deletedStates[e][h][p]===null&&delete this.deletedStates[e][h][p]}removeFeatureState(e,i,a){if(this.deletedStates[e]===null)return;const h=String(i);if(this.deletedStates[e]=this.deletedStates[e]||{},a&&i!==void 0)this.deletedStates[e][h]!==null&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][a]=null);else if(i!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][h])for(a in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][a]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,i){const a=String(i),h=or({},(this.state[e]||{})[a],(this.stateChanges[e]||{})[a]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const p=this.deletedStates[e][i];if(p===null)return{};for(const m in p)delete h[m]}return h}initializeTileState(e,i){e.setFeatureState(this.state,i)}coalesceChanges(e,i){const a={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const p={};for(const m in this.stateChanges[h])this.state[h][m]||(this.state[h][m]={}),or(this.state[h][m],this.stateChanges[h][m]),p[m]=this.state[h][m];a[h]=p}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const p={};if(this.deletedStates[h]===null)for(const m in this.state[h])p[m]={},this.state[h][m]={};else for(const m in this.deletedStates[h]){if(this.deletedStates[h][m]===null)this.state[h][m]={};else if(this.state[h][m])for(const y of Object.keys(this.deletedStates[h][m]))delete this.state[h][m][y];p[m]=this.state[h][m]}a[h]=a[h]||{},or(a[h],p)}if(this.stateChanges={},this.deletedStates={},Object.keys(a).length!==0)for(const h in e)e[h].setFeatureState(a,i)}}class pP{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function mP(r,e,i,a){let h=0,p=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(a[m])<1e-15){if(i[m]<r[m]||i[m]>e[m])return null}else{const y=1/a[m];let b=(r[m]-i[m])*y,E=(e[m]-i[m])*y;if(b>E){const C=b;b=E,E=C}if(b>h&&(h=b),E<p&&(p=E),h>p)return null}return h}function gP(r,e,i,a,h,p,m,y,b,E,C){const A=a-r,P=h-e,R=p-i,z=m-r,B=y-e,V=b-i,Q=C[1]*V-C[2]*B,ae=C[2]*z-C[0]*V,le=C[0]*B-C[1]*z,he=A*Q+P*ae+R*le;if(Math.abs(he)<1e-15)return null;const me=1/he,ve=E[0]-r,Pe=E[1]-e,Ne=E[2]-i,je=(ve*Q+Pe*ae+Ne*le)*me;if(je<0||je>1)return null;const Ye=Pe*R-Ne*P,Ve=Ne*A-ve*R,ht=ve*P-Pe*A,Ct=(C[0]*Ye+C[1]*Ve+C[2]*ht)*me;return Ct<0||je+Ct>1?null:(z*Ye+B*Ve+V*ht)*me}function _P(r,e,i){return(r-e)/(i-e)}function yP(r,e,i,a,h,p,m,y,b){const E=1<<i,C=p-a,A=m-h,P=(r+1)/E*C+a,R=(e+0)/E*A+h,z=(e+1)/E*A+h;y[0]=(r+0)/E*C+a,y[1]=R,b[0]=P,b[1]=z}class vP{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(p){const m=Math.ceil(Math.log2(p.dim/8)),y=[];let b=Math.ceil(Math.pow(2,m));const E=1/b,C=(R,z,B,V,Q)=>{const ae=V?1:0,le=(R+1)*B-ae,he=z*B,me=(z+1)*B-ae;Q[0]=R*B,Q[1]=he,Q[2]=le,Q[3]=me};let A=new pP(b);const P=[];for(let R=0;R<b*b;R++){C(R%b,Math.floor(R/b),E,!1,P);const z=eu(P[0],P[1],p),B=eu(P[2],P[1],p),V=eu(P[2],P[3],p),Q=eu(P[0],P[3],p);A.minimums.push(Math.min(z,B,V,Q)),A.maximums.push(Math.max(z,B,V,Q)),A.leaves.push(1)}for(y.push(A),b/=2;b>=1;b/=2){const R=y[y.length-1];A=new pP(b);for(let z=0;z<b*b;z++){C(z%b,Math.floor(z/b),2,!0,P);const B=R.getElevation(P[0],P[1]),V=R.getElevation(P[2],P[1]),Q=R.getElevation(P[2],P[3]),ae=R.getElevation(P[0],P[3]),le=R.isLeaf(P[0],P[1]),he=R.isLeaf(P[2],P[1]),me=R.isLeaf(P[2],P[3]),ve=R.isLeaf(P[0],P[3]),Pe=Math.min(B.min,V.min,Q.min,ae.min),Ne=Math.max(B.max,V.max,Q.max,ae.max),je=le&&he&&me&&ve;A.maximums.push(Ne),A.minimums.push(Pe),A.leaves.push(Ne-Pe<=5&&je?1:0)}y.push(A)}return y}(this.dem),a=i.length-1,h=i[a];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,h,p,m,y=1){return mP([e,i,-100],[a,h,this.maximums[0]*y],p,m)}raycast(e,i,a,h,p,m,y=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,i,a,h,p,m,y);if(b==null)return null;const E=[],C=[],A=[],P=[],R=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;R.length>0;){const{idx:z,t:B,nodex:V,nodey:Q,depth:ae}=R.pop();if(this.leaves[z]){yP(V,Q,ae,e,i,a,h,A,P);const he=1<<ae,me=(V+0)/he,ve=(V+1)/he,Pe=(Q+0)/he,Ne=(Q+1)/he,je=eu(me,Pe,this.dem)*y,Ye=eu(ve,Pe,this.dem)*y,Ve=eu(ve,Ne,this.dem)*y,ht=eu(me,Ne,this.dem)*y,Ct=gP(A[0],A[1],je,P[0],A[1],Ye,P[0],P[1],Ve,p,m),st=gP(P[0],P[1],Ve,A[0],P[1],ht,A[0],A[1],je,p,m),wt=Math.min(Ct!==null?Ct:Number.MAX_VALUE,st!==null?st:Number.MAX_VALUE);if(wt!==Number.MAX_VALUE)return wt;{const ot=s.v.scaleAndAdd([],p,m,B);if(xP(je,Ye,ht,Ve,_P(ot[0],A[0],P[0]),_P(ot[1],A[1],P[1]))>=ot[2])return B}continue}let le=0;for(let he=0;he<this._siblingOffset.length;he++){yP((V<<1)+this._siblingOffset[he][0],(Q<<1)+this._siblingOffset[he][1],ae+1,e,i,a,h,A,P),A[2]=-100,P[2]=this.maximums[this.childOffsets[z]+he]*y;const me=mP(A,P,p,m);if(me!=null){const ve=me;E[he]=ve;let Pe=!1;for(let Ne=0;Ne<le&&!Pe;Ne++)ve>=E[C[Ne]]&&(C.splice(Ne,0,he),Pe=!0);Pe||(C[le]=he),le++}}for(let he=0;he<le;he++){const me=C[he];R.push({idx:this.childOffsets[z]+me,t:E[me],nodex:(V<<1)+this._siblingOffset[me][0],nodey:(Q<<1)+this._siblingOffset[me][1],depth:ae+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,h,p){if(e[h].isLeaf(i,a)===1)return;this.childOffsets[p]||(this.childOffsets[p]=this.nodeCount);const m=h-1,y=e[m];let b=0,E=0;for(let C=0;C<this._siblingOffset.length;C++){const A=2*i+this._siblingOffset[C][0],P=2*a+this._siblingOffset[C][1],R=y.getElevation(A,P),z=y.isLeaf(A,P),B=this._addNode(R.min,R.max,z);z&&(b|=1<<C),E||(E=B)}for(let C=0;C<this._siblingOffset.length;C++)b&1<<C||this._construct(e,2*i+this._siblingOffset[C][0],2*a+this._siblingOffset[C][1],m,E+C)}}function xP(r,e,i,a,h,p){return Fr(Fr(r,i,p),Fr(e,a,p),h)}function eu(r,e,i){const a=i.dim,h=rt(r*a-.5,0,a-1),p=rt(e*a-.5,0,a-1),m=Math.floor(h),y=Math.floor(p),b=Math.min(m+1,a-1),E=Math.min(y+1,a-1);return xP(i.get(m,y),i.get(b,y),i.get(m,E),i.get(b,E),h-m,p-y)}const O8={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function D8(r,e,i){return(256*r*256+256*e+i)/10-1e4}function R8(r,e,i){return 256*r+e+i/256-32768}class Lv{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,h=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return mr(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const p=this.dim=i.height-2,m=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let b=0;b<p;b++)m[this._idx(-1,b)]=m[this._idx(0,b)],m[this._idx(p,b)]=m[this._idx(p-1,b)],m[this._idx(b,-1)]=m[this._idx(b,0)],m[this._idx(b,p)]=m[this._idx(b,p-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(p,-1)]=m[this._idx(p-1,0)],m[this._idx(-1,p)]=m[this._idx(0,p-1)],m[this._idx(p,p)]=m[this._idx(p-1,p-1)]}const y=a==="terrarium"?R8:D8;for(let b=0;b<m.length;++b){const E=4*b;this.floatView[b]=y(this.pixels[E],this.pixels[E+1],this.pixels[E+2])}this._timestamp=ji.now()}_buildQuadTree(){this._tree=new vP(this)}get(e,i,a=!1){a&&(e=rt(e,-1,this.dim),i=rt(i,-1,this.dim));const h=this._idx(e,i);return this.floatView[h]}set(e,i,a){const h=this._idx(e,i),p=this.floatView[h];return this.floatView[h]=a,a-p}static getUnpackVector(e){return O8[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const a=[0,0,0,0],h=Lv.getUnpackVector(i);let p=Math.floor((e+h[3])/h[2]);return a[2]=p%256,p=Math.floor(p/256),a[1]=p%256,p=Math.floor(p/256),a[0]=p,a}getPixels(){return new Jk({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,p=i*this.dim+this.dim,m=a*this.dim,y=a*this.dim+this.dim;switch(i){case-1:h=p-1;break;case 1:p=h+1}switch(a){case-1:m=y-1;break;case 1:y=m+1}const b=-i*this.dim,E=-a*this.dim;for(let C=m;C<y;C++)for(let A=h;A<p;A++){const P=4*this._idx(A,C),R=4*this._idx(A+b,C+E);this.pixels[P+0]=e.pixels[R+0],this.pixels[P+1]=e.pixels[R+1],this.pixels[P+2]=e.pixels[R+2],this.pixels[P+3]=e.pixels[R+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Zt(Lv,"DEMData"),Zt(vP,"DemMinMaxQuadTree",{omit:["dem"]});class nf{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const h=a||e.findDEMTileFor(i);if(!h||!h.dem)return;const p=h.dem,m=h.tileID,y=1<<i.canonical.z-m.canonical.z;return new nf(h,p.dim/kt/y,[(i.canonical.x/y-m.canonical.x)*p.dim,(i.canonical.y/y-m.canonical.y)*p.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),p=Math.floor(a);return new se(h,p)}getElevationAt(e,i,a,h){const p=e*this._scale+this._offset[0],m=i*this._scale+this._offset[1],y=Math.floor(p),b=Math.floor(m),E=this._dem;return h=!!h,a?Fr(Fr(E.get(y,b,h),E.get(y,b+1,h),m-b),Fr(E.get(y+1,b,h),E.get(y+1,b+1,h),m-b),p-y):E.get(y,b,h)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Qo(1,e)*this._dem.stride}}class gw{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Hc(kt,16,0),this.featureIndexArray=new YI,this.promoteId=i}insert(e,i,a,h,p,m=0){const y=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,h,p,m);const b=this.grid;for(let E=0;E<i.length;E++){const C=i[E],A=[1/0,1/0,-1/0,-1/0];for(let P=0;P<C.length;P++){const R=C[P];A[0]=Math.min(A[0],R.x),A[1]=Math.min(A[1],R.y),A[2]=Math.max(A[2],R.x),A[3]=Math.max(A[3],R.y)}A[0]<kt&&A[1]<kt&&A[2]>=0&&A[3]>=0&&b.insert(y,A[0],A[1],A[2],A[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new pw(new Rv(this.rawTileData)).layers,this.sourceLayerCoder=new aP(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i,a,h){this.loadVTLayers();const p=e.params||{},m=Ud(p.filter),y=e.tileResult,b=e.transform,E=y.bufferedTilespaceBounds,C=this.grid.query(E.min.x,E.min.y,E.max.x,E.max.y,(z,B,V,Q)=>Gk(y.bufferedTilespaceGeometry,z,B,V,Q));C.sort(L8);let A=null;b.elevation&&C.length>0&&(A=nf.create(b.elevation,this.tileID));const P={};let R;for(let z=0;z<C.length;z++){const B=C[z];if(B===R)continue;R=B;const V=this.featureIndexArray.get(B);let Q=null;this.loadMatchingFeature(P,V,m,p.layers,p.availableImages,i,a,h,(ae,le,he,me=0)=>(Q||(Q=Sl(ae,this.tileID.canonical,e.tileTransform)),le.queryIntersectsFeature(y,ae,he,Q,this.z,e.transform,e.pixelPosMatrix,A,me)))}return P}loadMatchingFeature(e,i,a,h,p,m,y,b,E){const{featureIndex:C,bucketIndex:A,sourceLayerIndex:P,layoutVertexArrayOffset:R}=i,z=this.bucketLayerIDs[A];if(h&&!function(ae,le){for(let he=0;he<ae.length;he++)if(le.indexOf(ae[he])>=0)return!0;return!1}(h,z))return;const B=this.sourceLayerCoder.decode(P),V=this.vtLayers[B].feature(C);if(a.needGeometry){const ae=Jc(V,!0);if(!a.filter(new Ae(this.tileID.overscaledZ),ae,this.tileID.canonical))return}else if(!a.filter(new Ae(this.tileID.overscaledZ),V))return;const Q=this.getId(V,B);for(let ae=0;ae<z.length;ae++){const le=z[ae];if(h&&h.indexOf(le)<0)continue;const he=m[le];if(!he)continue;let me={};Q!==void 0&&b&&(me=b.getState(he.sourceLayer||"_geojsonTileLayer",Q));const ve=or({},y[le]);ve.paint=bP(ve.paint,he.paint,V,me,p),ve.layout=bP(ve.layout,he.layout,V,me,p);const Pe=!E||E(V,he,me,R);if(!Pe)continue;const Ne=new fP(V,this.z,this.x,this.y,Q);Ne.layer=ve;let je=e[le];je===void 0&&(je=e[le]=[]),je.push({featureIndex:C,feature:Ne,intersectionZ:Pe})}}lookupSymbolFeatures(e,i,a,h,p,m,y,b){const E={};this.loadVTLayers();const C=Ud(p);for(const A of e)this.loadMatchingFeature(E,{bucketIndex:a,sourceLayerIndex:h,featureIndex:A,layoutVertexArrayOffset:0},C,m,y,b,i);return E}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(a),p=this.vtFeatures[h];if(p[i])return p[i];const m=this.vtLayers[h].feature(i);return p[i]=m,m}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const h=typeof this.promoteId=="string"?this.promoteId:this.promoteId[i];h!=null&&(a=e.properties[h]),typeof a=="boolean"&&(a=Number(a))}return a}}function bP(r,e,i,a,h){return $r(r,(p,m)=>{const y=e instanceof dt?e.get(m):null;return y&&y.evaluate?y.evaluate(i,a,h):y})}function L8(r,e){return e-r}Zt(gw,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const z8=tr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),N8=tr([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),F8=tr([{name:"a_projected_pos",components:4,type:"Float32"}],4);tr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const B8=tr([{name:"a_z_offset",components:1,type:"Float32"}],4),j8=tr([{name:"a_texb",components:2,type:"Uint16"}]),$8=tr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),U8=tr([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);tr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const wP=tr([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),V8=tr([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);tr([{name:"triangle",components:3,type:"Uint16"}]),tr([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),tr([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),tr([{type:"Float32",name:"offsetX"}]),tr([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var po=24;const qa=128;function _w(r,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new Ae(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:h}=i;let p=0;for(;p<a.length&&a[p]<=r;)p++;p=Math.max(0,p-1);let m=p;for(;m<a.length&&a[m]<r+1;)m++;m=Math.min(a.length-1,m);const y=a[p],b=a[m];return i.kind==="composite"?{kind:"composite",minZoom:y,maxZoom:b,interpolationType:h}:{kind:"camera",minZoom:y,maxZoom:b,minSize:i.evaluate(new Ae(y)),maxSize:i.evaluate(new Ae(b)),interpolationType:h}}}function zv(r,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:h}){return r.kind==="source"?a/qa:r.kind==="composite"?Fr(a/qa,h/qa,i):e}function of(r,e){let i=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:h,minZoom:p,maxZoom:m}=r,y=h?rt(qs.interpolationFactor(h,e,p,m),0,1):0;r.kind==="camera"?a=Fr(r.minSize,r.maxSize,y):i=y}return{uSizeT:i,uSize:a}}var G8=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:qa,evaluateSizeForFeature:zv,evaluateSizeForZoom:of,getSizeData:_w});function q8(r,e,i){return r.sections.forEach(a=>{a.text=function(h,p,m){const y=p.layout.get("text-transform").evaluate(m,{});return y==="uppercase"?h=h.toLocaleUpperCase():y==="lowercase"&&(h=h.toLocaleLowerCase()),Oe.applyArabicShaping&&(h=Oe.applyArabicShaping(h)),h}(a.text,e,i)}),r}const Om={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function W8(r){return r==="︶"||r==="﹈"||r==="︸"||r==="﹄"||r==="﹂"||r==="︾"||r==="︼"||r==="︺"||r==="︘"||r==="﹀"||r==="︐"||r==="︓"||r==="︔"||r==="｀"||r==="￣"||r==="︑"||r==="︒"}function H8(r){return r==="︵"||r==="﹇"||r==="︷"||r==="﹃"||r==="﹁"||r==="︽"||r==="︻"||r==="︹"||r==="︗"||r==="︿"}const yw=3;function Z8(r,e,i){e.glyphs=[],r===1&&i.readMessage(X8,e)}function X8(r,e,i){if(r===3){const{id:a,bitmap:h,width:p,height:m,left:y,top:b,advance:E}=i.readMessage(Y8,{});e.glyphs.push({id:a,bitmap:new lc({width:p+2*yw,height:m+2*yw},h),metrics:{width:p,height:m,left:y,top:b,advance:E}})}else r===4?e.ascender=i.readSVarint():r===5&&(e.descender=i.readSVarint())}function Y8(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}const EP=yw,Js={horizontal:1,vertical:2,horizontalOnly:3},SP=-17;class Dm{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const a=new Dm;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new Dm;return i.imageName=e,i}}class sf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const a=new sf;for(let h=0;h<e.sections.length;h++){const p=e.sections[h];p.image?a.addImageSection(p):a.addTextSection(p,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,a){let h="";for(let p=0;p<i.length;p++){const m=i.charCodeAt(p+1)||null,y=i.charCodeAt(p-1)||null;h+=!a&&(m&&F(m)&&!Om[i[p+1]]||y&&F(y)&&!Om[i[p-1]])||!Om[i[p]]?i[p]:Om[i[p]]}return h}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&Nv[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Nv[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new sf;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(Dm.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(a)}addImageSection(e){const i=e.image?e.image.namePrimary:"";if(i.length===0)return void mr("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCodePoint(a),this.sections.push(Dm.forImage(i)),this.sectionIndex.push(this.sections.length-1)):mr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vw(r,e,i,a,h,p,m,y,b,E,C,A,P,R,z){const B=sf.fromFeature(r,h);A===Js.vertical&&B.verticalizePunctuation(P);let V=[];const Q=function(ve,Pe,Ne,je,Ye,Ve){if(!ve)return[];const ht=[],Ct=function(Rt,Ht,Tt,hr,Yt,Pt){let dr=0;for(let rr=0;rr<Rt.length();rr++){const ar=Rt.getSection(rr);dr+=TP(Rt.getCodePoint(rr),ar,hr,Yt,Ht,Pt)}return dr/Math.max(1,Math.ceil(dr/Tt))}(ve,Pe,Ne,je,Ye,Ve),st=ve.text.indexOf("​")>=0;let wt=0;for(let Rt=0;Rt<ve.length();Rt++){const Ht=ve.getSection(Rt),Tt=ve.getCodePoint(Rt);if(Nv[Tt]||(wt+=TP(Tt,Ht,je,Ye,Pe,Ve)),Rt<ve.length()-1){const hr=!((ot=Tt)<11904||!(w["Bopomofo Extended"](ot)||w.Bopomofo(ot)||w["CJK Compatibility Forms"](ot)||w["CJK Compatibility Ideographs"](ot)||w["CJK Compatibility"](ot)||w["CJK Radicals Supplement"](ot)||w["CJK Strokes"](ot)||w["CJK Symbols and Punctuation"](ot)||w["CJK Unified Ideographs Extension A"](ot)||w["CJK Unified Ideographs"](ot)||w["Enclosed CJK Letters and Months"](ot)||w["Halfwidth and Fullwidth Forms"](ot)||w.Hiragana(ot)||w["Ideographic Description Characters"](ot)||w["Kangxi Radicals"](ot)||w["Katakana Phonetic Extensions"](ot)||w.Katakana(ot)||w["Vertical Forms"](ot)||w["Yi Radicals"](ot)||w["Yi Syllables"](ot)));(Q8[Tt]||hr||Ht.imageName)&&ht.push(MP(Rt+1,wt,Ct,ht,K8(Tt,ve.getCodePoint(Rt+1),hr&&st),!1))}}var ot;return IP(MP(ve.length(),wt,Ct,ht,0,!0))}(B,E,p,e,a,R),{processBidirectionalText:ae,processStyledBidirectionalText:le}=Oe;if(ae&&B.sections.length===1){const ve=ae(B.toString(),Q);for(const Pe of ve){const Ne=new sf;Ne.text=Pe,Ne.sections=B.sections;for(let je=0;je<Pe.length;je++)Ne.sectionIndex.push(0);V.push(Ne)}}else if(le){const ve=le(B.text,B.sectionIndex,Q);for(const Pe of ve){const Ne=new sf;Ne.text=Pe[0],Ne.sectionIndex=Pe[1],Ne.sections=B.sections,V.push(Ne)}}else V=function(ve,Pe){const Ne=[],je=ve.text;let Ye=0;for(const Ve of Pe)Ne.push(ve.substring(Ye,Ve)),Ye=Ve;return Ye<je.length&&Ne.push(ve.substring(Ye,je.length)),Ne}(B,Q);const he=[],me={positionedLines:he,text:B.toString(),top:C[1],bottom:C[1],left:C[0],right:C[0],writingMode:A,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(ve,Pe,Ne,je,Ye,Ve,ht,Ct,st,wt,ot,Rt){let Ht=0,Tt=0,hr=0;const Yt=Ct==="right"?1:Ct==="left"?0:.5;let Pt=!1;for(const Zr of Ye){const Mr=Zr.getSections();for(const jr of Mr){if(jr.imageName)continue;const nn=Pe[jr.fontStack];if(nn&&(Pt=nn.ascender!==void 0&&nn.descender!==void 0,!Pt))break}if(!Pt)break}let dr=0;for(const Zr of Ye){Zr.trim();const Mr=Zr.getMaxScale(),jr=(Mr-1)*po,nn={positionedGlyphs:[],lineOffset:0};ve.positionedLines[dr]=nn;const Pn=nn.positionedGlyphs;let Pr=0;if(!Zr.length()){Tt+=Ve,++dr;continue}let qn=0,On=0;for(let _n=0;_n<Zr.length();_n++){const on=Zr.getSection(_n),ai=Zr.getSectionIndex(_n),Wn=Zr.getCodePoint(_n);let yi=on.scale,eo=null,Ko=null,Ei=null,di=po,No=0;const Fo=!(st===Js.horizontal||!ot&&!L(Wn)||ot&&(Nv[Wn]||(rr=Wn,w.Arabic(rr)||w["Arabic Supplement"](rr)||w["Arabic Extended-A"](rr)||w["Arabic Presentation Forms-A"](rr)||w["Arabic Presentation Forms-B"](rr))));if(on.imageName){const Jo=je[on.imageName];if(!Jo)continue;Ei=on.imageName,ve.iconsInText=ve.iconsInText||!0,Ko=Jo.paddedRect;const Hn=Jo.displaySize;yi=yi*po/Rt,eo={width:Hn[0],height:Hn[1],left:0,top:-EP,advance:Fo?Hn[1]:Hn[0],localGlyph:!1},No=Pt?-eo.height*yi:SP+Mr*po-Hn[1]*yi,di=eo.advance;const Xa=(Fo?Hn[0]:Hn[1])*yi-po*Mr;Xa>0&&Xa>Pr&&(Pr=Xa)}else{const Jo=Ne[on.fontStack];if(!Jo)continue;Jo[Wn]&&(Ko=Jo[Wn]);const Hn=Pe[on.fontStack];if(!Hn)continue;const Xa=Hn.glyphs[Wn];if(!Xa)continue;if(eo=Xa.metrics,di=Wn!==8203?po:0,Pt){const ff=Hn.ascender!==void 0?Math.abs(Hn.ascender):0,dc=Hn.descender!==void 0?Math.abs(Hn.descender):0,fc=(ff+dc)*yi;qn<fc&&(qn=fc,On=(ff-dc)/2*yi),No=-ff*yi}else No=SP+(Mr-yi)*po}Fo?(ve.verticalizable=!0,Pn.push({glyph:Wn,imageName:Ei,x:Ht,y:Tt+No,vertical:Fo,scale:yi,localGlyph:eo.localGlyph,fontStack:on.fontStack,sectionIndex:ai,metrics:eo,rect:Ko}),Ht+=di*yi+wt):(Pn.push({glyph:Wn,imageName:Ei,x:Ht,y:Tt+No,vertical:Fo,scale:yi,localGlyph:eo.localGlyph,fontStack:on.fontStack,sectionIndex:ai,metrics:eo,rect:Ko}),Ht+=eo.advance*yi+wt)}Pn.length!==0&&(hr=Math.max(Ht-wt,hr),Pt?AP(Pn,Yt,Pr,On,Ve*Mr/2):AP(Pn,Yt,Pr,0,Ve/2)),Ht=0;const dn=Ve*Mr+Pr;nn.lineOffset=Math.max(Pr,jr),Tt+=dn,++dr}var rr;const ar=Tt,{horizontalAlign:Mt,verticalAlign:yr}=xw(ht);(function(Zr,Mr,jr,nn,Pn,Pr){const qn=(Mr-jr)*Pn,On=-Pr*nn;for(const dn of Zr)for(const _n of dn.positionedGlyphs)_n.x+=qn,_n.y+=On})(ve.positionedLines,Yt,Mt,yr,hr,ar),ve.top+=-yr*ar,ve.bottom=ve.top+ar,ve.left+=-Mt*hr,ve.right=ve.left+hr,ve.hasBaseline=Pt}(me,e,i,a,V,m,y,b,A,E,P,z),!function(ve){for(const Pe of ve)if(Pe.positionedGlyphs.length!==0)return!1;return!0}(he)&&me}const Nv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Q8={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function TP(r,e,i,a,h,p){if(e.imageName){const m=a[e.imageName];return m?m.displaySize[0]*e.scale*po/p+h:0}{const m=i[e.fontStack],y=m&&m.glyphs[r];return y?y.metrics.advance*e.scale+h:0}}function CP(r,e,i,a){const h=Math.pow(r-e,2);return a?r<e?h/2:2*h:h+Math.abs(i)*i}function K8(r,e,i){let a=0;return r===10&&(a-=1e4),i&&(a+=150),r!==40&&r!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function MP(r,e,i,a,h,p){let m=null,y=CP(e,i,h,p);for(const b of a){const E=CP(e-b.x,i,h,p)+b.badness;E<=y&&(m=b,y=E)}return{index:r,x:e,priorBreak:m,badness:y}}function IP(r){return r?IP(r.priorBreak).concat(r.index):[]}function xw(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function AP(r,e,i,a,h){if(!(e||i||a||h))return;const p=r.length-1,m=r[p],y=(m.x+m.metrics.advance*m.scale)*e;for(let b=0;b<=p;b++)r[b].x-=y,r[b].y+=i+a+h}function J8(r,e,i,a){const{horizontalAlign:h,verticalAlign:p}=xw(a),m=i[0]-r.displaySize[0]*h,y=i[1]-r.displaySize[1]*p;return{imagePrimary:r,imageSecondary:e,top:y,bottom:y+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function kP(r,e,i,a,h,p){const m=r.imagePrimary;let y;if(m.content){const V=m.content,Q=m.pixelRatio||1;y=[V[0]/Q,V[1]/Q,m.displaySize[0]-V[2]/Q,m.displaySize[1]-V[3]/Q]}const b=e.left*p,E=e.right*p;let C,A,P,R;i==="width"||i==="both"?(R=h[0]+b-a[3],A=h[0]+E+a[1]):(R=h[0]+(b+E-m.displaySize[0])/2,A=R+m.displaySize[0]);const z=e.top*p,B=e.bottom*p;return i==="height"||i==="both"?(C=h[1]+z-a[0],P=h[1]+B+a[2]):(C=h[1]+(z+B-m.displaySize[1])/2,P=C+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:C,right:A,bottom:P,left:R,collisionPadding:y}}class uc extends se{constructor(e,i,a,h,p){super(e,i),this.angle=h,this.z=a,p!==void 0&&(this.segment=p)}clone(){return new uc(this.x,this.y,this.z,this.angle,this.segment)}}function PP(r,e,i,a,h){if(e.segment===void 0)return!0;let p=e,m=e.segment+1,y=0;for(;y>-i/2;){if(m--,m<0)return!1;y-=r[m].dist(p),p=r[m]}y+=r[m].dist(r[m+1]),m++;const b=[];let E=0;for(;y<i/2;){const C=r[m],A=r[m+1];if(!A)return!1;let P=r[m-1].angleTo(C)-C.angleTo(A);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:y,angleDelta:P}),E+=P;y-b[0].distance>a;)E-=b.shift().angleDelta;if(E>h)return!1;m++,y+=C.dist(A)}return!0}function OP(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function DP(r,e,i){return r?.6*e*i:0}function RP(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function e$(r,e,i,a,h,p){const m=DP(i,h,p),y=RP(i,a)*p;let b=0;const E=OP(r)/2;for(let C=0;C<r.length-1;C++){const A=r[C],P=r[C+1],R=A.dist(P);if(b+R>E){const z=(E-b)/R,B=Fr(A.x,P.x,z),V=Fr(A.y,P.y,z),Q=new uc(B,V,0,P.angleTo(A),C);return!m||PP(r,Q,y,m,e)?Q:void 0}b+=R}}function t$(r,e,i,a,h,p,m,y,b){const E=DP(a,p,m),C=RP(a,h),A=C*m,P=r[0].x===0||r[0].x===b||r[0].y===0||r[0].y===b;return e-A<e/4&&(e=A+e/4),LP(r,P?e/2*y%e:(C/2+2*p)*m*y%e,e,E,i,A,P,!1,b)}function LP(r,e,i,a,h,p,m,y,b){const E=p/2,C=OP(r);let A=0,P=e-i,R=[];for(let z=0;z<r.length-1;z++){const B=r[z],V=r[z+1],Q=B.dist(V),ae=V.angleTo(B);for(;P+i<A+Q;){P+=i;const le=(P-A)/Q,he=Fr(B.x,V.x,le),me=Fr(B.y,V.y,le);if(he>=0&&he<b&&me>=0&&me<b&&P-E>=0&&P+E<=C){const ve=new uc(he,me,0,ae,z);a&&!PP(r,ve,p,a,h)||R.push(ve)}}A+=Q}return y||R.length||m||(R=LP(r,A/2,i,a,h,p,m,!0,b)),R}function zP(r,e,i,a,h){const p=[];for(let m=0;m<r.length;m++){const y=r[m];let b;for(let E=0;E<y.length-1;E++){let C=y[E],A=y[E+1];C.x<e&&A.x<e||(C.x<e?C=new se(e,C.y+(e-C.x)/(A.x-C.x)*(A.y-C.y))._round():A.x<e&&(A=new se(e,C.y+(e-C.x)/(A.x-C.x)*(A.y-C.y))._round()),C.y<i&&A.y<i||(C.y<i?C=new se(C.x+(i-C.y)/(A.y-C.y)*(A.x-C.x),i)._round():A.y<i&&(A=new se(C.x+(i-C.y)/(A.y-C.y)*(A.x-C.x),i)._round()),C.x>=a&&A.x>=a||(C.x>=a?C=new se(a,C.y+(a-C.x)/(A.x-C.x)*(A.y-C.y))._round():A.x>=a&&(A=new se(a,C.y+(a-C.x)/(A.x-C.x)*(A.y-C.y))._round()),C.y>=h&&A.y>=h||(C.y>=h?C=new se(C.x+(h-C.y)/(A.y-C.y)*(A.x-C.x),h)._round():A.y>=h&&(A=new se(C.x+(h-C.y)/(A.y-C.y)*(A.x-C.x),h)._round()),b&&C.equals(b[b.length-1])||(b=[C],p.push(b)),b.push(A)))))}}return p}function bw(r){let e=0,i=0;for(const m of r)e+=m.w*m.h,i=Math.max(i,m.w);r.sort((m,y)=>y.h-m.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let h=0,p=0;for(const m of r)for(let y=a.length-1;y>=0;y--){const b=a[y];if(!(m.w>b.w||m.h>b.h)){if(m.x=b.x,m.y=b.y,p=Math.max(p,m.y+m.h),h=Math.max(h,m.x+m.w),m.w===b.w&&m.h===b.h){const E=a.pop();y<a.length&&(a[y]=E)}else m.h===b.h?(b.x+=m.w,b.w-=m.w):m.w===b.w?(b.y+=m.h,b.h-=m.h):(a.push({x:b.x+m.w,y:b.y,w:b.w-m.w,h:m.h}),b.y+=m.h,b.h-=m.h);break}}return{w:h,h:p,fill:e/(h*p)||0}}Zt(uc,"Anchor");const Os=1;class ww{constructor(e,{pixelRatio:i,version:a,stretchX:h,stretchY:p,content:m}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=h,this.stretchY=p,this.content=m,this.version=a}get tl(){return[this.paddedRect.x+Os,this.paddedRect.y+Os]}get br(){return[this.paddedRect.x+this.paddedRect.w-Os,this.paddedRect.y+this.paddedRect.h-Os]}get displaySize(){return[(this.paddedRect.w-2*Os)/this.pixelRatio,(this.paddedRect.h-2*Os)/this.pixelRatio]}}class NP{constructor(e,i){const a={},h={};this.haveRenderCallbacks=[];const p=[];this.addImages(e,a,p),this.addImages(i,h,p);const{w:m,h:y}=bw(p),b=new Ks({width:m||1,height:y||1});for(const E in e){const C=e[E],A=a[E].paddedRect;Ks.copy(C.data,b,{x:0,y:0},{x:A.x+Os,y:A.y+Os},C.data,C.sdf)}for(const E in i){const C=i[E],A=h[E].paddedRect,P=A.x+Os,R=A.y+Os,z=C.data.width,B=C.data.height;Ks.copy(C.data,b,{x:0,y:0},{x:P,y:R},C.data),Ks.copy(C.data,b,{x:0,y:B-1},{x:P,y:R-1},{width:z,height:1}),Ks.copy(C.data,b,{x:0,y:0},{x:P,y:R+B},{width:z,height:1}),Ks.copy(C.data,b,{x:z-1,y:0},{x:P-1,y:R},{width:1,height:B}),Ks.copy(C.data,b,{x:0,y:0},{x:P+z,y:R},{width:1,height:B})}this.image=b,this.iconPositions=a,this.patternPositions=h}addImages(e,i,a){for(const h in e){const p=e[h],m={x:0,y:0,w:p.data.width+2*Os,h:p.data.height+2*Os};a.push(m),i[h]=new ww(m,p),p.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,i,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>e.hasImage(h,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const h in e.getUpdatedImages(a))this.patchUpdatedImage(this.iconPositions[h],e.getImage(h,a),i),this.patchUpdatedImage(this.patternPositions[h],e.getImage(h,a),i)}patchUpdatedImage(e,i,a){if(!e||!i||e.version===i.version)return;e.version=i.version;const[h,p]=e.tl,m=!!Object.keys(this.patternPositions).length;a.update(i.data,{useMipmap:m},{x:h,y:p})}}Zt(ww,"ImagePosition"),Zt(NP,"ImageAtlas");const Rm=1e20;function FP(r,e,i,a,h,p,m,y,b){for(let E=e;E<e+a;E++)BP(r,i*p+E,p,h,m,y,b);for(let E=i;E<i+h;E++)BP(r,E*p+e,1,a,m,y,b)}function BP(r,e,i,a,h,p,m){p[0]=0,m[0]=-Rm,m[1]=Rm,h[0]=r[e];for(let y=1,b=0,E=0;y<a;y++){h[y]=r[e+y*i];const C=y*y;do{const A=p[b];E=(h[y]-h[A]+C-A*A)/(y-A)/2}while(E<=m[b]&&--b>-1);b++,p[b]=y,m[b]=E,m[b+1]=Rm}for(let y=0,b=0;y<a;y++){for(;m[b+1]<y;)b++;const E=p[b],C=y-E;r[e+y*i]=h[E]+C*C}}const Wa=2,Ew={none:0,ideographs:1,all:2};class af{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,i){this.urls[i]=e}getGlyphs(e,i,a){const h=[],p=this.urls[i]||D.GLYPHS_URL;for(const m in e)for(const y of e[m])h.push({stack:m,id:y});Jt(h,({stack:m,id:y},b)=>{let E=this.entries[m];E||(E=this.entries[m]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let C=E.glyphs[y];if(C!==void 0)return void b(null,{stack:m,id:y,glyph:C});if(C=this._tinySDF(E,m,y),C)return E.glyphs[y]=C,void b(null,{stack:m,id:y,glyph:C});const A=Math.floor(y/256);if(256*A>65535)return void b(new Error("glyphs > 65535 not supported"));if(E.ranges[A])return void b(null,{stack:m,id:y,glyph:C});let P=E.requests[A];P||(P=E.requests[A]=[],af.loadGlyphRange(m,A,p,this.requestManager,(R,z)=>{if(z){E.ascender=z.ascender,E.descender=z.descender;for(const B in z.glyphs)this._doesCharSupportLocalGlyph(+B)||(E.glyphs[+B]=z.glyphs[+B]);E.ranges[A]=!0}for(const B of P)B(R,z);delete E.requests[A]})),P.push((R,z)=>{R?b(R):z&&b(null,{stack:m,id:y,glyph:z.glyphs[y]||null})})},(m,y)=>{if(m)a(m);else if(y){const b={};for(const{stack:E,id:C,glyph:A}of y)b[E]===void 0&&(b[E]={}),b[E].glyphs===void 0&&(b[E].glyphs={}),b[E].glyphs[C]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},b[E].ascender=this.entries[E].ascender,b[E].descender=this.entries[E].descender;a(null,b)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ew.none&&(this.localGlyphMode===Ew.all?!!this.localFontFamily:!!this.localFontFamily&&(w["CJK Unified Ideographs"](e)||w["Hangul Syllables"](e)||w.Hiragana(e)||w.Katakana(e)||w["CJK Symbols and Punctuation"](e)||w["CJK Unified Ideographs Extension A"](e)||w["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,i,a){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(a))return;let p=e.tinySDF;if(!p){let B="400";/bold/i.test(i)?B="900":/medium/i.test(i)?B="500":/light/i.test(i)&&(B="200"),p=e.tinySDF=new af.TinySDF({fontFamily:h,fontWeight:B,fontSize:24*Wa,buffer:3*Wa,radius:8*Wa}),p.fontWeight=B}if(this.localGlyphs[p.fontWeight][a])return this.localGlyphs[p.fontWeight][a];const m=String.fromCodePoint(a),{data:y,width:b,height:E,glyphWidth:C,glyphHeight:A,glyphLeft:P,glyphTop:R,glyphAdvance:z}=p.draw(m);return this.localGlyphs[p.fontWeight][a]={id:a,bitmap:new lc({width:b,height:E},y),metrics:{width:C/Wa,height:A/Wa,left:P/Wa,top:R/Wa-27,advance:z/Wa,localGlyph:!0}}}}af.loadGlyphRange=function(r,e,i,a,h){const p=256*e,m=p+255,y=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",r).replace("{range}",`${p}-${m}`),Fn.Glyphs);ii(y,(b,E)=>{if(b)h(b);else if(E){const C={},A=function(P){return new Rv(P).readFields(Z8,{})}(E);for(const P of A.glyphs)C[P.id]=P;h(null,{glyphs:C,ascender:A.ascender,descender:A.descender})}})},af.TinySDF=class{constructor({fontSize:r=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:h="sans-serif",fontWeight:p="normal",fontStyle:m="normal"}={}){this.buffer=e,this.cutoff=a,this.radius=i;const y=this.size=r+4*e,b=this._createCanvas(y),E=this.ctx=b.getContext("2d",{willReadFrequently:!0});E.font=`${m} ${p} ${r}px ${h}`,E.textBaseline="alphabetic",E.textAlign="left",E.fillStyle="black",this.gridOuter=new Float64Array(y*y),this.gridInner=new Float64Array(y*y),this.f=new Float64Array(y),this.z=new Float64Array(y+1),this.v=new Uint16Array(y)}_createCanvas(r){const e=document.createElement("canvas");return e.width=e.height=r,e}draw(r){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:h,actualBoundingBoxRight:p}=this.ctx.measureText(r),m=Math.ceil(i),y=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(p-h))),b=Math.min(this.size-this.buffer,m+Math.ceil(a)),E=y+2*this.buffer,C=b+2*this.buffer,A=Math.max(E*C,0),P=new Uint8ClampedArray(A),R={data:P,width:E,height:C,glyphWidth:y,glyphHeight:b,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(y===0||b===0)return R;const{ctx:z,buffer:B,gridInner:V,gridOuter:Q}=this;z.clearRect(B,B,y,b),z.fillText(r,B,B+m);const ae=z.getImageData(B,B,y,b);Q.fill(Rm,0,A),V.fill(0,0,A);for(let le=0;le<b;le++)for(let he=0;he<y;he++){const me=ae.data[4*(le*y+he)+3]/255;if(me===0)continue;const ve=(le+B)*E+he+B;if(me===1)Q[ve]=0,V[ve]=Rm;else{const Pe=.5-me;Q[ve]=Pe>0?Pe*Pe:0,V[ve]=Pe<0?Pe*Pe:0}}FP(Q,0,0,E,C,E,this.f,this.v,this.z),FP(V,B,B,y,b,E,this.f,this.v,this.z);for(let le=0;le<A;le++){const he=Math.sqrt(Q[le])-Math.sqrt(V[le]);P[le]=Math.round(255-255*(he/this.radius+this.cutoff))}return R}};const tu=Os;function jP(r,e,i,a){const h=[],p=r.imagePrimary,m=p.pixelRatio,y=p.paddedRect.w-2*tu,b=p.paddedRect.h-2*tu,E=r.right-r.left,C=r.bottom-r.top,A=p.stretchX||[[0,y]],P=p.stretchY||[[0,b]],R=(Ve,ht)=>Ve+ht[1]-ht[0],z=A.reduce(R,0),B=P.reduce(R,0),V=y-z,Q=b-B;let ae=0,le=z,he=0,me=B,ve=0,Pe=V,Ne=0,je=Q;if(p.content&&a){const Ve=p.content;ae=Fv(A,0,Ve[0]),he=Fv(P,0,Ve[1]),le=Fv(A,Ve[0],Ve[2]),me=Fv(P,Ve[1],Ve[3]),ve=Ve[0]-ae,Ne=Ve[1]-he,Pe=Ve[2]-Ve[0]-le,je=Ve[3]-Ve[1]-me}const Ye=(Ve,ht,Ct,st)=>{const wt=Bv(Ve.stretch-ae,le,E,r.left),ot=jv(Ve.fixed-ve,Pe,Ve.stretch,z),Rt=Bv(ht.stretch-he,me,C,r.top),Ht=jv(ht.fixed-Ne,je,ht.stretch,B),Tt=Bv(Ct.stretch-ae,le,E,r.left),hr=jv(Ct.fixed-ve,Pe,Ct.stretch,z),Yt=Bv(st.stretch-he,me,C,r.top),Pt=jv(st.fixed-Ne,je,st.stretch,B),dr=new se(wt,Rt),rr=new se(Tt,Rt),ar=new se(Tt,Yt),Mt=new se(wt,Yt),yr=new se(ot/m,Ht/m),Zr=new se(hr/m,Pt/m),Mr=e*Math.PI/180;if(Mr){const On=Math.sin(Mr),dn=Math.cos(Mr),_n=[dn,-On,On,dn];dr._matMult(_n),rr._matMult(_n),Mt._matMult(_n),ar._matMult(_n)}const jr=Ve.stretch+Ve.fixed,nn=Ct.stretch+Ct.fixed,Pn=ht.stretch+ht.fixed,Pr=st.stretch+st.fixed,qn=r.imageSecondary;return{tl:dr,tr:rr,bl:Mt,br:ar,texPrimary:{x:p.paddedRect.x+tu+jr,y:p.paddedRect.y+tu+Pn,w:nn-jr,h:Pr-Pn},texSecondary:qn?{x:qn.paddedRect.x+tu+jr,y:qn.paddedRect.y+tu+Pn,w:nn-jr,h:Pr-Pn}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yr,pixelOffsetBR:Zr,minFontScaleX:Pe/m/E,minFontScaleY:je/m/C,isSDF:i}};if(a&&(p.stretchX||p.stretchY)){const Ve=$P(A,V,z),ht=$P(P,Q,B);for(let Ct=0;Ct<Ve.length-1;Ct++){const st=Ve[Ct],wt=Ve[Ct+1];for(let ot=0;ot<ht.length-1;ot++)h.push(Ye(st,ht[ot],wt,ht[ot+1]))}}else h.push(Ye({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:y+1},{fixed:0,stretch:b+1}));return h}function Fv(r,e,i){let a=0;for(const h of r)a+=Math.max(e,Math.min(i,h[1]))-Math.max(e,Math.min(i,h[0]));return a}function $P(r,e,i){const a=[{fixed:-tu,stretch:0}];for(const[h,p]of r){const m=a[a.length-1];a.push({fixed:h-m.stretch,stretch:m.stretch}),a.push({fixed:h-m.stretch,stretch:m.stretch+(p-h)})}return a.push({fixed:e+tu,stretch:i}),a}function Bv(r,e,i,a){return r/e*i+a}function jv(r,e,i,a){return r-e*i/a}function r$(r,e,i,a){const h=e+r.positionedLines[a].lineOffset;return a===0?i+h/2:i+(h+(e+r.positionedLines[a-1].lineOffset))/2}function n$(r,e=1,i=!1){let a=1/0,h=1/0,p=-1/0,m=-1/0;const y=r[0];for(let R=0;R<y.length;R++){const z=y[R];(!R||z.x<a)&&(a=z.x),(!R||z.y<h)&&(h=z.y),(!R||z.x>p)&&(p=z.x),(!R||z.y>m)&&(m=z.y)}const b=Math.min(p-a,m-h);let E=b/2;const C=new xd([],i$);if(b===0)return new se(a,h);for(let R=a;R<p;R+=b)for(let z=h;z<m;z+=b)C.push(new lf(R+E,z+E,E,r));let A=function(R){let z=0,B=0,V=0;const Q=R[0];for(let ae=0,le=Q.length,he=le-1;ae<le;he=ae++){const me=Q[ae],ve=Q[he],Pe=me.x*ve.y-ve.x*me.y;B+=(me.x+ve.x)*Pe,V+=(me.y+ve.y)*Pe,z+=3*Pe}return new lf(B/z,V/z,0,R)}(r),P=C.length;for(;C.length;){const R=C.pop();(R.d>A.d||!A.d)&&(A=R,i&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,P)),R.max-A.d<=e||(E=R.h/2,C.push(new lf(R.p.x-E,R.p.y-E,E,r)),C.push(new lf(R.p.x+E,R.p.y-E,E,r)),C.push(new lf(R.p.x-E,R.p.y+E,E,r)),C.push(new lf(R.p.x+E,R.p.y+E,E,r)),P+=4)}return i&&(console.log(`num probes: ${P}`),console.log(`best distance: ${A.d}`)),A.p}function i$(r,e){return e.max-r.max}class lf{constructor(e,i,a,h){this.p=new se(e,i),this.h=a,this.d=function(p,m){let y=!1,b=1/0;for(let E=0;E<m.length;E++){const C=m[E];for(let A=0,P=C.length,R=P-1;A<P;R=A++){const z=C[A],B=C[R];z.y>p.y!=B.y>p.y&&p.x<(B.x-z.x)*(p.y-z.y)/(B.y-z.y)+z.x&&(y=!y),b=Math.min(b,Uk(p,z,B))}}return(y?1:-1)*Math.sqrt(b)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const cf=7,Sw=Number.POSITIVE_INFINITY,o$=Math.sqrt(2);function UP(r,[e,i]){let a=0,h=0;if(i===Sw){e<0&&(e=0);const p=e/o$;switch(r){case"top-right":case"top-left":h=p-cf;break;case"bottom-right":case"bottom-left":h=-p+cf;break;case"bottom":h=-e+cf;break;case"top":h=e-cf}switch(r){case"top-right":case"bottom-right":a=-p;break;case"top-left":case"bottom-left":a=p;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),r){case"top-right":case"top-left":case"top":h=i-cf;break;case"bottom-right":case"bottom-left":case"bottom":h=-i+cf}switch(r){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,h]}function s$(r,e,i,a,h,p,m,y,b,E,C){r.createArrays(),r.tilePixelRatio=kt/(512*r.overscaling),r.compareText={},r.iconsNeedLinear=!1;const A=r.layers[0].layout,P=r.layers[0]._unevaluatedLayout._values,R={};if(r.textSizeData.kind==="composite"){const{minZoom:Q,maxZoom:ae}=r.textSizeData;R.compositeTextSizes=[P["text-size"].possiblyEvaluate(new Ae(Q),y),P["text-size"].possiblyEvaluate(new Ae(ae),y)]}if(r.iconSizeData.kind==="composite"){const{minZoom:Q,maxZoom:ae}=r.iconSizeData;R.compositeIconSizes=[P["icon-size"].possiblyEvaluate(new Ae(Q),y),P["icon-size"].possiblyEvaluate(new Ae(ae),y)]}R.layoutTextSize=P["text-size"].possiblyEvaluate(new Ae(b+1),y),R.layoutIconSize=P["icon-size"].possiblyEvaluate(new Ae(b+1),y),R.textMaxSize=P["text-size"].possiblyEvaluate(new Ae(18),y);const z=A.get("text-rotation-alignment")==="map"&&A.get("symbol-placement")!=="point",B=A.get("text-size");let V=!1;for(const Q of r.features)if(Q.icon&&Q.icon.nameSecondary){V=!0;break}for(const Q of r.features){const ae=A.get("text-font").evaluate(Q,{},y).join(","),le=B.evaluate(Q,{},y),he=R.layoutTextSize.evaluate(Q,{},y),me=(R.layoutIconSize.evaluate(Q,{},y),{horizontal:{},vertical:void 0}),ve=Q.text;let Pe,Ne=[0,0];if(ve){const Ve=ve.toString(),ht=A.get("text-letter-spacing").evaluate(Q,{},y)*po,Ct=A.get("text-line-height").evaluate(Q,{},y)*po,st=M(Ve)?ht:0,wt=A.get("text-anchor").evaluate(Q,{},y),ot=A.get("text-variable-anchor");if(!ot){const Yt=A.get("text-radial-offset").evaluate(Q,{},y);Ne=Yt?UP(wt,[Yt*po,Sw]):A.get("text-offset").evaluate(Q,{},y).map(Pt=>Pt*po)}let Rt=z?"center":A.get("text-justify").evaluate(Q,{},y);const Ht=A.get("symbol-placement")==="point",Tt=Ht?A.get("text-max-width").evaluate(Q,{},y)*po:1/0,hr=Yt=>{r.allowVerticalPlacement&&S(Ve)&&(me.vertical=vw(ve,e,i,h,ae,Tt,Ct,wt,Yt,st,Ne,Js.vertical,!0,he,le))};if(!z&&ot){const Yt=Rt==="auto"?ot.map(dr=>Tw(dr)):[Rt];let Pt=!1;for(let dr=0;dr<Yt.length;dr++){const rr=Yt[dr];if(!me.horizontal[rr])if(Pt)me.horizontal[rr]=me.horizontal[0];else{const ar=vw(ve,e,i,h,ae,Tt,Ct,"center",rr,st,Ne,Js.horizontal,!1,he,le);ar&&(me.horizontal[rr]=ar,Pt=ar.positionedLines.length===1)}}hr("left")}else{if(Rt==="auto"&&(Rt=Tw(wt)),Ht||A.get("text-writing-mode").indexOf("horizontal")>=0||!S(Ve)){const Yt=vw(ve,e,i,h,ae,Tt,Ct,wt,Rt,st,Ne,Js.horizontal,!1,he,le);Yt&&(me.horizontal[Rt]=Yt)}hr(Ht?"left":Rt)}}let je=!1;if(Q.icon&&Q.icon.namePrimary){const Ve=a[Q.icon.namePrimary];Ve&&(Pe=J8(h[Q.icon.namePrimary],Q.icon.nameSecondary?h[Q.icon.nameSecondary]:void 0,A.get("icon-offset").evaluate(Q,{},y),A.get("icon-anchor").evaluate(Q,{},y)),je=Ve.sdf,r.sdfIcons===void 0?r.sdfIcons=Ve.sdf:r.sdfIcons!==Ve.sdf&&mr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ve.pixelRatio!==r.pixelRatio||A.get("icon-rotate").constantOr(1)!==0)&&(r.iconsNeedLinear=!0))}const Ye=GP(me.horizontal)||me.vertical;r.iconsInText||(r.iconsInText=!!Ye&&Ye.iconsInText),(Ye||Pe)&&a$(r,Q,me,Pe,a,R,he,0,Ne,je,m,y,E,C,V)}p&&r.generateCollisionDebugBuffers(b,r.collisionBoxArray)}function Tw(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function a$(r,e,i,a,h,p,m,y,b,E,C,A,P,R,z){let B=p.textMaxSize.evaluate(e,{},A);B===void 0&&(B=m);const V=r.layers[0].layout,Q=V.get("icon-offset").evaluate(e,{},A),ae=GP(i.horizontal)||i.vertical,le=P.name==="globe",he=po,me=m/he,ve=r.tilePixelRatio*B/he,Pe=(wt=r.overscaling,r.zoom>18&&wt>2&&(wt>>=1),Math.max(kt/(512*wt),1)*V.get("symbol-spacing")),Ne=V.get("text-padding")*r.tilePixelRatio,je=V.get("icon-padding")*r.tilePixelRatio,Ye=ze(V.get("text-max-angle")),Ve=V.get("text-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",ht=V.get("icon-rotation-alignment")==="map"&&V.get("symbol-placement")!=="point",Ct=V.get("symbol-placement"),st=Pe/2;var wt;const ot=V.get("icon-text-fit").evaluate(e,{},A),Rt=V.get("icon-text-fit-padding").evaluate(e,{},A),Ht=ot!=="none";let Tt;r.hasAnyIconTextFit===!1&&Ht&&(r.hasAnyIconTextFit=!0),a&&Ht&&(r.allowVerticalPlacement&&i.vertical&&(Tt=kP(a,i.vertical,ot,Rt,Q,me)),ae&&(a=kP(a,ae,ot,Rt,Q,me)));const hr=(Yt,Pt,dr)=>{if(Pt.x<0||Pt.x>=kt||Pt.y<0||Pt.y>=kt)return;let rr=null;if(le){const{x:ar,y:Mt,z:yr}=P.projectTilePoint(Pt.x,Pt.y,dr);rr={anchor:new uc(ar,Mt,yr,0,void 0),up:P.upVector(dr,Pt.x,Pt.y)}}(function(ar,Mt,yr,Zr,Mr,jr,nn,Pn,Pr,qn,On,dn,_n,on,ai,Wn,yi,eo,Ko,Ei,di,No,Fo,Jo,Hn,Xa,ff){const dc=ar.addToLineVertexArray(Mt,Zr);let fc,Jm,eg,u0,uD,hD,dD,fD=0,pD=0,mD=0,gD=0,Jw=-1,eE=-1;const Ml={};let _D=bb("");const Lh=yr?yr.anchor:Mt,tE=Pr.layout.get("icon-text-fit").evaluate(di,{},Hn)!=="none";let rE=0,nE=0;if(Pr._unevaluatedLayout.getValue("text-radial-offset")===void 0?[rE,nE]=Pr.layout.get("text-offset").evaluate(di,{},Hn).map(Ds=>Ds*po):(rE=Pr.layout.get("text-radial-offset").evaluate(di,{},Hn)*po,nE=Sw),ar.allowVerticalPlacement&&Mr.vertical){const Ds=Mr.vertical;if(ai)hD=Cw(Ds),Pn&&(dD=Cw(Pn));else{const Rs=Pr.layout.get("text-rotate").evaluate(di,{},Hn)+90;eg=$v(qn,Lh,Mt,On,dn,_n,Ds,on,Rs,Wn),Pn&&(u0=$v(qn,Lh,Mt,On,dn,_n,Pn,eo,Rs))}}if(jr){const Ds=Pr.layout.get("icon-rotate").evaluate(di,{},Hn),Rs=jP(jr,Ds,Fo,tE),pf=Pn?jP(Pn,Ds,Fo,tE):void 0;Jm=$v(qn,Lh,Mt,On,dn,_n,jr,eo,Ds),fD=4*Rs.length;const yD=ar.iconSizeData;let zh=null;yD.kind==="source"?(zh=[qa*Pr.layout.get("icon-size").evaluate(di,{},Hn)],zh[0]>ru&&mr(`${ar.layerIds[0]}: Value for "icon-size" is >= ${Lm}. Reduce your "icon-size".`)):yD.kind==="composite"&&(zh=[qa*No.compositeIconSizes[0].evaluate(di,{},Hn),qa*No.compositeIconSizes[1].evaluate(di,{},Hn)],(zh[0]>ru||zh[1]>ru)&&mr(`${ar.layerIds[0]}: Value for "icon-size" is >= ${Lm}. Reduce your "icon-size".`)),ar.addSymbols(ar.icon,Rs,zh,Ei,Ko,di,!1,yr,Mt,dc.lineStartIndex,dc.lineLength,-1,Jo,Hn,Xa,ff),Jw=ar.icon.placedSymbolArray.length-1,pf&&(pD=4*pf.length,ar.addSymbols(ar.icon,pf,zh,Ei,Ko,di,Js.vertical,yr,Mt,dc.lineStartIndex,dc.lineLength,-1,Jo,Hn,Xa,ff),eE=ar.icon.placedSymbolArray.length-1)}for(const Ds in Mr.horizontal){const Rs=Mr.horizontal[Ds];fc||(_D=bb(Rs.text),ai?uD=Cw(Rs):fc=$v(qn,Lh,Mt,On,dn,_n,Rs,on,Pr.layout.get("text-rotate").evaluate(di,{},Hn),Wn));const pf=Rs.positionedLines.length===1;if(mD+=VP(ar,yr,Mt,Rs,nn,Pr,ai,di,Wn,dc,Mr.vertical?Js.horizontal:Js.horizontalOnly,pf?Object.keys(Mr.horizontal):[Ds],Ml,Jw,No,Jo,Hn,Xa),pf)break}Mr.vertical&&(gD+=VP(ar,yr,Mt,Mr.vertical,nn,Pr,ai,di,Wn,dc,Js.vertical,["vertical"],Ml,eE,No,Jo,Hn,Xa));let uu=-1;const iE=(Ds,Rs)=>Ds?Math.max(Ds,Rs):Rs;uu=iE(uD,uu),uu=iE(hD,uu),uu=iE(dD,uu);const w7=uu>-1?1:0;ar.glyphOffsetArray.length>=jm.MAX_GLYPHS&&mr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),di.sortKey!==void 0&&ar.addToSortKeyRanges(ar.symbolInstances.length,di.sortKey),ar.symbolInstances.emplaceBack(Mt.x,Mt.y,Lh.x,Lh.y,Lh.z,Ml.right>=0?Ml.right:-1,Ml.center>=0?Ml.center:-1,Ml.left>=0?Ml.left:-1,Ml.vertical>=0?Ml.vertical:-1,Jw,eE,_D,fc!==void 0?fc:ar.collisionBoxArray.length,fc!==void 0?fc+1:ar.collisionBoxArray.length,eg!==void 0?eg:ar.collisionBoxArray.length,eg!==void 0?eg+1:ar.collisionBoxArray.length,Jm!==void 0?Jm:ar.collisionBoxArray.length,Jm!==void 0?Jm+1:ar.collisionBoxArray.length,u0||ar.collisionBoxArray.length,u0?u0+1:ar.collisionBoxArray.length,On,mD,gD,fD,pD,w7,0,rE,nE,uu,0,tE?1:0)})(r,Pt,rr,Yt,i,a,h,Tt,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,Ne,Ve,b,0,je,ht,Q,e,p,E,C,A,R,z)};if(Ct==="line")for(const Yt of zP(e.geometry,0,0,kt,kt)){const Pt=t$(Yt,Pe,Ye,i.vertical||ae,a,he,ve,r.overscaling,kt);for(const dr of Pt)ae&&l$(r,ae.text,st,dr)||hr(Yt,dr,A)}else if(Ct==="line-center"){for(const Yt of e.geometry)if(Yt.length>1){const Pt=e$(Yt,Ye,i.vertical||ae,a,he,ve);Pt&&hr(Yt,Pt,A)}}else if(e.type==="Polygon")for(const Yt of hw(e.geometry,0)){const Pt=n$(Yt,16);hr(Yt[0],new uc(Pt.x,Pt.y,0,0,void 0),A)}else if(e.type==="LineString")for(const Yt of e.geometry)hr(Yt,new uc(Yt[0].x,Yt[0].y,0,0,void 0),A);else if(e.type==="Point")for(const Yt of e.geometry)for(const Pt of Yt)hr([Pt],new uc(Pt.x,Pt.y,0,0,void 0),A)}const Lm=255,ru=Lm*qa;function VP(r,e,i,a,h,p,m,y,b,E,C,A,P,R,z,B,V,Q){const ae=function(me,ve,Pe,Ne,je,Ye,Ve,ht){const Ct=[];if(ve.positionedLines.length===0)return Ct;const st=Ne.layout.get("text-rotate").evaluate(Ye,{})*Math.PI/180,wt=function(hr){const Yt=hr[0],Pt=hr[1],dr=Yt*Pt;return dr>0?[Yt,-Pt]:dr<0?[-Yt,Pt]:Yt===0?[Pt,Yt]:[Pt,-Yt]}(Pe);let ot=Math.abs(ve.top-ve.bottom);for(const hr of ve.positionedLines)ot-=hr.lineOffset;const Rt=ve.positionedLines.length,Ht=ot/Rt;let Tt=ve.top-Pe[1];for(let hr=0;hr<Rt;++hr){const Yt=ve.positionedLines[hr];Tt=r$(ve,Ht,Tt,hr);for(const Pt of Yt.positionedGlyphs){if(!Pt.rect)continue;const dr=Pt.rect||{};let rr=EP+1,ar=!0,Mt=1,yr=0;if(Pt.imageName){const Ei=Ve[Pt.imageName];if(!Ei)continue;if(Ei.sdf){mr("SDF images are not supported in formatted text and will be ignored.");continue}ar=!1,Mt=Ei.pixelRatio,rr=Os/Mt}const Zr=(je||ht)&&Pt.vertical,Mr=Pt.metrics.advance*Pt.scale/2,jr=Pt.metrics,nn=Pt.rect;if(nn===null)continue;ht&&ve.verticalizable&&(yr=Pt.imageName?Mr-Pt.metrics.width*Pt.scale/2:0);const Pn=je?[Pt.x+Mr,Pt.y]:[0,0];let Pr=[0,0],qn=[0,0],On=!1;je||(Zr?(qn=[Pt.x+Mr+wt[0],Pt.y+wt[1]-yr],On=!0):Pr=[Pt.x+Mr+Pe[0],Pt.y+Pe[1]-yr]);const dn=nn.w*Pt.scale/(Mt*(Pt.localGlyph?Wa:1)),_n=nn.h*Pt.scale/(Mt*(Pt.localGlyph?Wa:1));let on,ai,Wn,yi;if(Zr){const Ei=Pt.y-Tt,di=new se(-Mr,Mr-Ei),No=-Math.PI/2,Fo=new se(...qn);on=new se(-Mr+Pr[0],Pr[1]),on._rotateAround(No,di)._add(Fo),on.x+=-Ei+Mr,on.y-=(jr.left-rr)*Pt.scale;const Jo=Pt.imageName?jr.advance*Pt.scale:po*Pt.scale,Hn=String.fromCodePoint(Pt.glyph);W8(Hn)?on.x+=(1-rr)*Pt.scale:H8(Hn)?on.x+=Jo-jr.height*Pt.scale+(-rr-1)*Pt.scale:on.x+=Pt.imageName||jr.width+2*rr===nn.w&&jr.height+2*rr===nn.h?(Jo-_n)/2:(Jo-(jr.height+2*rr)*Pt.scale)/2,ai=new se(on.x,on.y-dn),Wn=new se(on.x+_n,on.y),yi=new se(on.x+_n,on.y-dn)}else{const Ei=(jr.left-rr)*Pt.scale-Mr+Pr[0],di=(-jr.top-rr)*Pt.scale+Pr[1],No=Ei+dn,Fo=di+_n;on=new se(Ei,di),ai=new se(No,di),Wn=new se(Ei,Fo),yi=new se(No,Fo)}if(st){let Ei;Ei=je?new se(0,0):On?new se(wt[0],wt[1]):new se(Pe[0],Pe[1]),on._rotateAround(st,Ei),ai._rotateAround(st,Ei),Wn._rotateAround(st,Ei),yi._rotateAround(st,Ei)}const eo=new se(0,0),Ko=new se(0,0);Ct.push({tl:on,tr:ai,bl:Wn,br:yi,texPrimary:dr,texSecondary:void 0,writingMode:ve.writingMode,glyphOffset:Pn,sectionIndex:Pt.sectionIndex,isSDF:ar,pixelOffsetTL:eo,pixelOffsetBR:Ko,minFontScaleX:0,minFontScaleY:0})}}return Ct}(0,a,b,p,m,y,h,r.allowVerticalPlacement),le=r.textSizeData;let he=null;le.kind==="source"?(he=[qa*p.layout.get("text-size").evaluate(y,{},V)],he[0]>ru&&mr(`${r.layerIds[0]}: Value for "text-size" is >= ${Lm}. Reduce your "text-size".`)):le.kind==="composite"&&(he=[qa*z.compositeTextSizes[0].evaluate(y,{},V),qa*z.compositeTextSizes[1].evaluate(y,{},V)],(he[0]>ru||he[1]>ru)&&mr(`${r.layerIds[0]}: Value for "text-size" is >= ${Lm}. Reduce your "text-size".`)),r.addSymbols(r.text,ae,he,b,m,y,C,e,i,E.lineStartIndex,E.lineLength,R,B,V,Q,!1);for(const me of A)P[me]=r.text.placedSymbolArray.length-1;return 4*ae.length}function GP(r){for(const e in r)return r[e];return null}function $v(r,e,i,a,h,p,m,y,b,E){let C=m.top,A=m.bottom,P=m.left,R=m.right;const z=m.collisionPadding;if(z&&(P-=z[0],C-=z[1],R+=z[2],A+=z[3]),b){const B=new se(P,C),V=new se(R,C),Q=new se(P,A),ae=new se(R,A),le=ze(b);let he=new se(0,0);E&&(he=new se(E[0],E[1])),B._rotateAround(le,he),V._rotateAround(le,he),Q._rotateAround(le,he),ae._rotateAround(le,he),P=Math.min(B.x,V.x,Q.x,ae.x),R=Math.max(B.x,V.x,Q.x,ae.x),C=Math.min(B.y,V.y,Q.y,ae.y),A=Math.max(B.y,V.y,Q.y,ae.y)}return r.emplaceBack(e.x,e.y,e.z,i.x,i.y,P,C,R,A,y,a,h,p),r.length-1}function Cw(r){r.collisionPadding&&(r.top-=r.collisionPadding[1],r.bottom+=r.collisionPadding[3]);const e=r.bottom-r.top;return e>0?Math.max(10,e):null}function l$(r,e,i,a){const h=r.compareText;if(e in h){const p=h[e];for(let m=p.length-1;m>=0;m--)if(a.dist(p[m])<i)return!0}else h[e]=[];return h[e].push(a),!1}function qP(r,e){const i=r.fovAboveCenter,a=r.elevation?r.elevation.getMinElevationBelowMSL()*e:0,h=(r._camera.position[2]*r.worldSize-a)/Math.cos(r._pitch),p=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-r._pitch-i,.01)),m=Math.sin(r._pitch)*p+h;return Math.min(1.01*m,h*(1/r._horizonShift))}function nu(r,e){if(!e.isReprojectedInTileSpace)return{scale:1<<r.z,x:r.x,y:r.y,x2:r.x+1,y2:r.y+1,projection:e};const i=Math.pow(2,-r.z),a=r.x*i,h=(r.x+1)*i,p=r.y*i,m=(r.y+1)*i,y=Ps(a),b=Ps(h),E=fo(p),C=fo(m),A=e.project(y,E),P=e.project(b,E),R=e.project(b,C),z=e.project(y,C);let B=Math.min(A.x,P.x,R.x,z.x),V=Math.min(A.y,P.y,R.y,z.y),Q=Math.max(A.x,P.x,R.x,z.x),ae=Math.max(A.y,P.y,R.y,z.y);const le=i/16;function he(ve,Pe,Ne,je,Ye,Ve){const ht=(Ne+Ye)/2,Ct=(je+Ve)/2,st=e.project(Ps(ht),fo(Ct)),wt=Math.max(0,B-st.x,V-st.y,st.x-Q,st.y-ae);B=Math.min(B,st.x),Q=Math.max(Q,st.x),V=Math.min(V,st.y),ae=Math.max(ae,st.y),wt>le&&(he(ve,st,Ne,je,ht,Ct),he(st,Pe,ht,Ct,Ye,Ve))}he(A,P,a,p,h,p),he(P,R,h,p,h,m),he(R,z,h,m,a,m),he(z,A,a,m,a,p),B-=le,V-=le,Q+=le,ae+=le;const me=1/Math.max(Q-B,ae-V);return{scale:me,x:B*me,y:V*me,x2:Q*me,y2:ae*me,projection:e}}function WP(r,{x:e,y:i},a=0){return new se(((e-a)*r.scale-r.x)*kt,(i*r.scale-r.y)*kt)}const c$=s.m.identity(new Float32Array(16));class iu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new hn(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a=!0){return e._coordinatePoint(e.locationCoordinate(i),a)}pixelsPerMeter(e,i){return Qo(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return qP(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,h){const p=e.horizonLineFromTop(!1),m=new se(i,Math.max(p,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,h))}pointCoordinate3D(e,i,a){const h=new se(i,a);if(e.elevation)return e.elevation.pointCoordinate(h);{const p=this.pointCoordinate(e,h.x,h.y,0);return[p.x,p.y,p.z]}}isPointAboveHorizon(e,i){if(e.elevation)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return c$}createTileMatrix(e,i,a){let h,p,m;const y=a.canonical,b=s.m.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){const E=nu(y,this);h=1,p=E.x+a.wrap*E.scale,m=E.y,s.m.scale(b,b,[h/E.scale,h/E.scale,e.pixelsPerMeter/i])}else h=i/e.zoomScale(y.z),p=(y.x+Math.pow(2,y.z)*a.wrap)*h,m=y.y*h;return s.m.translate(b,b,[p,m,0]),s.m.scale(b,b,[h/kt,h/kt,1]),b}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class u$ extends iu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(ze(i));this.n=(h+Math.sin(ze(a)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c:h,r0:p}=this,m=ze(e-this.center[0]),y=ze(i),b=Math.sqrt(h-2*a*Math.sin(y))/a;return{x:b*Math.sin(m*a),y:b*Math.cos(m*a)-p,z:0}}unproject(e,i){const{n:a,c:h,r0:p}=this,m=p+i;let y=Math.atan2(e,Math.abs(m))*Math.sign(m);m*a<0&&(y-=Math.PI*Math.sign(e)*Math.sign(m));const b=ze(this.center[0])*a;y=Vt(y,-Math.PI-b,Math.PI-b);const E=rt(De(y/a)+this.center[0],-180,180),C=Math.asin(rt((h-(e*e+m*m)*a*a)/(2*a),-1,1)),A=rt(De(C),-_i,_i);return new hn(E,A)}}const zm=1.340264,Nm=-.081106,Fm=893e-6,Bm=.003796,Uv=Math.sqrt(3)/2;class h$ extends iu{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(Uv*Math.sin(i)),h=a*a,p=h*h*h;return{x:.5*(e*Math.cos(a)/(Uv*(zm+3*Nm*h+p*(7*Fm+9*Bm*h)))/Math.PI+.5),y:1-.5*(a*(zm+Nm*h+p*(Fm+Bm*h))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,h=a*a,p=h*h*h;for(let C,A,P,R=0;R<12&&(A=a*(zm+Nm*h+p*(Fm+Bm*h))-i,P=zm+3*Nm*h+p*(7*Fm+9*Bm*h),C=A/P,a=rt(a-C,-Math.PI/3,Math.PI/3),h=a*a,p=h*h*h,!(Math.abs(C)<1e-12));++R);const m=Uv*e*(zm+3*Nm*h+p*(7*Fm+9*Bm*h))/Math.cos(a),y=Math.asin(Math.sin(a)/Uv),b=rt(180*m/Math.PI,-180,180),E=rt(180*y/Math.PI,-_i,_i);return new hn(b,E)}}class d$ extends iu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),h=rt(360*(.5-i),-_i,_i);return new hn(a,h)}}const uf=Math.PI/2;function Vv(r){return Math.tan((uf+r)/2)}class f$ extends iu{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let h=ze(i),p=ze(a);this.southernCenter=h+p<0,this.southernCenter&&(h=-h,p=-p);const m=Math.cos(h),y=Vv(h);this.n=h===p?Math.sin(h):Math.log(m/Math.cos(p))/Math.log(Vv(p)/y),this.f=m*Math.pow(Vv(h),this.n)/this.n}project(e,i){i=ze(i),this.southernCenter&&(i=-i),e=ze(e-this.center[0]);const a=1e-6,{n:h,f:p}=this;p>0?i<-uf+a&&(i=-uf+a):i>uf-a&&(i=uf-a);const m=p/Math.pow(Vv(i),h);let y=m*Math.sin(h*e),b=p-m*Math.cos(h*e);return y=.5*(y/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:y,y:this.southernCenter?b:1-b,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:h}=this,p=h-i,m=Math.sign(p),y=Math.sign(a)*Math.sqrt(e*e+p*p);let b=Math.atan2(e,Math.abs(p))*m;p*a<0&&(b-=Math.PI*Math.sign(e)*m);const E=rt(De(b/a)+this.center[0],-180,180),C=rt(De(2*Math.atan(Math.pow(h/y,1/a))-uf),-_i,_i);return new hn(E,this.southernCenter?-C:C)}}class HP extends iu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:wl(e),y:El(i),z:0}}unproject(e,i){const a=Ps(e),h=fo(i);return new hn(a,h)}}const ZP=ze(_i);class p$ extends iu{project(e,i){const a=(i=ze(i))*i,h=a*a;return{x:.5*((e=ze(e))*(.8707-.131979*a+h*(h*(.003971*a-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+h*(.028874*a-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,h=25,p=0,m=a*a;do{m=a*a;const E=m*m;p=(a*(1.007226+m*(.015085+E*(.028874*m-.044475-.005916*E)))-i)/(1.007226+m*(.045255+E*(.259866*m-.311325-.005916*11*E))),a=rt(a-p,-ZP,ZP)}while(Math.abs(p)>1e-6&&--h>0);m=a*a;const y=rt(De(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),b=De(a);return new hn(y,b)}}const XP=ze(_i);class m$ extends iu{project(e,i){i=ze(i),e=ze(e);const a=Math.cos(i),h=2/Math.PI,p=Math.acos(a*Math.cos(e/2)),m=Math.sin(p)/p,y=.5*(e*h+2*a*Math.sin(e/2)/m)||0,b=.5*(i+Math.sin(i)/m)||0;return{x:.5*(y/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,p=25;const m=1e-6;let y=0,b=0;do{const E=Math.cos(h),C=Math.sin(h),A=2*C*E,P=C*C,R=E*E,z=Math.cos(a/2),B=Math.sin(a/2),V=2*z*B,Q=B*B,ae=1-R*z*z,le=ae?1/ae:0,he=ae?Math.acos(E*z)*Math.sqrt(1/ae):0,me=.5*(2*he*E*B+2*a/Math.PI)-e,ve=.5*(he*C+h)-i,Pe=.5*le*(R*Q+he*E*z*P)+1/Math.PI,Ne=le*(V*A/4-he*C*B),je=.125*le*(A*B-he*C*R*V),Ye=.5*le*(P*z+he*Q*E)+.5,Ve=Ne*je-Ye*Pe;y=(ve*Ne-me*Ye)/Ve,b=(me*je-ve*Pe)/Ve,a=rt(a-y,-Math.PI,Math.PI),h=rt(h-b,-XP,XP)}while((Math.abs(y)>m||Math.abs(b)>m)&&--p>0);return new hn(De(a),De(h))}}class YP extends iu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(ze(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:h}=this;return{x:ze(e)*h*a+.5,y:-Math.sin(ze(i))/h*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:h}=this,p=-(i-.5)/a,m=rt(De((e-.5)/a)/h,-180,180),y=Math.asin(rt(p*h,-1,1)),b=rt(De(y),-_i,_i);return new hn(m,b)}}class g$ extends HP{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){const h=Cm(e,i,a),p=Mm(bl(a));return s.v.transformMat4(h,h,p),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,i){const a=Ch(i.lat,i.lng),h=s.v.normalize([],a),p=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude,m=Qo(1,0)*kt*p;s.v.scaleAndAdd(a,a,h,m);const y=s.m.identity(new Float64Array(16));return s.m.multiply(y,e.pixelMatrix,e.globeMatrix),s.v.transformMat4(a,a,y),new se(a[0],a[1])}pixelsPerMeter(e,i){return Qo(1,0)*i}pixelSpaceConversion(e,i,a){const h=Qo(1,e)*i,p=Fr(Qo(1,45)*i,h,a);return this.pixelsPerMeter(e,i)/p}createTileMatrix(e,i,a){const h=Zb(bl(a.canonical));return s.m.multiply(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,i){const{center:a}=e,h=Mm(bl(i));return s.m.rotateY(h,h,ze(a.lng)),s.m.rotateX(h,h,ze(a.lat)),s.m.scale(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,i,a,h){return Ck(e,i,a,!0)||new Eo(0,0)}pointCoordinate3D(e,i,a){const h=this.pointCoordinate(e,i,a,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,i){return!Ck(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(h,p){const m=h.cameraToCenterDistance,y=h._centerAltitude*p,b=h._camera,E=h._camera.forward(),C=s.v.add([],s.v.scale([],E,-m),[0,0,y]),A=h.worldSize/(2*Math.PI),P=[0,0,-A],R=h.width/h.height,z=Math.tan(h.fovAboveCenter),B=s.v.scale([],b.up(),z),V=s.v.scale([],b.right(),z*R),Q=s.v.normalize([],s.v.add([],s.v.add([],E,B),V)),ae=[];let le;if(new $b(C,Q).closestPointOnSphere(P,A,ae)){const he=s.v.add([],ae,P),me=s.v.sub([],he,C);le=Math.cos(h.fovAboveCenter)*s.v.length(me)}else{const he=s.v.sub([],C,P),me=s.v.sub([],P,C);s.v.normalize(me,me);const ve=s.v.length(he)-A;le=Math.sqrt(ve*(ve+2*A));const Pe=Math.acos(le/(A+ve))-Math.acos(s.v.dot(E,me));le*=Math.cos(Pe)}return 1.01*le}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=ac(e.zoom);if(a>0){const h=qP(e,Qo(1,e.center.lat)*e.worldSize),p=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Fr(i,h+p*(1-Math.cos(m)),Math.pow(a,10))}return i}upVector(e,i,a){return Cm(i,a,e,1)}upVectorScale(e){return{metersToTile:mv(_v(bl(e)))}}}function QP(r){const e=r.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(r.name){case"mercator":return new HP(r);case"equirectangular":return new d$(r);case"naturalEarth":return new p$(r);case"equalEarth":return new h$(r);case"winkelTripel":return new m$(r);case"albers":return i?new YP(r):new u$(r);case"lambertConformalConic":return i?new YP(r):new f$(r);case"globe":return new g$(r)}throw new Error(`Invalid projection name: ${r.name}`)}const _$=new pt({"symbol-placement":new ye(Ge.layout_symbol["symbol-placement"]),"symbol-spacing":new ye(Ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ye(Ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new $e(Ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ye(Ge.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ye(Ge.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new ye(Ge.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ye(Ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new ye(Ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ye(Ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new $e(Ge.layout_symbol["icon-size"]),"icon-text-fit":new $e(Ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new $e(Ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new $e(Ge.layout_symbol["icon-image"]),"icon-rotate":new $e(Ge.layout_symbol["icon-rotate"]),"icon-padding":new ye(Ge.layout_symbol["icon-padding"]),"icon-keep-upright":new ye(Ge.layout_symbol["icon-keep-upright"]),"icon-offset":new $e(Ge.layout_symbol["icon-offset"]),"icon-anchor":new $e(Ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ye(Ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ye(Ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ye(Ge.layout_symbol["text-rotation-alignment"]),"text-field":new $e(Ge.layout_symbol["text-field"]),"text-font":new $e(Ge.layout_symbol["text-font"]),"text-size":new $e(Ge.layout_symbol["text-size"]),"text-max-width":new $e(Ge.layout_symbol["text-max-width"]),"text-line-height":new $e(Ge.layout_symbol["text-line-height"]),"text-letter-spacing":new $e(Ge.layout_symbol["text-letter-spacing"]),"text-justify":new $e(Ge.layout_symbol["text-justify"]),"text-radial-offset":new $e(Ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ye(Ge.layout_symbol["text-variable-anchor"]),"text-anchor":new $e(Ge.layout_symbol["text-anchor"]),"text-max-angle":new ye(Ge.layout_symbol["text-max-angle"]),"text-writing-mode":new ye(Ge.layout_symbol["text-writing-mode"]),"text-rotate":new $e(Ge.layout_symbol["text-rotate"]),"text-padding":new ye(Ge.layout_symbol["text-padding"]),"text-keep-upright":new ye(Ge.layout_symbol["text-keep-upright"]),"text-transform":new $e(Ge.layout_symbol["text-transform"]),"text-offset":new $e(Ge.layout_symbol["text-offset"]),"text-allow-overlap":new ye(Ge.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ye(Ge.layout_symbol["text-ignore-placement"]),"text-optional":new ye(Ge.layout_symbol["text-optional"]),visibility:new ye(Ge.layout_symbol.visibility)});var Mw={paint:new pt({"icon-opacity":new $e(Ge.paint_symbol["icon-opacity"]),"icon-emissive-strength":new $e(Ge.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new $e(Ge.paint_symbol["text-emissive-strength"]),"icon-color":new $e(Ge.paint_symbol["icon-color"]),"icon-halo-color":new $e(Ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new $e(Ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new $e(Ge.paint_symbol["icon-halo-blur"]),"icon-translate":new ye(Ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new ye(Ge.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new $e(Ge.paint_symbol["icon-image-cross-fade"]),"text-opacity":new $e(Ge.paint_symbol["text-opacity"]),"text-color":new $e(Ge.paint_symbol["text-color"],{runtimeType:xo,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new $e(Ge.paint_symbol["text-halo-color"]),"text-halo-width":new $e(Ge.paint_symbol["text-halo-width"]),"text-halo-blur":new $e(Ge.paint_symbol["text-halo-blur"]),"text-translate":new ye(Ge.paint_symbol["text-translate"]),"text-translate-anchor":new ye(Ge.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ye(Ge.paint_symbol["icon-color-saturation"])}),layout:_$};class KP{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:co,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Zt(KP,"FormatSectionOverride",{omit:["defaultValue"]});class Gv extends Wt{constructor(e,i,a){super(e,Mw,i,a)}recalculate(e,i){super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const h=[];for(const p of a)h.indexOf(p)<0&&h.push(p);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,i,a,h){const p=this.layout.get(e).evaluate(i,{},a,h),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||Nd(m.value)||!p?p:function(y,b){return b.replace(/{([^{}]+)}/g,(E,C)=>C in y?String(y[C]):"")}(i.properties,p)}createBucket(e){return new jm(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of Mw.paint.overridableProperties){if(!Gv.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new KP(i),h=new lm(a,i.property.specification,this.scope,this.options);let p=null;p=i.value.kind==="constant"||i.value.kind==="source"?new ph("source",h):new mh("composite",h,i.value.zoomStops,i.value._interpolationType),this.paint._values[e]=new Qe(i.property,p,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&Gv.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),h=Mw.paint.properties[i];let p=!1;const m=y=>{for(const b of y)if(h.overrides&&h.overrides.hasOverride(b))return void(p=!0)};if(a.value.kind==="constant"&&a.value.value instanceof $i)m(a.value.value.sections);else if(a.value.kind==="source"){const y=E=>{p||(E instanceof Gs&&ei(E.value)===ls?m(E.value.sections):E instanceof Dn?m(E.sections):E.eachChild(y))},b=a.value;b._styleExpression&&y(b._styleExpression.expression)}return p}getProgramIds(){const e=this.paint.get("icon-opacity").constantOr(1)!==0,i=this.paint.get("text-opacity").constantOr(1)!==0,a=[];return e&&a.push("symbolIcon"),i&&a.push("symbolSDF"),a}getDefaultProgramParams(e,i){return{config:new wh(this,i),overrideFog:!1}}}const y$=kv.types,v$=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function qv(r,e,i,a,h,p,m,y,b,E,C,A,P){const R=y?Math.min(ru,Math.round(y[0])):0,z=y?Math.min(ru,Math.round(y[1])):0;r.emplaceBack(e,i,Math.round(32*a),Math.round(32*h),p,m,(R<<1)+(b?1:0),z,16*E,16*C,256*A,256*P)}function Wv(r,e,i){r.emplaceBack(e,i)}function Hv(r,e,i,a,h,p,m){r.emplaceBack(e,i,a,h,p,m)}function Zv(r,e,i,a,h){r.emplaceBack(e,i,a,h),r.emplaceBack(e,i,a,h),r.emplaceBack(e,i,a,h),r.emplaceBack(e,i,a,h)}function x$(r){for(const e of r.sections)if(K(e.text))return!0;return!1}class Iw{constructor(e){this.layoutVertexArray=new Qi,this.indexArray=new vn,this.programConfigurations=e,this.segments=new Qn,this.dynamicLayoutVertexArray=new un,this.opacityVertexArray=new uo,this.placedSymbolArray=new GI,this.iconTransitioningVertexArray=new zo,this.globeExtVertexArray=new Rn,this.zOffsetVertexArray=new $a}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,i,a,h,p){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,z8.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,F8.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,v$,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,j8.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,N8.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||p)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,B8.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Zt(Iw,"SymbolBuffers");class Aw{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new Qn,this.collisionVertexArray=new Hs,this.collisionVertexArrayExt=new un}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,$8.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,U8.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Zt(Aw,"CollisionBuffers");class Xv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=s.m.identity([]),this.placementViewportMatrix=s.m.identity([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_w(this.zoom,i["text-size"]),this.iconSizeData=_w(this.zoom,i["icon-size"]);const a=this.layers[0].layout,h=a.get("symbol-sort-key"),p=a.get("symbol-z-order");this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=p!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(p==="viewport-y"||p==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(m=>Js[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=a.get("symbol-z-elevate")}createArrays(){this.text=new Iw(new Xc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Iw(new Xc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new HI,this.lineVertexArray=new ZI,this.symbolInstances=new WI}calculateGlyphDependencies(e,i,a,h,p){for(let m=0;m<e.length;m++){const y=e.codePointAt(m);if(y===void 0)break;if(i[y]=!0,h&&p&&y<=65535){const b=Om[e.charAt(m)];b&&(i[b.charCodeAt(0)]=!0)}}}populate(e,i,a,h){const p=this.layers[0],m=p.layout,y=this.projection.name==="globe",b=m.get("text-font"),E=m.get("text-field"),C=m.get("icon-image"),A=(E.value.kind!=="constant"||E.value.value instanceof $i&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),P=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,R=m.get("symbol-sort-key");if(this.features=[],!A&&!P)return;const z=i.iconDependencies,B=i.glyphDependencies,V=i.availableImages,Q=new Ae(this.zoom);for(const{feature:ae,id:le,index:he,sourceLayerIndex:me}of e){const ve=p._featureFilter.needGeometry,Pe=Jc(ae,ve);if(!p._featureFilter.filter(Q,Pe,a))continue;if(ve||(Pe.geometry=Sl(ae,a,h)),y&&ae.type!==1&&a.z<=5){const Ve=Pe.geometry,ht=.98078528056,Ct=(st,wt)=>{const ot=Cm(st.x,st.y,a,1),Rt=Cm(wt.x,wt.y,a,1);return s.v.dot(ot,Rt)<ht};for(let st=0;st<Ve.length;st++)Ve[st]=P6(Ve[st],Ct)}let Ne,je;if(A){const Ve=p.getValueAndResolveTokens("text-field",Pe,a,V),ht=$i.factory(Ve);x$(ht)&&(this.hasRTLText=!0),(!this.hasRTLText||fe()==="unavailable"||this.hasRTLText&&Oe.isParsed())&&(Ne=q8(ht,p,Pe))}if(P){const Ve=p.getValueAndResolveTokens("icon-image",Pe,a,V);je=Ve instanceof Yi?Ve:Yi.fromString(Ve)}if(!Ne&&!je)continue;const Ye=this.sortFeaturesByKey?R.evaluate(Pe,{},a):void 0;if(this.features.push({id:le,text:Ne,icon:je,index:he,sourceLayerIndex:me,geometry:Pe.geometry,properties:ae.properties,type:y$[ae.type],sortKey:Ye}),je&&(z[je.namePrimary]=!0,je.nameSecondary&&(z[je.nameSecondary]=!0)),Ne){const Ve=b.evaluate(Pe,{},a).join(","),ht=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Js.vertical)>=0;for(const Ct of Ne.sections)if(Ct.image)z[Ct.image.namePrimary]=!0;else{const st=S(Ne.toString()),wt=Ct.fontStack||Ve,ot=B[wt]=B[wt]||{};this.calculateGlyphDependencies(Ct.text,ot,ht,this.allowVerticalPlacement,st)}}}m.get("symbol-placement")==="line"&&(this.features=function(ae){const le={},he={},me=[];let ve=0;function Pe(Ve){me.push(ae[Ve]),ve++}function Ne(Ve,ht,Ct){const st=he[Ve];return delete he[Ve],he[ht]=st,me[st].geometry[0].pop(),me[st].geometry[0]=me[st].geometry[0].concat(Ct[0]),st}function je(Ve,ht,Ct){const st=le[ht];return delete le[ht],le[Ve]=st,me[st].geometry[0].shift(),me[st].geometry[0]=Ct[0].concat(me[st].geometry[0]),st}function Ye(Ve,ht,Ct){const st=Ct?ht[0][ht[0].length-1]:ht[0][0];return`${Ve}:${st.x}:${st.y}`}for(let Ve=0;Ve<ae.length;Ve++){const ht=ae[Ve],Ct=ht.geometry,st=ht.text?ht.text.toString():null;if(!st){Pe(Ve);continue}const wt=Ye(st,Ct),ot=Ye(st,Ct,!0);if(wt in he&&ot in le&&he[wt]!==le[ot]){const Rt=je(wt,ot,Ct),Ht=Ne(wt,ot,me[Rt].geometry);delete le[wt],delete he[ot],he[Ye(st,me[Ht].geometry,!0)]=Ht,me[Rt].geometry=null}else wt in he?Ne(wt,ot,Ct):ot in le?je(wt,ot,Ct):(Pe(Ve),le[wt]=ve-1,he[ot]=ve-1)}return me.filter(Ve=>Ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ae,le)=>ae.sortKey-le.sortKey)}update(e,i,a,h,p){const m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;const y=m?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,i,y,a,h,p),this.icon.programConfigurations.updatePaintArrays(e,i,y,a,h,p)}updateZOffset(){const e=(p,m,y)=>{a+=m,a>p.length&&p.resize(a);for(let b=-m;b<0;b++)p.emplace(b+a,y)},i=(p,m,y)=>{h+=m,h>p.length&&p.resize(h);for(let b=-m;b<0;b++)p.emplace(b+h,y)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,h=0;for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p),{numHorizontalGlyphVertices:y,numVerticalGlyphVertices:b,numIconVertices:E}=m,C=m.zOffset,A=E>0;if((y>0||b>0)&&(e(this.text.zOffsetVertexArray,y,C),e(this.text.zOffsetVertexArray,b,C)),A){const{placedIconSymbolIndex:P,verticalPlacedIconSymbolIndex:R}=m;P>=0&&i(this.icon.zOffsetVertexArray,E,C),R>=0&&i(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,C)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=QP(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:h,y:p}of i)this.lineVertexArray.emplaceBack(h,p);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,h,p,m,y,b,E,C,A,P,R,z,B,V){const Q=e.indexArray,ae=e.layoutVertexArray,le=e.globeExtVertexArray,he=e.segments.prepareSegment(4*i.length,ae,Q,this.canOverlap?m.sortKey:void 0),me=this.glyphOffsetArray.length,ve=he.vertexLength,Pe=this.allowVerticalPlacement&&y===Js.vertical?Math.PI/2:0,Ne=m.text&&m.text.sections;for(let Ye=0;Ye<i.length;Ye++){const{tl:Ve,tr:ht,bl:Ct,br:st,texPrimary:wt,texSecondary:ot,pixelOffsetTL:Rt,pixelOffsetBR:Ht,minFontScaleX:Tt,minFontScaleY:hr,glyphOffset:Yt,isSDF:Pt,sectionIndex:dr}=i[Ye],rr=he.vertexLength,ar=Yt[1];if(qv(ae,E.x,E.y,Ve.x,ar+Ve.y,wt.x,wt.y,a,Pt,Rt.x,Rt.y,Tt,hr),qv(ae,E.x,E.y,ht.x,ar+ht.y,wt.x+wt.w,wt.y,a,Pt,Ht.x,Rt.y,Tt,hr),qv(ae,E.x,E.y,Ct.x,ar+Ct.y,wt.x,wt.y+wt.h,a,Pt,Rt.x,Ht.y,Tt,hr),qv(ae,E.x,E.y,st.x,ar+st.y,wt.x+wt.w,wt.y+wt.h,a,Pt,Ht.x,Ht.y,Tt,hr),b){const{x:Mt,y:yr,z:Zr}=b.anchor,[Mr,jr,nn]=b.up;Hv(le,Mt,yr,Zr,Mr,jr,nn),Hv(le,Mt,yr,Zr,Mr,jr,nn),Hv(le,Mt,yr,Zr,Mr,jr,nn),Hv(le,Mt,yr,Zr,Mr,jr,nn),Zv(e.dynamicLayoutVertexArray,Mt,yr,Zr,Pe)}else Zv(e.dynamicLayoutVertexArray,E.x,E.y,E.z,Pe);if(V){const Mt=ot||wt;Wv(e.iconTransitioningVertexArray,Mt.x,Mt.y),Wv(e.iconTransitioningVertexArray,Mt.x+Mt.w,Mt.y),Wv(e.iconTransitioningVertexArray,Mt.x,Mt.y+Mt.h),Wv(e.iconTransitioningVertexArray,Mt.x+Mt.w,Mt.y+Mt.h)}Q.emplaceBack(rr,rr+1,rr+2),Q.emplaceBack(rr+1,rr+2,rr+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Yt[0]),Ye!==i.length-1&&dr===i[Ye+1].sectionIndex||e.programConfigurations.populatePaintArrays(ae.length,m,m.index,{},R,z,B,Ne&&Ne[dr])}const je=b?b.anchor:E;e.placedSymbolArray.emplaceBack(je.x,je.y,je.z,E.x,E.y,me,this.glyphOffsetArray.length-me,ve,C,A,E.segment,a?a[0]:0,a?a[1]:0,h[0],h[1],y,0,!1,0,P,0)}_commitLayoutVertex(e,i,a,h,p,m,y){e.emplaceBack(i,a,h,p,m,Math.round(y.x),Math.round(y.y))}_addCollisionDebugVertices(e,i,a,h,p,m,y){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),E=b.vertexLength,C=y.tileAnchorX,A=y.tileAnchorY;for(let R=0;R<4;R++)a.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,i,e.padding,y.zOffset),this._commitLayoutVertex(a.layoutVertexArray,h,p,m,C,A,new se(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,p,m,C,A,new se(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,h,p,m,C,A,new se(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,h,p,m,C,A,new se(e.x1,e.y2)),b.vertexLength+=4;const P=a.indexArray;P.emplaceBack(E,E+1),P.emplaceBack(E+1,E+2),P.emplaceBack(E+2,E+3),P.emplaceBack(E+3,E),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,h,p,m){for(let y=h;y<p;y++){const b=a.get(y),E=this.getSymbolInstanceTextSize(e,m,i,y);this._addCollisionDebugVertices(b,E,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,i,a,h,p,m){for(let y=h;y<p;y++){const b=a.get(y),E=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._addCollisionDebugVertices(b,E,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,i){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Aw(ks,wP.members,zo),this.iconCollisionBox=new Aw(ks,wP.members,zo);const a=of(this.iconSizeData,e),h=of(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._addTextDebugCollisionBoxes(h,e,i,m.textBoxStartIndex,m.textBoxEndIndex,m),this._addTextDebugCollisionBoxes(h,e,i,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._addIconDebugCollisionBoxes(a,e,i,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._addIconDebugCollisionBoxes(a,e,i,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}}getSymbolInstanceTextSize(e,i,a,h){const p=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),m=zv(this.textSizeData,e,p)/po;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,i,a){const h=this.icon.placedSymbolArray.get(a),p=zv(this.iconSizeData,e,h);return this.tilePixelRatio*p}_commitDebugCollisionVertexUpdate(e,i,a,h){e.emplaceBack(i,-a,-a,h),e.emplaceBack(i,a,-a,h),e.emplaceBack(i,a,a,h),e.emplaceBack(i,-a,a,h)}_updateTextDebugCollisionBoxes(e,i,a,h,p,m){for(let y=h;y<p;y++){const b=a.get(y),E=this.getSymbolInstanceTextSize(e,m,i,y);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,E,b.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,i,a,h,p,m){for(let y=h;y<p;y++){const b=a.get(y),E=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,E,b.padding,m.zOffset)}}updateCollisionDebugBuffers(e,i){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const a=of(this.iconSizeData,e),h=of(this.textSizeData,e);for(let p=0;p<this.symbolInstances.length;p++){const m=this.symbolInstances.get(p);this._updateTextDebugCollisionBoxes(h,e,i,m.textBoxStartIndex,m.textBoxEndIndex,m),this._updateTextDebugCollisionBoxes(h,e,i,m.verticalTextBoxStartIndex,m.verticalTextBoxEndIndex,m),this._updateIconDebugCollisionBoxes(a,e,i,m.iconBoxStartIndex,m.iconBoxEndIndex,m),this._updateIconDebugCollisionBoxes(a,e,i,m.verticalIconBoxStartIndex,m.verticalIconBoxEndIndex,m)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,h,p,m,y,b,E){const C={};if(i<a){const{x1:A,y1:P,x2:R,y2:z,padding:B,projectedAnchorX:V,projectedAnchorY:Q,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:he,featureIndex:me}=e.get(i);C.textBox={x1:A,y1:P,x2:R,y2:z,padding:B,projectedAnchorX:V,projectedAnchorY:Q,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:he},C.textFeatureIndex=me}if(h<p){const{x1:A,y1:P,x2:R,y2:z,padding:B,projectedAnchorX:V,projectedAnchorY:Q,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:he,featureIndex:me}=e.get(h);C.verticalTextBox={x1:A,y1:P,x2:R,y2:z,padding:B,projectedAnchorX:V,projectedAnchorY:Q,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:he},C.verticalTextFeatureIndex=me}if(m<y){const{x1:A,y1:P,x2:R,y2:z,padding:B,projectedAnchorX:V,projectedAnchorY:Q,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:he,featureIndex:me}=e.get(m);C.iconBox={x1:A,y1:P,x2:R,y2:z,padding:B,projectedAnchorX:V,projectedAnchorY:Q,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:he},C.iconFeatureIndex=me}if(b<E){const{x1:A,y1:P,x2:R,y2:z,padding:B,projectedAnchorX:V,projectedAnchorY:Q,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:he,featureIndex:me}=e.get(b);C.verticalIconBox={x1:A,y1:P,x2:R,y2:z,padding:B,projectedAnchorX:V,projectedAnchorY:Q,projectedAnchorZ:ae,tileAnchorX:le,tileAnchorY:he},C.verticalIconFeatureIndex=me}return C}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),h=a.vertexStartIndex+4*a.numGlyphs;for(let p=a.vertexStartIndex;p<h;p+=4)e.indexArray.emplaceBack(p,p+1,p+2),e.indexArray.emplaceBack(p+1,p+2,p+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),h=[],p=[],m=[];for(let y=0;y<this.symbolInstances.length;++y){m.push(y);const b=this.symbolInstances.get(y);h.push(0|Math.round(i*b.tileAnchorX+a*b.tileAnchorY)),p.push(b.featureIndex)}return m.sort((y,b)=>h[y]-h[b]||p[b]-p[y]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:p,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:y,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:E}=a;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),p>=0&&p!==h&&this.addIndicesForPlacedSymbol(this.text,p),m>=0&&m!==p&&m!==h&&this.addIndicesForPlacedSymbol(this.text,m),y>=0&&this.addIndicesForPlacedSymbol(this.text,y),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Zt(Xv,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Xv.MAX_GLYPHS=65535,Xv.addDynamicAttributes=Zv;var jm=Xv;const b$=tr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:w$}=b$,E$=tr([{name:"a_packed",components:4,type:"Float32"}]),{members:S$}=E$,T$=kv.types,C$=Math.cos(Math.PI/180*37.5);class Yv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new As,this.layoutVertexArray2=new un,this.indexArray=new vn,this.programConfigurations=new Xc(e.layers,e.zoom),this.segments=new Qn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a,h){this.hasPattern=dw("line",this.layers,i);const p=this.layers[0].layout.get("line-sort-key"),m=[];for(const{feature:C,id:A,index:P,sourceLayerIndex:R}of e){const z=this.layers[0]._featureFilter.needGeometry,B=Jc(C,z);if(!this.layers[0]._featureFilter.filter(new Ae(this.zoom),B,a))continue;const V=p?p.evaluate(B,{},a):void 0,Q={id:A,properties:C.properties,type:C.type,sourceLayerIndex:R,index:P,geometry:z?B.geometry:Sl(C,a,h),patterns:{},sortKey:V};m.push(Q)}p&&m.sort((C,A)=>C.sortKey-A.sortKey);const{lineAtlas:y,featureIndex:b}=i,E=this.addConstantDashes(y);for(const C of m){const{geometry:A,index:P,sourceLayerIndex:R}=C;if(E&&this.addFeatureDashes(C,y),this.hasPattern){const z=fw("line",this.layers,C,this.zoom,i);this.patternFeatures.push(z)}else this.addFeature(C,A,P,a,y.positions,i.availableImages,i.brightness);b.insert(e[P].feature,A,P,R,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const h=a.paint.get("line-dasharray").value,p=a.layout.get("line-cap").value;if(h.kind!=="constant"||p.kind!=="constant")i=!0;else{const m=p.value,y=h.value;if(!y)continue;e.addDash(y,m)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const h of this.layers){const p=h.paint.get("line-dasharray").value,m=h.layout.get("line-cap").value;if(p.kind==="constant"&&m.kind==="constant")continue;let y,b;if(p.kind==="constant"){if(y=p.value,!y)continue}else y=p.evaluate({zoom:a},e);b=m.kind==="constant"?m.value:m.evaluate({zoom:a},e),i.addDash(y,b),e.patterns[h.id]=i.getKey(y,b)}}update(e,i,a,h,p){const m=Object.keys(e).length!==0;m&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,i,m?this.stateDependentLayers:this.layers,a,h,p)}addFeatures(e,i,a,h,p,m){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,i,a,h,m)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,S$)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,w$),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,a,h,p,m,y){const b=this.layers[0].layout,E=b.get("line-join").evaluate(e,{}),C=b.get("line-cap").evaluate(e,{}),A=b.get("line-miter-limit"),P=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const R of i)this.addLine(R,e,E,C,A,P);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,m,h,y)}addLine(e,i,a,h,p,m){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Q=0;Q<e.length-1;Q++)this.totalDistance+=e[Q].dist(e[Q+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const y=T$[i.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let E=0;for(;E<b-1&&e[E].equals(e[E+1]);)E++;if(b<(y?3:2))return;a==="bevel"&&(p=1.05);const C=this.overscaling<=16?15*kt/(512*this.overscaling):0,A=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let P,R,z,B,V;this.e1=this.e2=-1,y&&(P=e[b-2],V=e[E].sub(P)._unit()._perp());for(let Q=E;Q<b;Q++){if(z=Q===b-1?y?e[E+1]:void 0:e[Q+1],z&&e[Q].equals(z))continue;V&&(B=V),P&&(R=P),P=e[Q],V=z?z.sub(P)._unit()._perp():B,B=B||V;let ae=B.add(V);ae.x===0&&ae.y===0||ae._unit();const le=B.x*V.x+B.y*V.y,he=ae.x*V.x+ae.y*V.y,me=he!==0?1/he:1/0,ve=2*Math.sqrt(2-2*he),Pe=he<C$&&R&&z,Ne=B.x*V.y-B.y*V.x>0;if(Pe&&Q>E){const Ve=P.dist(R);if(Ve>2*C){const ht=P.sub(P.sub(R)._mult(C/Ve)._round());this.updateDistance(R,ht),this.addCurrentVertex(ht,B,0,0,A),R=ht}}const je=R&&z;let Ye=je?a:y?"butt":h;if(je&&Ye==="round"&&(me<m?Ye="miter":me<=2&&(Ye="fakeround")),Ye==="miter"&&me>p&&(Ye="bevel"),Ye==="bevel"&&(me>2&&(Ye="flipbevel"),me<p&&(Ye="miter")),R&&this.updateDistance(R,P),Ye==="miter")ae._mult(me),this.addCurrentVertex(P,ae,0,0,A);else if(Ye==="flipbevel"){if(me>100)ae=V.mult(-1);else{const Ve=me*B.add(V).mag()/B.sub(V).mag();ae._perp()._mult(Ve*(Ne?-1:1))}this.addCurrentVertex(P,ae,0,0,A),this.addCurrentVertex(P,ae.mult(-1),0,0,A)}else if(Ye==="bevel"||Ye==="fakeround"){const Ve=-Math.sqrt(me*me-1),ht=Ne?Ve:0,Ct=Ne?0:Ve;if(R&&this.addCurrentVertex(P,B,ht,Ct,A),Ye==="fakeround"){const st=Math.round(180*ve/Math.PI/20);for(let wt=1;wt<st;wt++){let ot=wt/st;if(ot!==.5){const Ht=ot-.5;ot+=ot*Ht*(ot-1)*((1.0904+le*(le*(3.55645-1.43519*le)-3.2452))*Ht*Ht+(.848013+le*(.215638*le-1.06021)))}const Rt=V.sub(B)._mult(ot)._add(B)._unit()._mult(Ne?-1:1);this.addHalfVertex(P,Rt.x,Rt.y,!1,Ne,0,A)}}z&&this.addCurrentVertex(P,V,-ht,-Ct,A)}else if(Ye==="butt")this.addCurrentVertex(P,ae,0,0,A);else if(Ye==="square"){const Ve=R?1:-1;R||this.addCurrentVertex(P,ae,Ve,Ve,A),this.addCurrentVertex(P,ae,0,0,A),R&&this.addCurrentVertex(P,ae,Ve,Ve,A)}else Ye==="round"&&(R&&(this.addCurrentVertex(P,B,0,0,A),this.addCurrentVertex(P,B,1,1,A,!0)),z&&(this.addCurrentVertex(P,V,-1,-1,A,!0),this.addCurrentVertex(P,V,0,0,A)));if(Pe&&Q<b-1){const Ve=P.dist(z);if(Ve>2*C){const ht=P.add(z.sub(P)._mult(C/Ve)._round());this.updateDistance(P,ht),this.addCurrentVertex(ht,V,0,0,A),P=ht}}}}addCurrentVertex(e,i,a,h,p,m=!1){const y=i.y*h-i.x,b=-i.y-i.x*h;this.addHalfVertex(e,i.x+i.y*a,i.y-i.x*a,m,!1,a,p),this.addHalfVertex(e,y,b,m,!0,-h,p)}addHalfVertex({x:e,y:i},a,h,p,m,y,b){this.layoutVertexArray.emplaceBack((e<<1)+(p?1:0),(i<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*h)+128,1+(y===0?0:y<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const E=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),b.primitiveLength++),m?this.e2=E:this.e1=E}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Zt(Yv,"LineBucket",{omit:["layers","patternFeatures"]});class hc{constructor(e,i,a,h){this.context=e,this.format=a,this.texture=e.gl.createTexture(),this.update(i,h)}update(e,i,a){const{width:h,height:p}=e,{context:m}=this,{gl:y}=m;if(y.bindTexture(y.TEXTURE_2D,this.texture),m.pixelStoreUnpackFlipY.set(!1),m.pixelStoreUnpack.set(1),m.pixelStoreUnpackPremultiplyAlpha.set(this.format===y.RGBA&&(!i||i.premultiply!==!1)),a||this.size&&this.size[0]===h&&this.size[1]===p){const{x:b,y:E}=a||{x:0,y:0};if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap)y.texSubImage2D(y.TEXTURE_2D,0,b,E,y.RGBA,y.UNSIGNED_BYTE,e);else{let C=this.format,A=y.UNSIGNED_BYTE;this.format===y.R32F&&(C=y.RED,A=y.FLOAT),y.texSubImage2D(y.TEXTURE_2D,0,b,E,h,p,C,A,e.data)}}else if(this.size=[h,p],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap){let b=this.format;this.format===y.R8&&(b=y.RED),y.texImage2D(y.TEXTURE_2D,0,this.format,b,y.UNSIGNED_BYTE,e)}else{let b=this.format,E=this.format,C=y.UNSIGNED_BYTE;this.format===y.DEPTH_COMPONENT&&(b=y.DEPTH_COMPONENT16,C=y.UNSIGNED_SHORT),this.format===y.R8&&(E=y.RED),this.format===y.R32F&&(C=y.FLOAT,E=y.RED),y.texImage2D(y.TEXTURE_2D,0,b,h,p,0,E,C,e.data)}this.useMipmap=!!(i&&i.useMipmap),this.useMipmap&&y.generateMipmap(y.TEXTURE_2D)}bind(e,i,a=!1){const{context:h}=this,{gl:p}=h;p.bindTexture(p.TEXTURE_2D,this.texture),e!==this.minFilter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,e),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===p.NEAREST?p.NEAREST_MIPMAP_NEAREST:p.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,i),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,a,h){const{context:p}=this,{gl:m}=p;m.bindTexture(m.TEXTURE_2D,this.texture),i!==this.magFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,this.useMipmap?e===m.NEAREST?m.NEAREST_MIPMAP_NEAREST:m.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,a),this.wrapS=a),h!==this.wrapT&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,h),this.wrapT=h)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Qv{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:a}=this,{gl:h}=a;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}const xa=32,Tl=33,ou=new Uint16Array(8184);for(let r=0;r<2046;r++){let e=r+2,i=0,a=0,h=0,p=0,m=0,y=0;for(1&e?h=p=m=xa:i=a=y=xa;(e>>=1)>1;){const E=i+h>>1,C=a+p>>1;1&e?(h=i,p=a,i=m,a=y):(i=h,a=p,h=m,p=y),m=E,y=C}const b=4*r;ou[b+0]=i,ou[b+1]=a,ou[b+2]=h,ou[b+3]=p}const Cl=new Uint16Array(2178),su=new Uint8Array(1089),Kv=new Uint16Array(1089);function JP(r){return r===0?-.03125:r===32?.03125:0}var Jv=tr([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const eO={type:2,extent:kt,loadGeometry:()=>[[new se(0,0),new se(kt+1,0),new se(kt+1,kt+1),new se(0,kt+1),new se(0,0)]]};class kw{constructor(e,i,a,h,p){this.tileID=e,this.uid=At(),this.uses=0,this.tileSize=i,this.tileZoom=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=p,h&&h.style&&(this._lastUpdatedBrightness=h.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const i=e+this.timeAdded;i<ji.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=nu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,i,a){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,p){const m={};if(!p)return m;for(const y of h){const b=y.layerIds.map(E=>p.getLayer(E)).filter(Boolean);if(b.length!==0){y.layers=b,y.stateDependentLayerIds&&(y.stateDependentLayers=y.stateDependentLayerIds.map(E=>b.filter(C=>C.id===E)[0]));for(const E of b)m[E.fqid]=y}}return m}(e.buckets,i.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const p=this.buckets[h];if(p instanceof jm){if(this.hasSymbolBuckets=!0,!a)break;p.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const p=this.buckets[h];if(p instanceof jm&&p.hasRTLText){this.hasRTLText=!0,Oe.isLoading()||Oe.isLoaded()||fe()!=="deferred"||Ce();break}}this.queryPadding=0;for(const h in this.buckets){const p=this.buckets[h],m=i.style.getOwnLayer(h);if(!m)continue;const y=m.queryRadius(p);this.queryPadding=Math.max(this.queryPadding,y)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new xb}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(const h in this.buckets){const p=this.buckets[h];p.uploadPending()&&p.upload(e)}const i=e.gl,a=this.imageAtlas;if(a&&!a.uploaded){const h=!!Object.keys(a.patternPositions).length;this.imageAtlasTexture=new hc(e,a.image,i.RGBA,{useMipmap:h}),this.imageAtlas.uploaded=!0}this.glyphAtlasImage&&(this.glyphAtlasTexture=new hc(e,this.glyphAtlasImage,i.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new hc(e,this.lineAtlas.image,i.R8),this.lineAtlas.uploaded=!0)}prepare(e,i,a){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,a),!i||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const h=i.style.getBrightness();(this._lastUpdatedBrightness||h)&&(this._lastUpdatedBrightness&&h&&Math.abs(this._lastUpdatedBrightness-h)<.001||(this._lastUpdatedBrightness=h,this.updateBuckets(void 0,i)))}queryRenderedFeatures(e,i,a,h,p,m,y,b){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:y,transform:m,params:p,tileTransform:this.tileTransform},e,i,a):{}}querySourceFeatures(e,i){const a=this.latestFeatureIndex;if(!a||!a.rawTileData)return;const h=a.loadVTLayers(),p=i?i.sourceLayer:"",m=h._geojsonTileLayer||h[p];if(!m)return;const y=Ud(i&&i.filter),{z:b,x:E,y:C}=this.tileID.canonical,A={z:b,x:E,y:C};for(let P=0;P<m.length;P++){const R=m.feature(P);if(y.needGeometry){const V=Jc(R,!0);if(!y.filter(new Ae(this.tileID.overscaledZ),V,this.tileID.canonical))continue}else if(!y.filter(new Ae(this.tileID.overscaledZ),R))continue;const z=a.getId(R,p),B=new fP(R,b,E,C,z);B.tile=A,e.push(B)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(const e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const i=this.expirationTime;if(e.cacheControl){const a=ft(e.cacheControl);a["max-age"]&&(this.expirationTime=Date.now()+1e3*a["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const a=Date.now();let h=!1;if(this.expirationTime>a)h=!1;else if(i)if(this.expirationTime<i)h=!0;else{const p=this.expirationTime-i;p?this.expirationTime=a+Math.max(p,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,i){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&i&&this.updateBuckets(e,i)}updateBuckets(e,i){if(!this.latestFeatureIndex)return;const a=this.latestFeatureIndex.loadVTLayers(),h=i.style.listImages(),p=i.style.getBrightness();for(const m in this.buckets){if(!i.style.hasLayer(m))continue;const y=this.buckets[m],b=y.layers[0].sourceLayer||"_geojsonTileLayer",E=a[b];let C={};if(e&&(C=e[b],!E||!C||Object.keys(C).length===0))continue;if(y.update(C,E,h,this.imageAtlas&&this.imageAtlas.patternPositions||{},p),y instanceof Yv||y instanceof Iv){const P=i.style.getOwnSourceCache(y.layers[0].source);i._terrain&&i._terrain.enabled&&P&&y.programConfigurations.needsUpload&&i._terrain._clearRenderCacheForTile(P.id,this.tileID)}const A=i&&i.style&&i.style.getOwnLayer(m);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<ji.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=ji.now()+e}setTexture(e,i){const a=i.context,h=a.gl;this.texture=this.texture||i.getTileTexture(e.width),this.texture&&this.texture instanceof hc?this.texture.update(e,{useMipmap:!0}):(this.texture=new hc(a,e,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(e,i){const a={};for(const h of i)a[h]=!0;this.dependencies[e]=a}hasDependency(e,i){for(const a of e){const h=this.dependencies[a];if(h){for(const p of i)if(h[p])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,i){if(!i||i.name==="mercator"||this._tileDebugBuffer)return;const a=Sl(eO,this.tileID.canonical,this.tileTransform)[0],h=new Cr,p=new ym;for(let m=0;m<a.length;m++){const{x:y,y:b}=a[m];h.emplaceBack(y,b),p.emplaceBack(m)}p.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(p),this._tileDebugBuffer=e.createVertexBuffer(h,Em.members),this._tileDebugSegments=Qn.simpleSegment(0,0,h.length,p.length)}_makeTileBoundsBuffers(e,i){if(this._tileBoundsBuffer||!i||i.name==="mercator")return;const a=Sl(eO,this.tileID.canonical,this.tileTransform)[0];let h,p;if(this.isRaster){const m=function(y,b){const E=nu(y,b),C=Math.pow(2,y.z);for(let V=0;V<Tl;V++)for(let Q=0;Q<Tl;Q++){const ae=Ps((y.x+(Q+JP(Q))/xa)/C),le=fo((y.y+(V+JP(V))/xa)/C),he=b.project(ae,le),me=V*Tl+Q;Cl[2*me+0]=Math.round((he.x*E.scale-E.x)*kt),Cl[2*me+1]=Math.round((he.y*E.scale-E.y)*kt)}su.fill(0),Kv.fill(0);for(let V=2045;V>=0;V--){const Q=4*V,ae=ou[Q+0],le=ou[Q+1],he=ou[Q+2],me=ou[Q+3],ve=ae+he>>1,Pe=le+me>>1,Ne=ve+Pe-le,je=Pe+ae-ve,Ye=le*Tl+ae,Ve=me*Tl+he,ht=Pe*Tl+ve,Ct=Math.hypot((Cl[2*Ye+0]+Cl[2*Ve+0])/2-Cl[2*ht+0],(Cl[2*Ye+1]+Cl[2*Ve+1])/2-Cl[2*ht+1])>=16;su[ht]=su[ht]||(Ct?1:0),V<1022&&(su[ht]=su[ht]||su[(le+je>>1)*Tl+(ae+Ne>>1)]||su[(me+je>>1)*Tl+(he+Ne>>1)])}const A=new gn,P=new vn;let R=0;function z(V,Q){const ae=Q*Tl+V;return Kv[ae]===0&&(A.emplaceBack(Cl[2*ae+0],Cl[2*ae+1],V*kt/xa,Q*kt/xa),Kv[ae]=++R),Kv[ae]-1}function B(V,Q,ae,le,he,me){const ve=V+ae>>1,Pe=Q+le>>1;if(Math.abs(V-he)+Math.abs(Q-me)>1&&su[Pe*Tl+ve])B(he,me,V,Q,ve,Pe),B(ae,le,he,me,ve,Pe);else{const Ne=z(V,Q),je=z(ae,le),Ye=z(he,me);P.emplaceBack(Ne,je,Ye)}}return B(0,0,xa,xa,xa,0),B(xa,xa,0,0,0,xa),{vertices:A,indices:P}}(this.tileID.canonical,i);h=m.vertices,p=m.indices}else{h=new gn,p=new vn;for(const{x:y,y:b}of a)h.emplaceBack(y,b,0,0);const m=Mv(h.int16,void 0,4);for(let y=0;y<m.length;y+=3)p.emplaceBack(m[y],m[y+1],m[y+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,Jv.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(p),this._tileBoundsSegments=Qn.simpleSegment(0,0,h.length,p.length)}_makeGlobeTileDebugBuffers(e,i){const a=i.projection;if(!a||a.name!=="globe"||i.freezeTileCoverage)return;const h=this.tileID.canonical,p=Mm(Mk(h,i)),m=ac(i.zoom);let y;m>0&&(y=s.m.invert(new Float64Array(16),i.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,h,i,p,y,m),this._makeGlobeTileDebugTextBuffer(e,h,i,p,y,m)}_globePoint(e,i,a,h,p,m,y){let b=Cm(e,i,a);if(m){const E=1<<a.z,C=wl(h.center.lng),A=El(h.center.lat),P=(a.x+.5)/E-C;let R=0;P>.5?R=-1:P<-.5&&(R=1);let z=(e/kt+a.x)/E+R,B=(i/kt+a.y)/E;z=(z-C)*h._pixelsPerMercatorPixel+C,B=(B-A)*h._pixelsPerMercatorPixel+A;const V=[z*h.worldSize,B*h.worldSize,0];s.v.transformMat4(V,V,m),b=sc(b,V,y)}return s.v.transformMat4(b,b,p)}_makeGlobeTileDebugBorderBuffer(e,i,a,h,p,m){const y=new Cr,b=new ym,E=new kn,C=(P,R,z,B,V)=>{const Q=(z-P)/(V-1),ae=(B-R)/(V-1),le=y.length;for(let he=0;he<V;he++){const me=P+he*Q,ve=R+he*ae;y.emplaceBack(me,ve);const Pe=this._globePoint(me,ve,i,a,h,p,m);E.emplaceBack(Pe[0],Pe[1],Pe[2]),b.emplaceBack(le+he)}},A=kt;C(0,0,A,0,16),C(A,0,A,A,16),C(A,A,0,A,16),C(0,A,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(b),this._tileDebugBuffer=e.createVertexBuffer(y,Em.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(E,vk.members),this._tileDebugSegments=Qn.simpleSegment(0,0,y.length,b.length)}_makeGlobeTileDebugTextBuffer(e,i,a,h,p,m){const y=kt/4,b=new Cr,E=new vn,C=new kn,A=25;E.reserve(32),b.reserve(A),C.reserve(A);const P=(R,z)=>A*R+z;for(let R=0;R<A;R++){const z=R*y;for(let B=0;B<A;B++){const V=B*y;b.emplaceBack(V,z);const Q=this._globePoint(V,z,i,a,h,p,m);C.emplaceBack(Q[0],Q[1],Q[2])}}for(let R=0;R<4;R++)for(let z=0;z<4;z++){const B=P(R,z),V=P(R,z+1),Q=P(R+1,z),ae=P(R+1,z+1);E.emplaceBack(B,V,Q),E.emplaceBack(Q,V,ae)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(E),this._tileDebugTextBuffer=e.createVertexBuffer(b,Em.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(C,vk.members),this._tileDebugTextSegments=Qn.simpleSegment(0,0,A,32)}destroy(e=!1){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof hc&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class M${constructor(e,i){this.max=e,this.onRemove=i,this.reset()}reset(){for(const e in this.data)for(const i of this.data[e])i.timeout&&clearTimeout(i.timeout),this.onRemove(i.value);return this.data={},this.order=[],this}add(e,i,a){const h=e.wrapped().key;this.data[h]===void 0&&(this.data[h]=[]);const p={value:i,timeout:void 0};if(a!==void 0&&(p.timeout=setTimeout(()=>{this.remove(e,p)},a)),this.data[h].push(p),this.order.push(h),this.order.length>this.max){const m=this._getAndRemoveByKey(this.order[0]);m&&this.onRemove(m)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const i=this.data[e].shift();return i.timeout&&clearTimeout(i.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),i.value}getByKey(e){const i=this.data[e];return i?i[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,i){if(!this.has(e))return this;const a=e.wrapped().key,h=i===void 0?0:this.data[a].indexOf(i),p=this.data[a][h];return this.data[a].splice(h,1),p.timeout&&clearTimeout(p.timeout),this.data[a].length===0&&delete this.data[a],this.onRemove(p.value),this.order.splice(this.order.indexOf(a),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const i=this._getAndRemoveByKey(this.order[0]);i&&this.onRemove(i)}return this}filter(e){const i=[];for(const a in this.data)for(const h of this.data[a])e(h.value)||i.push(h);for(const a of i)this.remove(a.value.tileID,a)}}class kh{constructor(e,i,a,h){this.id=kh.uniqueIdxCounter,kh.uniqueIdxCounter++,this.context=e;const p=e.gl;this.buffer=p.createBuffer(),this.dynamicDraw=!!a,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||h||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=kh.uniqueIdxCounter,kh.uniqueIdxCounter++;const i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}kh.uniqueIdxCounter=0;class hf{constructor(e,i,a){this.func=e,this.mask=i,this.range=a}}hf.ReadOnly=!1,hf.ReadWrite=!0,hf.disabled=new hf(519,hf.ReadOnly,[0,1]);const Pw=7680;class Ow{constructor(e,i,a,h,p,m){this.test=e,this.ref=i,this.mask=a,this.fail=h,this.depthFail=p,this.pass=m}}Ow.disabled=new Ow({func:519,mask:0},0,0,Pw,Pw,Pw);class ba{constructor(e,i,a,h){this.blendFunction=e,this.blendColor=i,this.mask=a,this.blendEquation=h}}ba.Replace=[1,0,1,0],ba.disabled=new ba(ba.Replace,En.transparent,[!1,!1,!1,!1]),ba.unblended=new ba(ba.Replace,En.transparent,[!0,!0,!0,!0]),ba.alphaBlended=new ba([1,771,1,771],En.transparent,[!0,!0,!0,!0]),ba.multiply=new ba([774,0,774,0],En.transparent,[!0,!0,!0,!0]);const Dw=1029,Rw=2305;class Ha{constructor(e,i,a){this.enable=e,this.mode=i,this.frontFace=a}}Ha.disabled=new Ha(!1,Dw,Rw),Ha.backCCW=new Ha(!0,Dw,Rw),Ha.backCW=new Ha(!0,Dw,2304),Ha.frontCW=new Ha(!0,1028,2304),Ha.frontCCW=new Ha(!0,1028,Rw);class Ph extends Ri{constructor(e,i,a){super(),this.id=e,this._onlySymbols=a,i.on("data",h=>{h.dataType==="source"&&h.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&h.dataType==="source"&&h.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),i.on("error",()=>{this._sourceErrored=!0}),this._source=i,this._tiles={},this._cache=new M$(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=i.minTileCacheSize,this._maxTileCacheSize=i.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new P8,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const i=this._tiles[e];if(i.state!=="errored"&&(i.state!=="loaded"||!i.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,i){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,i)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const i in this._tiles){const a=this._tiles[i];a.upload(e),a.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return wr(this._tiles).map(e=>e.tileID).sort(tO).map(e=>e.key)}getRenderableIds(e,i){const a=[];for(const h in this._tiles)this._isIdRenderable(+h,e,i)&&a.push(this._tiles[h]);return e?a.sort((h,p)=>{const m=h.tileID,y=p.tileID,b=new se(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),E=new se(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-y.overscaledZ||E.y-b.y||E.x-b.x}).map(h=>h.tileID.key):a.map(h=>h.tileID).sort(tO).map(h=>h.key)}hasRenderableParent(e){const i=this.findLoadedParent(e,0);return!!i&&this._isIdRenderable(i.tileID.key)}_isIdRenderable(e,i,a){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(i||!this._tiles[e].holdingForFade())&&(a||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,i){const a=this._tiles[e];a&&(a.state!=="loading"&&(a.state=i),this._loadTile(a,this._tileLoaded.bind(this,a,e,i)))}_tileLoaded(e,i,a,h){if(h)if(e.state="errored",h.status!==404)this._source.fire(new $s(h,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new Po("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const p=this.map.painter.terrain;this.update(this.transform,p.getScaledDemTileSize(),!0),p.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=ji.now(),a==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(i,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Po("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const i=this.getRenderableIds();for(let h=0;h<i.length;h++){const p=i[h];if(e.neighboringTiles&&e.neighboringTiles[p]){const m=this.getTileByID(p);a(e,m),a(m,e)}}function a(h,p){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let m=p.tileID.canonical.x-h.tileID.canonical.x;const y=p.tileID.canonical.y-h.tileID.canonical.y,b=Math.pow(2,h.tileID.canonical.z),E=p.tileID.key;m===0&&y===0||Math.abs(y)>1||(Math.abs(m)>1&&(Math.abs(m+b)===1?m+=b:Math.abs(m-b)===1&&(m-=b)),p.dem&&h.dem&&(h.dem.backfillBorder(p.dem,m,y),h.neighboringTiles&&h.neighboringTiles[E]&&(h.neighboringTiles[E].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,i,a,h){for(const p in this._tiles){let m=this._tiles[p];if(h[p]||!m.hasData()||m.tileID.overscaledZ<=i||m.tileID.overscaledZ>a)continue;let y=m.tileID;for(;m&&m.tileID.overscaledZ>i+1;){const E=m.tileID.scaledTo(m.tileID.overscaledZ-1);m=this._tiles[E.key],m&&m.hasData()&&(y=E)}let b=y;for(;b.overscaledZ>i;)if(b=b.scaledTo(b.overscaledZ-1),e[b.key]){h[y.key]=y;break}}}findLoadedParent(e,i){if(e.key in this._loadedParentTiles){const a=this._loadedParentTiles[e.key];return a&&a.tileID.overscaledZ>=i?a:null}for(let a=e.overscaledZ-1;a>=i;a--){const h=e.scaledTo(a),p=this._getLoadedTile(h);if(p)return p}}_getLoadedTile(e){const i=this._tiles[e.key];return i&&i.hasData()?i:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,i){i=i||this._source.tileSize;const a=Math.ceil(e.width/i)+1,h=Math.ceil(e.height/i)+1,p=Math.floor(a*h*5),m=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,p):p,y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(e){const i=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,i){const a={};for(const h in this._tiles){const p=this._tiles[h];p.tileID=p.tileID.unwrapTo(p.tileID.wrap+i),a[p.tileID.key]=p}this._tiles=a;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,i,a,h){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!a)return;let p;if(this.updateCacheSize(e,i),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new so(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(p=e.coveringTiles({tileSize:i||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!a,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(p=p.filter(b=>this._source.hasTile(b)))):p=[],p.length>0&&this.castsShadows&&h&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Lw(this._source.type)){const b=e.coveringZoomLevel({tileSize:i||this._source.tileSize,roundZoom:this._source.roundZoom&&!a}),E=Math.min(b,this._source.maxzoom),C=e.extendTileCoverForShadows(p,h,E);for(const A of C)this._shadowCasterTiles[A.key]=!0,p.push(A)}const m=this._updateRetainedTiles(p);if(Lw(this._source.type)&&p.length!==0){const b={},E={},C=Object.keys(m);for(const P of C){const R=m[P],z=this._tiles[P];if(!z||z.fadeEndTime&&z.fadeEndTime<=ji.now())continue;const B=this.findLoadedParent(R,Math.max(R.overscaledZ-Ph.maxOverzooming,this._source.minzoom));B&&(this._addTile(B.tileID),b[B.tileID.key]=B.tileID),E[P]=R}const A=p[p.length-1].overscaledZ;for(const P in this._tiles){const R=this._tiles[P];if(m[P]||!R.hasData())continue;let z=R.tileID;for(;z.overscaledZ>A;){z=z.scaledTo(z.overscaledZ-1);const B=this._tiles[z.key];if(B&&B.hasData()&&E[z.key]){m[P]=R.tileID;break}}}for(const P in b)m[P]||(this._coveredTiles[P]=!0,m[P]=b[P])}for(const b in m)this._tiles[b].clearFadeHold();const y=function(b,E){const C=[];for(const A in b)A in E||C.push(A);return C}(this._tiles,m);for(const b of y){const E=this._tiles[b];E.hasSymbolBuckets&&!E.holdingForFade()?E.setHoldDuration(this.map._fadeDuration):E.hasSymbolBuckets&&!E.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const i={};if(e.length===0)return i;const a={},h=e.reduce((E,C)=>Math.min(E,C.overscaledZ),1/0),p=e[0].overscaledZ,m=Math.max(p-Ph.maxOverzooming,this._source.minzoom),y=Math.max(p+Ph.maxUnderzooming,this._source.minzoom),b={};for(const E of e){const C=this._addTile(E);i[E.key]=E,C.hasData()||h<this._source.maxzoom&&(b[E.key]=E)}this._retainLoadedChildren(b,h,y,i);for(const E of e){let C=this._tiles[E.key];if(C.hasData())continue;if(E.canonical.z>=this._source.maxzoom){const P=E.children(this._source.maxzoom)[0],R=this.getTile(P);if(R&&R.hasData()){i[P.key]=P;continue}}else{const P=E.children(this._source.maxzoom);if(i[P[0].key]&&i[P[1].key]&&i[P[2].key]&&i[P[3].key])continue}let A=C.wasRequested();for(let P=E.overscaledZ-1;P>=m;--P){const R=E.scaledTo(P);if(a[R.key]||(a[R.key]=!0,C=this.getTile(R),!C&&A&&(C=this._addTile(R)),C&&(i[R.key]=R,A=C.wasRequested(),C.hasData())))break}}return i}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const i=[];let a,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){a=this._loadedParentTiles[h.key];break}i.push(h.key);const p=h.scaledTo(h.overscaledZ-1);if(a=this._getLoadedTile(p),a)break;h=p}for(const p of i)this._loadedParentTiles[p]=a}}_addTile(e){let i=this._tiles[e.key];if(i)return i.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),i;i=this._cache.getAndRemove(e),i&&(this._setTileReloadTimer(e.key,i),i.tileID=e,this._state.initializeTileState(i,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,i)));const a=!!i;if(!a){const h=this.map?this.map.painter:null;i=new kw(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(i,this._tileLoaded.bind(this,i,e.key,i.state))}return i?(i.uses++,this._tiles[e.key]=i,a||this._source.fire(new Po("dataloading",{tile:i,coord:i.tileID,dataType:"source"})),i):null}_setTileReloadTimer(e,i){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const a=i.getExpiryTimeout();a&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},a))}_removeTile(e){const i=this._tiles[e];i&&(i.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),i.uses>0||(i.hasData()&&i.state!=="reloading"?this._cache.add(i.tileID,i,i.getExpiryTimeout()):(i.aborted=!0,this._abortTile(i),this._unloadTile(i))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,i,a){const h=[],p=this.transform;if(!p)return h;const m=p.projection.name==="globe",y=wl(p.center.lng);for(const b in this._tiles){const E=this._tiles[b];if(a&&E.clearQueryDebugViz(),E.holdingForFade())continue;let C;if(m){const A=E.tileID.canonical;if(A.z===0){const P=[Math.abs(rt(y,...$m(A,-1))-y),Math.abs(rt(y,...$m(A,1))-y)];C=[0,2*P.indexOf(Math.min(...P))-1]}else{const P=[Math.abs(rt(y,...$m(A,-1))-y),Math.abs(rt(y,...$m(A,0))-y),Math.abs(rt(y,...$m(A,1))-y)];C=[P.indexOf(Math.min(...P))-1]}}else C=[0];for(const A of C){const P=e.containsTile(E,p,i,A);P&&h.push(P)}}return h}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,i){const a=this.getRenderableIds(e,i).map(p=>this._tiles[p].tileID),h=this.transform.projection.name==="globe";for(const p of a)p.projMatrix=this.transform.calculateProjMatrix(p.toUnwrapped()),p.expandedProjMatrix=h?this.transform.calculateProjMatrix(p.toUnwrapped(),!1,!0):p.projMatrix;return a}sortCoordinatesByDistance(e){const i=e.slice(),a=this.transform._camera.position,h=this.transform._camera.forward(),p={};for(const m of i){const y=1/(1<<m.canonical.z);p[m.key]=((m.canonical.x+.5)*y+m.wrap-a[0])*h[0]+((m.canonical.y+.5)*y-a[1])*h[1]-a[2]*h[2]}return i.sort((m,y)=>p[m.key]-p[y.key]),i}hasTransition(){if(this._source.hasTransition())return!0;if(Lw(this._source.type))for(const e in this._tiles){const i=this._tiles[e];if(i.fadeEndTime!==void 0&&i.fadeEndTime>=ji.now())return!0}return!1}setFeatureState(e,i,a){this._state.updateState(e=e||"_geojsonTileLayer",i,a)}removeFeatureState(e,i,a){this._state.removeFeatureState(e=e||"_geojsonTileLayer",i,a)}getFeatureState(e,i){return this._state.getState(e=e||"_geojsonTileLayer",i)}setDependencies(e,i,a){const h=this._tiles[e];h&&h.setDependencies(i,a)}reloadTilesForDependencies(e,i){for(const a in this._tiles)this._tiles[a].hasDependency(e,i)&&this._reloadTile(+a,"reloading");this._cache.filter(a=>!a.hasDependency(e,i))}_preloadTiles(e,i){if(!this._sourceLoaded){const y=()=>{this._sourceLoaded&&(this._source.off("data",y),this._preloadTiles(e,i))};return void this._source.on("data",y)}const a=new Map,h=Array.isArray(e)?e:[e],p=this.map.painter.terrain,m=this.usedForTerrain&&p?p.getScaledDemTileSize():this._source.tileSize;for(const y of h){const b=y.coveringTiles({tileSize:m,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const E of b)a.set(E.key,E);this.usedForTerrain&&y.updateElevation(!1)}Jt(Array.from(a.values()),(y,b)=>{const E=new kw(y,this._source.tileSize*y.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(E,C=>{this._source.type==="raster-dem"&&E.dem&&this._backfillDEM(E),b(C,E)})},i)}}function tO(r,e){const i=Math.abs(2*r.wrap)-+(r.wrap<0),a=Math.abs(2*e.wrap)-+(e.wrap<0);return r.overscaledZ-e.overscaledZ||a-i||e.canonical.y-r.canonical.y||e.canonical.x-r.canonical.x}function Lw(r){return r==="raster"||r==="image"||r==="video"||r==="custom"}function $m(r,e){const i=1<<r.z;return[r.x/i+e,(r.x+1)/i+e]}Ph.maxOverzooming=10,Ph.maxUnderzooming=3;const I$=tr([{name:"a_pos_3f",components:3,type:"Float32"}]),A$=tr([{name:"a_color_3f",components:3,type:"Float32"}]),k$=tr([{name:"a_color_4f",components:4,type:"Float32"}]),P$=tr([{name:"a_uv_2f",components:2,type:"Float32"}]),O$=tr([{name:"a_normal_3f",components:3,type:"Float32"}]),D$=tr([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),R$=tr([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function rO(r,e){const i=e0(r.projection,r.zoom,r.width,r.height),a=function(p,m,y,b,E){const C=new hn(y.lng-180*au,y.lat),A=new hn(y.lng+180*au,y.lat),P=p.project(C.lng,C.lat),R=p.project(A.lng,A.lat),z=-Math.atan2(R.y-P.y,R.x-P.x),B=Eo.fromLngLat(y);B.y=rt(B.y,-1+au,1-au);const V=B.toLngLat(),Q=p.project(V.lng,V.lat),ae=Eo.fromLngLat(V);ae.x+=au;const le=ae.toLngLat(),he=p.project(le.lng,le.lat),me=oO(he.x-Q.x,he.y-Q.y,z),ve=Eo.fromLngLat(V);ve.y+=au;const Pe=ve.toLngLat(),Ne=p.project(Pe.lng,Pe.lat),je=oO(Ne.x-Q.x,Ne.y-Q.y,z),Ye=Math.abs(me.x)/Math.abs(je.y),Ve=s.m.identity([]);s.m.rotateZ(Ve,Ve,-z*(1-(E?0:b)));const ht=s.m.identity([]);return s.m.scale(ht,ht,[1,1-(1-Ye)*b,1]),ht[4]=-je.x/je.y*b,s.m.rotateZ(ht,ht,z),s.m.multiply(ht,Ve,ht),ht}(r.projection,0,r.center,i,e),h=nO(r);return s.m.scale(a,a,[h,h,1]),a}function nO(r){const e=r.projection,i=e0(r.projection,r.zoom,r.width,r.height),a=iO(e,r.center),h=iO(e,hn.convert(e.center));return Math.pow(2,a*i+(1-i)*h)}function e0(r,e,i,a,h=1/0){const p=r.range;if(!p)return 0;const m=Math.min(h,Math.max(i,a)),y=Math.log(m/1024)/Math.LN2;return Gt(p[0]+y,p[1]+y,e)}const au=1/4e4;function iO(r,e){const i=rt(e.lat,-_i,_i),a=new hn(e.lng-180*au,i),h=new hn(e.lng+180*au,i),p=r.project(a.lng,i),m=r.project(h.lng,i),y=Eo.fromLngLat(a),b=Eo.fromLngLat(h),E=m.x-p.x,C=m.y-p.y,A=b.x-y.x,P=b.y-y.y,R=Math.sqrt((A*A+P*P)/(E*E+C*C));return Math.log(R)/Math.LN2}function oO(r,e,i){const a=Math.cos(i),h=Math.sin(i);return{x:r*a-e*h,y:r*h+e*a}}function sO(r,e,i){return e*(kt/(r.tileSize*Math.pow(2,i-r.tileID.overscaledZ)))}function aO(r,e,i){s.m.identity(r),s.m.rotateZ(r,r,ze(e[2])),s.m.rotateX(r,r,ze(e[0])),s.m.rotateY(r,r,ze(e[1])),s.m.scale(r,r,i),s.m.multiply(r,r,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function t0(r,e,i,a,h,p,m,y){const b=[i[0]-e[0],i[1]-e[1],0],E=[a[0]-e[0],a[1]-e[1],0];if(s.v.length(b)<1e-12||s.v.length(E)<1e-12)return s.q.identity(r);const C=s.v.cross([],b,E);s.v.normalize(C,C),s.v.subtract(E,a,e),b[2]=(p-h)*y,E[2]=(m-h)*y;const A=b;return s.v.cross(A,b,E),s.v.normalize(A,A),s.q.rotationTo(r,C,A)}function lO(r,e,i=!1){const a=ac(e.zoom),h=function(p,m,y){const b=m.worldSize,E=[p[12],p[13],p[14]],C=fo(E[1]/b),A=Ps(E[0]/b),P=s.m.identity([]),R=Qo(1,C)*b,z=Qo(1,0)*b*Mh(C,m.zoom),B=1/Xb(b);let V=z*B;if(y){const he=e0(m.projection,m.zoom,m.width,m.height,1024);V=B*m.projection.pixelSpaceConversion(m.center.lat,b,he)}const Q=Ch(C,A);s.v.add(Q,Q,s.v.scale([],s.v.normalize([],Q),R*V*E[2]));const ae=function(he){const me=[he[0],he[1],he[2]];let ve=[0,1,0];const Pe=s.v.cross([],ve,me);return s.v.cross(ve,me,Pe),s.v.squaredLength(ve)===0&&(ve=[0,1,0],s.v.cross(Pe,me,ve)),s.v.normalize(Pe,Pe),s.v.normalize(ve,ve),s.v.normalize(me,me),[Pe[0],Pe[1],Pe[2],0,ve[0],ve[1],ve[2],0,me[0],me[1],me[2],0,he[0],he[1],he[2],1]}(Q);s.m.scale(P,P,[V,V,V*R]),s.m.translate(P,P,[-E[0],-E[1],-E[2]]);const le=s.m.multiply([],m.globeMatrix,ae);return s.m.multiply(le,le,P),s.m.multiply(le,le,p),le}(r,e,i);if(a>0){const p=function(m,y){const b=y.worldSize,E=Qo(1,0)*b*Mh(y.center.lat,y.zoom)/Xb(b),C=Qo(1,y.center.lat)*b,A=s.m.identity([]);return s.m.rotateY(A,A,ze(y.center.lng)),s.m.rotateX(A,A,ze(y.center.lat)),s.m.translate(A,A,[0,0,Qs]),s.m.scale(A,A,[E,E,E*C]),s.m.translate(A,A,[y.point.x-.5*b,y.point.y-.5*b,0]),s.m.multiply(A,A,m),s.m.multiply(A,y.globeMatrix,A)}(r,e);return function(m,y,b){const E=(z,B,V)=>{const Q=s.v.length(z),ae=s.v.length(B),le=sc(z,B,V);return s.v.scale(le,le,1/s.v.length(le)*Fr(Q,ae,V))},C=E([m[0],m[1],m[2]],[y[0],y[1],y[2]],b),A=E([m[4],m[5],m[6]],[y[4],y[5],y[6]],b),P=E([m[8],m[9],m[10]],[y[8],y[9],y[10]],b),R=sc([m[12],m[13],m[14]],[y[12],y[13],y[14]],b);return[C[0],C[1],C[2],0,A[0],A[1],A[2],0,P[0],P[1],P[2],0,R[0],R[1],R[2],1]}(h,p,a)}return h}const Oh=64,r0={CoordinateSpaceTile:1,CoordinateSpaceYUp:2,HasMapboxMeshFeatures:4};function Um(r,e,i=!1){r.uploaded||(r.gfxTexture=new hc(e,r.image,i?e.gl.R8:e.gl.RGBA,{useMipmap:r.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),r.uploaded=!0,r.image=null)}function L$(r,e,i){r.indexBuffer=e.createIndexBuffer(r.indexArray,!1,!0),r.vertexBuffer=e.createVertexBuffer(r.vertexArray,I$.members,!1,!0),r.normalArray&&(r.normalBuffer=e.createVertexBuffer(r.normalArray,O$.members,!1,!0)),r.texcoordArray&&(r.texcoordBuffer=e.createVertexBuffer(r.texcoordArray,P$.members,!1,!0)),r.colorArray&&(r.colorBuffer=e.createVertexBuffer(r.colorArray,(r.colorArray.bytesPerElement===12?A$:k$).members,!1,!0)),r.featureArray&&(r.pbrBuffer=e.createVertexBuffer(r.featureArray,R$.members,!0)),r.segments=Qn.simpleSegment(0,0,r.vertexArray.length,r.indexArray.length);const a=r.material;a.pbrMetallicRoughness.baseColorTexture&&Um(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&Um(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&Um(a.normalTexture,e),a.occlusionTexture&&Um(a.occlusionTexture,e,i),a.emissionTexture&&Um(a.emissionTexture,e)}function zw(r,e,i){if(r.meshes)for(const a of r.meshes)L$(a,e,i);if(r.children)for(const a of r.children)zw(a,e,i)}function n0(r){if(r.meshes)for(const e of r.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(r.children)for(const e of r.children)n0(e)}function i0(r){if(r.meshes)for(const i of r.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((e=i.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(r.children)for(const i of r.children)i0(i)}class cO{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class uO{constructor(){this.instancedDataArray=new yb,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class hO{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,i,a,h){this.tileToMeter=yv(a);const p=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:m,id:y,index:b,sourceLayerIndex:E}of e){const C=Jc(m,p);if(!this.layers[0]._featureFilter.filter(new Ae(this.zoom),C,a))continue;const A={id:y,sourceLayerIndex:E,index:b,geometry:p?C.geometry:Sl(m,a,h),properties:m.properties,type:m.type,patterns:{}},P=this.addFeature(A,A.geometry,C);P&&i.featureIndex.insert(m,A.geometry,b,E,this.index,this.instancesPerModel[P].instancedDataArray.length)}this.lookup=null}update(e,i,a,h){for(const p in this.instancesPerModel){const m=this.instancesPerModel[p];for(const y in e)m.idToFeaturesIndex.hasOwnProperty(y)&&this.evaluate(m.features[m.idToFeaturesIndex[y]],e[y],m,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];for(const h of a.features){const p=this.layers[0],m=h.feature,y=this.canonical,b=p.paint.get("model-rotation").evaluate(m,{},y),E=p.paint.get("model-scale").evaluate(m,{},y),C=p.paint.get("model-translation").evaluate(m,{},y);s.v.exactEquals(h.rotation,b)&&s.v.exactEquals(h.scale,E)&&s.v.exactEquals(h.translation,C)||(this.evaluate(h,h.featureStates,a,!0),e=!0)}}return e}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,D$.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const e in this.instancesPerModel){const i=this.instancesPerModel[e];i.instancedDataArray.length!==0&&i.instancedDataBuffer&&i.instancedDataBuffer.destroy()}}addFeature(e,i,a){const h=this.layers[0],p=h.layout.get("model-id").evaluate(a,{},this.canonical);if(!p)return mr(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),p;this.instancesPerModel[p]||(this.instancesPerModel[p]=new uO);const m=this.instancesPerModel[p],y=m.instancedDataArray,b=new cO(a,y.length);for(const E of i)for(const C of E){if(C.x<0||C.x>=kt||C.y<0||C.y>=kt)continue;const A=(this.lookupDim-1)/kt,P=this.lookupDim*(C.y*A|0)+C.x*A|0;if(this.lookup){if(this.lookup[P]!==0)continue;this.lookup[P]=1}this.instanceCount++;const R=y.length;y.resize(R+1),m.instancesEvaluatedElevation.push(0),y.float32[16*R]=C.x,y.float32[16*R+1]=C.y}return b.instancedDataCount=m.instancedDataArray.length-b.instancedDataOffset,b.instancedDataCount>0&&(e.id&&(m.idToFeaturesIndex[e.id]=m.features.length),m.features.push(b),this.evaluate(b,{},m,!1)),p}evaluate(e,i,a,h){const p=this.layers[0],m=e.feature,y=this.canonical,b=e.rotation=p.paint.get("model-rotation").evaluate(m,i,y),E=e.scale=p.paint.get("model-scale").evaluate(m,i,y),C=e.translation=p.paint.get("model-translation").evaluate(m,i,y),A=p.paint.get("model-color").evaluate(m,i,y);A.a=p.paint.get("model-color-mix-intensity").evaluate(m,i,y);const P=[];this.maxVerticalOffset<C[2]&&(this.maxVerticalOffset=C[2]),this.maxScale=Math.max(Math.max(this.maxScale,E[0]),Math.max(E[1],E[2])),aO(P,b,E);const R=Math.round(100*A.a)+A.b/1.05;for(let z=0;z<e.instancedDataCount;++z){const B=e.instancedDataOffset+z,V=16*B,Q=a.instancedDataArray.float32;let ae=0;h&&(ae=Q[V+6]-a.instancesEvaluatedElevation[B]);const le=0|Q[V+1];Q[V]=(0|Q[V])+A.r/1.05,Q[V+1]=le+A.g/1.05,Q[V+2]=R,Q[V+3]=1/(y.z>10?this.tileToMeter:yv(y,le)),Q[V+4]=C[0],Q[V+5]=C[1],Q[V+6]=C[2]+ae,Q[V+7]=P[0],Q[V+8]=P[1],Q[V+9]=P[2],Q[V+10]=P[4],Q[V+11]=P[5],Q[V+12]=P[6],Q[V+13]=P[8],Q[V+14]=P[9],Q[V+15]=P[10],a.instancesEvaluatedElevation[B]=C[2]}}}Zt(hO,"ModelBucket",{omit:["layers"]}),Zt(uO,"PerModelAttributes"),Zt(cO,"ModelFeature");const z$=new pt({visibility:new ye(Ge.layout_model.visibility),"model-id":new $e(Ge.layout_model["model-id"])});var N$={paint:new pt({"model-opacity":new ye(Ge.paint_model["model-opacity"]),"model-rotation":new $e(Ge.paint_model["model-rotation"]),"model-scale":new $e(Ge.paint_model["model-scale"]),"model-translation":new $e(Ge.paint_model["model-translation"]),"model-color":new $e(Ge.paint_model["model-color"]),"model-color-mix-intensity":new $e(Ge.paint_model["model-color-mix-intensity"]),"model-type":new ye(Ge.paint_model["model-type"]),"model-cast-shadows":new ye(Ge.paint_model["model-cast-shadows"]),"model-receive-shadows":new ye(Ge.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ye(Ge.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new $e(Ge.paint_model["model-emissive-strength"]),"model-roughness":new $e(Ge.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new $e(Ge.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ye(Ge.paint_model["model-cutoff-fade-range"])}),layout:z$};const Nw=new Float32Array(262144),Dh=new Uint8Array(262144);function dO(r){let e=0;if(r.meshes)for(const i of r.meshes)e=Math.max(e,i.aabb.max[2]);if(r.children)for(const i of r.children)e=Math.max(e,dO(i));return e}const fO=["","wall","door","roof","window","lamp","logo"];class pO{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:dO(e)}}}}class mO{constructor(e,i,a,h){this.nodes=e,this.id=i,this.modelTraits|=r0.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,a&&(this.modelTraits|=r0.HasMapboxMeshFeatures),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=h,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const a of i){const h=a.node;this.uploaded?this.updatePbrBuffer(h):zw(h,e,!0)}for(const a of i)n0(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),i=!0);return i}needsReEvaluation(e,i,a){const h=e.transform.projectionOptions,p=e.style.getBrightness(),m=this.brightness!==p;return!!(!this.uploaded||this.dirty||h.name!==this.projection.name||Vm(a.paint.get("model-color").value,m)||Vm(a.paint.get("model-color-mix-intensity").value,m)||Vm(a.paint.get("model-roughness").value,m)||Vm(a.paint.get("model-emissive-strength").value,m)||Vm(a.paint.get("model-height-based-emissive-strength-multiplier").value,m))&&(this.projection=h,this.brightness=p,!0)}evaluateScale(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),h=this.id.canonical;for(const p of a){const m=p.feature;p.evaluatedScale=i.paint.get("model-scale").evaluate(m,{},h)}}evaluate(e){const i=this.getNodesInfo();for(const a of i){if(!a.node.meshes)continue;const h=a.feature,p=a.node.meshes&&a.node.meshes[0].featureData,m=a.evaluatedColor[2],y=a.evaluatedRMEA[2],b=this.id.canonical;if(a.hasTranslucentParts=!1,p){for(let E=0;E<fO.length;E++){const C=fO[E];C.length&&(h.properties.part=C);const A=e.paint.get("model-color").evaluate(h,{},b),P=e.paint.get("model-color-mix-intensity").evaluate(h,{},b);a.evaluatedColor[E]=[A.r,A.g,A.b,P],a.evaluatedRMEA[E][0]=e.paint.get("model-roughness").evaluate(h,{},b),a.evaluatedRMEA[E][2]=e.paint.get("model-emissive-strength").evaluate(h,{},b),a.evaluatedRMEA[E][3]=A.a,a.emissionHeightBasedParams[E]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(h,{},b),!a.hasTranslucentParts&&A.a<1&&(a.hasTranslucentParts=!0)}delete h.properties.part,B$(a,m!==a.evaluatedColor[2]||y!==a.evaluatedRMEA[2])}else a.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(h,{},b);a.evaluatedScale=e.paint.get("model-scale").evaluate(h,{},b),this.updatePbrBuffer(a.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,a,h){const p=e.findDEMTileFor(a);if(p&&(p.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(p.dem&&p.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=p.tileID.overscaledZ;const m=nf.create(e,a,p);if(!m)return;this.modelTraits&r0.HasMapboxMeshFeatures&&this.updateDEM(e,m,a,h);for(const y of this.getNodesInfo()){const b=y.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const E=b.footprint.vertices;let C=m.getElevationAt(E[0].x,E[0].y,!0,!0);for(let A=1;A<E.length;A++)C=Math.min(C,m.getElevationAt(E[A].x,E[A].y,!0,!0));b.elevation=C}}this.terrainTile=p.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,a,h){let p=i._dem._modifiedForSources[h];if(p===void 0&&(i._dem._modifiedForSources[h]=[],p=i._dem._modifiedForSources[h]),p.includes(a.canonical))return;const m=i._dem.dim;p.push(a.canonical);let y=!1;for(const b of this.getNodesInfo()){const E=b.node;if(!E.footprint||!E.footprint.grid)continue;const C=E.footprint.grid,A=i.tileCoordToPixel(C.min.x,C.min.y),P=i.tileCoordToPixel(C.max.x,C.max.y),R=Math.min(Math.min(m-P.y,A.x),Math.min(A.y,m-P.x));if(R<0)continue;const z=rt(R,2,5);let B=Math.max(0,A.x-z),V=Math.max(0,A.y-z),Q=Math.min(P.x+z,m-1),ae=Math.min(P.y+z,m-1);for(let ve=V;ve<=ae;++ve)for(let Pe=B;Pe<=Q;++Pe)Dh[ve*m+Pe]=255;let le=0,he=0;for(let ve=0;ve<C.cellsY;++ve)for(let Pe=0;Pe<C.cellsX;++Pe){if(!C.cells[ve*C.cellsX+Pe])continue;const Ne=i.tileCoordToPixel(C.min.x+Pe/C.xScale,C.min.y+ve/C.yScale),je=i.tileCoordToPixel(C.min.x+(Pe+1)/C.xScale,C.min.y+(ve+1)/C.yScale);for(let Ye=Ne.y;Ye<=Math.min(je.y+1,m-1);++Ye)for(let Ve=Ne.x;Ve<=Math.min(je.x+1,m-1);++Ve)Dh[Ye*m+Ve]===255&&(Dh[Ye*m+Ve]=0,le+=i.getElevationAtPixel(Ve,Ye),he++)}const me=le/he;B=Math.max(1,A.x-z),V=Math.max(1,A.y-z),Q=Math.min(P.x+z,m-2),ae=Math.min(P.y+z,m-2),y=!0;for(let ve=V;ve<=ae;++ve)for(let Pe=B;Pe<=Q;++Pe)Dh[ve*m+Pe]===0&&(Nw[ve*m+Pe]=i._dem.set(Pe,ve,me));for(let ve=1;ve<z;++ve){B=Math.max(1,A.x-ve),V=Math.max(1,A.y-ve),Q=Math.min(P.x+ve,m-2),ae=Math.min(P.y+ve,m-2);for(let Pe=V;Pe<=ae;++Pe)for(let Ne=B;Ne<=Q;++Ne){const je=Pe*m+Ne;if(Dh[je]===255){let Ye=0,Ve=0,ht=-1,Ct=-1;for(let st=-1;st<=1;++st)for(let wt=-1;wt<=1;++wt){const ot=(Pe+st)*m+Ne+wt;if(Dh[ot]>=ve)continue;const Rt=Nw[ot],Ht=Math.abs(Rt);Ht>Ve&&(Ye=Rt,Ve=Ht,ht=wt,Ct=st)}if(Ve>.1){const st=1-(ve+.5*Math.abs(ht*Ct))/z;let wt=i._dem.get(Ne,Pe)+Ye*st;const ot=i._dem.get(Ne+ht,Pe+Ct),Rt=i._dem.get(Ne-ht,Pe-Ct,!0);(wt-ot)*(wt-Rt)>0&&(wt=(ot+Rt)/2),Nw[je]=i._dem.set(Ne,Pe,wt),Dh[je]=ve}}}}}y&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=ji.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(const e of this.nodes)this.nodesInfo.push(new pO(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(const e of this.nodes)i0(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();const e=this.getNodesInfo();for(const i of e)n0(i.node),i0(i.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped()),h=this.getNodesInfo();for(let p=0;p<this.nodesInfo.length;p++){const m=h[p].node;h[p].hiddenByReplacement=!!m.footprint&&!a.find(y=>y.footprint===m.footprint)}}getHeightAtTileCoord(e,i){const a=this.getNodesInfo(),h=[];for(let p=0;p<this.nodesInfo.length;p++){const m=a[p],y=m.node.meshes[0];if(e<y.aabb.min[0]||i<y.aabb.min[1]||e>y.aabb.max[0]||i>y.aabb.max[1])continue;const b=(e-y.aabb.min[0])/(y.aabb.max[0]-y.aabb.min[0])*Oh|0,E=Math.min(63,(i-y.aabb.min[1])/(y.aabb.max[1]-y.aabb.min[1])*Oh|0)*Oh+Math.min(63,b);if(!(y.heightmap[E]<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:y.heightmap[E],maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new se(e,i),new se(e,i),h),h.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function Vm(r,e){return!r.isLightConstant&&e}function F$(r,e,i,a,h,p,m,y){let b=(61440&e|(61440&e)>>4)>>8,E=(3840&e|(3840&e)>>4)>>4,C=240&e|(240&e)>>4;i[3]>0&&(b=Fr(b,255*i[0],i[3]),E=Fr(E,255*i[1],i[3]),C=Fr(C,255*i[2],i[3]));const A=b<<8|E,P=C<<8|Math.floor(255*a[3]),R=function(ve){const Pe=rt(ve,0,2);return Math.min(Math.round(.5*Pe*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],z=rt(h[0],0,1),B=rt(h[1],0,1),V=rt(h[2],0,1),Q=rt(h[3],0,1);let ae,le,he,me;if(z!==B&&m!==p&&B!==z){const ve=m-p;le=1/(ve*(B-z)),he=-(p+ve*z)/(ve*(B-z));const Pe=rt(h[4],-1,1);me=Math.pow(10,Pe),ae=255*V<<8|255*Q}else ae=65535,le=0,he=1,me=1;if(r.emplaceBack(A,P,R,ae,le,he,me),y){const ve=y.length;y.clear();for(let Pe=0;Pe<ve;Pe++)y.emplaceBack(A,P,R,ae,le,he,me)}}function B$(r,e){const i=r.node;let a=0;for(const h of i.meshes){if(i.lights&&i.lightMeshIndex===a||!h.featureData)continue;h.featureArray=new av,h.featureArray.reserve(h.featureData.length);let p=e;for(const m of h.featureData){let y;const b=65535&m,E=(15&b)<8?15&b:0,C=m>>16&65535,A=r.evaluatedRMEA[E],P=r.evaluatedColor[E],R=r.emissionHeightBasedParams[E];if(p&&E===2&&i.lights&&(y=new av,y.resize(10*i.lights.length)),F$(h.featureArray,C,P,A,R,h.aabb.min[2],h.aabb.max[2],y),y&&p){p=!1;const z=i.meshes[i.lightMeshIndex];z.featureArray=y,z.featureArray._trim()}}h.featureArray._trim(),a++}}function o0(r,e){return r.x-e.x||r.y-e.y}function gO(r,e){return o0(r.min,e.min)===0&&o0(r.max,e.max)===0}function _O(r,e){return!(r.min.x>e.max.x||r.max.x<e.min.x||r.min.y>e.max.y||r.max.y<e.min.y)}function yO(r,e,i){const a=1/kt,h=1/(1<<i.canonical.z),p=(e.x*a+i.canonical.x)*h+i.wrap,m=(e.y*a+i.canonical.y)*h;return{min:new se((r.x*a+i.canonical.x)*h+i.wrap,(r.y*a+i.canonical.y)*h),max:new se(p,m)}}function j$(r,e,i){const a=1<<i.canonical.z,h=((e.x-i.wrap)*a-i.canonical.x)*kt,p=(e.y*a-i.canonical.y)*kt;return{min:new se(((r.x-i.wrap)*a-i.canonical.x)*kt,(r.y*a-i.canonical.y)*kt),max:new se(h,p)}}function vO(r,e,i,a,h,p,m){const y=r.indices,b=r.vertices,E=[];for(let C=a;C<a+h;C+=3){const A=e[i[C+0]+p],P=e[i[C+1]+p],R=e[i[C+2]+p],z=Math.min(A.x,P.x,R.x),B=Math.max(A.x,P.x,R.x),V=Math.min(A.y,P.y,R.y),Q=Math.max(A.y,P.y,R.y);E.length=0,r.grid.query(new se(z,V),new se(B,Q),E);for(let ae=0;ae<E.length;ae++){const le=E[ae];if(ow(b[y[3*le+0]],b[y[3*le+1]],b[y[3*le+2]],A,P,R,m))return!0}}return!1}function xO(r,e,i,a){if(!r||!i)return!1;let h=r.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(i.vertices.length<r.vertices.length)return xO(i,a,r,e);const p=e.canonical,m=a.canonical,y=Math.pow(2,m.z-p.z);h=r.vertices.map(b=>new se(b.x*p.x*kt*y-m.x*kt,b.y*p.y*kt*y-m.y*kt))}return vO(i,h,r.indices,0,r.indices.length,0,0)}Zt(mO,"Tiled3dModelBucket",{omit:["layers"]}),Zt(pO,"Tiled3dModelFeature");const $$=kv.types,U$=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],V$=["fill-extrusion-flood-light-ground-radius"],G$=Math.pow(2,13),q$=Math.pow(2,15)-1,bO=new se(0,1),lu=2147483648;function Gm(r,e,i,a,h,p,m,y){r.emplaceBack((e<<1)+m,(i<<1)+p,(Math.floor(a*G$)<<1)+h,Math.round(y))}function s0(r,e,i,a,h,p){r.emplaceBack(e.x,e.y,(i.x<<1)+a,(i.y<<1)+h,p)}function qm(r,e,i){r.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class wO{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class EO{constructor(){this.centroidXY=new se(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new se(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new se(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new se(this.max.x-this.min.x,this.max.y-this.min.y)}}class SO{constructor(){this.acc=new se(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,a){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<e.min.x?(e.min.x=i.x,h=!0):i.x>e.max.x&&(e.max.x=i.x,h=!0),i.y<e.min.y?(e.min.y=i.y,h=!0):i.y>e.max.y&&(e.max.y=i.y,h=!0),((i.x===0||i.x===kt)&&i.x===a.x)!=((i.y===0||i.y===kt)&&i.y===a.y)&&this.processBorderOverlap(i,a),h&&this.checkBorderIntersection(i,a)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,Fr(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>kt!=e.x>kt&&this.addBorderIntersection(1,Fr(i.y,e.y,(kt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,Fr(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>kt!=e.y>kt&&this.addBorderIntersection(3,Fr(i.x,e.x,(kt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new se(0,0):new se(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function TO(r,e){const i=r.add(e)._unit(),a=rt(r.x*i.x+r.y*i.y,-1,1);var h,p,m;return h=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(h)))/4*q$*((p=r).x*(m=e).y-p.y*m.x<0?-1:1)}const W$=[r=>r.x<0,r=>r.x>kt,r=>r.y<0,r=>r.y>kt];function H$(r,e,i,a){const h=[4];if(a===0)return h;i._mult(a);const p=r.sub(i),m=e.sub(i),y=[r,e,p,m];for(let b=0;b<4;b++)for(const E of y)if(W$[b](E)){h.push(b);break}return h}class CO{constructor(e){this.vertexArray=new Lo,this.indexArray=new vn,this.programConfigurations=new Xc(e.layers,e.zoom,i=>V$.includes(i)),this._segments=new Qn,this.hiddenByLandmarkVertexArray=new vb,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new Qn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,a,h=!1){const p=e.length;if(p>2){let m=Math.max(0,this._segments.get().length-1);const y=this._segments._prepareSegment(4*p,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let b;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const E=e[0],C=e[1];b=TO(E.sub(e[p-1])._perp()._unit(),C.sub(E)._perp()._unit())}for(let E=0;E<p;E++){const C=E===p-1?0:E+1,A=e[E],P=e[C],R=e[C===p-1?0:C+1],z=P.sub(A)._perp()._unit(),B=TO(z,R.sub(P)._perp()._unit()),V=b,Q=B;if(Fw(A,P,i)||h&&AO(A,i)&&AO(P,i)){b=B;continue}const ae=y.vertexLength;s0(this.vertexArray,A,P,1,1,V),s0(this.vertexArray,A,P,1,0,V),s0(this.vertexArray,A,P,0,1,Q),s0(this.vertexArray,A,P,0,0,Q),y.vertexLength+=4;const le=H$(A,P,z,a);for(const he of le)this._segmentToGroundQuads[m].push({id:ae,region:he}),this._segmentToRegionTriCounts[m][he]+=2,y.primitiveLength+=2;b=B}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let a=0;a<i;a++)this._segmentToGroundQuads[a].sort((h,p)=>h.region-p.region);for(let a=0;a<i;a++){const h=this._segmentToGroundQuads[a],p=e[a],m=this._segmentToRegionTriCounts[a];m.reduce((b,E)=>b+E,0);let y=0;for(let b=0;b<=4;b++){const E=m[b];if(E!==0){let C=this.regionSegments[b];C||(C=this.regionSegments[b]=new Qn);const A={vertexOffset:p.vertexOffset,primitiveOffset:p.primitiveOffset+y,vertexLength:p.vertexLength,primitiveLength:E};C.get().push(A)}y+=E}for(let b=0;b<h.length;b++){const E=h[b].id;this.indexArray.emplaceBack(E,E+1,E+3),this.indexArray.emplaceBack(E,E+3,E+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,a,h,p,m){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,a,h,p,m)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,l8.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,a,h,p,m){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,a,h,p,m)}updateHiddenByLandmark(e){if(!this.hasData())return;const i=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;const a=e.flags&lu?1:0;for(let h=e.groundVertexArrayOffset;h<i;++h)this.hiddenByLandmarkVertexArray.emplace(h,a);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,u8.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Wm{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new vn,this.footprintVertices=new Cr,this.footprintSegments=[],this.layoutVertexArray=new gn,this.centroidVertexArray=new QI,this.indexArray=new vn,this.programConfigurations=new Xc(e.layers,e.zoom,i=>U$.includes(i)),this.segments=new Qn,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new CO(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,i,a,h){this.features=[],this.hasPattern=dw("fill-extrusion",this.layers,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=yv(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:p,id:m,index:y,sourceLayerIndex:b}of e){const E=this.layers[0]._featureFilter.needGeometry,C=Jc(p,E);if(!this.layers[0]._featureFilter.filter(new Ae(this.zoom),C,a))continue;const A={id:m,sourceLayerIndex:b,index:y,geometry:E?C.geometry:Sl(p,a,h),properties:p.properties,type:p.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(fw("fill-extrusion",this.layers,A,this.zoom,i)):this.addFeature(A,A.geometry,y,a,{},i.availableImages,h,i.brightness),i.featureIndex.insert(p,A.geometry,y,b,this.index,P)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,a,h,p,m){for(const y of this.features){const{geometry:b}=y;this.addFeature(y,b,y.index,i,a,h,p,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,a,h,p){const m=Object.keys(e).length!==0;if(m&&!this.stateDependentLayers.length)return;const y=m?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,i,y,a,h,p),this.groundEffect.update(e,i,y,a,h,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,d8),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,h8.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,c8.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,h,p,m,y,b){const E=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,C=[new se(0,0),new se(kt,kt)],A=y.projection,P=A.name==="globe",R=$$[e.type]==="Polygon",z=new SO;z.centroidDataIndex=this.centroidData.length;const B=new EO,V=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},h)<=0,Q=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},h);B.height=Q,B.vertexArrayOffset=this.layoutVertexArray.length,B.groundVertexArrayOffset=this.groundEffect.vertexArray.length,P&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vn);const ae=hw(i,500);for(let Ne=ae.length-1;Ne>=0;Ne--){const je=ae[Ne];(je.length===0||(le=je[0]).every(Ye=>Ye.x<=0)||le.every(Ye=>Ye.x>=kt)||le.every(Ye=>Ye.y<=0)||le.every(Ye=>Ye.y>=kt))&&ae.splice(Ne,1)}var le;let he;if(P)he=DO(ae,C,h);else{he=[];for(const Ne of ae)he.push({polygon:Ne,bounds:C})}const me=R?this.edgeRadius:0,ve=me>0&&this.zoom<17,Pe=(Ne,je)=>{if(Ne.length===0)return!1;const Ye=Ne[Ne.length-1];return je.x===Ye.x&&je.y===Ye.y};for(const{polygon:Ne,bounds:je}of he){let Ye=0,Ve=0;for(const wt of Ne)R&&!wt[0].equals(wt[wt.length-1])&&wt.push(wt[0]),Ve+=R?wt.length-1:wt.length;const ht=this.segments.prepareSegment((R?5:4)*Ve,this.layoutVertexArray,this.indexArray);B.footprintSegIdx<0&&(B.footprintSegIdx=this.footprintSegments.length),B.polygonSegIdx<0&&(B.polygonSegIdx=this.polygonSegments.length);const Ct={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},st=new wO;if(st.vertexOffset=this.footprintVertices.length,st.indexOffset=3*this.footprintIndices.length,st.ringIndices=[],R){const wt=[],ot=[];Ye=ht.vertexLength;for(let Ht=0;Ht<Ne.length;Ht++){const Tt=Ne[Ht];Tt.length&&Ht!==0&&ot.push(wt.length/2);const hr=[];let Yt,Pt;Yt=Tt[1].sub(Tt[0])._perp()._unit(),st.ringIndices.push(Tt.length-1);for(let dr=1;dr<Tt.length;dr++){const rr=Tt[dr],ar=Tt[dr===Tt.length-1?1:dr+1],Mt=rr.clone();if(me){Pt=ar.sub(rr)._perp()._unit();const yr=Yt.add(Pt)._unit(),Zr=me*Math.min(4,1/(Yt.x*yr.x+Yt.y*yr.y));Mt.x+=Zr*yr.x,Mt.y+=Zr*yr.y,Mt.x=Math.round(Mt.x),Mt.y=Math.round(Mt.y),Yt=Pt}!V||me!==0&&!ve||Pe(hr,Mt)||hr.push(Mt),Gm(this.layoutVertexArray,Mt.x,Mt.y,0,0,1,1,0),ht.vertexLength++,this.footprintVertices.emplaceBack(rr.x,rr.y),wt.push(rr.x,rr.y),P&&qm(this.layoutVertexExtArray,A.projectTilePoint(Mt.x,Mt.y,h),A.upVector(h,Mt.x,Mt.y))}V&&(me===0||ve)&&(hr.length!==0&&Pe(hr,hr[0])&&hr.pop(),this.groundEffect.addData(hr,je,E))}const Rt=Mv(wt,ot);for(let Ht=0;Ht<Rt.length;Ht+=3)this.footprintIndices.emplaceBack(st.vertexOffset+Rt[Ht+0],st.vertexOffset+Rt[Ht+1],st.vertexOffset+Rt[Ht+2]),this.indexArray.emplaceBack(Ye+Rt[Ht],Ye+Rt[Ht+2],Ye+Rt[Ht+1]),ht.primitiveLength++;st.indexCount+=Rt.length,st.vertexCount+=this.footprintVertices.length-st.vertexOffset}for(let wt=0;wt<Ne.length;wt++){const ot=Ne[wt];z.startRing(B,ot[0]);let Rt=ot.length>4&&kO(ot[ot.length-2],ot[0],ot[1]),Ht=me?Z$(ot[ot.length-2],ot[0],ot[1],me):0;const Tt=[];let hr,Yt,Pt;Yt=ot[1].sub(ot[0])._perp()._unit();let dr=!0;for(let rr=1,ar=0;rr<ot.length;rr++){let Mt=ot[rr-1],yr=ot[rr];const Zr=ot[rr===ot.length-1?1:rr+1];if(z.appendEdge(B,yr,Mt),Fw(yr,Mt,je)){me&&(Yt=Zr.sub(yr)._perp()._unit(),dr=!dr);continue}const Mr=yr.sub(Mt)._perp(),jr=Mr.x/(Math.abs(Mr.x)+Math.abs(Mr.y)),nn=Mr.y>0?1:0,Pn=Mt.dist(yr);if(ar+Pn>32768&&(ar=0),me){Pt=Zr.sub(yr)._perp()._unit();let dn=IO(Mt,yr,Zr,MO(Yt,Pt),me);isNaN(dn)&&(dn=0);const _n=yr.sub(Mt)._unit();Mt=Mt.add(_n.mult(Ht))._round(),yr=yr.add(_n.mult(-dn))._round(),Ht=dn,Yt=Pt,V&&this.zoom>=17&&(Pe(Tt,Mt)||Tt.push(Mt),Pe(Tt,yr)||Tt.push(yr))}const Pr=ht.vertexLength,qn=ot.length>4&&kO(Mt,yr,Zr);let On=PO(ar,Rt,dr);if(Gm(this.layoutVertexArray,Mt.x,Mt.y,jr,nn,0,0,On),Gm(this.layoutVertexArray,Mt.x,Mt.y,jr,nn,0,1,On),ar+=Pn,On=PO(ar,qn,!dr),Rt=qn,Gm(this.layoutVertexArray,yr.x,yr.y,jr,nn,0,0,On),Gm(this.layoutVertexArray,yr.x,yr.y,jr,nn,0,1,On),ht.vertexLength+=4,this.indexArray.emplaceBack(Pr+0,Pr+1,Pr+2),this.indexArray.emplaceBack(Pr+1,Pr+3,Pr+2),ht.primitiveLength+=2,me){const dn=Ye+(rr===1?ot.length-2:rr-2),_n=rr===1?Ye:dn+1;if(this.indexArray.emplaceBack(Pr+1,dn,Pr+3),this.indexArray.emplaceBack(dn,_n,Pr+3),ht.primitiveLength+=2,hr===void 0&&(hr=Pr),!Fw(Zr,ot[rr],je)){const on=rr===ot.length-1?hr:ht.vertexLength;this.indexArray.emplaceBack(Pr+2,Pr+3,on),this.indexArray.emplaceBack(Pr+3,on+1,on),this.indexArray.emplaceBack(Pr+3,_n,on+1),ht.primitiveLength+=3}dr=!dr}if(P){const dn=this.layoutVertexExtArray,_n=A.projectTilePoint(Mt.x,Mt.y,h),on=A.projectTilePoint(yr.x,yr.y,h),ai=A.upVector(h,Mt.x,Mt.y),Wn=A.upVector(h,yr.x,yr.y);qm(dn,_n,ai),qm(dn,_n,ai),qm(dn,on,Wn),qm(dn,on,Wn)}}R&&(Ye+=ot.length-1),V&&me&&this.zoom>=17&&(Tt.length!==0&&Pe(Tt,Tt[0])&&Tt.pop(),this.groundEffect.addData(Tt,je,E,me>0))}this.footprintSegments.push(st),Ct.triangleCount=this.indexArray.length-Ct.triangleArrayOffset,this.polygonSegments.push(Ct),++B.footprintSegLen,++B.polygonSegLen}if(B.vertexCount=this.layoutVertexArray.length-B.vertexArrayOffset,B.groundVertexCount=this.groundEffect.vertexArray.length-B.groundVertexArrayOffset,B.vertexCount!==0){if(B.centroidXY=z.borders?bO:this.encodeCentroid(z,B),this.centroidData.push(B),z.borders){this.featuresOnBorder.push(z);const Ne=this.featuresOnBorder.length-1;for(let je=0;je<z.borders.length;je++)z.borders[je][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[je].push(Ne)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,p,m,h,b),this.groundEffect.addPaintPropertiesData(e,a,p,m,h,b),this.maxHeight=Math.max(this.maxHeight,Q)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let y=0;y<this.centroidData.length;y++){const b=this.centroidData[y],E=+(b.min.y+b.max.y>kt),C=2*E+(+(b.min.x+b.max.x>kt)^E);for(let A=0;A<b.polygonSegLen;A++){const P=b.polygonSegIdx+A;e.push({centroidIdx:y,subtile:C,polygonSegmentIdx:P,triangleSegmentIdx:this.polygonSegments[P].triangleSegIdx})}}const i=new vn;e.sort((y,b)=>y.triangleSegmentIdx===b.triangleSegmentIdx?y.subtile-b.subtile:y.triangleSegmentIdx-b.triangleSegmentIdx);let a=0,h=0,p=0;for(const y of e){if(y.triangleSegmentIdx!==a)break;p++}const m=e.length;for(;h!==e.length;){a=e[h].triangleSegmentIdx;let y=0,b=h,E=h;for(let C=b;C<p&&e[C].subtile===y;C++)E++;for(;b!==p;){const C=e[b];y=C.subtile;const A=this.centroidData[C.centroidIdx].min.clone(),P=this.centroidData[C.centroidIdx].max.clone(),R={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let z=b;z<E;z++){const B=e[z],V=this.polygonSegments[B.polygonSegmentIdx],Q=this.centroidData[B.centroidIdx].min,ae=this.centroidData[B.centroidIdx].max,le=this.indexArray.uint16;for(let he=V.triangleArrayOffset;he<V.triangleArrayOffset+V.triangleCount;he++)i.emplaceBack(le[3*he],le[3*he+1],le[3*he+2]);R.primitiveLength+=V.triangleCount,A.x=Math.min(A.x,Q.x),A.y=Math.min(A.y,Q.y),P.x=Math.max(P.x,ae.x),P.y=Math.max(P.y,ae.y)}R.primitiveLength>0&&this.triangleSubSegments.push({segment:R,min:A,max:P}),b=E;for(let z=b;z<p&&e[z].subtile===e[b].subtile;z++)E++}h=p;for(let C=h;C<m&&e[C].triangleSegmentIdx===e[h].triangleSegmentIdx;C++)p++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,a){let h=0,p=0;const m=1<<e.canonical.z;if(i){const B=i.getMinMaxForTile(e);B&&(h=B.min,p=B.max)}p+=this.maxHeight;const y=e.toUnwrapped();let b;const E=[y.canonical.x/m+y.wrap,y.canonical.y/m],C=[(y.canonical.x+1)/m+y.wrap,(y.canonical.y+1)/m],A=new Qn,P=(B,V,Q)=>[B[0]*(1-Q[0])+V[0]*Q[0],B[1]*(1-Q[1])+V[1]*Q[1]],R=[],z=[];for(const B of this.triangleSubSegments){R[0]=B.min.x/kt,R[1]=B.min.y/kt,z[0]=B.max.x/kt,z[1]=B.max.y/kt;const V=P(E,C,R),Q=P(E,C,z);if(new wi([V[0],V[1],h],[Q[0],Q[1],p]).intersectsPrecise(a)===0){b&&(A.segments.push(b),b=void 0);continue}const ae=B.segment;b&&b.vertexOffset!==ae.vertexOffset&&(A.segments.push(b),b=void 0),b?(b.vertexLength+=ae.vertexLength,b.primitiveLength+=ae.primitiveLength):b={vertexOffset:ae.vertexOffset,primitiveLength:ae.primitiveLength,vertexLength:ae.vertexLength,primitiveOffset:ae.primitiveOffset,sortKey:void 0,vaos:{}}}return b&&A.segments.push(b),A}encodeCentroid(e,i){const a=e.centroid(),h=i.span(),p=Math.min(7,Math.round(h.x*this.tileToMeter/10)),m=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new se(rt(a.x,1,kt-1)<<3|p,rt(a.y,1,kt-1)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new se(0,0);const i=e.borders,a=Number.MAX_VALUE;if(i[0][0]!==a||i[1][0]!==a){const h=i[0][0]!==a?0:1;return new se(6|(i[0][0]!==a?0:65528),((i[h][0]+i[h][1])/2|0)<<3|6)}{const h=i[2][0]!==a?2:3;return new se(((i[h][0]+i[h][1])/2|0)<<3|6,6|(i[2][0]!==a?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=lu,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,h=e.flags&lu?bO:e.centroidXY,p=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||p!==h.x){for(let m=i;m<a;++m)this.centroidVertexArray.emplace(m,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());if(function(p,m){if(p.length!==m.length)return!1;for(let y=0;y<p.length;y++)if(p[y].sourceId!==m[y].sourceId||!gO(p[y],m[y]))return!1;return!0}(this.activeReplacements,a))return;if(this.activeReplacements=a,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const p of this.centroidData)p.flags&=2147483647;const h=[];for(const p of this.activeReplacements){const m=Math.pow(2,p.footprintTileId.canonical.z-e.canonical.z);for(const y of this.centroidData)if(!(y.flags&lu||p.min.x>y.max.x||y.min.x>p.max.x||p.min.y>y.max.y||y.min.y>p.max.y))for(let b=0;b<y.footprintSegLen;b++){const E=this.footprintSegments[y.footprintSegIdx+b];if(h.length=0,X$(this.footprintVertices,E.vertexOffset,E.vertexCount,p.footprintTileId.canonical,e.canonical,h),vO(p.footprint,h,this.footprintIndices.uint16,E.indexOffset,E.indexCount,-E.vertexOffset,-m)){y.flags|=lu;break}}}for(const p of this.centroidData)this.writeCentroidToBuffer(p);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,a){let h=!1;for(let p=0;p<a.footprintSegLen;p++){const m=this.footprintSegments[a.footprintSegIdx+p];let y=0;for(const b of m.ringIndices){for(let E=y,C=b+y-1;E<b+y;C=E++){const A=this.footprintVertices.int16[2*(E+m.vertexOffset)+0],P=this.footprintVertices.int16[2*(E+m.vertexOffset)+1],R=this.footprintVertices.int16[2*(C+m.vertexOffset)+1];P>i!=R>i&&e<(this.footprintVertices.int16[2*(C+m.vertexOffset)+0]-A)*(i-P)/(R-P)+A&&(h=!h)}y=b}}return h}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,h=!0;const p=4*(e+kt)*kt+(i+kt);if(this.partLookup.hasOwnProperty(p)){const m=this.partLookup[p];return m?{height:m.height,hidden:!!(m.flags&lu)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||i>m.max.y||m.min.y>i||this.footprintContainsPoint(e,i,m)&&m&&m.height>a&&(a=m.height,this.partLookup[p]=m,h=!!(m.flags&lu));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:h};this.partLookup[p]=void 0}}function MO(r,e){const i=r.add(e)._unit();return r.x*i.x+r.y*i.y}function Z$(r,e,i,a){const h=e.sub(r)._perp()._unit(),p=i.sub(e)._perp()._unit();return IO(r,e,i,MO(h,p),a)}function IO(r,e,i,a,h){const p=Math.sqrt(1-a*a);return Math.min(r.dist(e)/3,e.dist(i)/3,h*p/a)}function Fw(r,e,i){return r.x<i[0].x&&e.x<i[0].x||r.x>i[1].x&&e.x>i[1].x||r.y<i[0].y&&e.y<i[0].y||r.y>i[1].y&&e.y>i[1].y}function AO(r,e){return r.x<e[0].x||r.x>e[1].x||r.y<e[0].y||r.y>e[1].y}function kO(r,e,i){if(r.x<0||r.x>=kt||e.x<0||e.x>=kt||i.x<0||i.x>=kt)return!1;const a=i.sub(e),h=a.perp(),p=r.sub(e);return(a.x*p.x+a.y*p.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(p.x*p.x+p.y*p.y))>-.866&&h.x*p.x+h.y*p.y<0}function PO(r,e,i){const a=e?2|r:-3&r;return i?1|a:-2&a}function OO(){const r=Math.PI/32,e=Math.tan(r),i=Im;return i*Math.sqrt(1+2*e*e)-i}function DO(r,e,i){const a=1<<i.z,h=Ps(i.x/a),p=Ps((i.x+1)/a),m=fo(i.y/a),y=fo((i.y+1)/a);return function(b,E,C,A,P=0,R){const z=[];if(!b.length||!C||!A)return z;const B=(ve,Pe)=>{for(const Ne of ve)z.push({polygon:Ne,bounds:Pe})},V=Math.ceil(Math.log2(C)),Q=Math.ceil(Math.log2(A)),ae=V-Q,le=[];for(let ve=0;ve<Math.abs(ae);ve++)le.push(ae>0?0:1);for(let ve=0;ve<Math.min(V,Q);ve++)le.push(0),le.push(1);let he=b;if(he=Pv(he,E[0].y-P,E[1].y+P,1),he=Pv(he,E[0].x-P,E[1].x+P,0),!he.length)return z;const me=[];for(le.length?me.push({polygons:he,bounds:E,depth:0}):B(he,E);me.length;){const ve=me.pop(),Pe=ve.depth,Ne=le[Pe],je=ve.bounds[0],Ye=ve.bounds[1],Ve=Ne===0?je.x:je.y,ht=Ne===0?Ye.x:Ye.y,Ct=R?R(Ne,Ve,ht):.5*(Ve+ht),st=Pv(ve.polygons,Ve-P,Ct+P,Ne),wt=Pv(ve.polygons,Ct-P,ht+P,Ne);if(st.length){const ot=[je,new se(Ne===0?Ct:Ye.x,Ne===1?Ct:Ye.y)];le.length>Pe+1?me.push({polygons:st,bounds:ot,depth:Pe+1}):B(st,ot)}if(wt.length){const ot=[new se(Ne===0?Ct:je.x,Ne===1?Ct:je.y),Ye];le.length>Pe+1?me.push({polygons:wt,bounds:ot,depth:Pe+1}):B(wt,ot)}}return z}(r,e,Math.ceil((p-h)/11.25),Math.ceil((m-y)/11.25),1,(b,E,C)=>{if(b===0)return .5*(E+C);{const A=fo((i.y+E/kt)/a);return(El(.5*(fo((i.y+C/kt)/a)+A))*a-i.y)*kt}})}function X$(r,e,i,a,h,p){const m=Math.pow(2,a.z-h.z);for(let y=0;y<i;y++){let b=r.int16[2*(y+e)+0],E=r.int16[2*(y+e)+1];b=(b+h.x*kt)*m-a.x*kt,E=(E+h.y*kt)*m-a.y*kt,p.push(new se(b,E))}}Zt(Wm,"FillExtrusionBucket",{omit:["layers","features"]}),Zt(EO,"PartData"),Zt(wO,"FootprintSegment"),Zt(SO,"BorderCentroidData"),Zt(CO,"GroundEffect");const Y$=new pt({visibility:new ye(Ge["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ye(Ge["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Q$={paint:new pt({"fill-extrusion-opacity":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new $e(Ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new $e(Ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new $e(Ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new $e(Ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new $e(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new $e(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new ye(Ge["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:Y$};class df extends se{constructor(e,i,a){super(e,i),this.z=a}}function Hm(r,e){return r.x*e.x+r.y*e.y}function RO(r,e){if(r.length===1){let i=0;const a=e[i++];let h;for(;!h||a.equals(h);)if(h=e[i++],!h)return 1/0;for(;i<e.length;i++){const p=e[i],m=r[0],y=h.sub(a),b=p.sub(a),E=m.sub(a),C=Hm(y,y),A=Hm(y,b),P=Hm(b,b),R=Hm(E,y),z=Hm(E,b),B=C*P-A*A,V=(P*R-A*z)/B,Q=(C*z-A*R)/B,ae=a.z*(1-V-Q)+h.z*V+p.z*Q;if(isFinite(ae))return ae}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function LO(r,e,i,a,h,p,m,y){const b=m*h.getElevationAt(r,e,!0,!0),E=p[0]!==0,C=E?p[1]===0?m*(p[0]/7-450):m*function(A,P,R){const z=Math.floor(P[0]/8),B=Math.floor(P[1]/8),V=10*(P[0]-8*z),Q=10*(P[1]-8*B),ae=A.getElevationAt(z,B,!0,!0),le=A.getMeterToDEM(R),he=Math.floor(.5*(V*le-1)),me=Math.floor(.5*(Q*le-1)),ve=A.tileCoordToPixel(z,B),Pe=2*he+1,Ne=2*me+1,je=function(wt,ot,Rt,Ht,Tt){return[wt.getElevationAtPixel(ot,Rt,!0),wt.getElevationAtPixel(ot+Tt,Rt,!0),wt.getElevationAtPixel(ot,Rt+Tt,!0),wt.getElevationAtPixel(ot+Ht,Rt+Tt,!0)]}(A,ve.x-he,ve.y-me,Pe,Ne),Ye=Math.abs(je[0]-je[1]),Ve=Math.abs(je[2]-je[3]),ht=Math.abs(je[0]-je[2])+Math.abs(je[1]-je[3]),Ct=Math.min(.25,.5*le*(Ye+Ve)/Pe),st=Math.min(.25,.5*le*ht/Ne);return ae+Math.max(Ct*V,st*Q)}(h,p,y):b;return{base:b+(i===0)?-1:i,top:E?Math.max(C+a,b+i+2):b+a}}const K$=new pt({"line-cap":new $e(Ge.layout_line["line-cap"]),"line-join":new $e(Ge.layout_line["line-join"]),"line-miter-limit":new ye(Ge.layout_line["line-miter-limit"]),"line-round-limit":new ye(Ge.layout_line["line-round-limit"]),"line-sort-key":new $e(Ge.layout_line["line-sort-key"]),visibility:new ye(Ge.layout_line.visibility)});var zO={paint:new pt({"line-opacity":new $e(Ge.paint_line["line-opacity"]),"line-color":new $e(Ge.paint_line["line-color"]),"line-translate":new ye(Ge.paint_line["line-translate"]),"line-translate-anchor":new ye(Ge.paint_line["line-translate-anchor"]),"line-width":new $e(Ge.paint_line["line-width"]),"line-gap-width":new $e(Ge.paint_line["line-gap-width"]),"line-offset":new $e(Ge.paint_line["line-offset"]),"line-blur":new $e(Ge.paint_line["line-blur"]),"line-dasharray":new $e(Ge.paint_line["line-dasharray"]),"line-pattern":new $e(Ge.paint_line["line-pattern"]),"line-gradient":new St(Ge.paint_line["line-gradient"]),"line-trim-offset":new ye(Ge.paint_line["line-trim-offset"]),"line-emissive-strength":new ye(Ge.paint_line["line-emissive-strength"]),"line-border-width":new $e(Ge.paint_line["line-border-width"]),"line-border-color":new $e(Ge.paint_line["line-border-color"])}),layout:K$};function NO(r,e){return 1/sO(r,1,e.tileZoom)}function FO(r,e,i,a){return r.translatePosMatrix(a||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const BO=r=>{const e=[];jO(r)&&e.push("RENDER_LINE_DASH"),r.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=r.paint.get("line-trim-offset");return i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),r.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function jO(r){const e=r.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}const $O=new class extends $e{possiblyEvaluate(r,e){return e=new Ae(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,i,a){return e=or({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,i,a)}}(zO.paint.properties["line-width"].specification);function UO(r,e){return e>0?e+2*r:r}$O.useIntegerZoom=!0;const J$=new pt({visibility:new ye(Ge.layout_background.visibility)});var e7={paint:new pt({"background-color":new ye(Ge.paint_background["background-color"]),"background-pattern":new ye(Ge.paint_background["background-pattern"]),"background-opacity":new ye(Ge.paint_background["background-opacity"]),"background-emissive-strength":new ye(Ge.paint_background["background-emissive-strength"])}),layout:J$};const t7=new pt({visibility:new ye(Ge.layout_raster.visibility)});var r7={paint:new pt({"raster-opacity":new ye(Ge.paint_raster["raster-opacity"]),"raster-color":new St(Ge.paint_raster["raster-color"]),"raster-color-mix":new ye(Ge.paint_raster["raster-color-mix"]),"raster-color-range":new ye(Ge.paint_raster["raster-color-range"]),"raster-hue-rotate":new ye(Ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ye(Ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ye(Ge.paint_raster["raster-brightness-max"]),"raster-saturation":new ye(Ge.paint_raster["raster-saturation"]),"raster-contrast":new ye(Ge.paint_raster["raster-contrast"]),"raster-resampling":new ye(Ge.paint_raster["raster-resampling"]),"raster-fade-duration":new ye(Ge.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ye(Ge.paint_raster["raster-emissive-strength"]),"raster-array-band":new ye(Ge.paint_raster["raster-array-band"]),"raster-elevation":new ye(Ge.paint_raster["raster-elevation"])}),layout:t7};function a0(r,e,i,a,h,p,m,y){const b=[r,e,1,i,a,1,h,p,1],E=[m,y,1],C=s.bx.adjoint([],b),[A,P,R]=s.v.transformMat3(E,E,C);return s.bx.multiply(b,b,[A,0,0,0,P,0,0,0,R])}function VO(r,e,i,a,h,p,m,y){const b=function(E,C,A,P,R,z,B,V){const Q=a0(0,0,1,0,1,1,0,1),ae=a0(E,C,A,P,R,z,B,V),le=s.bx.adjoint([],Q);return s.bx.multiply(ae,ae,le)}(r,e,i,a,h,p,m,y);return[b[2]/b[8]/kt,b[5]/b[8]/kt]}function l0(r){return[r[0],Math.min(Math.max(r[1],-_i),_i)]}class GO extends Ri{constructor(e,i,a,h){super(),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Po("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=ke(this.map._requestManager.transformRequest(this.url,Fn.Image),(a,h)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new $s(a)):h&&(this.image=h instanceof HTMLImageElement?ji.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Qv(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Po("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Qv||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],a=e[0][1];for(const p of e)p[1]>a&&(a=p[1]),p[1]<i&&(i=p[1]);const h=(a+i)/2;if(h>_i?this.onNorthPole=!0:h<-_i&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const p=e.map(Eo.fromLngLat);this.tileID=function(m){let y=1/0,b=1/0,E=-1/0,C=-1/0;for(const B of m)y=Math.min(y,B.x),b=Math.min(b,B.y),E=Math.max(E,B.x),C=Math.max(C,B.y);const A=Math.max(E-y,C-b),P=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),R=Math.pow(2,P);let z=Math.floor((y+E)/2*R);return z>1&&(z-=1),new Th(P,z,Math.floor((b+C)/2*R))}(p),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Po("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const V in this.tiles){const Q=this.tiles[V];Q.state!=="loaded"&&(Q.state="loaded",Q.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=nu(new Th(0,0,0),this.map.transform.projection),a=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(V){const Q=V[1].x-V[0].x,ae=V[1].y-V[0].y,le=V[2].x-V[1].x,he=V[2].y-V[1].y,me=V[3].x-V[2].x,ve=V[3].y-V[2].y,Pe=V[0].x-V[3].x,Ne=V[0].y-V[3].y,je=Q*he-le*ae,Ye=le*ve-me*he,Ve=me*Ne-Pe*ve,ht=Pe*ae-Q*Ne;return je>0&&Ye>0&&Ve>0&&ht>0||je<0&&Ye<0&&Ve<0&&ht<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=nu(this.tileID,this.map.transform.projection),[p,m,y,b]=this.coordinates.map(V=>{const Q=h.projection.project(V[0],V[1]);return WP(h,Q)._round()});this.perspectiveTransform=VO(p.x,p.y,m.x,m.y,y.x,y.y,b.x,b.y);const E=this._boundsArray=new gn;E.emplaceBack(p.x,p.y,0,0),E.emplaceBack(m.x,m.y,kt,0),E.emplaceBack(b.x,b.y,0,kt),E.emplaceBack(y.x,y.y,kt,kt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(E,Jv.members),this.boundsSegments=Qn.simpleSegment(0,0,4,2);const C=[],A=function(V){return[l0(V[0]),l0(V[1]),l0(V[2]),l0(V[3])]}(this.coordinates),[P,R,z,B]=function(V){let Q=V[0][0],ae=Q,le=V[0][1],he=le;for(let me=1;me<V.length;me++)V[me][0]<Q?Q=V[me][0]:V[me][0]>ae&&(ae=V[me][0]),V[me][1]<le?le=V[me][1]:V[me][1]>he&&(he=V[me][1]);return[Q,le,ae-Q,he-le]}(A);{const V=new gn,[Q,ae,le,he]=function(ot){let Rt=ot[0].x,Ht=Rt,Tt=ot[0].y,hr=Tt;for(let Yt=1;Yt<ot.length;Yt++)ot[Yt].x<Rt?Rt=ot[Yt].x:ot[Yt].x>Ht&&(Ht=ot[Yt].x),ot[Yt].y<Tt?Tt=ot[Yt].y:ot[Yt].y>hr&&(hr=ot[Yt].y);return[Rt,Tt,Ht-Rt,hr-Tt]}(a),me=ot=>[(ot.x-Q)/le,(ot.y-ae)/he],[ve,Pe,Ne,je]=a.map(me),Ye=function(ot,Rt,Ht,Tt,hr,Yt,Pt,dr){const rr=a0(0,0,1,0,1,1,0,1),ar=a0(ot,Rt,Ht,Tt,hr,Yt,Pt,dr),Mt=s.bx.adjoint([],ar);return s.bx.multiply(rr,rr,Mt)}(ve[0],ve[1],Pe[0],Pe[1],Ne[0],Ne[1],je[0],je[1]);this.elevatedGlobePerspectiveTransform=VO(ve[0],ve[1],Pe[0],Pe[1],Ne[0],Ne[1],je[0],je[1]);const Ve=(ot,Rt)=>{C.push(ot.lng);const Ht=Math.round((ot.lng-P)/z*kt),Tt=Math.round((ot.lat-R)/B*kt),hr=me(Rt),Yt=s.v.transformMat3([],[hr[0],hr[1],1],Ye),Pt=Math.round(Yt[0]/Yt[2]*kt),dr=Math.round(Yt[1]/Yt[2]*kt);V.emplaceBack(Ht,Tt,Pt,dr)},ht=a[3].x-a[0].x,Ct=a[3].y-a[0].y,st=a[2].x-a[1].x,wt=a[2].y-a[1].y;for(let ot=0;ot<65;ot++){const Rt=ot/64,Ht=[a[0].x+Rt*ht,a[0].y+Rt*Ct],Tt=[a[1].x+Rt*st,a[1].y+Rt*wt],hr=Tt[0]-Ht[0],Yt=Tt[1]-Ht[1];for(let Pt=0;Pt<65;Pt++){const dr=Pt/64,rr={x:Ht[0]+hr*dr,y:Ht[1]+Yt*dr,z:0};Ve(i.projection.unproject(rr.x,rr.y),rr)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(V,Jv.members)}{this.maxLongitudeTriangleSize=0;let V=[],Q=new vn;const ae=(le,he,me)=>{Q.emplaceBack(le,he,me);const ve=C[le],Pe=C[he],Ne=C[me],je=Math.min(Math.min(ve,Pe),Ne),Ye=Math.max(Math.max(ve,Pe),Ne)-je;Ye>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ye),V.push(je+Ye/2)};for(let le=0;le<64;le++)for(let he=0;he<64;he++){const me=65*le+he,ve=me+1,Pe=me+65,Ne=Pe+1;ae(me,Pe,ve),ae(ve,Pe,Ne)}[V,Q]=function(le,he){const me=Array.from({length:le.length},(Ne,je)=>je);me.sort((Ne,je)=>le[Ne]-le[je]);const ve=[],Pe=new vn;for(let Ne=0;Ne<me.length;Ne++){const je=me[Ne];ve.push(le[je]);const Ye=3*je,Ve=Ye+1;Pe.emplaceBack(he.uint16[Ye],he.uint16[Ve],he.uint16[Ve+1])}return[ve,Pe]}(V,Q),this.elevatedGlobeTrianglesCenterLongitudes=V,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(Q)}this.elevatedGlobeSegments=Qn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,z/kt,0,B/kt,0,0,R,P,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,a=i.gl;!this._dirty||this.texture instanceof Qv||(this.texture?this.texture.update(this.image):(this.texture=new hc(i,this.image,a.RGBA),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let h=((C,A)=>C+360*Math.round((A-C)/360))(e+180,a[0]);const p=new Qn,m=(C,A)=>{p.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:i.segments[0].vertexLength,primitiveLength:A,sortKey:void 0,vaos:{}})},y=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-h)<=y){const C=ir(a,0,a.length,h+y);return C===a.length||m(C,yt(a,C+1,a.length,h+360-y)-C),p}h<a[0]&&(h+=360);const b=yt(a,0,a.length,h-y);if(b===a.length)return m(0,a.length),p;m(0,b-0);const E=ir(a,b+1,a.length,h+y);return E!==a.length&&m(E,a.length-E),p}}class n7 extends Wt{constructor(e,i){super(e,{},i),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}const i7=new pt({visibility:new ye(Ge.layout_sky.visibility)});var o7={paint:new pt({"sky-type":new ye(Ge.paint_sky["sky-type"]),"sky-atmosphere-sun":new ye(Ge.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ye(Ge.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ye(Ge.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ye(Ge.paint_sky["sky-gradient-radius"]),"sky-gradient":new St(Ge.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ye(Ge.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ye(Ge.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ye(Ge.paint_sky["sky-opacity"])}),layout:i7};function Bw(r,e,i){const a=[0,0,1],h=s.q.identity([]);return s.q.rotateY(h,h,i?-ze(r)+Math.PI:ze(r)),s.q.rotateX(h,h,-ze(e)),s.v.transformQuat(a,a,h),s.v.normalize(a,a)}var s7={paint:new pt({})};const a7={circle:class extends Wt{constructor(r,e,i){super(r,F6,e,i)}createBucket(r){return new rw(r)}queryRadius(r){const e=r;return Kd("circle-radius",this,e)+Kd("circle-stroke-width",this,e)+bv(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,a,h,p,m,y){const b=Wk(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),E=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return Zk(r,a,p,m,y,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,E)}getProgramIds(){return["circle"]}getDefaultProgramParams(r,e){const i=Hk(this);return{config:new wh(this,e),defines:i,overrideFog:!1}}},heatmap:class extends Wt{createBucket(r){return new Yk(r)}constructor(r,e,i){super(r,G6,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=wv({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(r){return Kd("heatmap-radius",this,r)}queryIntersectsFeature(r,e,i,a,h,p,m,y){const b=this.paint.get("heatmap-radius").evaluate(e,i);return Zk(r,a,p,m,y,!0,!0,new se(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(r,e){return r==="heatmap"?{config:new wh(this,e),overrideFog:!1}:{}}},hillshade:class extends Wt{constructor(r,e,i){super(r,W6,e,i)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(r,e){return{overrideFog:!1}}},fill:class extends Wt{constructor(r,e,i){super(r,s8,e,i)}getProgramIds(){const r=this.paint.get("fill-pattern"),e=r&&r.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(r,e){return{config:new wh(this,e),overrideFog:!1}}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Iv(r)}queryRadius(){return bv(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,a,h,p){return!r.queryGeometry.isAboveHorizon&&$k(qk(r.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),a)}isTileClipped(){return!0}},"fill-extrusion":class extends Wt{constructor(r,e,i){super(r,Q$,e,i),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(r){return new Wm(r)}queryRadius(){return bv(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(r,e,i,a,h,p,m,y,b){const E=Wk(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),C=this.paint.get("fill-extrusion-height").evaluate(e,i),A=this.paint.get("fill-extrusion-base").evaluate(e,i),P=[0,0],R=y&&p.elevation,z=p.elevation?p.elevation.exaggeration():1,B=r.tile.getBucket(this);if(R&&B instanceof Wm){const he=B.centroidVertexArray,me=b+1;me<he.length&&(P[0]=he.geta_centroid_pos0(me),P[1]=he.geta_centroid_pos1(me))}if(P[0]===0&&P[1]===1)return!1;p.projection.name==="globe"&&(a=DO([a],[new se(0,0),new se(kt,kt)],r.tileID.canonical).map(he=>he.polygon).flat());const V=R?y:null,[Q,ae]=function(he,me,ve,Pe,Ne,je,Ye,Ve,ht,Ct,st){return he.projection.name==="globe"?function(wt,ot,Rt,Ht,Tt,hr,Yt,Pt,dr,rr,ar){const Mt=[],yr=[],Zr=wt.projection.upVectorScale(ar,wt.center.lat,wt.worldSize).metersToTile,Mr=[0,0,0,1],jr=[0,0,0,1],nn=(Pr,qn,On,dn)=>{Pr[0]=qn,Pr[1]=On,Pr[2]=dn,Pr[3]=1},Pn=OO();Rt>0&&(Rt+=Pn),Ht+=Pn;for(const Pr of ot){const qn=[],On=[];for(const dn of Pr){const _n=dn.x+Tt.x,on=dn.y+Tt.y,ai=wt.projection.projectTilePoint(_n,on,ar),Wn=wt.projection.upVector(ar,dn.x,dn.y);let yi=Rt,eo=Ht;if(Yt){const Ko=LO(_n,on,Rt,Ht,Yt,Pt,dr,rr);yi+=Ko.base,eo+=Ko.top}Rt!==0?nn(Mr,ai.x+Wn[0]*Zr*yi,ai.y+Wn[1]*Zr*yi,ai.z+Wn[2]*Zr*yi):nn(Mr,ai.x,ai.y,ai.z),nn(jr,ai.x+Wn[0]*Zr*eo,ai.y+Wn[1]*Zr*eo,ai.z+Wn[2]*Zr*eo),s.v.transformMat4(Mr,Mr,hr),s.v.transformMat4(jr,jr,hr),qn.push(new df(Mr[0],Mr[1],Mr[2])),On.push(new df(jr[0],jr[1],jr[2]))}Mt.push(qn),yr.push(On)}return[Mt,yr]}(he,me,ve,Pe,Ne,je,Ye,Ve,ht,Ct,st):Ye?function(wt,ot,Rt,Ht,Tt,hr,Yt,Pt,dr){const rr=[],ar=[],Mt=[0,0,0,1];for(const yr of wt){const Zr=[],Mr=[];for(const jr of yr){const nn=jr.x+Ht.x,Pn=jr.y+Ht.y,Pr=LO(nn,Pn,ot,Rt,hr,Yt,Pt,dr);Mt[0]=nn,Mt[1]=Pn,Mt[2]=Pr.base,Mt[3]=1,s.e.transformMat4(Mt,Mt,Tt),Mt[3]=Math.max(Mt[3],1e-5);const qn=new df(Mt[0]/Mt[3],Mt[1]/Mt[3],Mt[2]/Mt[3]);Mt[0]=nn,Mt[1]=Pn,Mt[2]=Pr.top,Mt[3]=1,s.e.transformMat4(Mt,Mt,Tt),Mt[3]=Math.max(Mt[3],1e-5);const On=new df(Mt[0]/Mt[3],Mt[1]/Mt[3],Mt[2]/Mt[3]);Zr.push(qn),Mr.push(On)}rr.push(Zr),ar.push(Mr)}return[rr,ar]}(me,ve,Pe,Ne,je,Ye,Ve,ht,Ct):function(wt,ot,Rt,Ht,Tt){const hr=[],Yt=[],Pt=Tt[8]*ot,dr=Tt[9]*ot,rr=Tt[10]*ot,ar=Tt[11]*ot,Mt=Tt[8]*Rt,yr=Tt[9]*Rt,Zr=Tt[10]*Rt,Mr=Tt[11]*Rt;for(const jr of wt){const nn=[],Pn=[];for(const Pr of jr){const qn=Pr.x+Ht.x,On=Pr.y+Ht.y,dn=Tt[0]*qn+Tt[4]*On+Tt[12],_n=Tt[1]*qn+Tt[5]*On+Tt[13],on=Tt[2]*qn+Tt[6]*On+Tt[14],ai=Tt[3]*qn+Tt[7]*On+Tt[15],Wn=dn+Pt,yi=_n+dr,eo=on+rr,Ko=Math.max(ai+ar,1e-5),Ei=dn+Mt,di=_n+yr,No=on+Zr,Fo=Math.max(ai+Mr,1e-5);nn.push(new df(Wn/Ko,yi/Ko,eo/Ko)),Pn.push(new df(Ei/Fo,di/Fo,No/Fo))}hr.push(nn),Yt.push(Pn)}return[hr,Yt]}(me,ve,Pe,Ne,je)}(p,a,A,C,E,m,V,P,z,p.center.lat,r.tileID.canonical),le=r.queryGeometry;return function(he,me,ve){let Pe=1/0;$k(ve,me)&&(Pe=RO(ve,me[0]));for(let Ne=0;Ne<me.length;Ne++){const je=me[Ne],Ye=he[Ne];for(let Ve=0;Ve<je.length-1;Ve++){const ht=je[Ve],Ct=[ht,je[Ve+1],Ye[Ve+1],Ye[Ve],ht];jk(ve,Ct)&&(Pe=Math.min(Pe,RO(ve,Ct)))}}return Pe!==1/0&&Pe}(Q,ae,le.isPointQuery()?le.screenBounds:le.screenGeometry)}},line:class extends Wt{constructor(r,e,i){super(r,zO,e,i),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Hp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=$O.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Yv(r)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(r,e){const i=BO(this);return{config:new wh(this,e),defines:i,overrideFog:!1}}queryRadius(r){const e=r,i=UO(Kd("line-width",this,e),Kd("line-gap-width",this,e)),a=Kd("line-offset",this,e);return i/2+Math.abs(a)+bv(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,a,h,p){if(r.queryGeometry.isAboveHorizon)return!1;const m=qk(r.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),p.angle,r.pixelToTileUnitsFactor),y=r.pixelToTileUnitsFactor/2*UO(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),b=this.paint.get("line-offset").evaluate(e,i);return b&&(a=function(E,C){const A=[],P=new se(0,0);for(let R=0;R<E.length;R++){const z=E[R],B=[];for(let V=0;V<z.length;V++){const Q=z[V],ae=z[V+1],le=V===0?P:Q.sub(z[V-1])._unit()._perp(),he=V===z.length-1?P:ae.sub(Q)._unit()._perp(),me=le._add(he)._unit();me._mult(1/(me.x*he.x+me.y*he.y)),B.push(me._mult(C)._add(Q))}A.push(B)}return A}(a,b*r.pixelToTileUnitsFactor)),function(E,C,A){for(let P=0;P<C.length;P++){const R=C[P];if(E.length>=3){for(let z=0;z<R.length;z++)if(Ih(E,R[z]))return!0}if(R6(E,R,A))return!0}return!1}(m,a,y)}isTileClipped(){return!0}},symbol:Gv,background:class extends Wt{constructor(r,e,i){super(r,e7,e,i)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(r,e){return{overrideFog:!1}}},raster:class extends Wt{constructor(r,e,i){super(r,r7,e,i),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(r){return!(r&&r._source instanceof GO)||!r._source.onNorthPole&&!r._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(r){r!=="raster-color"&&r!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;const r=this._transitionablePaint._values["raster-color"].value.expression,[e,i]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=wv({expression:r,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:i}],resolution:256}),this.colorRampTexture=null}},sky:class extends Wt{constructor(r,e,i){super(r,o7,e,i),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="sky-gradient"?this._updateColorRamp():r!=="sky-atmosphere-sun"&&r!=="sky-atmosphere-halo-color"&&r!=="sky-atmosphere-color"&&r!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=wv({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(r){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=r.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(r,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),h=!a,p=r.style.light,m=p.properties.get("position");return h&&p.properties.get("anchor")==="viewport"&&mr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Bw(m.azimuthal,90-m.polar,e):Bw(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return Bw(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(r){this._skyboxInvalidated=!1,this._lightPosition=r.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const r=this.paint.get("sky-type");return r==="atmosphere"?["skyboxCapture","skybox"]:r==="gradient"?["skyboxGradient"]:null}},slot:class extends Wt{constructor(r,e,i){super(r,s7,e)}},model:class extends Wt{constructor(r,e,i){super(r,N$,e,i)}createBucket(r){return new hO(r)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(r,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||r!=="model-color"&&r!=="model-color-mix-intensity"&&r!=="model-rotation"&&r!=="model-scale"&&r!=="model-translation"&&r!=="model-emissive-strength")}_isPropertyZoomDependent(r){const e=this._transitionablePaint._values[r];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof mh}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};class l7{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class c7{constructor(){this.tasks={},this.taskQueue=[],Er(["process"],this),this.invoker=new l7(this.process),this.nextId=0}add(e,i){const a=this.nextId++,h=function({type:p,isSymbolTile:m,zoom:y}){return y=y||0,p==="message"?0:p!=="maybePrepare"||m?p!=="parseTile"||m?p==="parseTile"&&m?300-y:p==="maybePrepare"&&m?400-y:500:200-y:100-y}(i);if(h===0){Re();try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:i,priority:h,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){Re();try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const p=this.tasks[this.taskQueue[h]];p.priority<i&&(i=p.priority,e=h)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class qO{constructor(e,i,a){this.target=e,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Er(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new c7}send(e,i,a,h,p=!1,m){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=m,this.callbacks[y]=a);const b=new Set;return this.target.postMessage({id:y,type:e,hasCallback:!!a,targetMapId:h,mustQueue:p,sourceMapId:this.mapId,data:f(i,b)},b),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(e){const i=e.data,a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[a];delete this.cancelCallbacks[a],h&&h.cancel()}else if(i.mustQueue||Re()){const h=this.callbacks[a],p=this.scheduler.add(()=>this.processTask(a,i),h&&h.metadata||{type:"message"});p&&(this.cancelCallbacks[a]=p)}else this.processTask(a,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(i.error?a(v(i.error)):a(null,v(i.data)))}else{const a=new Set,h=i.hasCallback?(m,y)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?f(m):null,data:f(y,a)},a)}:m=>{},p=v(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,p,h);else if(this.parent.getWorkerSource){const m=i.type.split(".");this.parent.getWorkerSource(i.sourceMapId,m[0],p.source,p.scope)[m[1]](p,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}class Zm{constructor(e,i){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=At();const a=this.workerPool.acquire(this.id);for(let h=0;h<a.length;h++){const p=new Zm.Actor(a[h],i,this.id);p.name=`Worker ${h}`,this.actors.push(p)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,a){Jt(this.actors,(h,p)=>{h.send(e,i,p)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}Zm.Actor=qO;class WO{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new lc({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=gr(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const h=[];let p=e.length%2==1?-e[e.length-1]*a:0,m=e[0]*a,y=!0;h.push({left:p,right:m,isDash:y,zeroLength:e[0]===0});let b=e[0];for(let E=1;E<e.length;E++){y=!y;const C=e[E];p=b*a,b+=C,m=b*a,h.push({left:p,right:m,isDash:y,zeroLength:C===0})}return h}addRoundDash(e,i,a){const h=i/2;for(let p=-a;p<=a;p++){const m=this.width*(this.nextRow+a+p);let y=0,b=e[y];for(let E=0;E<this.width;E++){E/b.right>1&&(b=e[++y]);const C=Math.abs(E-b.left),A=Math.abs(E-b.right),P=Math.min(C,A);let R;const z=p/a*(h+1);if(b.isDash){const B=h-Math.abs(z);R=Math.sqrt(P*P+B*B)}else R=h-Math.sqrt(P*P+z*z);this.image.data[m+E]=Math.max(0,Math.min(255,R+128))}}}addRegularDash(e,i){for(let b=e.length-1;b>=0;--b){const E=e[b],C=e[b+1];E.zeroLength?e.splice(b,1):C&&C.isDash===E.isDash&&(C.left=E.left,e.splice(b,1))}const a=e[0],h=e[e.length-1];a.isDash===h.isDash&&(a.left=h.left-this.width,h.right=a.right+this.width);const p=this.width*this.nextRow;let m=0,y=e[m];for(let b=0;b<this.width;b++){b/y.right>1&&(y=e[++m]);const E=Math.abs(b-y.left),C=Math.abs(b-y.right),A=Math.min(E,C);this.image.data[p+b]=Math.max(0,Math.min(255,(y.isDash?A:-A)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const h=i==="round",p=h?7:0,m=2*p+1;if(this.nextRow+m>this.height)return mr("LineAtlas out of space"),null;e.length===0&&e.push(1);let y=0;for(let C=0;C<e.length;C++)e[C]<0&&(mr("Negative value is found in line dasharray, replacing values with 0"),e[C]=0),y+=e[C];if(y!==0){const C=this.width/y,A=this.getDashRanges(e,this.width,C);h?this.addRoundDash(A,C,p):this.addRegularDash(A,i==="square"?.5*C:0)}const b=this.nextRow+p;this.nextRow+=m;const E={tl:[b,p],br:[y,0]};return this.positions[a]=E,E}}Zt(WO,"LineAtlas");const HO=1*Wa;class ZO{constructor(e){const i={},a=[];for(const y in e){const b=e[y],E=i[y]={};for(const C in b.glyphs){const A=b.glyphs[+C];if(!A||A.bitmap.width===0||A.bitmap.height===0)continue;const P=A.metrics.localGlyph?HO:1,R={x:0,y:0,w:A.bitmap.width+2*P,h:A.bitmap.height+2*P};a.push(R),E[C]=R}}const{w:h,h:p}=bw(a),m=new lc({width:h||1,height:p||1});for(const y in e){const b=e[y];for(const E in b.glyphs){const C=b.glyphs[+E];if(!C||C.bitmap.width===0||C.bitmap.height===0)continue;const A=i[y][E],P=C.metrics.localGlyph?HO:1;lc.copy(C.bitmap,m,{x:0,y:0},{x:A.x+P,y:A.y+P},C.bitmap)}}this.image=m,this.positions=i}}Zt(ZO,"GlyphAtlas");class u7{constructor(e){this.tileID=new so(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=nu(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,i,a,h,p){this.status="parsing",this.data=e,this.collisionBoxArray=new xb;const m=new aP(Object.keys(e.layers).sort()),y=new gw(this.tileID,this.promoteId);y.bucketLayerIDs=[];const b={},E=new WO(256,256),C={featureIndex:y,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:E,availableImages:a,brightness:this.brightness},A=i.familiesBySource[this.source];for(const ae in A){const le=e.layers[ae];if(!le)continue;let he=!1,me=!1,ve=!1;for(const je of A[ae])je[0].type==="symbol"?he=!0:me=!0,je[0].is3D()&&je[0].type!=="model"&&(ve=!0);if(this.extraShadowCaster&&!ve||this.isSymbolTile===!0&&!he||this.isSymbolTile===!1&&!me)continue;le.version===1&&mr(`Vector tile source "${this.source}" layer "${ae}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pe=m.encode(ae),Ne=[];for(let je=0;je<le.length;je++){const Ye=le.feature(je),Ve=y.getId(Ye,ae);Ne.push({feature:Ye,id:Ve,index:je,sourceLayerIndex:Pe})}for(const je of A[ae]){const Ye=je[0];(!this.extraShadowCaster||Ye.is3D()&&Ye.type!=="model")&&(this.isSymbolTile!==void 0&&Ye.type==="symbol"!==this.isSymbolTile||Ye.minzoom&&this.zoom<Math.floor(Ye.minzoom)||Ye.maxzoom&&this.zoom>=Ye.maxzoom||Ye.visibility!=="none"&&(jw(je,this.zoom,C.brightness,a),(b[Ye.id]=Ye.createBucket({index:y.bucketLayerIDs.length,layers:je,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pe,sourceID:this.source,projection:this.projection.spec})).populate(Ne,C,this.tileID.canonical,this.tileTransform),y.bucketLayerIDs.push(je.map(Ve=>Ve.id))))}}let P,R,z,B;E.trim();const V={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},Q=()=>{if(P)return this.status="done",p(P);if(this.extraShadowCaster)this.status="done",p(null,{buckets:wr(b).filter(ae=>!ae.isEmpty()),featureIndex:y,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:C.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(R&&z&&B){const ae=new ZO(R),le=new NP(z,B);for(const he in b){const me=b[he];me instanceof jm?(jw(me.layers,this.zoom,C.brightness,a),s$(me,R,ae.positions,z,le.iconPositions,this.showCollisionBoxes,a,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):me.hasPattern&&(me instanceof Yv||me instanceof Iv||me instanceof Wm)&&(jw(me.layers,this.zoom,C.brightness,a),me.addFeatures(C,this.tileID.canonical,le.patternPositions,a,this.tileTransform,this.brightness))}this.status="done",p(null,{buckets:wr(b).filter(he=>!he.isEmpty()),featureIndex:y,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ae.image,lineAtlas:E,imageAtlas:le,brightness:C.brightness})}};if(!this.extraShadowCaster){const ae=$r(C.glyphDependencies,me=>Object.keys(me).map(Number));Object.keys(ae).length?h.send("getGlyphs",{uid:this.uid,stacks:ae,scope:this.scope},(me,ve)=>{P||(P=me,R=ve,Q())},void 0,!1,V):R={};const le=Object.keys(C.iconDependencies);le.length?h.send("getImages",{icons:le,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(me,ve)=>{P||(P=me,z=ve,Q())},void 0,!1,V):z={};const he=Object.keys(C.patternDependencies);he.length?h.send("getImages",{icons:he,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(me,ve)=>{P||(P=me,B=ve,Q())},void 0,!1,V):B={}}Q()}}function jw(r,e,i,a){const h=new Ae(e,{brightness:i});for(const p of r)p.recalculate(h,a)}class XO{constructor(e){this.entries={},this.scheduler=e}request(e,i,a,h){const p=this.entries[e]=this.entries[e]||{callbacks:[]};if(p.result){const[m,y]=p.result;return this.scheduler?this.scheduler.add(()=>{h(m,y)},i):h(m,y),()=>{}}return p.callbacks.push(h),p.cancel||(p.cancel=a((m,y)=>{p.result=[m,y];for(const b of p.callbacks)this.scheduler?this.scheduler.add(()=>{b(m,y)},i):b(m,y);setTimeout(()=>delete this.entries[e],3e3)})),()=>{p.result||(p.callbacks=p.callbacks.filter(m=>m!==h),p.callbacks.length||(p.cancel(),delete this.entries[e]))}}}function YO(r,e,i){const a=JSON.stringify(r.request);return r.data&&(this.deduped.entries[a]={result:[null,r.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom},h=>{const p=ii(r.request,(m,y,b,E)=>{m?h(m):y&&h(null,{vectorTile:i?void 0:new pw(new Rv(y)),rawData:y,cacheControl:b,expires:E})});return()=>{p.cancel(),h()}},e)}var Xm={workerUrl:"",workerClass:null,workerParams:void 0};function h7(){return Xm.workerClass!=null?new Xm.workerClass:new self.Worker(Xm.workerUrl,Xm.workerParams)}const $w="mapboxgl_preloaded_worker_pool";class Ym{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<Ym.workerCount;)this.workers.push(new h7);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[$w]}numActive(){return Object.keys(this.active).length}}let Qm;function Uw(){return Qm||(Qm=new Ym),Qm}Ym.workerCount=2;let c0,Vw,Za,Gw=null;function QO(){return Re()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:Vw||D.DRACO_URL}const qw=5123,Ww=5126,Hw={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[qw]:Uint16Array,5125:Uint32Array,[Ww]:Float32Array},d7={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[qw]:"DT_UINT16",5125:"DT_UINT32",[Ww]:"DT_FLOAT32"},Zw={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function KO(r,e,i){const a=i.json.bufferViews.length,h=i.buffers.length;e.bufferView=a,i.json.bufferViews[a]={buffer:h,byteLength:r.byteLength},i.buffers[h]=r}const Xw="KHR_draco_mesh_compression";function f7(r,e){const i=r.extensions&&r.extensions[Xw];if(!i)return;const a=new Za.Decoder,h=rD(e,i.bufferView),p=new Za.Mesh;if(!a.DecodeArrayToMesh(h,h.byteLength,p))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[r.indices],y=Hw[m.componentType],b=m.count*y.BYTES_PER_ELEMENT,E=Za._malloc(b);y===Uint16Array?a.GetTrianglesUInt16Array(p,b,E):a.GetTrianglesUInt32Array(p,b,E),KO(Za.memory.buffer.slice(E,E+b),m,e),Za._free(E);for(const C of Object.keys(i.attributes)){const A=a.GetAttributeByUniqueId(p,i.attributes[C]),P=e.json.accessors[r.attributes[C]],R=d7[P.componentType],z=P.count*Zw[P.type]*Hw[P.componentType].BYTES_PER_ELEMENT,B=Za._malloc(z);a.GetAttributeDataArrayForAllPoints(p,A,Za[R],z,B),KO(Za.memory.buffer.slice(B,B+z),P,e),Za._free(B)}a.destroy(),p.destroy(),delete r.extensions[Xw]}const JO=1179937895,eD=new TextDecoder("utf8");function tD(r,e){return new URL(r,e).href}function p7(r,e,i,a){return fetch(tD(r.uri,a)).then(h=>h.arrayBuffer()).then(h=>{e.buffers[i]=h})}function rD(r,e){const i=r.json.bufferViews[e];return new Uint8Array(r.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function m7(r,e,i,a){if(r.uri){const h=tD(r.uri,a);return fetch(h).then(p=>p.blob()).then(p=>createImageBitmap(p)).then(p=>{e.images[i]=p})}if(r.bufferView!==void 0){const h=rD(e,r.bufferView),p=new Blob([h],{type:r.mimeType});return createImageBitmap(p).then(m=>{e.images[i]=m})}}function nD(r,e=0,i){const a={json:null,images:[],buffers:[]};if(new Uint32Array(r,e,1)[0]===JO){const E=new Uint32Array(r,e);let C=2;const A=(E[C++]>>2)-3,P=E[C++]>>2;if(C++,a.json=JSON.parse(eD.decode(E.subarray(C,C+P))),C+=P,C<A){const R=E[C++];C++;const z=e+(C<<2);a.buffers[0]=r.slice(z,z+R)}}else a.json=JSON.parse(eD.decode(new Uint8Array(r,e)));const{buffers:h,images:p,meshes:m,extensionsUsed:y}=a.json;let b=Promise.resolve();if(h){const E=[];for(let C=0;C<h.length;C++){const A=h[C];A.uri?E.push(p7(A,a,C,i)):a.buffers[C]||(a.buffers[C]=null)}b=Promise.all(E)}return b.then(()=>{const E=[],C=y&&y.includes(Xw);if(C&&E.push(function(){if(!Za)return c0||(c0=function(A){let P,R=null;function z(){P=new Uint8Array(R.buffer)}function B(){throw new Error("Unexpected Draco error.")}const V={a:{a:B,d:function(Q,ae,le){return P.copyWithin(Q,ae,ae+le)},c:function(Q){const ae=P.length,le=Math.max(Q>>>0,Math.ceil(1.2*ae)),he=Math.ceil((le-ae)/65536);try{return R.grow(he),z(),!0}catch{return!1}},b:B}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(A,V):A.then(Q=>Q.arrayBuffer()).then(Q=>WebAssembly.instantiate(Q,V))).then(Q=>{const{Rb:ae,Qb:le,P:he,T:me,X:ve,Ja:Pe,La:Ne,Qa:je,Va:Ye,Wa:Ve,eb:ht,jb:Ct,f:st,e:wt,yb:ot,zb:Rt,Ab:Ht,Bb:Tt,Db:hr,Gb:Yt}=Q.instance.exports;R=wt;const Pt=(()=>{let dr=0,rr=0,ar=0,Mt=0;return yr=>{ar&&(ae(Mt),ae(dr),rr+=ar,ar=dr=0),dr||(rr+=128,dr=le(rr));const Zr=yr.length+7&-8;let Mr=dr;Zr>=rr&&(ar=Zr,Mr=Mt=le(Zr));for(let jr=0;jr<yr.length;jr++)P[Mr+jr]=yr[jr];return Mr}})();return z(),st(),{memory:wt,_free:ae,_malloc:le,Mesh:class{constructor(){this.ptr=he()}destroy(){me(this.ptr)}},Decoder:class{constructor(){this.ptr=Pe()}destroy(){Ct(this.ptr)}DecodeArrayToMesh(dr,rr,ar){const Mt=Pt(dr),yr=Ne(this.ptr,Mt,rr,ar.ptr);return!!ve(yr)}GetAttributeByUniqueId(dr,rr){return{ptr:je(this.ptr,dr.ptr,rr)}}GetTrianglesUInt16Array(dr,rr,ar){Ye(this.ptr,dr.ptr,rr,ar)}GetTrianglesUInt32Array(dr,rr,ar){Ve(this.ptr,dr.ptr,rr,ar)}GetAttributeDataArrayForAllPoints(dr,rr,ar,Mt,yr){ht(this.ptr,dr.ptr,rr.ptr,ar,Mt,yr)}},DT_INT8:ot(),DT_UINT8:Rt(),DT_INT16:Ht(),DT_UINT16:Tt(),DT_UINT32:hr(),DT_FLOAT32:Yt()}})}(fetch(QO())),c0.then(A=>{Za=A,c0=void 0}))}()),p)for(let A=0;A<p.length;A++)E.push(m7(p[A],a,A,i));return(E.length?Promise.all(E):Promise.resolve()).then(()=>{if(C&&m)for(const{primitives:A}of m)for(const P of A)f7(P,a);return a})})}class iD{constructor(e,i,a){if(this.triangleCount=i.length/3,this.min=new se(0,0),this.max=new se(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||a===0)return;const h=e.map(C=>C.x),p=e.map(C=>C.y);this.min=new se(Math.min(...h),Math.min(...p)),this.max=new se(Math.max(...h),Math.max(...p));const m=this.max.sub(this.min);m.x=Math.max(m.x,1),m.y=Math.max(m.y,1);const y=Math.max(m.x,m.y)/a;this.cellsX=Math.max(1,Math.ceil(m.x/y)),this.cellsY=Math.max(1,Math.ceil(m.y/y)),this.xScale=1/y,this.yScale=1/y;const b=[];for(let C=0;C<this.triangleCount;C++){const A=e[i[3*C+0]].sub(this.min),P=e[i[3*C+1]].sub(this.min),R=e[i[3*C+2]].sub(this.min),z=cu(Math.floor(Math.min(A.x,P.x,R.x)),this.xScale,this.cellsX),B=cu(Math.floor(Math.max(A.x,P.x,R.x)),this.xScale,this.cellsX),V=cu(Math.floor(Math.min(A.y,P.y,R.y)),this.yScale,this.cellsY),Q=cu(Math.floor(Math.max(A.y,P.y,R.y)),this.yScale,this.cellsY),ae=new se(0,0),le=new se(0,0),he=new se(0,0),me=new se(0,0);for(let ve=V;ve<=Q;++ve){ae.y=le.y=ve*y,he.y=me.y=(ve+1)*y;for(let Pe=z;Pe<=B;++Pe)ae.x=he.x=Pe*y,le.x=me.x=(Pe+1)*y,(ow(A,P,R,ae,le,me)||ow(A,P,R,ae,me,he))&&b.push({cellIdx:ve*this.cellsX+Pe,triIdx:C})}}if(b.length===0)return;b.sort((C,A)=>C.cellIdx-A.cellIdx||C.triIdx-A.triIdx);let E=0;for(;E<b.length;){const C=b[E].cellIdx,A={start:this.payload.length,len:0};for(;E<b.length&&b[E].cellIdx===C;)++A.len,this.payload.push(b[E++].triIdx);this.cells[C]=A}}query(e,i,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let b=0;b<this.lookup.length;b++)this.lookup[b]=0;const h=cu(e.x-this.min.x,this.xScale,this.cellsX),p=cu(i.x-this.min.x,this.xScale,this.cellsX),m=cu(e.y-this.min.y,this.yScale,this.cellsY),y=cu(i.y-this.min.y,this.yScale,this.cellsY);for(let b=m;b<=y;b++)for(let E=h;E<=p;E++){const C=this.cells[b*this.cellsX+E];if(C)for(let A=0;A<C.len;A++){const P=this.payload[C.start+A],R=Math.floor(P/8),z=1<<P%8;if(!(this.lookup[R]&z)&&(this.lookup[R]|=z,a.push(P),a.length===this.triangleCount))return}}}}function cu(r,e,i){return Math.max(0,Math.min(i-1,Math.floor(r*e)))}function Rh(r,e){const i=r.json.bufferViews[e.bufferView];return new Hw[e.componentType](r.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*Zw[e.type])}function g7(r,e,i){const a=r.indices,h=r.attributes,p={};p.indexArray=new vn;const m=e.json.accessors[a],y=m.count/3;p.indexArray.reserve(y);const b=Rh(e,m);for(let P=0;P<y;P++)p.indexArray.emplaceBack(b[3*P],b[3*P+1],b[3*P+2]);p.indexArray._trim(),p.vertexArray=new xh;const E=e.json.accessors[h.POSITION];p.vertexArray.reserve(E.count);const C=Rh(e,E);for(let P=0;P<E.count;P++)p.vertexArray.emplaceBack(C[3*P],C[3*P+1],C[3*P+2]);if(p.vertexArray._trim(),p.aabb=new wi(E.min,E.max),p.centroid=function(P,R){const z=[0,0,0],B=P.length;if(B>0){for(let V=0;V<B;V++){const Q=3*P[V];z[0]+=R[Q],z[1]+=R[Q+1],z[2]+=R[Q+2]}z[0]/=B,z[1]/=B,z[2]/=B}return z}(b,C),h.COLOR_0!==void 0){const P=e.json.accessors[h.COLOR_0],R=Zw[P.type];if(P.componentType===Ww){p.colorArray=R===3?new xh:new un,p.colorArray.reserve(P.count);const z=Rh(e,P);if(R===3)for(let B=0;B<P.count;B++)p.colorArray.emplaceBack(z[3*B],z[3*B+1],z[3*B+2]);else for(let B=0;B<P.count;B++)p.colorArray.emplaceBack(z[4*B],z[4*B+1],z[4*B+2],z[4*B+3]);p.colorArray._trim()}else if(P.componentType===qw&&R===4){p.colorArray=new un,p.colorArray.resize(P.count);const z=Rh(e,P),B=1/65535,V=p.colorArray.float32;for(let Q=0;Q<4*z.length;++Q)V[Q]=z[Q]*B}else mr(`glTF color buffer parsing for accessor ${JSON.stringify(P)} is not supported`)}if(h.NORMAL!==void 0){p.normalArray=new xh;const P=e.json.accessors[h.NORMAL];p.normalArray.reserve(P.count);const R=Rh(e,P);for(let z=0;z<P.count;z++)p.normalArray.emplaceBack(R[3*z],R[3*z+1],R[3*z+2]);p.normalArray._trim()}if(h.TEXCOORD_0!==void 0&&i.length>0){p.texcoordArray=new vm;const P=e.json.accessors[h.TEXCOORD_0];p.texcoordArray.reserve(P.count);const R=Rh(e,P);for(let z=0;z<P.count;z++)p.texcoordArray.emplaceBack(R[2*z],R[2*z+1]);p.texcoordArray._trim()}const A=r.material;return p.material=function(P,R){const{emissiveFactor:z=[0,0,0],alphaMode:B="OPAQUE",alphaCutoff:V=.5,normalTexture:Q,occlusionTexture:ae,emissiveTexture:le,doubleSided:he}=P,{baseColorFactor:me=[1,1,1,1],metallicFactor:ve=1,roughnessFactor:Pe=1,baseColorTexture:Ne,metallicRoughnessTexture:je}=P.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new En(...me),metallicFactor:ve,roughnessFactor:Pe,baseColorTexture:Ne?R[Ne.index]:void 0,metallicRoughnessTexture:je?R[je.index]:void 0},doubleSided:he,emissiveFactor:z,alphaMode:B,alphaCutoff:V,normalTexture:Q?R[Q.index]:void 0,occlusionTexture:ae?R[ae.index]:void 0,emissionTexture:le?R[le.index]:void 0,defined:P.defined===void 0}}(A!==void 0?e.json.materials[A]:{defined:!1},i),h._FEATURE_RGBA4444!==void 0&&(p.featureData=new Uint32Array(Rh(e,e.json.accessors[h._FEATURE_RGBA4444]).buffer)),p}function oD(r,e,i){const{matrix:a,rotation:h,translation:p,scale:m,mesh:y,extras:b,children:E}=r,C={};if(C.matrix=a||s.m.fromRotationTranslationScale([],h||[0,0,0,1],p||[0,0,0],m||[1,1,1]),y!==void 0){C.meshes=i[y];const A=C.anchor=[0,0];for(const P of C.meshes){const{min:R,max:z}=P.aabb;A[0]+=R[0]+z[0],A[1]+=R[1]+z[1]}A[0]=Math.floor(A[0]/C.meshes.length/2),A[1]=Math.floor(A[1]/C.meshes.length/2)}if(b&&(b.id&&(C.id=b.id),b.lights&&(C.lights=function(A){if(!A.length)return[];const P=function(Q){const ae=atob(Q),le=new Uint8Array(ae.length);for(let he=0;he<ae.length;he++)le[he]=ae.codePointAt(he);return le}(A),R=[],z=P.length/24,B=new Uint16Array(P.buffer),V=new Float32Array(P.buffer);for(let Q=0;Q<z;Q++){const ae=B[2*Q*6]/30,le=B[2*Q*6+1]/30,he=B[2*Q*6+10]/100,me=V[6*Q+1],ve=V[6*Q+2],Pe=V[6*Q+3],Ne=V[6*Q+4],je=Pe-me,Ye=Ne-ve,Ve=Math.hypot(je,Ye);R.push({pos:[me+.5*je,ve+.5*Ye,le],normal:[Ye/Ve,-je/Ve,0],width:Ve,height:ae,depth:he,points:[me,ve,Pe,Ne]})}return R}(b.lights))),E){const A=[];for(const P of E)A.push(oD(e.json.nodes[P],e,i));C.children=A}return C}function _7(r){if(r.vertices.length===0||r.indices.length===0)return null;const[e,i]=[r.vertices[0].clone(),r.vertices[0].clone()];for(let m=1;m<r.vertices.length;++m){const y=r.vertices[m];e.x=Math.min(e.x,y.x),e.y=Math.min(e.y,y.y),i.x=Math.max(i.x,y.x),i.y=Math.max(i.y,y.y)}const a=Math.ceil(Math.max(i.x-e.x,i.y-e.y)/256),h=Math.max(8,a),p=new iD(r.vertices,r.indices,h);return{vertices:r.vertices,indices:r.indices,grid:p,min:e,max:i}}function y7(r){if(!r.extras||!r.extras.ground)return null;const e=r.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const a=[];for(const m of i){if(!Array.isArray(m)||m.length!==2)continue;const y=m[0],b=m[1];typeof y=="number"&&typeof b=="number"&&a.push(new se(y,b))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let h=0;for(let m=0;m<a.length;m++){const y=a[m],b=a[(m+1)%a.length],E=a[(m+2)%a.length];h+=(y.x-b.x)*(E.y-b.y)-(E.x-b.x)*(y.y-b.y)}h>0&&a.reverse();const p=Mv(a.flatMap(m=>[m.x,m.y]),[]);return p.length===0?null:{vertices:a,indices:p}}function v7(r){const e=[],i=[];let a=0;for(const h of r){a=e.length;const p=h.vertexArray.float32,m=h.indexArray.uint16;for(let y=0;y<h.vertexArray.length;y++)e.push(new se(p[3*y+0],p[3*y+1]));for(let y=0;y<3*h.indexArray.length;y++)i.push(m[y]+a)}if(i.length%3!=0)return null;for(let h=0;h<i.length;h+=3){const p=e[i[h+0]],m=e[i[h+1]],y=e[i[h+2]];(p.x-m.x)*(y.y-m.y)-(y.x-m.x)*(p.y-m.y)>0&&([i[h+1],i[h+2]]=[i[h+2],i[h+1]])}return{vertices:e,indices:i}}function sD(r){const e=function(b,E){const C=[],A=WebGL2RenderingContext;if(b.json.textures)for(const P of b.json.textures){const R={magFilter:A.LINEAR,minFilter:A.NEAREST,wrapS:A.REPEAT,wrapT:A.REPEAT};P.sampler!==void 0&&Object.assign(R,b.json.samplers[P.sampler]),C.push({image:E[P.source],sampler:R,uploaded:!1})}return C}(r,r.images),i=function(b,E){const C=[];for(const A of b.json.meshes){const P=[];for(const R of A.primitives)P.push(g7(R,b,E));C.push(P)}return C}(r,e),{scenes:a,scene:h,nodes:p}=r.json,m=a?a[h||0].nodes:p,y=[];for(const b of m)y.push(oD(p[b],r,i));return function(b,E,C){const A={},P=new Set;for(let R=0;R<b.length;R++){const z=C[E[R]];if(!z.extras)continue;const B=z.extras["mapbox:footprint:version"],V=z.extras["mapbox:footprint:id"];(B||V)&&P.add(R),B==="1.0.0"&&V&&(A[V]=R)}for(let R=0;R<b.length;R++){if(P.has(R))continue;const z=b[R],B=C[E[R]];if(!B.extras)continue;let V=null;z.id in A&&(V=v7(b[A[z.id]].meshes)),V||(V=y7(B)),V&&(z.footprint=_7(V))}if(P.size>0){const R=Array.from(P.values()).sort((z,B)=>z-B);for(let z=R.length-1;z>=0;z--)b.splice(R[z],1)}}(y,m,r.json.nodes),y}function x7(r){r.heightmap=new Float32Array(4096),r.heightmap.fill(-1);const e=r.vertexArray.float32,i=r.aabb.min[0]-1,a=r.aabb.min[1]-1,h=Oh/(r.aabb.max[0]-i+2),p=Oh/(r.aabb.max[1]-a+2);for(let m=0;m<e.length;m+=3){const y=e[m+2],b=(e[m+0]-i)*h|0,E=(e[m+1]-a)*p|0;y>r.heightmap[E*Oh+b]&&(r.heightmap[E*Oh+b]=y)}}function b7(r,e){const i={};i.indexArray=new vn,i.indexArray.reserve(4*r.length),i.vertexArray=new xh,i.vertexArray.reserve(10*r.length),i.colorArray=new un,i.vertexArray.reserve(10*r.length);let a=0;for(const m of r){const y=Math.min(10,Math.max(4,1.3*m.height))*e,b=[-m.normal[1],m.normal[0],0],E=Math.min(.29,.1*m.width/m.depth),C=m.width-2*m.depth*e*(E+.01),A=s.v.scaleAndAdd([],m.pos,b,C/2),P=s.v.scaleAndAdd([],m.pos,b,-C/2),R=[A[0],A[1],A[2]+m.height],z=[P[0],P[1],P[2]+m.height],B=s.v.scaleAndAdd([],m.normal,b,E);s.v.scale(B,B,y);const V=s.v.scaleAndAdd([],m.normal,b,-E);s.v.scale(V,V,y),s.v.add(B,A,B),s.v.add(V,P,V),A[2]+=.1,P[2]+=.1,i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(V[0],V[1],V[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(R[0],R[1],R[2]),i.vertexArray.emplaceBack(z[0],z[1],z[2]),i.vertexArray.emplaceBack(A[0],A[1],A[2]),i.vertexArray.emplaceBack(P[0],P[1],P[2]),i.vertexArray.emplaceBack(B[0],B[1],B[2]),i.vertexArray.emplaceBack(V[0],V[1],V[2]);const Q=C/y/2;i.colorArray.emplaceBack(-Q-E,-1,Q,.8),i.colorArray.emplaceBack(Q+E,-1,Q,.8),i.colorArray.emplaceBack(-Q,0,Q,1.3),i.colorArray.emplaceBack(Q,0,Q,1.3),i.colorArray.emplaceBack(Q+E,-.8,Q,.7),i.colorArray.emplaceBack(Q+E,-.8,Q,.7),i.colorArray.emplaceBack(0,0,Q,1.3),i.colorArray.emplaceBack(0,0,Q,1.3),i.colorArray.emplaceBack(Q+E,-1.2,Q,.8),i.colorArray.emplaceBack(Q+E,-1.2,Q,.8),i.indexArray.emplaceBack(6+a,4+a,8+a),i.indexArray.emplaceBack(7+a,9+a,5+a),i.indexArray.emplaceBack(0+a,1+a,2+a),i.indexArray.emplaceBack(1+a,3+a,2+a),a+=10}const h={defined:!0,emissiveFactor:[0,0,0]},p={};return p.baseColorFactor=En.white,h.pbrMetallicRoughness=p,i.material=h,i.aabb=new wi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}Zt(iD,"TriangleGridIndex");const aD=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Yw{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=a>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const p=aD[15&a];if(!p)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[y]=new Uint32Array(e,4,1);return new Yw(y,m,p,e)}constructor(e,i=64,a=Float64Array,h){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const p=aD.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,y=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-y%8)%8;if(p<0)throw new Error(`Unexpected typed array class: ${a}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+y+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+y+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+p]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=i,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Qw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,a,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:p,coords:m,nodeSize:y}=this,b=[0,p.length-1,0],E=[];for(;b.length;){const C=b.pop()||0,A=b.pop()||0,P=b.pop()||0;if(A-P<=y){for(let V=P;V<=A;V++){const Q=m[2*V],ae=m[2*V+1];Q>=e&&Q<=a&&ae>=i&&ae<=h&&E.push(p[V])}continue}const R=P+A>>1,z=m[2*R],B=m[2*R+1];z>=e&&z<=a&&B>=i&&B<=h&&E.push(p[R]),(C===0?e<=z:i<=B)&&(b.push(P),b.push(R-1),b.push(1-C)),(C===0?a>=z:h>=B)&&(b.push(R+1),b.push(A),b.push(1-C))}return E}within(e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:p,nodeSize:m}=this,y=[0,h.length-1,0],b=[],E=a*a;for(;y.length;){const C=y.pop()||0,A=y.pop()||0,P=y.pop()||0;if(A-P<=m){for(let V=P;V<=A;V++)cD(p[2*V],p[2*V+1],e,i)<=E&&b.push(h[V]);continue}const R=P+A>>1,z=p[2*R],B=p[2*R+1];cD(z,B,e,i)<=E&&b.push(h[R]),(C===0?e-a<=z:i-a<=B)&&(y.push(P),y.push(R-1),y.push(1-C)),(C===0?e+a>=z:i+a>=B)&&(y.push(R+1),y.push(A),y.push(1-C))}return b}}function Qw(r,e,i,a,h,p){if(h-a<=i)return;const m=a+h>>1;lD(r,e,m,a,h,p),Qw(r,e,i,a,m-1,1-p),Qw(r,e,i,m+1,h,1-p)}function lD(r,e,i,a,h,p){for(;h>a;){if(h-a>600){const E=h-a+1,C=i-a+1,A=Math.log(E),P=.5*Math.exp(2*A/3),R=.5*Math.sqrt(A*P*(E-P)/E)*(C-E/2<0?-1:1);lD(r,e,i,Math.max(a,Math.floor(i-C*P/E+R)),Math.min(h,Math.floor(i+(E-C)*P/E+R)),p)}const m=e[2*i+p];let y=a,b=h;for(Km(r,e,a,i),e[2*h+p]>m&&Km(r,e,a,h);y<b;){for(Km(r,e,y,b),y++,b--;e[2*y+p]<m;)y++;for(;e[2*b+p]>m;)b--}e[2*a+p]===m?Km(r,e,a,b):(b++,Km(r,e,b,h)),b<=i&&(a=b+1),i<=b&&(h=b-1)}}function Km(r,e,i,a){Kw(r,i,a),Kw(e,2*i,2*a),Kw(e,2*i+1,2*a+1)}function Kw(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}function cD(r,e,i,a){const h=r-i,p=e-a;return h*h+p*p}s.$=45,s.A=_i,s.B=function(r){const e=s.m.identity(new Float64Array(16));s.m.multiply(e,r.pixelMatrix,r.globeMatrix);const i=[0,ya,0],a=[0,va,0];return s.v.transformMat4(i,i,e),s.v.transformMat4(a,a,e),[i[0]>0&&i[0]<=r.width&&i[1]>0&&i[1]<=r.height&&!Yb(r,new hn(r.center.lat,90)),a[0]>0&&a[0]<=r.width&&a[1]>0&&a[1]<=r.height&&!Yb(r,new hn(r.center.lat,-90))]},s.C=En,s.D=Yc,s.E=wl,s.F=Vb,s.G=Tk,s.H=El,s.I=kh,s.J=kt,s.K=function(r,e){const{scale:i}=r.tileTransform,a=i*kt/(r.tileSize*Math.pow(2,e.zoom-r.tileID.overscaledZ+r.tileID.canonical.z));return s.h.scale(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},s.L=hn,s.M=Eo,s.N=e0,s.O=so,s.P=se,s.Q=rO,s.R=$b,s.S=function(r){const e=rO(r,!0);return s.h.invert([],[e[0],e[1],e[4],e[5]])},s.T=Ub,s.U=bk,s.V=function(r){const{x:e,y:i}=r.point,{lng:a,lat:h}=r._center;return Ok(e,i,r.worldSize,a,h)},s.W=Js,s.X=mr,s.Y=De,s.Z=Gb,s._=function(r){const e=Math.round((r+45+360)%360/90)%4;return nt[e]},s.a=ba,s.a$=uv,s.a0=Kb,s.a1=function(r,e){return $n(or(r,{type:"json"}),e)},s.a2=Fn,s.a3=ke,s.a4=ji,s.a5=Ks,s.a6=Ri,s.a7=$s,s.a8=Po,s.a9=hc,s.aA=Ih,s.aB=Fk,s.aC=Qs,s.aD=XO,s.aE=Bt,s.aF=YO,s.aG=function(r){jn++,jn>Gr&&(r.getActor().send("enforceCacheSizeLimit",fr),jn=0)},s.aH=Kr,s.aI=jc,s.aJ=function(r){return r<=1?1:Math.pow(2,Math.floor(Math.log(r)/Math.LN2))},s.aK=GO,s.aL=function(r,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<r.length;a++){const h=document.createElement("source");no(r[a])||(i.crossOrigin="Anonymous"),h.src=r[a],i.appendChild(h)}return{cancel:()=>{}}},s.aM=qt,s.aN=Qv,s.aO=function(r){return fetch(r).then(e=>e.arrayBuffer()).then(e=>nD(e,0,r))},s.aP=sD,s.aQ=class{constructor(r,e,i,a){this.id=r,this.position=e!=null?new hn(e[0],e[1]):new hn(0,0),this.orientation=i??[0,0,0],this.nodes=a,this.uploaded=!1,this.aabb=new wi([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(r,e){if(s.m.multiply(r.matrix,e,r.matrix),r.meshes)for(const i of r.meshes){const a=wi.applyTransform(i.aabb,r.matrix);this.aabb.encapsulate(a)}if(r.children)for(const i of r.children)this._applyTransformations(i,r.matrix)}computeBoundsAndApplyParent(){const r=s.m.identity([]);for(const e of this.nodes)this._applyTransformations(e,r)}_positionModelOnTerrain(r,e){const i=r.elevation;if(!i)return 0;const a=wi.projectAabbCorners(this.aabb,this.matrix),h=Qo(1,this.position.lat)*r.worldSize,p=function(V,Q){const ae=[0,0,1],le=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const he of le){const me=V[he.corners[0]],ve=V[he.corners[1]],Pe=V[he.corners[2]],Ne=[ve[0]-me[0],ve[1]-me[1],Q*(ve[2]-me[2])],je=s.v.cross(Ne,Ne,[Pe[0]-me[0],Pe[1]-me[1],Q*(Pe[2]-me[2])]);s.v.normalize(je,je),he.dotProductWithUp=s.v.dot(je,ae)}return le.sort((he,me)=>he.dotProductWithUp-me.dotProductWithUp),le[0].corners}(a,h),m=a[p[0]],y=a[p[1]],b=a[p[2]],E=a[p[3]],C=i.getAtPointOrZero(new Eo(m[0]/r.worldSize,m[1]/r.worldSize),0),A=i.getAtPointOrZero(new Eo(y[0]/r.worldSize,y[1]/r.worldSize),0),P=i.getAtPointOrZero(new Eo(b[0]/r.worldSize,b[1]/r.worldSize),0),R=i.getAtPointOrZero(new Eo(E[0]/r.worldSize,E[1]/r.worldSize),0),z=(C+R)/2,B=(A+P)/2;return z>B?A<P?t0(e,y,E,m,A,R,C,h):t0(e,b,m,E,P,C,R,h):C<R?t0(e,m,y,b,C,A,P,h):t0(e,E,b,y,R,P,A,h),Math.max(z,B)}computeModelMatrix(r,e,i,a,h,p,m=!1){const y=r.transform,b=y.zoom,E=y.project(this.position),C=Mh(this.position.lat,b),A=1/C;s.m.identity(this.matrix),s.m.translate(this.matrix,this.matrix,[E.x+a[0]*A,E.y+a[1]*A,a[2]]);let P=1,R=1;const z=y.worldSize;if(m){if(y.projection.name==="mercator"){let ae=0;y.elevation&&(ae=y.elevation.getAtPointOrZero(new Eo(E.x/z,E.y/z),0));const le=s.e.transformMat4([],[E.x,E.y,ae,1],y.projMatrix)[3]/y.cameraToCenterDistance;P=le,R=le*Mh(y.center.lat,b)}else if(y.projection.name==="globe"){const ae=lO(this.matrix,y),le=s.m.multiply([],y.projMatrix,ae),he=[0,0,0,1];s.e.transformMat4(he,he,le);const me=he[3]/y.cameraToCenterDistance,ve=ac(b),Pe=y.projection.pixelsPerMeter(this.position.lat,z)*Mh(this.position.lat,b),Ne=y.projection.pixelsPerMeter(y.center.lat,z)*Mh(y.center.lat,b);P=me/Fr(Pe,zk(y.center.lat),ve),R=me*C/Pe,P*=Ne,R*=Ne}}else P=A;s.m.scale(this.matrix,this.matrix,[P,P,R]);const B=[...this.matrix],V=this.orientation,Q=[];if(aO(Q,[V[0]+e[0],V[1]+e[1],V[2]+e[2]],i),s.m.multiply(this.matrix,B,Q),h&&y.elevation){let ae=0;const le=[];if(p&&y.elevation){ae=this._positionModelOnTerrain(y,le);const he=s.m.fromQuat([],le),me=s.m.multiply([],he,Q);s.m.multiply(this.matrix,B,me)}else ae=y.elevation.getAtPointOrZero(new Eo(E.x/z,E.y/z),0);ae!==0&&(this.matrix[14]+=ae)}}upload(r){if(!this.uploaded){for(const e of this.nodes)zw(e,r);for(const e of this.nodes)n0(e);this.uploaded=!0}}destroy(){for(const r of this.nodes)i0(r)}},s.aR=Er,s.aS=["type","source","source-layer","minzoom","maxzoom","filter","layout"],s.aT=zP,s.aU=jk,s.aV=po,s.aW=UP,s.aX=Tw,s.aY=xw,s.aZ=Yw,s.a_=bm,s.aa=bw,s.ab=ww,s.ac=pt,s.ad=ye,s.ae=Ge,s.af=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return xe(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Fr(r.x,e.x,i),y:Fr(r.y,e.y,i),z:Fr(r.z,e.z,i),azimuthal:Fr(r.azimuthal,e.azimuthal,i),polar:Fr(r.polar,e.polar,i)}}},s.ag=He,s.ah=r=>Ws(fm(r)),s.ai=sv,s.aj=_m,s.ak=or,s.al=Ae,s.am=mh,s.an=Gt,s.ao=ac,s.ap=r=>Ws(gm(r)),s.aq=Pd,s.ar=dt,s.as=class{constructor(r){this.specification=r}possiblyEvaluate(r,e){return function([i,a]){const h=xe([1,i,a]);return{x:h.x,y:h.y,z:h.z}}(r.expression.evaluate(e))}interpolate(r,e,i){return{x:Fr(r.x,e.x,i),y:Fr(r.y,e.y,i),z:Fr(r.z,e.z,i)}}},s.at=function(r,e,i=0,a=!0){const h=new se(i,i),p=r.sub(h),m=e.add(h),y=[p,new se(m.x,p.y),m,new se(p.x,m.y)];return a&&y.push(p.clone()),y},s.au=function(r,e){const i=[];for(let a=0;a<r.length;a++){const h=Vt(a-1,-1,r.length-1),p=Vt(a+1,-1,r.length-1),m=r[a],y=r[p],b=r[h].sub(m).unit(),E=y.sub(m).unit(),C=E.angleWithSep(b.x,b.y),A=b.add(E).unit().mult(-1*e/Math.sin(C/2));i.push(m.add(A))}return i},s.av=WP,s.aw=Gk,s.ax=function(r,e,i=0){return s.v.fromValues(((e.x-i)*r.scale-r.x)*kt,(e.y*r.scale-r.y)*kt,Lk(e.z,e.y))},s.ay=sO,s.az=function(r){let e=1/0,i=1/0,a=-1/0,h=-1/0;for(const p of r)e=Math.min(e,p.x),i=Math.min(i,p.y),a=Math.max(a,p.x),h=Math.max(h,p.y);return{min:new se(e,i),max:new se(a,h)}},s.b=Qo,s.b$=0,s.b0=bh,s.b1=iA,s.b2=Yo,s.b3=function(r,e,i){const a=Math.sqrt(r*r+e*e+i*i),h=a>0?Math.acos(i/a)*We:0;let p=r!==0||e!==0?Math.atan2(-e,-r)*We+90:0;return p<0&&(p+=360),[a,p,h]},s.b4=hf,s.b5=Ha,s.b6=Ow,s.b7=Eb,s.b8=class extends ec{constructor(r){super(r),this.current=Yj}set(r,e,i){if(this.fetchUniformLocation(r,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},s.b9=nA,s.bA=function(r,e){const i=[0,0,0],a=Mm(bl(e.canonical));return s.v.transformMat4(i,i,a),s.v.transformMat4(i,i,r),i},s.bB=r=>({u_camera_to_center_distance:new Yo(r),u_extrude_scale:new Sb(r),u_device_pixel_ratio:new Yo(r),u_matrix:new bm(r),u_inv_rot_matrix:new bm(r),u_merc_center:new bh(r),u_tile_id:new Eb(r),u_zoom_transition:new Yo(r),u_up_dir:new Eb(r),u_emissive_strength:new Yo(r)}),s.bC=r=>({u_matrix:new bm(r),u_pixels_to_tile_units:new Sb(r),u_device_pixel_ratio:new Yo(r),u_units_to_pixels:new bh(r),u_dash_image:new uv(r),u_gradient_image:new uv(r),u_image_height:new Yo(r),u_texsize:new bh(r),u_tile_units_to_pixels:new Yo(r),u_alpha_discard_threshold:new Yo(r),u_trim_offset:new bh(r),u_emissive_strength:new Yo(r)}),s.bD=r=>({u_matrix:new bm(r),u_texsize:new bh(r),u_pixels_to_tile_units:new Sb(r),u_device_pixel_ratio:new Yo(r),u_image:new uv(r),u_units_to_pixels:new bh(r),u_tile_units_to_pixels:new Yo(r),u_alpha_discard_threshold:new Yo(r)}),s.bE=ja,s.bF=V8,s.bG=G8,s.bH=Hk,s.bI=(r,e,i,a,h,p)=>{const m=r.transform,y=m.projection.name==="globe";let b;if(p.paint.get("circle-pitch-alignment")==="map")if(y){const C=Pk(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;b=Float32Array.from([C,0,0,C])}else b=m.calculatePixelsToTileUnitsMatrix(i);else b=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const E={u_camera_to_center_distance:r.transform.getCameraToCenterDistance(m.projection),u_matrix:r.translatePosMatrix(e.projMatrix,i,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_device_pixel_ratio:ji.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:B6,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:p.paint.get("circle-emissive-strength")};if(y){E.u_inv_rot_matrix=a,E.u_merc_center=h,E.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],E.u_zoom_transition=ac(m.zoom);const C=h[0]*kt,A=h[1]*kt;E.u_up_dir=m.projection.upVector(new Th(0,0,0),C,A)}return E},s.bJ=BO,s.bK=(r,e,i,a,h)=>{const p=r.transform;return{u_matrix:FO(r,e,i,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:p.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:h,u_image:0,u_tile_units_to_pixels:NO(e,p),u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}},s.bL=(r,e,i,a,h,p,m)=>{const y=r.transform,b=y.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:FO(r,e,i,a),u_pixels_to_tile_units:b,u_device_pixel_ratio:p,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:jO(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:NO(e,r.transform),u_alpha_discard_threshold:0,u_trim_offset:m,u_emissive_strength:i.paint.get("line-emissive-strength")}},s.bM=gr,s.bN=wv,s.bO=OO,s.bP=E6,s.bQ=Wm,s.bR=lu,s.bS=450,s.bT=7,s.bU=Mk,s.bV=Zb,s.bW=tr,s.bX=xh,s.bY=vh,s.bZ=1,s.b_=771,s.ba=It,s.bb=function(r,e,i){const a=ac(i.zoom),h=r.style.map._antialias,p=e.options.extStandardDerivativesForceOff||r.terrain&&r.terrain.exaggeration()>0;return a===0&&!h&&!p},s.bc=function(r){const e=r.pixelsPerMeter,i=e/Qo(1,r.center.lat),a=s.m.identity(new Float64Array(16));return s.m.translate(a,a,[r.point.x,r.point.y,0]),s.m.scale(a,a,[i,i,e]),Float32Array.from(a)},s.bd=yo,s.be=gv,s.bf=function(r){const e=_i-5;r=rt(r,-e,e)/e*90;const i=Math.pow(Math.abs(Math.sin(ze(r))),3);return Math.round(i*(qb.length-1))},s.bg=function(r,e,i,a){const h=e.getNorth(),p=e.getSouth(),m=e.getWest(),y=e.getEast(),b=1<<r.z,E=y-m,C=h-p,A=E/Xd,P=-C/qb[i],R=[0,A,0,P,0,0,h,m,0];if(r.z>0){const z=180/a;s.bx.multiply(R,R,[z/E+1,0,0,0,z/C+1,0,-.5*z/A,.5*z/P,1])}return R[2]=b,R[5]=r.x,R[8]=r.y,R},s.bh=Mm,s.bi=bl,s.bj=function(r,e,i){const a=s.m.identity(new Float64Array(16)),h=(e/(1<<r)-.5)*Math.PI*2;return s.m.rotateY(a,i.globeMatrix,h),Float32Array.from(a)},s.bk=class{isDataAvailableAtPoint(r){const e=this._source();if(this.isUsingMockSource()||!e||r.y<0||r.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,h=Math.floor(r.x),p=Math.floor((r.x-h)*a),m=Math.floor(r.y*a),y=this.findDEMTileFor(new so(i,h,i,p,m));return!(!y||!y.dem)}getAtPointOrZero(r,e=0){return this.getAtPoint(r,e)||0}getAtPoint(r,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||r.y<0||r.y>1)return e;const h=a.getSource().maxzoom,p=1<<h,m=Math.floor(r.x),y=r.x-m,b=new so(h,m,h,Math.floor(y*p),Math.floor(r.y*p)),E=this.findDEMTileFor(b);if(!E||!E.dem)return e;const C=E.dem,A=1<<E.tileID.canonical.z,P=(y*A-E.tileID.canonical.x)*C.dim,R=(r.y*A-E.tileID.canonical.y)*C.dim,z=Math.floor(P),B=Math.floor(R);return(i?this.exaggeration():1)*Fr(Fr(C.get(z,B),C.get(z,B+1),R-B),Fr(C.get(z+1,B),C.get(z+1,B+1),R-B),P-z)}getAtTileOffset(r,e,i){const a=1<<r.canonical.z;return this.getAtPointOrZero(new Eo(r.wrap+(r.canonical.x+e/kt)/a,(r.canonical.y+i/kt)/a))}getAtTileOffsetFunc(r,e,i,a){return h=>{const p=this.getAtTileOffset(r,h.x,h.y),m=a.upVector(r.canonical,h.x,h.y),y=a.upVectorScale(r.canonical,e,i).metersToTile;return s.v.scale(m,m,p*y),m}}getForTilePoints(r,e,i,a){if(this.isUsingMockSource())return!1;const h=nf.create(this,r,a);return!!h&&(e.forEach(p=>{p[2]=this.exaggeration()*h.getElevationAt(p[0],p[1],i)}),!0)}getMinMaxForTile(r){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(r);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,h=1<<r.canonical.z-a.canonical.z;let p=r.canonical.x/h-a.canonical.x,m=r.canonical.y/h-a.canonical.y,y=0;for(let b=0;b<r.canonical.z-a.canonical.z&&!i.leaves[y];b++){p*=2,m*=2;const E=2*Math.floor(m)+Math.floor(p);y=i.childOffsets[y]+E,p%=1,m%=1}return{min:this.exaggeration()*i.minimums[y],max:this.exaggeration()*i.maximums[y]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(r,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(r){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(r){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const r=this.visibleDemTiles;if(r.length===0)return null;let e=!1,i=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const h of r){const p=this.getMinMaxForTile(h.tileID);p&&(i=Math.min(i,p.min),a=Math.max(a,p.max),e=!0)}return e?{min:i,max:a}:null}},s.bl=Em,s.bm=Qn,s.bn=mv,s.bo=Cr,s.bp=vn,s.bq=Ph,s.br=Zm,s.bs=Uw,s.bt=kw,s.bu=Jk,s.bv=function(r,e){return[Math.pow(r[0],2.2)*e,Math.pow(r[1],2.2)*e,Math.pow(r[2],2.2)*e]},s.bw=function(r){return[Math.pow(r[0],1/2.2),Math.pow(r[1],1/2.2),Math.pow(r[2],1/2.2)]},s.by=Pk,s.bz=256,s.c=rt,s.c$=I,s.c0=gb,s.c1=function(r,e,i,a,h){return rt((r-e)/(i-e)*(h-a)+a,a,h)},s.c2=ch,s.c3=wi,s.c4=Mh,s.c5=lO,s.c6=[1,1,1],s.c7=nf,s.c8=r0,s.c9=zo,s.cA=Xr,s.cB=r=>Ws(mm(r)),s.cC=ce,s.cD=$n,s.cE=Ot,s.cF=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},s.cG=bt,s.cH=Nk,s.cI=Ch,s.cJ=function([r,e,i]){const a=Math.hypot(r,e,i),h=Math.atan2(r,i),p=.5*Math.PI-Math.acos(-e/a);return new hn(De(h),De(p))},s.cK=Ps,s.cL=Im,s.cM=D,s.cN=Yb,s.cO=Dk,s.cP=function(r){const e=[0,0,0],i=s.m.identity(new Float64Array(16));return s.m.multiply(i,r.pixelMatrix,r.globeMatrix),s.v.transformMat4(e,e,i),new se(e[0],e[1])},s.cQ=function(r){const e=r.navigator?r.navigator.userAgent:null;return!!function(i){if(gt==null){const a=i.navigator?i.navigator.userAgent:null;gt=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return gt}(r)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},s.cR=At,s.cS=class{constructor(r,e,i){this._transformRequestFn=r,this._customAccessToken=e,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){const r=function(){let e="";for(let i=0;i<10;i++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",q,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,e){return this._transformRequestFn&&this._transformRequestFn(r,e)||{url:r}}normalizeStyleURL(r,e){if(!Ze(r))return r;const i=_t(r);return i.params.push(`sdk=js-${I}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeGlyphsURL(r,e){if(!Ze(r))return r;const i=_t(r);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeModelURL(r,e){if(!Ze(r))return r;const i=_t(r);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||e)}normalizeSourceURL(r,e,i,a){if(!Ze(r))return r;const h=_t(r);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),i&&h.params.push(`language=${i}`),a&&h.params.push(`worldview=${a}`),this._makeAPIURL(h,this._customAccessToken||e)}normalizeSpriteURL(r,e,i,a){const h=_t(r);return Ze(r)?(h.path=`/styles/v1${h.path}/sprite${e}${i}`,this._makeAPIURL(h,this._customAccessToken||a)):(h.path+=`${e}${i}`,Ft(h))}normalizeTileURL(r,e,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!Ze(r))return r;const a=_t(r);a.path=a.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||i&&a.authority!=="raster"&&i===512?"@2x":""}${N.supported?".webp":"$1"}`),a.authority==="raster"?a.path=`/${D.RASTER_URL_PREFIX}${a.path}`:(a.path=a.path.replace(/^.+\/v4\//,"/"),a.path=`/${D.TILE_URL_VERSION}${a.path}`);const h=this._customAccessToken||function(p){for(const m of p){const y=m.match(/^access_token=(.*)$/);if(y)return y[1]}return null}(a.params)||D.ACCESS_TOKEN;return D.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&a.params.push(`sku=${this._skuToken}`),this._makeAPIURL(a,h)}canonicalizeTileURL(r,e){const i=_t(r);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return r;let a="mapbox://";i.path.match(/^\/raster\/v1\//)?a+=`raster/${i.path.replace(`/${D.RASTER_URL_PREFIX}/`,"")}`:a+=`tiles/${i.path.replace(`/${D.TILE_URL_VERSION}/`,"")}`;let h=i.params;return e&&(h=h.filter(p=>!p.match(/^access_token=/))),h.length&&(a+=`?${h.join("&")}`),a}canonicalizeTileset(r,e){const i=!!e&&Ze(e),a=[];for(const h of r.tiles||[])tt(h)?a.push(this.canonicalizeTileURL(h,i)):a.push(h);return a}_makeAPIURL(r,e){const i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",a=_t(D.API_URL);if(r.protocol=a.protocol,r.authority=a.authority,r.protocol==="http"){const h=r.params.indexOf("secure");h>=0&&r.params.splice(h,1)}if(a.path!=="/"&&(r.path=`${a.path}${r.path}`),!D.REQUIRE_ACCESS_TOKEN)return Ft(r);if(e=e||D.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(e[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return r.params=r.params.filter(h=>h.indexOf("access_token")===-1),r.params.push(`access_token=${e||""}`),Ft(r)}},s.cT=function(r,e){e?Bn.add(r):Bn.delete(r)},s.cU=N,s.cV=fi,s.cW=si,s.cX=Ue,s.cY=Zn,s.cZ=function(r){Bn.delete(r)},s.c_=Jt,s.ca=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(r){const e=yO(new se(0,0),new se(kt,kt),r),i=[];for(const a of this._activeRegions){if(a.hiddenByOverlap||!_O(e,a))continue;const h=j$(a.min,a.max,r);i.push({min:h.min,max:h.max,sourceId:this._sourceIds[a.priority],footprint:a.footprint,footprintTileId:a.tileId})}return i}setSources(r){this._setSources(r.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const a of e.cache.getVisibleCoordinates()){const h=e.cache.getTile(a).buckets[e.layer];if(h)for(const p of h.getNodesInfo()){const m=p.node;m.footprint&&i.push({footprint:m.footprint,id:a.toUnwrapped()})}}return i}})))}_addSource(r){const e=r.getFootprints();if(e.length!==0){for(const i of e){if(!i.footprint)continue;const a=yO(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:a.min,max:a.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(r.getSourceId())}}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||o0(e.min,i.min)||o0(e.max,i.max));let r=this._activeRegions.length!==this._prevRegions.length;if(!r){let e=0,i=0;for(;!r&&e!==this._activeRegions.length;){const a=this._activeRegions[e],h=this._prevRegions[i];r=a.priority!==h.priority||!gO(a,h),++e,++i}}if(r){++this._updateTime;const e=i=>{const a=this._activeRegions;if(i>=a.length)return i;const h=a[i].priority;for(;i<a.length&&a[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,a=e(i);for(;i!==a;){let h=i;const p=i;for(;h!==a;){const m=this._activeRegions[h];m.hiddenByOverlap=!1;for(let y=0;y<p;y++){const b=this._activeRegions[y];if(!b.hiddenByOverlap&&_O(m,b)&&(m.hiddenByOverlap=xO(m.footprint,m.tileId,b.footprint,b.tileId),m.hiddenByOverlap))break}++h}i=a,a=e(i)}}}}_setSources(r){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=r.length-1;e>=0;e--)this._addSource(r[e]);this._computeReplacement()}},s.cb=gn,s.cc=Jv,s.cd=ym,s.ce=class{constructor(r){this._createGrid(r),this._createPoles(r)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const r of this._poleSegments)r.destroy();for(const r of this._gridSegments)r.withSkirts.destroy(),r.withoutSkirts.destroy()}_fillGridMeshWithLods(r,e){const i=new Cr,a=new vn,h=[],p=r+1+2,m=e[0]+1,y=e[0]+1+(1+e.length),b=(E,C,A)=>{let P=E===p-1?E-2:E===0?E:E-1;return P+=A?24575:0,[P,C]};for(let E=0;E<p;++E)i.emplaceBack(...b(E,0,!0));for(let E=0;E<m;++E)for(let C=0;C<p;++C)i.emplaceBack(...b(C,E,(C===0||C===p-1)&&!0));for(let E=0;E<e.length;++E){const C=e[E];for(let A=0;A<p;++A)i.emplaceBack(...b(A,C,!0))}for(let E=0;E<e.length;++E){const C=a.length,A=e[E]+1+2,P=new vn;for(let B=0;B<A-1;B++){const V=B===A-2,Q=V?p*(y-e.length+E-B):p;for(let ae=0;ae<p-1;ae++){const le=B*p+ae;B===0||V||ae===0||ae===p-2?(P.emplaceBack(le+1,le,le+Q),P.emplaceBack(le+Q,le+Q+1,le+1)):(a.emplaceBack(le+1,le,le+Q),a.emplaceBack(le+Q,le+Q+1,le+1))}}const R=Qn.simpleSegment(0,C,i.length,a.length-C);for(let B=0;B<P.uint16.length;B+=3)a.emplaceBack(P.uint16[B],P.uint16[B+1],P.uint16[B+2]);const z=Qn.simpleSegment(0,C,i.length,a.length-C);h.push({withoutSkirts:R,withSkirts:z})}return{vertices:i,indices:a,segments:h}}_createGrid(r){const e=this._fillGridMeshWithLods(Xd,qb);this._gridSegments=e.segments,this._gridBuffer=r.createVertexBuffer(e.vertices,Em.members),this._gridIndexBuffer=r.createIndexBuffer(e.indices,!0)}_createPoles(r){const e=new vn;for(let m=0;m<=Xd;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=r.createIndexBuffer(e,!0);const i=new vh,a=new vh,h=new vh,p=new vh;this._poleSegments=[];for(let m=0,y=0;m<Gb;m++){const b=360/(1<<m);i.emplaceBack(0,-Qs,0,.5,0),a.emplaceBack(0,-Qs,0,.5,1),h.emplaceBack(0,-Qs,0,.5,.5),p.emplaceBack(0,-Qs,0,.5,.5);for(let E=0;E<=Xd;E++){let C=E/Xd,A=0;const P=Fr(0,b,C),[R,z,B]=Yd(M6,I6,P,Qs);i.emplaceBack(R,z,B,C,A),a.emplaceBack(R,z,B,C,1-A);const V=ze(P);C=.5+.5*Math.sin(V),A=.5+.5*Math.cos(V),h.emplaceBack(R,z,B,C,A),p.emplaceBack(R,z,B,C,1-A)}this._poleSegments.push(Qn.simpleSegment(y,0,66,64)),y+=66}this._poleNorthVertexBuffer=r.createVertexBuffer(i,pv,!1),this._poleSouthVertexBuffer=r.createVertexBuffer(a,pv,!1),this._texturedPoleNorthVertexBuffer=r.createVertexBuffer(h,pv,!1),this._texturedPoleSouthVertexBuffer=r.createVertexBuffer(p,pv,!1)}getGridBuffers(r,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[r].withSkirts:this._gridSegments[r].withoutSkirts]}getPoleBuffers(r,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[r]]}},s.cf=function(r){return Bn.has(r)},s.cg=yv,s.ch=xe,s.ci=function(r){return r({pluginStatus:re,pluginURL:de}),ce.on("pluginStateChange",r),r},s.cj=af,s.ck=Ew,s.cl=ci,s.cm=be,s.cn=Ze,s.co=cn,s.cp=function(r,e,i){return r.type==="custom"?new n7(r,e):new a7[r.type](r,e,i)},s.cq=function(r){const e=r.indexOf(Xt);return e>=0?r.slice(0,e):r},s.cr=r=>Ws(iv(r)),s.cs=r=>Ws(rv(r)),s.ct=r=>Ws(pm(r)),s.cu=function(r){return r.indexOf(Xt)>=0},s.cv=function(r){const e=r.indexOf(Xt);return e>=0?r.slice(e+1):""},s.cw=fh,s.cx=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},s.cy=r=>Ws(tv(r)),s.cz=r=>Ws(dm(r)),s.d=ze,s.d0=function(r,e){fr=r,Gr=e},s.d1=function(r,e,i=!1){if(re===ee||re===ne||re===oe)throw new Error("setRTLTextPlugin cannot be called multiple times.");de=ji.resolveURL(r),re=ee,ie=e,Ee(),i||Ce()},s.d2=fe,s.d3=function(){Uw().acquire($w)},s.d4=function(){const r=Qm;r&&(r.isPreloaded()&&r.numActive()===1?(r.release($w),Qm=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},s.d5=Ym,s.d6=function(r){const e=sn();if(!e)return;const i=e.delete(lr);r&&i.catch(r).then(()=>r())},s.d7=Xm,s.d8=QO,s.d9=function(r){Vw=ji.resolveURL(r),Gw||(Gw=new Zm(Uw(),new Ri)),Gw.broadcast("setDracoUrl",Vw)},s.da=wr,s.db=Lv,s.dc=J,s.dd=kv,s.de=Av,s.df=Se,s.dg=lP,s.dh=class extends Ri{constructor(r,e,i,a,h,p){super(),this.actor=r,this.layerIndex=e,this.availableImages=i,this.loadVectorData=h||YO,this.loading={},this.loaded={},this.deduped=new XO(r.scheduler),this.isSpriteLoaded=a,this.scheduler=r.scheduler,this.brightness=p}loadTile(r,e){const i=r.uid,a=r&&r.request,h=a&&a.collectResourceTiming,p=this.loading[i]=new u7(r);p.abort=this.loadVectorData(r,(m,y)=>{const b=!this.loading[i];if(delete this.loading[i],b||m||!y)return p.status="done",b||(this.loaded[i]=p),e(m);const E=y.rawData,C={};y.expires&&(C.expires=y.expires),y.cacheControl&&(C.cacheControl=y.cacheControl),p.vectorTile=y.vectorTile||new pw(new Rv(E));const A=()=>{p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,R)=>{if(P||!R)return e(P);const z={};if(h){const B=yn(a);B.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify(B)))}e(null,or({rawTileData:E.slice(0)},R,C,z))})};this.isSpriteLoaded?A():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(A,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):A()}),this.loaded=this.loaded||{},this.loaded[i]=p})}reloadTile(r,e){const i=this.loaded,a=r.uid,h=this;if(i&&i[a]){const p=i[a];p.showCollisionBoxes=r.showCollisionBoxes,p.projection=r.projection,p.brightness=r.brightness,p.tileTransform=nu(r.tileID.canonical,r.projection),p.extraShadowCaster=r.extraShadowCaster;const m=(y,b)=>{const E=p.reloadCallback;E&&(delete p.reloadCallback,p.parse(p.vectorTile,h.layerIndex,this.availableImages,h.actor,E)),e(y,b)};p.status==="parsing"?p.reloadCallback=m:p.status==="done"&&(p.vectorTile?p.parse(p.vectorTile,this.layerIndex,this.availableImages,this.actor,m):m())}else e(null,void 0)}abortTile(r,e){const i=r.uid,a=this.loading[i];a&&(a.abort&&a.abort(),delete this.loading[i]),e()}removeTile(r,e){const i=this.loaded,a=r.uid;i&&i[a]&&delete i[a],e()}},s.di=yn,s.dj=ii,s.dk=gw,s.dl=function(r){let e=0;if(new Uint32Array(r,0,1)[0]!==JO){const i=new Uint32Array(r,0,7),[,,a,h,p,m]=i;e=i.byteLength+h+p+m+p,(a!==r.byteLength||e>=r.byteLength)&&mr("Invalid b3dm header information.")}return nD(r,e)},s.dm=function(r,e){const i=sD(r);for(const a of i){for(const h of a.meshes)x7(h);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(b7(a.lights,e)))}return i},s.dn=mO,s.dp=qO,s.dq=Oe,s.dr=function(r){mn(),pn&&pn.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-r;a++)e.delete(i[a])})})},s.f=function(r,e){const{x:i,y:a}=r.point,h=Ok(i,a,r.worldSize/r._pixelsPerMercatorPixel,0,0);return s.m.multiply(h,h,Zb(bl(e)))},s.g=$t,s.i=of,s.j=zv,s.k=Zv,s.l=fo,s.n=Fr,s.o=QP,s.p=function(r,e){const i={};for(let a=0;a<e.length;a++){const h=e[a];h in r&&(i[h]=r[h])}return i},s.r=nO,s.s=function(r,e,i){r[4*e+0]=i[0],r[4*e+1]=i[1],r[4*e+2]=i[2],r[4*e+3]=i[3]},s.t=Th,s.u=function(r,e,i,a,h){const p=5*e+2;r.float32[p+0]=i,r.float32[p+1]=a,r.float32[p+2]=h},s.w=Vt,s.x=Ak,s.y=function(r,e,i,a,h,p,m,y,b){if(b.name==="globe")return Ak(r,e,new Th(i,a,h),!1);const E=nu({z:i,x:a,y:h},b);return new wi([(p+E.x/E.scale)*e,e*(E.y/E.scale),m],[(p+E.x2/E.scale)*e,e*(E.y2/E.scale),y])},s.z=function(r,e,i){let a=0;for(let h=0;h<2;++h){const p=i?i[h]:0;r[h]>p&&(a+=(r[h]-p)*(r[h]-p)),e[h]<p&&(a+=(p-e[h])*(p-e[h]))}return a}}),x(["./shared"],function(s){function I(vt){if(typeof vt=="number"||typeof vt=="boolean"||typeof vt=="string"||vt==null)return JSON.stringify(vt);if(Array.isArray(vt)){let xe="[";for(const Re of vt)xe+=`${I(Re)},`;return`${xe}]`}let _e="{";for(const xe of Object.keys(vt).sort())_e+=`${xe}:${I(vt[xe])},`;return`${_e}}`}function O(vt){let _e="";for(const xe of s.aS)_e+=`/${I(vt[xe])}`;return _e}class D{constructor(_e){this.keyCache={},this._layers={},this._layerConfigs={},_e&&this.replace(_e)}replace(_e,xe){this._layerConfigs={},this._layers={},this.update(_e,[],xe)}update(_e,xe,Re){this._options=Re;for(const gt of _e)this._layerConfigs[gt.id]=gt,(this._layers[gt.id]=s.cp(gt,this.scope,this._options)).compileFilter(),this.keyCache[gt.id]&&delete this.keyCache[gt.id];for(const gt of xe)delete this.keyCache[gt],delete this._layerConfigs[gt],delete this._layers[gt];this.familiesBySource={};const ft=function(gt,jt){const $t={};for(let ir=0;ir<gt.length;ir++){const lr=jt&&jt[gt[ir].id]||O(gt[ir]);jt&&(jt[gt[ir].id]=lr);let fr=$t[lr];fr||(fr=$t[lr]=[]),fr.push(gt[ir])}const yt=[];for(const ir in $t)yt.push($t[ir]);return yt}(s.da(this._layerConfigs),this.keyCache);for(const gt of ft){const jt=gt.map(Gr=>this._layers[Gr.id]),$t=jt[0];if($t.visibility==="none")continue;const yt=$t.source||"";let ir=this.familiesBySource[yt];ir||(ir=this.familiesBySource[yt]={});const lr=$t.sourceLayer||"_geojsonTileLayer";let fr=ir[lr];fr||(fr=ir[lr]=[]),fr.push(jt)}}}class N{loadTile(_e,xe){const{uid:Re,encoding:ft,rawImageData:gt,padding:jt}=_e,$t=ImageBitmap&&gt instanceof ImageBitmap?this.getImageData(gt,jt):gt;xe(null,new s.db(Re,$t,ft,jt<1))}getImageData(_e,xe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(_e.width,_e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=_e.width,this.offscreenCanvas.height=_e.height,this.offscreenCanvasContext.drawImage(_e,0,0,_e.width,_e.height);const Re=this.offscreenCanvasContext.getImageData(-xe,-xe,_e.width+2*xe,_e.height+2*xe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),Re}}function j(vt,_e){if(vt.length!==0){G(vt[0],_e);for(var xe=1;xe<vt.length;xe++)G(vt[xe],!_e)}}function G(vt,_e){for(var xe=0,Re=0,ft=0,gt=vt.length,jt=gt-1;ft<gt;jt=ft++){var $t=(vt[ft][0]-vt[jt][0])*(vt[jt][1]+vt[ft][1]),yt=xe+$t;Re+=Math.abs(xe)>=Math.abs($t)?xe-yt+$t:$t-yt+xe,xe=yt}xe+Re>=0!=!!_e&&vt.reverse()}var X=s.dc(function vt(_e,xe){var Re,ft=_e&&_e.type;if(ft==="FeatureCollection")for(Re=0;Re<_e.features.length;Re++)vt(_e.features[Re],xe);else if(ft==="GeometryCollection")for(Re=0;Re<_e.geometries.length;Re++)vt(_e.geometries[Re],xe);else if(ft==="Feature")vt(_e.geometry,xe);else if(ft==="Polygon")j(_e.coordinates,xe);else if(ft==="MultiPolygon")for(Re=0;Re<_e.coordinates.length;Re++)j(_e.coordinates[Re],xe);return _e});const te=s.dd.prototype.toGeoJSON;var H={exports:{}},U=s.df,q=s.de.VectorTileFeature,J=pe;function pe(vt,_e){this.options=_e||{},this.features=vt,this.length=vt.length}function ue(vt,_e){this.id=typeof vt.id=="number"?vt.id:void 0,this.type=vt.type,this.rawGeometry=vt.type===1?[vt.geometry]:vt.geometry,this.properties=vt.tags,this.extent=_e||4096}pe.prototype.feature=function(vt){return new ue(this.features[vt],this.options.extent)},ue.prototype.loadGeometry=function(){var vt=this.rawGeometry;this.geometry=[];for(var _e=0;_e<vt.length;_e++){for(var xe=vt[_e],Re=[],ft=0;ft<xe.length;ft++)Re.push(new U(xe[ft][0],xe[ft][1]));this.geometry.push(Re)}return this.geometry},ue.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var vt=this.geometry,_e=1/0,xe=-1/0,Re=1/0,ft=-1/0,gt=0;gt<vt.length;gt++)for(var jt=vt[gt],$t=0;$t<jt.length;$t++){var yt=jt[$t];_e=Math.min(_e,yt.x),xe=Math.max(xe,yt.x),Re=Math.min(Re,yt.y),ft=Math.max(ft,yt.y)}return[_e,Re,xe,ft]},ue.prototype.toGeoJSON=q.prototype.toGeoJSON;var Me=s.dg,Se=J;function ge(vt){var _e=new Me;return function(xe,Re){for(var ft in xe.layers)Re.writeMessage(3,se,xe.layers[ft])}(vt,_e),_e.finish()}function se(vt,_e){var xe;_e.writeVarintField(15,vt.version||1),_e.writeStringField(1,vt.name||""),_e.writeVarintField(5,vt.extent||4096);var Re={keys:[],values:[],keycache:{},valuecache:{}};for(xe=0;xe<vt.length;xe++)Re.feature=vt.feature(xe),_e.writeMessage(2,Ie,Re);var ft=Re.keys;for(xe=0;xe<ft.length;xe++)_e.writeStringField(3,ft[xe]);var gt=Re.values;for(xe=0;xe<gt.length;xe++)_e.writeMessage(4,It,gt[xe])}function Ie(vt,_e){var xe=vt.feature;xe.id!==void 0&&_e.writeVarintField(1,xe.id),_e.writeMessage(2,We,vt),_e.writeVarintField(3,xe.type),_e.writeMessage(4,nt,xe)}function We(vt,_e){var xe=vt.feature,Re=vt.keys,ft=vt.values,gt=vt.keycache,jt=vt.valuecache;for(var $t in xe.properties){var yt=xe.properties[$t],ir=gt[$t];if(yt!==null){ir===void 0&&(Re.push($t),gt[$t]=ir=Re.length-1),_e.writeVarint(ir);var lr=typeof yt;lr!=="string"&&lr!=="boolean"&&lr!=="number"&&(yt=JSON.stringify(yt));var fr=lr+":"+yt,Gr=jt[fr];Gr===void 0&&(ft.push(yt),jt[fr]=Gr=ft.length-1),_e.writeVarint(Gr)}}}function ze(vt,_e){return(_e<<3)+(7&vt)}function De(vt){return vt<<1^vt>>31}function nt(vt,_e){for(var xe=vt.loadGeometry(),Re=vt.type,ft=0,gt=0,jt=xe.length,$t=0;$t<jt;$t++){var yt=xe[$t],ir=1;Re===1&&(ir=yt.length),_e.writeVarint(ze(1,ir));for(var lr=Re===3?yt.length-1:yt.length,fr=0;fr<lr;fr++){fr===1&&Re!==1&&_e.writeVarint(ze(2,lr-1));var Gr=yt[fr].x-ft,pn=yt[fr].y-gt;_e.writeVarint(De(Gr)),_e.writeVarint(De(pn)),ft+=Gr,gt+=pn}Re===3&&_e.writeVarint(ze(7,1))}}function It(vt,_e){var xe=typeof vt;xe==="string"?_e.writeStringField(1,vt):xe==="boolean"?_e.writeBooleanField(7,vt):xe==="number"&&(vt%1!=0?_e.writeDoubleField(3,vt):vt<0?_e.writeSVarintField(6,vt):_e.writeVarintField(5,vt))}H.exports=ge,H.exports.fromVectorTileJs=ge,H.exports.fromGeojsonVt=function(vt,_e){_e=_e||{};var xe={};for(var Re in vt)xe[Re]=new Se(vt[Re].features,_e),xe[Re].name=Re,xe[Re].version=_e.version,xe[Re].extent=_e.extent;return ge({layers:xe})},H.exports.GeoJSONWrapper=Se;var Ot=s.dc(H.exports);const bt={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:vt=>vt},rt=Math.fround||(Gt=new Float32Array(1),vt=>(Gt[0]=+vt,Gt[0]));var Gt;const Vt=3,Jt=5,wr=6;class or{constructor(_e){this.options=Object.assign(Object.create(bt),_e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(_e){const{log:xe,minZoom:Re,maxZoom:ft}=this.options;xe&&console.time("total time");const gt=`prepare ${_e.length} points`;xe&&console.time(gt),this.points=_e;const jt=[];for(let yt=0;yt<_e.length;yt++){const ir=_e[yt];if(!ir.geometry)continue;const[lr,fr]=ir.geometry.coordinates,Gr=rt(Qt(lr)),pn=rt(gr(fr));jt.push(Gr,pn,1/0,yt,-1,1),this.options.reduce&&jt.push(0)}let $t=this.trees[ft+1]=this._createTree(jt);xe&&console.timeEnd(gt);for(let yt=ft;yt>=Re;yt--){const ir=+Date.now();$t=this.trees[yt]=this._createTree(this._cluster($t,yt)),xe&&console.log("z%d: %d clusters in %dms",yt,$t.numItems,+Date.now()-ir)}return xe&&console.timeEnd("total time"),this}getClusters(_e,xe){let Re=((_e[0]+180)%360+360)%360-180;const ft=Math.max(-90,Math.min(90,_e[1]));let gt=_e[2]===180?180:((_e[2]+180)%360+360)%360-180;const jt=Math.max(-90,Math.min(90,_e[3]));if(_e[2]-_e[0]>=360)Re=-180,gt=180;else if(Re>gt){const fr=this.getClusters([Re,ft,180,jt],xe),Gr=this.getClusters([-180,ft,gt,jt],xe);return fr.concat(Gr)}const $t=this.trees[this._limitZoom(xe)],yt=$t.range(Qt(Re),gr(jt),Qt(gt),gr(ft)),ir=$t.data,lr=[];for(const fr of yt){const Gr=this.stride*fr;lr.push(ir[Gr+Jt]>1?et(ir,Gr,this.clusterProps):this.points[ir[Gr+Vt]])}return lr}getChildren(_e){const xe=this._getOriginId(_e),Re=this._getOriginZoom(_e),ft="No cluster with the specified id.",gt=this.trees[Re];if(!gt)throw new Error(ft);const jt=gt.data;if(xe*this.stride>=jt.length)throw new Error(ft);const $t=this.options.radius/(this.options.extent*Math.pow(2,Re-1)),yt=gt.within(jt[xe*this.stride],jt[xe*this.stride+1],$t),ir=[];for(const lr of yt){const fr=lr*this.stride;jt[fr+4]===_e&&ir.push(jt[fr+Jt]>1?et(jt,fr,this.clusterProps):this.points[jt[fr+Vt]])}if(ir.length===0)throw new Error(ft);return ir}getLeaves(_e,xe,Re){const ft=[];return this._appendLeaves(ft,_e,xe=xe||10,Re=Re||0,0),ft}getTile(_e,xe,Re){const ft=this.trees[this._limitZoom(_e)],gt=Math.pow(2,_e),{extent:jt,radius:$t}=this.options,yt=$t/jt,ir=(Re-yt)/gt,lr=(Re+1+yt)/gt,fr={features:[]};return this._addTileFeatures(ft.range((xe-yt)/gt,ir,(xe+1+yt)/gt,lr),ft.data,xe,Re,gt,fr),xe===0&&this._addTileFeatures(ft.range(1-yt/gt,ir,1,lr),ft.data,gt,Re,gt,fr),xe===gt-1&&this._addTileFeatures(ft.range(0,ir,yt/gt,lr),ft.data,-1,Re,gt,fr),fr.features.length?fr:null}getClusterExpansionZoom(_e){let xe=this._getOriginZoom(_e)-1;for(;xe<=this.options.maxZoom;){const Re=this.getChildren(_e);if(xe++,Re.length!==1)break;_e=Re[0].properties.cluster_id}return xe}_appendLeaves(_e,xe,Re,ft,gt){const jt=this.getChildren(xe);for(const $t of jt){const yt=$t.properties;if(yt&&yt.cluster?gt+yt.point_count<=ft?gt+=yt.point_count:gt=this._appendLeaves(_e,yt.cluster_id,Re,ft,gt):gt<ft?gt++:_e.push($t),_e.length===Re)break}return gt}_createTree(_e){const xe=new s.aZ(_e.length/this.stride|0,this.options.nodeSize,Float32Array);for(let Re=0;Re<_e.length;Re+=this.stride)xe.add(_e[Re],_e[Re+1]);return xe.finish(),xe.data=_e,xe}_addTileFeatures(_e,xe,Re,ft,gt,jt){for(const $t of _e){const yt=$t*this.stride,ir=xe[yt+Jt]>1;let lr,fr,Gr;if(ir)lr=At(xe,yt,this.clusterProps),fr=xe[yt],Gr=xe[yt+1];else{const sn=this.points[xe[yt+Vt]];lr=sn.properties;const[mn,Rr]=sn.geometry.coordinates;fr=Qt(mn),Gr=gr(Rr)}const pn={type:1,geometry:[[Math.round(this.options.extent*(fr*gt-Re)),Math.round(this.options.extent*(Gr*gt-ft))]],tags:lr};let In;In=ir||this.options.generateId?xe[yt+Vt]:this.points[xe[yt+Vt]].id,In!==void 0&&(pn.id=In),jt.features.push(pn)}}_limitZoom(_e){return Math.max(this.options.minZoom,Math.min(Math.floor(+_e),this.options.maxZoom+1))}_cluster(_e,xe){const{radius:Re,extent:ft,reduce:gt,minPoints:jt}=this.options,$t=Re/(ft*Math.pow(2,xe)),yt=_e.data,ir=[],lr=this.stride;for(let fr=0;fr<yt.length;fr+=lr){if(yt[fr+2]<=xe)continue;yt[fr+2]=xe;const Gr=yt[fr],pn=yt[fr+1],In=_e.within(yt[fr],yt[fr+1],$t),sn=yt[fr+Jt];let mn=sn;for(const Rr of In){const jn=Rr*lr;yt[jn+2]>xe&&(mn+=yt[jn+Jt])}if(mn>sn&&mn>=jt){let Rr,jn=Gr*sn,Fn=pn*sn,Ii=-1;const ci=((fr/lr|0)<<5)+(xe+1)+this.points.length;for(const $n of In){const ii=$n*lr;if(yt[ii+2]<=xe)continue;yt[ii+2]=xe;const no=yt[ii+Jt];jn+=yt[ii]*no,Fn+=yt[ii+1]*no,yt[ii+4]=ci,gt&&(Rr||(Rr=this._map(yt,fr,!0),Ii=this.clusterProps.length,this.clusterProps.push(Rr)),gt(Rr,this._map(yt,ii)))}yt[fr+4]=ci,ir.push(jn/mn,Fn/mn,1/0,ci,-1,mn),gt&&ir.push(Ii)}else{for(let Rr=0;Rr<lr;Rr++)ir.push(yt[fr+Rr]);if(mn>1)for(const Rr of In){const jn=Rr*lr;if(!(yt[jn+2]<=xe)){yt[jn+2]=xe;for(let Fn=0;Fn<lr;Fn++)ir.push(yt[jn+Fn])}}}}return ir}_getOriginId(_e){return _e-this.points.length>>5}_getOriginZoom(_e){return(_e-this.points.length)%32}_map(_e,xe,Re){if(_e[xe+Jt]>1){const jt=this.clusterProps[_e[xe+wr]];return Re?Object.assign({},jt):jt}const ft=this.points[_e[xe+Vt]].properties,gt=this.options.map(ft);return Re&&gt===ft?Object.assign({},gt):gt}}function et(vt,_e,xe){return{type:"Feature",id:vt[_e+Vt],properties:At(vt,_e,xe),geometry:{type:"Point",coordinates:[(Re=vt[_e],360*(Re-.5)),Nt(vt[_e+1])]}};var Re}function At(vt,_e,xe){const Re=vt[_e+Jt],ft=Re>=1e4?`${Math.round(Re/1e3)}k`:Re>=1e3?Math.round(Re/100)/10+"k":Re,gt=vt[_e+wr],jt=gt===-1?{}:Object.assign({},xe[gt]);return Object.assign(jt,{cluster:!0,cluster_id:vt[_e+Vt],point_count:Re,point_count_abbreviated:ft})}function Qt(vt){return vt/360+.5}function gr(vt){const _e=Math.sin(vt*Math.PI/180),xe=.5-.25*Math.log((1+_e)/(1-_e))/Math.PI;return xe<0?0:xe>1?1:xe}function Nt(vt){const _e=(180-360*vt)*Math.PI/180;return 360*Math.atan(Math.exp(_e))/Math.PI-90}var Er={exports:{}};Er.exports=function(){function vt(we,ke,Ue,Ze){for(var tt,it=Ze,at=Ue-ke>>1,Ke=Ue-ke,xt=we[ke],_t=we[ke+1],Ft=we[Ue],pr=we[Ue+1],Ut=ke+3;Ut<Ue;Ut+=3){var Or=_e(we[Ut],we[Ut+1],xt,_t,Ft,pr);if(Or>it)tt=Ut,it=Or;else if(Or===it){var Lr=Math.abs(Ut-at);Lr<Ke&&(tt=Ut,Ke=Lr)}}it>Ze&&(tt-ke>3&&vt(we,ke,tt,Ze),we[tt+2]=it,Ue-tt>3&&vt(we,tt,Ue,Ze))}function _e(we,ke,Ue,Ze,tt,it){var at=tt-Ue,Ke=it-Ze;if(at!==0||Ke!==0){var xt=((we-Ue)*at+(ke-Ze)*Ke)/(at*at+Ke*Ke);xt>1?(Ue=tt,Ze=it):xt>0&&(Ue+=at*xt,Ze+=Ke*xt)}return(at=we-Ue)*at+(Ke=ke-Ze)*Ke}function xe(we,ke,Ue,Ze){var tt={id:we===void 0?null:we,type:ke,geometry:Ue,tags:Ze,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(it){var at=it.geometry,Ke=it.type;if(Ke==="Point"||Ke==="MultiPoint"||Ke==="LineString")Re(it,at);else if(Ke==="Polygon"||Ke==="MultiLineString")for(var xt=0;xt<at.length;xt++)Re(it,at[xt]);else if(Ke==="MultiPolygon")for(xt=0;xt<at.length;xt++)for(var _t=0;_t<at[xt].length;_t++)Re(it,at[xt][_t])}(tt),tt}function Re(we,ke){for(var Ue=0;Ue<ke.length;Ue+=3)we.minX=Math.min(we.minX,ke[Ue]),we.minY=Math.min(we.minY,ke[Ue+1]),we.maxX=Math.max(we.maxX,ke[Ue]),we.maxY=Math.max(we.maxY,ke[Ue+1])}function ft(we,ke,Ue,Ze){if(ke.geometry){var tt=ke.geometry.coordinates,it=ke.geometry.type,at=Math.pow(Ue.tolerance/((1<<Ue.maxZoom)*Ue.extent),2),Ke=[],xt=ke.id;if(Ue.promoteId?xt=ke.properties[Ue.promoteId]:Ue.generateId&&(xt=Ze||0),it==="Point")gt(tt,Ke);else if(it==="MultiPoint")for(var _t=0;_t<tt.length;_t++)gt(tt[_t],Ke);else if(it==="LineString")jt(tt,Ke,at,!1);else if(it==="MultiLineString"){if(Ue.lineMetrics){for(_t=0;_t<tt.length;_t++)jt(tt[_t],Ke=[],at,!1),we.push(xe(xt,"LineString",Ke,ke.properties));return}$t(tt,Ke,at,!1)}else if(it==="Polygon")$t(tt,Ke,at,!0);else{if(it!=="MultiPolygon"){if(it==="GeometryCollection"){for(_t=0;_t<ke.geometry.geometries.length;_t++)ft(we,{id:xt,geometry:ke.geometry.geometries[_t],properties:ke.properties},Ue,Ze);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_t=0;_t<tt.length;_t++){var Ft=[];$t(tt[_t],Ft,at,!0),Ke.push(Ft)}}we.push(xe(xt,it,Ke,ke.properties))}}function gt(we,ke){ke.push(yt(we[0])),ke.push(ir(we[1])),ke.push(0)}function jt(we,ke,Ue,Ze){for(var tt,it,at=0,Ke=0;Ke<we.length;Ke++){var xt=yt(we[Ke][0]),_t=ir(we[Ke][1]);ke.push(xt),ke.push(_t),ke.push(0),Ke>0&&(at+=Ze?(tt*_t-xt*it)/2:Math.sqrt(Math.pow(xt-tt,2)+Math.pow(_t-it,2))),tt=xt,it=_t}var Ft=ke.length-3;ke[2]=1,vt(ke,0,Ft,Ue),ke[Ft+2]=1,ke.size=Math.abs(at),ke.start=0,ke.end=ke.size}function $t(we,ke,Ue,Ze){for(var tt=0;tt<we.length;tt++){var it=[];jt(we[tt],it,Ue,Ze),ke.push(it)}}function yt(we){return we/360+.5}function ir(we){var ke=Math.sin(we*Math.PI/180),Ue=.5-.25*Math.log((1+ke)/(1-ke))/Math.PI;return Ue<0?0:Ue>1?1:Ue}function lr(we,ke,Ue,Ze,tt,it,at,Ke){if(Ze/=ke,it>=(Ue/=ke)&&at<Ze)return we;if(at<Ue||it>=Ze)return null;for(var xt=[],_t=0;_t<we.length;_t++){var Ft=we[_t],pr=Ft.geometry,Ut=Ft.type,Or=tt===0?Ft.minX:Ft.minY,Lr=tt===0?Ft.maxX:Ft.maxY;if(Or>=Ue&&Lr<Ze)xt.push(Ft);else if(!(Lr<Ue||Or>=Ze)){var Kr=[];if(Ut==="Point"||Ut==="MultiPoint")fr(pr,Kr,Ue,Ze,tt);else if(Ut==="LineString")Gr(pr,Kr,Ue,Ze,tt,!1,Ke.lineMetrics);else if(Ut==="MultiLineString")In(pr,Kr,Ue,Ze,tt,!1);else if(Ut==="Polygon")In(pr,Kr,Ue,Ze,tt,!0);else if(Ut==="MultiPolygon")for(var an=0;an<pr.length;an++){var Zn=[];In(pr[an],Zn,Ue,Ze,tt,!0),Zn.length&&Kr.push(Zn)}if(Kr.length){if(Ke.lineMetrics&&Ut==="LineString"){for(an=0;an<Kr.length;an++)xt.push(xe(Ft.id,Ut,Kr[an],Ft.tags));continue}Ut!=="LineString"&&Ut!=="MultiLineString"||(Kr.length===1?(Ut="LineString",Kr=Kr[0]):Ut="MultiLineString"),Ut!=="Point"&&Ut!=="MultiPoint"||(Ut=Kr.length===3?"Point":"MultiPoint"),xt.push(xe(Ft.id,Ut,Kr,Ft.tags))}}}return xt.length?xt:null}function fr(we,ke,Ue,Ze,tt){for(var it=0;it<we.length;it+=3){var at=we[it+tt];at>=Ue&&at<=Ze&&(ke.push(we[it]),ke.push(we[it+1]),ke.push(we[it+2]))}}function Gr(we,ke,Ue,Ze,tt,it,at){for(var Ke,xt,_t=pn(we),Ft=tt===0?mn:Rr,pr=we.start,Ut=0;Ut<we.length-3;Ut+=3){var Or=we[Ut],Lr=we[Ut+1],Kr=we[Ut+2],an=we[Ut+3],Zn=we[Ut+4],oi=tt===0?Or:Lr,fi=tt===0?an:Zn,Oi=!1;at&&(Ke=Math.sqrt(Math.pow(Or-an,2)+Math.pow(Lr-Zn,2))),oi<Ue?fi>Ue&&(xt=Ft(_t,Or,Lr,an,Zn,Ue),at&&(_t.start=pr+Ke*xt)):oi>Ze?fi<Ze&&(xt=Ft(_t,Or,Lr,an,Zn,Ze),at&&(_t.start=pr+Ke*xt)):sn(_t,Or,Lr,Kr),fi<Ue&&oi>=Ue&&(xt=Ft(_t,Or,Lr,an,Zn,Ue),Oi=!0),fi>Ze&&oi<=Ze&&(xt=Ft(_t,Or,Lr,an,Zn,Ze),Oi=!0),!it&&Oi&&(at&&(_t.end=pr+Ke*xt),ke.push(_t),_t=pn(we)),at&&(pr+=Ke)}var si=we.length-3;Or=we[si],Lr=we[si+1],Kr=we[si+2],(oi=tt===0?Or:Lr)>=Ue&&oi<=Ze&&sn(_t,Or,Lr,Kr),si=_t.length-3,it&&si>=3&&(_t[si]!==_t[0]||_t[si+1]!==_t[1])&&sn(_t,_t[0],_t[1],_t[2]),_t.length&&ke.push(_t)}function pn(we){var ke=[];return ke.size=we.size,ke.start=we.start,ke.end=we.end,ke}function In(we,ke,Ue,Ze,tt,it){for(var at=0;at<we.length;at++)Gr(we[at],ke,Ue,Ze,tt,it,!1)}function sn(we,ke,Ue,Ze){we.push(ke),we.push(Ue),we.push(Ze)}function mn(we,ke,Ue,Ze,tt,it){var at=(it-ke)/(Ze-ke);return we.push(it),we.push(Ue+(tt-Ue)*at),we.push(1),at}function Rr(we,ke,Ue,Ze,tt,it){var at=(it-Ue)/(tt-Ue);return we.push(ke+(Ze-ke)*at),we.push(it),we.push(1),at}function jn(we,ke){for(var Ue=[],Ze=0;Ze<we.length;Ze++){var tt,it=we[Ze],at=it.type;if(at==="Point"||at==="MultiPoint"||at==="LineString")tt=Fn(it.geometry,ke);else if(at==="MultiLineString"||at==="Polygon"){tt=[];for(var Ke=0;Ke<it.geometry.length;Ke++)tt.push(Fn(it.geometry[Ke],ke))}else if(at==="MultiPolygon")for(tt=[],Ke=0;Ke<it.geometry.length;Ke++){for(var xt=[],_t=0;_t<it.geometry[Ke].length;_t++)xt.push(Fn(it.geometry[Ke][_t],ke));tt.push(xt)}Ue.push(xe(it.id,at,tt,it.tags))}return Ue}function Fn(we,ke){var Ue=[];Ue.size=we.size,we.start!==void 0&&(Ue.start=we.start,Ue.end=we.end);for(var Ze=0;Ze<we.length;Ze+=3)Ue.push(we[Ze]+ke,we[Ze+1],we[Ze+2]);return Ue}function Ii(we,ke){if(we.transformed)return we;var Ue,Ze,tt,it=1<<we.z,at=we.x,Ke=we.y;for(Ue=0;Ue<we.features.length;Ue++){var xt=we.features[Ue],_t=xt.geometry,Ft=xt.type;if(xt.geometry=[],Ft===1)for(Ze=0;Ze<_t.length;Ze+=2)xt.geometry.push(ci(_t[Ze],_t[Ze+1],ke,it,at,Ke));else for(Ze=0;Ze<_t.length;Ze++){var pr=[];for(tt=0;tt<_t[Ze].length;tt+=2)pr.push(ci(_t[Ze][tt],_t[Ze][tt+1],ke,it,at,Ke));xt.geometry.push(pr)}}return we.transformed=!0,we}function ci(we,ke,Ue,Ze,tt,it){return[Math.round(Ue*(we*Ze-tt)),Math.round(Ue*(ke*Ze-it))]}function $n(we,ke,Ue,Ze,tt){for(var it=ke===tt.maxZoom?0:tt.tolerance/((1<<ke)*tt.extent),at={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Ue,y:Ze,z:ke,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ke=0;Ke<we.length;Ke++){at.numFeatures++,ii(at,we[Ke],it,tt);var xt=we[Ke].minX,_t=we[Ke].minY,Ft=we[Ke].maxX,pr=we[Ke].maxY;xt<at.minX&&(at.minX=xt),_t<at.minY&&(at.minY=_t),Ft>at.maxX&&(at.maxX=Ft),pr>at.maxY&&(at.maxY=pr)}return at}function ii(we,ke,Ue,Ze){var tt=ke.geometry,it=ke.type,at=[];if(it==="Point"||it==="MultiPoint")for(var Ke=0;Ke<tt.length;Ke+=3)at.push(tt[Ke]),at.push(tt[Ke+1]),we.numPoints++,we.numSimplified++;else if(it==="LineString")no(at,tt,we,Ue,!1,!1);else if(it==="MultiLineString"||it==="Polygon")for(Ke=0;Ke<tt.length;Ke++)no(at,tt[Ke],we,Ue,it==="Polygon",Ke===0);else if(it==="MultiPolygon")for(var xt=0;xt<tt.length;xt++){var _t=tt[xt];for(Ke=0;Ke<_t.length;Ke++)no(at,_t[Ke],we,Ue,!0,Ke===0)}if(at.length){var Ft=ke.tags||null;if(it==="LineString"&&Ze.lineMetrics){for(var pr in Ft={},ke.tags)Ft[pr]=ke.tags[pr];Ft.mapbox_clip_start=tt.start/tt.size,Ft.mapbox_clip_end=tt.end/tt.size}var Ut={geometry:at,type:it==="Polygon"||it==="MultiPolygon"?3:it==="LineString"||it==="MultiLineString"?2:1,tags:Ft};ke.id!==null&&(Ut.id=ke.id),we.features.push(Ut)}}function no(we,ke,Ue,Ze,tt,it){var at=Ze*Ze;if(Ze>0&&ke.size<(tt?at:Ze))Ue.numPoints+=ke.length/3;else{for(var Ke=[],xt=0;xt<ke.length;xt+=3)(Ze===0||ke[xt+2]>at)&&(Ue.numSimplified++,Ke.push(ke[xt]),Ke.push(ke[xt+1])),Ue.numPoints++;tt&&function(_t,Ft){for(var pr=0,Ut=0,Or=_t.length,Lr=Or-2;Ut<Or;Lr=Ut,Ut+=2)pr+=(_t[Ut]-_t[Lr])*(_t[Ut+1]+_t[Lr+1]);if(pr>0===Ft)for(Ut=0,Or=_t.length;Ut<Or/2;Ut+=2){var Kr=_t[Ut],an=_t[Ut+1];_t[Ut]=_t[Or-2-Ut],_t[Ut+1]=_t[Or-1-Ut],_t[Or-2-Ut]=Kr,_t[Or-1-Ut]=an}}(Ke,it),we.push(Ke)}}function Go(we,ke){var Ue=(ke=this.options=function(tt,it){for(var at in it)tt[at]=it[at];return tt}(Object.create(this.options),ke)).debug;if(Ue&&console.time("preprocess data"),ke.maxZoom<0||ke.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ke.promoteId&&ke.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ze=function(tt,it){var at=[];if(tt.type==="FeatureCollection")for(var Ke=0;Ke<tt.features.length;Ke++)ft(at,tt.features[Ke],it,Ke);else ft(at,tt.type==="Feature"?tt:{geometry:tt},it);return at}(we,ke);this.tiles={},this.tileCoords=[],Ue&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ke.indexMaxZoom,ke.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ze=function(tt,it){var at=it.buffer/it.extent,Ke=tt,xt=lr(tt,1,-1-at,at,0,-1,2,it),_t=lr(tt,1,1-at,2+at,0,-1,2,it);return(xt||_t)&&(Ke=lr(tt,1,-at,1+at,0,-1,2,it)||[],xt&&(Ke=jn(xt,1).concat(Ke)),_t&&(Ke=Ke.concat(jn(_t,-1)))),Ke}(Ze,ke)).length&&this.splitTile(Ze,0,0,0),Ue&&(Ze.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function qe(we,ke,Ue){return 32*((1<<we)*Ue+ke)+we}return Go.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Go.prototype.splitTile=function(we,ke,Ue,Ze,tt,it,at){for(var Ke=[we,ke,Ue,Ze],xt=this.options,_t=xt.debug;Ke.length;){Ze=Ke.pop(),Ue=Ke.pop(),ke=Ke.pop(),we=Ke.pop();var Ft=1<<ke,pr=qe(ke,Ue,Ze),Ut=this.tiles[pr];if(!Ut&&(_t>1&&console.time("creation"),Ut=this.tiles[pr]=$n(we,ke,Ue,Ze,xt),this.tileCoords.push({z:ke,x:Ue,y:Ze}),_t)){_t>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ke,Ue,Ze,Ut.numFeatures,Ut.numPoints,Ut.numSimplified),console.timeEnd("creation"));var Or="z"+ke;this.stats[Or]=(this.stats[Or]||0)+1,this.total++}if(Ut.source=we,tt){if(ke===xt.maxZoom||ke===tt)continue;var Lr=1<<tt-ke;if(Ue!==Math.floor(it/Lr)||Ze!==Math.floor(at/Lr))continue}else if(ke===xt.indexMaxZoom||Ut.numPoints<=xt.indexMaxPoints)continue;if(Ut.source=null,we.length!==0){_t>1&&console.time("clipping");var Kr,an,Zn,oi,fi,Oi,si=.5*xt.buffer/xt.extent,Bn=.5-si,Di=.5+si,ko=1+si;Kr=an=Zn=oi=null,fi=lr(we,Ft,Ue-si,Ue+Di,0,Ut.minX,Ut.maxX,xt),Oi=lr(we,Ft,Ue+Bn,Ue+ko,0,Ut.minX,Ut.maxX,xt),we=null,fi&&(Kr=lr(fi,Ft,Ze-si,Ze+Di,1,Ut.minY,Ut.maxY,xt),an=lr(fi,Ft,Ze+Bn,Ze+ko,1,Ut.minY,Ut.maxY,xt),fi=null),Oi&&(Zn=lr(Oi,Ft,Ze-si,Ze+Di,1,Ut.minY,Ut.maxY,xt),oi=lr(Oi,Ft,Ze+Bn,Ze+ko,1,Ut.minY,Ut.maxY,xt),Oi=null),_t>1&&console.timeEnd("clipping"),Ke.push(Kr||[],ke+1,2*Ue,2*Ze),Ke.push(an||[],ke+1,2*Ue,2*Ze+1),Ke.push(Zn||[],ke+1,2*Ue+1,2*Ze),Ke.push(oi||[],ke+1,2*Ue+1,2*Ze+1)}}},Go.prototype.getTile=function(we,ke,Ue){var Ze=this.options,tt=Ze.extent,it=Ze.debug;if(we<0||we>24)return null;var at=1<<we,Ke=qe(we,ke=(ke%at+at)%at,Ue);if(this.tiles[Ke])return Ii(this.tiles[Ke],tt);it>1&&console.log("drilling down to z%d-%d-%d",we,ke,Ue);for(var xt,_t=we,Ft=ke,pr=Ue;!xt&&_t>0;)_t--,Ft=Math.floor(Ft/2),pr=Math.floor(pr/2),xt=this.tiles[qe(_t,Ft,pr)];return xt&&xt.source?(it>1&&console.log("found parent tile z%d-%d-%d",_t,Ft,pr),it>1&&console.time("drilling down"),this.splitTile(xt.source,_t,Ft,pr,we,ke,Ue),it>1&&console.timeEnd("drilling down"),this.tiles[Ke]?Ii(this.tiles[Ke],tt):null):null},function(we,ke){return new Go(we,ke)}}();var Tr=s.dc(Er.exports);function $r(vt,_e){const xe=vt.tileID.canonical;if(!this._geoJSONIndex)return _e(null,null);const Re=this._geoJSONIndex.getTile(xe.z,xe.x,xe.y);if(!Re)return _e(null,null);const ft=new class{constructor(jt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=s.J,this.length=jt.length,this._features=jt}feature(jt){return new class{constructor($t){this._feature=$t,this.extent=s.J,this.type=$t.type,this.properties=$t.tags,"id"in $t&&!isNaN($t.id)&&(this.id=parseInt($t.id,10))}loadGeometry(){if(this._feature.type===1){const $t=[];for(const yt of this._feature.geometry)$t.push([new s.P(yt[0],yt[1])]);return $t}{const $t=[];for(const yt of this._feature.geometry){const ir=[];for(const lr of yt)ir.push(new s.P(lr[0],lr[1]));$t.push(ir)}return $t}}toGeoJSON($t,yt,ir){return te.call(this,$t,yt,ir)}}(this._features[jt])}}(Re.features);let gt=Ot(ft);gt.byteOffset===0&&gt.byteLength===gt.buffer.byteLength||(gt=new Uint8Array(gt)),_e(null,{vectorTile:ft,rawData:gt.buffer})}class Xr extends s.dh{constructor(_e,xe,Re,ft,gt,jt){super(_e,xe,Re,ft,$r,jt),gt&&(this.loadGeoJSON=gt)}loadData(_e,xe){const Re=_e&&_e.request,ft=Re&&Re.collectResourceTiming;this.loadGeoJSON(_e,(gt,jt)=>{if(gt||!jt)return xe(gt);if(typeof jt!="object")return xe(new Error(`Input data given to '${_e.source}' is not a valid GeoJSON object.`));{X(jt,!0);try{if(_e.filter){const yt=s.cw(_e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(yt.result==="error")throw new Error(yt.value.map(lr=>`${lr.key}: ${lr.message}`).join(", "));jt={type:"FeatureCollection",features:jt.features.filter(lr=>yt.value.evaluate({zoom:0},lr))}}this._geoJSONIndex=_e.cluster?new or(function({superclusterOptions:yt,clusterProperties:ir}){if(!ir||!yt)return yt;const lr={},fr={},Gr={accumulated:null,zoom:0},pn={properties:null},In=Object.keys(ir);for(const sn of In){const[mn,Rr]=ir[sn],jn=s.cw(Rr),Fn=s.cw(typeof mn=="string"?[mn,["accumulated"],["get",sn]]:mn);lr[sn]=jn.value,fr[sn]=Fn.value}return yt.map=sn=>{pn.properties=sn;const mn={};for(const Rr of In)mn[Rr]=lr[Rr].evaluate(Gr,pn);return mn},yt.reduce=(sn,mn)=>{pn.properties=mn;for(const Rr of In)Gr.accumulated=sn[Rr],sn[Rr]=fr[Rr].evaluate(Gr,pn)},yt}(_e)).load(jt.features):Tr(jt,_e.geojsonVtOptions)}catch(yt){return xe(yt)}this.loaded={};const $t={};if(ft){const yt=s.di(Re);yt&&($t.resourceTiming={},$t.resourceTiming[_e.source]=JSON.parse(JSON.stringify(yt)))}xe(null,$t)}})}reloadTile(_e,xe){const Re=this.loaded;return Re&&Re[_e.uid]?super.reloadTile(_e,xe):this.loadTile(_e,xe)}loadGeoJSON(_e,xe){if(_e.request)s.a1(_e.request,xe);else{if(typeof _e.data!="string")return xe(new Error(`Input data given to '${_e.source}' is not a valid GeoJSON object.`));try{return xe(null,JSON.parse(_e.data))}catch{return xe(new Error(`Input data given to '${_e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(_e,xe){try{xe(null,this._geoJSONIndex.getClusterExpansionZoom(_e.clusterId))}catch(Re){xe(Re)}}getClusterChildren(_e,xe){try{xe(null,this._geoJSONIndex.getChildren(_e.clusterId))}catch(Re){xe(Re)}}getClusterLeaves(_e,xe){try{xe(null,this._geoJSONIndex.getLeaves(_e.clusterId,_e.limit,_e.offset))}catch(Re){xe(Re)}}}class cn{constructor(_e,xe){this.tileID=new s.O(_e.tileID.overscaledZ,_e.tileID.wrap,_e.tileID.canonical.z,_e.tileID.canonical.x,_e.tileID.canonical.y),this.tileZoom=_e.tileZoom,this.uid=_e.uid,this.zoom=_e.zoom,this.canonical=_e.tileID.canonical,this.pixelRatio=_e.pixelRatio,this.tileSize=_e.tileSize,this.source=_e.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=_e.projection,this.brightness=xe}parse(_e,xe,Re,ft){this.status="parsing";const gt=new s.O(Re.tileID.overscaledZ,Re.tileID.wrap,Re.tileID.canonical.z,Re.tileID.canonical.x,Re.tileID.canonical.y),jt={},$t=xe.familiesBySource[Re.source],yt=new s.dk(gt,Re.promoteId);return yt.bucketLayerIDs=[],s.dl(_e).then(ir=>{if(!ir)return ft(new Error("Could not parse tile"));const lr=s.dm(ir,1/s.cg(Re.tileID.canonical)),fr=ir.json.extensionsUsed&&ir.json.extensionsUsed.includes("MAPBOX_mesh_features"),Gr=new s.al(this.zoom,{brightness:this.brightness});for(const pn in $t)for(const In of $t[pn]){const sn=In[0],mn=ir.json.extensionsUsed;sn.recalculate(Gr,[]);const Rr=new s.dn(lr,gt,mn&&mn.includes("MAPBOX_mesh_features"),this.brightness);fr||(Rr.needsUpload=!0),jt[sn.fqid]=Rr,Rr.evaluate(sn)}this.status="done",ft(null,{buckets:jt,featureIndex:yt})}).catch(ir=>ft(new Error(ir.message)))}}class Mn{constructor(_e,xe,Re,ft,gt,jt){this.actor=_e,this.layerIndex=xe,this.brightness=jt,this.loading={},this.loaded={}}loadTile(_e,xe){const Re=_e.uid,ft=this.loading[Re]=new cn(_e,this.brightness);s.dj(_e.request,(gt,jt)=>{const $t=!this.loading[Re];return delete this.loading[Re],$t||gt?(ft.status="done",$t||(this.loaded[Re]=ft),xe(gt)):jt&&jt.byteLength!==0?void ft.parse(jt,this.layerIndex,_e,(yt,ir)=>{ft.status="done",this.loaded=this.loaded||{},this.loaded[Re]=ft,yt||!ir?xe(yt):xe(null,ir)}):(ft.status="done",this.loaded[Re]=ft,xe())})}reloadTile(_e,xe){const Re=this.loaded,ft=_e.uid;if(Re&&Re[ft]){const gt=Re[ft];gt.projection=_e.projection,gt.brightness=_e.brightness;const jt=($t,yt)=>{gt.reloadCallback&&(delete gt.reloadCallback,this.loadTile(_e,xe)),xe($t,yt)};gt.status==="parsing"?gt.reloadCallback=jt:gt.status==="done"&&this.loadTile(_e,xe)}}abortTile(_e,xe){const Re=_e.uid;this.loading[Re]&&delete this.loading[Re],xe()}removeTile(_e,xe){const Re=this.loaded,ft=_e.uid;Re&&Re[ft]&&delete Re[ft],xe()}}class mr{constructor(_e){this.self=_e,this.actor=new s.dp(_e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=s.o({name:"mercator"}),this.workerSourceTypes={vector:s.dh,geojson:Xr,"batched-model":Mn},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(xe,Re)=>{if(this.workerSourceTypes[xe])throw new Error(`Worker source with name "${xe}" already registered.`);this.workerSourceTypes[xe]=Re},this.self.registerRTLTextPlugin=xe=>{if(s.dq.isParsed())throw new Error("RTL text plugin already registered.");s.dq.applyArabicShaping=xe.applyArabicShaping,s.dq.processBidirectionalText=xe.processBidirectionalText,s.dq.processStyledBidirectionalText=xe.processStyledBidirectionalText}}clearCaches(_e,xe,Re){delete this.layerIndexes[_e],delete this.availableImages[_e],delete this.workerSources[_e],delete this.demWorkerSources[_e],Re()}checkIfReady(_e,xe,Re){Re()}setReferrer(_e,xe){this.referrer=xe}spriteLoaded(_e,{scope:xe,isLoaded:Re}){if(this.isSpriteLoaded[_e]||(this.isSpriteLoaded[_e]={}),this.isSpriteLoaded[_e][xe]=Re,this.workerSources[_e]&&this.workerSources[_e][xe])for(const ft in this.workerSources[_e][xe]){const gt=this.workerSources[_e][xe][ft];for(const jt in gt)gt[jt]instanceof s.dh&&(gt[jt].isSpriteLoaded=Re,gt[jt].fire(new s.a8("isSpriteLoaded")))}}setImages(_e,{scope:xe,images:Re},ft){if(this.availableImages[_e]||(this.availableImages[_e]={}),this.availableImages[_e][xe]=Re,this.workerSources[_e]&&this.workerSources[_e][xe]){for(const gt in this.workerSources[_e][xe]){const jt=this.workerSources[_e][xe][gt];for(const $t in jt)jt[$t].availableImages=Re}ft()}else ft()}setProjection(_e,xe){this.projections[_e]=s.o(xe)}setBrightness(_e,xe,Re){this.brightness=xe,Re()}setLayers(_e,xe,Re){this.getLayerIndex(_e,xe.scope).replace(xe.layers,xe.options),Re()}updateLayers(_e,xe,Re){this.getLayerIndex(_e,xe.scope).update(xe.layers,xe.removedIds,xe.options),Re()}loadTile(_e,xe,Re){xe.projection=this.projections[_e]||this.defaultProjection,this.getWorkerSource(_e,xe.type,xe.source,xe.scope).loadTile(xe,Re)}loadDEMTile(_e,xe,Re){this.getDEMWorkerSource(_e,xe.source,xe.scope).loadTile(xe,Re)}reloadTile(_e,xe,Re){xe.projection=this.projections[_e]||this.defaultProjection,this.getWorkerSource(_e,xe.type,xe.source,xe.scope).reloadTile(xe,Re)}abortTile(_e,xe,Re){this.getWorkerSource(_e,xe.type,xe.source,xe.scope).abortTile(xe,Re)}removeTile(_e,xe,Re){this.getWorkerSource(_e,xe.type,xe.source,xe.scope).removeTile(xe,Re)}removeSource(_e,xe,Re){if(!(this.workerSources[_e]&&this.workerSources[_e][xe.scope]&&this.workerSources[_e][xe.scope][xe.type]&&this.workerSources[_e][xe.scope][xe.type][xe.source]))return;const ft=this.workerSources[_e][xe.scope][xe.type][xe.source];delete this.workerSources[_e][xe.scope][xe.type][xe.source],ft.removeSource!==void 0?ft.removeSource(xe,Re):Re()}loadWorkerSource(_e,xe,Re){try{this.self.importScripts(xe.url),Re()}catch(ft){Re(ft.toString())}}syncRTLPluginState(_e,xe,Re){try{s.dq.setState(xe);const ft=s.dq.getPluginURL();if(s.dq.isLoaded()&&!s.dq.isParsed()&&ft!=null){this.self.importScripts(ft);const gt=s.dq.isParsed();Re(gt?void 0:new Error(`RTL Text Plugin failed to import scripts from ${ft}`),gt)}}catch(ft){Re(ft.toString())}}setDracoUrl(_e,xe){this.dracoUrl=xe}getAvailableImages(_e,xe){this.availableImages[_e]||(this.availableImages[_e]={});let Re=this.availableImages[_e][xe];return Re||(Re=[]),Re}getLayerIndex(_e,xe){this.layerIndexes[_e]||(this.layerIndexes[_e]={});let Re=this.layerIndexes[_e][xe];return Re||(Re=this.layerIndexes[_e][xe]=new D,Re.scope=xe),Re}getWorkerSource(_e,xe,Re,ft){if(this.workerSources[_e]||(this.workerSources[_e]={}),this.workerSources[_e][ft]||(this.workerSources[_e][ft]={}),this.workerSources[_e][ft][xe]||(this.workerSources[_e][ft][xe]={}),this.isSpriteLoaded[_e]||(this.isSpriteLoaded[_e]={}),!this.workerSources[_e][ft][xe][Re]){const gt={send:(jt,$t,yt,ir,lr,fr)=>{this.actor.send(jt,$t,yt,_e,lr,fr)},scheduler:this.actor.scheduler};this.workerSources[_e][ft][xe][Re]=new this.workerSourceTypes[xe](gt,this.getLayerIndex(_e,ft),this.getAvailableImages(_e,ft),this.isSpriteLoaded[_e][ft],void 0,this.brightness)}return this.workerSources[_e][ft][xe][Re]}getDEMWorkerSource(_e,xe,Re){return this.demWorkerSources[_e]||(this.demWorkerSources[_e]={}),this.demWorkerSources[_e][Re]||(this.demWorkerSources[_e][Re]={}),this.demWorkerSources[_e][Re][xe]||(this.demWorkerSources[_e][Re][xe]=new N),this.demWorkerSources[_e][Re][xe]}enforceCacheSizeLimit(_e,xe){s.dr(xe)}getWorkerPerformanceMetrics(_e,xe,Re){Re(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new mr(self)),mr}),x(["./shared"],function(s){function I(_,c){if(Array.isArray(_)){if(!Array.isArray(c)||_.length!==c.length)return!1;for(let f=0;f<_.length;f++)if(!I(_[f],c[f]))return!1;return!0}if(typeof _=="object"&&_!==null&&c!==null){if(typeof c!="object"||Object.keys(_).length!==Object.keys(c).length)return!1;for(const f in _)if(!I(_[f],c[f]))return!1;return!0}return _===c}var O=D;function D(_){return!function(c){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,w,S=new Blob([""],{type:"text/javascript"}),M=URL.createObjectURL(S);try{w=new Worker(M),v=!0}catch{v=!1}return w&&w.terminate(),URL.revokeObjectURL(M),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var w=v.getContext("2d");if(!w)return!1;var S=w.getImageData(0,0,1,1);return S&&S.width===v.width}()?(N[f=c&&c.failIfMajorPerformanceCaveat]===void 0&&(N[f]=function(v){var w,S=function(M){var k=document.createElement("canvas"),L=Object.create(D.webGLContextAttributes);return L.failIfMajorPerformanceCaveat=M,k.getContext("webgl2",L)}(v);if(!S)return!1;try{w=S.createShader(S.VERTEX_SHADER)}catch{return!1}return!(!w||S.isContextLost())&&(S.shaderSource(w,"void main() {}"),S.compileShader(w),S.getShaderParameter(w,S.COMPILE_STATUS)===!0)}(f)),N[f]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var f}(_)}var N={};function j(_,c,f){const v=document.createElement(_);return c!=null&&(v.className=c),f&&f.appendChild(v),v}function G(_,c,f){const v=document.createElementNS("http://www.w3.org/2000/svg",_);for(const w of Object.keys(c))v.setAttributeNS(null,w,String(c[w]));return f&&f.appendChild(v),v}D.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const X=typeof document<"u"?document.documentElement&&document.documentElement.style:null,te=X&&X.userSelect!==void 0?"userSelect":"WebkitUserSelect";let H;function U(){X&&te&&(H=X[te],X[te]="none")}function q(){X&&te&&(X[te]=H)}function J(_){_.preventDefault(),_.stopPropagation(),window.removeEventListener("click",J,!0)}function pe(){window.addEventListener("click",J,!0),window.setTimeout(()=>{window.removeEventListener("click",J,!0)},0)}function ue(_,c){const f=_.getBoundingClientRect();return ge(_,f,c)}function Me(_,c){const f=_.getBoundingClientRect(),v=[];for(let w=0;w<c.length;w++)v.push(ge(_,f,c[w]));return v}function Se(_){return window.InstallTrigger!==void 0&&_.button===2&&_.ctrlKey&&window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:_.button}function ge(_,c,f){const v=_.offsetWidth===c.width?1:_.offsetWidth/c.width;return new s.P((f.clientX-c.left)*v,(f.clientY-c.top)*v)}class se{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(c,f){this._updatedSourceCaches[c]=f,this.setDirty()}discardSourceCacheUpdate(c){delete this._updatedSourceCaches[c]}updateLayer(c){const f=c.scope;this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._updatedLayers[f].add(c.id),this.setDirty()}removeLayer(c){const f=c.scope;this._removedLayers[f]=this._removedLayers[f]||{},this._updatedLayers[f]=this._updatedLayers[f]||new Set,this._removedLayers[f][c.id]=c,this._updatedLayers[f].delete(c.id),this._updatedPaintProps.delete(c.fqid),this.setDirty()}getRemovedLayer(c){return this._removedLayers[c.scope]?this._removedLayers[c.scope][c.id]:null}discardLayerRemoval(c){this._removedLayers[c.scope]&&delete this._removedLayers[c.scope][c.id]}getLayerUpdatesByScope(){const c={};for(const f in this._updatedLayers)c[f]=c[f]||{},c[f].updatedIds=Array.from(this._updatedLayers[f].values());for(const f in this._removedLayers)c[f]=c[f]||{},c[f].removedIds=Object.keys(this._removedLayers[f]);return c}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(c){this._updatedPaintProps.add(c.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(c){this._updatedImages.add(c),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}const Ie={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class We{constructor(c,f,v,w,S,M){this.length=f.length,this.attributes=v,this.itemSize=f.bytesPerElement,this.dynamicDraw=w,this.instanceCount=M,this.context=c;const k=c.gl;this.buffer=k.createBuffer(),c.bindVertexBuffer.set(this.buffer),k.bufferData(k.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?k.DYNAMIC_DRAW:k.STATIC_DRAW),this.dynamicDraw||S||f.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(c){const f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,c.arrayBuffer)}enableAttributes(c,f){for(let v=0;v<this.attributes.length;v++){const w=f.attributes[this.attributes[v].name];w!==void 0&&c.enableVertexAttribArray(w)}}setVertexAttribPointers(c,f,v){for(let w=0;w<this.attributes.length;w++){const S=this.attributes[w],M=f.attributes[S.name];M!==void 0&&c.vertexAttribPointer(M,S.components,c[Ie[S.type]],!1,this.itemSize,S.offset+this.itemSize*(v||0))}}setVertexAttribDivisor(c,f,v){for(let w=0;w<this.attributes.length;w++){const S=f.attributes[this.attributes[w].name];S!==void 0&&this.instanceCount&&this.instanceCount>0&&c.vertexAttribDivisor(S,v)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ze{constructor(c){this.gl=c.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(c){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class De extends ze{getDefault(){return s.C.transparent}set(c){const f=this.current;(c.r!==f.r||c.g!==f.g||c.b!==f.b||c.a!==f.a||this.dirty)&&(this.gl.clearColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class nt extends ze{getDefault(){return 1}set(c){(c!==this.current||this.dirty)&&(this.gl.clearDepth(c),this.current=c,this.dirty=!1)}}class It extends ze{getDefault(){return 0}set(c){(c!==this.current||this.dirty)&&(this.gl.clearStencil(c),this.current=c,this.dirty=!1)}}class Ot extends ze{getDefault(){return[!0,!0,!0,!0]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||this.dirty)&&(this.gl.colorMask(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class bt extends ze{getDefault(){return!0}set(c){(c!==this.current||this.dirty)&&(this.gl.depthMask(c),this.current=c,this.dirty=!1)}}class rt extends ze{getDefault(){return 255}set(c){(c!==this.current||this.dirty)&&(this.gl.stencilMask(c),this.current=c,this.dirty=!1)}}class Gt extends ze{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(c){const f=this.current;(c.func!==f.func||c.ref!==f.ref||c.mask!==f.mask||this.dirty)&&(this.gl.stencilFunc(c.func,c.ref,c.mask),this.current=c,this.dirty=!1)}}class Vt extends ze{getDefault(){const c=this.gl;return[c.KEEP,c.KEEP,c.KEEP]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||this.dirty)&&(this.gl.stencilOp(c[0],c[1],c[2]),this.current=c,this.dirty=!1)}}class Jt extends ze{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.STENCIL_TEST):f.disable(f.STENCIL_TEST),this.current=c,this.dirty=!1}}class wr extends ze{getDefault(){return[0,1]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||this.dirty)&&(this.gl.depthRange(c[0],c[1]),this.current=c,this.dirty=!1)}}class or extends ze{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.DEPTH_TEST):f.disable(f.DEPTH_TEST),this.current=c,this.dirty=!1}}class et extends ze{getDefault(){return this.gl.LESS}set(c){(c!==this.current||this.dirty)&&(this.gl.depthFunc(c),this.current=c,this.dirty=!1)}}class At extends ze{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.BLEND):f.disable(f.BLEND),this.current=c,this.dirty=!1}}class Qt extends ze{getDefault(){const c=this.gl;return[c.ONE,c.ZERO,c.ONE,c.ZERO]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||this.dirty)&&(this.gl.blendFuncSeparate(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class gr extends ze{getDefault(){return s.C.transparent}set(c){const f=this.current;(c.r!==f.r||c.g!==f.g||c.b!==f.b||c.a!==f.a||this.dirty)&&(this.gl.blendColor(c.r,c.g,c.b,c.a),this.current=c,this.dirty=!1)}}class Nt extends ze{getDefault(){return this.gl.FUNC_ADD}set(c){(c!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(c,c),this.current=c,this.dirty=!1)}}class Er extends ze{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;c?f.enable(f.CULL_FACE):f.disable(f.CULL_FACE),this.current=c,this.dirty=!1}}class Tr extends ze{getDefault(){return this.gl.BACK}set(c){(c!==this.current||this.dirty)&&(this.gl.cullFace(c),this.current=c,this.dirty=!1)}}class $r extends ze{getDefault(){return this.gl.CCW}set(c){(c!==this.current||this.dirty)&&(this.gl.frontFace(c),this.current=c,this.dirty=!1)}}let Xr=class extends ze{getDefault(){return null}set(_){(_!==this.current||this.dirty)&&(this.gl.useProgram(_),this.current=_,this.dirty=!1)}};class cn extends ze{getDefault(){return this.gl.TEXTURE0}set(c){(c!==this.current||this.dirty)&&(this.gl.activeTexture(c),this.current=c,this.dirty=!1)}}class Mn extends ze{getDefault(){const c=this.gl;return[0,0,c.drawingBufferWidth,c.drawingBufferHeight]}set(c){const f=this.current;(c[0]!==f[0]||c[1]!==f[1]||c[2]!==f[2]||c[3]!==f[3]||this.dirty)&&(this.gl.viewport(c[0],c[1],c[2],c[3]),this.current=c,this.dirty=!1)}}class mr extends ze{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindFramebuffer(f.FRAMEBUFFER,c),this.current=c,this.dirty=!1}}class vt extends ze{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindRenderbuffer(f.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class _e extends ze{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindTexture(f.TEXTURE_2D,c),this.current=c,this.dirty=!1}}class xe extends ze{getDefault(){return null}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.bindBuffer(f.ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class Re extends ze{getDefault(){return null}set(c){const f=this.gl;f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c),this.current=c,this.dirty=!1}}class ft extends ze{getDefault(){return null}set(c){this.gl&&(c!==this.current||this.dirty)&&(this.gl.bindVertexArray(c),this.current=c,this.dirty=!1)}}class gt extends ze{getDefault(){return 4}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_ALIGNMENT,c),this.current=c,this.dirty=!1}}class jt extends ze{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_PREMULTIPLY_ALPHA_WEBGL,c),this.current=c,this.dirty=!1}}class $t extends ze{getDefault(){return!1}set(c){if(c===this.current&&!this.dirty)return;const f=this.gl;f.pixelStorei(f.UNPACK_FLIP_Y_WEBGL,c),this.current=c,this.dirty=!1}}class yt extends ze{constructor(c,f){super(c),this.context=c,this.parent=f}getDefault(){return null}}class ir extends yt{setDirty(){this.dirty=!0}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class lr extends yt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferRenderbuffer(f.FRAMEBUFFER,this.attachment(),f.RENDERBUFFER,c),this.current=c,this.dirty=!1}}class fr extends yt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(c){if(c===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const f=this.gl;f.framebufferTexture2D(f.FRAMEBUFFER,this.attachment(),f.TEXTURE_2D,c,0),this.current=c,this.dirty=!1}}class Gr extends lr{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class pn{constructor(c,f,v,w,S){this.context=c,this.width=f,this.height=v;const M=this.framebuffer=c.gl.createFramebuffer();w&&(this.colorAttachment=new ir(c,M)),S&&(this.depthAttachmentType=S,this.depthAttachment=S==="renderbuffer"?new lr(c,M):new fr(c,M))}destroy(){const c=this.context.gl;if(this.colorAttachment){const f=this.colorAttachment.get();f&&c.deleteTexture(f)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const f=this.depthAttachment.get();f&&c.deleteRenderbuffer(f)}else{const f=this.depthAttachment.get();f&&c.deleteTexture(f)}c.deleteFramebuffer(this.framebuffer)}}class In{constructor(c,f){this.gl=c,this.clearColor=new De(this),this.clearDepth=new nt(this),this.clearStencil=new It(this),this.colorMask=new Ot(this),this.depthMask=new bt(this),this.stencilMask=new rt(this),this.stencilFunc=new Gt(this),this.stencilOp=new Vt(this),this.stencilTest=new Jt(this),this.depthRange=new wr(this),this.depthTest=new or(this),this.depthFunc=new et(this),this.blend=new At(this),this.blendFunc=new Qt(this),this.blendColor=new gr(this),this.blendEquation=new Nt(this),this.cullFace=new Er(this),this.cullFaceSide=new Tr(this),this.frontFace=new $r(this),this.program=new Xr(this),this.activeTexture=new cn(this),this.viewport=new Mn(this),this.bindFramebuffer=new mr(this),this.bindRenderbuffer=new vt(this),this.bindTexture=new _e(this),this.bindVertexBuffer=new xe(this),this.bindElementBuffer=new Re(this),this.bindVertexArrayOES=new ft(this),this.pixelStoreUnpack=new gt(this),this.pixelStoreUnpackPremultiplyAlpha=new jt(this),this.pixelStoreUnpackFlipY=new $t(this),this.options=f?{...f}:{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=c.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=c.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=c.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=c.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=c.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=c.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=c.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(c,f,v){return new s.I(this,c,f,v)}createVertexBuffer(c,f,v,w,S){return new We(this,c,f,v,w,S)}createRenderbuffer(c,f,v){const w=this.gl,S=w.createRenderbuffer();return this.bindRenderbuffer.set(S),w.renderbufferStorage(w.RENDERBUFFER,c,f,v),this.bindRenderbuffer.set(null),S}createFramebuffer(c,f,v,w){return new pn(this,c,f,v,w)}clear({color:c,depth:f,stencil:v,colorMask:w}){const S=this.gl;let M=0;c&&(M|=S.COLOR_BUFFER_BIT,this.clearColor.set(c),this.colorMask.set(w||[!0,!0,!0,!0])),f!==void 0&&(M|=S.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(f),this.depthMask.set(!0)),v!==void 0&&(M|=S.STENCIL_BUFFER_BIT,this.clearStencil.set(v),this.stencilMask.set(255)),S.clear(M)}setCullFace(c){c.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(c.mode),this.frontFace.set(c.frontFace))}setDepthMode(c){c.func!==this.gl.ALWAYS||c.mask?(this.depthTest.set(!0),this.depthFunc.set(c.func),this.depthMask.set(c.mask),this.depthRange.set(c.range)):this.depthTest.set(!1)}setStencilMode(c){c.test.func!==this.gl.ALWAYS||c.mask?(this.stencilTest.set(!0),this.stencilMask.set(c.mask),this.stencilOp.set([c.fail,c.depthFail,c.pass]),this.stencilFunc.set({func:c.test.func,ref:c.ref,mask:c.test.mask})):this.stencilTest.set(!1)}setColorMode(c){I(c.blendFunction,s.a.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(c.blendFunction),this.blendColor.set(c.blendColor),c.blendEquation?this.blendEquation.set(c.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(c.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class sn{constructor(c=0,f=0,v=0,w=0){if(isNaN(c)||c<0||isNaN(f)||f<0||isNaN(v)||v<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=c,this.bottom=f,this.left=v,this.right=w}interpolate(c,f,v){return f.top!=null&&c.top!=null&&(this.top=s.n(c.top,f.top,v)),f.bottom!=null&&c.bottom!=null&&(this.bottom=s.n(c.bottom,f.bottom,v)),f.left!=null&&c.left!=null&&(this.left=s.n(c.left,f.left,v)),f.right!=null&&c.right!=null&&(this.right=s.n(c.right,f.right,v)),this}getCenter(c,f){const v=s.c((this.left+c-this.right)/2,0,c),w=s.c((this.top+f-this.bottom)/2,0,f);return new s.P(v,w)}equals(c){return this.top===c.top&&this.bottom===c.bottom&&this.left===c.left&&this.right===c.right}clone(){return new sn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function mn(_,c){const f=s.g(_,3);s.m.fromQuat(_,c),s.s(_,3,f)}function Rr(_,c){const f=s.q.identity([]);return s.q.rotateZ(f,f,-c),s.q.rotateX(f,f,-_),f}function jn(_,c){const f=[_[0],_[1],0],v=[c[0],c[1],0];if(s.v.length(f)>=1e-15){const M=s.v.normalize([],f);s.v.scale(v,M,s.v.dot(v,M)),c[0]=v[0],c[1]=v[1]}const w=s.v.cross([],c,_);if(s.v.len(w)<1e-15)return null;const S=Math.atan2(-w[1],w[0]);return Rr(Math.atan2(Math.sqrt(_[0]*_[0]+_[1]*_[1]),-_[2]),S)}class Fn{constructor(c,f){this.position=c,this.orientation=f}get position(){return this._position}set position(c){if(c){const f=c instanceof s.M?c:new s.M(c[0],c[1],c[2]);this._renderWorldCopies&&(f.x=s.w(f.x,0,1)),this._position=f}else this._position=null}lookAtPoint(c,f){if(this.orientation=null,!this.position)return;const v=this.position,w=this._elevation?this._elevation.getAtPointOrZero(s.M.fromLngLat(c)):0,S=s.M.fromLngLat(c,w),M=[S.x-v.x,S.y-v.y,S.z-v.z];f||(f=[0,0,1]),f[2]=Math.abs(f[2]),this.orientation=jn(M,f)}setPitchBearing(c,f){this.orientation=Rr(s.d(c),s.d(-f))}}class Ii{constructor(c,f){this._transform=s.m.identity([]),this.orientation=f,this.position=c}get mercatorPosition(){const c=this.position;return new s.M(c[0],c[1],c[2])}get position(){const c=s.g(this._transform,3);return[c[0],c[1],c[2]]}set position(c){var f;c&&s.s(this._transform,3,[(f=c)[0],f[1],f[2],1])}get orientation(){return this._orientation}set orientation(c){this._orientation=c||s.q.identity([]),c&&mn(this._transform,this._orientation)}getPitchBearing(){const c=this.forward(),f=this.right();return{bearing:Math.atan2(-f[1],f[0]),pitch:Math.atan2(Math.sqrt(c[0]*c[0]+c[1]*c[1]),-c[2])}}setPitchBearing(c,f){this._orientation=Rr(c,f),mn(this._transform,this._orientation)}forward(){const c=s.g(this._transform,2);return[-c[0],-c[1],-c[2]]}up(){const c=s.g(this._transform,1);return[-c[0],-c[1],-c[2]]}right(){const c=s.g(this._transform,0);return[c[0],c[1],c[2]]}getCameraToWorld(c,f){const v=new Float64Array(16);return s.m.invert(v,this.getWorldToCamera(c,f)),v}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(c,f,v){const w=this.position;s.v.scale(w,w,-c);const S=new Float64Array(16);return s.m.fromScaling(S,[v,v,v]),s.m.translate(S,S,w),S[10]*=f,S}getWorldToCamera(c,f){const v=new Float64Array(16),w=new Float64Array(4),S=this.position;return s.q.conjugate(w,this._orientation),s.v.scale(S,S,-c),s.m.fromQuat(v,w),s.m.translate(v,v,S),v[1]*=-1,v[5]*=-1,v[9]*=-1,v[13]*=-1,v[8]*=f,v[9]*=f,v[10]*=f,v[11]*=f,v}getCameraToClipPerspective(c,f,v,w){const S=new Float64Array(16);return s.m.perspective(S,c,f,v,w),S}getCameraToClipOrthographic(c,f,v,w,S,M){const k=new Float64Array(16);return s.m.ortho(k,c,f,v,w,S,M),k}getDistanceToElevation(c,f=!1){const v=c===0?0:s.b(c,f?s.l(this.position[1]):this.position[1]),w=this.forward();return(v-this.position[2])/w[2]}clone(){return new Ii([...this.position],[...this.orientation])}}const ci={unknown:0,flipRequired:1,flipNotRequired:2},$n=Math.tan(85*Math.PI/180);function ii(_,c,f,v,w,S,M){const k=s.m.create();if(f)if(S.name==="globe"){const L=s.f(w,c);s.m.multiply(k,k,L)}else{const L=s.h.invert([],M);k[0]=L[0],k[1]=L[1],k[4]=L[2],k[5]=L[3],v||s.m.rotateZ(k,k,w.angle)}else s.m.multiply(k,w.labelPlaneMatrix,_);return k}function no(_,c,f,v,w,S,M){const k=ii(_,c,f,v,w,S,M);return S.name==="globe"&&f||(k[2]=k[6]=k[10]=k[14]=0),k}function Go(_,c,f,v,w,S,M){if(f){if(S.name==="globe"){const k=ii(_,c,f,v,w,S,M);return s.m.invert(k,k),s.m.multiply(k,_,k),k}{const k=s.m.clone(_),L=s.m.identity([]);return L[0]=M[0],L[1]=M[1],L[4]=M[2],L[5]=M[3],s.m.multiply(k,k,L),v||s.m.rotateZ(k,k,-w.angle),k}}return w.glCoordMatrix}function qe(_,c,f,v){const w=[_,c,f,1];f?s.e.transformMat4(w,w,v):Ft(w,w,v);const S=w[3];return w[0]/=S,w[1]/=S,w[2]/=S,w}function we(_,c){return Math.min(.5+_/c*.5,1.5)}function ke(_,c){const f=_[0]/_[3],v=_[1]/_[3];return f>=-c[0]&&f<=c[0]&&v>=-c[1]&&v<=c[1]}function Ue(_,c,f,v,w,S,M,k,L,F){const $=f.transform,Z=v?_.textSizeData:_.iconSizeData,K=s.i(Z,f.transform.zoom),ee=$.projection.name==="globe",ne=[256/f.width*2+1,256/f.height*2+1],oe=v?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;oe.clear();let ie=null;ee&&(ie=v?_.text.globeExtVertexArray:_.icon.globeExtVertexArray);const re=_.lineVertexArray,de=v?_.text.placedSymbolArray:_.icon.placedSymbolArray,be=f.transform.width/f.transform.height;let Ee,ce=!1;for(let fe=0;fe<de.length;fe++){const Ce=de.get(fe),{numGlyphs:Oe,writingMode:Ae}=Ce;if(Ae!==s.W.vertical||ce||Ee===s.W.horizontal||(ce=!0),Ee=Ae,(Ce.hidden||Ae===s.W.vertical)&&!ce){_t(Oe,oe);continue}ce=!1;const Le=new s.P(Ce.tileAnchorX,Ce.tileAnchorY);let{x:ut,y:He,z:Je}=$.projection.projectTilePoint(Le.x,Le.y,F.canonical);if(L){const[Bt,nr,Wt]=L(Le);ut+=Bt,He+=nr,Je+=Wt}const Be=[ut,He,Je,1];if(s.e.transformMat4(Be,Be,c),!ke(Be,ne)){_t(Oe,oe);continue}const lt=Be[3],Qe=we(f.transform.getCameraToCenterDistance($.projection),lt),dt=s.j(Z,K,Ce),ye=M?dt/Qe:dt*Qe,$e=qe(ut,He,Je,w);if($e[3]<=0){_t(Oe,oe);continue}let St={};const pt=M?null:L,Xt=it(Ce,ye,!1,k,c,w,S,_.glyphOffsetArray,re,oe,ie,$e,Le,St,be,pt,$.projection,F,M);ce=Xt.useVertical,pt&&Xt.needsFlipping&&(St={}),(Xt.notEnoughRoom||ce||Xt.needsFlipping&&it(Ce,ye,!0,k,c,w,S,_.glyphOffsetArray,re,oe,ie,$e,Le,St,be,pt,$.projection,F,M).notEnoughRoom)&&_t(Oe,oe)}v?(_.text.dynamicLayoutVertexBuffer.updateData(oe),ie&&_.text.globeExtVertexBuffer&&_.text.globeExtVertexBuffer.updateData(ie)):(_.icon.dynamicLayoutVertexBuffer.updateData(oe),ie&&_.icon.globeExtVertexBuffer&&_.icon.globeExtVertexBuffer.updateData(ie))}function Ze(_,c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne,oe){const{lineStartIndex:ie,glyphStartIndex:re,segment:de}=k,be=re+k.numGlyphs,Ee=ie+k.lineLength,ce=c.getoffsetX(re),fe=c.getoffsetX(be-1),Ce=xt(_*ce,f,v,w,S,M,de,ie,Ee,L,F,$,Z,K,!0,ee,ne,oe);if(!Ce)return null;const Oe=xt(_*fe,f,v,w,S,M,de,ie,Ee,L,F,$,Z,K,!0,ee,ne,oe);return Oe?{first:Ce,last:Oe}:null}function tt(_,c,f,v){return _===s.W.horizontal&&Math.abs(v)>Math.abs(f)?{useVertical:!0}:_===s.W.vertical?v>0?{needsFlipping:!0}:null:c!==ci.unknown&&function(w,S){return w===0||Math.abs(S/w)>$n}(f,v)?c===ci.flipRequired?{needsFlipping:!0}:null:f<0?{needsFlipping:!0}:null}function it(_,c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne,oe,ie,re,de){const be=c/24,Ee=_.lineOffsetX*be,ce=_.lineOffsetY*be,{lineStartIndex:fe,glyphStartIndex:Ce,numGlyphs:Oe,segment:Ae,writingMode:Le,flipState:ut}=_,He=fe+_.lineLength,Je=Be=>{if($){const[ye,$e,St]=Be.up,pt=F.length;s.u($,pt+0,ye,$e,St),s.u($,pt+1,ye,$e,St),s.u($,pt+2,ye,$e,St),s.u($,pt+3,ye,$e,St)}const[lt,Qe,dt]=Be.point;s.k(F,lt,Qe,dt,Be.angle)};if(Oe>1){const Be=Ze(be,k,Ee,ce,f,Z,K,_,L,S,ee,oe,!1,ie,re,de);if(!Be)return{notEnoughRoom:!0};if(v&&!f){let[lt,Qe,dt]=Be.first.point,[ye,$e,St]=Be.last.point;[lt,Qe]=qe(lt,Qe,dt,M),[ye,$e]=qe(ye,$e,St,M);const pt=tt(Le,ut,(ye-lt)*ne,$e-Qe);if(_.flipState=pt&&pt.needsFlipping?ci.flipRequired:ci.flipNotRequired,pt)return pt}Je(Be.first);for(let lt=Ce+1;lt<Ce+Oe-1;lt++){const Qe=xt(be*k.getoffsetX(lt),Ee,ce,f,Z,K,Ae,fe,He,L,S,ee,oe,!1,!1,ie,re,de);if(!Qe)return F.length-=4*(lt-Ce),{notEnoughRoom:!0};Je(Qe)}Je(Be.last)}else{if(v&&!f){const lt=qe(K.x,K.y,0,w),Qe=fe+Ae+1,dt=new s.P(L.getx(Qe),L.gety(Qe)),ye=qe(dt.x,dt.y,0,w),$e=ye[3]>0?ye:Ke(K,dt,lt,1,w,void 0,ie,re.canonical),St=tt(Le,ut,($e[0]-lt[0])*ne,$e[1]-lt[1]);if(_.flipState=St&&St.needsFlipping?ci.flipRequired:ci.flipNotRequired,St)return St}const Be=xt(be*k.getoffsetX(Ce),Ee,ce,f,Z,K,Ae,fe,He,L,S,ee,oe,!1,!1,ie,re,de);if(!Be)return{notEnoughRoom:!0};Je(Be)}return{}}function at(_,c,f,v,w){const{x:S,y:M,z:k}=v.projectTilePoint(_.x,_.y,c);if(!w)return qe(S,M,k,f);const[L,F,$]=w(_);return qe(S+L,M+F,k+$,f)}function Ke(_,c,f,v,w,S,M,k){const L=at(_.sub(c)._unit()._add(_),k,w,M,S);return s.v.sub(L,f,L),s.v.normalize(L,L),s.v.scaleAndAdd(L,f,L,v)}function xt(_,c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne,oe,ie,re){const de=v?_-c:_+c;let be=de>0?1:-1,Ee=0;v&&(be*=-1,Ee=Math.PI),be<0&&(Ee+=Math.PI);let ce=k+M+(be>0?0:1)|0,fe=w,Ce=w,Oe=0,Ae=0;const Le=Math.abs(de),ut=[],He=[];let Je=S,Be=Je;const lt=()=>Ke(Be,Je,Ce,Le-Oe+1,$,K,oe,ie.canonical);for(;Oe+Ae<=Le;){if(ce+=be,ce<k||ce>=L)return null;if(Ce=fe,Be=Je,ut.push(Ce),ee&&He.push(Be),Je=new s.P(F.getx(ce),F.gety(ce)),fe=Z[ce],!fe){const nr=at(Je,ie.canonical,$,oe,K);fe=nr[3]>0?Z[ce]=nr:lt()}Oe+=Ae,Ae=s.v.distance(Ce,fe)}ne&&K&&(Z[ce]&&(fe=lt(),Ae=s.v.distance(Ce,fe)),Z[ce]=fe);const Qe=(Le-Oe)/Ae,dt=Je.sub(Be)._mult(Qe)._add(Be),ye=s.v.sub([],fe,Ce),$e=s.v.scaleAndAdd([],Ce,ye,Qe);let St=[0,0,1],pt=ye[0],Xt=ye[1];if(re&&(St=oe.upVector(ie.canonical,dt.x,dt.y),St[0]!==0||St[1]!==0||St[2]!==1)){const nr=[St[2],0,-St[0]],Wt=s.v.cross([],St,nr);s.v.normalize(nr,nr),s.v.normalize(Wt,Wt),pt=s.v.dot(ye,nr),Xt=s.v.dot(ye,Wt)}if(f){const nr=s.v.cross([],St,ye);s.v.normalize(nr,nr),s.v.scaleAndAdd($e,$e,nr,f*be)}const Bt=Ee+Math.atan2(Xt,pt);return ut.push($e),ee&&He.push(dt),{point:$e,angle:Bt,path:ut,tilePath:He,up:St}}function _t(_,c){const f=c.length,v=f+4*_;c.resize(v),c.float32.fill(-1/0,4*f,4*v)}function Ft(_,c,f){const v=c[0],w=c[1];return _[0]=f[0]*v+f[4]*w+f[12],_[1]=f[1]*v+f[5]*w+f[13],_[3]=f[3]*v+f[7]*w+f[15],_}const pr=(_,c,f)=>(1-f)*_+f*c,Ut=_=>_*_*_*_*_;class Or{constructor(c,f,v,w,S,M,k){this.tileSize=512,this._renderWorldCopies=S===void 0||S,this._minZoom=c||0,this._maxZoom=f||22,this._minPitch=v??0,this._maxPitch=w??60,this.setProjection(M),this.setMaxBounds(k),this.width=0,this.height=0,this._center=new s.L(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new sn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ii,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){const c=new Or(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return c._elevation=this._elevation,c._centerAltitude=this._centerAltitude,c._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,c.tileSize=this.tileSize,c.mercatorFromTransition=this.mercatorFromTransition,c.width=this.width,c.height=this.height,c.cameraElevationReference=this.cameraElevationReference,c._center=this._center,c._setZoom(this.zoom),c._seaLevelZoom=this._seaLevelZoom,c.angle=this.angle,c._fov=this._fov,c._pitch=this._pitch,c._nearZ=this._nearZ,c._farZ=this._farZ,c._averageElevation=this._averageElevation,c._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,c._unmodified=this._unmodified,c._edgeInsets=this._edgeInsets.clone(),c._camera=this._camera.clone(),c._calcMatrices(),c.freezeTileCoverage=this.freezeTileCoverage,c.frustumCorners=this.frustumCorners,c}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(c){this._elevation!==c&&(this._elevation=c,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(c,f=!1){const v=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||v)&&this._updateCameraOnTerrain(),(c||v)&&this._constrainCamera(f),this._calcMatrices()}getProjection(){return s.p(this.projection,["name","center","parallels"])}setProjection(c){this.projectionOptions=c||{name:"mercator"};const f=this.projection?this.getProjection():void 0;this.projection=s.o(this.projectionOptions);const v=!I(f,this.getProjection());return v&&this._calcMatrices(),this.mercatorFromTransition=!1,v}setOrthographicProjectionAtLowPitch(c){return this._orthographicProjectionAtLowPitch!==c&&(this._orthographicProjectionAtLowPitch=c,this._calcMatrices(),!0)}setMercatorFromTransition(){const c=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=s.o({name:"mercator"});const f=c!==this.projection.name;return f&&this._calcMatrices(),f}get minZoom(){return this._minZoom}set minZoom(c){this._minZoom!==c&&(this._minZoom=c,this.zoom=Math.max(this.zoom,c))}get maxZoom(){return this._maxZoom}set maxZoom(c){this._maxZoom!==c&&(this._maxZoom=c,this.zoom=Math.min(this.zoom,c))}get minPitch(){return this._minPitch}set minPitch(c){this._minPitch!==c&&(this._minPitch=c,this.pitch=Math.max(this.pitch,c))}get maxPitch(){return this._maxPitch}set maxPitch(c){this._maxPitch!==c&&(this._maxPitch=c,this.pitch=Math.min(this.pitch,c))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(c){c===void 0?c=!0:c===null&&(c=!1),this._renderWorldCopies=c}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get cameraWorldSize(){const c=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(c))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return s.b(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new s.P(this.width,this.height)}get bearing(){return s.w(this.rotation,-180,180)}set bearing(c){this.rotation=c}get rotation(){return-this.angle/Math.PI*180}set rotation(c){const f=-c*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=s.h.create(),s.h.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(c){const f=s.c(c,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const c=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/c)}set fov(c){c=Math.max(.01,Math.min(60,c)),this._fov!==c&&(this._unmodified=!1,this._fov=s.d(c),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(c){this._averageElevation=c,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(c){const f=Math.min(Math.max(c,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._setZoom(f),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(c){this._zoom=c,this.scale=this.zoomScale(c),this.tileZoom=Math.floor(c),this.zoomFraction=c-this.tileZoom}_updateCameraOnTerrain(){const c=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,f=this.elevation&&c===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||c===Number.NEGATIVE_INFINITY&&(!f||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const v=this._elevation;f||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&v.exaggeration()&&this._centerAltitudeValidForExaggeration!==v.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*v.exaggeration(),this._centerAltitudeValidForExaggeration=v.exaggeration()):(this._centerAltitude=c||0,this._centerAltitudeValidForExaggeration=v.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const c=this._elevation,f=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],v=this.horizonLineFromTop();let w=0,S=0;for(let M=0;M<f.length;M++){const k=new s.P(f[M][0]*this.width,v+f[M][1]*(this.height-v)),L=c.pointCoordinate(k);if(!L)continue;const F=1/Math.hypot(L[0]-this._camera.position[0],L[1]-this._camera.position[1]);w+=L[3]*F,S+=F}return S===0?NaN:w/S}get center(){return this._center}set center(c){c.lat===this._center.lat&&c.lng===this._center.lng||(this._unmodified=!1,this._center=c,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const c=this._seaLevelZoom,f=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),v=this.pixelsPerMeter/this.worldSize*f,w=this._mercatorZfromZoom(c),S=this._mercatorZfromZoom(this._maxZoom),M=Math.max(w-v,S);this._setZoom(this._zoomFromMercatorZ(M))}get padding(){return this._edgeInsets.toJSON()}set padding(c){this._edgeInsets.equals(c)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,c,1),this._calcMatrices())}computeZoomRelativeTo(c){const f=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,c.toAltitude()));let v;v=c.z<this._camera.position[2]?[f.x,f.y,f.z]:[c.x,c.y,c.z];const w=s.v.length(s.v.sub([],this._camera.position,v));return s.c(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(c){if(!this.height||!c.position&&!c.orientation)return;this._updateCameraState();let f=!1;if(c.orientation&&!s.q.exactEquals(c.orientation,this._camera.orientation)&&(f=this._setCameraOrientation(c.orientation)),c.position){const v=[c.position.x,c.position.y,c.position.z];s.v.exactEquals(v,this._camera.position)||(this._setCameraPosition(v),f=!0)}f&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const c=this._camera.position,f=new Fn;return f.position=new s.M(c[0],c[1],c[2]),f.orientation=this._camera.orientation,f._elevation=this.elevation,f._renderWorldCopies=this.renderWorldCopies,f}_setCameraOrientation(c){if(!s.q.length(c))return!1;s.q.normalize(c,c);const f=s.v.transformQuat([],[0,0,-1],c),v=s.v.transformQuat([],[0,-1,0],c);if(v[2]<0)return!1;const w=jn(f,v);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(c){const f=this.zoomScale(this.minZoom)*this.tileSize,v=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;c[2]=s.c(c[2],w/v,w/f),this._camera.position=c}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(c){return this._edgeInsets.equals(c)}interpolatePadding(c,f,v){this._unmodified=!1,this._edgeInsets.interpolate(c,f,v),this._constrain(),this._calcMatrices()}coveringZoomLevel(c){const f=(c.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/c.tileSize));return Math.max(0,f)}getVisibleUnwrappedCoordinates(c){const f=[new s.U(0,c)];if(this.renderWorldCopies){const v=this.pointCoordinate(new s.P(0,0)),w=this.pointCoordinate(new s.P(this.width,0)),S=this.pointCoordinate(new s.P(this.width,this.height)),M=this.pointCoordinate(new s.P(0,this.height)),k=Math.floor(Math.min(v.x,w.x,S.x,M.x)),L=Math.floor(Math.max(v.x,w.x,S.x,M.x)),F=1;for(let $=k-F;$<=L+F;$++)$!==0&&f.push(new s.U($,c))}return f}isLODDisabled(c){return(!c||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(c,f,v){let w=[];if(f[0]===0&&f[1]===0)return w;for(const M of c){const k=M.canonical,L=M.overscaledZ,F=M.wrap,$=1<<k.z,Z=k.x+1<$,K=k.x>0,ee=k.y+1<$,ne=k.y>0,oe=M.wrap-(K?0:1),ie=M.wrap+(Z?0:1),re=K?k.x-1:$-1,de=Z?k.x+1:0;f[0]<0?(w.push(new s.O(L,ie,k.z,de,k.y)),f[1]<0&&ee&&(w.push(new s.O(L,F,k.z,k.x,k.y+1)),w.push(new s.O(L,ie,k.z,de,k.y+1))),f[1]>0&&ne&&(w.push(new s.O(L,F,k.z,k.x,k.y-1)),w.push(new s.O(L,ie,k.z,de,k.y-1)))):f[0]>0?(w.push(new s.O(L,oe,k.z,re,k.y)),f[1]<0&&ee&&(w.push(new s.O(L,F,k.z,k.x,k.y+1)),w.push(new s.O(L,oe,k.z,re,k.y+1))),f[1]>0&&ne&&(w.push(new s.O(L,F,k.z,k.x,k.y-1)),w.push(new s.O(L,oe,k.z,re,k.y-1)))):f[1]<0&&ee?w.push(new s.O(L,F,k.z,k.x,k.y+1)):ne&&w.push(new s.O(L,F,k.z,k.x,k.y-1))}if(w.length>1){w.sort((L,F)=>L.overscaledZ-F.overscaledZ||L.wrap-F.wrap||L.canonical.z-F.canonical.z||L.canonical.x-F.canonical.x||L.canonical.y-F.canonical.y);let M=0,k=0;for(;k<w.length;)w[k].equals(w[M])?++k:w[++M]=w[k++];w.length=M+1}const S=[];for(const M of w)w.some(k=>M.isChildOf(k))||S.push(M);return w=S.filter(M=>!c.some(k=>!!(M.overscaledZ<v&&k.isChildOf(M))||M.equals(k)||M.isChildOf(k))),w}coveringTiles(c){let f=this.coveringZoomLevel(c);const v=f,w=this.elevation&&this.elevation.exaggeration(),S=w&&!c.isTerrainDEM,M=this.projection.name==="mercator";if(c.minzoom!==void 0&&f<c.minzoom)return[];c.maxzoom!==void 0&&f>c.maxzoom&&(f=c.maxzoom);const k=this.locationCoordinate(this.center),L=this.center.lat,F=1<<f,$=[F*k.x,F*k.y,0],Z=this.projection.name==="globe",K=!Z,ee=s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f,K),ne=Z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),oe=F*s.b(1,this.center.lat),ie=this._camera.position[2]/s.b(1,this.center.lat),re=[F*ne.x,F*ne.y,ie*(K?1:oe)],de=Z||w,be=this.cameraToCenterDistance/c.tileSize*(c.roundZoom?1:.502),Ee=this.isLODDisabled(!0)?f:0;let ce;if(this._elevation&&c.isTerrainDEM)ce=1e4*this._elevation.exaggeration();else if(this._elevation){const ye=this._elevation.getMinMaxForVisibleTiles();ce=ye?ye.max:this._centerAltitude}else ce=this._centerAltitude;const fe=c.isTerrainDEM?-ce:this._elevation?this._elevation.getMinElevationBelowMSL():0,Ce=this.projection.isReprojectedInTileSpace?s.r(this):1,Oe=ye=>{const St=new s.M(ye.x+25e-6,ye.y,ye.z),pt=new s.M(ye.x,ye.y+25e-6,ye.z),Xt=ye.toLngLat(),Bt=St.toLngLat(),nr=pt.toLngLat(),Wt=this.locationCoordinate(Xt),cr=this.locationCoordinate(Bt),ur=this.locationCoordinate(nr),er=Math.hypot(cr.x-Wt.x,cr.y-Wt.y),tr=Math.hypot(ur.x-Wt.x,ur.y-Wt.y);return Math.sqrt(er*tr)*Ce/25e-6},Ae=ye=>{const $e=ce,St=fe;return{aabb:s.y(this,F,0,0,0,ye,St,$e,this.projection),zoom:0,x:0,y:0,minZ:St,maxZ:$e,wrap:ye,fullyVisible:!1}},Le=[];let ut=[];const He=f,Je=c.reparseOverscaled?v:f,Be=ye=>ye*ye,lt=Be((ie-this._centerAltitude)*oe),Qe=ye=>{if(!this._elevation||!ye.tileID||!M)return;const $e=this._elevation.getMinMaxForTile(ye.tileID),St=ye.aabb;$e?(St.min[2]=$e.min,St.max[2]=$e.max,St.center[2]=(St.min[2]+St.max[2])/2):(ye.shouldSplit=dt(ye),ye.shouldSplit||(St.min[2]=St.max[2]=St.center[2]=this._centerAltitude))},dt=ye=>{if(ye.zoom<Ee)return!0;if(ye.zoom===He)return!1;if(ye.shouldSplit!=null)return ye.shouldSplit;const $e=ye.aabb.distanceX(re),St=ye.aabb.distanceY(re);let pt=lt,Xt=1;if(Z){pt=Be(ye.aabb.distanceZ(re));const Wt=Math.pow(2,ye.zoom),cr=s.l((ye.y+1)/Wt),ur=s.l(ye.y/Wt),er=Math.min(Math.max(L,cr),ur),tr=s.a0(er)/s.a0(L);if(Xt=er===L?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,tr/this._mercatorScaleRatio),this.zoom<=s.Z&&ye.zoom===He-1&&tr>=.9)return!0}else if(S&&(pt=Be(ye.aabb.distanceZ(re)*oe)),this.projection.isReprojectedInTileSpace&&v<=5){const Wt=Math.pow(2,ye.zoom),cr=Oe(new s.M((ye.x+.5)/Wt,(ye.y+.5)/Wt));Xt=cr>.85?1:cr}const Bt=$e*$e+St*St+pt,nr=Be((1<<He-ye.zoom)*be*Xt*((Wt,cr)=>{if(cr*Be(.707)<Wt)return 1;const ur=Math.sqrt(cr/Wt);return ur/(1.4144271570014144+(Math.pow(1.1,ur-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(pt,lt),Bt));return Bt<nr};if(this.renderWorldCopies)for(let ye=1;ye<=3;ye++)Le.push(Ae(-ye)),Le.push(Ae(ye));for(Le.push(Ae(0));Le.length>0;){const ye=Le.pop(),$e=ye.x,St=ye.y;let pt=ye.fullyVisible;const Xt=()=>this.projection.name==="globe"&&(ye.y===0||ye.y===(1<<ye.zoom)-1);if(!pt){let Bt=de?ye.aabb.intersects(ee):ye.aabb.intersectsFlat(ee);if(Bt===0&&Xt()){const nr=new s.t(ye.zoom,$e,St);Bt=s.x(this,F,nr,!0).intersects(ee)}if(Bt===0)continue;pt=Bt===2}if(ye.zoom!==He&&dt(ye))for(let Bt=0;Bt<4;Bt++){const nr=($e<<1)+Bt%2,Wt=(St<<1)+(Bt>>1),cr={aabb:M?ye.aabb.quadrant(Bt):s.y(this,F,ye.zoom+1,nr,Wt,ye.wrap,ye.minZ,ye.maxZ,this.projection),zoom:ye.zoom+1,x:nr,y:Wt,wrap:ye.wrap,fullyVisible:pt,tileID:void 0,shouldSplit:void 0,minZ:ye.minZ,maxZ:ye.maxZ};S&&!Z&&(cr.tileID=new s.O(ye.zoom+1===He?Je:ye.zoom+1,ye.wrap,ye.zoom+1,nr,Wt),Qe(cr)),Le.push(cr)}else{const Bt=ye.zoom===He?Je:ye.zoom;if(c.minzoom&&c.minzoom>Bt)continue;if(!pt){let ur=de?ye.aabb.intersectsPrecise(ee):ye.aabb.intersectsPreciseFlat(ee);if(ur===0&&Xt()){const er=new s.t(ye.zoom,$e,St);ur=s.x(this,F,er,!0).intersectsPrecise(ee)}if(ur===0)continue}const nr=$[0]-(.5+$e+(ye.wrap<<ye.zoom))*(1<<f-ye.zoom),Wt=$[1]-.5-St,cr=ye.tileID?ye.tileID:new s.O(Bt,ye.wrap,ye.zoom,$e,St);ut.push({tileID:cr,distanceSq:nr*nr+Wt*Wt})}}if(this.fogCullDistSq){const ye=this.fogCullDistSq,$e=this.horizonLineFromTop();ut=ut.filter(St=>{const pt=[0,0,0,1],Xt=[s.J,s.J,0,1],Bt=this.calculateFogTileMatrix(St.tileID.toUnwrapped());s.e.transformMat4(pt,pt,Bt),s.e.transformMat4(Xt,Xt,Bt);const nr=s.e.min([],pt,Xt),Wt=s.e.max([],pt,Xt),cr=s.z(nr,Wt);if(cr===0)return!0;let ur=!1;const er=this._elevation;if(er&&cr>ye&&$e!==0){const tr=this.calculateProjMatrix(St.tileID.toUnwrapped());let Yr;c.isTerrainDEM||(Yr=er.getMinMaxForTile(St.tileID)),Yr||(Yr={min:fe,max:ce});const Cr=s._(this.rotation),kn=[Cr[0]*s.J,Cr[1]*s.J,Yr.max];s.v.transformMat4(kn,kn,tr),ur=(1-kn[1])*this.height*.5<$e}return cr<ye||ur})}return ut.sort((ye,$e)=>ye.distanceSq-$e.distanceSq).map(ye=>ye.tileID)}resize(c,f){this.width=c,this.height=f,this.pixelsToGLUnits=[2/c,-2/f],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(c){return Math.pow(2,c)}scaleZoom(c){return Math.log(c)/Math.LN2}project(c){const f=s.c(c.lat,-s.A,s.A),v=this.projection.project(c.lng,f);return new s.P(v.x*this.worldSize,v.y*this.worldSize)}unproject(c){return this.projection.unproject(c.x/this.worldSize,c.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/s.b(1,this.center.lat)/this.worldSize}setLocationAtPoint(c,f){let v,w;const S=this.centerPoint;if(this.projection.name==="globe"){const k=this.worldSize;v=(f.x-S.x)/k,w=(f.y-S.y)/k}else{const k=this.pointCoordinate(f),L=this.pointCoordinate(S);v=k.x-L.x,w=k.y-L.y}const M=this.locationCoordinate(c);this.setLocation(new s.M(M.x-v,M.y-w))}setLocation(c){this.center=this.coordinateLocation(c),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(c){return this.projection.locationPoint(this,c)}locationPoint3D(c){return this.projection.locationPoint(this,c,!0)}pointLocation(c){return this.coordinateLocation(this.pointCoordinate(c))}pointLocation3D(c){return this.coordinateLocation(this.pointCoordinate3D(c))}locationCoordinate(c,f){const v=f?s.b(f,c.lat):void 0,w=this.projection.project(c.lng,c.lat);return new s.M(w.x,w.y,v)}coordinateLocation(c){return this.projection.unproject(c.x,c.y)}pointRayIntersection(c,f){const v=f??this._centerAltitude,w=[c.x,c.y,0,1],S=[c.x,c.y,1,1];s.e.transformMat4(w,w,this.pixelMatrixInverse),s.e.transformMat4(S,S,this.pixelMatrixInverse);const M=S[3];s.e.scale(w,w,1/w[3]),s.e.scale(S,S,1/M);const k=w[2],L=S[2];return{p0:w,p1:S,t:k===L?0:(v-k)/(L-k)}}screenPointToMercatorRay(c){const f=[c.x,c.y,0,1],v=[c.x,c.y,1,1];return s.e.transformMat4(f,f,this.pixelMatrixInverse),s.e.transformMat4(v,v,this.pixelMatrixInverse),s.e.scale(f,f,1/f[3]),s.e.scale(v,v,1/v[3]),f[2]=s.b(f[2],this._center.lat)*this.worldSize,v[2]=s.b(v[2],this._center.lat)*this.worldSize,s.e.scale(f,f,1/this.worldSize),s.e.scale(v,v,1/this.worldSize),new s.R([f[0],f[1],f[2]],s.v.normalize([],s.v.sub([],v,f)))}rayIntersectionCoordinate(c){const{p0:f,p1:v,t:w}=c,S=s.b(f[2],this._center.lat),M=s.b(v[2],this._center.lat);return new s.M(s.n(f[0],v[0],w)/this.worldSize,s.n(f[1],v[1],w)/this.worldSize,s.n(S,M,w))}pointCoordinate(c,f=this._centerAltitude){return this.projection.pointCoordinate(this,c.x,c.y,f)}pointCoordinate3D(c){if(!this.elevation)return this.pointCoordinate(c);let f=this.projection.pointCoordinate3D(this,c.x,c.y);if(f)return new s.M(f[0],f[1],f[2]);let v=0,w=this.horizonLineFromTop();if(c.y>w)return this.pointCoordinate(c);const S=.02*w,M=c.clone();for(let k=0;k<10&&w-v>S;k++){M.y=s.n(v,w,.66);const L=this.projection.pointCoordinate3D(this,M.x,M.y);L?(w=M.y,f=L):v=M.y}return f?new s.M(f[0],f[1],f[2]):this.pointCoordinate(c)}isPointAboveHorizon(c){return this.projection.isPointAboveHorizon(this,c)}isPointOnSurface(c){if(c.y<0||c.y>this.height||c.x<0||c.x>this.width)return!1;if(this.elevation||this.zoom>=s.G)return!this.isPointAboveHorizon(c);const f=this.pointCoordinate(c);return f.y>=0&&f.y<=1}_coordinatePoint(c,f){const v=f&&this.elevation?this.elevation.getAtPointOrZero(c,this._centerAltitude):this._centerAltitude,w=[c.x*this.worldSize,c.y*this.worldSize,v+c.toAltitude(),1];return s.e.transformMat4(w,w,this.pixelMatrix),w[3]>0?new s.P(w[0]/w[3],w[1]/w[3]):new s.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:c,left:f}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,S=this.pointLocation3D(new s.P(f,c)),M=this.pointLocation3D(new s.P(w,c)),k=this.pointLocation3D(new s.P(w,v)),L=this.pointLocation3D(new s.P(f,v));let F=Math.min(S.lng,M.lng,k.lng,L.lng),$=Math.max(S.lng,M.lng,k.lng,L.lng),Z=Math.min(S.lat,M.lat,k.lat,L.lat),K=Math.max(S.lat,M.lat,k.lat,L.lat);const ee=Math.pow(2,-this.zoom)/16*270,ne=this.projection.name==="globe"?1:4,oe=(ie,re,de,be,Ee)=>{const ce=(ie+de)/2,fe=(re+be)/2,Ce=new s.P(ce,fe),{lng:Oe,lat:Ae}=this.pointLocation3D(Ce),Le=Math.max(0,F-Oe,Z-Ae,Oe-$,Ae-K);F=Math.min(F,Oe),$=Math.max($,Oe),Z=Math.min(Z,Ae),K=Math.max(K,Ae),(Ee<ne||Le>ee)&&(oe(ie,re,ce,fe,Ee+1),oe(ce,fe,de,be,Ee+1))};if(oe(f,c,w,c,1),oe(w,c,w,v,1),oe(w,v,f,v,1),oe(f,v,f,c,1),this.projection.name==="globe"){const[ie,re]=s.B(this);ie?(K=90,$=180,F=-180):re&&(Z=-90,$=180,F=-180)}return new s.D(new s.L(F,Z),new s.L($,K))}_getBoundsRectangular(c,f){const{top:v,left:w}=this._edgeInsets,S=this.height-this._edgeInsets.bottom,M=this.width-this._edgeInsets.right,k=new s.P(w,v),L=new s.P(M,v),F=new s.P(M,S),$=new s.P(w,S);let Z=this.pointCoordinate(k,c),K=this.pointCoordinate(L,c);const ee=this.pointCoordinate(F,f),ne=this.pointCoordinate($,f),oe=(ie,re)=>(re.y-ie.y)/(re.x-ie.x);return Z.y>1&&K.y>=0?Z=new s.M((1-ne.y)/oe(ne,Z)+ne.x,1):Z.y<0&&K.y<=1&&(Z=new s.M(-ne.y/oe(ne,Z)+ne.x,0)),K.y>1&&Z.y>=0?K=new s.M((1-ee.y)/oe(ee,K)+ee.x,1):K.y<0&&Z.y<=1&&(K=new s.M(-ee.y/oe(ee,K)+ee.x,0)),new s.D().extend(this.coordinateLocation(Z)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(ne)).extend(this.coordinateLocation(ee))}_getBoundsRectangularTerrain(){const c=this.elevation;if(!c.visibleDemTiles.length||c.isUsingMockSource())return this._getBoundsRectangular(0,0);const f=c.visibleDemTiles.reduce((v,w)=>{if(w.dem){const S=w.dem.tree;v.min=Math.min(v.min,S.minimums[0]),v.max=Math.max(v.max,S.maximums[0])}return v},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(f.min*c.exaggeration(),f.max*c.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(c=!0){const f=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,v=this.height/2-f*(1-this._horizonShift);return c?Math.max(0,v):v}getMaxBounds(){return this.maxBounds}setMaxBounds(c){this.maxBounds=c,this.minLat=-s.A,this.maxLat=s.A,this.minLng=-180,this.maxLng=180,c&&(this.minLat=c.getSouth(),this.maxLat=c.getNorth(),this.minLng=c.getWest(),this.maxLng=c.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=s.E(this.minLng)*this.tileSize,this.worldMaxX=s.E(this.maxLng)*this.tileSize,this.worldMinY=s.H(this.maxLat)*this.tileSize,this.worldMaxY=s.H(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(c,f){return this.projection.createTileMatrix(this,f,c)}calculateDistanceTileData(c){const f=c.key,v=this._distanceTileDataCache;if(v[f])return v[f];const w=c.canonical,S=1/this.height,M=this.cameraWorldSize,k=M/this.zoomScale(w.z),L=(w.x+Math.pow(2,w.z)*c.wrap)*k,F=w.y*k,$=this.point;$.x*=M/this.worldSize,$.y*=M/this.worldSize;const Z=this.angle,K=Math.sin(-Z),ee=-Math.cos(-Z);return v[f]={bearing:[K,ee],center:[($.x-L)*S,($.y-F)*S],scale:k/s.J*S},v[f]}calculateFogTileMatrix(c){const f=c.key,v=this._fogTileMatrixCache;if(v[f])return v[f];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,c);return s.m.multiply(w,this.worldToFogMatrix,w),v[f]=new Float32Array(w),v[f]}calculateProjMatrix(c,f=!1,v=!1){const w=c.key;let S;if(S=v?this._expandedProjMatrixCache:f?this._alignedProjMatrixCache:this._projMatrixCache,S[w])return S[w];const M=this.calculatePosMatrix(c,this.worldSize);let k;return k=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:v?this.expandedFarZProjMatrix:f?this.alignedProjMatrix:this.projMatrix,s.m.multiply(M,k,M),S[w]=new Float32Array(M),S[w]}calculatePixelsToTileUnitsMatrix(c){const f=c.tileID.key,v=this._pixelsToTileUnitsCache;if(v[f])return v[f];const w=s.K(c,this);return v[f]=w,v[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const c=1/this.worldSize,f=s.m.fromScaling([],[c,c,c]);return s.m.multiply(f,f,this.globeMatrix),f}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const c=this._elevation;this._updateCameraState();const f=s.b(1,this._center.lat)*this.worldSize,v=this._computeCameraPosition(f),w=this._camera.forward(),S=s.b(1,this._center.lat);v[2]/=S,w[2]/=S,s.v.normalize(w,w);const M=c.raycast(v,w,c.exaggeration());if(M){const k=s.v.scaleAndAdd([],v,w,M),L=new s.M(k[0],k[1],s.b(k[2],s.l(k[1]))),F=(L.z+s.v.length([L.x-v[0],L.y-v[1],L.z-v[2]*S]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(F),this._centerAltitude=L.toAltitude(),this._center=this.coordinateLocation(L),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(c=!1){if(!this._elevation)return;const f=this._elevation,v=s.b(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(v),S=f.getAtPointOrZero(new s.M(...w)),M=this.pixelsPerMeter/this.worldSize*S,k=this._minimumHeightOverTerrain(),L=w[2]-M;if(L<=k)if(L<0||c){const F=this.locationCoordinate(this._center,this._centerAltitude),$=[w[0],w[1],F.z-w[2]],Z=s.v.length($);$[2]-=(k-L)/this._pixelsPerMercatorPixel;const K=s.v.length($);if(K===0)return;s.v.scale($,$,Z/K*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],F.z*this._pixelsPerMercatorPixel-$[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const c=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||c){const K=this.center;return K.lat=s.c(K.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!c)&&(K.lng=s.c(K.lng,this.minLng,this.maxLng)),this.center=K,void(this._constraining=!1)}const f=this._unmodified,{x:v,y:w}=this.point;let S=0,M=v,k=w;const L=this.width/2,F=this.height/2,$=this.worldMinY*this.scale,Z=this.worldMaxY*this.scale;if(w-F<$&&(k=$+F),w+F>Z&&(k=Z-F),Z-$<this.height&&(S=Math.max(S,this.height/(Z-$)),k=(Z+$)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const K=this.worldMinX*this.scale,ee=this.worldMaxX*this.scale,ne=this.worldSize/2-(K+ee)/2;M=(v+ne+this.worldSize)%this.worldSize-ne,M-L<K&&(M=K+L),M+L>ee&&(M=ee-L),ee-K<this.width&&(S=Math.max(S,this.width/(ee-K)),M=(ee+K)/2)}M===v&&k===w||(this.center=this.unproject(new s.P(M,k))),S&&(this.zoom+=this.scaleZoom(S)),this._constrainCamera(),this._unmodified=f,this._constraining=!1}_minZoomForBounds(){let c=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(c=Math.max(c,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),c}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const c=this.centerOffset,f=this.projection.name==="globe",v=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=s.b(1,this.center.lat)/s.b(1,s.$));const w=s.N(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,w),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const S=this.projection.zAxisUnit==="meters"?v:1,M=this._camera.getWorldToCamera(this.worldSize,S);let k;const L=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(L[8]=2*-c.x/this.width,L[9]=2*c.y/this.height,this.isOrthographic){let Ae=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Le=Ae*this.aspect,ut=-Le,He=-Ae;Le-=c.x,ut-=c.x,Ae+=c.y,He+=c.y,k=this._camera.getCameraToClipOrthographic(ut,Le,He,Ae,this._nearZ,this._farZ),((Je,Be,lt,Qe)=>{for(let dt=0;dt<16;dt++)Je[dt]=pr(Be[dt],lt[dt],Qe)})(k,k,L,Ut(this.pitch>=15?1:this.pitch/15))}else k=L;const F=s.m.mul([],L,M);let $=s.m.mul([],k,M);if(this.projection.isReprojectedInTileSpace){const Ae=this.locationCoordinate(this.center),Le=s.m.identity([]);s.m.translate(Le,Le,[Ae.x*this.worldSize,Ae.y*this.worldSize,0]),s.m.multiply(Le,Le,s.Q(this)),s.m.translate(Le,Le,[-Ae.x*this.worldSize,-Ae.y*this.worldSize,0]),s.m.multiply($,$,Le),s.m.multiply(F,F,Le),this.inverseAdjustmentMatrix=s.S(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=s.m.scale([],$,[this.worldSize,this.worldSize,this.worldSize/S,1]),this.projMatrix=$,this.invProjMatrix=s.m.invert(new Float64Array(16),this.projMatrix),f){const Ae=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);Ae[8]=2*-c.x/this.width,Ae[9]=2*c.y/this.height,this.expandedFarZProjMatrix=s.m.mul([],Ae,M)}else this.expandedFarZProjMatrix=this.projMatrix;const Z=s.m.invert([],k);this.frustumCorners=s.T.fromInvProjectionMatrix(Z,this.horizonLineFromTop(),this.height),this.cameraFrustum=s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!f);const K=new Float32Array(16);s.m.identity(K),s.m.scale(K,K,[1,-1,1]),s.m.rotateX(K,K,this._pitch),s.m.rotateZ(K,K,this.angle);const ee=s.m.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=s.m.clone(ee);const ne=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;ee[8]=2*-c.x/this.width,ee[9]=2*(c.y+ne)/this.height,this.skyboxMatrix=s.m.multiply(K,ee,K);const oe=this.point,ie=oe.x,re=oe.y,de=this.width%2/2,be=this.height%2/2,Ee=Math.cos(this.angle),ce=Math.sin(this.angle),fe=ie-Math.round(ie)+Ee*de+ce*be,Ce=re-Math.round(re)+Ee*be+ce*de,Oe=new Float64Array($);if(s.m.translate(Oe,Oe,[fe>.5?fe-1:fe,Ce>.5?Ce-1:Ce,0]),this.alignedProjMatrix=Oe,$=s.m.create(),s.m.scale($,$,[this.width/2,-this.height/2,1]),s.m.translate($,$,[1,-1,0]),this.labelPlaneMatrix=$,$=s.m.create(),s.m.scale($,$,[1,-1,1]),s.m.translate($,$,[-1,-1,0]),s.m.scale($,$,[2/this.width,2/this.height,1]),this.glCoordMatrix=$,this.pixelMatrix=s.m.multiply(new Float64Array(16),this.labelPlaneMatrix,F),this._calcFogMatrices(),this._distanceTileDataCache={},$=s.m.invert(new Float64Array(16),this.pixelMatrix),!$)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=$,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=s.V(this);const Ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=s.v.transformMat4(Ae,Ae,M),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=$;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const c=this.cameraWorldSizeForFog,f=this.cameraPixelsPerMeter,v=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,S=[c,c,f];s.v.scale(S,S,w),s.v.scale(v,v,-1),s.v.multiply(v,v,S);const M=s.m.create();s.m.translate(M,M,v),s.m.scale(M,M,S),this.mercatorFogMatrix=M,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(c,f,w)}_computeCameraPosition(c){const f=(c=c||this.pixelsPerMeter)/this.pixelsPerMeter,v=this._camera.forward(),w=this.point,S=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*f-c/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-v[0]*S,w.y/this.worldSize-v[1]*S,c/this.worldSize*this._centerAltitude-v[2]*S]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(c){const f=this._maxCameraBoundsDistance()*Math.cos(this._pitch),v=this._camera.position[2],w=c[2];let S=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(S=Math.min((f-v)/w,1)),this._camera.position=s.v.scaleAndAdd([],this._camera.position,c,S),this._updateStateFromCamera()}_updateStateFromCamera(){const c=this._camera.position,f=this._camera.forward(),{pitch:v,bearing:w}=this._camera.getPitchBearing(),S=s.b(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,M=this._mercatorZfromZoom(this._maxZoom)*Math.cos(s.d(this._maxPitch)),k=Math.max((c[2]-S)/Math.cos(v),M),L=this._zoomFromMercatorZ(k);s.v.scaleAndAdd(c,c,f,k),this._pitch=s.c(v,s.d(this.minPitch),s.d(this.maxPitch)),this.angle=s.w(w,-Math.PI,Math.PI),this._setZoom(s.c(L,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new s.M(c[0],c[1],c[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(c){return Math.pow(2,c)*this.tileSize}_mercatorZfromZoom(c){return this.cameraToCenterDistance/this._worldSizeFromZoom(c)}_minimumHeightOverTerrain(){const c=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(c)}_zoomFromMercatorZ(c){return this.scaleZoom(this.cameraToCenterDistance/(c*this.tileSize))}zoomFromMercatorZAdjusted(c){let f=0,v=s.G,w=0,S=1/0;for(;v-f>1e-6&&v>f;){const M=f+.5*(v-f),k=this.tileSize*Math.pow(2,M),L=this.getCameraToCenterDistance(this.projection,M,k),F=this.scaleZoom(L/(c*this.tileSize)),$=Math.abs(M-F);$<S&&(S=$,w=M),M<F?f=M:v=M}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(s.X("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(c,f){const v=Math.min(c.x,f.x),w=Math.max(c.x,f.x),S=Math.min(c.y,f.y),M=Math.max(c.y,f.y);if(S<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const k=[new s.P(v,S),new s.P(w,M),new s.P(v,M),new s.P(w,S)],L=this.renderWorldCopies?-3:0,F=this.renderWorldCopies?4:1;for(const $ of k){const Z=this.pointRayIntersection($);if(Z.t<0)return!0;const K=this.rayIntersectionCoordinate(Z);if(K.x<L||K.y<0||K.x>F||K.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+s.Y(this.fovAboveCenter)>88||this.anyCornerOffEdge(new s.P(0,0),new s.P(this.width,this.height))}zoomDeltaToMovement(c,f){const v=s.v.length(s.v.sub([],this._camera.position,c)),w=this._zoomFromMercatorZ(v)+f;return v-this._mercatorZfromZoom(w)}getCameraPoint(){if(this.projection.name==="globe"){const c=function([f,v,w],S){const M=[f,v,w,1];s.e.transformMat4(M,M,S);const k=M[3]=Math.max(M[3],1e-6);return M[0]/=k,M[1]/=k,M[2]/=k,M}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new s.P(c[0],c[1])}{const c=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new s.P(0,c))}}getCameraToCenterDistance(c,f=this.zoom,v=this.worldSize){const w=s.N(c,f,this.width,this.height,1024),S=c.pixelSpaceConversion(this.center.lat,v,w);let M=.5/Math.tan(.5*this._fov)*this.height*S;return this.isOrthographic&&(M=pr(1,M,Ut(this.pitch>=15?1:this.pitch/15))),M}getWorldToCameraMatrix(){const c=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&s.m.multiply(c,c,this.globeMatrix),c}getFrustum(c){return s.F.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,this.projection.zAxisUnit==="meters")}}function Lr(_){const{userImage:c}=_;return!!(c&&c.render&&c.render())&&(_.data.replace(new Uint8Array(c.data.buffer)),!0)}class Kr extends s.a6{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(c){this.images[c]={},this.loaded[c]=!1,this.updatedImages[c]={},this.patterns[c]={},this.callbackDispatchedThisFrame[c]={},this.atlasImage[c]=new s.a5({width:1,height:1})}isLoaded(){for(const c in this.loaded)if(!this.loaded[c])return!1;return!0}setLoaded(c,f){if(this.loaded[f]!==c&&(this.loaded[f]=c,c)){for(const{ids:v,callback:w}of this.requestors)this._notify(v,f,w);this.requestors=[]}}hasImage(c,f){return!!this.getImage(c,f)}getImage(c,f){return this.images[f][c]}addImage(c,f,v){this._validate(c,v)&&(this.images[f][c]=v)}_validate(c,f){let v=!0;return this._validateStretch(f.stretchX,f.data&&f.data.width)||(this.fire(new s.a7(new Error(`Image "${c}" has invalid "stretchX" value`))),v=!1),this._validateStretch(f.stretchY,f.data&&f.data.height)||(this.fire(new s.a7(new Error(`Image "${c}" has invalid "stretchY" value`))),v=!1),this._validateContent(f.content,f)||(this.fire(new s.a7(new Error(`Image "${c}" has invalid "content" value`))),v=!1),v}_validateStretch(c,f){if(!c)return!0;let v=0;for(const w of c){if(w[0]<v||w[1]<w[0]||f<w[1])return!1;v=w[1]}return!0}_validateContent(c,f){return!(c&&(c.length!==4||c[0]<0||f.data.width<c[0]||c[1]<0||f.data.height<c[1]||c[2]<0||f.data.width<c[2]||c[3]<0||f.data.height<c[3]||c[2]<c[0]||c[3]<c[1]))}updateImage(c,f,v){v.version=this.images[f][c].version+1,this.images[f][c]=v,this.updatedImages[f][c]=!0}removeImage(c,f){const v=this.images[f][c];delete this.images[f][c],delete this.patterns[f][c],v.userImage&&v.userImage.onRemove&&v.userImage.onRemove()}listImages(c){return Object.keys(this.images[c])}getImages(c,f,v){let w=!0;const S=!!this.loaded[f];if(!S)for(const M of c)this.images[f][M]||(w=!1);S||w?this._notify(c,f,v):this.requestors.push({ids:c,scope:f,callback:v})}getUpdatedImages(c){return this.updatedImages[c]}_notify(c,f,v){const w={};for(const S of c){this.images[f][S]||this.fire(new s.a8("styleimagemissing",{id:S}));const M=this.images[f][S];M?w[S]={data:M.data.clone(),pixelRatio:M.pixelRatio,sdf:M.sdf,version:M.version,stretchX:M.stretchX,stretchY:M.stretchY,content:M.content,hasRenderCallback:!!(M.userImage&&M.userImage.render)}:s.X(`Image "${S}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}v(null,w)}getPixelSize(c){const{width:f,height:v}=this.atlasImage[c];return{width:f,height:v}}getPattern(c,f){const v=this.patterns[f][c],w=this.getImage(c,f);if(!w)return null;if(v&&v.position.version===w.version)return v.position;if(v)v.position.version=w.version;else{const S={w:w.data.width+2,h:w.data.height+2,x:0,y:0},M=new s.ab(S,w);this.patterns[f][c]={bin:S,position:M}}return this._updatePatternAtlas(f),this.patterns[f][c].position}bind(c,f){const v=c.gl;let w=this.atlasTexture[f];w?this.dirty&&(w.update(this.atlasImage[f]),this.dirty=!1):(w=new s.a9(c,this.atlasImage[f],v.RGBA),this.atlasTexture[f]=w),w.bind(v.LINEAR,v.CLAMP_TO_EDGE)}_updatePatternAtlas(c){const f=[];for(const M in this.patterns[c])f.push(this.patterns[c][M].bin);const{w:v,h:w}=s.aa(f),S=this.atlasImage[c];S.resize({width:v||1,height:w||1});for(const M in this.patterns[c]){const{bin:k}=this.patterns[c][M],L=k.x+1,F=k.y+1,$=this.images[c][M].data,Z=$.width,K=$.height;s.a5.copy($,S,{x:0,y:0},{x:L,y:F},{width:Z,height:K}),s.a5.copy($,S,{x:0,y:K-1},{x:L,y:F-1},{width:Z,height:1}),s.a5.copy($,S,{x:0,y:0},{x:L,y:F+K},{width:Z,height:1}),s.a5.copy($,S,{x:Z-1,y:0},{x:L-1,y:F},{width:1,height:K}),s.a5.copy($,S,{x:0,y:0},{x:L+Z,y:F},{width:1,height:K})}this.dirty=!0}beginFrame(){for(const c in this.images)this.callbackDispatchedThisFrame[c]={}}dispatchRenderCallbacks(c,f){for(const v of c){if(this.callbackDispatchedThisFrame[f][v])continue;this.callbackDispatchedThisFrame[f][v]=!0;const w=this.images[f][v];Lr(w)&&this.updateImage(v,f,w)}}}const an=new s.ac({anchor:new s.ad(s.ae.light.anchor),position:new s.af(s.ae.light.position),color:new s.ad(s.ae.light.color),intensity:new s.ad(s.ae.light.intensity)});class Zn extends s.a6{constructor(c,f="flat"){super(),this._transitionable=new s.ag(an),this.setLight(c,f),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(c,f,v={}){this._validate(s.ah,c,v)||(this._transitionable.setTransitionOrValue(c),this.id=f)}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,f,v){return(!v||v.validate!==!1)&&s.ai(this,c.call(s.aj,s.ak({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.ae})))}}const oi=new s.ac({source:new s.ad(s.ae.terrain.source),exaggeration:new s.ad(s.ae.terrain.exaggeration)});let fi=class extends s.a6{constructor(_,c,f,v){super(),this.scope=f,this._transitionable=new s.ag(oi,f,v),this._transitionable.setTransitionOrValue(_,v),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(_,c){this._transitionable.setTransitionOrValue(_,c)}updateTransitions(_){this._transitioning=this._transitionable.transitioned(_,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(_){this.properties=this._transitioning.possiblyEvaluate(_)}getExaggeration(_){return this._transitioning.possiblyEvaluate(new s.al(_)).get("exaggeration")}isZoomDependent(){const _=this._transitionable._values.exaggeration;return _!=null&&_.value!=null&&_.value.expression!=null&&_.value.expression instanceof s.am}};const Oi=45,si=65,Bn=.05;function Di(_,c,f,v){const w=s.an(Oi,si,f),[S,M]=ko(_,v);let k=1-Math.min(1,Math.exp((c-S)/(M-S)*-6));return k*=k*k,k=Math.min(1,1.00747*k),k*w*_.alpha}function ko(_,c){const f=.5/Math.tan(.5*c);return[_.range[0]+f,_.range[1]+f]}function yn(_,c,f,v,w){const S=s.v.transformMat4([],[c,f,v],w.mercatorFogMatrix);return Di(_,s.v.length(S),w.pitch,w._fov)}function wn(_,c,f,v,w,S,M){const k=[[f,v,0],[w,v,0],[w,S,0],[f,S,0]];let L=Number.MAX_VALUE,F=-Number.MAX_VALUE;for(const $ of k){const Z=s.v.transformMat4([],$,c),K=s.v.length(Z);L=Math.min(L,K),F=Math.max(F,K)}return[Di(_,L,M.pitch,M._fov),Di(_,F,M.pitch,M._fov)]}const Xi=new s.ac({range:new s.ad(s.ae.fog.range),color:new s.ad(s.ae.fog.color),"high-color":new s.ad(s.ae.fog["high-color"]),"space-color":new s.ad(s.ae.fog["space-color"]),"horizon-blend":new s.ad(s.ae.fog["horizon-blend"]),"star-intensity":new s.ad(s.ae.fog["star-intensity"]),"vertical-range":new s.ad(s.ae.fog["vertical-range"])});class io extends s.a6{constructor(c,f){super(),this._transitionable=new s.ag(Xi),this.set(c),this._transitioning=this._transitionable.untransitioned(),this._transform=f}get state(){const c=this._transform,f=c.projection.name==="globe",v=s.ao(c.zoom),w=this.properties.get("range"),S=[.5,3];return{range:f?[s.n(S[0],w[0],v),s.n(S[1],w[1],v)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(c,f={}){if(this._validate(s.ap,c,f))return;const v=s.ak({},c);for(const w of Object.keys(s.ae.fog))v[w]===void 0&&(v[w]=s.ae.fog[w].default);this._transitionable.setTransitionOrValue(v)}getOpacity(c){if(!this._transform.projection.supportsFog)return 0;const f=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:s.an(Oi,si,c))*f.a}getOpacityAtLatLng(c,f){return this._transform.projection.supportsFog?function(v,w,S){const M=s.M.fromLngLat(w),k=S.elevation?S.elevation.getAtPointOrZero(M):0;return yn(v,M.x,M.y,k,S)}(this.state,c,f):0}getOpacityForTile(c){if(!this._transform.projection.supportsFog)return[1,1];const f=this._transform.calculateFogTileMatrix(c.toUnwrapped());return wn(this.state,f,0,0,s.J,s.J,this._transform)}getOpacityForBounds(c,f,v,w,S){return this._transform.projection.supportsFog?wn(this.state,c,f,v,w,S,this._transform):[1,1]}getFovAdjustedRange(c){return this._transform.projection.supportsFog?ko(this.state,c):[0,1]}isVisibleOnFrustum(c){if(!this._transform.projection.supportsFog)return!1;const f=[4,5,6,7];for(const v of f){const w=c.points[v];let S;if(w[2]>=0)S=w;else{const M=c.points[v-4];S=s.aq(M,w,M[2]/(M[2]-w[2]))}if(yn(this.state,S[0],S[1],0,this._transform)>=Bn)return!0}return!1}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}_validate(c,f,v){return(!v||v.validate!==!1)&&s.ai(this,c.call(s.aj,s.ak({value:f,style:{glyphs:!0,sprite:!0},styleSpec:s.ae})))}}class bs extends s.a6{constructor(c,f,v,w){super(),this.scope=v,this._options=c,this.properties=new s.ar(f),this._transitionable=new s.ag(f,v,new Map(w)),this._transitionable.setTransitionOrValue(c.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(c){this._transitionable.setTransitionOrValue(this._options.properties,new Map(c))}updateTransitions(c){this._transitioning=this._transitionable.transitioned(c,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(c){this.properties=this._transitioning.possiblyEvaluate(c)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(c,f){this._options=c,this._transitionable.setTransitionOrValue(c.properties,f)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const ws=new s.ac({color:new s.ad(s.ae.properties_light_ambient.color),intensity:new s.ad(s.ae.properties_light_ambient.intensity)}),jc=new s.ac({direction:new s.as(s.ae.properties_light_directional.direction),color:new s.ad(s.ae.properties_light_directional.color),intensity:new s.ad(s.ae.properties_light_directional.intensity),"cast-shadows":new s.ad(s.ae.properties_light_directional["cast-shadows"]),"shadow-intensity":new s.ad(s.ae.properties_light_directional["shadow-intensity"])});class ji{constructor(c,f,v,w){this.screenBounds=c,this.cameraPoint=f,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=v,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(c,f){let v,w;if(c instanceof s.P||typeof c[0]=="number"){const S=s.P.convert(c);v=[S],w=f.isPointAboveHorizon(S)}else{const S=s.P.convert(c[0]),M=s.P.convert(c[1]);v=[S,M],w=s.at(S,M).every(k=>f.isPointAboveHorizon(k))}return new ji(v,f.getCameraPoint(),w,f)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(c){return s.at(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],c)}bufferedCameraGeometry(c){const f=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],w=s.at(f,v,0,!1);return this.cameraPoint.y>v.y&&(this.cameraPoint.x>f.x&&this.cameraPoint.x<v.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=v.x?w[2]=this.cameraPoint:this.cameraPoint.x<=f.x&&(w[3]=this.cameraPoint)),s.au(w,c)}bufferedCameraGeometryGlobe(c){const f=this.screenBounds[0],v=this.screenBounds.length===1?this.screenBounds[0].add(new s.P(1,1)):this.screenBounds[1],w=s.at(f,v,c),S=this.cameraPoint.clone();switch(3*((S.y>f.y)+(S.y>v.y))+((S.x>f.x)+(S.x>v.x))){case 0:w[0]=S,w[4]=S.clone();break;case 1:w.splice(1,0,S);break;case 2:w[1]=S;break;case 3:w.splice(4,0,S);break;case 5:w.splice(2,0,S);break;case 6:w[3]=S;break;case 7:w.splice(3,0,S);break;case 8:w[2]=S}return w}containsTile(c,f,v,w=0){const S=c.queryPadding/f._pixelsPerMercatorPixel+1,M=v?this._bufferedCameraMercator(S,f):this._bufferedScreenMercator(S,f);let k=c.tileID.wrap+(M.unwrapped?w:0);const L=M.polygon.map(ie=>s.av(c.tileTransform,ie,k));if(!s.aw(L,0,0,s.J,s.J))return;k=c.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const F=this.screenGeometryMercator.polygon.map(ie=>s.ax(c.tileTransform,ie,k)),$=F.map(ie=>new s.P(ie[0],ie[1])),Z=f.getFreeCameraOptions().position||new s.M(0,0,0),K=s.ax(c.tileTransform,Z,k),ee=F.map(ie=>{const re=s.v.sub(ie,ie,K);return s.v.normalize(re,re),new s.R(K,re)}),ne=s.ay(c,1,f.zoom)*f._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:$,tilespaceRays:ee,bufferedTilespaceGeometry:L,bufferedTilespaceBounds:(oe=s.az(L),oe.min.x=s.c(oe.min.x,0,s.J),oe.min.y=s.c(oe.min.y,0,s.J),oe.max.x=s.c(oe.max.x,0,s.J),oe.max.y=s.c(oe.max.y,0,s.J),oe),tile:c,tileID:c.tileID,pixelToTileUnitsFactor:ne};var oe}_bufferedScreenMercator(c,f){const v=Po(c);if(this._screenRaycastCache[v])return this._screenRaycastCache[v];{let w;return w=f.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(c),f):{polygon:this.bufferedScreenGeometry(c).map(S=>f.pointCoordinate3D(S)),unwrapped:!0},this._screenRaycastCache[v]=w,w}}_bufferedCameraMercator(c,f){const v=Po(c);if(this._cameraRaycastCache[v])return this._cameraRaycastCache[v];{let w;return w=f.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(c),f):{polygon:this.bufferedCameraGeometry(c).map(S=>f.pointCoordinate3D(S)),unwrapped:!0},this._cameraRaycastCache[v]=w,w}}_projectAndResample(c,f){const v=function(S,M){const k=s.m.multiply([],M.pixelMatrix,M.globeMatrix),L=[0,-s.aC,0,1],F=[0,s.aC,0,1],$=[0,0,0,1];s.e.transformMat4(L,L,k),s.e.transformMat4(F,F,k),s.e.transformMat4($,$,k);const Z=new s.P(L[0]/L[3],L[1]/L[3]),K=new s.P(F[0]/F[3],F[1]/F[3]),ee=s.aA(S,Z)&&L[3]<$[3],ne=s.aA(S,K)&&F[3]<$[3];if(!ee&&!ne)return null;const oe=function(Ce,Oe,Ae){for(let Le=1;Le<Ce.length;Le++){const ut=qo(Oe.pointCoordinate3D(Ce[Le-1]).x),He=qo(Oe.pointCoordinate3D(Ce[Le]).x);if(Ae<0){if(ut<He)return{idx:Le,t:-ut/(He-1-ut)}}else if(He<ut)return{idx:Le,t:(1-ut)/(He+1-ut)}}return null}(S,M,ee?-1:1);if(!oe)return null;const{idx:ie,t:re}=oe;let de=ie>1?cl(S.slice(0,ie),M):[],be=ie<S.length?cl(S.slice(ie),M):[];de=de.map(Ce=>new s.P(qo(Ce.x),Ce.y)),be=be.map(Ce=>new s.P(qo(Ce.x),Ce.y));const Ee=[...de];Ee.length===0&&Ee.push(be[be.length-1]);const ce=s.n(Ee[Ee.length-1].y,(be.length===0?de[0]:be[0]).y,re);let fe;return fe=ee?[new s.P(0,ce),new s.P(0,0),new s.P(1,0),new s.P(1,ce)]:[new s.P(1,ce),new s.P(1,1),new s.P(0,1),new s.P(0,ce)],Ee.push(...fe),be.length===0?Ee.push(de[0]):Ee.push(...be),{polygon:Ee.map(Ce=>new s.M(Ce.x,Ce.y)),unwrapped:!1}}(c,f);if(v)return v;const w=function(S,M){let k=!1,L=-1/0,F=0;for(let Z=0;Z<S.length-1;Z++)S[Z].x>L&&(L=S[Z].x,F=Z);for(let Z=0;Z<S.length-1;Z++){const K=(F+Z)%(S.length-1),ee=S[K],ne=S[K+1];Math.abs(ee.x-ne.x)>.5&&(ee.x<ne.x?(ee.x+=1,K===0&&(S[S.length-1].x+=1)):(ne.x+=1,K+1===S.length-1&&(S[0].x+=1)),k=!0)}const $=s.E(M.center.lng);return k&&$<Math.abs($-1)&&S.forEach(Z=>{Z.x-=1}),{polygon:S,unwrapped:k}}(cl(c,f).map(S=>new s.P(qo(S.x),S.y)),f);return{polygon:w.polygon.map(S=>new s.M(S.x,S.y)),unwrapped:w.unwrapped}}}function cl(_,c){return s.aB(_,f=>{const v=c.pointCoordinate3D(f);f.x=v.x,f.y=v.y},1/256)}function qo(_){return _<0?1+_%1:_%1}function Po(_){return 100*_|0}function $s(_,c,f,v,w){const S=function(M,k){if(M)return w(M);if(k){_.url&&k.tiles&&_.tiles&&delete _.tiles;const L=s.p(s.ak(k,_),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);k.vector_layers&&(L.vectorLayers=k.vector_layers,L.vectorLayerIds=L.vectorLayers.map(F=>F.id)),L.tiles=c.canonicalizeTileset(L,_.url),w(null,L)}};return _.url?s.a1(c.transformRequest(c.normalizeSourceURL(_.url,null,f,v),s.a2.Source),S):s.a4.frame(()=>S(null,_))}class Ri{constructor(c,f,v){this.bounds=s.D.convert(this.validateBounds(c)),this.minzoom=f||0,this.maxzoom=v||24}validateBounds(c){return Array.isArray(c)&&c.length===4?[Math.max(-180,c[0]),Math.max(-90,c[1]),Math.min(180,c[2]),Math.min(90,c[3])]:[-180,-90,180,90]}contains(c){const f=Math.pow(2,c.z),v=Math.floor(s.E(this.bounds.getWest())*f),w=Math.floor(s.H(this.bounds.getNorth())*f),S=Math.ceil(s.E(this.bounds.getEast())*f),M=Math.ceil(s.H(this.bounds.getSouth())*f);return c.x>=v&&c.x<S&&c.y>=w&&c.y<M}}class Ge extends s.a6{constructor(c,f,v,w){if(super(),this.id=c,this.dispatcher=v,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,s.ak(this,s.p(f,["url","scheme","tileSize","promoteId"])),this._options=s.ak({type:"vector"},f),this._collectResourceTiming=!!f.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new s.aD}load(c){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"}));const f=Array.isArray(this.map._language)?this.map._language.join():this.map._language,v=this.map._worldview;this._tileJSONRequest=$s(this._options,this.map._requestManager,f,v,(w,S)=>{this._tileJSONRequest=null,this._loaded=!0,w?(f&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${f}`),v&&v.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${v}`),this.fire(new s.a7(w))):S&&(s.ak(this,S),S.bounds&&(this.tileBounds=new Ri(S.bounds,this.minzoom,this.maxzoom)),s.aH(S.tiles,this.map._requestManager._customAccessToken),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),c&&c(w)})}loaded(){return this._loaded}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=s.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.ak({},this._options)}loadTile(c,f){const v=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(v,s.a2.Tile),data:void 0,uid:c.uid,tileID:c.tileID,tileZoom:c.tileZoom,zoom:c.tileID.overscaledZ,tileSize:this.tileSize*c.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:s.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:c.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:c.isExtraShadowCaster};if(w.request.collectResourceTiming=this._collectResourceTiming,c.actor&&c.state!=="expired")c.state==="loading"?c.reloadCallback=f:c.request=c.actor.send("reloadTile",w,S.bind(this));else if(c.actor=this._tileWorkers[v]=this._tileWorkers[v]||this.dispatcher.getActor(),this.dispatcher.ready)c.request=c.actor.send("loadTile",w,S.bind(this),void 0,!0);else{const M=s.aF.call({deduped:this._deduped},w,(k,L)=>{k||!L?S.call(this,k):(w.data={cacheControl:L.cacheControl,expires:L.expires,rawData:L.rawData.slice(0)},c.actor&&c.actor.send("loadTile",w,S.bind(this),void 0,!0))},!0);c.request={cancel:M}}function S(M,k){return delete c.request,c.aborted?f(null):M&&M.status!==404?f(M):(k&&k.resourceTiming&&(c.resourceTiming=k.resourceTiming),this.map._refreshExpiredTiles&&k&&c.setExpiryData(k),c.loadVectorData(k,this.map.painter),s.aG(this.dispatcher),f(null),void(c.reloadCallback&&(this.loadTile(c,c.reloadCallback),c.reloadCallback=null)))}}abortTile(c){c.request&&(c.request.cancel(),delete c.request),c.actor&&c.actor.send("abortTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(c){c.actor&&c.actor.send("removeTile",{uid:c.uid,type:this.type,source:this.id,scope:this.scope}),c.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class qt extends s.a6{constructor(c,f,v,w){super(),this.id=c,this.dispatcher=v,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=s.ak({type:"raster"},f),s.ak(this,s.p(f,["url","scheme","tileSize"]))}load(c){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"})),this._tileJSONRequest=$s(this._options,this.map._requestManager,null,null,(f,v)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new s.a7(f)):v&&(s.ak(this,v),v.bounds&&(this.tileBounds=new Ri(v.bounds,this.minzoom,this.maxzoom)),s.aH(v.tiles),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),c&&c(f)})}loaded(){return this._loaded}onAdd(c){this.map=c,this.load()}reload(){this.cancelTileJSONRequest();const c=s.aE(this.id,this.scope);this.load(()=>this.map.style.clearSource(c))}setTiles(c){return this._options.tiles=c,this.reload(),this}setUrl(c){return this.url=c,this._options.url=c,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return s.ak({},this._options)}hasTile(c){return!this.tileBounds||this.tileBounds.contains(c.canonical)}loadTile(c,f){const v=s.a4.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(c.tileID.canonical.url(this.tiles,this.scheme),v,this.tileSize);c.request=s.a3(this.map._requestManager.transformRequest(w,s.a2.Tile),(S,M,k,L)=>(delete c.request,c.aborted?(c.state="unloaded",f(null)):S?(c.state="errored",f(S)):M?(this.map._refreshExpiredTiles&&c.setExpiryData({cacheControl:k,expires:L}),c.setTexture(M,this.map.painter),c.state="loaded",s.aG(this.dispatcher),void f(null)):f(null)))}abortTile(c,f){c.request&&(c.request.cancel(),delete c.request),f()}unloadTile(c,f){c.texture&&c.texture instanceof s.a9?(c.destroy(!0),c.texture&&c.texture instanceof s.a9&&this.map.painter.saveTileTexture(c.texture)):c.destroy(),f()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}const Wo={vector:Ge,raster:qt,"raster-dem":class extends qt{constructor(_,c,f,v){super(_,c,f,v),this.type="raster-dem",this.maxzoom=22,this._options=s.ak({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}loadTile(_,c){const f=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function v(w,S){w&&(_.state="errored",c(w)),S&&(_.dem=S,_.dem.onDeserialize(),_.needsHillshadePrepare=!0,_.needsDEMTextureUpload=!0,_.state="loaded",c(null))}_.request=s.a3(this.map._requestManager.transformRequest(f,s.a2.Tile),(function(w,S,M,k){if(delete _.request,_.aborted)_.state="unloaded",c(null);else if(w)_.state="errored",c(w);else if(S){this.map._refreshExpiredTiles&&_.setExpiryData({cacheControl:M,expires:k});const L=ImageBitmap&&S instanceof ImageBitmap&&s.aI(),F=1-(S.width-s.aJ(S.width))/2;F<1||_.neighboringTiles||(_.neighboringTiles=this._getNeighboringTiles(_.tileID));const $=L?S:s.a4.getImageData(S,F),Z={uid:_.uid,coord:_.tileID,source:this.id,scope:this.scope,rawImageData:$,encoding:this.encoding,padding:F};_.actor&&_.state!=="expired"||(_.actor=this.dispatcher.getActor(),_.actor.send("loadDEMTile",Z,v.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(_){const c=_.canonical,f=Math.pow(2,c.z),v=(c.x-1+f)%f,w=c.x===0?_.wrap-1:_.wrap,S=(c.x+1+f)%f,M=c.x+1===f?_.wrap+1:_.wrap,k={};return k[new s.O(_.overscaledZ,w,c.z,v,c.y).key]={backfilled:!1},k[new s.O(_.overscaledZ,M,c.z,S,c.y).key]={backfilled:!1},c.y>0&&(k[new s.O(_.overscaledZ,w,c.z,v,c.y-1).key]={backfilled:!1},k[new s.O(_.overscaledZ,_.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},k[new s.O(_.overscaledZ,M,c.z,S,c.y-1).key]={backfilled:!1}),c.y+1<f&&(k[new s.O(_.overscaledZ,w,c.z,v,c.y+1).key]={backfilled:!1},k[new s.O(_.overscaledZ,_.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},k[new s.O(_.overscaledZ,M,c.z,S,c.y+1).key]={backfilled:!1}),k}},geojson:class extends s.a6{constructor(_,c,f,v){super(),this.id=_,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=f.getActor(),this.setEventedParent(v),this._data=c.data,this._options=s.ak({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const w=s.J/this.tileSize;this.workerOptions=s.ak({source:this.id,scope:this.scope,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(c.buffer!==void 0?c.buffer:128)*w,tolerance:(c.tolerance!==void 0?c.tolerance:.375)*w,extent:s.J,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:s.J,radius:(c.clusterRadius!==void 0?c.clusterRadius:50)*w,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions)}onAdd(_){this.map=_,this.setData(this._data)}setData(_){return this._data=_,this._updateWorkerData(),this}getClusterExpansionZoom(_,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:_,source:this.id,scope:this.scope},c),this}getClusterChildren(_,c){return this.actor.send("geojson.getClusterChildren",{clusterId:_,source:this.id,scope:this.scope},c),this}getClusterLeaves(_,c,f,v){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:_,limit:c,offset:f},v),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new s.a8("dataloading",{dataType:"source"})),this._loaded=!1;const _=s.ak({},this.workerOptions);_.scope=this.scope;const c=this._data;typeof c=="string"?(_.request=this.map._requestManager.transformRequest(s.a4.resolveURL(c),s.a2.Source),_.request.collectResourceTiming=this._collectResourceTiming):_.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,_,(f,v)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new s.a7(f));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&v&&v.resourceTiming&&v.resourceTiming[this.id]&&(w.resourceTiming=v.resourceTiming[this.id]),this.fire(new s.a8("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(_,c){const f=_.actor?"reloadTile":"loadTile";_.actor=this.actor;const v={type:this.type,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:s.a4.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};_.request=this.actor.send(f,v,(w,S)=>(delete _.request,_.destroy(),_.aborted?c(null):w?c(w):(_.loadVectorData(S,this.map.painter,f==="reloadTile"),c(null))),void 0,f==="loadTile")}abortTile(_){_.request&&(_.request.cancel(),delete _.request),_.aborted=!0}unloadTile(_){this.actor.send("removeTile",{uid:_.uid,type:this.type,source:this.id,scope:this.scope}),_.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return s.ak({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends s.aK{constructor(_,c,f,v){super(_,c,f,v),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const _=this.options;this.urls=[];for(const c of _.urls)this.urls.push(this.map._requestManager.transformRequest(c,s.a2.Source).url);s.aL(this.urls,(c,f)=>{this._loaded=!0,c?this.fire(new s.a7(c)):f&&(this.video=f,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(_){if(this.video){const c=this.video.seekable;_<c.start(0)||_>c.end(0)?this.fire(new s.a7(new s.aM(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=_}}getVideo(){return this.video}onAdd(_){this.map||(this.map=_,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const _=this.map.painter.context,c=_.gl;this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new s.a9(_,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(_)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:s.aK,model:class extends s.a6{constructor(_,c,f,v){super(),this.id=_,this.type="model",this.models=[],this._loaded=!1,this._options=c}load(){const _=[];for(const c in this._options.models){const f=this._options.models[c],v=s.aO(this.map._requestManager.transformRequest(f.uri,s.a2.Model).url).then(w=>{if(!w)return;const S=s.aP(w),M=new s.aQ(c,f.position,f.orientation,S);M.computeBoundsAndApplyParent(),this.models.push(M)}).catch(w=>{this.fire(new s.a7(new Error(`Could not load model ${c} from ${f.uri}: ${w.message}`)))});_.push(v)}return Promise.allSettled(_).then(()=>{this._loaded=!0,this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(c=>{this.fire(new s.a7(new Error(`Could not load models: ${c.message}`)))})}onAdd(_){this.map=_,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(_,c){}serialize(){return{type:"model"}}},"batched-model":class extends s.a6{constructor(_,c,f,v){super(),this.type="batched-model",this.id=_,this.tileSize=512,this._options=c,this.tiles=this._options.tiles,this.maxzoom=c.maxzoom||19,this.minzoom=c.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=f,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(v)}onAdd(_){this.map=_,this.load()}load(_){this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map._worldview;this._tileJSONRequest=$s(this._options,this.map._requestManager,c,f,(v,w)=>{this._tileJSONRequest=null,this._loaded=!0,v?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),f&&f.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new s.a7(v))):w&&(s.ak(this,w),w.bounds&&(this.tileBounds=new Ri(w.bounds,this.minzoom,this.maxzoom)),s.aH(w.tiles,this.map._requestManager._customAccessToken),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))),_&&_(v)})}hasTransition(){return!1}hasTile(_){return!this.tileBounds||this.tileBounds.contains(_.canonical)}loaded(){return this._loaded}loadTile(_,c){const f=this.map._requestManager.normalizeTileURL(_.tileID.canonical.url(this.tiles,this.scheme)),v={request:this.map._requestManager.transformRequest(f,s.a2.Tile),data:void 0,uid:_.uid,tileID:_.tileID,tileZoom:_.tileZoom,zoom:_.tileID.overscaledZ,tileSize:this.tileSize*_.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:_.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(_.actor&&_.state!=="expired")if(_.state==="loading")_.reloadCallback=c;else{if(_.buckets){const S=Object.values(_.buckets);for(const M of S)M.dirty=!0;return void(_.state="loaded")}_.request=_.actor.send("reloadTile",v,w.bind(this))}else _.actor=this.dispatcher.getActor(),_.request=_.actor.send("loadTile",v,w.bind(this),void 0,!0);function w(S,M){return _.aborted?c(null):S&&S.status!==404?c(S):(M&&(M.resourceTiming&&(_.resourceTiming=M.resourceTiming),this.map._refreshExpiredTiles&&_.setExpiryData(M),_.buckets={..._.buckets,...M.buckets}),_.state="loaded",void c(null))}}serialize(){return s.ak({},this._options)}},canvas:class extends s.aK{constructor(_,c,f,v){super(_,c,f,v),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(w=>!Array.isArray(w)||w.length!==2||w.some(S=>typeof S!="number"))||this.fire(new s.a7(new s.aM(`sources.${_}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new s.a7(new s.aM(`sources.${_}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new s.a7(new s.aM(`sources.${_}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof HTMLCanvasElement||this.fire(new s.a7(new s.aM(`sources.${_}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new s.a7(new s.aM(`sources.${_}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new s.a7(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(_){this.map=_,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let _=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,_=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,_=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context;this.texture?!_&&!this._playing||this.texture instanceof s.aN||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new s.a9(c,this.canvas,c.gl.RGBA,{premultiply:!0}),this._prepareData(c)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const _ of[this.canvas.width,this.canvas.height])if(isNaN(_)||_<=0)return!0;return!1}},custom:class extends s.a6{constructor(_,c,f,v){super(),this.id=_,this.type="custom",this._dataType="raster",this._dispatcher=f,this._implementation=c,this.setEventedParent(v),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new s.a7(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new s.a7(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ri(this._implementation.bounds,this.minzoom,this.maxzoom)),c.update=this._update.bind(this),c.clearTiles=this._clearTiles.bind(this),c.coveringTiles=this._coveringTiles.bind(this),s.ak(this,s.p(c,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return s.p(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new s.a8("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(_){this._map=_,this._loaded=!1,this.fire(new s.a8("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(_),this.load()}onRemove(_){this._implementation.onRemove&&this._implementation.onRemove(_)}hasTile(_){if(this._implementation.hasTile){const{x:c,y:f,z:v}=_.canonical;return this._implementation.hasTile({x:c,y:f,z:v})}return!this.tileBounds||this.tileBounds.contains(_.canonical)}loadTile(_,c){const{x:f,y:v,z:w}=_.tileID.canonical,S=new AbortController;_.request=Promise.resolve(this._implementation.loadTile({x:f,y:v,z:w},{signal:S.signal})).then((function(M){return delete _.request,_.aborted?(_.state="unloaded",c(null)):M===void 0?(_.state="errored",c(null)):M===null?(this.loadTileData(_,{width:this.tileSize,height:this.tileSize,data:null}),_.state="loaded",c(null)):function(k){return k instanceof ImageData||k instanceof HTMLCanvasElement||k instanceof ImageBitmap||k instanceof HTMLImageElement}(M)?(this.loadTileData(_,M),_.state="loaded",void c(null)):(_.state="errored",c(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(M=>{M.code!==20&&(_.state="errored",c(M))}),_.request.cancel=()=>S.abort()}loadTileData(_,c){_.setTexture(c,this._map.painter)}unloadTile(_,c){if(_.texture&&_.texture instanceof s.a9?(_.destroy(!0),_.texture&&_.texture instanceof s.a9&&this._map.painter.saveTileTexture(_.texture)):_.destroy(),this._implementation.unloadTile){const{x:f,y:v,z:w}=_.tileID.canonical;this._implementation.unloadTile({x:f,y:v,z:w})}c()}abortTile(_,c){_.request&&_.request.cancel&&(_.request.cancel(),delete _.request),c()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(_=>({x:_.canonical.x,y:_.canonical.y,z:_.canonical.z}))}_clearTiles(){const _=s.aE(this.id,this.scope);this._map.style.clearSource(_)}_update(){this.fire(new s.a8("data",{dataType:"source",sourceDataType:"content"}))}}},yo=function(_,c,f,v){const w=new Wo[c.type](_,c,f,v);if(w.id!==_)throw new Error(`Expected Source id to be ${_} instead of ${w.id}`);return s.aR(["load","abort","unload","serialize","prepare"],w),w};function Un(_,c){const f=s.m.identity([]);return s.m.scale(f,f,[.5*_.width,.5*-_.height,1]),s.m.translate(f,f,[1,-1,0]),s.m.multiply(f,f,_.calculateProjMatrix(c.toUnwrapped())),Float32Array.from(f)}function as(_,c,f,v,w,S,M,k=!1){const L=_.tilesIn(v,M,k);L.sort(vo);const F=[];for(const Z of L)F.push({wrappedTileID:Z.tile.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(c,f,_._state,Z,w,S,Un(_.transform,Z.tile.tileID),k)});const $=function(Z){const K={},ee={};for(const ne of Z){const oe=ne.queryResults,ie=ne.wrappedTileID,re=ee[ie]=ee[ie]||{};for(const de in oe){const be=oe[de],Ee=re[de]=re[de]||{},ce=K[de]=K[de]||[];for(const fe of be)Ee[fe.featureIndex]||(Ee[fe.featureIndex]=!0,ce.push(fe))}}return K}(F);for(const Z in $)$[Z].forEach(K=>{const ee=K.feature,ne=ee.layer;ne&&ne.type!=="background"&&ne.type!=="sky"&&ne.type!=="slot"&&(ee.source=ne.source,ne["source-layer"]&&(ee.sourceLayer=ne["source-layer"]),ee.state=ee.id!==void 0?_.getFeatureState(ne["source-layer"],ee.id):{})});return $}function za(_,c){const f=_.getRenderableIds().map(S=>_.getTileByID(S)),v=[],w={};for(let S=0;S<f.length;S++){const M=f[S],k=M.tileID.canonical.key;w[k]||(w[k]=!0,M.querySourceFeatures(v,c))}return v}function vo(_,c){const f=_.tileID,v=c.tileID;return f.overscaledZ-v.overscaledZ||f.canonical.y-v.canonical.y||f.wrap-v.wrap||f.canonical.x-v.canonical.x}class Es{constructor(c){this.style=c}processLayersChanged(){this.layers=[];for(const c in this.style._mergedLayers){const f=this.style._mergedLayers[c];if(f.type==="fill-extrusion")this.layers.push(f);else if(f.type==="model"){const v=this.style.getLayerSource(f);v&&v.type==="batched-model"&&this.layers.push(f)}}}updateZOffset(c,f){this.currentBuildingBuckets=[];for(let w=0;w<this.layers.length;++w){const S=this.layers[w],M=this.style.getLayerSourceCache(S);let k=1;S.type==="fill-extrusion"&&(k=S.paint.get("fill-extrusion-opacity")>0?S.paint.get("fill-extrusion-vertical-scale"):0);let L=M?M.getTile(f):null;if(!L&&M&&f.canonical.z>M.getSource().minzoom){let F=f.scaledTo(Math.min(M.getSource().maxzoom,f.overscaledZ-1));for(;F.overscaledZ>=M.getSource().minzoom&&(L=M.getTile(F),!L&&F.overscaledZ!==0);)F=F.scaledTo(F.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:L?L.getBucket(S):null,tileID:L?L.tileID:f,verticalScale:k})}c.hasAnyZOffset=!1;let v=!1;for(let w=0;w<c.symbolInstances.length;w++){const S=c.symbolInstances.get(w),M=S.zOffset,k=this._getHeightAtTileOffset(f,S.tileAnchorX,S.tileAnchorY);S.zOffset=k!==-1?k:M,v||M===S.zOffset||(v=!0),c.hasAnyZOffset||S.zOffset===0||(c.hasAnyZOffset=!0)}v&&(c.zOffsetBuffersNeedUpload=!0,c.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(c,f,v,w){let S=f,M=v;if(c.canonical.z!==w.canonical.z){const k=w.canonical,L=1/(1<<c.canonical.z-k.z);S=(f+c.canonical.x*s.J)*L-k.x*s.J|0,M=(v+c.canonical.y*s.J)*L-k.y*s.J|0}return{tileX:S,tileY:M}}_getHeightAtTileOffset(c,f,v){let w,S;for(let M=0;M<this.layers.length;++M){if(this.layers[M].type!=="fill-extrusion")continue;const{bucket:k,tileID:L,verticalScale:F}=this.currentBuildingBuckets[M];if(!k)continue;const{tileX:$,tileY:Z}=this._mapCoordToOverlappingTile(c,f,v,L),K=k.getHeightAtTileCoord($,Z);K&&K.height!==void 0&&(K.hidden?w=K.height:S=Math.max(K.height*F,S||0))}if(S!==void 0)return S;for(let M=0;M<this.layers.length;++M){if(this.layers[M].type!=="model")continue;const{bucket:k,tileID:L}=this.currentBuildingBuckets[M];if(!k)continue;const{tileX:F,tileY:$}=this._mapCoordToOverlappingTile(c,f,v,L),Z=k.getHeightAtTileCoord(F,$);if(Z&&!Z.hidden)return Z.height===void 0&&w!==void 0?Math.min(Z.maxHeight,w)*Z.verticalScale:(Z.height||0)*Z.verticalScale}return-1}}function Na(_,c){const f={};for(const v in _)v!=="ref"&&(f[v]=_[v]);return s.aS.forEach(v=>{v in c&&(f[v]=c[v])}),f}function co(_){_=_.slice();const c=Object.create(null);for(let f=0;f<_.length;f++)c[_[f].id]=_[f];for(let f=0;f<_.length;f++)"ref"in _[f]&&(_[f]=Na(_[f],c[_[f].ref]));return _}const mt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function Nr(_,c,f){f.push({command:mt.addSource,args:[_,c[_]]})}function qr(_,c,f){c.push({command:mt.removeSource,args:[_]}),f[_]=!0}function xo(_,c,f,v){qr(_,f,v),Nr(_,c,f)}function Ss(_,c,f){let v;for(v in _[f])if(_[f].hasOwnProperty(v)&&v!=="data"&&!I(_[f][v],c[f][v]))return!1;for(v in c[f])if(c[f].hasOwnProperty(v)&&v!=="data"&&!I(_[f][v],c[f][v]))return!1;return!0}function zr(_,c,f,v,w,S){let M;for(M in c=c||{},_=_||{})_.hasOwnProperty(M)&&(I(_[M],c[M])||f.push({command:S,args:[v,M,c[M],w]}));for(M in c)c.hasOwnProperty(M)&&!_.hasOwnProperty(M)&&(I(_[M],c[M])||f.push({command:S,args:[v,M,c[M],w]}))}function Us(_){return _.id}function ls(_,c){return _[c.id]=c,_}class Ts{constructor(c,f){this.reset(c,f)}reset(c,f){this.points=c||[],this._distances=[0];for(let v=1;v<this.points.length;v++)this._distances[v]=this._distances[v-1]+this.points[v].dist(this.points[v-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(c){if(this.points.length===1)return this.points[0];c=s.c(c,0,1);let f=1,v=this._distances[f];const w=c*this.paddedLength+this.padding;for(;v<w&&f<this._distances.length;)v=this._distances[++f];const S=f-1,M=this._distances[S],k=v-M,L=k>0?(w-M)/k:0;return this.points[S].mult(1-L).add(this.points[f].mult(L))}}class pi{constructor(c,f,v){const w=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(c/v),this.yCellCount=Math.ceil(f/v);for(let M=0;M<this.xCellCount*this.yCellCount;M++)w.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=c,this.height=f,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(c,f,v,w,S){this._forEachCell(f,v,w,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(c),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(w),this.bboxes.push(S)}insertCircle(c,f,v,w){this._forEachCell(f-w,v-w,f+w,v+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(c),this.circles.push(f),this.circles.push(v),this.circles.push(w)}_insertBoxCell(c,f,v,w,S,M){this.boxCells[S].push(M)}_insertCircleCell(c,f,v,w,S,M){this.circleCells[S].push(M)}_query(c,f,v,w,S,M){if(v<0||c>this.width||w<0||f>this.height)return!S&&[];const k=[];if(c<=0&&f<=0&&this.width<=v&&this.height<=w){if(S)return!0;for(let L=0;L<this.boxKeys.length;L++)k.push({key:this.boxKeys[L],x1:this.bboxes[4*L],y1:this.bboxes[4*L+1],x2:this.bboxes[4*L+2],y2:this.bboxes[4*L+3]});for(let L=0;L<this.circleKeys.length;L++){const F=this.circles[3*L],$=this.circles[3*L+1],Z=this.circles[3*L+2];k.push({key:this.circleKeys[L],x1:F-Z,y1:$-Z,x2:F+Z,y2:$+Z})}return M?k.filter(M):k}return this._forEachCell(c,f,v,w,this._queryCell,k,{hitTest:S,seenUids:{box:{},circle:{}}},M),S?k.length>0:k}_queryCircle(c,f,v,w,S){const M=c-v,k=c+v,L=f-v,F=f+v;if(k<0||M>this.width||F<0||L>this.height)return!w&&[];const $=[];return this._forEachCell(M,L,k,F,this._queryCellCircle,$,{hitTest:w,circle:{x:c,y:f,radius:v},seenUids:{box:{},circle:{}}},S),w?$.length>0:$}query(c,f,v,w,S){return this._query(c,f,v,w,!1,S)}hitTest(c,f,v,w,S){return this._query(c,f,v,w,!0,S)}hitTestCircle(c,f,v,w){return this._queryCircle(c,f,v,!0,w)}_queryCell(c,f,v,w,S,M,k,L){const F=k.seenUids,$=this.boxCells[S];if($!==null){const K=this.bboxes;for(const ee of $)if(!F.box[ee]){F.box[ee]=!0;const ne=4*ee;if(c<=K[ne+2]&&f<=K[ne+3]&&v>=K[ne+0]&&w>=K[ne+1]&&(!L||L(this.boxKeys[ee]))){if(k.hitTest)return M.push(!0),!0;M.push({key:this.boxKeys[ee],x1:K[ne],y1:K[ne+1],x2:K[ne+2],y2:K[ne+3]})}}}const Z=this.circleCells[S];if(Z!==null){const K=this.circles;for(const ee of Z)if(!F.circle[ee]){F.circle[ee]=!0;const ne=3*ee;if(this._circleAndRectCollide(K[ne],K[ne+1],K[ne+2],c,f,v,w)&&(!L||L(this.circleKeys[ee]))){if(k.hitTest)return M.push(!0),!0;{const oe=K[ne],ie=K[ne+1],re=K[ne+2];M.push({key:this.circleKeys[ee],x1:oe-re,y1:ie-re,x2:oe+re,y2:ie+re})}}}}}_queryCellCircle(c,f,v,w,S,M,k,L){const F=k.circle,$=k.seenUids,Z=this.boxCells[S];if(Z!==null){const ee=this.bboxes;for(const ne of Z)if(!$.box[ne]){$.box[ne]=!0;const oe=4*ne;if(this._circleAndRectCollide(F.x,F.y,F.radius,ee[oe+0],ee[oe+1],ee[oe+2],ee[oe+3])&&(!L||L(this.boxKeys[ne])))return M.push(!0),!0}}const K=this.circleCells[S];if(K!==null){const ee=this.circles;for(const ne of K)if(!$.circle[ne]){$.circle[ne]=!0;const oe=3*ne;if(this._circlesCollide(ee[oe],ee[oe+1],ee[oe+2],F.x,F.y,F.radius)&&(!L||L(this.circleKeys[ne])))return M.push(!0),!0}}}_forEachCell(c,f,v,w,S,M,k,L){const F=this._convertToXCellCoord(c),$=this._convertToYCellCoord(f),Z=this._convertToXCellCoord(v),K=this._convertToYCellCoord(w);for(let ee=F;ee<=Z;ee++)for(let ne=$;ne<=K;ne++)if(S.call(this,c,f,v,w,this.xCellCount*ne+ee,M,k,L))return}_convertToXCellCoord(c){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(c*this.xScale)))}_convertToYCellCoord(c){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(c*this.yScale)))}_circlesCollide(c,f,v,w,S,M){const k=w-c,L=S-f,F=v+M;return F*F>k*k+L*L}_circleAndRectCollide(c,f,v,w,S,M,k){const L=(M-w)/2,F=Math.abs(c-(w+L));if(F>L+v)return!1;const $=(k-S)/2,Z=Math.abs(f-(S+$));if(Z>$+v)return!1;if(F<=L||Z<=$)return!0;const K=F-L,ee=Z-$;return K*K+ee*ee<=v*v}}const ln=100;class th{constructor(c,f,v=new pi(c.width+200,c.height+200,25),w=new pi(c.width+200,c.height+200,25)){this.transform=c,this.grid=v,this.ignoredGrid=w,this.pitchfactor=Math.cos(c._pitch)*c.cameraToCenterDistance,this.screenRightBoundary=c.width+ln,this.screenBottomBoundary=c.height+ln,this.gridRightBoundary=c.width+200,this.gridBottomBoundary=c.height+200,this.fogState=f}placeCollisionBox(c,f,v,w,S,M,k,L){let F=v.projectedAnchorX,$=v.projectedAnchorY,Z=v.projectedAnchorZ;const K=v.elevation,ee=v.tileID,ne=c.getProjection();if(K&&ee){const[fe,Ce,Oe]=ne.upVector(ee.canonical,v.tileAnchorX,v.tileAnchorY),Ae=ne.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;F+=fe*K*Ae,$+=Ce*K*Ae,Z+=Oe*K*Ae}const oe=this.projectAndGetPerspectiveRatio(k,F,$,Z,v.tileID,ne.name==="globe"||!!K||this.transform.pitch>0,ne),ie=M*oe.perspectiveRatio,re=(v.x1*f+w.x-v.padding)*ie+oe.point.x,de=(v.y1*f+w.y-v.padding)*ie+oe.point.y,be=(v.x2*f+w.x+v.padding)*ie+oe.point.x,Ee=(v.y2*f+w.y+v.padding)*ie+oe.point.y,ce=oe.perspectiveRatio<=.55||oe.occluded;return!this.isInsideGrid(re,de,be,Ee)||!S&&this.grid.hitTest(re,de,be,Ee,L)||ce?{box:[],offscreen:!1,occluded:oe.occluded}:{box:[re,de,be,Ee],offscreen:this.isOffscreen(re,de,be,Ee),occluded:!1}}placeCollisionCircles(c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne,oe){const ie=[],re=this.transform.elevation,de=c.getProjection(),be=re?re.getAtTileOffsetFunc(oe,this.transform.center.lat,this.transform.worldSize,de):null,Ee=new s.P(v.tileAnchorX,v.tileAnchorY);let{x:ce,y:fe,z:Ce}=de.projectTilePoint(Ee.x,Ee.y,oe.canonical);if(be){const[dt,ye,$e]=be(Ee);ce+=dt,fe+=ye,Ce+=$e}const Oe=de.name==="globe",Ae=this.projectAndGetPerspectiveRatio(k,ce,fe,Ce,oe,Oe||!!re||this.transform.pitch>0,de),{perspectiveRatio:Le}=Ae,ut=(Z?M/Le:M*Le)/s.aV,He=qe(ce,fe,Ce,L),Je=Ae.signedDistanceFromCamera>0?Ze(ut,S,v.lineOffsetX*ut,v.lineOffsetY*ut,!1,He,Ee,v,w,L,{},re&&!Z?be:null,Z&&!!re,de,oe,Z):null;let Be=!1,lt=!1,Qe=!0;if(Je&&!Ae.occluded){const dt=.5*ee*Le+ne,ye=new s.P(-100,-100),$e=new s.P(this.screenRightBoundary,this.screenBottomBoundary),St=new Ts,{first:pt,last:Xt}=Je,Bt=pt.path.length;let nr=[];for(let ur=Bt-1;ur>=1;ur--)nr.push(pt.path[ur]);for(let ur=1;ur<Xt.path.length;ur++)nr.push(Xt.path[ur]);const Wt=2.5*dt;F&&(nr=nr.map(([ur,er,tr],Yr)=>(be&&!Oe&&(tr=be(Yr<Bt-1?pt.tilePath[Bt-1-Yr]:Xt.tilePath[Yr-Bt+2])[2]),qe(ur,er,tr,F))),nr.some(ur=>ur[3]<=0)&&(nr=[]));let cr=[];if(nr.length>0){let ur=1/0,er=-1/0,tr=1/0,Yr=-1/0;for(const Cr of nr)ur=Math.min(ur,Cr[0]),tr=Math.min(tr,Cr[1]),er=Math.max(er,Cr[0]),Yr=Math.max(Yr,Cr[1]);er>=ye.x&&ur<=$e.x&&Yr>=ye.y&&tr<=$e.y&&(cr=[nr.map(Cr=>new s.P(Cr[0],Cr[1]))],(ur<ye.x||er>$e.x||tr<ye.y||Yr>$e.y)&&(cr=s.aT(cr,ye.x,ye.y,$e.x,$e.y)))}for(const ur of cr){St.reset(ur,.25*dt);let er=0;er=St.length<=.5*dt?1:Math.ceil(St.paddedLength/Wt)+1;for(let tr=0;tr<er;tr++){const Yr=tr/Math.max(er-1,1),Cr=St.lerp(Yr),kn=Cr.x+ln,gn=Cr.y+ln;ie.push(kn,gn,dt,0);const Lo=kn-dt,As=gn-dt,un=kn+dt,Jr=gn+dt;if(Qe=Qe&&this.isOffscreen(Lo,As,un,Jr),lt=lt||this.isInsideGrid(Lo,As,un,Jr),!f&&this.grid.hitTestCircle(kn,gn,dt,K)&&(Be=!0,!$))return{circles:[],offscreen:!1,collisionDetected:Be,occluded:!1}}}}return{circles:!$&&Be||!lt?[]:ie,offscreen:Qe,collisionDetected:Be,occluded:Ae.occluded}}queryRenderedSymbols(c){if(c.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const f=[];let v=1/0,w=1/0,S=-1/0,M=-1/0;for(const $ of c){const Z=new s.P($.x+ln,$.y+ln);v=Math.min(v,Z.x),w=Math.min(w,Z.y),S=Math.max(S,Z.x),M=Math.max(M,Z.y),f.push(Z)}const k=this.grid.query(v,w,S,M).concat(this.ignoredGrid.query(v,w,S,M)),L={},F={};for(const $ of k){const Z=$.key;if(L[Z.bucketInstanceId]===void 0&&(L[Z.bucketInstanceId]={}),L[Z.bucketInstanceId][Z.featureIndex])continue;const K=[new s.P($.x1,$.y1),new s.P($.x2,$.y1),new s.P($.x2,$.y2),new s.P($.x1,$.y2)];s.aU(f,K)&&(L[Z.bucketInstanceId][Z.featureIndex]=!0,F[Z.bucketInstanceId]===void 0&&(F[Z.bucketInstanceId]=[]),F[Z.bucketInstanceId].push(Z.featureIndex))}return F}insertCollisionBox(c,f,v,w,S){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:v,featureIndex:w,collisionGroupID:S},c[0],c[1],c[2],c[3])}insertCollisionCircles(c,f,v,w,S){const M=f?this.ignoredGrid:this.grid,k={bucketInstanceId:v,featureIndex:w,collisionGroupID:S};for(let L=0;L<c.length;L+=4)M.insertCircle(k,c[L],c[L+1],c[L+2])}projectAndGetPerspectiveRatio(c,f,v,w,S,M,k){const L=[f,v,w,1];let F=!1;w||this.transform.pitch>0?(s.e.transformMat4(L,L,c),this.fogState&&S&&k.name!=="globe"&&(F=function(K,ee,ne,oe,ie,re){const de=re.calculateFogTileMatrix(ie),be=[ee,ne,oe];return s.v.transformMat4(be,be,de),Di(K,s.v.length(be),re.pitch,re._fov)}(this.fogState,f,v,w,S.toUnwrapped(),this.transform)>.9)):Ft(L,L,c);const $=L[3];return{point:new s.P((L[0]/$+1)/2*this.transform.width+ln,(-L[1]/$+1)/2*this.transform.height+ln),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(k)/$*.5,1.5),signedDistanceFromCamera:$,occluded:M&&L[2]>$||F}}isOffscreen(c,f,v,w){return v<ln||c>=this.screenRightBoundary||w<ln||f>this.screenBottomBoundary}isInsideGrid(c,f,v,w){return v>=0&&c<this.gridRightBoundary&&w>=0&&f<this.gridBottomBoundary}getViewportMatrix(){const c=s.m.identity([]);return s.m.translate(c,c,[-100,-100,0]),c}}function Fe(_,c,f){const v=c.createTileMatrix(_,_.worldSize,f.toUnwrapped());return s.m.multiply(new Float32Array(16),_.projMatrix,v)}function Et(_,c,f){if(c.projection.name===f.projection.name)return _.projMatrix;const v=f.clone();return v.setProjection(c.projection),Fe(v,c.getProjection(),_)}function zt(_,c,f){return c.name===f.projection.name?_.projMatrix:Fe(f,c,_)}class Ur{constructor(c,f,v,w){this.opacity=c?Math.max(0,Math.min(1,c.opacity+(c.placed?f:-f))):w&&v?1:0,this.placed=v}isHidden(){return this.opacity===0&&!this.placed}}class tn{constructor(c,f,v,w,S,M=!1){this.text=new Ur(c?c.text:null,f,v,S),this.icon=new Ur(c?c.icon:null,f,w,S),this.clipped=M}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Xn{constructor(c,f,v,w=!1){this.text=c,this.icon=f,this.skipFade=v,this.clipped=w}}class mi{constructor(){this.invProjMatrix=s.m.create(),this.viewportMatrix=s.m.create(),this.circles=[]}}class Yn{constructor(c,f,v,w,S){this.bucketInstanceId=c,this.featureIndex=f,this.sourceLayerIndex=v,this.bucketIndex=w,this.tileID=S}}class bo{constructor(c){this.crossSourceCollisions=c,this.maxGroupID=0,this.collisionGroups={}}get(c){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[c]){const f=++this.maxGroupID;this.collisionGroups[c]={ID:f,predicate:v=>v.collisionGroupID===f}}return this.collisionGroups[c]}}function Cn(_,c,f,v,w){const{horizontalAlign:S,verticalAlign:M}=s.aY(_),k=-(S-.5)*c,L=-(M-.5)*f,F=s.aW(_,v);return new s.P(k+F[0]*w,L+F[1]*w)}function En(_,c,f,v,w){const S=new s.P(_,c);return f&&S._rotate(v?w:-w),S}class Ai{constructor(c,f,v,w,S,M){this.transform=c.clone(),this.projection=c.projection.name,this.collisionIndex=new th(this.transform,S),this.buildingIndex=M,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new bo(v),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(c,f,v,w){const S=v.getBucket(f),M=v.latestFeatureIndex;if(!S||!M||f.fqid!==S.layerIds[0])return;const k=S.layers[0].layout,L=v.collisionBoxArray,F=Math.pow(2,this.transform.zoom-v.tileID.overscaledZ),$=v.tileSize/s.J,Z=v.tileID.toUnwrapped();this.transform.setProjection(S.projection);const K=(ee=v.tileID,ne=S.getProjection(),oe=this.transform,ne.name===this.projection?oe.calculateProjMatrix(ee.toUnwrapped()):Fe(oe,ne,ee));var ee,ne,oe;const ie=k.get("text-pitch-alignment")==="map",re=k.get("text-rotation-alignment")==="map";f.compileFilter();const de=f.dynamicFilter(),be=f.dynamicFilterNeedsFeature(),Ee=this.transform.calculatePixelsToTileUnitsMatrix(v),ce=no(K,v.tileID.canonical,ie,re,this.transform,S.getProjection(),Ee);let fe=null;if(ie){const Ae=Go(K,v.tileID.canonical,ie,re,this.transform,S.getProjection(),Ee);fe=s.m.multiply([],this.transform.labelPlaneMatrix,Ae)}let Ce=null;de&&v.latestFeatureIndex&&(Ce={unwrappedTileID:Z,dynamicFilter:de,dynamicFilterNeedsFeature:be,featureIndex:v.latestFeatureIndex}),this.retainedQueryData[S.bucketInstanceId]=new Yn(S.bucketInstanceId,M,S.sourceLayerIndex,S.index,v.tileID);const Oe={bucket:S,layout:k,posMatrix:K,textLabelPlaneMatrix:ce,labelToScreenMatrix:fe,clippingData:Ce,scale:F,textPixelRatio:$,holdingForFade:v.holdingForFade(),collisionBoxArray:L,partiallyEvaluatedTextSize:s.i(S.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:s.i(S.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(w)for(const Ae of S.sortKeyRanges){const{sortKey:Le,symbolInstanceStart:ut,symbolInstanceEnd:He}=Ae;c.push({sortKey:Le,symbolInstanceStart:ut,symbolInstanceEnd:He,parameters:Oe})}else c.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:Oe})}attemptAnchorPlacement(c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne,oe,ie,re,de){const{textOffset0:be,textOffset1:Ee,crossTileID:ce}=K,fe=[be,Ee],Ce=Cn(c,v,w,fe,S),Oe=this.collisionIndex.placeCollisionBox(ne,S,f,En(Ce.x,Ce.y,M,k,this.transform.angle),Z,L,F,$.predicate);if(ie){const Ae=ne.getSymbolInstanceIconSize(de,this.transform.zoom,K.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(ne,Ae,ie,En(Ce.x,Ce.y,M,k,this.transform.angle),Z,L,F,$.predicate).box.length===0)return}if(Oe.box.length>0){let Ae;return this.prevPlacement&&this.prevPlacement.variableOffsets[ce]&&this.prevPlacement.placements[ce]&&this.prevPlacement.placements[ce].text&&(Ae=this.prevPlacement.variableOffsets[ce].anchor),this.variableOffsets[ce]={textOffset:fe,width:v,height:w,anchor:c,textScale:S,prevAnchor:Ae},this.markUsedJustification(ne,c,K,oe),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,oe,K),this.placedOrientations[ce]=oe),{shift:Ce,placedGlyphBoxes:Oe}}}placeLayerBucketPart(c,f,v,w){const{bucket:S,layout:M,posMatrix:k,textLabelPlaneMatrix:L,labelToScreenMatrix:F,clippingData:$,textPixelRatio:Z,holdingForFade:K,collisionBoxArray:ee,partiallyEvaluatedTextSize:ne,partiallyEvaluatedIconSize:oe,collisionGroup:ie}=c.parameters,re=M.get("text-optional"),de=M.get("icon-optional"),be=M.get("text-allow-overlap"),Ee=M.get("icon-allow-overlap"),ce=M.get("text-rotation-alignment")==="map",fe=M.get("text-pitch-alignment")==="map",Ce=M.get("symbol-z-order")==="viewport-y",Oe=M.get("symbol-z-elevate");this.transform.setProjection(S.projection);let Ae=be&&(Ee||!S.hasIconData()||de),Le=Ee&&(be||!S.hasTextData()||re);!S.collisionArrays&&ee&&S.deserializeCollisionBoxes(ee),v&&w&&S.updateCollisionDebugBuffers(this.transform.zoom,ee);const ut=(He,Je,Be)=>{const{crossTileID:lt,numVerticalGlyphVertices:Qe}=He;if($){const un={zoom:this.transform.zoom,pitch:this.transform.pitch};let Jr=null;if($.dynamicFilterNeedsFeature){const rn=this.retainedQueryData[S.bucketInstanceId];Jr=$.featureIndex.loadFeature({featureIndex:He.featureIndex,bucketIndex:rn.bucketIndex,sourceLayerIndex:rn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,$.dynamicFilter)(un,Jr,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new s.P(He.tileAnchorX,He.tileAnchorY),this.transform.calculateDistanceTileData($.unwrappedTileID)))return this.placements[lt]=new Xn(!1,!1,!1,!0),void f.add(lt)}if(f.has(lt))return;if(K)return void(this.placements[lt]=new Xn(!1,!1,!1));let dt=!1,ye=!1,$e=!0,St=!1,pt=!1,Xt=null,Bt={box:null,offscreen:null,occluded:null},nr={box:null,offscreen:null,occluded:null},Wt=null,cr=null,ur=null,er=0,tr=0,Yr=0;Be.textFeatureIndex?er=Be.textFeatureIndex:He.useRuntimeCollisionCircles&&(er=He.featureIndex),Be.verticalTextFeatureIndex&&(tr=Be.verticalTextFeatureIndex);const Cr=un=>{un.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const Jr=this.transform.elevation;un.elevation=He.zOffset+(Jr?Jr.getAtTileOffset(un.tileID,un.tileAnchorX,un.tileAnchorY):0)},kn=Be.textBox;if(kn){Cr(kn);const un=rn=>{let Vn=s.W.horizontal;if(S.allowVerticalPlacement&&!rn&&this.prevPlacement){const Qi=this.prevPlacement.placedOrientations[lt];Qi&&(this.placedOrientations[lt]=Qi,Vn=Qi,this.markUsedOrientation(S,Vn,He))}return Vn},Jr=(rn,Vn)=>{if(S.allowVerticalPlacement&&Qe>0&&Be.verticalTextBox){for(const Qi of S.writingModes)if(Qi===s.W.vertical?(Bt=Vn(),nr=Bt):Bt=rn(),Bt&&Bt.box&&Bt.box.length)break}else Bt=rn()};if(M.get("text-variable-anchor")){let rn=M.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[lt]){const Rn=this.prevPlacement.variableOffsets[lt];rn.indexOf(Rn.anchor)>0&&(rn=rn.filter(uo=>uo!==Rn.anchor),rn.unshift(Rn.anchor))}const Vn=(Rn,uo,zo)=>{const ho=S.getSymbolInstanceTextSize(ne,He,this.transform.zoom,Je),ks=(Rn.x2-Rn.x1)*ho+2*Rn.padding,ja=(Rn.y2-Rn.y1)*ho+2*Rn.padding,Hs=He.hasIconTextFit&&!Ee?uo:null;Hs&&Cr(Hs);let vn={box:[],offscreen:!1,occluded:!1};const Zs=be?2*rn.length:rn.length;for(let ga=0;ga<Zs;++ga){const $a=this.attemptAnchorPlacement(rn[ga%rn.length],Rn,ks,ja,ho,ce,fe,Z,k,ie,ga>=rn.length,He,Je,S,zo,Hs,ne,oe);if($a&&(vn=$a.placedGlyphBoxes,vn&&vn.box&&vn.box.length)){dt=!0,Xt=$a.shift;break}}return vn};Jr(()=>Vn(kn,Be.iconBox,s.W.horizontal),()=>{const Rn=Be.verticalTextBox;return Rn&&Cr(Rn),S.allowVerticalPlacement&&!(Bt&&Bt.box&&Bt.box.length)&&Qe>0&&Rn?Vn(Rn,Be.verticalIconBox,s.W.vertical):{box:null,offscreen:null,occluded:null}}),Bt&&(dt=Bt.box,$e=Bt.offscreen,St=Bt.occluded);const Qi=un(!(!Bt||!Bt.box));if(!dt&&this.prevPlacement){const Rn=this.prevPlacement.variableOffsets[lt];Rn&&(this.variableOffsets[lt]=Rn,this.markUsedJustification(S,Rn.anchor,He,Qi))}}else{const rn=(Vn,Qi)=>{const Rn=S.getSymbolInstanceTextSize(ne,He,this.transform.zoom,Je),uo=this.collisionIndex.placeCollisionBox(S,Rn,Vn,new s.P(0,0),be,Z,k,ie.predicate);return uo&&uo.box&&uo.box.length&&(this.markUsedOrientation(S,Qi,He),this.placedOrientations[lt]=Qi),uo};Jr(()=>rn(kn,s.W.horizontal),()=>{const Vn=Be.verticalTextBox;return S.allowVerticalPlacement&&Qe>0&&Vn?(Cr(Vn),rn(Vn,s.W.vertical)):{box:null,offscreen:null,occluded:null}}),un(!!(Bt&&Bt.box&&Bt.box.length))}}if(Wt=Bt,dt=Wt&&Wt.box&&Wt.box.length>0,$e=Wt&&Wt.offscreen,St=Wt&&Wt.occluded,He.useRuntimeCollisionCircles){const un=S.text.placedSymbolArray.get(He.centerJustifiedTextSymbolIndex>=0?He.centerJustifiedTextSymbolIndex:He.verticalPlacedTextSymbolIndex),Jr=s.j(S.textSizeData,ne,un),rn=M.get("text-padding");cr=this.collisionIndex.placeCollisionCircles(S,be,un,S.lineVertexArray,S.glyphOffsetArray,Jr,k,L,F,v,fe,ie.predicate,He.collisionCircleDiameter*Jr/s.aV,rn,this.retainedQueryData[S.bucketInstanceId].tileID),dt=be||cr.circles.length>0&&!cr.collisionDetected,$e=$e&&cr.offscreen,St=cr.occluded}if(Be.iconFeatureIndex&&(Yr=Be.iconFeatureIndex),Be.iconBox){const un=Jr=>{Cr(Jr);const rn=He.hasIconTextFit&&Xt?En(Xt.x,Xt.y,ce,fe,this.transform.angle):new s.P(0,0),Vn=S.getSymbolInstanceIconSize(oe,this.transform.zoom,He.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,Vn,Jr,rn,Ee,Z,k,ie.predicate)};nr&&nr.box&&nr.box.length&&Be.verticalIconBox?(ur=un(Be.verticalIconBox),ye=ur.box.length>0):(ur=un(Be.iconBox),ye=ur.box.length>0),$e=$e&&ur.offscreen,pt=ur.occluded}const gn=re||He.numHorizontalGlyphVertices===0&&Qe===0,Lo=de||He.numIconVertices===0;if(gn||Lo?Lo?gn||(ye=ye&&dt):dt=ye&&dt:ye=dt=ye&&dt,dt&&Wt&&Wt.box&&this.collisionIndex.insertCollisionBox(Wt.box,M.get("text-ignore-placement"),S.bucketInstanceId,nr&&nr.box&&tr?tr:er,ie.ID),ye&&ur&&this.collisionIndex.insertCollisionBox(ur.box,M.get("icon-ignore-placement"),S.bucketInstanceId,Yr,ie.ID),cr&&(dt&&this.collisionIndex.insertCollisionCircles(cr.circles,M.get("text-ignore-placement"),S.bucketInstanceId,er,ie.ID),v)){const un=S.bucketInstanceId;let Jr=this.collisionCircleArrays[un];Jr===void 0&&(Jr=this.collisionCircleArrays[un]=new mi);for(let rn=0;rn<cr.circles.length;rn+=4)Jr.circles.push(cr.circles[rn+0]),Jr.circles.push(cr.circles[rn+1]),Jr.circles.push(cr.circles[rn+2]),Jr.circles.push(cr.collisionDetected?1:0)}const As=S.projection.name!=="globe";Ae=Ae&&(As||!St),Le=Le&&(As||!pt),this.placements[lt]=new Xn(dt||Ae,ye||Le,$e||S.justReloaded),f.add(lt)};if(Oe&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,this.retainedQueryData[S.bucketInstanceId].tileID),S.updateZOffset()),Ce){const He=S.getSortedSymbolIndexes(this.transform.angle);for(let Je=He.length-1;Je>=0;--Je){const Be=He[Je];ut(S.symbolInstances.get(Be),Be,S.collisionArrays[Be])}S.hasAnyZOffset&&s.X(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const He=S.getSortedIndexesByZOffset();for(let Je=0;Je<He.length;++Je){const Be=He[Je];ut(S.symbolInstances.get(Be),Be,S.collisionArrays[Be])}}else for(let He=c.symbolInstanceStart;He<c.symbolInstanceEnd;He++)ut(S.symbolInstances.get(He),He,S.collisionArrays[He]);if(v&&S.bucketInstanceId in this.collisionCircleArrays){const He=this.collisionCircleArrays[S.bucketInstanceId];s.m.invert(He.invProjMatrix,k),He.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(c,f,v,w){const{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:M,rightJustifiedTextSymbolIndex:k,verticalPlacedTextSymbolIndex:L,crossTileID:F}=v,$=s.aX(f),Z=w===s.W.vertical?L:$==="left"?S:$==="center"?M:$==="right"?k:-1;S>=0&&(c.text.placedSymbolArray.get(S).crossTileID=Z>=0&&S!==Z?0:F),M>=0&&(c.text.placedSymbolArray.get(M).crossTileID=Z>=0&&M!==Z?0:F),k>=0&&(c.text.placedSymbolArray.get(k).crossTileID=Z>=0&&k!==Z?0:F),L>=0&&(c.text.placedSymbolArray.get(L).crossTileID=Z>=0&&L!==Z?0:F)}markUsedOrientation(c,f,v){const w=f===s.W.horizontal||f===s.W.horizontalOnly?f:0,S=f===s.W.vertical?f:0,{leftJustifiedTextSymbolIndex:M,centerJustifiedTextSymbolIndex:k,rightJustifiedTextSymbolIndex:L,verticalPlacedTextSymbolIndex:F}=v,$=c.text.placedSymbolArray;M>=0&&($.get(M).placedOrientation=w),k>=0&&($.get(k).placedOrientation=w),L>=0&&($.get(L).placedOrientation=w),F>=0&&($.get(F).placedOrientation=S)}commit(c){this.commitTime=c,this.zoomAtLastRecencyCheck=this.transform.zoom;const f=this.prevPlacement;let v=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;const w=f?f.symbolFadeChange(c):1,S=f?f.opacities:{},M=f?f.variableOffsets:{},k=f?f.placedOrientations:{};for(const L in this.placements){const F=this.placements[L],$=S[L];$?(this.opacities[L]=new tn($,w,F.text,F.icon,null,F.clipped),v=v||F.text!==$.text.placed||F.icon!==$.icon.placed):(this.opacities[L]=new tn(null,w,F.text,F.icon,F.skipFade,F.clipped),v=v||F.text||F.icon)}for(const L in S){const F=S[L];if(!this.opacities[L]){const $=new tn(F,w,!1,!1);$.isHidden()||(this.opacities[L]=$,v=v||F.text.placed||F.icon.placed)}}for(const L in M)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=M[L]);for(const L in k)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=k[L]);v?this.lastPlacementChangeTime=c:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:c)}updateLayerOpacities(c,f){const v=new Set;for(const w of f){const S=w.getBucket(c);S&&w.latestFeatureIndex&&c.fqid===S.layerIds[0]&&(this.updateBucketOpacities(S,v,w.collisionBoxArray),S.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(S,w.tileID),S.updateZOffset()))}}updateBucketOpacities(c,f,v){c.hasTextData()&&c.text.opacityVertexArray.clear(),c.hasIconData()&&c.icon.opacityVertexArray.clear(),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexArray.clear(),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexArray.clear();const w=c.layers[0].layout,S=!!c.layers[0].dynamicFilter(),M=new tn(null,0,!1,!1,!0),k=w.get("text-allow-overlap"),L=w.get("icon-allow-overlap"),F=w.get("text-variable-anchor"),$=w.get("text-rotation-alignment")==="map",Z=w.get("text-pitch-alignment")==="map",K=new tn(null,0,k&&(L||!c.hasIconData()||w.get("icon-optional")),L&&(k||!c.hasTextData()||w.get("text-optional")),!0);!c.collisionArrays&&v&&(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData())&&c.deserializeCollisionBoxes(v);const ee=(oe,ie,re)=>{for(let de=0;de<ie/4;de++)oe.opacityVertexArray.emplaceBack(re)};let ne=0;for(let oe=0;oe<c.symbolInstances.length;oe++){const ie=c.symbolInstances.get(oe),{numHorizontalGlyphVertices:re,numVerticalGlyphVertices:de,crossTileID:be,numIconVertices:Ee}=ie,ce=f.has(be);let fe=this.opacities[be];ce?fe=M:fe||(fe=K,this.opacities[be]=fe),f.add(be);const Ce=re>0||de>0,Oe=Ee>0,Ae=this.placedOrientations[be],Le=Ae===s.W.vertical,ut=Ae===s.W.horizontal||Ae===s.W.horizontalOnly;if(!Ce&&!Oe||fe.isHidden()||ne++,Ce){const He=Gs(fe.text);ee(c.text,re,Le?Te:He),ee(c.text,de,ut?Te:He);const Je=fe.text.isHidden(),{leftJustifiedTextSymbolIndex:Be,centerJustifiedTextSymbolIndex:lt,rightJustifiedTextSymbolIndex:Qe,verticalPlacedTextSymbolIndex:dt}=ie,ye=c.text.placedSymbolArray,$e=Je||Le?1:0;Be>=0&&(ye.get(Be).hidden=$e),lt>=0&&(ye.get(lt).hidden=$e),Qe>=0&&(ye.get(Qe).hidden=$e),dt>=0&&(ye.get(dt).hidden=Je||ut?1:0);const St=this.variableOffsets[be];St&&this.markUsedJustification(c,St.anchor,ie,Ae);const pt=this.placedOrientations[be];pt&&(this.markUsedJustification(c,"left",ie,pt),this.markUsedOrientation(c,pt,ie))}if(Oe){const He=Gs(fe.icon),{placedIconSymbolIndex:Je,verticalPlacedIconSymbolIndex:Be}=ie,lt=c.icon.placedSymbolArray,Qe=fe.icon.isHidden()?1:0;Je>=0&&(ee(c.icon,Ee,Le?Te:He),lt.get(Je).hidden=Qe),Be>=0&&(ee(c.icon,ie.numVerticalIconVertices,ut?Te:He),lt.get(Be).hidden=Qe)}if(c.hasIconCollisionBoxData()||c.hasTextCollisionBoxData()){const He=c.collisionArrays[oe];if(He){let Je=new s.P(0,0),Be=!0;if(He.textBox||He.verticalTextBox){if(F){const Qe=this.variableOffsets[be];Qe?(Je=Cn(Qe.anchor,Qe.width,Qe.height,Qe.textOffset,Qe.textScale),$&&Je._rotate(Z?this.transform.angle:-this.transform.angle)):Be=!1}S&&(Be=!fe.clipped),He.textBox&&Vs(c.textCollisionBox.collisionVertexArray,fe.text.placed,!Be||Le,Je.x,Je.y),He.verticalTextBox&&Vs(c.textCollisionBox.collisionVertexArray,fe.text.placed,!Be||ut,Je.x,Je.y)}const lt=Be&&!!(!ut&&He.verticalIconBox);He.iconBox&&Vs(c.iconCollisionBox.collisionVertexArray,fe.icon.placed,lt,ie.hasIconTextFit?Je.x:0,ie.hasIconTextFit?Je.y:0),He.verticalIconBox&&Vs(c.iconCollisionBox.collisionVertexArray,fe.icon.placed,!lt,ie.hasIconTextFit?Je.x:0,ie.hasIconTextFit?Je.y:0)}}}if(c.fullyClipped=ne===0,c.sortFeatures(this.transform.angle),this.retainedQueryData[c.bucketInstanceId]&&(this.retainedQueryData[c.bucketInstanceId].featureSortOrder=c.featureSortOrder),c.hasTextData()&&c.text.opacityVertexBuffer&&c.text.opacityVertexBuffer.updateData(c.text.opacityVertexArray),c.hasIconData()&&c.icon.opacityVertexBuffer&&c.icon.opacityVertexBuffer.updateData(c.icon.opacityVertexArray),c.hasIconCollisionBoxData()&&c.iconCollisionBox.collisionVertexBuffer&&c.iconCollisionBox.collisionVertexBuffer.updateData(c.iconCollisionBox.collisionVertexArray),c.hasTextCollisionBoxData()&&c.textCollisionBox.collisionVertexBuffer&&c.textCollisionBox.collisionVertexBuffer.updateData(c.textCollisionBox.collisionVertexArray),c.bucketInstanceId in this.collisionCircleArrays){const oe=this.collisionCircleArrays[c.bucketInstanceId];c.placementInvProjMatrix=oe.invProjMatrix,c.placementViewportMatrix=oe.viewportMatrix,c.collisionCircleArray=oe.circles,delete this.collisionCircleArrays[c.bucketInstanceId]}}symbolFadeChange(c){return this.fadeDuration===0?1:(c-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(c){return Math.max(0,(this.transform.zoom-c)/1.5)}hasTransitions(c){return this.stale||c-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(c,f){const v=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*v>c}setStale(){this.stale=!0}}function Vs(_,c,f,v,w){_.emplaceBack(c?1:0,f?1:0,v||0,w||0),_.emplaceBack(c?1:0,f?1:0,v||0,w||0),_.emplaceBack(c?1:0,f?1:0,v||0,w||0),_.emplaceBack(c?1:0,f?1:0,v||0,w||0)}const $i=Math.pow(2,25),Yi=Math.pow(2,24),ha=Math.pow(2,17),Oo=Math.pow(2,16),ei=Math.pow(2,9),Cs=Math.pow(2,8),Ul=Math.pow(2,1);function Gs(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const c=_.placed?1:0,f=Math.floor(127*_.opacity);return f*$i+c*Yi+f*ha+c*Oo+f*ei+c*Cs+f*Ul+c}const Te=0;class Xe{constructor(c){this._sortAcrossTiles=c.layout.get("symbol-z-order")!=="viewport-y"&&c.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(c,f,v,w,S){const M=this._bucketParts;for(;this._currentTileIndex<c.length;)if(f.getBucketParts(M,w,c[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,M.sort((k,L)=>k.sortKey-L.sortKey));this._currentPartIndex<M.length;){const k=M[this._currentPartIndex];if(f.placeLayerBucketPart(k,this._seenCrossTileIDs,v,k.symbolInstanceStart===0),this._currentPartIndex++,S())return!0}return!1}}class Dt{constructor(c,f,v,w,S,M,k,L,F){this.placement=new Ai(c,S,M,k,L,F),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=v,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(c,f,v,w){const S=s.a4.now(),M=()=>{const k=s.a4.now()-S;return!this._forceFullPlacement&&k>2};for(;this._currentPlacementIndex>=0;){const k=f[c[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(k.type==="symbol"&&(!k.minzoom||k.minzoom<=L)&&(!k.maxzoom||k.maxzoom>L)){const F=k,$=F.layout.get("symbol-z-elevate"),Z=this._inProgressLayer=this._inProgressLayer||new Xe(F),K=s.aE(k.source,k.scope);if(Z.continuePlacement($?w[K]:v[K],this.placement,this._showCollisionBoxes,k,M))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(c){return this.placement.commit(c),this.placement}}const sr=512/s.J/2;class Dn{constructor(c,f,v){this.tileID=c,this.bucketInstanceId=v,this.index=new s.aZ(f.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=c.canonical.x*s.J,S=c.canonical.y*s.J;for(let M=0;M<f.length;M++){const{key:k,crossTileID:L,tileAnchorX:F,tileAnchorY:$}=f.get(M),Z=Math.floor((w+F)*sr),K=Math.floor((S+$)*sr);this.index.add(Z,K),this.keys.push(k),this.crossTileIDs.push(L)}this.index.finish()}findMatches(c,f,v){const w=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),S=sr/Math.pow(2,f.canonical.z-this.tileID.canonical.z),M=f.canonical.x*s.J,k=f.canonical.y*s.J;for(let L=0;L<c.length;L++){const F=c.get(L);if(F.crossTileID)continue;const{key:$,tileAnchorX:Z,tileAnchorY:K}=F,ee=Math.floor((M+Z)*S),ne=Math.floor((k+K)*S),oe=this.index.range(ee-w,ne-w,ee+w,ne+w);for(const ie of oe){const re=this.crossTileIDs[ie];if(this.keys[ie]===$&&!v.has(re)){v.add(re),F.crossTileID=re;break}}}}}class Wr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class vr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(c){const f=Math.round((c-this.lng)/360);if(f!==0)for(const v in this.indexes){const w=this.indexes[v],S={};for(const M in w){const k=w[M];k.tileID=k.tileID.unwrapTo(k.tileID.wrap+f),S[k.tileID.key]=k}this.indexes[v]=S}this.lng=c}addBucket(c,f,v){if(this.indexes[c.overscaledZ]&&this.indexes[c.overscaledZ][c.key]){if(this.indexes[c.overscaledZ][c.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(c.overscaledZ,this.indexes[c.overscaledZ][c.key])}for(let S=0;S<f.symbolInstances.length;S++)f.symbolInstances.get(S).crossTileID=0;this.usedCrossTileIDs[c.overscaledZ]||(this.usedCrossTileIDs[c.overscaledZ]=new Set);const w=this.usedCrossTileIDs[c.overscaledZ];for(const S in this.indexes){const M=this.indexes[S];if(Number(S)>c.overscaledZ)for(const k in M){const L=M[k];L.tileID.isChildOf(c)&&L.findMatches(f.symbolInstances,c,w)}else{const k=M[c.scaledTo(Number(S)).key];k&&k.findMatches(f.symbolInstances,c,w)}}for(let S=0;S<f.symbolInstances.length;S++){const M=f.symbolInstances.get(S);M.crossTileID||(M.crossTileID=v.generate(),w.add(M.crossTileID))}return this.indexes[c.overscaledZ]===void 0&&(this.indexes[c.overscaledZ]={}),this.indexes[c.overscaledZ][c.key]=new Dn(c,f.symbolInstances,f.bucketInstanceId),!0}removeBucketCrossTileIDs(c,f){for(const v of f.crossTileIDs)this.usedCrossTileIDs[c].delete(v)}removeStaleBuckets(c){let f=!1;for(const v in this.indexes){const w=this.indexes[v];for(const S in w)c[w[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(v,w[S]),delete w[S],f=!0)}return f}}class Ui{constructor(){this.layerIndexes={},this.crossTileIDs=new Wr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(c,f,v,w){let S=this.layerIndexes[c.fqid];S===void 0&&(S=this.layerIndexes[c.fqid]=new vr);let M=!1;const k={};w.name!=="globe"&&S.handleWrapJump(v);for(const L of f){const F=L.getBucket(c);F&&c.fqid===F.layerIds[0]&&(F.bucketInstanceId||(F.bucketInstanceId=++this.maxBucketInstanceId),S.addBucket(L.tileID,F,this.crossTileIDs)&&(M=!0),k[F.bucketInstanceId]=!0)}return S.removeStaleBuckets(k)&&(M=!0),M}pruneUnusedLayers(c){const f={};c.forEach(v=>{f[v]=!0});for(const v in this.layerIndexes)f[v]||delete this.layerIndexes[v]}}var ki=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,An=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,vec2 pos,vec2 lod_coord) {vec2 size=vec2(textureSize(image,0));vec2 dx=dFdx(lod_coord.xy*size);vec2 dy=dFdy(lod_coord.xy*size);float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}`,wo=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,Do="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ui=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,Ro=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,gi=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Ho=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,cs=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,da=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Vl=[];Fa(ki,Vl),Fa(wo,Vl),Fa(An,Vl);const us={"_prelude_fog.vertex.glsl":Ro,"_prelude_terrain.vertex.glsl":ui,"_prelude_shadow.vertex.glsl":cs,"_prelude_fog.fragment.glsl":gi,"_prelude_shadow.fragment.glsl":da,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Ho},hs={};Vr("",ui),Vr(gi,Ro),Vr(da,cs),Vr(Ho,"");const by=Vr(An,wo),Gl=ki;var Op={background:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Vr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Vr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Vr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Vr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Vr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Vr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);cutoff=max(0.01,cutoff_opacity(u_cutoff_params,ground.z));if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff < 0.01 && centroid_pos.x !=0.0));gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Vr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Vr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Vr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Vr(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float pattern_x=v_linesofar/pattern_size.x*aspect;float x=mod(pattern_x,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:Vr(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:Vr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:Vr(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:Vr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Vr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Do),skyboxGradient:Vr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Do),skyboxCapture:Vr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Vr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Vr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Vr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Vr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Fa(_,c){const f=_.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let v of f)if(v=v.trim(),v[0]==="#"&&v.includes("if")&&!v.includes("endif")){v=v.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=v.split(" ");for(const S of w)c.includes(S)||c.push(S)}}function Vr(_,c){const f=/#include\s+"([^"]+)"/g,v=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let w=c.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);w&&(w=w.map(F=>{const $=F.split(" ");return $[$.length-1]}),w=[...new Set(w)]);const S={},M=[],k=[];if(_=_.replace(f,(F,$)=>(k.push($),"")),(c=c.replace(f,(F,$)=>(M.push($),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let L=[...Vl];Fa(_,L),Fa(c,L);for(const F of[...M,...k])us[F]||console.error(`Undefined include: ${F}`),hs[F]||(hs[F]=[],Fa(us[F],hs[F])),L=[...L,...hs[F]];return{fragmentSource:_=_.replace(v,(F,$,Z,K,ee)=>(S[ee]=!0,$==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
in ${Z} ${K} ${ee};
#else
uniform ${Z} ${K} u_${ee};
#endif
`:$==="initialize"?`
#ifdef HAS_UNIFORM_u_${ee}
    ${Z} ${K} ${ee} = u_${ee};
#endif
`:$==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
    in ${Z} ${K} ${ee};
#endif
`:$==="initialize-attribute"?"":void 0)),vertexSource:c=c.replace(v,(F,$,Z,K,ee)=>{const ne=K==="float"?"vec2":K,oe=ee.match(/color/)?"color":ne;return $==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
in ${Z} ${K} a_${ee};
#endif
`:S[ee]?$==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
in ${Z} ${ne} a_${ee};
out ${Z} ${K} ${ee};
#else
uniform ${Z} ${K} u_${ee};
#endif
`:$==="initialize"?oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = a_${ee};
#else
    ${Z} ${K} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    ${ee} = unpack_mix_${oe}(a_${ee}, u_${ee}_t);
#else
    ${Z} ${K} ${ee} = u_${ee};
#endif
`:$==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
    in ${Z} ${K} a_${ee};
    out ${Z} ${K} ${ee};
#endif
`:$==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
    ${ee} = a_${ee};
#endif
`:void 0:$==="define"?`
#ifndef HAS_UNIFORM_u_${ee}
uniform lowp float u_${ee}_t;
in ${Z} ${ne} a_${ee};
#else
uniform ${Z} ${K} u_${ee};
#endif
`:$==="define-instanced"?oe==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${ee}0;
in vec4 a_${ee}1;
in vec4 a_${ee}2;
in vec4 a_${ee}3;
#else
uniform ${Z} ${K} u_${ee};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${Z} ${ne} a_${ee};
#else
uniform ${Z} ${K} u_${ee};
#endif
`:$==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${ee}
    ${Z} ${K} ${ee} = a_${ee};
#endif
`:oe==="vec4"?`
#ifndef HAS_UNIFORM_u_${ee}
    ${Z} ${K} ${ee} = a_${ee};
#else
    ${Z} ${K} ${ee} = u_${ee};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ee}
    ${Z} ${K} ${ee} = unpack_mix_${oe}(a_${ee}, u_${ee}_t);
#else
    ${Z} ${K} ${ee} = u_${ee};
#endif
`}),staticAttributes:w,usedDefines:L,vertexIncludes:M,fragmentIncludes:k}}class G1{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(c,f,v,w,S,M,k,L){this.context=c;let F=this.boundPaintVertexBuffers.length!==w.length;for(let Z=0;!F&&Z<w.length;Z++)this.boundPaintVertexBuffers[Z]!==w[Z]&&(F=!0);let $=this.boundDynamicVertexBuffers.length!==k.length;for(let Z=0;!$&&Z<k.length;Z++)this.boundDynamicVertexBuffers[Z]!==k[Z]&&($=!0);if(!this.vao||this.boundProgram!==f||this.boundLayoutVertexBuffer!==v||F||$||this.boundIndexBuffer!==S||this.boundVertexOffset!==M)this.freshBind(f,v,w,S,M,k,L);else{c.bindVertexArrayOES.set(this.vao);for(const Z of k)Z&&(Z.bind(),L&&Z.instanceCount&&Z.setVertexAttribDivisor(c.gl,f,L));S&&S.dynamicDraw&&S.bind()}}freshBind(c,f,v,w,S,M,k){const L=c.numAttributes,F=this.context,$=F.gl;this.vao&&this.destroy(),this.vao=F.gl.createVertexArray(),F.bindVertexArrayOES.set(this.vao),this.boundProgram=c,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=v,this.boundIndexBuffer=w,this.boundVertexOffset=S,this.boundDynamicVertexBuffers=M,f.enableAttributes($,c),f.bind(),f.setVertexAttribPointers($,c,S);for(const Z of v)Z.enableAttributes($,c),Z.bind(),Z.setVertexAttribPointers($,c,S);for(const Z of M)Z&&(Z.enableAttributes($,c),Z.bind(),Z.setVertexAttribPointers($,c,S),k&&Z.instanceCount&&Z.setVertexAttribDivisor($,c,k));w&&w.bind(),F.currentNumAttributes=L}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function q1(_,c){const f=Math.pow(2,c.canonical.z),v=c.canonical.y;return[new s.M(0,v/f).toLngLat().lat,new s.M(0,(v+1)/f).toLngLat().lat]}function W1(_,c,f,v,w,S,M){const k=_.context,L=k.gl,F=f.hillshadeFBO;if(!F)return;_.prepareDrawTile();const $=_.isTileAffectedByFog(c),Z=_.getOrCreateProgram("hillshade",{overrideFog:$});k.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,F.colorAttachment.get());const K=((ie,re,de,be)=>{const Ee=de.paint.get("hillshade-shadow-color"),ce=de.paint.get("hillshade-highlight-color"),fe=de.paint.get("hillshade-accent-color"),Ce=de.paint.get("hillshade-emissive-strength");let Oe=s.d(de.paint.get("hillshade-illumination-direction"));if(de.paint.get("hillshade-illumination-anchor")==="viewport")Oe-=ie.transform.angle;else if(ie.style&&ie.style.enable3dLights()&&ie.style.directionalLight){const Le=ie.style.directionalLight.properties.get("direction"),ut=s.b3(Le.x,Le.y,Le.z);Oe=s.d(ut[1])}const Ae=!ie.options.moving;return{u_matrix:be||ie.transform.calculateProjMatrix(re.tileID.toUnwrapped(),Ae),u_image:0,u_latrange:q1(0,re.tileID),u_light:[de.paint.get("hillshade-exaggeration"),Oe],u_shadow:Ee,u_highlight:ce,u_emissive_strength:Ce,u_accent:fe}})(_,f,v,_.terrain?c.projMatrix:null);_.uploadCommonUniforms(k,Z,c.toUnwrapped());const{tileBoundsBuffer:ee,tileBoundsIndexBuffer:ne,tileBoundsSegments:oe}=_.getTileBoundsBuffers(f);Z.draw(_,L.TRIANGLES,w,S,M,s.b5.disabled,K,v.id,ee,ne,oe)}function Dp(_,c,f){if(!c.needsDEMTextureUpload)return;const v=_.context,w=v.gl;v.pixelStoreUnpackPremultiplyAlpha.set(!1),c.demTexture=c.demTexture||_.getTileTexture(f.stride);const S=f.getPixels();c.demTexture?c.demTexture.update(S,{premultiply:!1}):c.demTexture=new s.a9(v,S,w.R32F,{premultiply:!1}),c.needsDEMTextureUpload=!1}function H1(_,c,f){const v=_.context,w=v.gl;if(!c.dem)return;const S=c.dem;if(v.activeTexture.set(w.TEXTURE1),Dp(_,c,S),!c.demTexture)return;c.demTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE);const M=S.dim;v.activeTexture.set(w.TEXTURE0);let k=c.hillshadeFBO;if(!k){const K=new s.a9(v,{width:M,height:M,data:null},w.RGBA);K.bind(w.LINEAR,w.CLAMP_TO_EDGE),k=c.hillshadeFBO=v.createFramebuffer(M,M,!0,"renderbuffer"),k.colorAttachment.set(K.texture)}v.bindFramebuffer.set(k.framebuffer),v.viewport.set([0,0,M,M]);const{tileBoundsBuffer:L,tileBoundsIndexBuffer:F,tileBoundsSegments:$}=_.getMercatorTileBoundsBuffers(),Z=[];_.linearFloatFilteringSupported()&&Z.push("TERRAIN_DEM_FLOAT_FORMAT"),_.getOrCreateProgram("hillshadePrepare",{defines:Z}).draw(_,w.TRIANGLES,s.b4.disabled,s.b6.disabled,s.a.unblended,s.b5.disabled,((K,ee)=>{const ne=ee.stride,oe=s.m.create();return s.m.ortho(oe,0,s.J,-s.J,0,0,1),s.m.translate(oe,oe,[0,-s.J,0]),{u_matrix:oe,u_image:1,u_dimension:[ne,ne],u_zoom:K.overscaledZ}})(c.tileID,S),f.id,L,F,$),c.needsHillshadePrepare=!1}const _d=_=>({u_matrix:new s.a_(_),u_image0:new s.a$(_),u_skirt_height:new s.b2(_),u_ground_shadow_factor:new s.b7(_)}),Rp=(_,c,f)=>({u_matrix:_,u_image0:0,u_skirt_height:c,u_ground_shadow_factor:f}),Lp=(_,c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne)=>({u_proj_matrix:Float32Array.from(_),u_globe_matrix:c,u_normalize_matrix:Float32Array.from(v),u_merc_matrix:f,u_zoom_transition:w,u_merc_center:S,u_image0:0,u_frustum_tl:M,u_frustum_tr:k,u_frustum_br:L,u_frustum_bl:F,u_globe_pos:$,u_globe_radius:Z,u_viewport:K,u_grid_matrix:ne?Float32Array.from(ne):new Float32Array(9),u_skirt_height:ee}),ql=(_,c)=>{if(c>0&&_.terrain&&s.X("Cutoff is currently disabled on terrain"),c<=0||_.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const f=_.transform,v=Math.max(Math.abs(f._zoom-(_.minCutoffZoom-1)),1),w=f.isLODDisabled(!1)?s.an(60,45,f.pitch):s.an(30,15,f.pitch),S=f._farZ-f._nearZ,M=c*f.height,k=((1-(L=w))*f.cameraToCenterDistance+L*(f._farZ+M))*v;var L;return{shouldRenderCutoff:w<1,uniformValues:{u_cutoff_params:[f._nearZ,f._farZ,(k-f._nearZ)/S,(k-M-f._nearZ)/S]}}};function zp(_,c){return _!=null&&c!=null&&!(!_.hasData()||!c.hasData())&&_.demTexture!=null&&c.demTexture!=null&&_.tileID.key!==c.tileID.key}const fa=new class{constructor(){this.operations={}}newMorphing(_,c,f,v,w){if(_ in this.operations){const S=this.operations[_];S.to.tileID.key!==f.tileID.key&&(S.queued=f)}else this.operations[_]={startTime:v,phase:0,duration:w,from:c,to:f,queued:null}}getMorphValuesForProxy(_){if(!(_ in this.operations))return null;const c=this.operations[_];return{from:c.from,to:c.to,phase:c.phase}}update(_){for(const c in this.operations){const f=this.operations[c];for(f.phase=(_-f.startTime)/f.duration;f.phase>=1||!this._validOp(f);)if(!this._nextOp(f,_)){delete this.operations[c];break}}}_nextOp(_,c){return!!_.queued&&(_.from=_.to,_.to=_.queued,_.queued=null,_.phase=0,_.startTime=c,!0)}_validOp(_){return _.from.hasData()&&_.to.hasData()}},yd={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Np(_,c,f){if(c===0)return 0;const v=c<1&&f===514?.25/c:1;return 6*Math.pow(1.5,22-_)*Math.max(c,1)*v}function Fp(_,c){const f=1<<_.z;return!c&&(_.x===0||_.x===f-1)||_.y===0||_.y===f-1}const vd=_=>({u_matrix:_});function xd(_,c,f,v,w){if(w>0){const S=s.a4.now(),M=(S-_.timeAdded)/w,k=c?(S-c.timeAdded)/w:-1,L=f.getSource(),F=v.coveringZoomLevel({tileSize:L.tileSize,roundZoom:L.roundZoom}),$=!c||Math.abs(c.tileID.overscaledZ-F)>Math.abs(_.tileID.overscaledZ-F),Z=$&&_.refreshedUponExpiration?1:s.c($?M:1-k,0,1);return _.refreshedUponExpiration&&M>=1&&(_.refreshedUponExpiration=!1),c?{opacity:1,mix:1-Z}:{opacity:Z,mix:0}}return{opacity:1,mix:0}}class kt extends s.bq{constructor(c){const f={type:"raster-dem",maxzoom:c.transform.maxZoom},v=new s.br(s.bs(),null),w=yo("mock-dem",f,v,c.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(c,f){c.state="loaded",f(null)}}class wy extends s.bq{constructor(c){const f=yo("proxy",{type:"geojson",maxzoom:c.transform.maxZoom},new s.br(s.bs(),null),c.style);super("proxy",f,!1),f.setEventedParent(this),this.map=this.getSource().map=c,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(c,f,v){if(c.freezeTileCoverage)return;this.transform=c;const w=c.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((S,M)=>{if(S[M.key]="",!this._tiles[M.key]){const k=new s.bt(M,this._source.tileSize*M.overscaleFactor(),c.tileZoom);k.state="loaded",this._tiles[M.key]=k}return S},{});for(const S in this._tiles)S in w||(this.freeFBO(S),this._tiles[S].unloadVectorData(),delete this._tiles[S])}freeFBO(c){const f=this.proxyCachedFBO[c];if(f!==void 0){const v=Object.values(f);this.renderCachePool.push(...v),delete this.proxyCachedFBO[c]}}deallocRenderCache(){this.renderCache.forEach(c=>c.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class bd extends s.O{constructor(c,f,v){super(c.overscaledZ,c.wrap,c.canonical.z,c.canonical.x,c.canonical.y),this.proxyTileKey=f,this.projMatrix=v}}class Bp extends s.bk{constructor(c,f){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},c.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),c.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),c.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=c,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[v,w,S]=function(L){const F=new s.bo,$=new s.bp,Z=131;F.reserve(17161),$.reserve(33800);const K=s.J/128,ee=s.J+K/2,ne=ee+K;for(let ie=-K;ie<ne;ie+=K)for(let re=-K;re<ne;re+=K){const de=re<0||re>ee||ie<0||ie>ee?24575:0,be=s.c(Math.round(re),0,s.J),Ee=s.c(Math.round(ie),0,s.J);F.emplaceBack(be+de,Ee)}const oe=(ie,re)=>{const de=re*Z+ie;$.emplaceBack(de+1,de,de+Z),$.emplaceBack(de+Z,de+Z+1,de+1)};for(let ie=1;ie<129;ie++)for(let re=1;re<129;re++)oe(re,ie);return[0,129].forEach(ie=>{for(let re=0;re<130;re++)oe(re,ie),oe(ie,re)}),[F,$,32768]}(),M=c.context;this.gridBuffer=M.createVertexBuffer(v,s.bl.members),this.gridIndexBuffer=M.createIndexBuffer(w),this.gridSegments=s.bm.simpleSegment(0,0,v.length,w.length),this.gridNoSkirtSegments=s.bm.simpleSegment(0,0,v.length,S),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new wy(f.map),this.orthoMatrix=s.m.create(),s.m.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,s.J,0,s.J,0,1);const k=M.gl;this._overlapStencilMode=new s.b6({func:k.GEQUAL,mask:255},0,255,k.KEEP,k.KEEP,k.REPLACE),this._previousZoom=c.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=f,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new kt(f.map),this._pendingGroundEffectLayers=[]}set style(c){c.on("data",this._onStyleDataEvent.bind(this)),this._style=c,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(c,f,v){if(c&&c.terrain){this._style!==c&&(this.style=c,this._evaluationZoom=void 0);const w=c.terrain.properties,S=c.terrain.drapeRenderMode===0,M=c.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=s.a4.now();const k=c.terrain&&c.terrain.scope,L=w.get("source"),F=S?this._mockSourceCache:c.getSourceCache(L,k);if(!F)return void s.X(`Couldn't find terrain source "${L}".`);if(this.sourceCache=F,this._exaggeration=M?this.calculateExaggeration(f):w.get("exaggeration"),!f.projection.requiresDraping&&M&&this._exaggeration===0)return void this._disable();this.enabled=!0;const $=()=>{this.sourceCache.used&&s.X(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const Z=this.getScaledDemTileSize();this.sourceCache.update(f,Z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,$(),this._initializing=!0),$(),f.updateElevation(!0,v),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(f),this._emptyDEMTextureDirty=!0,this._previousZoom=f.zoom}else this._disable()}calculateExaggeration(c){const f=this._previousCameraAltitude,v=c.getFreeCameraOptions().position.z/c.pixelsPerMeter*c.worldSize;this._previousCameraAltitude=v;const w=f!=null?v-f:Number.MAX_VALUE;if(Math.abs(w)<2)return this._exaggeration;const S=c.zoom,M=this._style.terrain;if(!this._previousUpdateTimestamp)return M.getExaggeration(S);let k=S-this._previousZoom;const L=this._previousUpdateTimestamp;let F=S;this._evaluationZoom!=null&&(F=this._evaluationZoom,Math.abs(S-F)>.5&&(k=.5*(S-F+k)),k*w<0&&(F+=k)),this._evaluationZoom=F;const $=M.getExaggeration(F),Z=$===M.getExaggeration(Math.max(0,F-.1));if(Z&&Math.abs($-this._exaggeration)<.01)return $;let K=Math.min(.1,.00375*(this._updateTimestamp-L));return(Z||$<.1||Math.abs(k)<1e-4)&&(K=Math.min(.2,4*K)),s.n(this._exaggeration,$,K)}resetTileLookupCache(c){this._findCoveringTileCache[c]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(c){c.coord&&c.dataType==="source"?this._clearRenderCacheForTile(c.sourceCacheId,c.coord):c.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const c in this._style._mergedSourceCaches)this._style._mergedSourceCaches[c].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(c=>c.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const c=2*this.proxySourceCache.getSource().tileSize;return[c,c]}set useVertexMorphing(c){this._useVertexMorphing=c}updateTileBinding(c){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const f=this.proxySourceCache,v=this.painter.transform;this._initializing&&(this._initializing=v._centerAltitude===0&&this.getAtPointOrZero(s.M.fromLngLat(v.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=f.getIds().map(L=>{const F=f.getTileByID(L).tileID;return F.projMatrix=v.calculateProjMatrix(F.toUnwrapped()),F});(function(L,F){const $=F.transform.pointCoordinate(F.transform.getCameraPoint()),Z=new s.P($.x,$.y);L.sort((K,ee)=>{if(ee.overscaledZ-K.overscaledZ)return ee.overscaledZ-K.overscaledZ;const ne=new s.P(K.canonical.x+(1<<K.canonical.z)*K.wrap,K.canonical.y),oe=new s.P(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),ie=Z.mult(1<<K.canonical.z);return ie.x-=.5,ie.y-=.5,ie.distSqr(ne)-ie.distSqr(oe)})})(w,this.painter);const S=this.proxyToSource||{};this.proxyToSource={},w.forEach(L=>{this.proxyToSource[L.key]={}}),this.terrainTileForTile={};const M=this._style._mergedSourceCaches;for(const L in M){const F=M[L];if(!F.used||(F!==this.sourceCache&&this.resetTileLookupCache(F.id),this._setupProxiedCoordsForOrtho(F,c[L],S),F.usedForTerrain))continue;const $=c[L];F.getSource().reparseOverscaled&&this._assignTerrainTiles($)}this.proxiedCoords[f.id]=w.map(L=>new bd(L,L.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(S),this.renderingToTexture=!1;const k={};this._visibleDemTiles=[];for(const L of this.proxyCoords){const F=this.terrainTileForTile[L.key];if(!F)continue;const $=F.tileID.key;$ in k||(this._visibleDemTiles.push(F),k[$]=$)}}_assignTerrainTiles(c){this._initializing||c.forEach(f=>{if(this.terrainTileForTile[f.key])return;const v=this._findTileCoveringTileID(f,this.sourceCache);v&&(this.terrainTileForTile[f.key]=v)})}_prepareDEMTextures(){const c=this.painter.context,f=c.gl;for(const v in this.terrainTileForTile){const w=this.terrainTileForTile[v],S=w.dem;!S||w.demTexture&&!w.needsDEMTextureUpload||(c.activeTexture.set(f.TEXTURE1),Dp(this.painter,w,S))}}_prepareDemTileUniforms(c,f,v,w){if(!f||f.demTexture==null)return!1;const S=c.tileID.canonical,M=Math.pow(2,f.tileID.canonical.z-S.z),k=w||"";return v[`u_dem_tl${k}`]=[S.x*M%1,S.y*M%1],v[`u_dem_scale${k}`]=M,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const c=this.painter.context,f=c.gl;if(!this._emptyDepthBufferTexture){const v=new s.a5({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new s.a9(c,v,f.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let c=0;const f=this._visibleDemTiles.reduce((v,w)=>{if(!w.dem)return v;const S=w.dem.tree.minimums[0];return S>0&&c++,v+S},0);return c?f/c:0}_updateEmptyDEMTexture(){const c=this.painter.context,f=c.gl;c.activeTexture.set(f.TEXTURE2);const v=this._getLoadedAreaMinimum(),[w,S]=(()=>{const k=new s.bu({width:1,height:1},new Float32Array([v]));return[f.R32F,k]})();this._emptyDEMTextureDirty=!1;let M=this._emptyDEMTexture;return M?M.update(S,{premultiply:!1}):M=this._emptyDEMTexture=new s.a9(c,S,w,{premultiply:!1}),M}setupElevationDraw(c,f,v){const w=this.painter.context,S=w.gl,M={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};M.u_exaggeration=this.exaggeration();let k=null,L=null,F=1;if(v&&v.morphing&&this._useVertexMorphing){const K=v.morphing.srcDemTile,ee=v.morphing.dstDemTile;F=v.morphing.phase,K&&ee&&(this._prepareDemTileUniforms(c,K,M,"_prev")&&(L=K),this._prepareDemTileUniforms(c,ee,M)&&(k=ee))}const $=K=>K&&K.demTexture&&this.painter.linearFloatFilteringSupported()?S.LINEAR:S.NEAREST,Z=K=>{M.u_dem_size=K.size[0]===1?1:K.size[0]-2};if(L&&k)w.activeTexture.set(S.TEXTURE2),k.demTexture.bind($(k),S.CLAMP_TO_EDGE),w.activeTexture.set(S.TEXTURE4),L.demTexture.bind($(L),S.CLAMP_TO_EDGE),k.demTexture&&Z(k.demTexture),M.u_dem_lerp=F;else{k=this.terrainTileForTile[c.tileID.key],w.activeTexture.set(S.TEXTURE2);const K=this._prepareDemTileUniforms(c,k,M)?k.demTexture:this.emptyDEMTexture;K.bind($(k),S.CLAMP_TO_EDGE),Z(K)}if(w.activeTexture.set(S.TEXTURE3),v&&v.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),this._depthFBO&&(M.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE),M.u_depth_size_inv=[1,1]),v&&v.useMeterToDem&&k){const K=(1<<k.tileID.canonical.z)*s.b(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;M.u_meter_to_dem=K}if(v&&v.labelPlaneMatrixInv&&(M.u_label_plane_matrix_inv=v.labelPlaneMatrixInv),f.setTerrainUniformValues(w,M),this.painter.transform.projection.name==="globe"){const K=this.globeUniformValues(this.painter.transform,c.tileID.canonical,v&&v.useDenormalizedUpVectorScale);f.setGlobeUniformValues(w,K)}}globeUniformValues(c,f,v){const w=c.projection;return{u_tile_tl_up:w.upVector(f,0,0),u_tile_tr_up:w.upVector(f,s.J,0),u_tile_br_up:w.upVector(f,s.J,s.J),u_tile_bl_up:w.upVector(f,0,s.J),u_tile_up_scale:v?s.bn(1):w.upVectorScale(f,c.center.lat,c.worldSize).metersToTile}}renderToBackBuffer(c){const f=this.painter,v=this.painter.context;c.length!==0&&(v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),f.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,S,M,k,L){if(w.transform.projection.name==="globe")(function(F,$,Z,K,ee){const ne=F.context,oe=ne.gl;let ie,re;const de=F.transform,be=s.bb(F,ne,de),Ee=(Je,Be)=>{if(re===Be)return;const lt=[yd[Be],"PROJECTION_GLOBE_VIEW"];be&&lt.push("CUSTOM_ANTIALIASING");const Qe=F.isTileAffectedByFog(Je);ie=F.getOrCreateProgram("globeRaster",{defines:lt,overrideFog:Qe}),re=Be},ce=F.colorModeForRenderPass(),fe=new s.b4(oe.LEQUAL,s.b4.ReadWrite,F.depthRangeFor3D);fa.update(ee);const Ce=s.bc(de),Oe=[s.E(de.center.lng),s.H(de.center.lat)],Ae=F.globeSharedBuffers,Le=[de.width*s.a4.devicePixelRatio,de.height*s.a4.devicePixelRatio],ut=Float32Array.from(de.globeMatrix),He={useDenormalizedUpVectorScale:!0};{const Je=F.transform,Be=Np(Je.zoom,$.exaggeration(),$.sourceCache._source.tileSize);re=-1;const lt=oe.TRIANGLES;for(const Qe of K){const dt=Z.getTile(Qe),ye=s.b6.disabled,$e=$.prevTerrainTileForTile[Qe.key],St=$.terrainTileForTile[Qe.key];zp($e,St)&&fa.newMorphing(Qe.key,$e,St,ee,250),ne.activeTexture.set(oe.TEXTURE0),dt.texture&&dt.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const pt=fa.getMorphValuesForProxy(Qe.key),Xt=pt?1:0;pt&&s.bd(He,{morphing:{srcDemTile:pt.from,dstDemTile:pt.to,phase:s.ba(pt.phase)}});const Bt=s.be(Qe.canonical),nr=s.bf(Bt.getCenter().lat),Wt=s.bg(Qe.canonical,Bt,nr,Je.worldSize/Je._pixelsPerMercatorPixel),cr=s.bh(s.bi(Qe.canonical)),ur=Lp(Je.expandedFarZProjMatrix,ut,Ce,cr,s.ao(Je.zoom),Oe,Je.frustumCorners.TL,Je.frustumCorners.TR,Je.frustumCorners.BR,Je.frustumCorners.BL,Je.globeCenterInViewSpace,Je.globeRadius,Le,Be,Wt);if(Ee(Qe,Xt),ie&&($.setupElevationDraw(dt,ie,He),F.uploadCommonUniforms(ne,ie,Qe.toUnwrapped()),Ae)){const[er,tr,Yr]=Ae.getGridBuffers(nr,Be!==0);ie.draw(F,lt,fe,ye,ce,s.b5.backCCW,ur,"globe_raster",er,tr,Yr)}}}if(Ae&&(F.renderDefaultNorthPole||F.renderDefaultSouthPole)){const Je=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];be&&Je.push("CUSTOM_ANTIALIASING"),ie=F.getOrCreateProgram("globeRaster",{defines:Je});for(const Be of K){const{x:lt,y:Qe,z:dt}=Be.canonical,ye=Qe===0,$e=Qe===(1<<dt)-1,[St,pt,Xt,Bt]=Ae.getPoleBuffers(dt,!1);if(Bt&&(ye||$e)){const nr=Z.getTile(Be);ne.activeTexture.set(oe.TEXTURE0),nr.texture&&nr.texture.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);let Wt=s.bj(dt,lt,de);const cr=s.bh(s.bi(Be.canonical)),ur=(er,tr)=>er.draw(F,oe.TRIANGLES,fe,s.b6.disabled,ce,s.b5.disabled,Lp(de.expandedFarZProjMatrix,Wt,Wt,cr,0,Oe,de.frustumCorners.TL,de.frustumCorners.TR,de.frustumCorners.BR,de.frustumCorners.BL,de.globeCenterInViewSpace,de.globeRadius,Le,0),"globe_pole_raster",tr,Xt,Bt);$.setupElevationDraw(nr,ie,He),F.uploadCommonUniforms(ne,ie,Be.toUnwrapped()),ye&&F.renderDefaultNorthPole&&ur(ie,St),$e&&F.renderDefaultSouthPole&&(Wt=s.m.scale(s.m.create(),Wt,[1,-1,1]),ur(ie,pt))}}}})(w,S,M,k,L);else{const F=w.context,$=F.gl;let Z,K;const ee=w.shadowRenderer,ne=ql(w,w.longestCutoffRange),oe=ce=>{if(K===ce)return;const fe=[];fe.push(yd[ce]),ne.shouldRenderCutoff&&fe.push("RENDER_CUTOFF"),Z=w.getOrCreateProgram("terrainRaster",{defines:fe}),K=ce},ie=w.colorModeForRenderPass(),re=new s.b4($.LEQUAL,s.b4.ReadWrite,w.depthRangeFor3D);fa.update(L);const de=w.transform,be=Np(de.zoom,S.exaggeration(),S.sourceCache._source.tileSize);let Ee=[0,0,0];if(ee){const ce=w.style.directionalLight,fe=w.style.ambientLight;ce&&fe&&(Ee=Rd(ce,fe))}{K=-1;const ce=$.TRIANGLES,[fe,Ce]=[S.gridIndexBuffer,S.gridSegments];for(const Oe of k){const Ae=M.getTile(Oe),Le=s.b6.disabled,ut=S.prevTerrainTileForTile[Oe.key],He=S.terrainTileForTile[Oe.key];zp(ut,He)&&fa.newMorphing(Oe.key,ut,He,L,250),F.activeTexture.set($.TEXTURE0),Ae.texture&&Ae.texture.bind($.LINEAR,$.CLAMP_TO_EDGE);const Je=fa.getMorphValuesForProxy(Oe.key),Be=Je?1:0;let lt;Je&&(lt={morphing:{srcDemTile:Je.from,dstDemTile:Je.to,phase:s.ba(Je.phase)}});const Qe=Rp(Oe.projMatrix,Fp(Oe.canonical,de.renderWorldCopies)?be/10:be,Ee);if(oe(Be),!Z)continue;S.setupElevationDraw(Ae,Z,lt);const dt=Oe.toUnwrapped();ee&&ee.setupShadows(dt,Z),w.uploadCommonUniforms(F,Z,dt,null,ne),Z.draw(w,ce,re,Le,ie,s.b5.backCCW,Qe,"terrain_raster",S.gridBuffer,fe,Ce)}}}}(f,this,this.proxySourceCache,c,this._updateTimestamp),this.renderingToTexture=!0,f.gpuTimingDeferredRenderEnd(),c.splice(0,c.length))}renderBatch(c){if(this._drapedRenderBatches.length===0)return c+1;this.renderingToTexture=!0;const f=this.painter,v=this.painter.context,w=this.proxySourceCache,S=this.proxiedCoords[w.id],M=this._drapedRenderBatches.shift(),k=f.style.order,L=[];let F=0;for(const $ of S){const Z=w.getTileByID($.proxyTileKey),K=w.proxyCachedFBO[$.key]?w.proxyCachedFBO[$.key][c]:void 0,ee=K!==void 0?w.renderCache[K]:this.pool[F++],ne=K!==void 0;if(Z.texture=ee.tex,ne&&!ee.dirty){L.push(Z.tileID);continue}let oe;v.bindFramebuffer.set(ee.fb.framebuffer),this.renderedToTile=!1,ee.dirty&&(v.clear({color:s.C.transparent,stencil:0}),ee.dirty=!1);for(let ie=M.start;ie<=M.end;++ie){const re=f.style._mergedLayers[k[ie]];if(re.isHidden(f.transform.zoom))continue;const de=f.style.getLayerSourceCache(re),be=de?this.proxyToSource[$.key][de.id]:[$];if(!be)continue;const Ee=be;v.viewport.set([0,0,ee.fb.width,ee.fb.height]),oe!==(de?de.id:null)&&(this._setupStencil(ee,be,re,de),oe=de?de.id:null),f.renderLayer(f,de,re,Ee)}if(this._drapedRenderBatches.length===0)for(const ie of this._pendingGroundEffectLayers){const re=f.style._mergedLayers[k[ie]];if(re.isHidden(f.transform.zoom))continue;const de=f.style.getLayerSourceCache(re),be=de?this.proxyToSource[$.key][de.id]:[$];if(!be)continue;const Ee=be;v.viewport.set([0,0,ee.fb.width,ee.fb.height]),oe!==(de?de.id:null)&&(this._setupStencil(ee,be,re,de),oe=de?de.id:null),f.renderLayer(f,de,re,Ee)}this.renderedToTile?(ee.dirty=!0,L.push(Z.tileID)):ne||--F,F===5&&(F=0,this.renderToBackBuffer(L))}return this.renderToBackBuffer(L),this.renderingToTexture=!1,v.bindFramebuffer.set(null),v.viewport.set([0,0,f.width,f.height]),M.end+1}postRender(){}isLayerOrderingCorrect(c){const f=c.order.length;let v=-1,w=f;for(let S=0;S<f;++S)this._style.isLayerDraped(c._mergedLayers[c.order[S]])?v=Math.max(v,S):w=Math.min(w,S);return w>v}getMinElevationBelowMSL(){let c=0;return this._visibleDemTiles.filter(f=>f.dem).forEach(f=>{c=Math.min(c,f.dem.tree.minimums[0])}),c===0?c:(c-30)*this._exaggeration}raycast(c,f,v){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(S=>S.dem).map(S=>{const M=S.tileID,k=1<<M.overscaledZ,{x:L,y:F}=M.canonical,$=L/k,Z=(L+1)/k,K=F/k,ee=(F+1)/k;return{minx:$,miny:K,maxx:Z,maxy:ee,t:S.dem.tree.raycastRoot($,K,Z,ee,c,f,v),tile:S}});w.sort((S,M)=>(S.t!==null?S.t:Number.MAX_VALUE)-(M.t!==null?M.t:Number.MAX_VALUE));for(const S of w){if(S.t==null)return null;const M=S.tile.dem.tree.raycast(S.minx,S.miny,S.maxx,S.maxy,c,f,v);if(M!=null)return M}return null}_createFBO(){const c=this.painter.context,f=c.gl,v=this.drapeBufferSize;c.activeTexture.set(f.TEXTURE0);const w=new s.a9(c,{width:v[0],height:v[1],data:null},f.RGBA);w.bind(f.LINEAR,f.CLAMP_TO_EDGE);const S=c.createFramebuffer(v[0],v[1],!0,null);return S.colorAttachment.set(w.texture),S.depthAttachment=new Gr(c,S.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=c.createRenderbuffer(c.gl.DEPTH_STENCIL,v[0],v[1]),this._stencilRef=0,S.depthAttachment.set(this._sharedDepthStencil),c.clear({stencil:0})):S.depthAttachment.set(this._sharedDepthStencil),c.extTextureFilterAnisotropic&&f.texParameterf(f.TEXTURE_2D,c.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,c.extTextureFilterAnisotropicMax),{fb:S,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const c in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[c].hasTransition())return!0;return this._style.order.some(c=>{const f=this._style._mergedLayers[c],v=f.isHidden(this.painter.transform.zoom);return f.type==="custom"?!v&&f.shouldRedrape():!v&&f.hasTransition()})}_clearLineLayersFromRenderCache(){let c=!1;for(const v of this._style.getSources())if(v instanceof Ge){c=!0;break}if(!c)return;const f={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],S=this._style.getLayerSourceCache(w);if(S&&!f[S.id]&&!w.isHidden(this.painter.transform.zoom)&&w.type==="line"&&w.widthExpression()instanceof s.am){f[S.id]=!0;for(const M of this.proxyCoords){const k=this.proxyToSource[M.key][S.id];if(k)for(const L of k)this._clearRenderCacheForTile(S.id,L)}}}}_clearRasterLayersFromRenderCache(){let c=!1;for(const v in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[v]._source instanceof qt){c=!0;break}if(!c)return;const f={};for(let v=0;v<this._style.order.length;++v){const w=this._style._mergedLayers[this._style.order[v]],S=this._style.getLayerSourceCache(w);if(!S||f[S.id]||w.isHidden(this.painter.transform.zoom)||w.type!=="raster")continue;const M=w.paint.get("raster-fade-duration");for(const k of this.proxyCoords){const L=this.proxyToSource[k.key][S.id];if(L)for(const F of L){const $=xd(S.getTile(F),S.findLoadedParent(F,0),S,this.painter.transform,M);($.opacity!==1||$.mix!==0)&&this._clearRenderCacheForTile(S.id,F)}}}}_setupDrapedRenderBatches(){const c=this._style.order,f=c.length;if(f===0)return;const v=[];this._pendingGroundEffectLayers=[];let w,S=0,M=this._style._mergedLayers[c[S]];for(;!this._style.isLayerDraped(M)&&M.isHidden(this.painter.transform.zoom)&&++S<f;)M=this._style._mergedLayers[c[S]];for(;S<f;++S){const k=this._style._mergedLayers[c[S]];k.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(k)?w===void 0&&(w=S):(k.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(S),w!==void 0&&(v.push({start:w,end:S-1}),w=void 0)))}if(w!==void 0&&v.push({start:w,end:S-1}),v.length!==0){const k=v[v.length-1];this._pendingGroundEffectLayers.every(L=>L>k.end)||s.X("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=v}_setupRenderCache(c){const f=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,f.renderCache.length>f.renderCachePool.length){const M=Object.values(f.proxyCachedFBO);f.proxyCachedFBO={};for(let k=0;k<M.length;++k){const L=Object.values(M[k]);f.renderCachePool.push(...L)}}return}this._clearRasterLayersFromRenderCache();const v=this.proxyCoords,w=this._tilesDirty;for(let M=v.length-1;M>=0;M--){const k=v[M];if(f.getTileByID(k.key),f.proxyCachedFBO[k.key]!==void 0){const L=c[k.key],F=this.proxyToSource[k.key];let $=0;for(const Z in F){const K=F[Z],ee=L[Z];if(!ee||ee.length!==K.length||K.some((ne,oe)=>ne!==ee[oe]||w[Z]&&w[Z].hasOwnProperty(ne.key))){$=-1;break}++$}for(const Z in f.proxyCachedFBO[k.key])f.renderCache[f.proxyCachedFBO[k.key][Z]].dirty=$<0||$!==Object.values(L).length}}const S=[...this._drapedRenderBatches];S.sort((M,k)=>k.end-k.start-(M.end-M.start));for(const M of S)for(const k of v){if(f.proxyCachedFBO[k.key])continue;let L=f.renderCachePool.pop();L===void 0&&f.renderCache.length<50&&(L=f.renderCache.length,f.renderCache.push(this._createFBO())),L!==void 0&&(f.proxyCachedFBO[k.key]={},f.proxyCachedFBO[k.key][M.start]=L,f.renderCache[L].dirty=!0)}this._tilesDirty={}}_setupStencil(c,f,v,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const S=this.painter.context,M=S.gl;if(f.length<=1)return void(this._overlapStencilType=!1);let k;if(v.isTileClipped())k=f.length,this._overlapStencilMode.test={func:M.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(f[0].overscaledZ>f[f.length-1].overscaledZ))return void(this._overlapStencilType=!1);k=1,this._overlapStencilMode.test={func:M.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+k>255&&(S.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=k,this._overlapStencilMode.ref=this._stencilRef,v.isTileClipped()&&this._renderTileClippingMasks(f,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(c){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[c.key]),this._overlapStencilMode):s.b6.disabled}_renderTileClippingMasks(c,f){const v=this.painter,w=this.painter.context,S=w.gl;v._tileClippingMaskIDs={},w.setColorMode(s.a.disabled),w.setDepthMode(s.b4.disabled);const M=v.getOrCreateProgram("clippingMask");for(const k of c){const L=v._tileClippingMaskIDs[k.key]=--f;M.draw(v,S.TRIANGLES,s.b4.disabled,new s.b6({func:S.ALWAYS,mask:0},L,255,S.KEEP,S.KEEP,S.REPLACE),s.a.disabled,s.b5.disabled,vd(k.projMatrix),"$clipping",v.tileExtentBuffer,v.quadTriangleIndexBuffer,v.tileExtentSegments)}}pointCoordinate(c){const f=this.painter.transform;if(c.x<0||c.x>f.width||c.y<0||c.y>f.height)return null;const v=[c.x,c.y,1,1];s.e.transformMat4(v,v,f.pixelMatrixInverse),s.e.scale(v,v,1/v[3]),v[0]/=f.worldSize,v[1]/=f.worldSize;const w=f._camera.position,S=s.b(1,f.center.lat),M=[w[0],w[1],w[2]/S,0],k=s.v.subtract([],v.slice(0,3),M);s.v.normalize(k,k);const L=this.raycast(M,k,this._exaggeration);return L!==null&&L?(s.v.scaleAndAdd(M,M,k,L),M[3]=M[2],M[2]*=S,M):null}drawDepth(){const c=this.painter,f=c.context,v=this.proxySourceCache,w=Math.ceil(c.width),S=Math.ceil(c.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===S||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const M=f.gl,k=f.createFramebuffer(w,S,!0,"renderbuffer");f.activeTexture.set(M.TEXTURE0);const L=new s.a9(f,{width:w,height:S,data:null},M.RGBA);L.bind(M.NEAREST,M.CLAMP_TO_EDGE),k.colorAttachment.set(L.texture);const F=f.createRenderbuffer(f.gl.DEPTH_COMPONENT16,w,S);k.depthAttachment.set(F),this._depthFBO=k,this._depthTexture=L}f.bindFramebuffer.set(this._depthFBO.framebuffer),f.viewport.set([0,0,w,S]),function(M,k,L,F){if(M.transform.projection.name==="globe")return;const $=M.context,Z=$.gl;$.clear({depth:1});const K=M.getOrCreateProgram("terrainDepth"),ee=new s.b4(Z.LESS,s.b4.ReadWrite,M.depthRangeFor3D);for(const ne of F){const oe=L.getTile(ne),ie=Rp(ne.projMatrix,0,[0,0,0]);k.setupElevationDraw(oe,K),K.draw(M,Z.TRIANGLES,ee,s.b6.disabled,s.a.unblended,s.b5.backCCW,ie,"terrain_depth",k.gridBuffer,k.gridIndexBuffer,k.gridNoSkirtSegments)}}(c,this,v,this.proxyCoords)}_setupProxiedCoordsForOrtho(c,f,v){if(c.getSource()instanceof s.aK)return this._setupProxiedCoordsForImageSource(c,f,v);this._findCoveringTileCache[c.id]=this._findCoveringTileCache[c.id]||{};const w=this.proxiedCoords[c.id]=[],S=this.proxyCoords;for(let L=0;L<S.length;L++){const F=S[L],$=this._findTileCoveringTileID(F,c);if($){const Z=this._createProxiedId(F,$,v[F.key]&&v[F.key][c.id]);w.push(Z),this.proxyToSource[F.key][c.id]=[Z]}}let M=!1;const k=new Set;for(let L=0;L<f.length;L++){const F=c.getTile(f[L]);if(!F||!F.hasData())continue;const $=this._findTileCoveringTileID(F.tileID,this.proxySourceCache);if($&&$.tileID.canonical.z!==F.tileID.canonical.z){const Z=this.proxyToSource[$.tileID.key][c.id],K=this._createProxiedId($.tileID,F,v[$.tileID.key]&&v[$.tileID.key][c.id]);Z?Z.splice(Z.length-1,0,K):this.proxyToSource[$.tileID.key][c.id]=[K];const ee=this.proxyToSource[$.tileID.key][c.id];k.has(ee)||k.add(ee),w.push(K),M=!0}}if(this._sourceTilesOverlap[c.id]=M,M&&this._debugParams.sortTilesHiZFirst)for(const L of k)L.sort((F,$)=>$.overscaledZ-F.overscaledZ)}_setupProxiedCoordsForImageSource(c,f,v){if(!c.getSource().loaded())return;const w=this.proxiedCoords[c.id]=[],S=this.proxyCoords,M=c.getSource(),k=M.tileID;if(!k)return;const L=new s.P(k.x,k.y)._div(1<<k.z),F=M.coordinates.map(s.M.fromLngLat).reduce((Z,K)=>(Z.min.x=Math.min(Z.min.x,K.x-L.x),Z.min.y=Math.min(Z.min.y,K.y-L.y),Z.max.x=Math.max(Z.max.x,K.x-L.x),Z.max.y=Math.max(Z.max.y,K.y-L.y),Z),{min:new s.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new s.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),$=(Z,K)=>{const ee=Z.wrap+Z.canonical.x/(1<<Z.canonical.z),ne=Z.canonical.y/(1<<Z.canonical.z),oe=s.J/(1<<Z.canonical.z),ie=K.wrap+K.canonical.x/(1<<K.canonical.z),re=K.canonical.y/(1<<K.canonical.z);return ee+oe<ie+F.min.x||ee>ie+F.max.x||ne+oe<re+F.min.y||ne>re+F.max.y};for(let Z=0;Z<S.length;Z++){const K=S[Z];for(let ee=0;ee<f.length;ee++){const ne=c.getTile(f[ee]);if(!ne||!ne.hasData()||$(K,ne.tileID))continue;const oe=this._createProxiedId(K,ne,v[K.key]&&v[K.key][c.id]),ie=this.proxyToSource[K.key][c.id];ie?ie.push(oe):this.proxyToSource[K.key][c.id]=[oe],w.push(oe)}}}_createProxiedId(c,f,v){let w=this.orthoMatrix;if(v){const S=v.find(M=>M.key===f.tileID.key);if(S)return S}if(f.tileID.key!==c.key){const S=c.canonical.z-f.tileID.canonical.z;let M,k,L;w=s.m.create();const F=f.tileID.wrap-c.wrap<<c.overscaledZ;S>0?(M=s.J>>S,k=M*((f.tileID.canonical.x<<S)-c.canonical.x+F),L=M*((f.tileID.canonical.y<<S)-c.canonical.y)):(M=s.J<<-S,k=s.J*(f.tileID.canonical.x-(c.canonical.x+F<<-S)),L=s.J*(f.tileID.canonical.y-(c.canonical.y<<-S))),s.m.ortho(w,0,M,0,M,0,1),s.m.translate(w,w,[k,L,0])}return new bd(f.tileID,c.key,w)}_findTileCoveringTileID(c,f){let v=f.getTile(c);if(v&&v.hasData())return v;const w=this._findCoveringTileCache[f.id],S=w[c.key];if(v=S?f.getTileByID(S):null,v&&v.hasData()||S===null)return v;let M=v?v.tileID:c,k=M.overscaledZ;const L=f.getSource().minzoom,F=[];if(!S){const Z=f.getSource().maxzoom;if(c.canonical.z>=Z){const K=c.canonical.z-Z;f.getSource().reparseOverscaled?(k=Math.max(c.canonical.z+2,f.transform.tileZoom),M=new s.O(k,c.wrap,Z,c.canonical.x>>K,c.canonical.y>>K)):K!==0&&(k=Z,M=new s.O(k,c.wrap,Z,c.canonical.x>>K,c.canonical.y>>K))}M.key!==c.key&&(F.push(M.key),v=f.getTile(M))}const $=Z=>{F.forEach(K=>{w[K]=Z}),F.length=0};for(k-=1;k>=L&&(!v||!v.hasData());k--){v&&$(v.tileID.key);const Z=M.calculateScaledKey(k);if(v=f.getTileByID(Z),v&&v.hasData())break;const K=w[Z];if(K===null)break;K===void 0?F.push(Z):v=f.getTileByID(K)}return $(v?v.tileID.key:null),v&&v.hasData()?v:null}findDEMTileFor(c){return this.enabled?this._findTileCoveringTileID(c,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(c,f){let v=this._tilesDirty[c];v||(v=this._tilesDirty[c]={}),v[f.key]=!0}}function Ey(_,c,f){const v=function(k,L,F){const $=s.v.dot(L,k),Z=s.v.dot(F,[.2126,.7152,.0722]),K=(ne,oe,ie)=>(1-ie)*ne+ie*oe,ee=K(1-.3*Math.min(Z,1),1,Math.min($+1,1));return K(.92,1,Math.asin(s.c(L[2],-1,1))/Math.PI+.5)*ee}(_,[0,0,1],c),w=[0,0,0];s.v.scale(w,f.slice(0,3),v);const S=[0,0,0];s.v.scale(S,c.slice(0,3),_[2]);const M=[0,0,0];return s.v.add(M,w,S),s.bw(M)}const wd=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ba=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class Ed{static cacheKey(c,f,v,w){let S=`${f}${w?w.cacheKey:""}`;for(const M of v)c.usedDefines.includes(M)&&(S+=`/${M}`);return S}constructor(c,f,v,w,S,M){const k=c.gl;this.program=k.createProgram(),this.configuration=w,this.name=f,this.fixedDefines=[...M];const L=w?w.getBinderAttributes():[],F=(v.staticAttributes||[]).concat(L);let $=w?w.defines():[];$=$.concat(M.map(ie=>`#define ${ie}`));const Z=`#version 300 es
`;let K=Z+$.concat("precision mediump float;",Gl,by.fragmentSource).join(`
`);for(const ie of v.fragmentIncludes)K+=`
${us[ie]}`;K+=`
${v.fragmentSource}`;let ee=Z+$.concat("precision highp float;",Gl,by.vertexSource).join(`
`);for(const ie of v.vertexIncludes)ee+=`
${us[ie]}`;ee+=`
${v.vertexSource}`;const ne=k.createShader(k.FRAGMENT_SHADER);if(k.isContextLost())return void(this.failedToCreate=!0);k.shaderSource(ne,K),k.compileShader(ne),k.attachShader(this.program,ne);const oe=k.createShader(k.VERTEX_SHADER);if(k.isContextLost())this.failedToCreate=!0;else{k.shaderSource(oe,ee),k.compileShader(oe),k.attachShader(this.program,oe),this.attributes={},this.numAttributes=F.length;for(let ie=0;ie<this.numAttributes;ie++)if(F[ie]){const re=F[ie].startsWith("a_")?F[ie]:`a_${F[ie]}`;k.bindAttribLocation(this.program,ie,re),this.attributes[re]=ie}k.linkProgram(this.program),k.deleteShader(oe),k.deleteShader(ne),this.fixedUniforms=S(c),this.binderUniforms=w?w.getUniforms(c):[],M.includes("TERRAIN")&&(this.terrainUniforms=(ie=>({u_dem:new s.a$(ie),u_dem_prev:new s.a$(ie),u_dem_tl:new s.b0(ie),u_dem_scale:new s.b2(ie),u_dem_tl_prev:new s.b0(ie),u_dem_scale_prev:new s.b2(ie),u_dem_size:new s.b2(ie),u_dem_lerp:new s.b2(ie),u_exaggeration:new s.b2(ie),u_depth:new s.a$(ie),u_depth_size_inv:new s.b0(ie),u_meter_to_dem:new s.b2(ie),u_label_plane_matrix_inv:new s.a_(ie)}))(c)),M.includes("GLOBE")&&(this.globeUniforms=(ie=>({u_tile_tl_up:new s.b7(ie),u_tile_tr_up:new s.b7(ie),u_tile_br_up:new s.b7(ie),u_tile_bl_up:new s.b7(ie),u_tile_up_scale:new s.b2(ie)}))(c)),M.includes("FOG")&&(this.fogUniforms=(ie=>({u_fog_matrix:new s.a_(ie),u_fog_range:new s.b0(ie),u_fog_color:new s.b9(ie),u_fog_horizon_blend:new s.b2(ie),u_fog_vertical_limit:new s.b0(ie),u_fog_temporal_offset:new s.b2(ie),u_frustum_tl:new s.b7(ie),u_frustum_tr:new s.b7(ie),u_frustum_br:new s.b7(ie),u_frustum_bl:new s.b7(ie),u_globe_pos:new s.b7(ie),u_globe_radius:new s.b2(ie),u_globe_transition:new s.b2(ie),u_is_globe:new s.a$(ie),u_viewport:new s.b0(ie)}))(c)),M.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(ie=>({u_cutoff_params:new s.b9(ie)}))(c)),M.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(ie=>({u_lighting_ambient_color:new s.b7(ie),u_lighting_directional_dir:new s.b7(ie),u_lighting_directional_color:new s.b7(ie),u_ground_radiance:new s.b7(ie)}))(c)),M.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(ie=>({u_light_matrix_0:new s.a_(ie),u_light_matrix_1:new s.a_(ie),u_fade_range:new s.b0(ie),u_shadow_normal_offset:new s.b7(ie),u_shadow_intensity:new s.b2(ie),u_shadow_texel_size:new s.b2(ie),u_shadow_map_resolution:new s.b2(ie),u_shadow_direction:new s.b7(ie),u_shadow_bias:new s.b7(ie),u_shadowmap_0:new s.a$(ie),u_shadowmap_1:new s.a$(ie)}))(c))}}setTerrainUniformValues(c,f){if(!this.terrainUniforms)return;const v=this.terrainUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in f)v[w]&&v[w].set(this.program,w,f[w])}}setGlobeUniformValues(c,f){if(!this.globeUniforms)return;const v=this.globeUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in f)v[w]&&v[w].set(this.program,w,f[w])}}setFogUniformValues(c,f){if(!this.fogUniforms)return;const v=this.fogUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in f)v[w].set(this.program,w,f[w])}}setCutoffUniformValues(c,f){if(!this.cutoffUniforms)return;const v=this.cutoffUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in f)v[w].set(this.program,w,f[w])}}setLightsUniformValues(c,f){if(!this.lightsUniforms)return;const v=this.lightsUniforms;if(!this.failedToCreate){c.program.set(this.program);for(const w in f)v[w].set(this.program,w,f[w])}}setShadowUniformValues(c,f){if(this.failedToCreate||!this.shadowUniforms)return;const v=this.shadowUniforms;c.program.set(this.program);for(const w in f)v[w].set(this.program,w,f[w])}_drawDebugWireframe(c,f,v,w,S,M,k,L,F,$){const Z=c.options.wireframe;if(Z.terrain===!1&&Z.layers2D===!1&&Z.layers3D===!1)return;const K=c.context;if(!(!(!Z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!Z.layers2D||c._terrain&&c._terrain.renderingToTexture||!wd.includes(this.name))||!(!Z.layers3D||!Ba.includes(this.name))))return;const ee=K.gl,ne=c.wireframeDebugCache.getLinesFromTrianglesBuffer(c.frameCounter,S,K);if(!ne)return;const oe=[...this.fixedDefines];oe.push("DEBUG_WIREFRAME");const ie=c.getOrCreateProgram(this.name,{config:this.configuration,defines:oe});K.program.set(ie.program);const re=(Ee,ce,fe)=>{if(ce[Ee]&&fe[Ee])for(const Ce in ce[Ee])fe[Ee][Ce]&&fe[Ee][Ce].set(fe.program,Ce,ce[Ee][Ce].current)};F&&F.setUniforms(ie.program,K,ie.binderUniforms,k,{zoom:L}),re("fixedUniforms",this,ie),re("terrainUniforms",this,ie),re("globeUniforms",this,ie),re("fogUniforms",this,ie),re("lightsUniforms",this,ie),re("shadowUniforms",this,ie),ne.bind(),K.setColorMode(new s.a([ee.ONE,ee.ONE_MINUS_SRC_ALPHA,ee.ZERO,ee.ONE],s.C.transparent,[!0,!0,!0,!1])),K.setDepthMode(new s.b4(f.func===ee.LESS?ee.LEQUAL:f.func,s.b4.ReadOnly,f.range)),K.setStencilMode(s.b6.disabled);const de=3*M.primitiveLength*2,be=3*M.primitiveOffset*2*2;$&&$>1?ee.drawElementsInstanced(ee.LINES,de,ee.UNSIGNED_SHORT,be,$):ee.drawElements(ee.LINES,de,ee.UNSIGNED_SHORT,be),S.bind(),K.program.set(this.program),K.setDepthMode(f),K.setStencilMode(v),K.setColorMode(w)}draw(c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne,oe,ie){const re=c.context,de=re.gl;if(this.failedToCreate)return;re.program.set(this.program),re.setDepthMode(v),re.setStencilMode(w),re.setColorMode(S),re.setCullFace(M);for(const ce of Object.keys(this.fixedUniforms))this.fixedUniforms[ce].set(this.program,ce,k[ce]);ne&&ne.setUniforms(this.program,re,this.binderUniforms,K,{zoom:ee});const be={[de.LINES]:2,[de.TRIANGLES]:3,[de.LINE_STRIP]:1}[f],Ee=ie&&ie>0?1:void 0;for(const ce of Z.get()){const fe=ce.vaos||(ce.vaos={});(fe[L]||(fe[L]=new G1)).bind(re,this,F,ne?ne.getPaintVertexBuffers():[],$,ce.vertexOffset,oe||[],Ee),ie&&ie>1?de.drawElementsInstanced(f,ce.primitiveLength*be,de.UNSIGNED_SHORT,ce.primitiveOffset*be*2,ie):de.drawElements(f,ce.primitiveLength*be,de.UNSIGNED_SHORT,ce.primitiveOffset*be*2),f===de.TRIANGLES&&this._drawDebugWireframe(c,v,w,S,$,ce,K,ee,ne,ie)}}}function ul(_,c){const f=Math.pow(2,c.tileID.overscaledZ),v=c.tileSize*Math.pow(2,_.transform.tileZoom)/f,w=v*(c.tileID.canonical.x+c.tileID.wrap*f),S=v*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture?c.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/s.ay(c,1,_.transform.tileZoom),u_pixel_coord_upper:[w>>16,S>>16],u_pixel_coord_lower:[65535&w,65535&S]}}const Sd=s.m.create(),Wl=(_,c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne,oe)=>{const ie=c.style.light,re=ie.properties.get("position"),de=[re.x,re.y,re.z],be=s.bx.create();ie.properties.get("anchor")==="viewport"&&(s.bx.fromRotation(be,-c.transform.angle),s.v.transformMat3(de,de,be));const Ee=ie.properties.get("color"),ce=c.transform,fe={u_matrix:_,u_lightpos:de,u_lightintensity:ie.properties.get("intensity"),u_lightcolor:[Ee.r,Ee.g,Ee.b],u_vertical_gradient:+f,u_opacity:v,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Sd,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:S,u_flood_light_color:Z,u_vertical_scale:K,u_flood_light_intensity:ee,u_ground_shadow_factor:ne,u_emissive_strength:oe};return ce.projection.name==="globe"&&(fe.u_tile_id=[M.canonical.x,M.canonical.y,1<<M.canonical.z],fe.u_zoom_transition=L,fe.u_inv_rot_matrix=$,fe.u_merc_center=F,fe.u_up_dir=ce.projection.upVector(new s.t(0,0,0),F[0]*s.J,F[1]*s.J),fe.u_height_lift=k),fe},jp=(_,c,f)=>({u_matrix:_,u_edge_radius:c,u_vertical_scale:f}),Z1=(_,c,f,v,w,S,M,k,L,F,$,Z,K,ee)=>{const ne=Wl(_,c,f,v,w,S,M,L,F,$,Z,K,ee,1,[0,0,0],0),oe={u_height_factor:-Math.pow(2,M.overscaledZ)/k.tileSize/8};return s.ak(ne,ul(c,k),oe)},$p=(_,c)=>({u_matrix:_,u_emissive_strength:c}),Up=(_,c,f,v)=>s.ak($p(_,c),ul(f,v)),Vp=(_,c,f)=>({u_matrix:_,u_world:f,u_emissive_strength:c}),X1=(_,c,f,v,w)=>s.ak(Up(_,c,f,v),{u_world:w}),Y1=(_,c,f,v)=>{const w=s.J/f.tileSize;return{u_matrix:_,u_camera_to_center_distance:c.getCameraToCenterDistance(v),u_extrude_scale:[c.pixelsToGLUnits[0]/w,c.pixelsToGLUnits[1]/w]}},Sy=(_,c,f=1)=>({u_matrix:_,u_color:c,u_overlay:0,u_overlay_scale:f}),Q1=s.m.create(),Ty=(_,c,f,v,w,S,M)=>{const k=_.transform,L=k.projection.name==="globe",F=L?s.by(k.zoom,c.canonical)*k._pixelsPerMercatorPixel:s.ay(f,1,S),$={u_matrix:c.projMatrix,u_extrude_scale:F,u_intensity:M,u_inv_rot_matrix:Q1,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(L){$.u_inv_rot_matrix=v,$.u_merc_center=w,$.u_tile_id=[c.canonical.x,c.canonical.y,1<<c.canonical.z],$.u_zoom_transition=s.ao(k.zoom);const Z=w[0]*s.J,K=w[1]*s.J;$.u_up_dir=k.projection.upVector(new s.t(0,0,0),Z,K)}return $},Cy=(_,c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne,oe,ie,re,de,be,Ee)=>{return{u_matrix:_,u_normalize_matrix:c,u_globe_matrix:f,u_merc_matrix:v,u_grid_matrix:w,u_tl_parent:S,u_scale_parent:F,u_fade_t:$.mix,u_opacity:$.opacity*Z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:Z.paint.get("raster-brightness-min"),u_brightness_high:Z.paint.get("raster-brightness-max"),u_saturation_factor:(fe=Z.paint.get("raster-saturation"),fe>0?1-1/(1.001-fe):-fe),u_contrast_factor:(ce=Z.paint.get("raster-contrast"),ce>0?1/(1-ce):1+ce),u_spin_weights:Td(Z.paint.get("raster-hue-rotate")),u_perspective_transform:K,u_raster_elevation:ee,u_zoom_transition:M,u_merc_center:k,u_cutoff_params:L,u_colorization_mix:K1(oe,re),u_colorization_offset:My(ie,re),u_color_ramp:ne,u_texture_offset:[be/(de+2*be),de/(de+2*be)],u_texture_res:[de+2*be,de+2*be],u_emissive_strength:Ee};var ce,fe};function Td(_){_*=Math.PI/180;const c=Math.sin(_),f=Math.cos(_);return[(2*f+1)/3,(-Math.sqrt(3)*c-f+1)/3,(Math.sqrt(3)*c-f+1)/3]}function K1([_,c,f,v],[w,S]){if(w===S)return[0,0,0,0];const M=(s.bz+3)/(s.bz+1)/(S-w);return[_*M,c*M,f*M,v*M]}function My(_,[c,f]){return c===f?0:((_-c)/(f-c)*(s.bz+3)-1)/(s.bz+1)}const Cd=s.m.create(),rh=(_,c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne,oe,ie,re)=>{const de=w.transform,be={u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:c?c.uSizeT:0,u_size:c?c.uSize:0,u_camera_to_center_distance:de.getCameraToCenterDistance(oe),u_rotate_symbol:+f,u_aspect_ratio:de.width/de.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:M,u_coord_matrix:k,u_is_text:+L,u_pitch_with_map:+v,u_texsize:F,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Cd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Cd,u_up_vector:[0,-1,0],u_icon_transition:re||0,u_icon_saturation:ie};return oe.name==="globe"&&(be.u_tile_id=[$.canonical.x,$.canonical.y,1<<$.canonical.z],be.u_zoom_transition=Z,be.u_inv_rot_matrix=ee,be.u_merc_center=K,be.u_camera_forward=de._camera.forward(),be.u_ecef_origin=s.bA(de.globeMatrix,$.toUnwrapped()),be.u_tile_matrix=Float32Array.from(de.globeMatrix),be.u_up_vector=ne),be},Md=(_,c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne,oe,ie)=>s.ak(rh(_,c,f,v,w,S,M,k,L,F,Z,K,ee,ne,oe,ie,1),{u_gamma_scale:v?w.transform.getCameraToCenterDistance(ie)*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:s.a4.devicePixelRatio,u_is_halo:+$,undefined:void 0}),nh=(_,c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne,oe)=>s.ak(Md(_,c,f,v,w,S,M,k,!0,L,!0,$,Z,K,ee,ne,oe),{u_texsize_icon:F,u_texture_icon:1}),Gp=(_,c,f,v)=>({u_matrix:_,u_emissive_strength:c,u_opacity:f,u_color:v}),$c=(_,c,f,v,w,S,M)=>s.ak(function(k,L,F,$){const Z=F.imageManager.getPattern(k.toString(),L),{width:K,height:ee}=F.imageManager.getPixelSize(L),ne=Math.pow(2,$.tileID.overscaledZ),oe=$.tileSize*Math.pow(2,F.transform.tileZoom)/ne,ie=oe*($.tileID.canonical.x+$.tileID.wrap*ne),re=oe*$.tileID.canonical.y;return{u_image:0,u_pattern_tl:Z.tl,u_pattern_br:Z.br,u_texsize:[K,ee],u_pattern_size:Z.displaySize,u_tile_units_to_pixels:1/s.ay($,1,F.transform.tileZoom),u_pixel_coord_upper:[ie>>16,re>>16],u_pixel_coord_lower:[65535&ie,65535&re]}}(w,S,v,M),{u_matrix:_,u_emissive_strength:c,u_opacity:f}),oo={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},ih=(_,c,f,v,w,S,M,k,L,F,$,Z,K=[0,0,0])=>{const ee=v.style.light,ne=ee.properties.get("position"),oe=[-ne.x,-ne.y,ne.z],ie=s.bx.create();ee.properties.get("anchor")==="viewport"&&(s.bx.fromRotation(ie,-v.transform.angle),s.v.transformMat3(oe,oe,ie));const re=F.alphaMode==="MASK",de=ee.properties.get("color"),be=Z.paint.get("model-ambient-occlusion-intensity"),Ee=Z.paint.get("model-color").constantOr(s.C.white),ce=Z.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:_,u_lighting_matrix:c,u_normal_matrix:f,u_lightpos:oe,u_lightintensity:ee.properties.get("intensity"),u_lightcolor:[de.r,de.g,de.b],u_camera_pos:K,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+re,u_alphaCutoff:F.alphaCutoff,u_baseColorFactor:[S.r,S.g,S.b,S.a],u_emissiveFactor:[M[0],M[1],M[2],1],u_metallicFactor:k,u_roughnessFactor:L,u_baseColorTexture:oo.BaseColor,u_metallicRoughnessTexture:oo.MetallicRoughness,u_normalTexture:oo.Normal,u_occlusionTexture:oo.Occlusion,u_emissionTexture:oo.Emission,u_color_mix:[Ee.r,Ee.g,Ee.b,ce],u_aoIntensity:be,u_emissive_strength:$}},Hl=new Float32Array(16),Id=(_,c=Hl,f=Hl)=>({u_matrix:_,u_instance:c,u_node_matrix:f}),Iy={fillExtrusion:_=>({u_matrix:new s.a_(_),u_lightpos:new s.b7(_),u_lightintensity:new s.b2(_),u_lightcolor:new s.b7(_),u_vertical_gradient:new s.b2(_),u_opacity:new s.b2(_),u_edge_radius:new s.b2(_),u_ao:new s.b0(_),u_tile_id:new s.b7(_),u_zoom_transition:new s.b2(_),u_inv_rot_matrix:new s.a_(_),u_merc_center:new s.b0(_),u_up_dir:new s.b7(_),u_height_lift:new s.b2(_),u_flood_light_color:new s.b7(_),u_vertical_scale:new s.b2(_),u_flood_light_intensity:new s.b2(_),u_ground_shadow_factor:new s.b7(_),u_emissive_strength:new s.b2(_)}),fillExtrusionDepth:_=>({u_matrix:new s.a_(_),u_edge_radius:new s.b2(_),u_vertical_scale:new s.b2(_)}),fillExtrusionPattern:_=>({u_matrix:new s.a_(_),u_lightpos:new s.b7(_),u_lightintensity:new s.b2(_),u_lightcolor:new s.b7(_),u_vertical_gradient:new s.b2(_),u_height_factor:new s.b2(_),u_edge_radius:new s.b2(_),u_ao:new s.b0(_),u_tile_id:new s.b7(_),u_zoom_transition:new s.b2(_),u_inv_rot_matrix:new s.a_(_),u_merc_center:new s.b0(_),u_up_dir:new s.b7(_),u_height_lift:new s.b2(_),u_image:new s.a$(_),u_texsize:new s.b0(_),u_pixel_coord_upper:new s.b0(_),u_pixel_coord_lower:new s.b0(_),u_tile_units_to_pixels:new s.b2(_),u_opacity:new s.b2(_)}),fillExtrusionGroundEffect:_=>({u_matrix:new s.a_(_),u_opacity:new s.b2(_),u_ao_pass:new s.b2(_),u_meter_to_tile:new s.b2(_),u_ao:new s.b0(_),u_flood_light_intensity:new s.b2(_),u_flood_light_color:new s.b7(_),u_attenuation:new s.b2(_),u_edge_radius:new s.b2(_),u_fb:new s.a$(_),u_fb_size:new s.b2(_)}),fill:_=>({u_matrix:new s.a_(_),u_emissive_strength:new s.b2(_)}),fillPattern:_=>({u_matrix:new s.a_(_),u_emissive_strength:new s.b2(_),u_image:new s.a$(_),u_texsize:new s.b0(_),u_pixel_coord_upper:new s.b0(_),u_pixel_coord_lower:new s.b0(_),u_tile_units_to_pixels:new s.b2(_)}),fillOutline:_=>({u_matrix:new s.a_(_),u_emissive_strength:new s.b2(_),u_world:new s.b0(_)}),fillOutlinePattern:_=>({u_matrix:new s.a_(_),u_emissive_strength:new s.b2(_),u_world:new s.b0(_),u_image:new s.a$(_),u_texsize:new s.b0(_),u_pixel_coord_upper:new s.b0(_),u_pixel_coord_lower:new s.b0(_),u_tile_units_to_pixels:new s.b2(_)}),circle:s.bB,collisionBox:_=>({u_matrix:new s.a_(_),u_camera_to_center_distance:new s.b2(_),u_extrude_scale:new s.b0(_)}),collisionCircle:_=>({u_matrix:new s.a_(_),u_inv_matrix:new s.a_(_),u_camera_to_center_distance:new s.b2(_),u_viewport_size:new s.b0(_)}),debug:_=>({u_color:new s.b1(_),u_matrix:new s.a_(_),u_overlay:new s.a$(_),u_overlay_scale:new s.b2(_)}),clippingMask:_=>({u_matrix:new s.a_(_)}),heatmap:_=>({u_extrude_scale:new s.b2(_),u_intensity:new s.b2(_),u_matrix:new s.a_(_),u_inv_rot_matrix:new s.a_(_),u_merc_center:new s.b0(_),u_tile_id:new s.b7(_),u_zoom_transition:new s.b2(_),u_up_dir:new s.b7(_)}),heatmapTexture:_=>({u_image:new s.a$(_),u_color_ramp:new s.a$(_),u_opacity:new s.b2(_)}),hillshade:_=>({u_matrix:new s.a_(_),u_image:new s.a$(_),u_latrange:new s.b0(_),u_light:new s.b0(_),u_shadow:new s.b1(_),u_highlight:new s.b1(_),u_emissive_strength:new s.b2(_),u_accent:new s.b1(_)}),hillshadePrepare:_=>({u_matrix:new s.a_(_),u_image:new s.a$(_),u_dimension:new s.b0(_),u_zoom:new s.b2(_)}),line:s.bC,linePattern:s.bD,raster:_=>({u_matrix:new s.a_(_),u_normalize_matrix:new s.a_(_),u_globe_matrix:new s.a_(_),u_merc_matrix:new s.a_(_),u_grid_matrix:new s.b8(_),u_tl_parent:new s.b0(_),u_scale_parent:new s.b2(_),u_fade_t:new s.b2(_),u_opacity:new s.b2(_),u_image0:new s.a$(_),u_image1:new s.a$(_),u_brightness_low:new s.b2(_),u_brightness_high:new s.b2(_),u_saturation_factor:new s.b2(_),u_contrast_factor:new s.b2(_),u_spin_weights:new s.b7(_),u_perspective_transform:new s.b0(_),u_raster_elevation:new s.b2(_),u_zoom_transition:new s.b2(_),u_merc_center:new s.b0(_),u_cutoff_params:new s.b9(_),u_colorization_mix:new s.b9(_),u_colorization_offset:new s.b2(_),u_color_ramp:new s.a$(_),u_texture_offset:new s.b0(_),u_texture_res:new s.b0(_),u_emissive_strength:new s.b2(_)}),symbolIcon:_=>({u_is_size_zoom_constant:new s.a$(_),u_is_size_feature_constant:new s.a$(_),u_size_t:new s.b2(_),u_size:new s.b2(_),u_camera_to_center_distance:new s.b2(_),u_rotate_symbol:new s.a$(_),u_aspect_ratio:new s.b2(_),u_fade_change:new s.b2(_),u_matrix:new s.a_(_),u_label_plane_matrix:new s.a_(_),u_coord_matrix:new s.a_(_),u_is_text:new s.a$(_),u_pitch_with_map:new s.a$(_),u_texsize:new s.b0(_),u_tile_id:new s.b7(_),u_zoom_transition:new s.b2(_),u_inv_rot_matrix:new s.a_(_),u_merc_center:new s.b0(_),u_camera_forward:new s.b7(_),u_tile_matrix:new s.a_(_),u_up_vector:new s.b7(_),u_ecef_origin:new s.b7(_),u_texture:new s.a$(_),u_icon_transition:new s.b2(_),u_icon_saturation:new s.b2(_)}),symbolSDF:_=>({u_is_size_zoom_constant:new s.a$(_),u_is_size_feature_constant:new s.a$(_),u_size_t:new s.b2(_),u_size:new s.b2(_),u_camera_to_center_distance:new s.b2(_),u_rotate_symbol:new s.a$(_),u_aspect_ratio:new s.b2(_),u_fade_change:new s.b2(_),u_matrix:new s.a_(_),u_label_plane_matrix:new s.a_(_),u_coord_matrix:new s.a_(_),u_is_text:new s.a$(_),u_pitch_with_map:new s.a$(_),u_texsize:new s.b0(_),u_texture:new s.a$(_),u_gamma_scale:new s.b2(_),u_device_pixel_ratio:new s.b2(_),u_tile_id:new s.b7(_),u_zoom_transition:new s.b2(_),u_inv_rot_matrix:new s.a_(_),u_merc_center:new s.b0(_),u_camera_forward:new s.b7(_),u_tile_matrix:new s.a_(_),u_up_vector:new s.b7(_),u_ecef_origin:new s.b7(_),u_is_halo:new s.a$(_)}),symbolTextAndIcon:_=>({u_is_size_zoom_constant:new s.a$(_),u_is_size_feature_constant:new s.a$(_),u_size_t:new s.b2(_),u_size:new s.b2(_),u_camera_to_center_distance:new s.b2(_),u_rotate_symbol:new s.a$(_),u_aspect_ratio:new s.b2(_),u_fade_change:new s.b2(_),u_matrix:new s.a_(_),u_label_plane_matrix:new s.a_(_),u_coord_matrix:new s.a_(_),u_is_text:new s.a$(_),u_pitch_with_map:new s.a$(_),u_texsize:new s.b0(_),u_texsize_icon:new s.b0(_),u_texture:new s.a$(_),u_texture_icon:new s.a$(_),u_gamma_scale:new s.b2(_),u_device_pixel_ratio:new s.b2(_),u_is_halo:new s.a$(_)}),background:_=>({u_matrix:new s.a_(_),u_emissive_strength:new s.b2(_),u_opacity:new s.b2(_),u_color:new s.b1(_)}),backgroundPattern:_=>({u_matrix:new s.a_(_),u_emissive_strength:new s.b2(_),u_opacity:new s.b2(_),u_image:new s.a$(_),u_pattern_tl:new s.b0(_),u_pattern_br:new s.b0(_),u_texsize:new s.b0(_),u_pattern_size:new s.b0(_),u_pixel_coord_upper:new s.b0(_),u_pixel_coord_lower:new s.b0(_),u_tile_units_to_pixels:new s.b2(_)}),terrainRaster:_d,terrainDepth:_d,skybox:_=>({u_matrix:new s.a_(_),u_sun_direction:new s.b7(_),u_cubemap:new s.a$(_),u_opacity:new s.b2(_),u_temporal_offset:new s.b2(_)}),skyboxGradient:_=>({u_matrix:new s.a_(_),u_color_ramp:new s.a$(_),u_center_direction:new s.b7(_),u_radius:new s.b2(_),u_opacity:new s.b2(_),u_temporal_offset:new s.b2(_)}),skyboxCapture:_=>({u_matrix_3f:new s.b8(_),u_sun_direction:new s.b7(_),u_sun_intensity:new s.b2(_),u_color_tint_r:new s.b9(_),u_color_tint_m:new s.b9(_),u_luminance:new s.b2(_)}),globeRaster:_=>({u_proj_matrix:new s.a_(_),u_globe_matrix:new s.a_(_),u_normalize_matrix:new s.a_(_),u_merc_matrix:new s.a_(_),u_zoom_transition:new s.b2(_),u_merc_center:new s.b0(_),u_image0:new s.a$(_),u_grid_matrix:new s.b8(_),u_skirt_height:new s.b2(_),u_frustum_tl:new s.b7(_),u_frustum_tr:new s.b7(_),u_frustum_br:new s.b7(_),u_frustum_bl:new s.b7(_),u_globe_pos:new s.b7(_),u_globe_radius:new s.b2(_),u_viewport:new s.b0(_)}),globeAtmosphere:_=>({u_frustum_tl:new s.b7(_),u_frustum_tr:new s.b7(_),u_frustum_br:new s.b7(_),u_frustum_bl:new s.b7(_),u_horizon:new s.b2(_),u_transition:new s.b2(_),u_fadeout_range:new s.b2(_),u_color:new s.b9(_),u_high_color:new s.b9(_),u_space_color:new s.b9(_),u_temporal_offset:new s.b2(_),u_horizon_angle:new s.b2(_)}),model:_=>({u_matrix:new s.a_(_),u_lighting_matrix:new s.a_(_),u_normal_matrix:new s.a_(_),u_lightpos:new s.b7(_),u_lightintensity:new s.b2(_),u_lightcolor:new s.b7(_),u_camera_pos:new s.b7(_),u_opacity:new s.b2(_),u_baseColorFactor:new s.b9(_),u_emissiveFactor:new s.b9(_),u_metallicFactor:new s.b2(_),u_roughnessFactor:new s.b2(_),u_baseTextureIsAlpha:new s.a$(_),u_alphaMask:new s.a$(_),u_alphaCutoff:new s.b2(_),u_baseColorTexture:new s.a$(_),u_metallicRoughnessTexture:new s.a$(_),u_normalTexture:new s.a$(_),u_occlusionTexture:new s.a$(_),u_emissionTexture:new s.a$(_),u_color_mix:new s.b9(_),u_aoIntensity:new s.b2(_),u_emissive_strength:new s.b2(_)}),modelDepth:_=>({u_matrix:new s.a_(_),u_instance:new s.a_(_),u_node_matrix:new s.a_(_)}),groundShadow:_=>({u_matrix:new s.a_(_),u_ground_shadow_factor:new s.b7(_)}),stars:_=>({u_matrix:new s.a_(_),u_up:new s.b7(_),u_right:new s.b7(_),u_intensity_multiplier:new s.b2(_)})};let Uc;function qp(_,c,f,v,w,S,M){const k=_.context,L=k.gl,F=_.transform,$=_.getOrCreateProgram("collisionBox"),Z=[];let K=0,ee=0;for(let Ee=0;Ee<v.length;Ee++){const ce=v[Ee],fe=c.getTile(ce),Ce=fe.getBucket(f);if(!Ce)continue;const Oe=Et(ce,Ce,F);let Ae=Oe;w[0]===0&&w[1]===0||(Ae=_.translatePosMatrix(Oe,fe,w,S));const Le=M?Ce.textCollisionBox:Ce.iconCollisionBox,ut=Ce.collisionCircleArray;if(ut.length>0){const He=s.m.create(),Je=Ae;s.m.mul(He,Ce.placementInvProjMatrix,F.glCoordMatrix),s.m.mul(He,He,Ce.placementViewportMatrix),Z.push({circleArray:ut,circleOffset:ee,transform:Je,invTransform:He,projection:Ce.getProjection()}),K+=ut.length/4,ee=K}Le&&(_.terrain&&_.terrain.setupElevationDraw(fe,$),$.draw(_,L.LINES,s.b4.disabled,s.b6.disabled,_.colorModeForRenderPass(),s.b5.disabled,Y1(Ae,F,fe,Ce.getProjection()),f.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,null,F.zoom,null,[Le.collisionVertexBuffer,Le.collisionVertexBufferExt]))}if(!M||!Z.length)return;const ne=_.getOrCreateProgram("collisionCircle"),oe=new s.bE;oe.resize(4*K),oe._trim();let ie=0;for(const Ee of Z)for(let ce=0;ce<Ee.circleArray.length/4;ce++){const fe=4*ce,Ce=Ee.circleArray[fe+0],Oe=Ee.circleArray[fe+1],Ae=Ee.circleArray[fe+2],Le=Ee.circleArray[fe+3];oe.emplace(ie++,Ce,Oe,Ae,Le,0),oe.emplace(ie++,Ce,Oe,Ae,Le,1),oe.emplace(ie++,Ce,Oe,Ae,Le,2),oe.emplace(ie++,Ce,Oe,Ae,Le,3)}(!Uc||Uc.length<2*K)&&(Uc=function(Ee){const ce=2*Ee,fe=new s.bp;fe.resize(ce),fe._trim();for(let Ce=0;Ce<ce;Ce++){const Oe=6*Ce;fe.uint16[Oe+0]=4*Ce+0,fe.uint16[Oe+1]=4*Ce+1,fe.uint16[Oe+2]=4*Ce+2,fe.uint16[Oe+3]=4*Ce+2,fe.uint16[Oe+4]=4*Ce+3,fe.uint16[Oe+5]=4*Ce+0}return fe}(K));const re=k.createIndexBuffer(Uc,!0),de=k.createVertexBuffer(oe,s.bF.members,!0);for(const Ee of Z){const ce={u_matrix:Ee.transform,u_inv_matrix:Ee.invTransform,u_camera_to_center_distance:(be=F).getCameraToCenterDistance(Ee.projection),u_viewport_size:[be.width,be.height]};ne.draw(_,L.TRIANGLES,s.b4.disabled,s.b6.disabled,_.colorModeForRenderPass(),s.b5.disabled,ce,f.id,de,re,s.bm.simpleSegment(0,2*Ee.circleOffset,Ee.circleArray.length,Ee.circleArray.length/2),null,F.zoom)}var be;de.destroy(),re.destroy()}const Ad=s.m.create();function kd({width:_,height:c,anchor:f,textOffset:v,textScale:w},S){const{horizontalAlign:M,verticalAlign:k}=s.aY(f),L=-(M-.5)*_,F=-(k-.5)*c,$=s.aW(f,v);return new s.P((L/w+$[0])*S,(F/w+$[1])*S)}function Wp(_,c,f,v,w,S,M,k,L,F,$){const Z=_.text.placedSymbolArray,K=_.text.dynamicLayoutVertexArray,ee=_.icon.dynamicLayoutVertexArray,ne={},oe=_.getProjection(),ie=zt(k,oe,S),re=S.elevation,de=oe.upVectorScale(k.canonical,S.center.lat,S.worldSize).metersToTile;K.clear();for(let be=0;be<Z.length;be++){const Ee=Z.get(be),{tileAnchorX:ce,tileAnchorY:fe,numGlyphs:Ce}=Ee,Oe=Ee.hidden||!Ee.crossTileID||_.allowVerticalPlacement&&!Ee.placedOrientation?null:v[Ee.crossTileID];if(Oe){let Ae=0,Le=0,ut=0;if(re){const St=re?re.getAtTileOffset(k,ce,fe):0,[pt,Xt,Bt]=oe.upVector(k.canonical,ce,fe);Ae=St*pt*de,Le=St*Xt*de,ut=St*Bt*de}let[He,Je,Be,lt]=qe(Ee.projectedAnchorX+Ae,Ee.projectedAnchorY+Le,Ee.projectedAnchorZ+ut,f?ie:M);const Qe=we(S.getCameraToCenterDistance(oe),lt);let dt=w.evaluateSizeForFeature(_.textSizeData,F,Ee)*Qe/s.aV;f&&(dt*=_.tilePixelRatio/L);const ye=kd(Oe,dt);f?({x:He,y:Je,z:Be}=oe.projectTilePoint(ce+ye.x,fe+ye.y,k.canonical),[He,Je,Be]=qe(He+Ae,Je+Le,Be+ut,M)):(c&&ye._rotate(-S.angle),He+=ye.x,Je+=ye.y,Be=0);const $e=_.allowVerticalPlacement&&Ee.placedOrientation===s.W.vertical?Math.PI/2:0;for(let St=0;St<Ce;St++)s.k(K,He,Je,Be,$e);$&&Ee.associatedIconIndex>=0&&(ne[Ee.associatedIconIndex]={x:He,y:Je,z:Be,angle:$e})}else _t(Ce,K)}if($){ee.clear();const be=_.icon.placedSymbolArray;for(let Ee=0;Ee<be.length;Ee++){const ce=be.get(Ee),{numGlyphs:fe}=ce,Ce=ne[Ee];if(ce.hidden||!Ce)_t(fe,ee);else{const{x:Oe,y:Ae,z:Le,angle:ut}=Ce;for(let He=0;He<fe;He++)s.k(ee,Oe,Ae,Le,ut)}}_.icon.dynamicLayoutVertexBuffer.updateData(ee)}_.text.dynamicLayoutVertexBuffer.updateData(K)}function Hp(_,c,f){return f.iconsInText&&c?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function Fr(_,c,f,v,w,S,M,k,L,F,$,Z,K){const ee=_.context,ne=ee.gl,oe=_.transform,ie=k==="map",re=L==="map",de=ie&&f.layout.get("symbol-placement")!=="point",be=ie&&!re&&!de,Ee=f.layout.get("symbol-sort-key").constantOr(1)!==void 0;let ce=!1;const fe=_.depthModeForSublayer(0,s.b4.ReadOnly),Ce=[s.E(oe.center.lng),s.H(oe.center.lat)],Oe=f.layout.get("text-variable-anchor"),Ae=oe.projection.name==="globe",Le=[],ut=[0,-1,0];let He=ut;!Ae&&!oe.mercatorFromTransition||ie||(He=function(Je){const Be=Je._camera.getWorldToCamera(Je.worldSize,1),lt=s.m.multiply([],Be,Je.globeMatrix);s.m.invert(lt,lt);const Qe=[0,0,0],dt=[0,1,0,0];return s.e.transformMat4(dt,dt,lt),Qe[0]=dt[0],Qe[1]=dt[1],Qe[2]=dt[2],s.v.normalize(Qe,Qe),Qe}(oe));for(const Je of v){const Be=c.getTile(Je),lt=Be.getBucket(f);if(!lt||lt.projection.name==="mercator"&&Ae)continue;const Qe=w?lt.text:lt.icon;if(!Qe||lt.fullyClipped||!Qe.segments.get().length)continue;const dt=Qe.programConfigurations.get(f.id),ye=w||lt.sdfIcons,$e=w?lt.textSizeData:lt.iconSizeData,St=re||oe.pitch!==0,pt=s.i($e,oe.zoom);let Xt,Bt,nr,Wt,cr=[0,0],ur=null;if(w)Bt=Be.glyphAtlasTexture?Be.glyphAtlasTexture:null,nr=ne.LINEAR,Xt=Be.glyphAtlasTexture?Be.glyphAtlasTexture.size:[0,0],lt.iconsInText&&(cr=Be.imageAtlasTexture?Be.imageAtlasTexture.size:[0,0],ur=Be.imageAtlasTexture?Be.imageAtlasTexture:null,Wt=St||_.options.rotating||_.options.zooming||$e.kind==="composite"||$e.kind==="camera"?ne.LINEAR:ne.NEAREST);else{const vn=f.layout.get("icon-size").constantOr(0)!==1||lt.iconsNeedLinear;Bt=Be.imageAtlasTexture?Be.imageAtlasTexture:null,nr=ye||_.options.rotating||_.options.zooming||vn||St?ne.LINEAR:ne.NEAREST,Xt=Be.imageAtlasTexture?Be.imageAtlasTexture.size:[0,0]}const er=lt.projection.name==="globe",tr=er?He:ut,Yr=er?s.ao(oe.zoom):0,Cr=zt(Je,lt.getProjection(),oe),kn=oe.calculatePixelsToTileUnitsMatrix(Be),gn=ii(Cr,Be.tileID.canonical,re,ie,oe,lt.getProjection(),kn),Lo=_.terrain&&re&&de?s.m.invert(s.m.create(),gn):Ad,As=Go(Cr,Be.tileID.canonical,re,ie,oe,lt.getProjection(),kn),un=Oe&&lt.hasTextData(),Jr=lt.hasIconTextFit()&&un&&lt.hasIconData();if(de){const vn=oe.elevation,Zs=vn?vn.getAtTileOffsetFunc(Je,oe.center.lat,oe.worldSize,lt.getProjection()):null,ga=no(Cr,Be.tileID.canonical,re,ie,oe,lt.getProjection(),kn);Ue(lt,Cr,_,w,ga,As,re,F,Zs,Je)}const rn=de||w&&Oe||Jr,Vn=_.translatePosMatrix(Cr,Be,S,M),Qi=rn?Ad:gn,Rn=_.translatePosMatrix(As,Be,S,M,!0),uo=lt.getProjection().createInversionMatrix(oe,Je.canonical),zo=f.paint.get("icon-image-cross-fade").constantOr(0),ho=[];_.terrainRenderModeElevated()&&re&&ho.push("PITCH_WITH_MAP_TERRAIN"),er&&(ho.push("PROJECTION_GLOBE_VIEW"),rn&&ho.push("PROJECTED_POS_ON_VIEWPORT")),zo>0&&ho.push("ICON_TRANSITION"),Qe.zOffsetVertexBuffer&&ho.push("Z_OFFSET");const ks=ye&&f.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let ja;ye?ja=lt.iconsInText?nh($e.kind,pt,be,re,_,Vn,Qi,Rn,Xt,cr,Je,Yr,Ce,uo,tr,lt.getProjection()):Md($e.kind,pt,be,re,_,Vn,Qi,Rn,w,Xt,!0,Je,Yr,Ce,uo,tr,lt.getProjection()):($<1&&ho.push("SATURATION"),ja=rh($e.kind,pt,be,re,_,Vn,Qi,Rn,w,Xt,Je,Yr,Ce,uo,tr,lt.getProjection(),$,zo));const Hs={program:_.getOrCreateProgram(Hp(ye,w,lt),{config:dt,defines:ho}),buffers:Qe,uniformValues:ja,atlasTexture:Bt,atlasTextureIcon:ur,atlasInterpolation:nr,atlasInterpolationIcon:Wt,isSDF:ye,hasHalo:ks,tile:Be,labelPlaneMatrixInv:Lo};if(Ee&&lt.canOverlap){ce=!0;const vn=Qe.segments.get();for(const Zs of vn)Le.push({segments:new s.bm([Zs]),sortKey:Zs.sortKey,state:Hs})}else Le.push({segments:Qe.segments,sortKey:0,state:Hs})}ce&&Le.sort((Je,Be)=>Je.sortKey-Be.sortKey);for(const Je of Le){const Be=Je.state;if(_.terrain&&_.terrain.setupElevationDraw(Be.tile,Be.program,{useDepthForOcclusion:oe.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:Be.labelPlaneMatrixInv}),ee.activeTexture.set(ne.TEXTURE0),Be.atlasTexture&&Be.atlasTexture.bind(Be.atlasInterpolation,ne.CLAMP_TO_EDGE,!0),Be.atlasTextureIcon&&(ee.activeTexture.set(ne.TEXTURE1),Be.atlasTextureIcon&&Be.atlasTextureIcon.bind(Be.atlasInterpolationIcon,ne.CLAMP_TO_EDGE,!0)),_.uploadCommonLightUniforms(_.context,Be.program),Be.hasHalo){const lt=Be.uniformValues;lt.u_is_halo=1,Pd(Be.buffers,Je.segments,f,_,Be.program,fe,Z,K,lt,2),lt.u_is_halo=0}else{if(Be.isSDF){const lt=Be.uniformValues;Be.hasHalo&&(lt.u_is_halo=1,Pd(Be.buffers,Je.segments,f,_,Be.program,fe,Z,K,lt,1)),lt.u_is_halo=0}Pd(Be.buffers,Je.segments,f,_,Be.program,fe,Z,K,Be.uniformValues,1)}}}function Pd(_,c,f,v,w,S,M,k,L,F){const $=[_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer,_.iconTransitioningVertexBuffer,_.globeExtVertexBuffer,_.zOffsetVertexBuffer];w.draw(v,v.context.gl.TRIANGLES,S,M,k,s.b5.disabled,L,f.id,_.layoutVertexBuffer,_.indexBuffer,c,f.paint,v.transform.zoom,_.programConfigurations.get(f.id),$,F)}function oh(_,c,f,v,w,S,M){const k=_.context.gl,L=f.paint.get("fill-pattern"),F=L&&L.constantOr(1);let $,Z,K,ee,ne;M?(Z=F&&!f.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",$=k.LINES):(Z=F?"fillPattern":"fill",$=k.TRIANGLES);for(const oe of v){const ie=c.getTile(oe);if(F&&!ie.patternsLoaded())continue;const re=ie.getBucket(f);if(!re)continue;_.prepareDrawTile();const de=re.programConfigurations.get(f.id),be=_.isTileAffectedByFog(oe),Ee=_.getOrCreateProgram(Z,{config:de,overrideFog:be});F&&(_.context.activeTexture.set(k.TEXTURE0),ie.imageAtlasTexture&&ie.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),de.updatePaintBuffers());const ce=L.constantOr(null);if(ce&&ie.imageAtlas){const Oe=ie.imageAtlas.patternPositions[ce.toString()];Oe&&de.setConstantPatternPositions(Oe)}const fe=_.translatePosMatrix(oe.projMatrix,ie,f.paint.get("fill-translate"),f.paint.get("fill-translate-anchor")),Ce=f.paint.get("fill-emissive-strength");if(M){ee=re.indexBuffer2,ne=re.segments2;const Oe=_.terrain&&_.terrain.renderingToTexture?_.terrain.drapeBufferSize:[k.drawingBufferWidth,k.drawingBufferHeight];K=Z==="fillOutlinePattern"&&F?X1(fe,Ce,_,ie,Oe):Vp(fe,Ce,Oe)}else ee=re.indexBuffer,ne=re.segments,K=F?Up(fe,Ce,_,ie):$p(fe,Ce);_.uploadCommonUniforms(_.context,Ee,oe.toUnwrapped()),Ee.draw(_,$,w,_.stencilModeForClipping(oe),S,s.b5.disabled,K,f.id,re.layoutVertexBuffer,ee,ne,f.paint,_.transform.zoom,de,void 0)}}function sh(_,c,f,v,w,S,M,k){f.resetLayerRenderingStats();const L=_.context,F=L.gl,$=_.transform,Z=f.paint.get("fill-extrusion-pattern"),K=Z.constantOr(1),ee=f.paint.get("fill-extrusion-opacity"),ne=_.style.enable3dLights(),oe=f.paint.get(ne&&!K?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ie=[f.paint.get("fill-extrusion-ambient-occlusion-intensity"),oe],re=f.layout.get("fill-extrusion-edge-radius"),de=re>0&&!f.paint.get("fill-extrusion-rounded-roof"),be=de?0:re,Ee=$.projection.name==="globe"?s.bO():0,ce=$.projection.name==="globe",fe=ce?s.ao($.zoom):0,Ce=[s.E($.center.lng),s.H($.center.lat)],Oe=f.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),Ae=f.paint.get("fill-extrusion-flood-light-intensity"),Le=f.paint.get("fill-extrusion-vertical-scale"),ut=ql(_,f.paint.get("fill-extrusion-cutoff-fade-range")),He=f.paint.get("fill-extrusion-emissive-strength"),Je=[];let Be;ce&&Je.push("PROJECTION_GLOBE_VIEW"),ie[0]>0&&Je.push("FAUX_AO"),de&&Je.push("ZERO_ROOF_RADIUS"),k&&Je.push("HAS_CENTROID"),Ae>0&&Je.push("FLOOD_LIGHT"),ut.shouldRenderCutoff&&Je.push("RENDER_CUTOFF");const lt=_.renderPass==="shadow",Qe=_.shadowRenderer,dt=lt&&!!Qe;_.shadowRenderer&&(_.shadowRenderer.useNormalOffset=!0);let ye=[0,0,0];if(Qe){const pt=_.style.directionalLight,Xt=_.style.ambientLight;pt&&Xt&&(ye=Rd(pt,Xt)),Be=Je.concat(["SHADOWS_SINGLE_CASCADE"])}const $e=dt?"fillExtrusionDepth":K?"fillExtrusionPattern":"fillExtrusion",St=f.getLayerRenderingStats();for(const pt of v){const Xt=c.getTile(pt),Bt=Xt.getBucket(f);if(!Bt||Bt.projection.name!==$.projection.name)continue;let nr=!1;Qe&&(nr=Qe.getMaxCascadeForTile(pt.toUnwrapped())===0);const Wt=_.isTileAffectedByFog(pt),cr=Bt.programConfigurations.get(f.id),ur=_.getOrCreateProgram($e,{config:cr,defines:nr?Be:Je,overrideFog:Wt});if(_.terrain&&_.terrain.setupElevationDraw(Xt,ur,{useMeterToDem:!0}),!Bt.centroidVertexBuffer){const gn=ur.attributes.a_centroid_pos;gn!==void 0&&F.vertexAttrib2f(gn,0,0)}!lt&&Qe&&Qe.setupShadows(Xt.tileID.toUnwrapped(),ur,"vector-tile",Xt.tileID.overscaledZ),K&&(_.context.activeTexture.set(F.TEXTURE0),Xt.imageAtlasTexture&&Xt.imageAtlasTexture.bind(F.LINEAR,F.CLAMP_TO_EDGE),cr.updatePaintBuffers());const er=Z.constantOr(null);if(er&&Xt.imageAtlas){const gn=Xt.imageAtlas.patternPositions[er.toString()];gn&&cr.setConstantPatternPositions(gn)}const tr=f.paint.get("fill-extrusion-vertical-gradient");let Yr;if(lt&&Qe){if(eb(Xt.tileID,Bt,_))continue;const gn=Qe.calculateShadowPassMatrixFromTile(Xt.tileID.toUnwrapped());Yr=jp(gn,be,Le)}else{const gn=_.translatePosMatrix(pt.expandedProjMatrix,Xt,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),Lo=$.projection.createInversionMatrix($,pt.canonical);Yr=K?Z1(gn,_,tr,ee,ie,be,pt,Xt,Ee,fe,Ce,Lo,Oe,Le):Wl(gn,_,tr,ee,ie,be,pt,Ee,fe,Ce,Lo,Oe,Le,Ae,ye,He)}_.uploadCommonUniforms(L,ur,pt.toUnwrapped(),null,ut);let Cr=Bt.segments;if($.projection.name==="mercator"&&!lt&&(Cr=Bt.getVisibleSegments(Xt.tileID,_.terrain,_.transform.getFrustum(0)),!Cr.get().length))continue;if(St)if(lt)for(const gn of Cr.get())St.numRenderedVerticesInShadowPass+=gn.primitiveLength;else for(const gn of Cr.get())St.numRenderedVerticesInTransparentPass+=gn.primitiveLength;const kn=[];(_.terrain||k)&&kn.push(Bt.centroidVertexBuffer),ce&&kn.push(Bt.layoutVertexExtBuffer),ur.draw(_,L.gl.TRIANGLES,w,S,M,s.b5.backCCW,Yr,f.id,Bt.layoutVertexBuffer,Bt.indexBuffer,Cr,f.paint,_.transform.zoom,cr,kn)}_.shadowRenderer&&(_.shadowRenderer.useNormalOffset=!1)}function Zl(_,c,f,v,w,S,M,k,L,F,$,Z,K,ee,ne,oe,ie,re,de){const be=_.context,Ee=be.gl,ce=_.transform,fe=_.transform.zoom,Ce=[],Oe=ql(_,f.paint.get("fill-extrusion-cutoff-fade-range"));F==="clear"?(Ce.push("CLEAR_SUBPASS"),de&&(Ce.push("CLEAR_FROM_TEXTURE"),be.activeTexture.set(Ee.TEXTURE0),de.bind(Ee.LINEAR,Ee.CLAMP_TO_EDGE))):F==="sdf"&&Ce.push("SDF_SUBPASS"),ie&&Ce.push("HAS_CENTROID"),Oe.shouldRenderCutoff&&Ce.push("RENDER_CUTOFF");const Ae=f.layout.get("fill-extrusion-edge-radius"),Le=(ut,He,Je,Be,lt)=>{const Qe=He.programConfigurations.get(f.id),dt=_.isTileAffectedByFog(ut),ye=_.getOrCreateProgram("fillExtrusionGroundEffect",{config:Qe,defines:Ce,overrideFog:dt}),$e=((pt,Xt,Bt,nr,Wt,cr,ur,er,tr,Yr,Cr)=>({u_matrix:Xt,u_opacity:Bt,u_ao_pass:nr?1:0,u_meter_to_tile:Wt,u_ao:cr,u_flood_light_intensity:ur,u_flood_light_color:er,u_attenuation:tr,u_edge_radius:Yr,u_fb:0,u_fb_size:Cr}))(0,Be,$,L,lt,[Z,K*lt],ee,ne,oe,fe>=17?0:Ae*lt,de?de.size[0]:0),St=[];ie&&St.push(He.hiddenByLandmarkVertexBuffer),_.uploadCommonUniforms(be,ye,ut.toUnwrapped(),null,Oe),ye.draw(_,be.gl.TRIANGLES,w,S,M,k,$e,f.id,He.vertexBuffer,He.indexBuffer,Je,f.paint,fe,Qe,St)};for(const ut of v){const He=c.getTile(ut),Je=He.getBucket(f);if(!Je||Je.projection.name!==ce.projection.name||!Je.groundEffect||Je.groundEffect&&!Je.groundEffect.hasData())continue;const Be=Je.groundEffect,lt=1/Je.tileToMeter;{const Qe=_.translatePosMatrix(ut.projMatrix,He,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),dt=Be.getDefaultSegment();Le(ut,Be,dt,Qe,lt)}if(re)for(let Qe=0;Qe<4;Qe++){const dt=s.bP[Qe](ut),ye=c.getTile(dt);if(!ye)continue;const $e=ye.getBucket(f);if(!$e||$e.projection.name!==ce.projection.name||!$e.groundEffect||$e.groundEffect&&!$e.groundEffect.hasData())continue;const St=$e.groundEffect;let pt,Xt;Qe===0?(pt=[-s.J,0,0],Xt=1):Qe===1?(pt=[s.J,0,0],Xt=0):Qe===2?(pt=[0,-s.J,0],Xt=3):(pt=[0,s.J,0],Xt=2);const Bt=St.regionSegments[Xt];if(!Bt)continue;const nr=new Float32Array(16);s.m.translate(nr,ut.projMatrix,pt),Le(ut,St,Bt,_.translatePosMatrix(nr,He,f.paint.get("fill-extrusion-translate"),f.paint.get("fill-extrusion-translate-anchor")),lt)}}}function Ay(_,c,f,v,w,S,M){v.centroidVertexArray.length===0&&v.createCentroidsBuffer();const k=S?S.findDEMTileFor(f):null;if(!(k&&k.dem||M))return;const L=re=>new s.P(Math.ceil((re+s.bS)*s.bT),0),F=re=>{const de=c.getSource().minzoom,be=ce=>{const fe=c.getTileByID(ce);if(fe&&fe.hasData())return fe.getBucket(w)},Ee=[0,-1,1];for(const ce of Ee){if(re.overscaledZ+ce<de)continue;const fe=be(re.calculateScaledKey(re.overscaledZ+ce));if(fe)return fe}},$=[0,0,0],Z=(re,de)=>($[0]=Math.min(re.min.y,de.min.y),$[1]=Math.max(re.max.y,de.max.y),$[2]=s.J-de.min.x>re.max.x?de.min.x-s.J:re.max.x,$),K=(re,de)=>($[0]=Math.min(re.min.x,de.min.x),$[1]=Math.max(re.max.x,de.max.x),$[2]=s.J-de.min.y>re.max.y?de.min.y-s.J:re.max.y,$),ee=[(re,de)=>Z(re,de),(re,de)=>Z(de,re),(re,de)=>K(re,de),(re,de)=>K(de,re)],ne=(re,de,be,Ee,ce,fe,Ce)=>{if(!S)return 0;const Oe=[[fe?be:re,fe?re:be,0],[fe?be:de,fe?de:be,0]],Ae=Ce<0?s.J+Ce:Ce,Le=[fe?Ae:(re+de)/2,fe?(re+de)/2:Ae,0];return be===0&&Ce<0||be!==0&&Ce>0?S.getForTilePoints(ce,[Le],!0,Ee):Oe.push(Le),S.getForTilePoints(f,Oe,!0,k),Math.max(Oe[0][2],Oe[1][2],Le[2])/S.exaggeration()};for(let re=0;re<4;re++){const de=v.borderFeatureIndices[re];if(de.length===0)continue;const be=s.bP[re](f),Ee=F(be);if(!(Ee&&Ee instanceof s.bQ)||v.borderDoneWithNeighborZ[re]===Ee.canonical.z)continue;Ee.centroidVertexArray.length===0&&Ee.createCentroidsBuffer();const ce=S?S.findDEMTileFor(be):null;if(!(ce&&ce.dem||M))continue;const fe=(re<2?1:5)-re,Ce=Ee.borderDoneWithNeighborZ[fe]!==v.canonical.z,Oe=Ee.borderFeatureIndices[fe];let Ae=0;if(v.canonical.z!==Ee.canonical.z){for(const Le of de)v.showCentroid(v.featuresOnBorder[Le]);if(Ce)for(const Le of Oe)Ee.showCentroid(Ee.featuresOnBorder[Le]);v.borderDoneWithNeighborZ[re]=Ee.canonical.z,Ee.borderDoneWithNeighborZ[fe]=v.canonical.z}for(const Le of de){const ut=v.featuresOnBorder[Le],He=v.centroidData[ut.centroidDataIndex],Je=ut.borders[re];let Be;for(;Ae<Oe.length;){Be=Ee.featuresOnBorder[Oe[Ae]];const lt=Be.borders[fe];if(lt[1]>Je[0]+3||lt[0]>Je[0]-3)break;Ee.showCentroid(Be),Ae++}if(Be&&Ae<Oe.length){const lt=Ae;let Qe=0;for(;!(Be.borders[fe][0]>Je[1]-3)&&(Qe++,++Ae!==Oe.length);)Be=Ee.featuresOnBorder[Oe[Ae]];if(Be=Ee.featuresOnBorder[Oe[lt]],Qe>1){const $e=Be.borders[fe];Math.abs(Je[0]-$e[0])<3&&Math.abs(Je[1]-$e[1])<3&&(Qe=1,Ae=lt+1)}else if(Qe===0){v.showCentroid(ut);continue}const dt=Ee.centroidData[Be.centroidDataIndex];M&&Qe===1&&(((oe=He).flags|(ie=dt).flags)&s.bR?(oe.flags|=s.bR,ie.flags|=s.bR):(oe.flags&=~s.bR,ie.flags&=~s.bR));const ye=ut.intersectsCount()>1||Be.intersectsCount()>1;if(Qe>1)Ae=lt,He.centroidXY=dt.centroidXY=new s.P(0,0);else if(ce&&ce.dem&&!ye){const $e=ee[re](He,dt),St=re%2?s.J-1:0,pt=ne($e[0],Math.min(s.J-1,$e[1]),St,ce,be,re<2,$e[2]);He.centroidXY=dt.centroidXY=L(pt)}else ye?He.centroidXY=dt.centroidXY=new s.P(0,0):(He.centroidXY=v.encodeBorderCentroid(ut),dt.centroidXY=Ee.encodeBorderCentroid(Be));v.writeCentroidToBuffer(He),Ee.writeCentroidToBuffer(dt)}else v.showCentroid(ut)}v.borderDoneWithNeighborZ[re]=Ee.canonical.z,Ee.borderDoneWithNeighborZ[fe]=v.canonical.z}var oe,ie;(v.needsCentroidUpdate||!v.centroidVertexBuffer&&v.centroidVertexArray.length!==0)&&v.uploadCentroid(_)}const Vc=[1,0,0],ky=[0,1,0],J1=[0,0,1];function eb(_,c,f){const v=f.transform,w=f.shadowRenderer;if(!w)return!0;const S=_.toUnwrapped(),M=v.tileSize*w._cascades[f.currentShadowCascade].scale;let k=c.maxHeight;if(v.elevation){const oe=v.elevation.getMinMaxForTile(_);oe&&(k+=oe.max)}const L=[...w.shadowDirection];L[2]=-L[2];const F=w.computeSimplifiedTileShadowVolume(S,k,M,L);if(!F)return!1;const $=[Vc,ky,J1,L,[L[0],0,L[2]],[0,L[1],L[2]]],Z=v.projection.name==="globe",K=v.scaleZoom(M),ee=s.F.fromInvProjectionMatrix(v.invProjMatrix,v.worldSize,K,!Z),ne=w.getCurrentCascadeFrustum();return ee.intersectsPrecise(F.vertices,F.planes,$)===0||ne.intersectsPrecise(F.vertices,F.planes,$)===0}function tb(_){const c=_._nearZ,f=_.projection.farthestPixelDistance(_),v=f-c,w=.2*_.height,S=c+w;return[c,f,(S-w-c)/v,(S-c)/v]}const Zp=new s.C(1,0,0,1),Xp=new s.C(0,1,0,1),Yp=new s.C(0,0,1,1),Qp=new s.C(1,0,1,1),Py=new s.C(0,1,1,1);function Xl(_,c,f,v,w,S){const M=_.context,k=_.transform,L=M.gl,F=k.projection.name==="globe",$=F?["PROJECTION_GLOBE_VIEW"]:[];let Z=s.m.clone(f.projMatrix);if(F&&s.ao(k.zoom)>0){const Be=s.bU(f.canonical,k),lt=s.bV(Be);Z=s.m.multiply(new Float32Array(16),k.globeMatrix,lt),s.m.multiply(Z,k.projMatrix,Z)}const K=s.m.create();K[12]+=2*w/(s.a4.devicePixelRatio*k.width),K[13]+=2*S/(s.a4.devicePixelRatio*k.height),s.m.multiply(Z,K,Z);const ee=_.getOrCreateProgram("debug",{defines:$}),ne=c.getTileByID(f.key);_.terrain&&_.terrain.setupElevationDraw(ne,ee);const oe=s.b4.disabled,ie=s.b6.disabled,re=_.colorModeForRenderPass(),de="$debug";M.activeTexture.set(L.TEXTURE0),_.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),F?ne._makeGlobeTileDebugBuffers(_.context,k):ne._makeDebugTileBoundsBuffers(_.context,k.projection);const be=ne._tileDebugBuffer||_.debugBuffer,Ee=ne._tileDebugIndexBuffer||_.debugIndexBuffer,ce=ne._tileDebugSegments||_.debugSegments;ee.draw(_,L.LINE_STRIP,oe,ie,re,s.b5.disabled,Sy(Z,v),de,be,Ee,ce,null,null,null,[ne._globeTileDebugBorderBuffer]);const fe=ne.latestRawTileData,Ce=Math.floor((fe&&fe.byteLength||0)/1024),Oe=c.getTile(f).tileSize,Ae=512/Math.min(Oe,512)*(f.overscaledZ/k.zoom)*.5;let Le=f.canonical.toString();f.overscaledZ!==f.canonical.z&&(Le+=` => ${f.overscaledZ}`),Le+=` ${Ce}kb`,function(Be,lt){Be.initDebugOverlayCanvas();const Qe=Be.debugOverlayCanvas,dt=Be.context.gl,ye=Be.debugOverlayCanvas.getContext("2d");ye.clearRect(0,0,Qe.width,Qe.height),ye.shadowColor="white",ye.shadowBlur=2,ye.lineWidth=1.5,ye.strokeStyle="white",ye.textBaseline="top",ye.font="bold 36px Open Sans, sans-serif",ye.fillText(lt,5,5),ye.strokeText(lt,5,5),Be.debugOverlayTexture.update(Qe),Be.debugOverlayTexture.bind(dt.LINEAR,dt.CLAMP_TO_EDGE)}(_,Le);const ut=ne._tileDebugTextBuffer||_.debugBuffer,He=ne._tileDebugTextIndexBuffer||_.quadTriangleIndexBuffer,Je=ne._tileDebugTextSegments||_.debugSegments;ee.draw(_,L.TRIANGLES,oe,ie,s.a.alphaBlended,s.b5.disabled,Sy(Z,s.C.transparent,Ae),de,ut,He,Je,null,null,null,[ne._globeTileDebugTextBuffer])}function Oy(_,c,f,v){hl(_,0,c+f/2,_.transform.width,f,v)}function Gc(_,c,f,v){hl(_,c-f/2,0,f,_.transform.height,v)}function hl(_,c,f,v,w,S){const M=_.context,k=M.gl;k.enable(k.SCISSOR_TEST),k.scissor(c*s.a4.devicePixelRatio,f*s.a4.devicePixelRatio,v*s.a4.devicePixelRatio,w*s.a4.devicePixelRatio),M.clear({color:S}),k.disable(k.SCISSOR_TEST)}const Dy=s.bW([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Od}=Dy;function pa(_,c,f,v){_.emplaceBack(c,f,v)}class qs{constructor(c){this.vertexArray=new s.bX,this.indices=new s.bp,pa(this.vertexArray,-1,-1,1),pa(this.vertexArray,1,-1,1),pa(this.vertexArray,-1,1,1),pa(this.vertexArray,1,1,1),pa(this.vertexArray,-1,-1,-1),pa(this.vertexArray,1,-1,-1),pa(this.vertexArray,-1,1,-1),pa(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=c.createVertexBuffer(this.vertexArray,Od),this.indexBuffer=c.createIndexBuffer(this.indices),this.segment=s.bm.simpleSegment(0,0,36,12)}}function dl(_,c,f,v,w,S){const M=_.context.gl,k=c.paint.get("sky-atmosphere-color"),L=c.paint.get("sky-atmosphere-halo-color"),F=c.paint.get("sky-atmosphere-sun-intensity"),$=((Z,K,ee,ne,oe)=>({u_matrix_3f:Z,u_sun_direction:K,u_sun_intensity:ee,u_color_tint_r:[ne.r,ne.g,ne.b,ne.a],u_color_tint_m:[oe.r,oe.g,oe.b,oe.a],u_luminance:5e-5}))(s.bx.fromMat4(s.bx.create(),v),w,F,k,L);M.framebufferTexture2D(M.FRAMEBUFFER,M.COLOR_ATTACHMENT0,M.TEXTURE_CUBE_MAP_POSITIVE_X+S,c.skyboxTexture,0),f.draw(_,M.TRIANGLES,s.b4.disabled,s.b6.disabled,s.a.unblended,s.b5.frontCW,$,"skyboxCapture",c.skyboxGeometry.vertexBuffer,c.skyboxGeometry.indexBuffer,c.skyboxGeometry.segment)}const Ry=s.bW([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Kp{constructor(c){const f=new s.bY;f.emplaceBack(-1,1,1,0,0),f.emplaceBack(1,1,1,1,0),f.emplaceBack(1,-1,1,1,1),f.emplaceBack(-1,-1,1,0,1);const v=new s.bp;v.emplaceBack(0,1,2),v.emplaceBack(2,3,0),this.vertexBuffer=c.createVertexBuffer(f,Ry.members),this.indexBuffer=c.createIndexBuffer(v),this.segments=s.bm.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ly=s.bW([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Jp{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15}}class rb{constructor(c){this.colorModeAlphaBlendedWriteRGB=new s.a([s.bZ,s.b_,s.bZ,s.b_],s.C.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new s.a([s.bZ,s.b$,s.bZ,s.b$],s.C.transparent,[!1,!1,!1,!0]),this.params=new Jp,this.allocatedStarsCount=0,c.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1}),c.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01})}update(c){const f=c.context;if(!this.atmosphereBuffer||this.allocatedStarsCount!==this.params.starsCount){this.atmosphereBuffer=new Kp(f),this.allocatedStarsCount=this.params.starsCount;const v=100,w=200,S=function($){const Z=s.c2(30),K=[];for(let ee=0;ee<$;++ee){const ne=2*Math.PI*Z(),oe=Math.acos(1-2*Z())-.5*Math.PI;K.push(s.v.fromValues(Math.cos(oe)*Math.cos(ne),Math.cos(oe)*Math.sin(ne),Math.sin(oe)))}return K}(this.allocatedStarsCount),M=s.c2(300),k=new s.c0,L=new s.bp;let F=0;for(let $=0;$<S.length;++$){const Z=s.v.scale([],S[$],200),K=Math.max(0,1+.01*v*(1*M()-.5)),ee=Math.max(0,1+.01*w*(1*M()-.5));k.emplaceBack(Z[0],Z[1],Z[2],-1,-1,K,ee),k.emplaceBack(Z[0],Z[1],Z[2],1,-1,K,ee),k.emplaceBack(Z[0],Z[1],Z[2],1,1,K,ee),k.emplaceBack(Z[0],Z[1],Z[2],-1,1,K,ee),L.emplaceBack(F+0,F+1,F+2),L.emplaceBack(F+0,F+2,F+3),F+=4}this.starsVx=f.createVertexBuffer(k,Ly.members),this.starsIdx=f.createIndexBuffer(L),this.starsSegments=s.bm.simpleSegment(0,0,k.length,L.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(c,f){const v=c.context,w=v.gl,S=c.transform,M=new s.b4(w.LEQUAL,s.b4.ReadOnly,[0,1]),k=s.ao(S.zoom),L=f.properties.get("color").toArray01(),F=f.properties.get("high-color").toArray01(),$=f.properties.get("space-color").toArray01PremultipliedAlpha(),Z=5e-4,K=s.c1(f.properties.get("horizon-blend"),0,1,Z,.25),ee=s.bb(c,v,S)&&K===Z?S.worldSize/(2*Math.PI*1.025)-1:S.globeRadius,ne=c.frameCounter/1e3%1,oe=s.v.length(S.globeCenterInViewSpace),ie=Math.sqrt(Math.pow(oe,2)-Math.pow(ee,2)),re=Math.acos(ie/oe),de=be=>{const Ee=S.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];be&&Ee.push("ALPHA_PASS");const ce=c.getOrCreateProgram("globeAtmosphere",{defines:Ee}),fe=((Oe,Ae,Le,ut,He,Je,Be,lt,Qe,dt,ye,$e)=>({u_frustum_tl:Oe,u_frustum_tr:Ae,u_frustum_br:Le,u_frustum_bl:ut,u_horizon:He,u_transition:Je,u_fadeout_range:Be,u_color:lt,u_high_color:Qe,u_space_color:dt,u_temporal_offset:ye,u_horizon_angle:$e}))(S.frustumCorners.TL,S.frustumCorners.TR,S.frustumCorners.BR,S.frustumCorners.BL,S.frustumCorners.horizon,k,K,L,F,$,ne,re);c.uploadCommonUniforms(v,ce);const Ce=this.atmosphereBuffer;Ce&&ce.draw(c,w.TRIANGLES,M,s.b6.disabled,be?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,s.b5.backCW,fe,be?"atmosphere_glow_alpha":"atmosphere_glow",Ce.vertexBuffer,Ce.indexBuffer,Ce.segments)};de(!1),de(!0)}drawStars(c,f){const v=s.c(f.properties.get("star-intensity"),0,1);if(v===0)return;const w=c.context,S=w.gl,M=c.transform,k=c.getOrCreateProgram("stars"),L=s.q.identity([]);s.q.rotateX(L,L,-M._pitch),s.q.rotateZ(L,L,-M.angle),s.q.rotateX(L,L,s.d(M._center.lat)),s.q.rotateY(L,L,-s.d(M._center.lng));const F=s.m.fromQuat(new Float32Array(16),L),$=s.m.multiply([],M.starsProjMatrix,F),Z=s.bx.fromMat4([],F),K=s.bx.invert([],Z),ee=[0,1,0];s.v.transformMat3(ee,ee,K),s.v.scale(ee,ee,this.params.sizeMultiplier);const ne=[1,0,0];s.v.transformMat3(ne,ne,K),s.v.scale(ne,ne,this.params.sizeMultiplier);const oe=(ie=ee,re=ne,de=v,{u_matrix:Float32Array.from($),u_up:ie,u_right:re,u_intensity_multiplier:de});var ie,re,de;c.uploadCommonUniforms(w,k),this.starsVx&&this.starsIdx&&k.draw(c,S.TRIANGLES,s.b4.disabled,s.b6.disabled,this.colorModeAlphaBlendedWriteRGB,s.b5.disabled,oe,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function Dd(_,c){const f=[..._],v=c.cameraWorldSizeForFog/c.worldSize,w=s.m.identity([]);return s.m.scale(w,w,[v,v,1]),s.m.multiply(f,w,f),s.m.multiply(f,c.worldToFogMatrix,f),f}function em(_,c,f,v){const w=f.material,S=v.context,{baseColorTexture:M,metallicRoughnessTexture:k}=w.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:F,emissionTexture:$}=w;function Z(K,ee,ne){if(K&&(_.push(ee),S.activeTexture.set(S.gl.TEXTURE0+ne),K.gfxTexture)){const{minFilter:oe,magFilter:ie,wrapS:re,wrapT:de}=K.sampler;K.gfxTexture.bindExtraParam(oe,ie,re,de)}}Z(M,"HAS_TEXTURE_u_baseColorTexture",oo.BaseColor),Z(k,"HAS_TEXTURE_u_metallicRoughnessTexture",oo.MetallicRoughness),Z(L,"HAS_TEXTURE_u_normalTexture",oo.Normal),Z(F,"HAS_TEXTURE_u_occlusionTexture",oo.Occlusion),Z($,"HAS_TEXTURE_u_emissionTexture",oo.Emission),f.texcoordBuffer&&(_.push("HAS_ATTRIBUTE_a_uv_2f"),c.push(f.texcoordBuffer)),f.colorBuffer&&(_.push(f.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),c.push(f.colorBuffer)),f.normalBuffer&&(_.push("HAS_ATTRIBUTE_a_normal_3f"),c.push(f.normalBuffer)),f.pbrBuffer&&(_.push("HAS_ATTRIBUTE_a_pbr"),_.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),c.push(f.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||_.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||_.push("DIFFUSE_SHADED"),_.push("USE_STANDARD_DERIVATIVES")}function Yl(_,c,f,v,w,S){const M=f.paint.get("model-opacity"),k=c.context,L=new s.b4(c.context.gl.LEQUAL,s.b4.ReadWrite,c.depthRangeFor3D),F=c.transform,$=_.mesh,Z=$.material,K=Z.pbrMetallicRoughness,ee=c.style.fog;let ne;ne=c.transform.projection.zAxisUnit==="pixels"?[..._.nodeModelMatrix]:s.m.multiply([],v.zScaleMatrix,_.nodeModelMatrix),s.m.multiply(ne,v.negCameraPosMatrix,ne);const oe=s.m.invert([],ne);s.m.transpose(oe,oe);const ie=f.paint.get("model-emissive-strength").constantOr(0),re=ih(new Float32Array(_.worldViewProjection),new Float32Array(ne),new Float32Array(oe),c,M,K.baseColorFactor,Z.emissiveFactor,K.metallicFactor,K.roughnessFactor,Z,ie,f),de={defines:[]},be=[];em(de.defines,be,$,c);const Ee=c.shadowRenderer;Ee&&(Ee.useNormalOffset=!1);let ce=null;if(ee){const Oe=Dd(_.nodeModelMatrix,c.transform);if(ce=new Float32Array(Oe),F.projection.name!=="globe"){const Ae=$.aabb.min,Le=$.aabb.max,[ut,He]=ee.getOpacityForBounds(Oe,Ae[0],Ae[1],Le[0],Le[1]);de.overrideFog=ut>=Bn||He>=Bn}}const fe=ql(c,f.paint.get("model-cutoff-fade-range"));fe.shouldRenderCutoff&&de.defines.push("RENDER_CUTOFF");const Ce=c.getOrCreateProgram("model",de);c.uploadCommonUniforms(k,Ce,null,ce,fe),c.renderPass!=="shadow"&&Ee&&Ee.setupShadowsFromMatrix(_.nodeModelMatrix,Ce),Ce.draw(c,k.gl.TRIANGLES,L,w,S,$.material.doubleSided?s.b5.disabled:s.b5.backCCW,re,f.id,$.vertexBuffer,$.indexBuffer,$.segments,f.paint,c.transform.zoom,void 0,be)}function zy(_,c,f,v,w,S,M){let k;k=_.projection.name==="globe"?s.c5(f,_):[...f],s.m.multiply(k,k,c.matrix);const L=s.m.multiply([],v,k);if(c.meshes)for(const F of c.meshes){if(F.material.alphaMode!=="BLEND"){M.push({mesh:F,depth:0,modelIndex:w,worldViewProjection:L,nodeModelMatrix:k});continue}const $=s.v.transformMat4([],F.centroid,L);$[2]>0&&S.push({mesh:F,depth:$[2],modelIndex:w,worldViewProjection:L,nodeModelMatrix:k})}if(c.children)for(const F of c.children)zy(_,F,f,v,w,S,M)}function ah(_,c,f,v){const w=f.shadowRenderer;if(!w)return;const S=w.getShadowPassDepthMode(),M=w.getShadowPassColorMode(),k=w.calculateShadowPassMatrixFromMatrix(c),L=Id(k);f.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(f,f.context.gl.TRIANGLES,S,s.b6.disabled,M,s.b5.backCCW,L,v.id,_.vertexBuffer,_.indexBuffer,_.segments,v.paint,f.transform.zoom,void 0,void 0)}function nb(_,c,f){const v=c.updateZoomBasedPaintProperties(),w=function(S,M,k){let L,F,$,Z=S.terrain?S.terrain.exaggeration():0;if(S.terrain&&Z>0){const K=S.terrain,ee=K.findDEMTileFor(k);ee&&ee.dem?L=s.c7.create(K,k,ee):Z=0}if(Z===0&&(M.terrainElevationMin=0,M.terrainElevationMax=0),Z===M.validForExaggeration&&(Z===0||L&&L._demTile&&L._demTile.tileID===M.validForDEMTile.id&&L._dem._timestamp===M.validForDEMTile.timestamp))return!1;for(const K in M.instancesPerModel){const ee=M.instancesPerModel[K];for(let ne=0;ne<ee.instancedDataArray.length;++ne){const oe=(L?Z*L.getElevationAt(0|ee.instancedDataArray.float32[16*ne],0|ee.instancedDataArray.float32[16*ne+1],!0,!0):0)+ee.instancesEvaluatedElevation[ne];ee.instancedDataArray.float32[16*ne+6]=oe,F=F?Math.min(M.terrainElevationMin,oe):oe,$=$?Math.max(M.terrainElevationMax,oe):oe}}return M.terrainElevationMin=F||0,M.terrainElevationMax=$||0,M.validForExaggeration=Z,M.validForDEMTile=L&&L._demTile?{id:L._demTile.tileID,timestamp:L._dem._timestamp}:{id:void 0,timestamp:0},!0}(_,c,f);(v||w)&&(c.uploaded=!1,c.upload(_.context))}const Ms={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new s.c3([0,0,0],[s.J,s.J,0])};function ib(_,c){const f=1<<_.canonical.z,v=c.getFreeCameraOptions().position,w=c.elevation,S=_.canonical.x/f,M=(_.canonical.x+1)/f,k=_.canonical.y/f,L=(_.canonical.y+1)/f;let F=c._centerAltitude;if(w){const ee=w.getMinMaxForTile(_);ee&&ee.max>F&&(F=ee.max)}const $=s.c(v.x,S,M)-v.x,Z=s.c(v.y,k,L)-v.y,K=s.b(F,c.center.lat)-v.z;return c._zoomFromMercatorZ(Math.sqrt($*$+Z*Z+K*K))}function lh(_,c,f,v,w,S,M){const k=_.context,L=_.renderPass==="shadow",F=_.shadowRenderer,$=L&&F?F.getShadowPassDepthMode():new s.b4(k.gl.LEQUAL,s.b4.ReadWrite,_.depthRangeFor3D),Z=_.isTileAffectedByFog(S);if(f.meshes)for(const K of f.meshes){const ee=["MODEL_POSITION_ON_GPU"],ne=[];let oe,ie,re;v.instancedDataArray.length>20&&ee.push("INSTANCED_ARRAYS");const de=ql(_,c.paint.get("model-cutoff-fade-range"));if(de.shouldRenderCutoff&&ee.push("RENDER_CUTOFF"),L&&F)oe=_.getOrCreateProgram("modelDepth",{defines:ee}),ie=Id(M.shadowTileMatrix,M.shadowTileMatrix,Float32Array.from(f.matrix)),re=F.getShadowPassColorMode();else{em(ee,ne,K,_),oe=_.getOrCreateProgram("model",{defines:ee,overrideFog:Z});const Ee=K.material,ce=Ee.pbrMetallicRoughness,fe=c.paint.get("model-opacity"),Ce=c.paint.get("model-emissive-strength").constantOr(0);ie=ih(S.expandedProjMatrix,Float32Array.from(f.matrix),new Float32Array(16),_,fe,ce.baseColorFactor,Ee.emissiveFactor,ce.metallicFactor,ce.roughnessFactor,Ee,Ce,c,w),F&&(M.shadowUniformsInitialized?oe.setShadowUniformValues(k,F.getShadowUniformValues()):(F.setupShadows(S.toUnwrapped(),oe,"model-tile",S.overscaledZ),M.shadowUniformsInitialized=!0)),re=de.shouldRenderCutoff||fe<1||Ee.alphaMode!=="OPAQUE"?s.a.alphaBlended:s.a.unblended}_.uploadCommonUniforms(k,oe,S.toUnwrapped(),null,de);const be=K.material.doubleSided?s.b5.disabled:s.b5.backCCW;if(v.instancedDataArray.length>20)ne.push(v.instancedDataBuffer),oe.draw(_,k.gl.TRIANGLES,$,s.b6.disabled,re,be,ie,c.id,K.vertexBuffer,K.indexBuffer,K.segments,c.paint,_.transform.zoom,void 0,ne,v.instancedDataArray.length);else{const Ee=L?"u_instance":"u_normal_matrix";for(let ce=0;ce<v.instancedDataArray.length;++ce)ie[Ee]=new Float32Array(v.instancedDataArray.arrayBuffer,64*ce,16),oe.draw(_,k.gl.TRIANGLES,$,s.b6.disabled,re,be,ie,c.id,K.vertexBuffer,K.indexBuffer,K.segments,c.paint,_.transform.zoom,void 0,ne)}}if(f.children)for(const K of f.children)lh(_,c,K,v,w,S,M)}const ob=[1,-1,1];function Ny(_,c,f,v){if(!f.modelManager)return!0;const w=f.modelManager;if(!f.shadowRenderer)return!0;const S=f.shadowRenderer,M=c.aabb;let k=!0,L=_.maxHeight;if(L===0){let $=0;for(const Z in _.instancesPerModel){const K=w.getModel(Z,v);K?$=Math.max($,Math.max(Math.max(K.aabb.max[0],K.aabb.max[1]),K.aabb.max[2])):k=!1}L=_.maxScale*$*1.41+_.maxVerticalOffset,k&&(_.maxHeight=L)}M.max[2]=L,M.min[2]+=_.terrainElevationMin,M.max[2]+=_.terrainElevationMax,s.v.transformMat4(M.min,M.min,c.tileMatrix),s.v.transformMat4(M.max,M.max,c.tileMatrix);const F=M.intersects(S.getCurrentCascadeFrustum());return f.currentShadowCascade===0&&(_.isInsideFirstShadowMapFrustum=F===2),F===0}class Fy{}class qc{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(c,f,v){{const Z=this._storage.get(f.id);if(Z)return Z.lastUsedFrameIdx=c,Z.buf}const w=v.gl,S=w.getBufferParameter(w.ELEMENT_ARRAY_BUFFER,w.BUFFER_SIZE),M=new ArrayBuffer(S),k=new Int16Array(M);w.getBufferSubData(w.ELEMENT_ARRAY_BUFFER,0,new Int16Array(M));const L=new s.c9;for(let Z=0;Z<S/2;Z+=3){const K=k[Z],ee=k[Z+1],ne=k[Z+2];L.emplaceBack(K,ee),L.emplaceBack(ee,ne),L.emplaceBack(ne,K)}const F=v.bindVertexArrayOES.current,$=new Fy;return $.buf=new s.I(v,L),$.lastUsedFrameIdx=c,this._storage.set(f.id,$),v.bindVertexArrayOES.set(F),$.buf}update(c){for(const[f,v]of this._storage)c-v.lastUsedFrameIdx>30&&(v.buf.destroy(),this._storage.delete(f))}destroy(){for(const[c,f]of this._storage)f.buf.destroy(),this._storage.delete(c)}}class By{registerParameter(c,f,v,w,S){}registerButton(c,f,v){}}const tm={symbol:function(_,c,f,v,w){if(_.renderPass!=="translucent")return;const S=s.b6.disabled,M=_.colorModeForRenderPass();f.layout.get("text-variable-anchor")&&function(k,L,F,$,Z,K,ee){const ne=L.transform,oe=Z==="map",ie=K==="map";for(const re of k){const de=$.getTile(re),be=de.getBucket(F);if(!be||!be.text||!be.text.segments.get().length)continue;const Ee=s.i(be.textSizeData,ne.zoom),ce=zt(re,be.getProjection(),ne),fe=ne.calculatePixelsToTileUnitsMatrix(de),Ce=ii(ce,de.tileID.canonical,ie,oe,ne,be.getProjection(),fe),Oe=be.hasIconTextFit()&&be.hasIconData();if(Ee){const Ae=Math.pow(2,ne.zoom-de.tileID.overscaledZ);Wp(be,oe,ie,ee,s.bG,ne,Ce,re,Ae,Ee,Oe)}}}(v,_,f,c,f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),w),f.paint.get("icon-opacity").constantOr(1)!==0&&Fr(_,c,f,v,!1,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),f.layout.get("icon-rotation-alignment"),f.layout.get("icon-pitch-alignment"),f.layout.get("icon-keep-upright"),f.paint.get("icon-color-saturation"),S,M),f.paint.get("text-opacity").constantOr(1)!==0&&Fr(_,c,f,v,!0,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),f.layout.get("text-rotation-alignment"),f.layout.get("text-pitch-alignment"),f.layout.get("text-keep-upright"),f.paint.get("icon-color-saturation"),S,M),c.map.showCollisionBoxes&&(qp(_,c,f,v,f.paint.get("text-translate"),f.paint.get("text-translate-anchor"),!0),qp(_,c,f,v,f.paint.get("icon-translate"),f.paint.get("icon-translate-anchor"),!1))},circle:function(_,c,f,v){if(_.renderPass!=="translucent")return;const w=f.paint.get("circle-opacity"),S=f.paint.get("circle-stroke-width"),M=f.paint.get("circle-stroke-opacity"),k=f.layout.get("circle-sort-key").constantOr(1)!==void 0,L=f.paint.get("circle-emissive-strength");if(w.constantOr(1)===0&&(S.constantOr(1)===0||M.constantOr(1)===0))return;const F=_.context,$=F.gl,Z=_.transform,K=_.depthModeForSublayer(0,s.b4.ReadOnly),ee=s.b6.disabled,ne=_.colorModeForDrapableLayerRenderPass(L),oe=Z.projection.name==="globe",ie=[s.E(Z.center.lng),s.H(Z.center.lat)],re=[];for(let be=0;be<v.length;be++){const Ee=v[be],ce=c.getTile(Ee),fe=ce.getBucket(f);if(!fe||fe.projection.name!==Z.projection.name)continue;const Ce=fe.programConfigurations.get(f.id),Oe=s.bH(f),Ae=_.isTileAffectedByFog(Ee);oe&&Oe.push("PROJECTION_GLOBE_VIEW");const Le=_.getOrCreateProgram("circle",{config:Ce,defines:Oe,overrideFog:Ae}),ut=fe.layoutVertexBuffer,He=fe.globeExtVertexBuffer,Je=fe.indexBuffer,Be=Z.projection.createInversionMatrix(Z,Ee.canonical),lt={programConfiguration:Ce,program:Le,layoutVertexBuffer:ut,globeExtVertexBuffer:He,indexBuffer:Je,uniformValues:s.bI(_,Ee,ce,Be,ie,f),tile:ce};if(k){const Qe=fe.segments.get();for(const dt of Qe)re.push({segments:new s.bm([dt]),sortKey:dt.sortKey,state:lt})}else re.push({segments:fe.segments,sortKey:0,state:lt})}k&&re.sort((be,Ee)=>be.sortKey-Ee.sortKey);const de={useDepthForOcclusion:Z.depthOcclusionForSymbolsAndCircles};for(const be of re){const{programConfiguration:Ee,program:ce,layoutVertexBuffer:fe,globeExtVertexBuffer:Ce,indexBuffer:Oe,uniformValues:Ae,tile:Le}=be.state,ut=be.segments;_.terrain&&_.terrain.setupElevationDraw(Le,ce,de),_.uploadCommonUniforms(F,ce,Le.tileID.toUnwrapped()),ce.draw(_,$.TRIANGLES,K,ee,ne,s.b5.disabled,Ae,f.id,fe,Oe,ut,f.paint,Z.zoom,Ee,[Ce])}},heatmap:function(_,c,f,v){if(f.paint.get("heatmap-opacity")!==0)if(_.renderPass==="offscreen"){const w=_.context,S=w.gl,M=s.b6.disabled,k=new s.a([S.ONE,S.ONE,S.ONE,S.ONE],s.C.transparent,[!0,!0,!0,!0]);(function(ee,ne,oe,ie){const re=ee.gl,de=ne.width*ie,be=ne.height*ie;ee.activeTexture.set(re.TEXTURE1),ee.viewport.set([0,0,de,be]);let Ee=oe.heatmapFbo;if(!Ee||Ee&&(Ee.width!==de||Ee.height!==be)){Ee&&Ee.destroy();const ce=re.createTexture();re.bindTexture(re.TEXTURE_2D,ce),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_S,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_WRAP_T,re.CLAMP_TO_EDGE),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MIN_FILTER,re.LINEAR),re.texParameteri(re.TEXTURE_2D,re.TEXTURE_MAG_FILTER,re.LINEAR),Ee=oe.heatmapFbo=ee.createFramebuffer(de,be,!0,null),function(fe,Ce,Oe,Ae,Le,ut){const He=fe.gl;He.texImage2D(He.TEXTURE_2D,0,fe.extRenderToTextureHalfFloat?He.RGBA16F:He.RGBA,Le,ut,0,He.RGBA,fe.extRenderToTextureHalfFloat?He.HALF_FLOAT:He.UNSIGNED_BYTE,null),Ae.colorAttachment.set(Oe)}(ee,0,ce,Ee,de,be)}else re.bindTexture(re.TEXTURE_2D,Ee.colorAttachment.get()),ee.bindFramebuffer.set(Ee.framebuffer)})(w,_,f,_.transform.projection.name==="globe"?.5:.25),w.clear({color:s.C.transparent});const L=_.transform,F=L.projection.name==="globe",$=F?["PROJECTION_GLOBE_VIEW"]:[],Z=F?s.b5.frontCCW:s.b5.disabled,K=[s.E(L.center.lng),s.H(L.center.lat)];for(let ee=0;ee<v.length;ee++){const ne=v[ee];if(c.hasRenderableParent(ne))continue;const oe=c.getTile(ne),ie=oe.getBucket(f);if(!ie||ie.projection.name!==L.projection.name)continue;const re=_.isTileAffectedByFog(ne),de=ie.programConfigurations.get(f.id),be=_.getOrCreateProgram("heatmap",{config:de,defines:$,overrideFog:re}),{zoom:Ee}=_.transform;_.terrain&&_.terrain.setupElevationDraw(oe,be),_.uploadCommonUniforms(w,be,ne.toUnwrapped());const ce=L.projection.createInversionMatrix(L,ne.canonical);be.draw(_,S.TRIANGLES,s.b4.disabled,M,k,Z,Ty(_,ne,oe,ce,K,Ee,f.paint.get("heatmap-intensity")),f.id,ie.layoutVertexBuffer,ie.indexBuffer,ie.segments,f.paint,_.transform.zoom,de,F?[ie.globeExtVertexBuffer]:null)}w.viewport.set([0,0,_.width,_.height])}else _.renderPass==="translucent"&&(_.context.setColorMode(_.colorModeForRenderPass()),function(w,S){const M=w.context,k=M.gl,L=S.heatmapFbo;if(!L)return;M.activeTexture.set(k.TEXTURE0),k.bindTexture(k.TEXTURE_2D,L.colorAttachment.get()),M.activeTexture.set(k.TEXTURE1);let F=S.colorRampTexture;F||(F=S.colorRampTexture=new s.a9(M,S.colorRamp,k.RGBA)),F.bind(k.LINEAR,k.CLAMP_TO_EDGE),w.getOrCreateProgram("heatmapTexture").draw(w,k.TRIANGLES,s.b4.disabled,s.b6.disabled,w.colorModeForRenderPass(),s.b5.disabled,(($,Z,K,ee)=>({u_image:0,u_color_ramp:1,u_opacity:Z.paint.get("heatmap-opacity")}))(0,S),S.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,S.paint,w.transform.zoom)}(_,f))},line:function(_,c,f,v){if(_.renderPass!=="translucent")return;const w=f.paint.get("line-opacity"),S=f.paint.get("line-width");if(w.constantOr(1)===0||S.constantOr(1)===0)return;const M=f.paint.get("line-emissive-strength"),k=_.depthModeForSublayer(0,s.b4.ReadOnly),L=_.colorModeForDrapableLayerRenderPass(M),F=_.terrain&&_.terrain.renderingToTexture?1:s.a4.devicePixelRatio,$=f.paint.get("line-dasharray"),Z=$.constantOr(1),K=f.layout.get("line-cap"),ee=f.paint.get("line-pattern"),ne=ee.constantOr(1),oe=f.paint.get("line-pattern").constantOr(1),ie=f.paint.get("line-opacity").constantOr(1)!==1;let re=!oe&&ie;const de=f.paint.get("line-gradient"),be=ne?"linePattern":"line",Ee=_.context,ce=Ee.gl,fe=s.bJ(f);_.terrain&&_.terrain.clipOrMaskOverlapStencilType()&&(re=!1);for(const Ce of v){const Oe=c.getTile(Ce);if(ne&&!Oe.patternsLoaded())continue;const Ae=Oe.getBucket(f);if(!Ae)continue;_.prepareDrawTile();const Le=Ae.programConfigurations.get(f.id),ut=_.isTileAffectedByFog(Ce),He=_.getOrCreateProgram(be,{config:Le,defines:fe,overrideFog:ut}),Je=ee.constantOr(null);if(Je&&Oe.imageAtlas){const pt=Oe.imageAtlas.patternPositions[Je.toString()];pt&&Le.setConstantPatternPositions(pt)}const Be=$.constantOr(null),lt=K.constantOr(null);if(!ne&&Be&&lt&&Oe.lineAtlas){const pt=Oe.lineAtlas.getDash(Be,lt);pt&&Le.setConstantPatternPositions(pt)}let[Qe,dt]=f.paint.get("line-trim-offset");(lt==="round"||lt==="square")&&Qe!==dt&&(Qe===0&&(Qe-=1),dt===1&&(dt+=1));const ye=_.terrain?Ce.projMatrix:null,$e=ne?s.bK(_,Oe,f,ye,F):s.bL(_,Oe,f,ye,Ae.lineClipsArray.length,F,[Qe,dt]);if(de){const pt=Ae.gradients[f.id];let Xt=pt.texture;if(f.gradientVersion!==pt.version){let Bt=256;if(f.stepInterpolant){const nr=c.getSource().maxzoom,Wt=Ce.canonical.z===nr?Math.ceil(1<<_.transform.maxZoom-Ce.canonical.z):1;Bt=s.c(s.bM(Ae.maxLineLength/s.J*1024*Wt),256,Ee.maxTextureSize)}pt.gradient=s.bN({expression:f.gradientExpression(),evaluationKey:"lineProgress",resolution:Bt,image:pt.gradient||void 0,clips:Ae.lineClipsArray}),pt.texture?pt.texture.update(pt.gradient):pt.texture=new s.a9(Ee,pt.gradient,ce.RGBA),pt.version=f.gradientVersion,Xt=pt.texture}Ee.activeTexture.set(ce.TEXTURE1),Xt.bind(f.stepInterpolant?ce.NEAREST:ce.LINEAR,ce.CLAMP_TO_EDGE)}Z&&(Ee.activeTexture.set(ce.TEXTURE0),Oe.lineAtlasTexture&&Oe.lineAtlasTexture.bind(ce.LINEAR,ce.REPEAT),Le.updatePaintBuffers()),ne&&(Ee.activeTexture.set(ce.TEXTURE0),Oe.imageAtlasTexture&&Oe.imageAtlasTexture.bind(ce.LINEAR,ce.CLAMP_TO_EDGE),Le.updatePaintBuffers()),_.uploadCommonUniforms(Ee,He,Ce.toUnwrapped());const St=pt=>{He.draw(_,ce.TRIANGLES,k,pt,L,s.b5.disabled,$e,f.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,f.paint,_.transform.zoom,Le,[Ae.layoutVertexBuffer2])};if(re){const pt=_.stencilModeForClipping(Ce).ref;pt===0&&_.terrain&&Ee.clear({stencil:0});const Xt={func:ce.EQUAL,mask:255};$e.u_alpha_discard_threshold=.8,St(new s.b6(Xt,pt,255,ce.KEEP,ce.KEEP,ce.INVERT)),$e.u_alpha_discard_threshold=0,St(new s.b6(Xt,pt,255,ce.KEEP,ce.KEEP,ce.KEEP))}else St(_.stencilModeForClipping(Ce))}re&&(_.resetStencilClippingMasks(),_.terrain&&Ee.clear({stencil:0}))},fill:function(_,c,f,v){const w=f.paint.get("fill-color"),S=f.paint.get("fill-opacity");if(S.constantOr(1)===0)return;const M=f.paint.get("fill-emissive-strength"),k=_.colorModeForDrapableLayerRenderPass(M),L=f.paint.get("fill-pattern"),F=_.opaquePassEnabledForLayer()&&!L.constantOr(1)&&w.constantOr(s.C.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(_.renderPass===F){const $=_.depthModeForSublayer(1,_.renderPass==="opaque"?s.b4.ReadWrite:s.b4.ReadOnly);oh(_,c,f,v,$,k,!1)}if(_.renderPass==="translucent"&&f.paint.get("fill-antialias")){const $=_.depthModeForSublayer(f.getPaintProperty("fill-outline-color")?2:0,s.b4.ReadOnly);oh(_,c,f,v,$,k,!0)}},"fill-extrusion":function(_,c,f,v){const w=f.paint.get("fill-extrusion-opacity"),S=_.context,M=S.gl,k=_.terrain,L=k&&k.renderingToTexture;if(w===0)return;const F=_.conflationActive&&_.layerUsedInConflation(f,c.getSource());if(F&&function($,Z,K,ee){for(const ne of ee){const oe=Z.getTile(ne).getBucket(K);oe&&(oe.updateReplacement(ne,$.replacementSource),oe.uploadCentroid($.context))}}(_,c,f,v),k||F)for(const $ of v){const Z=c.getTile($).getBucket(f);Z&&Ay(_.context,c,$,Z,f,k,F)}if(_.renderPass==="shadow"&&_.shadowRenderer){const $=_.shadowRenderer;if(k&&w<.65&&f._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof s.am)return;const Z=$.getShadowPassDepthMode(),K=$.getShadowPassColorMode();sh(_,c,f,v,Z,s.b6.disabled,K,F)}else if(_.renderPass==="translucent"){const $=!f.paint.get("fill-extrusion-pattern").constantOr(1),Z=f.paint.get("fill-extrusion-color").constantOr(s.C.white);if(!L&&Z.a!==0){const K=new s.b4(_.context.gl.LEQUAL,s.b4.ReadWrite,_.depthRangeFor3D);w===1&&$?sh(_,c,f,v,K,s.b6.disabled,s.a.unblended,F):(sh(_,c,f,v,K,s.b6.disabled,s.a.disabled,F),sh(_,c,f,v,K,_.stencilModeFor3D(),_.colorModeForRenderPass(),F),_.resetStencilClippingMasks())}if(_.style.enable3dLights()&&$&&(!k&&_.transform.projection.name!=="globe"||L)){const K=f.paint.get("fill-extrusion-opacity"),ee=f.paint.get("fill-extrusion-ambient-occlusion-intensity"),ne=f.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),oe=f.paint.get("fill-extrusion-flood-light-intensity"),ie=f.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),re=ee>0&&ne>0,de=oe>0,be=(ce,fe,Ce)=>(1-Ce)*ce+Ce*fe,Ee=ce=>{const fe=_.depthModeForSublayer(1,s.b4.ReadOnly,M.LEQUAL,!0),Ce=f.paint.get(ce?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Oe=be(.1,3,Ce),Ae=_._showOverdrawInspector;if(!Ae){const Le=new s.b6({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),ut=new s.a([M.ONE,M.ONE,M.ONE,M.ONE],s.C.transparent,[!1,!1,!1,!0],M.MIN);Zl(_,c,f,v,fe,Le,ut,s.b5.disabled,ce,"sdf",K,ee,ne,oe,ie,Oe,F,!1)}{const Le=Ae?s.b6.disabled:new s.b6({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),ut=Ae?_.colorModeForRenderPass():new s.a([M.ONE_MINUS_DST_ALPHA,M.DST_ALPHA,M.ONE,M.ONE],s.C.transparent,[!0,!0,!0,!0]);Zl(_,c,f,v,fe,Le,ut,s.b5.disabled,ce,"color",K,ee,ne,oe,ie,Oe,F,!1)}};if(L){const ce=(fe,Ce,Oe)=>{const Ae=_.depthModeForSublayer(1,s.b4.ReadOnly,M.LEQUAL,!1),Le=f.paint.get(fe?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),ut=be(.1,3,Le);{const He=new s.a([M.ONE,M.ONE,M.ONE,M.ONE],s.C.transparent,[!1,!1,!1,!0]);Zl(_,c,f,v,Ae,s.b6.disabled,He,s.b5.disabled,fe,"clear",K,ee,ne,oe,ie,ut,F,Ce)}{const He=new s.b6({func:M.ALWAYS,mask:255},255,255,M.KEEP,M.KEEP,M.REPLACE),Je=new s.a([M.ONE,M.ONE,M.ONE,M.ONE],s.C.transparent,[!1,!1,!1,!0],M.MIN);Zl(_,c,f,v,Ae,He,Je,s.b5.disabled,fe,"sdf",K,ee,ne,oe,ie,ut,F,Ce)}{const He=fe?M.ZERO:M.ONE_MINUS_DST_ALPHA,Je=new s.b6({func:M.EQUAL,mask:255},255,255,M.KEEP,M.DECR,M.DECR),Be=new s.a([He,M.DST_ALPHA,M.ONE_MINUS_DST_ALPHA,M.ZERO],s.C.transparent,[!0,!0,!0,!0]);Zl(_,c,f,v,Ae,Je,Be,s.b5.disabled,fe,"color",K,ee,ne,oe,ie,ut,F,Ce)}{const He=new s.a([M.ONE,M.ONE,M.ONE,fe?M.ZERO:M.ONE],s.C.transparent,[!1,!1,!1,!0],fe?M.FUNC_ADD:M.MAX);Zl(_,c,f,v,Ae,s.b6.disabled,He,s.b5.disabled,fe,"clear",K,ee,ne,oe,ie,ut,F,Ce,Oe)}};if(re||de){let fe;if(_.prepareDrawTile(),k){const Ce=k.drapeBufferSize[0],Oe=k.drapeBufferSize[1];fe=k.framebufferCopyTexture,fe&&(!fe||fe.size[0]===Ce&&fe.size[1]===Oe)||(fe&&fe.destroy(),fe=k.framebufferCopyTexture=new s.a9(S,new s.a5({width:Ce,height:Oe}),M.RGBA)),fe.bind(M.LINEAR,M.CLAMP_TO_EDGE),M.copyTexImage2D(M.TEXTURE_2D,0,M.RGBA,0,0,Ce,Oe,0)}re&&ce(!0,!1,fe),de&&ce(!1,!0,fe)}}else re&&Ee(!0),de&&Ee(!1)}}},hillshade:function(_,c,f,v){if(_.renderPass!=="offscreen"&&_.renderPass!=="translucent"||_.style.disableElevatedTerrain)return;const w=_.context,S=_.terrain&&_.terrain.renderingToTexture,[M,k]=_.renderPass!=="translucent"||S?[{},v]:_.stencilConfigForOverlap(v);for(const L of k){const F=c.getTile(L);if(F.needsHillshadePrepare&&_.renderPass==="offscreen")H1(_,F,f);else if(_.renderPass==="translucent"){const $=_.depthModeForSublayer(0,s.b4.ReadOnly),Z=f.paint.get("hillshade-emissive-strength"),K=_.colorModeForDrapableLayerRenderPass(Z),ee=S&&_.terrain?_.terrain.stencilModeForRTTOverlap(L):M[L.overscaledZ];W1(_,L,F,f,$,ee,K)}}w.viewport.set([0,0,_.width,_.height]),_.resetStencilClippingMasks()},raster:function(_,c,f,v,w,S){if(_.renderPass!=="translucent"||f.paint.get("raster-opacity")===0)return;const M=_.context,k=M.gl,L=c.getSource(),F=function(Ce,Oe,Ae){const Le=Ce.paint.get("raster-color"),ut=[],He=Ce.paint.get("raster-resampling"),Je=Ce.paint.get("raster-color-mix"),Be=Ce.paint.get("raster-color-range"),lt=[Je[0],Je[1],Je[2],0],Qe=Je[3],dt=He==="nearest"?Ae.NEAREST:Ae.LINEAR;if(Le&&ut.push("RASTER_COLOR"),Le){Oe.activeTexture.set(Ae.TEXTURE2);let ye=Ce.colorRampTexture;ye||(ye=Ce.colorRampTexture=new s.a9(Oe,Ce.colorRamp,Ae.RGBA)),ye.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE)}return{mix:lt,range:Be,offset:Qe,defines:ut,resampling:dt}}(f,M,k),$=F.defines,Z=_.transform.projection.name==="globe";let K=!1;if(L instanceof s.aK&&!v.length){if(!Z)return;if(L.onNorthPole)K=!0,$.push("GLOBE_POLES");else{if(!L.onSouthPole)return;K=!0,$.push("GLOBE_POLES")}}const ee=f.paint.get("raster-emissive-strength"),ne=_.colorModeForDrapableLayerRenderPass(ee),oe=_.terrain&&_.terrain.renderingToTexture,ie=L instanceof s.aK&&f.paint.get("raster-elevation")!==0,re=!_.options.moving,de=f.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(K){const Ce=c.getSource();if(!(Ce instanceof s.aK))return;const Oe=Ce.texture;if(!Oe)return;const Ae=_.globeSharedBuffers;if(!Ae)return;const Le=new s.b4(k.LEQUAL,s.b4.ReadWrite,_.depthRangeFor3D),ut=Float32Array.from(_.transform.expandedFarZProjMatrix);let He=s.bj(0,0,_.transform);const Je=Float32Array.from(s.bh(s.bi(new s.t(0,0,0)))),Be={opacity:1,mix:0};_.terrain&&_.terrain.prepareDrawTile(),M.activeTexture.set(k.TEXTURE0),Oe.bind(de,k.CLAMP_TO_EDGE),M.activeTexture.set(k.TEXTURE1),Oe.bind(de,k.CLAMP_TO_EDGE),Oe.useMipmap&&M.extTextureFilterAnisotropic&&_.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const[lt,Qe,dt,ye]=Ae.getPoleBuffers(0,!0);let $e;Ce.onNorthPole?($e=lt,_.renderDefaultNorthPole=!1):(He=s.m.scale(s.m.create(),He,[1,-1,1]),$e=Qe,_.renderDefaultSouthPole=!1);const St=((Xt,Bt,nr,Wt,cr,ur,er,tr,Yr,Cr,kn,gn)=>Cy(Xt,Bt,nr,new Float32Array(16),new Float32Array(9),[0,0],0,[0,0],[0,0,0,0],1,Wt,cr,[0,0],er,2,Yr,Cr,kn,1,0,gn))(ut,Je,He,Be,f,0,f.paint.get("raster-elevation"),0,F.mix,F.offset,F.range,ee),pt=_.getOrCreateProgram("raster",{defines:F.defines});return _.uploadCommonUniforms(M,pt,null),void pt.draw(_,k.TRIANGLES,Le,s.b6.disabled,ne,s.b5.disabled,St,f.id,$e,dt,ye)}if(!v.length)return;const[be,Ee]=L instanceof s.aK||oe?[{},v]:_.stencilConfigForOverlap(v),ce=Ee[Ee.length-1].overscaledZ,fe=ie&&Z;fe&&F.defines.push("PROJECTION_GLOBE_VIEW"),ie&&F.defines.push("RENDER_CUTOFF");for(const Ce of Ee){const Oe=Ce.toUnwrapped(),Ae=c.getTile(Ce);if(oe&&(!Ae||!Ae.hasData())||!Ae.texture)continue;let Le,ut;oe?(Le=s.b4.disabled,ut=Ce.projMatrix):ie?(Le=new s.b4(k.LEQUAL,s.b4.ReadWrite,_.depthRangeFor3D),ut=Z?Float32Array.from(_.transform.expandedFarZProjMatrix):_.transform.calculateProjMatrix(Oe,re)):(Le=_.depthModeForSublayer(Ce.overscaledZ-ce,f.paint.get("raster-opacity")===1?s.b4.ReadWrite:s.b4.ReadOnly,k.LESS),ut=_.transform.calculateProjMatrix(Oe,re));const He=_.terrain&&oe?_.terrain.stencilModeForRTTOverlap(Ce):be[Ce.overscaledZ],Je=S?0:f.paint.get("raster-fade-duration");Ae.registerFadeDuration(Je);const Be=c.findLoadedParent(Ce,0),lt=xd(Ae,Be,c,_.transform,Je);let Qe,dt;_.terrain&&_.terrain.prepareDrawTile(),M.activeTexture.set(k.TEXTURE0),Ae.texture&&Ae.texture.bind(de,k.CLAMP_TO_EDGE),M.activeTexture.set(k.TEXTURE1),Be?(Be.texture&&Be.texture.bind(de,k.CLAMP_TO_EDGE),Qe=Math.pow(2,Be.tileID.overscaledZ-Ae.tileID.overscaledZ),dt=[Ae.tileID.canonical.x*Qe%1,Ae.tileID.canonical.y*Qe%1]):Ae.texture&&Ae.texture.bind(de,k.CLAMP_TO_EDGE),Ae.texture&&Ae.texture.useMipmap&&M.extTextureFilterAnisotropic&&_.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,M.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,M.extTextureFilterAnisotropicMax);const ye=_.transform;let $e;const St=ie?tb(ye):[0,0,0,0];let pt,Xt,Bt,nr,Wt;fe&&L instanceof s.aK&&L.coordinates.length>3?(pt=Float32Array.from(s.bh(s.bi(new s.t(0,0,0)))),Xt=Float32Array.from(ye.globeMatrix),Bt=Float32Array.from(s.bc(ye)),nr=[s.E(ye.center.lng),s.H(ye.center.lat)],$e=L.elevatedGlobePerspectiveTransform,Wt=L.elevatedGlobeGridMatrix||new Float32Array(9)):($e=L instanceof s.aK?L.perspectiveTransform:[0,0],pt=new Float32Array(16),Xt=new Float32Array(9),Bt=new Float32Array(16),nr=[0,0],Wt=new Float32Array(9));const cr=Cy(ut,pt,Xt,Bt,Wt,dt||[0,0],s.ao(_.transform.zoom),nr,St,Qe||1,lt,f,$e,ie?f.paint.get("raster-elevation"):0,2,F.mix,F.offset,F.range,1,0,ee),ur=_.isTileAffectedByFog(Ce),er=_.getOrCreateProgram("raster",{defines:F.defines,overrideFog:ur});if(_.uploadCommonUniforms(M,er,Oe),L instanceof s.aK){const tr=L.elevatedGlobeVertexBuffer,Yr=L.elevatedGlobeIndexBuffer;if(oe||!Z)L.boundsBuffer&&L.boundsSegments&&er.draw(_,k.TRIANGLES,Le,s.b6.disabled,ne,s.b5.disabled,cr,f.id,L.boundsBuffer,_.quadTriangleIndexBuffer,L.boundsSegments);else if(tr&&Yr){const Cr=ye.zoom<=s.Z?L.elevatedGlobeSegments:L.getSegmentsForLongitude(ye.center.lng);Cr&&(er.draw(_,k.TRIANGLES,Le,s.b6.disabled,ne,s.b5.backCW,cr,f.id,tr,Yr,Cr),er.draw(_,k.TRIANGLES,Le,s.b6.disabled,ne,s.b5.frontCW,cr,f.id,tr,Yr,Cr))}}else{const{tileBoundsBuffer:tr,tileBoundsIndexBuffer:Yr,tileBoundsSegments:Cr}=_.getTileBoundsBuffers(Ae);er.draw(_,k.TRIANGLES,Le,He,ne,s.b5.disabled,cr,f.id,tr,Yr,Cr)}}_.resetStencilClippingMasks()},background:function(_,c,f,v){const w=f.paint.get("background-color"),S=f.paint.get("background-opacity"),M=f.paint.get("background-emissive-strength");if(S===0)return;const k=_.context,L=k.gl,F=_.transform,$=F.tileSize,Z=f.paint.get("background-pattern");if(_.isPatternMissing(Z,f.scope))return;const K=!Z&&w.a===1&&S===1&&_.opaquePassEnabledForLayer()?"opaque":"translucent";if(_.renderPass!==K)return;const ee=s.b6.disabled,ne=_.depthModeForSublayer(0,K==="opaque"?s.b4.ReadWrite:s.b4.ReadOnly),oe=_.colorModeForDrapableLayerRenderPass(M),ie=Z?"backgroundPattern":"background";let re,de=v;de||(re=_.getBackgroundTiles(),de=Object.values(re).map(be=>be.tileID)),Z&&(k.activeTexture.set(L.TEXTURE0),_.imageManager.bind(_.context,f.scope));for(const be of de){const Ee=_.isTileAffectedByFog(be),ce=_.getOrCreateProgram(ie,{overrideFog:Ee}),fe=be.toUnwrapped(),Ce=v?be.projMatrix:_.transform.calculateProjMatrix(fe);_.prepareDrawTile();const Oe=c?c.getTile(be):re?re[be.key]:new s.bt(be,$,F.zoom,_),Ae=Z?$c(Ce,M,S,_,Z,f.scope,{tileID:be,tileSize:$}):Gp(Ce,M,S,w);_.uploadCommonUniforms(k,ce,fe);const{tileBoundsBuffer:Le,tileBoundsIndexBuffer:ut,tileBoundsSegments:He}=_.getTileBoundsBuffers(Oe);ce.draw(_,L.TRIANGLES,ne,ee,oe,s.b5.disabled,Ae,f.id,Le,ut,He)}},sky:function(_,c,f){const v=_._atmosphere?s.ao(_.transform.zoom):1,w=f.paint.get("sky-opacity")*v;if(w===0)return;const S=_.context,M=f.paint.get("sky-type"),k=new s.b4(S.gl.LEQUAL,s.b4.ReadOnly,[0,1]),L=_.frameCounter/1e3%1;M==="atmosphere"?_.renderPass==="offscreen"?f.needsSkyboxCapture(_)&&(function(F,$,Z,K){const ee=F.context,ne=ee.gl;let oe=$.skyboxFbo;if(!oe){oe=$.skyboxFbo=ee.createFramebuffer(32,32,!0,null),$.skyboxGeometry=new qs(ee),$.skyboxTexture=ee.gl.createTexture(),ne.bindTexture(ne.TEXTURE_CUBE_MAP,$.skyboxTexture),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_CUBE_MAP,ne.TEXTURE_MAG_FILTER,ne.LINEAR);for(let be=0;be<6;++be)ne.texImage2D(ne.TEXTURE_CUBE_MAP_POSITIVE_X+be,0,ne.RGBA,32,32,0,ne.RGBA,ne.UNSIGNED_BYTE,null)}ee.bindFramebuffer.set(oe.framebuffer),ee.viewport.set([0,0,32,32]);const ie=$.getCenter(F,!0),re=F.getOrCreateProgram("skyboxCapture"),de=new Float64Array(16);s.m.identity(de),s.m.rotateY(de,de,.5*-Math.PI),dl(F,$,re,de,ie,0),s.m.identity(de),s.m.rotateY(de,de,.5*Math.PI),dl(F,$,re,de,ie,1),s.m.identity(de),s.m.rotateX(de,de,.5*-Math.PI),dl(F,$,re,de,ie,2),s.m.identity(de),s.m.rotateX(de,de,.5*Math.PI),dl(F,$,re,de,ie,3),s.m.identity(de),dl(F,$,re,de,ie,4),s.m.identity(de),s.m.rotateY(de,de,Math.PI),dl(F,$,re,de,ie,5),ee.viewport.set([0,0,F.width,F.height])}(_,f),f.markSkyboxValid(_)):_.renderPass==="sky"&&function(F,$,Z,K,ee){const ne=F.context,oe=ne.gl,ie=F.transform,re=F.getOrCreateProgram("skybox");ne.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_CUBE_MAP,$.skyboxTexture);const de=((be,Ee,ce,fe,Ce)=>({u_matrix:be,u_sun_direction:Ee,u_cubemap:0,u_opacity:fe,u_temporal_offset:Ce}))(ie.skyboxMatrix,$.getCenter(F,!1),0,K,ee);F.uploadCommonUniforms(ne,re),re.draw(F,oe.TRIANGLES,Z,s.b6.disabled,F.colorModeForRenderPass(),s.b5.backCW,de,"skybox",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(_,f,k,w,L):M==="gradient"&&_.renderPass==="sky"&&function(F,$,Z,K,ee){const ne=F.context,oe=ne.gl,ie=F.transform,re=F.getOrCreateProgram("skyboxGradient");$.skyboxGeometry||($.skyboxGeometry=new qs(ne)),ne.activeTexture.set(oe.TEXTURE0);let de=$.colorRampTexture;de||(de=$.colorRampTexture=new s.a9(ne,$.colorRamp,oe.RGBA)),de.bind(oe.LINEAR,oe.CLAMP_TO_EDGE);const be=((Ee,ce,fe,Ce,Oe)=>({u_matrix:Ee,u_color_ramp:0,u_center_direction:ce,u_radius:s.d(fe),u_opacity:Ce,u_temporal_offset:Oe}))(ie.skyboxMatrix,$.getCenter(F,!1),$.paint.get("sky-gradient-radius"),K,ee);F.uploadCommonUniforms(ne,re),re.draw(F,oe.TRIANGLES,Z,s.b6.disabled,F.colorModeForRenderPass(),s.b5.backCW,be,"skyboxGradient",$.skyboxGeometry.vertexBuffer,$.skyboxGeometry.indexBuffer,$.skyboxGeometry.segment)}(_,f,k,w,L)},debug:function(_,c,f,v,w){for(let S=0;S<f.length;S++)if(w){const L=new s.C(v.r*.8,v.g*.8,v.b*.8,1);Xl(_,c,f[S],v,-1,-1),Xl(_,c,f[S],v,-1,1),Xl(_,c,f[S],v,1,1),Xl(_,c,f[S],v,1,-1),Xl(_,c,f[S],L,0,0)}else Xl(_,c,f[S],v,0,0)},custom:function(_,c,f,v){const w=_.context,S=f.implementation;if(!_.transform.projection.unsupportedLayers||!_.transform.projection.unsupportedLayers.includes("custom")||_.terrain&&(_.terrain.renderingToTexture||_.renderPass==="offscreen")&&f.isLayerDraped(c)){if(_.renderPass==="offscreen"){const M=S.prerender;if(M){if(_.setCustomLayerDefaults(),w.setColorMode(_.colorModeForRenderPass()),_.transform.projection.name==="globe"){const k=_.transform.pointMerc;M.call(S,w.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),s.ao(_.transform.zoom),[k.x,k.y],_.transform.pixelsPerMeterRatio)}else M.call(S,w.gl,_.transform.customLayerMatrix());w.setDirty(),_.setBaseState()}}else if(_.renderPass==="translucent"){if(_.terrain&&_.terrain.renderingToTexture){const k=S.renderToTile;if(k){const L=v[0].canonical,F=new s.M(L.x+v[0].wrap*(1<<L.z),L.y,L.z);w.setDepthMode(s.b4.disabled),w.setStencilMode(s.b6.disabled),w.setColorMode(_.colorModeForRenderPass()),_.setCustomLayerDefaults(),k.call(S,w.gl,F),w.setDirty(),_.setBaseState()}return}_.setCustomLayerDefaults(),w.setColorMode(_.colorModeForRenderPass()),w.setStencilMode(s.b6.disabled);const M=S.renderingMode==="3d"?new s.b4(_.context.gl.LEQUAL,s.b4.ReadWrite,_.depthRangeFor3D):_.depthModeForSublayer(0,s.b4.ReadOnly);if(w.setDepthMode(M),_.transform.projection.name==="globe"){const k=_.transform.pointMerc;S.render(w.gl,_.transform.customLayerMatrix(),_.transform.getProjection(),_.transform.globeToMercatorMatrix(),s.ao(_.transform.zoom),[k.x,k.y],_.transform.pixelsPerMeterRatio)}else S.render(w.gl,_.transform.customLayerMatrix());w.setDirty(),_.setBaseState(),w.bindFramebuffer.set(null)}}else s.X("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(_,c,f,v){if(_.renderPass==="opaque")return;const w=f.paint.get("model-opacity");if(w===0)return;const S=f.paint.get("model-cast-shadows");if(_.renderPass==="shadow"&&(!S||_.terrain&&w<.65&&f._transitionablePaint._values["model-opacity"].value.expression instanceof s.am))return;const M=_.shadowRenderer,k=f.paint.get("model-receive-shadows");M&&(M.useNormalOffset=!0,k||(M.enabled=!1));const L=()=>{M&&(M.useNormalOffset=!0,k||(M.enabled=!0))},F=c.getSource();if(_.renderPass==="light-beam"&&F.type!=="batched-model")return;if(F.type==="vector"||F.type==="geojson")return function(re,de,be,Ee){const ce=re.transform;if(ce.projection.name!=="mercator")return void s.X(`Drawing 3D models for ${ce.projection.name} projection is not yet implemented`);const fe=ce.getFreeCameraOptions().position;if(!re.modelManager)return;const Ce=re.modelManager,Oe=re.shadowRenderer;if(!be._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Ae=be._unevaluatedLayout._values["model-id"],Le={...be.layout.get("model-id").parameters};for(const ut of Ee){const He=de.getTile(ut).getBucket(be);if(!He||He.projection.name!==ce.projection.name)continue;const Je=ib(ut,ce);Le.zoom=Je;const Be=Ae.possiblyEvaluate(Le);if(nb(re,He,ut),Ms.shadowUniformsInitialized=!1,Ms.useSingleShadowCascade=!!Oe&&Oe.getMaxCascadeForTile(ut.toUnwrapped())===0,re.renderPass==="shadow"&&Oe){if(re.currentShadowCascade===1&&He.isInsideFirstShadowMapFrustum)continue;const dt=ce.calculatePosMatrix(ut.toUnwrapped(),ce.worldSize);if(Ms.tileMatrix.set(dt),Ms.shadowTileMatrix=Float32Array.from(Oe.calculateShadowPassMatrixFromMatrix(dt)),Ms.aabb.min.fill(0),Ms.aabb.max[0]=Ms.aabb.max[1]=s.J,Ms.aabb.max[2]=0,Ny(He,Ms,re,be.scope))continue}const lt=1<<ut.canonical.z,Qe=[((fe.x-ut.wrap)*lt-ut.canonical.x)*s.J,(fe.y*lt-ut.canonical.y)*s.J,fe.z*lt*s.J];for(let dt in He.instancesPerModel){const ye=He.instancesPerModel[dt];ye.features.length>0&&(dt=Be.evaluate(ye.features[0].feature,{}));const $e=Ce.getModel(dt,be.scope);if($e&&$e.uploaded)for(const St of $e.nodes)lh(re,be,St,ye,Qe,ut,Ms)}}}(_,c,f,v),void L();if(!F.loaded())return;if(F.type==="batched-model")return function(re,de,be,Ee){const ce=re.context,fe=re.transform,Ce=re.style.fog,Oe=re.shadowRenderer;if(fe.projection.name!=="mercator")return void s.X(`Drawing 3D landmark models for ${fe.projection.name} projection is not yet implemented`);const Ae=re.transform.getFreeCameraOptions().position,Le=s.v.scale([],[Ae.x,Ae.y,Ae.z],re.transform.worldSize);s.v.negate(Le,Le);const ut=s.m.identity([]),He=s.c4(fe.center.lat,fe.zoom),Je=s.m.fromScaling([],[1,1,1/He]);s.m.translate(ut,ut,Le);const Be=be.paint.get("model-opacity"),lt=new s.b4(ce.gl.LEQUAL,s.b4.ReadWrite,re.depthRangeFor3D),Qe=new s.b4(ce.gl.LEQUAL,s.b4.ReadOnly,re.depthRangeFor3D),dt=function(ye,$e){for(const St of Ee){const pt=de.getTile(St).getBucket(be);if(!pt||!pt.uploaded)continue;let Xt=!1;Oe&&(Xt=Oe.getMaxCascadeForTile(St.toUnwrapped())===0);const Bt=fe.calculatePosMatrix(St.toUnwrapped(),fe.worldSize),nr=pt.modelTraits;for(const Wt of pt.getNodesInfo()){if(Wt.hiddenByReplacement||!Wt.node.meshes)continue;const cr=Wt.node,ur=re.renderPass==="light-beam",er=[...Bt],tr=Wt.evaluatedScale;let Yr=0;re.terrain&&cr.elevation&&(Yr=cr.elevation*re.terrain.exaggeration()),s.m.translate(er,er,[(cr.anchor?cr.anchor[0]:0)*(tr[0]-1),(cr.anchor?cr.anchor[1]:0)*(tr[1]-1),Yr]),tr!==s.c6&&s.m.scale(er,er,tr),s.m.multiply(er,er,cr.matrix);const Cr=s.m.multiply([],Je,er);s.m.multiply(Cr,ut,Cr);const kn=s.m.invert([],Cr);s.m.transpose(kn,kn),s.m.scale(kn,kn,ob);const gn=s.m.multiply([],fe.expandedFarZProjMatrix,er),Lo=nr&s.c8.HasMapboxMeshFeatures,As=Lo?0:Wt.evaluatedRMEA[0][2];for(let un=0;un<cr.meshes.length;++un){const Jr=cr.meshes[un],rn=un===cr.lightMeshIndex;if(rn){if(!ur&&!re.terrain&&re.shadowRenderer){re.currentLayer<re.firstLightBeamLayer&&(re.firstLightBeamLayer=re.currentLayer);continue}}else if(ur)continue;const Vn={defines:[]},Qi=[];em(Vn.defines,Qi,Jr,re),Lo||Vn.defines.push("DIFFUSE_SHADED"),Xt&&Vn.defines.push("SHADOWS_SINGLE_CASCADE");const Rn=re.renderPass==="shadow";if(Rn){ah(Jr,er,re,be);continue}let uo=null;if(Ce){const Hs=Dd(er,re.transform);if(uo=new Float32Array(Hs),fe.projection.name!=="globe"){const vn=Jr.aabb.min,Zs=Jr.aabb.max,[ga,$a]=Ce.getOpacityForBounds(Hs,vn[0],vn[1],Zs[0],Zs[1]);Vn.overrideFog=ga>=Bn||$a>=Bn}}const zo=re.getOrCreateProgram("model",Vn);!Rn&&Oe&&(Oe.useNormalOffset=!!Jr.normalBuffer,Oe.setupShadowsFromMatrix(er,zo,Oe.useNormalOffset)),re.uploadCommonUniforms(ce,zo,St.toUnwrapped(),uo);const ho=Jr.material,ks=ho.pbrMetallicRoughness;ks.metallicFactor=.9,ks.roughnessFactor=.5;const ja=ih(new Float32Array(gn),new Float32Array(Cr),new Float32Array(kn),re,Be,ks.baseColorFactor,ho.emissiveFactor,ks.metallicFactor,ks.roughnessFactor,ho,As,be);zo.draw(re,ce.gl.TRIANGLES,$e&&!rn?lt:Qe,s.b6.disabled,ye?rn||Be<1||Wt.hasTranslucentParts?s.a.alphaBlended:s.a.unblended:s.a.disabled,s.b5.backCCW,ja,be.id,Jr.vertexBuffer,Jr.indexBuffer,Jr.segments,be.paint,re.transform.zoom,void 0,Qi)}}}};(function(ye,$e,St,pt){const Xt=ye.terrain?ye.terrain.exaggeration():0,Bt=ye.transform.zoom;for(const nr of pt){const Wt=$e.getTile(nr).getBucket(St);Wt&&(ye.conflationActive&&Wt.updateReplacement(nr,ye.replacementSource),Wt.evaluateScale(ye,St),ye.terrain&&Xt>0&&Wt.elevationUpdate(ye.terrain,Xt,nr,St.source),Wt.needsReEvaluation(ye,Bt,St)&&Wt.evaluate(St))}})(re,de,be,Ee),Be===1?dt(!0,!0):(dt(!1,!0),dt(!0,!1))}(_,c,f,v),void L();const $=F.getModels(),Z=[],K=_.transform.getFreeCameraOptions().position,ee=s.v.scale([],[K.x,K.y,K.z],_.transform.worldSize);s.v.negate(ee,ee);const ne=[],oe=[];let ie=0;for(const re of $){const de=f.paint.get("model-rotation").constantOr(null),be=f.paint.get("model-scale").constantOr(null),Ee=f.paint.get("model-translation").constantOr(null);re.computeModelMatrix(_,de,be,Ee,!0,!0,!1);const ce=s.m.identity([]),fe=s.c4(re.position.lat,_.transform.zoom),Ce=s.m.fromScaling([],[1,1,1/fe]);s.m.translate(ce,ce,ee),Z.push({zScaleMatrix:Ce,negCameraPosMatrix:ce});for(const Oe of re.nodes)zy(_.transform,Oe,re.matrix,_.transform.expandedFarZProjMatrix,ie,ne,oe);ie++}if(ne.sort((re,de)=>de.depth-re.depth),_.renderPass!=="shadow"){if(w===1)for(const re of oe)Yl(re,_,f,Z[re.modelIndex],s.b6.disabled,_.colorModeForRenderPass());else{for(const re of oe)Yl(re,_,f,Z[re.modelIndex],s.b6.disabled,s.a.disabled);for(const re of oe)Yl(re,_,f,Z[re.modelIndex],_.stencilModeFor3D(),_.colorModeForRenderPass());_.resetStencilClippingMasks()}for(const re of ne)Yl(re,_,f,Z[re.modelIndex],s.b6.disabled,_.colorModeForRenderPass());L()}else{for(const re of oe)ah(re.mesh,re.nodeModelMatrix,_,f);for(const re of ne)ah(re.mesh,re.nodeModelMatrix,_,f);L()}}},jy={modelUpload:function(_,c,f){const v=c.getSource();if(!v.loaded())return;if(v.type==="vector"||v.type==="geojson")return void(_.modelManager&&_.modelManager.upload(_,f));if(v.type==="batched-model")return;const w=v.getModels();for(const S of w)S.upload(_.context)}};class sb{constructor(c,f,v,w){this.context=new In(c,f),this.transform=v,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._debugParams={showTerrainProxyTiles:!1},w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),this.setup(),this.numSublayers=s.bq.maxUnderzooming+s.bq.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new s.ca,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new nm(this),this._wireframeDebugCache=new qc,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(c,f){const v=!!c&&!!c.terrain&&this.transform.projection.supportsTerrain;if(!(v||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Bp(this,c));const w=this._terrain;this.transform.elevation=v?w:null,w.update(c,this.transform,f),this.transform.elevation&&!w.enabled&&(this.transform.elevation=null)}_updateFog(c){const f=c.fog;if(!f||this.transform.projection.name==="globe"||f.getOpacity(this.transform.pitch)<1||f.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[v,w]=f.getFovAdjustedRange(this.transform._fov);if(v>w)return void(this.transform.fogCullDistSq=null);const S=v+.78*(w-v);this.transform.fogCullDistSq=S*S}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(c,f){if(this.width=c*s.a4.devicePixelRatio,this.height=f*s.a4.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const v of this.style.order)this.style._mergedLayers[v].resize()}setup(){const c=this.context,f=new s.bo;f.emplaceBack(0,0),f.emplaceBack(s.J,0),f.emplaceBack(0,s.J),f.emplaceBack(s.J,s.J),this.tileExtentBuffer=c.createVertexBuffer(f,s.bl.members),this.tileExtentSegments=s.bm.simpleSegment(0,0,4,2);const v=new s.bo;v.emplaceBack(0,0),v.emplaceBack(s.J,0),v.emplaceBack(0,s.J),v.emplaceBack(s.J,s.J),this.debugBuffer=c.createVertexBuffer(v,s.bl.members),this.debugSegments=s.bm.simpleSegment(0,0,4,5);const w=new s.bo;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=c.createVertexBuffer(w,s.bl.members),this.viewportSegments=s.bm.simpleSegment(0,0,4,2);const S=new s.cb;S.emplaceBack(0,0,0,0),S.emplaceBack(s.J,0,s.J,0),S.emplaceBack(0,s.J,0,s.J),S.emplaceBack(s.J,s.J,s.J,s.J),this.mercatorBoundsBuffer=c.createVertexBuffer(S,s.cc.members),this.mercatorBoundsSegments=s.bm.simpleSegment(0,0,4,2);const M=new s.bp;M.emplaceBack(0,1,2),M.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=c.createIndexBuffer(M);const k=new s.cd;for(const F of[0,1,3,2,0])k.emplaceBack(F);this.debugIndexBuffer=c.createIndexBuffer(k),this.emptyTexture=new s.a9(c,new s.a5({width:1,height:1},Uint8Array.of(0,0,0,0)),c.gl.RGBA),this.identityMat=s.m.create();const L=this.context.gl;this.stencilClearMode=new s.b6({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(c){return c._makeTileBoundsBuffers(this.context,this.transform.projection),c._tileBoundsBuffer?{tileBoundsBuffer:c._tileBoundsBuffer,tileBoundsIndexBuffer:c._tileBoundsIndexBuffer,tileBoundsSegments:c._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const c=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,c.TRIANGLES,s.b4.disabled,this.stencilClearMode,s.a.disabled,s.b5.disabled,vd(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(c,f,v){if(!f||this.currentStencilSource===f.id||!c.isTileClipped()||!v||v.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let k=!1;for(const L of v)if(this._tileClippingMaskIDs[L.key]===void 0){k=!0;break}if(!k)return}this.currentStencilSource=f.id;const w=this.context,S=w.gl;this.nextStencilID+v.length>256&&this.clearStencil(),w.setColorMode(s.a.disabled),w.setDepthMode(s.b4.disabled);const M=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const k of v){const L=f.getTile(k),F=this._tileClippingMaskIDs[k.key]=this.nextStencilID++,{tileBoundsBuffer:$,tileBoundsIndexBuffer:Z,tileBoundsSegments:K}=this.getTileBoundsBuffers(L);M.draw(this,S.TRIANGLES,s.b4.disabled,new s.b6({func:S.ALWAYS,mask:0},F,255,S.KEEP,S.KEEP,S.REPLACE),s.a.disabled,s.b5.disabled,vd(k.projMatrix),"$clipping",$,Z,K)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const c=this.nextStencilID++,f=this.context.gl;return new s.b6({func:f.NOTEQUAL,mask:255},c,255,f.KEEP,f.KEEP,f.REPLACE)}stencilModeForClipping(c){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(c);const f=this.context.gl;return new s.b6({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[c.key],0,f.KEEP,f.KEEP,f.REPLACE)}stencilConfigForOverlap(c){const f=this.context.gl,v=c.sort((M,k)=>k.overscaledZ-M.overscaledZ),w=v[v.length-1].overscaledZ,S=v[0].overscaledZ-w+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();const M={};for(let k=0;k<S;k++)M[k+w]=new s.b6({func:f.GEQUAL,mask:255},k+this.nextStencilID,255,f.KEEP,f.KEEP,f.REPLACE);return this.nextStencilID+=S,[M,v]}return[{[w]:s.b6.disabled},v]}colorModeForRenderPass(){const c=this.context.gl;return this._showOverdrawInspector?new s.a([c.CONSTANT_COLOR,c.ONE,c.CONSTANT_COLOR,c.ONE],new s.C(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?s.a.unblended:s.a.alphaBlended}colorModeForDrapableLayerRenderPass(c){const f=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new s.a([f.ONE,f.ONE_MINUS_SRC_ALPHA,f.CONSTANT_ALPHA,f.ONE_MINUS_SRC_ALPHA],new s.C(0,0,0,c===void 0?0:c),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(c,f,v,w=!1){if(!this.opaquePassEnabledForLayer()&&!w)return s.b4.disabled;const S=1-((1+this.currentLayer)*this.numSublayers+c)*this.depthEpsilon;return new s.b4(v||this.context.gl.LEQUAL,f,[S,S])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(c,f){this._wireframeDebugCache.update(this.frameCounter),this.style=c,this.options=f;const v=this.style._mergedLayers,w=this.style.order,S=w.map(ce=>v[ce]),M=this.style._mergedSourceCaches;this.imageManager=c.imageManager,this.modelManager=c.modelManager,this.symbolFadeChange=c.placement.symbolFadeChange(s.a4.now()),this.imageManager.beginFrame();let k=0,L=!1;for(const ce in M){const fe=M[ce];fe.used&&(fe.prepare(this.context),fe.getSource().usedInConflation&&++k)}const F={},$={},Z={},K={},ee={};for(const ce in M){const fe=M[ce];F[ce]=fe.getVisibleCoordinates(),$[ce]=F[ce].slice().reverse(),Z[ce]=fe.getVisibleCoordinates(!0).reverse(),K[ce]=fe.getShadowCasterCoordinates(),ee[ce]=fe.sortCoordinatesByDistance(F[ce])}const ne=ce=>{const fe=this.style.getLayerSourceCache(ce);return fe&&fe.used?fe.getSource():null};if(k){const ce=[];for(const fe of S)this.layerUsedInConflation(fe,ne(fe))&&ce.push(fe);if(ce&&ce.length>1){const fe=[];for(const Ce of ce){const Oe=this.style.getLayerSourceCache(Ce);Oe&&Oe.used&&Oe.getSource().usedInConflation&&fe.push({layer:Ce.fqid,cache:Oe})}this.replacementSource.setSources(fe),L=!0}}L||this.replacementSource.clear(),this.conflationActive=L,this.minCutoffZoom=0,this.longestCutoffRange=0;for(const ce of S){const fe=ce.cutoffRange();if(this.longestCutoffRange=Math.max(fe,this.longestCutoffRange),fe>0){const Ce=ne(ce);Ce&&(this.minCutoffZoom=Math.max(Ce.minzoom,this.minCutoffZoom)),ce.minzoom&&(this.minCutoffZoom=Math.max(ce.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let ce=0;ce<S.length;ce++)if(S[ce].is3D()){this.opaquePassCutoff=ce;break}const oe=this.style&&this.style.fog;oe?(this._fogVisible=oe.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=oe.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(Z),this.opaquePassCutoff=0);const ie=this._shadowRenderer;if(ie){ie.updateShadowParameters(this.transform,this.style.directionalLight);for(const ce in M)for(const fe of F[ce]){let Ce={min:0,max:0};this.terrain&&(Ce=this.terrain.getMinMaxForTile(fe)||Ce),ie.addShadowReceiver(fe.toUnwrapped(),Ce.min,Ce.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new s.ce(this.context));for(const ce of S){if(ce.isHidden(this.transform.zoom))continue;const fe=c.getLayerSourceCache(ce);this.uploadLayer(this,ce,fe)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new rb(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!s.cf(this.context.gl))return;this.renderPass="offscreen";for(const ce of S){const fe=c.getLayerSourceCache(ce);if(!ce.hasOffscreenPass()||ce.isHidden(this.transform.zoom))continue;const Ce=fe?$[fe.id]:void 0;(ce.type==="custom"||ce.type==="raster"||ce.isSky()||Ce&&Ce.length)&&this.renderLayer(this,fe,ce,Ce)}this.depthRangeFor3D=[0,1-(S.length+2)*this.numSublayers*this.depthEpsilon];const re=this.terrain;re&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&re.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,K)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const de=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),be=(()=>{if(f.showOverdrawInspector)return s.C.black;if(this.style.fog&&this.transform.projection.supportsFog&&!de){const ce=this.style.fog.properties.get("color").toArray01();return new s.C(...ce)}if(this.style.fog&&this.transform.projection.supportsFog&&de){const ce=this.style.fog.properties.get("space-color").toArray01();return new s.C(...ce)}return s.C.transparent})();if(this.context.clear({color:be,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&de&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=w.length-1;this.currentLayer>=0;this.currentLayer--){const ce=S[this.currentLayer],fe=c.getLayerSourceCache(ce);if(ce.isSky())continue;const Ce=fe?(ce.is3D()?ee:$)[fe.id]:void 0;this._renderTileClippingMasks(ce,fe,Ce),this.renderLayer(this,fe,ce,Ce)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&de&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||s.ao(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<w.length;this.currentLayer++){const ce=S[this.currentLayer],fe=c.getLayerSourceCache(ce);ce.isSky()&&this.renderLayer(this,fe,ce,fe?$[fe.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let Ee=0;for(ie&&(Ee=ie.getShadowCastingLayerCount());this.currentLayer<w.length;){const ce=S[this.currentLayer],fe=c.getLayerSourceCache(ce);if(ce.isSky()){++this.currentLayer;continue}if(re&&this.style.isLayerDraped(ce)){if(ce.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=re.renderBatch(this.currentLayer);continue}let Ce;if(fe&&(Ce=(ce.type==="symbol"?Z:ce.is3D()?ee:$)[fe.id]),this._renderTileClippingMasks(ce,fe,fe?F[fe.id]:void 0),this.renderLayer(this,fe,ce,Ce),!re&&ie&&Ee>0&&ce.hasShadowPass()&&--Ee==0&&(ie.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){const Oe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Oe;this.currentLayer++){const Ae=S[this.currentLayer];if(!Ae.hasLightBeamPass())continue;const Le=c.getLayerSourceCache(Ae);this.renderLayer(this,Le,Ae,Le?$[Le.id]:void 0)}this.currentLayer=Oe,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let ce=null;S.forEach(fe=>{const Ce=c.getLayerSourceCache(fe);Ce&&!fe.isHidden(this.transform.zoom)&&Ce.getVisibleCoordinates().length&&(!ce||ce.getSource().maxzoom<Ce.getSource().maxzoom)&&(ce=Ce)}),ce&&this.options.showTileBoundaries&&tm.debug(this,ce,ce.getVisibleCoordinates(),s.C.red,!1)}this.terrain&&this._debugParams.showTerrainProxyTiles&&tm.debug(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new s.C(1,.8,.1,1),!0),this.options.showPadding&&function(ce){const fe=ce.transform.padding;Oy(ce,ce.transform.height-(fe.top||0),3,Zp),Oy(ce,fe.bottom||0,3,Xp),Gc(ce,fe.left||0,3,Yp),Gc(ce,ce.transform.width-(fe.right||0),3,Qp);const Ce=ce.transform.centerPoint;(function(Oe,Ae,Le,ut){hl(Oe,Ae-1,Le-10,2,20,ut),hl(Oe,Ae-10,Le-1,20,2,ut)})(ce,Ce.x,ce.transform.height-Ce.y,Py)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),L||(this.conflationActive=!1)}uploadLayer(c,f,v){this.gpuTimingStart(f),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(f.type)||c.terrain&&f.type==="custom")&&jy[`${f.type}Upload`]&&jy[`${f.type}Upload`](c,v,f.scope),this.gpuTimingEnd()}renderLayer(c,f,v,w){v.isHidden(this.transform.zoom)||(v.type==="background"||v.type==="sky"||v.type==="custom"||v.type==="model"||v.type==="raster"||w&&w.length)&&(this.id=v.id,this.gpuTimingStart(v),(!c.transform.projection.unsupportedLayers||!c.transform.projection.unsupportedLayers.includes(v.type)||c.terrain&&v.type==="custom")&&tm[v.type](c,f,v,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(c){if(!this.options.gpuTiming)return;const f=this.context.extTimerQuery,v=this.context.gl;let w=this.gpuTimers[c.id];w||(w=this.gpuTimers[c.id]={calls:0,cpuTime:0,query:v.createQuery()}),w.calls++,v.beginQuery(f.TIME_ELAPSED_EXT,w.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const c=this.context.extTimerQuery,f=this.context.gl,v=f.createQuery();this.deferredRenderGpuTimeQueries.push(v),f.beginQuery(c.TIME_ELAPSED_EXT,v)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const c=this.gpuTimers;return this.gpuTimers={},c}collectDeferredRenderGpuQueries(){const c=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],c}queryGpuTimers(c){const f={};for(const v in c){const w=c[v],S=this.context.extTimerQuery,M=S.getQueryParameter(w.query,this.context.gl.QUERY_RESULT)/1e6;S.deleteQueryEXT(w.query),f[v]=M}return f}queryGpuTimeDeferredRender(c){if(!this.options.gpuTimingDeferredRender)return 0;const f=this.context.extTimerQuery,v=this.context.gl;let w=0;for(const S of c)w+=f.getQueryParameter(S,v.QUERY_RESULT)/1e6,f.deleteQueryEXT(S);return w}translatePosMatrix(c,f,v,w,S){if(!v[0]&&!v[1])return c;const M=S?w==="map"?this.transform.angle:0:w==="viewport"?-this.transform.angle:0;if(M){const F=Math.sin(M),$=Math.cos(M);v=[v[0]*$-v[1]*F,v[0]*F+v[1]*$]}const k=[S?v[0]:s.ay(f,v[0],this.transform.zoom),S?v[1]:s.ay(f,v[1],this.transform.zoom),0],L=new Float32Array(16);return s.m.translate(L,c,k),L}saveTileTexture(c){const f=c.size[0],v=this._tileTextures[f];v?v.push(c):this._tileTextures[f]=[c]}getTileTexture(c){const f=this._tileTextures[c];return f&&f.length>0?f.pop():null}isPatternMissing(c,f){return c===null||c!==void 0&&!this.imageManager.getPattern(c.toString(),f)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(c,f,v){const w=v===void 0?this.terrain&&this.terrain.renderingToTexture:v,S=this.terrain&&this.terrain.exaggeration()===0,M=[];return this.style&&this.style.enable3dLights()&&(c==="globeRaster"||c==="terrainRaster"?(M.push("LIGHTING_3D_MODE"),M.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):w||M.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||M.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?M.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):M.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(M.push("TERRAIN"),this.linearFloatFilteringSupported()&&M.push("TERRAIN_DEM_FLOAT_FORMAT"),S&&M.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&M.push("GLOBE"),!this._fogVisible||w||f!==void 0&&!f||M.push("FOG","FOG_DITHERING"),w&&M.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&M.push("OVERDRAW_INSPECTOR"),M}getOrCreateProgram(c,f){this.cache=this.cache||{};const v=f&&f.defines||[],w=f&&f.config,S=this.currentGlobalDefines(c,f&&f.overrideFog,f&&f.overrideRtt).concat(v),M=Ed.cacheKey(Op[c],c,S,w);return this.cache[M]||(this.cache[M]=new Ed(this.context,c,Op[c],w,Iy[c],S)),this.cache[M]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const c=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(c.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new s.a9(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(c,f){if(this.style.enable3dLights()){const v=this.style.directionalLight,w=this.style.ambientLight;if(v&&w){const S=((M,k)=>{const L=M.properties.get("direction"),F=M.properties.get("color").toArray01(),$=M.properties.get("intensity"),Z=k.properties.get("color").toArray01(),K=k.properties.get("intensity"),ee=[L.x,L.y,L.z],ne=s.bv(Z,K),oe=s.bv(F,$);return{u_lighting_ambient_color:ne,u_lighting_directional_dir:ee,u_lighting_directional_color:oe,u_ground_radiance:Ey(ee,oe,ne)}})(v,w);f.setLightsUniformValues(c,S)}}}uploadCommonUniforms(c,f,v,w,S){if(this.uploadCommonLightUniforms(c,f),this.terrain&&this.terrain.renderingToTexture)return;const M=this.style.fog;if(M){const k=M.getOpacity(this.transform.pitch),L=((F,$,Z,K,ee,ne,oe,ie,re,de,be,Ee)=>{const ce=F.transform,fe=$.properties.get("color").toArray01();fe[3]=K;const Ce=F.frameCounter/1e3%1,[Oe,Ae]=$.properties.get("vertical-range");return{u_fog_matrix:Z?ce.calculateFogTileMatrix(Z):Ee||F.identityMat,u_fog_range:$.getFovAdjustedRange(ce._fov),u_fog_color:fe,u_fog_horizon_blend:$.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(Oe,Ae),Ae],u_fog_temporal_offset:Ce,u_frustum_tl:ee,u_frustum_tr:ne,u_frustum_br:oe,u_frustum_bl:ie,u_globe_pos:re,u_globe_radius:de,u_viewport:be,u_globe_transition:s.ao(ce.zoom),u_is_globe:+(ce.projection.name==="globe")}})(this,M,v,k,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*s.a4.devicePixelRatio,this.transform.height*s.a4.devicePixelRatio],w);f.setFogUniformValues(c,L)}S&&f.setCutoffUniformValues(c,S.uniformValues)}setTileLoadedFlag(c){this.tileLoaded=c}saveCanvasCopy(){const c=this.canvasCopy();c&&(this.frameCopies.push(c),this.tileLoaded=!1)}canvasCopy(){const c=this.context.gl,f=c.createTexture();return c.bindTexture(c.TEXTURE_2D,f),c.copyTexImage2D(c.TEXTURE_2D,0,c.RGBA,0,0,c.drawingBufferWidth,c.drawingBufferHeight,0),f}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const c=this.style&&this.style.fog;return!!c&&c.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const c=this._backgroundTiles,f=this._backgroundTiles={},v=this.transform.coveringTiles({tileSize:512});for(const w of v)f[w.key]=c[w.key]||new s.bt(w,512,this.transform.tileZoom,this);return f}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(c,f){return!(!c.is3D()||c.minzoom&&c.minzoom>this.transform.zoom||c.sourceLayer!=="building"&&(!f||f.type!=="batched-model"))}isTileAffectedByFog(c){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let f=this._cachedTileFogOpacities[c.key];return f||(this._cachedTileFogOpacities[c.key]=f=this.style.fog.getOpacityForTile(c)),f[0]>=Bn||f[1]>=Bn}}const Zo={cascadeCount:2,shadowMapResolution:2048};class ab{constructor(c,f){this.aabb=c,this.lastCascade=f}}class rm{add(c,f){const v=this.receivers[c.key];v!==void 0?(v.aabb.min[0]=Math.min(v.aabb.min[0],f.min[0]),v.aabb.min[1]=Math.min(v.aabb.min[1],f.min[1]),v.aabb.min[2]=Math.min(v.aabb.min[2],f.min[2]),v.aabb.max[0]=Math.max(v.aabb.max[0],f.max[0]),v.aabb.max[1]=Math.max(v.aabb.max[1],f.max[1]),v.aabb.max[2]=Math.max(v.aabb.max[2],f.max[2])):this.receivers[c.key]=new ab(f,null)}clear(){this.receivers={}}get(c){return this.receivers[c.key]}computeRequiredCascades(c,f,v){const w=s.c3.fromPoints(c.points);let S=0;for(const M in this.receivers){const k=this.receivers[M];if(!k||!w.intersectsAabb(k.aabb))continue;k.aabb.min=w.closestPoint(k.aabb.min),k.aabb.max=w.closestPoint(k.aabb.max);const L=k.aabb.getCorners();for(let F=0;F<v.length;F++){let $=!0;for(const Z of L){const K=[Z[0]*f,Z[1]*f,Z[2]];if(s.v.transformMat4(K,K,v[F].matrix),K[0]<-1||K[0]>1||K[1]<-1||K[1]>1){$=!1;break}}if(k.lastCascade=F,S=Math.max(S,F),$)break}}return S+1}}class nm{constructor(c){this.painter=c,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new rm,this._depthMode=new s.b4(c.context.gl.LEQUAL,s.b4.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1,c.tp.registerParameter(Zo,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),c.tp.registerParameter(Zo,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32})}destroy(){for(const c of this._cascades)c.texture.destroy(),c.framebuffer.destroy();this._cascades=[]}updateShadowParameters(c,f){const v=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!f||!f.properties)return;const w=f.properties.get("shadow-intensity");if(!f.shadowsEnabled()||w<=0||(this._shadowLayerCount=v.style.order.reduce((ne,oe)=>{const ie=v.style._mergedLayers[oe];return ne+(ie.hasShadowPass()&&!ie.isHidden(c.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;const S=v.context,M=Zo.shadowMapResolution,k=Zo.shadowMapResolution;if(this._cascades.length===0||Zo.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ne=0;ne<Zo.cascadeCount;++ne){const oe=v._shadowMapDebug,ie=S.gl,re=S.createFramebuffer(M,k,oe,"texture"),de=new s.a9(S,{width:M,height:k,data:null},ie.DEPTH_COMPONENT);if(re.depthAttachment.set(de.texture),oe){const be=new s.a9(S,{width:M,height:k,data:null},ie.RGBA);re.colorAttachment.set(be.texture)}this._cascades.push({framebuffer:re,texture:de,matrix:[],far:0,boundingSphereRadius:0,frustum:new s.F,scale:0})}}this.shadowDirection=im(f);let L=0;if(c.elevation){const ne=c.elevation,oe=[1e4,-1e4];ne.visibleDemTiles.filter(ie=>ie.dem).forEach(ie=>{const re=ie.dem.tree;oe[0]=Math.min(oe[0],re.minimums[0]),oe[1]=Math.max(oe[1],re.maximums[0])}),oe[0]!==1e4&&(L=(oe[1]-oe[0])*ne.exaggeration())}const F=1.5*c.cameraToCenterDistance,$=3*F,Z=new Float64Array(16);for(let ne=0;ne<this._cascades.length;++ne){const oe=this._cascades[ne];let ie=c.height/50,re=1;Zo.cascadeCount===1?re=$:ne===0?re=F:(ie=F,re=$);const[de,be]=$y(c,this.shadowDirection,ie,re,Zo.shadowMapResolution,L);oe.scale=c.scale,oe.matrix=de,oe.boundingSphereRadius=be,s.m.invert(Z,oe.matrix),oe.frustum=s.F.fromInvProjectionMatrix(Z,1,0,!0),oe.far=re}const K=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[K].far,this._cascades[K].far],this._uniformValues.u_shadow_intensity=w,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Zo.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Zo.shadowMapResolution,this._uniformValues.u_shadowmap_0=oo.ShadowMap0,this._uniformValues.u_shadowmap_1=oo.ShadowMap0+1,this._groundShadowTiles=v.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const ee=v.transform.elevation;for(const ne of this._groundShadowTiles){let oe={min:0,max:0};if(ee){const ie=ee.getMinMaxForTile(ne);ie&&(oe=ie)}this.addShadowReceiver(ne.toUnwrapped(),oe.min,oe.max)}}get enabled(){return this._enabled}set enabled(c){this._enabled=c}drawShadowPass(c,f){if(!this._enabled)return;const v=this.painter,w=v.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(v.transform.getFrustum(0),v.transform.worldSize,this._cascades),w.viewport.set([0,0,Zo.shadowMapResolution,Zo.shadowMapResolution]);for(let S=0;S<this._numCascadesToRender;++S){v.currentShadowCascade=S,w.bindFramebuffer.set(this._cascades[S].framebuffer.framebuffer),w.clear({color:s.C.white,depth:1});for(const M of c.order){const k=c._mergedLayers[M];if(!k.hasShadowPass()||k.isHidden(v.transform.zoom))continue;const L=c.getLayerSourceCache(k),F=L?f[L.id]:void 0;(k.type==="model"||F&&F.length)&&v.renderLayer(v,L,k,F)}}v.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;const c=this.painter,f=c.style,v=c.context,w=f.directionalLight,S=f.ambientLight;if(!w||!S)return;const M=[],k=ql(c,c.longestCutoffRange);k.shouldRenderCutoff&&M.push("RENDER_CUTOFF");const L=Rd(w,S),F=new s.b4(v.gl.LEQUAL,s.b4.ReadOnly,c.depthRangeFor3D);for(const $ of this._groundShadowTiles){const Z=$.toUnwrapped(),K=c.isTileAffectedByFog($),ee=c.getOrCreateProgram("groundShadow",{defines:M,overrideFog:K});this.setupShadows(Z,ee),c.uploadCommonUniforms(v,ee,Z,null,k);const ne={u_matrix:c.transform.calculateProjMatrix(Z),u_ground_shadow_factor:L};ee.draw(c,v.gl.TRIANGLES,F,s.b6.disabled,s.a.multiply,s.b5.disabled,ne,"ground_shadow",c.tileExtentBuffer,c.quadTriangleIndexBuffer,c.tileExtentSegments,{},c.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?s.a.unblended:s.a.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(c){const f=this.painter.transform,v=f.calculatePosMatrix(c,f.worldSize);return s.m.multiply(v,this._cascades[this.painter.currentShadowCascade].matrix,v),Float32Array.from(v)}calculateShadowPassMatrixFromMatrix(c){return s.m.multiply(c,this._cascades[this.painter.currentShadowCascade].matrix,c),Float32Array.from(c)}setupShadows(c,f,v,w=0){if(!this._enabled)return;const S=this.painter.transform,M=this.painter.context,k=M.gl,L=this._uniformValues,F=new Float64Array(16),$=S.calculatePosMatrix(c,S.worldSize);for(let Z=0;Z<this._cascades.length;Z++)s.m.multiply(F,this._cascades[Z].matrix,$),L[Z===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(F),M.activeTexture.set(k.TEXTURE0+oo.ShadowMap0+Z),this._cascades[Z].texture.bind(k.NEAREST,k.CLAMP_TO_EDGE);if(this.useNormalOffset=!!v,this.useNormalOffset){const Z=s.cg(c.canonical),K=2/S.tileSize*s.J/Zo.shadowMapResolution,ee=K*this._cascades[0].boundingSphereRadius,ne=K*this._cascades[this._cascades.length-1].boundingSphereRadius,oe=(v==="vector-tile"?1:3)/Math.pow(2,w-c.canonical.z-(1-S.zoom+Math.floor(S.zoom)));L.u_shadow_normal_offset=[Z,ee*oe,ne*oe],L.u_shadow_bias=[6e-5,.0012,.012]}else L.u_shadow_bias=[36e-5,.0012,.012];f.setShadowUniformValues(M,L)}setupShadowsFromMatrix(c,f,v=!1){if(!this._enabled)return;const w=this.painter.context,S=w.gl,M=this._uniformValues,k=new Float64Array(16);for(let L=0;L<Zo.cascadeCount;L++)s.m.multiply(k,this._cascades[L].matrix,c),M[L===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(k),w.activeTexture.set(S.TEXTURE0+oo.ShadowMap0+L),this._cascades[L].texture.bind(S.NEAREST,S.CLAMP_TO_EDGE);this.useNormalOffset=v,v?(M.u_shadow_normal_offset=[1,5,5],M.u_shadow_bias=[6e-5,.0012,.012]):M.u_shadow_bias=[36e-5,.0012,.012],f.setShadowUniformValues(w,M)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(c,f,v,w){if(w[2]>=0)return{};const S=function(L,F,$){const Z=$/(1<<L.canonical.z);return new s.c3([L.canonical.x*Z+L.wrap*$,L.canonical.y*Z+L.wrap*$,0],[(L.canonical.x+1)*Z+L.wrap*$,(L.canonical.y+1)*Z+L.wrap*$,F])}(c,f,v).getCorners(),M=f/-w[2];w[0]<0?(s.v.add(S[0],S[0],[w[0]*M,0,0]),s.v.add(S[3],S[3],[w[0]*M,0,0])):w[0]>0&&(s.v.add(S[1],S[1],[w[0]*M,0,0]),s.v.add(S[2],S[2],[w[0]*M,0,0])),w[1]<0?(s.v.add(S[0],S[0],[0,w[1]*M,0]),s.v.add(S[1],S[1],[0,w[1]*M,0])):w[1]>0&&(s.v.add(S[2],S[2],[0,w[1]*M,0]),s.v.add(S[3],S[3],[0,w[1]*M,0]));const k={};return k.vertices=S,k.planes=[ch(S[1],S[0],S[4]),ch(S[2],S[1],S[5]),ch(S[3],S[2],S[6]),ch(S[0],S[3],S[7])],k}addShadowReceiver(c,f,v){this._receivers.add(c,s.c3.fromTileIdAndHeight(c,f,v))}getMaxCascadeForTile(c){const f=this._receivers.get(c);return f&&f.lastCascade?f.lastCascade:0}}function ch(_,c,f){const v=s.v.sub([],f,c),w=s.v.sub([],_,c),S=s.v.cross([],v,w),M=s.v.length(S);return M===0?[0,0,1,0]:(s.v.scale(S,S,1/M),[S[0],S[1],S[2],-s.v.dot(S,c)])}function im(_){const c=_.properties.get("direction"),f=s.b3(c.x,c.y,c.z);f[2]=s.c(f[2],0,75);const v=s.ch([f[0],f[1],f[2]]);return s.v.fromValues(v.x,v.y,v.z)}function Rd(_,c){const f=_.properties.get("color"),v=_.properties.get("intensity"),w=_.properties.get("direction"),S=[w.x,w.y,w.z],M=c.properties.get("color"),k=c.properties.get("intensity"),L=Math.max(s.v.dot([0,0,1],S),0),F=[0,0,0];s.v.scale(F,M.toArray01Linear().slice(0,3),k);const $=[0,0,0];return s.v.scale($,f.toArray01Linear().slice(0,3),L*v),s.bw([F[0]>0?F[0]/(F[0]+$[0]):0,F[1]>0?F[1]/(F[1]+$[1]):0,F[2]>0?F[2]/(F[2]+$[2]):0])}function $y(_,c,f,v,w,S){const M=_.zoom,k=_.scale,L=_.worldSize,F=1/L,$=_.aspect,Z=Math.sqrt(1+$*$)*Math.tan(.5*_.fovX),K=Z*Z,ee=v-f,ne=v+f;let oe,ie;K>ee/ne?(oe=v,ie=v*Z):(oe=.5*ne*(1+K),ie=.5*Math.sqrt(ee*ee+2*(v*v+f*f)*K+ne*ne*K*K));const re=_.projection.pixelsPerMeter(_.center.lat,L),de=_._camera.getCameraToWorldMercator(),be=[0,0,-oe*F];s.v.transformMat4(be,be,de);let Ee=ie*F;const ce=_._edgeInsets;if(!(ce.left===0&&ce.top===0&&ce.right===0&&ce.bottom===0||ce.left===ce.right&&ce.top===ce.bottom)){const pt=_._camera.getWorldToCamera(_.worldSize,_.projection.zAxisUnit==="meters"?re:1),Xt=_._camera.getCameraToClipPerspective(_._fov,_.width/_.height,f,v);Xt[8]=2*-_.centerOffset.x/_.width,Xt[9]=2*_.centerOffset.y/_.height;const Bt=new Float64Array(16);s.m.mul(Bt,Xt,pt);const nr=new Float64Array(16);s.m.invert(nr,Bt);const Wt=s.F.fromInvProjectionMatrix(nr,L,M,!0);for(const cr of Wt.points){const ur=((fe=cr)[0]/=k,fe[1]/=k,fe[2]=s.b(fe[2],_._center.lat),fe);Ee=Math.max(Ee,s.v.len(s.v.subtract([],be,ur)))}}var fe;Ee*=w/(w-1);const Ce=Math.acos(c[2]),Oe=Math.atan2(-c[0],-c[1]),Ae=new Ii;Ae.position=be,Ae.setPitchBearing(Ce,Oe);const Le=Ae.getWorldToCamera(L,re),ut=Ee*L,He=Math.min(_._mercatorZfromZoom(17)*L*-2,-2*ut),Je=Ae.getCameraToClipOrthographic(-ut,ut,-ut,ut,He,(ut+S*re)/c[2]),Be=new Float64Array(16);s.m.multiply(Be,Je,Le);const lt=s.v.fromValues(Math.floor(1e6*be[0])/1e6*L,Math.floor(1e6*be[1])/1e6*L,0),Qe=.5*w,dt=[0,0,0];s.v.transformMat4(dt,lt,Be),s.v.scale(dt,dt,Qe);const ye=[Math.floor(dt[0]),Math.floor(dt[1]),Math.floor(dt[2])],$e=[0,0,0];s.v.sub($e,dt,ye),s.v.scale($e,$e,-1/Qe);const St=new Float64Array(16);return s.m.identity(St),s.m.translate(St,St,$e),s.m.multiply(Be,St,Be),[Be,ut]}class Uy extends s.a6{constructor(c){super(),this.requestManager=c,this.models={"":{}},this.numModelsLoading={}}loadModel(c,f){return s.aO(this.requestManager.transformRequest(f,s.a2.Model).url).then(v=>{if(!v)return;const w=s.aP(v),S=new s.aQ(c,void 0,void 0,w);return S.computeBoundsAndApplyParent(),S}).catch(v=>{this.fire(new s.a7(new Error(`Could not load model ${c} from ${f}: ${v.message}`)))})}load(c,f){this.models[f]||(this.models[f]={});const v=Object.keys(c);this.numModelsLoading[f]=(this.numModelsLoading[f]||0)+v.length;const w=[];for(const S of v)w.push(this.loadModel(S,c[S]));Promise.allSettled(w).then(S=>{for(let M=0;M<S.length;M++){const{status:k,value:L}=S[M];k==="fulfilled"&&L&&(this.models[f][v[M]]=L)}this.numModelsLoading[f]-=v.length,this.fire(new s.a8("data",{dataType:"style"}))}).catch(S=>{this.fire(new s.a7(new Error(`Could not load models: ${S.message}`)))})}isLoaded(){for(const c in this.numModelsLoading)if(this.numModelsLoading[c]>0)return!1;return!0}hasModel(c,f){return!!this.getModel(c,f)}getModel(c,f){return this.models[f]||(this.models[f]={}),this.models[f][c]}addModel(c,f,v){this.models[v]||(this.models[v]={}),this.hasModel(c,v)&&this.removeModel(c,v),this.load({[c]:this.requestManager.normalizeModelURL(f)},v)}addModels(c,f){const v={};for(const w in c)v[w]=this.requestManager.normalizeModelURL(c[w]);this.load(v,f)}removeModel(c,f){this.models[f]||(this.models[f]={});const v=this.models[f][c];delete this.models[f][c],v.destroy()}listModels(c){return this.models[c]||(this.models[c]={}),Object.keys(this.models[c])}upload(c,f){this.models[f]||(this.models[f]={});for(const v in this.models[f])this.models[f][v].upload(c.context)}}const Ql=(_,c)=>s.ai(_,c&&c.filter(f=>f.identifier!=="source.canvas")),Vy=s.p(mt,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),Gy=s.p(mt,["setCenter","setZoom","setBearing","setPitch"]),om={version:8,layers:[],sources:{}},fl={duration:300,delay:0},uh=new Set(["fill","line","background","hillshade","raster"]);class Is extends s.a6{constructor(c,f={}){super(),this.map=c,this.scope=f.scope||"",this.fragments=[],this.importDepth=f.importDepth||0,this.importsCache=f.importsCache||new Map,this.resolvedImports=f.resolvedImports||new Set,this.transition=s.ak({},fl),this._buildingIndex=new Es(this),this.crossTileSymbolIndex=new Ui,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=f.styleChanges||new se,this.dispatcher=f.dispatcher?f.dispatcher:new s.br(s.bs(),this),f.imageManager?this.imageManager=f.imageManager:(this.imageManager=new Kr,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=f.glyphManager?f.glyphManager:new s.cj(c._requestManager,f.localFontFamily?s.ck.all:f.localIdeographFontFamily?s.ck.ideographs:s.ck.none,f.localFontFamily||f.localIdeographFontFamily),f.modelManager?this.modelManager=f.modelManager:(this.modelManager=new Uy(c._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=f.configOptions?f.configOptions:new Map,this._configDependentLayers=f.configDependentLayers?f.configDependentLayers:new Set,this._config=f.config,this.dispatcher.broadcast("setReferrer",s.cl());const v=this;this._rtlTextPluginCallback=Is.registerForPluginStateChange(w=>{v.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(S,M)=>{if(s.cm(S),M&&M.every(k=>k))for(const k in v._sourceCaches){const L=v._sourceCaches[k],F=L.getSource().type;F!=="vector"&&F!=="geojson"||L.reload()}})}),this.on("data",w=>{if(w.dataType!=="source"||w.sourceDataType!=="metadata")return;const S=this.getOwnSource(w.sourceId);if(S&&S.vectorLayerIds)for(const M in this._layers){const k=this._layers[M];k.source===S.id&&this._validateLayer(k)}})}loadURL(c,f={}){this.fire(new s.a8("dataloading",{dataType:"style"}));const v=typeof f.validate=="boolean"?f.validate:!s.cn(c);c=this.map._requestManager.normalizeStyleURL(c,f.accessToken),this.resolvedImports.add(c);const w=this.importsCache.get(c);if(w)return this._load(w,v);const S=this.map._requestManager.transformRequest(c,s.a2.Style);this._request=s.a1(S,(M,k)=>{if(this._request=null,M)this.fire(new s.a7(M));else if(k)return this.importsCache.set(c,k),this._load(k,v)})}loadJSON(c,f={}){this.fire(new s.a8("dataloading",{dataType:"style"})),this._request=s.a4.frame(()=>{this._request=null,this._load(c,f.validate!==!1)})}loadEmpty(){this.fire(new s.a8("dataloading",{dataType:"style"})),this._load(om,!1)}_loadImports(c,f){if(this.importDepth>=4)return s.X("Style doesn't support nesting deeper than 5"),Promise.resolve();const v=[];for(const w of c){const S=this._createFragmentStyle(w),M=new Promise(L=>{S.once("style.import.load",L),S.once("error",L)}).then(()=>this.mergeAll());if(v.push(M),this.resolvedImports.has(w.url)){S.loadEmpty();continue}const k=w.data||this.importsCache.get(w.url);k?S.loadJSON(k,{validate:f}):w.url?S.loadURL(w.url,{validate:f}):S.loadEmpty(),this.fragments.push({style:S,id:w.id,config:w.config})}return Promise.allSettled(v)}_createFragmentStyle(c){const f=this.scope?s.aE(c.id,this.scope):c.id,v=new Is(this.map,{scope:f,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:c.config,configOptions:this.options,configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});const c=this.isRootStyle();this._shouldPrecompile=c,this.fire(new s.a8(c?"style.load":"style.import.load"))}_load(c,f){const v=c.schema;if(this.isRootStyle()&&(c.fragment||v&&c.fragment!==!1)){const M=s.ak({},om,{imports:[{id:"basemap",data:c,url:""}]});return void this._load(M,f)}if(this.setConfig(this._config,v),f&&Ql(this,s.aj(c)))return;this._loaded=!0,this.stylesheet=s.co(c);for(const M in c.sources)this.addSource(M,c.sources[M],{validate:!1,isInitialLoad:!0});c.sprite?this._loadSprite(c.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(c.glyphs,this.scope);const w=co(this.stylesheet.layers);if(this._order=w.map(M=>M.id),this.stylesheet.light&&s.X("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const M=this.stylesheet.lights[0];this.light=new Zn(M.properties,M.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Zn(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(const M of w){const k=s.cp(M,this.scope,this.options);k.isConfigDependent&&this._configDependentLayers.add(k.fqid),k.setEventedParent(this,{layer:{id:k.id}}),this._layers[k.id]=k,this._serializedLayers[k.id]=k.serialize();const L=this.getOwnLayerSourceCache(k),F=!!this.directionalLight&&this.directionalLight.shadowsEnabled();L&&k.canCastShadows()&&F&&(L.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);const S=this.stylesheet.terrain;S&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=s.a4.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?s.X("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(S,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new s.a8("data",{dataType:"style"})),c.imports?this._loadImports(c.imports,f).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let c,f,v,w,S,M,k,L;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(F=>{if(F.stylesheet){if(F.light!=null&&(c=F.light),F.stylesheet.lights)for(const $ of F.stylesheet.lights)$.type==="ambient"&&F.ambientLight!=null&&(f=F.ambientLight),$.type==="directional"&&F.directionalLight!=null&&(v=F.directionalLight);w=this._prioritizeTerrain(w,F.terrain,F.stylesheet.terrain),F.stylesheet.fog&&F.fog!=null&&(S=F.fog),F.stylesheet.camera!=null&&(L=F.stylesheet.camera),F.stylesheet.projection!=null&&(M=F.stylesheet.projection),F.stylesheet.transition!=null&&(k=F.stylesheet.transition)}}),this.light=c,this.ambientLight=f,this.directionalLight=v,this.fog=S,w===null?delete this.terrain:this.terrain=w,this.camera=L||{"camera-projection":"perspective"},this.projection=M||{name:"mercator"},this.transition=s.ak({},fl,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(c){const f=v=>{for(const w of v.fragments)f(w.style);c(v)};f(this)}_prioritizeTerrain(c,f,v){const w=c&&c.drapeRenderMode===0;return v===null?f&&f.drapeRenderMode===0?f:w?c:null:f!=null&&(!c||w||f&&f.drapeRenderMode===1)?f:c}mergeTerrain(){let c;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(f=>{c=this._prioritizeTerrain(c,f.terrain,f.stylesheet.terrain)}),c===null?delete this.terrain:this.terrain=c}mergeProjection(){let c;this.forEachFragmentStyle(f=>{f.stylesheet.projection!=null&&(c=f.stylesheet.projection)}),this.projection=c||{name:"mercator"}}mergeSources(){const c={},f={},v={};this.forEachFragmentStyle(w=>{for(const S in w._sourceCaches){const M=s.aE(S,w.scope);c[M]=w._sourceCaches[S]}for(const S in w._otherSourceCaches){const M=s.aE(S,w.scope);f[M]=w._otherSourceCaches[S]}for(const S in w._symbolSourceCaches){const M=s.aE(S,w.scope);v[M]=w._symbolSourceCaches[S]}}),this._mergedSourceCaches=c,this._mergedOtherSourceCaches=f,this._mergedSymbolSourceCaches=v}mergeLayers(){const c={},f=[],v={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(S=>{for(const M of S._order){const k=S._layers[M];if(k.type==="slot"){const L=s.cq(M);if(c[L])continue;c[L]=[]}k.slot&&c[k.slot]?c[k.slot].push(k):f.push(k)}}),this._mergedOrder=[];const w=(S=[])=>{for(const M of S)if(M.type==="slot"){const k=s.cq(M.id);c[k]&&w(c[k])}else{const k=s.aE(M.id,M.scope);this._mergedOrder.push(k),v[k]=M,M.is3D()&&(this._has3DLayers=!0),M.type==="circle"&&(this._hasCircleLayers=!0),M.type==="symbol"&&(this._hasSymbolLayers=!0)}};w(f),this._mergedLayers=v,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(c){return this.stylesheet.camera=s.ak({},this.stylesheet.camera,c),this.camera=this.stylesheet.camera,this}setProjection(c){c?this.stylesheet.projection=c:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(c){this._spriteRequest=function(f,v,w){let S,M,k;const L=s.a4.devicePixelRatio>1?"@2x":"";let F=s.a1(v.transformRequest(v.normalizeSpriteURL(f,L,".json"),s.a2.SpriteJSON),(K,ee)=>{F=null,k||(k=K,S=ee,Z())}),$=s.a3(v.transformRequest(v.normalizeSpriteURL(f,L,".png"),s.a2.SpriteImage),(K,ee)=>{$=null,k||(k=K,M=ee,Z())});function Z(){if(k)w(k);else if(S&&M){const K=s.a4.getImageData(M),ee={};for(const ne in S){const{width:oe,height:ie,x:re,y:de,sdf:be,pixelRatio:Ee,stretchX:ce,stretchY:fe,content:Ce}=S[ne],Oe=new s.a5({width:oe,height:ie});s.a5.copy(K,Oe,{x:re,y:de},{x:0,y:0},{width:oe,height:ie}),ee[ne]={data:Oe,pixelRatio:Ee,sdf:be,stretchX:ce,stretchY:fe,content:Ce}}w(null,ee)}}return{cancel(){F&&(F.cancel(),F=null),$&&($.cancel(),$=null)}}}(c,this.map._requestManager,(f,v)=>{if(this._spriteRequest=null,f)this.fire(new s.a7(f));else if(v)for(const w in v)this.imageManager.addImage(w,this.scope,v[w]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new s.a8("data",{dataType:"style"}))})}_validateLayer(c){const f=this.getOwnSource(c.source);if(!f)return;const v=c.sourceLayer;v&&(f.type==="geojson"||f.vectorLayerIds&&f.vectorLayerIds.indexOf(v)===-1)&&this.fire(new s.a7(new Error(`Source layer "${v}" does not exist on source "${f.id}" as specified by style layer "${c.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const c in this._sourceCaches)if(!this._sourceCaches[c].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(const{style:c}of this.fragments)if(!c.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((c,f)=>{const v=this.fragments[f];return v&&v.style&&(c.data=v.style.serialize()),c})}_serializeSources(){const c={};for(const f in this._sourceCaches){const v=this._sourceCaches[f].getSource();c[v.id]||(c[v.id]=v.serialize())}return c}_serializeLayers(c){const f=[];for(const v of c){const w=this._layers[v];w&&w.type!=="custom"&&f.push(w.serialize())}return f}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(const c in this._sourceCaches)if(this._sourceCaches[c].hasTransition())return!0;for(const c in this._layers)if(this._layers[c].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(c){return!!this.terrain&&(typeof c.isLayerDraped=="function"?c.isLayerDraped(this.getLayerSourceCache(c)):uh.has(c.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(c){const f=this.getOwnLayer(c);if(f)return f;this.fire(new s.a7(new Error(`The layer '${c}' does not exist in the map's style.`)))}_checkSource(c){const f=this.getOwnSource(c);if(f)return f;this.fire(new s.a7(new Error(`The source '${c}' does not exist in the map's style.`)))}update(c){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(c),this.directionalLight&&this.directionalLight.recalculate(c);const f=this.calculateLightsBrightness();c.brightness=f||0,f!==this._brightness&&(this._brightness=f,this.dispatcher.broadcast("setBrightness",f));const v=this._changes.isDirty();if(this._changes.isDirty()){const S=this._changes.getLayerUpdatesByScope();for(const M in S){const{updatedIds:k,removedIds:L}=S[M];(k||L)&&this._updateWorkerLayers(M,k,L)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(c),this.light&&this.light.updateTransitions(c),this.ambientLight&&this.ambientLight.updateTransitions(c),this.directionalLight&&this.directionalLight.updateTransitions(c),this.fog&&this.fog.updateTransitions(c),this._changes.reset()}const w={};for(const S in this._mergedSourceCaches){const M=this._mergedSourceCaches[S];w[S]=M.used,M.used=!1}for(const S of this._mergedOrder){const M=this._mergedLayers[S];if(M.recalculate(c,this._availableImages),!M.isHidden(c.zoom)){const k=this.getLayerSourceCache(M);k&&(k.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let k=M.minzoom||0;k<(M.maxzoom||25.5);k++){const L=this.map.painter;if(L){const F=M.getProgramIds();if(!F)continue;for(const $ of F){const Z=M.getDefaultProgramParams($,c.zoom);Z&&(L.style=this,this.fog&&(L._fogVisible=!0,Z.overrideFog=!0,L.getOrCreateProgram($,Z)),L._fogVisible=!1,Z.overrideFog=!1,L.getOrCreateProgram($,Z),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(Z.overrideRtt=!0,L.getOrCreateProgram($,Z)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(const S in w){const M=this._mergedSourceCaches[S];w[S]!==M.used&&M.getSource().fire(new s.a8("data",{sourceDataType:"visibility",dataType:"source",sourceId:M.getSource().id}))}this.light&&this.light.recalculate(c),this.terrain&&this.terrain.recalculate(c),this.fog&&this.fog.recalculate(c),this.z=c.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),v&&this.fire(new s.a8("data",{dataType:"style"}))}_updateTilesForChangedImages(){const c=this._changes.getUpdatedImages();if(c.length){for(const f in this._sourceCaches)this._sourceCaches[f].reloadTilesForDependencies(["icons","patterns"],c);this._changes.resetUpdatedImages()}}_updateWorkerLayers(c,f,v){const w=this.getFragmentStyle(c);w&&this.dispatcher.broadcast("updateLayers",{layers:f?w._serializeLayers(f):[],scope:c,removedIds:v||[],options:w.options})}setState(c){if(this._checkLoaded(),Ql(this,s.aj(c)))return!1;(c=s.co(c)).layers=co(c.layers);const f=function(w,S){if(!w)return[{command:mt.setStyle,args:[S]}];let M=[];try{if(!I(w.version,S.version))return[{command:mt.setStyle,args:[S]}];I(w.center,S.center)||M.push({command:mt.setCenter,args:[S.center]}),I(w.zoom,S.zoom)||M.push({command:mt.setZoom,args:[S.zoom]}),I(w.bearing,S.bearing)||M.push({command:mt.setBearing,args:[S.bearing]}),I(w.pitch,S.pitch)||M.push({command:mt.setPitch,args:[S.pitch]}),I(w.sprite,S.sprite)||M.push({command:mt.setSprite,args:[S.sprite]}),I(w.glyphs,S.glyphs)||M.push({command:mt.setGlyphs,args:[S.glyphs]}),I(w.imports,S.imports)||function(Z=[],K=[],ee){K=K||[];const ne=(Z=Z||[]).map(Us),oe=K.map(Us),ie=Z.reduce(ls,{}),re=K.reduce(ls,{}),de=ne.slice();let be,Ee,ce,fe;for(be=0,Ee=0;be<ne.length;be++)ce=ne[be],re.hasOwnProperty(ce)?Ee++:(ee.push({command:mt.removeImport,args:[ce]}),de.splice(de.indexOf(ce,Ee),1));for(be=0,Ee=0;be<oe.length;be++)ce=oe[oe.length-1-be],de[de.length-1-be]!==ce&&(ie.hasOwnProperty(ce)?(ee.push({command:mt.removeImport,args:[ce]}),de.splice(de.lastIndexOf(ce,de.length-Ee),1)):Ee++,fe=de[de.length-be],ee.push({command:mt.addImport,args:[re[ce],fe]}),de.splice(de.length-be,0,ce));for(const Ce of K){const Oe=ie[Ce.id];if(!Oe||I(Oe,Ce))continue;I(Oe.config,Ce.config)||ee.push({command:mt.setImportConfig,args:[Ce.id,Ce.config]}),I(Oe.url,Ce.url)||ee.push({command:mt.setImportUrl,args:[Ce.id,Ce.url]});const Ae=Ce.data;I(Oe&&Oe.data,Ae)||ee.push({command:mt.setImportData,args:[Ce.id,Ae]})}}(w.imports,S.imports,M),I(w.transition,S.transition)||M.push({command:mt.setTransition,args:[S.transition]}),I(w.light,S.light)||M.push({command:mt.setLight,args:[S.light]}),I(w.fog,S.fog)||M.push({command:mt.setFog,args:[S.fog]}),I(w.projection,S.projection)||M.push({command:mt.setProjection,args:[S.projection]}),I(w.lights,S.lights)||M.push({command:mt.setLights,args:[S.lights]}),I(w.camera,S.camera)||M.push({command:mt.setCamera,args:[S.camera]});const k={},L=[];(function(Z,K,ee,ne){let oe;for(oe in K=K||{},Z=Z||{})Z.hasOwnProperty(oe)&&(K.hasOwnProperty(oe)||qr(oe,ee,ne));for(oe in K){if(!K.hasOwnProperty(oe))continue;const ie=K[oe];Z.hasOwnProperty(oe)?I(Z[oe],ie)||(Z[oe].type==="geojson"&&ie.type==="geojson"&&Ss(Z,K,oe)?ee.push({command:mt.setGeoJSONSourceData,args:[oe,ie.data]}):xo(oe,K,ee,ne)):Nr(oe,K,ee)}})(w.sources,S.sources,L,k);const F=[];w.layers&&w.layers.forEach(Z=>{Z.source&&k[Z.source]?M.push({command:mt.removeLayer,args:[Z.id]}):F.push(Z)});let $=w.terrain;$&&k[$.source]&&(M.push({command:mt.setTerrain,args:[void 0]}),$=void 0),M=M.concat(L),I($,S.terrain)||M.push({command:mt.setTerrain,args:[S.terrain]}),function(Z,K,ee){K=K||[];const ne=(Z=Z||[]).map(Us),oe=K.map(Us),ie=Z.reduce(ls,{}),re=K.reduce(ls,{}),de=ne.slice(),be=Object.create(null);let Ee,ce,fe,Ce,Oe,Ae,Le;for(Ee=0,ce=0;Ee<ne.length;Ee++)fe=ne[Ee],re.hasOwnProperty(fe)?ce++:(ee.push({command:mt.removeLayer,args:[fe]}),de.splice(de.indexOf(fe,ce),1));for(Ee=0,ce=0;Ee<oe.length;Ee++)fe=oe[oe.length-1-Ee],de[de.length-1-Ee]!==fe&&(ie.hasOwnProperty(fe)?(ee.push({command:mt.removeLayer,args:[fe]}),de.splice(de.lastIndexOf(fe,de.length-ce),1)):ce++,Ae=de[de.length-Ee],ee.push({command:mt.addLayer,args:[re[fe],Ae]}),de.splice(de.length-Ee,0,fe),be[fe]=!0);for(Ee=0;Ee<oe.length;Ee++)if(fe=oe[Ee],Ce=ie[fe],Oe=re[fe],!be[fe]&&!I(Ce,Oe))if(I(Ce.source,Oe.source)&&I(Ce["source-layer"],Oe["source-layer"])&&I(Ce.type,Oe.type)){for(Le in zr(Ce.layout,Oe.layout,ee,fe,null,mt.setLayoutProperty),zr(Ce.paint,Oe.paint,ee,fe,null,mt.setPaintProperty),I(Ce.slot,Oe.slot)||ee.push({command:mt.setSlot,args:[fe,Oe.slot]}),I(Ce.filter,Oe.filter)||ee.push({command:mt.setFilter,args:[fe,Oe.filter]}),I(Ce.minzoom,Oe.minzoom)&&I(Ce.maxzoom,Oe.maxzoom)||ee.push({command:mt.setLayerZoomRange,args:[fe,Oe.minzoom,Oe.maxzoom]}),Ce)Ce.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&Le!=="slot"&&(Le.indexOf("paint.")===0?zr(Ce[Le],Oe[Le],ee,fe,Le.slice(6),mt.setPaintProperty):I(Ce[Le],Oe[Le])||ee.push({command:mt.setLayerProperty,args:[fe,Le,Oe[Le]]}));for(Le in Oe)Oe.hasOwnProperty(Le)&&!Ce.hasOwnProperty(Le)&&Le!=="layout"&&Le!=="paint"&&Le!=="filter"&&Le!=="metadata"&&Le!=="minzoom"&&Le!=="maxzoom"&&Le!=="slot"&&(Le.indexOf("paint.")===0?zr(Ce[Le],Oe[Le],ee,fe,Le.slice(6),mt.setPaintProperty):I(Ce[Le],Oe[Le])||ee.push({command:mt.setLayerProperty,args:[fe,Le,Oe[Le]]}))}else ee.push({command:mt.removeLayer,args:[fe]}),Ae=de[de.lastIndexOf(fe)+1],ee.push({command:mt.addLayer,args:[Oe,Ae]})}(F,S.layers,M)}catch(k){console.warn("Unable to compute style diff:",k),M=[{command:mt.setStyle,args:[S]}]}return M}(this.serialize(),c).filter(w=>!(w.command in Gy));if(f.length===0)return!1;const v=f.filter(w=>!(w.command in Vy));if(v.length>0)throw new Error(`Unimplemented: ${v.map(w=>w.command).join(", ")}.`);return f.forEach(w=>{this[w.command].apply(this,w.args)}),this.stylesheet=c,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(c,f){return this.getImage(c)?this.fire(new s.a7(new Error("An image with this name already exists."))):(this.imageManager.addImage(c,this.scope,f),this._afterImageUpdated(c),this)}updateImage(c,f){this.imageManager.updateImage(c,this.scope,f)}getImage(c){return this.imageManager.getImage(c,this.scope)}removeImage(c){return this.getImage(c)?(this.imageManager.removeImage(c,this.scope),this._afterImageUpdated(c),this):this.fire(new s.a7(new Error("No image with this name exists.")))}_afterImageUpdated(c){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(c),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new s.a8("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(c,f,v={}){return this._checkLoaded(),this._validate(s.cr,`models.${c}`,f,null,v)||(this.modelManager.addModel(c,f,this.scope),this._changes.setDirty()),this}hasModel(c){return this.modelManager.hasModel(c,this.scope)}removeModel(c){return this.hasModel(c)?(this.modelManager.removeModel(c,this.scope),this):this.fire(new s.a7(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(c,f,v={}){if(this._checkLoaded(),this.getOwnSource(c)!==void 0)throw new Error(`There is already a source with ID "${c}".`);if(!f.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(f).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(f.type)>=0&&this._validate(s.cs,`sources.${c}`,f,null,v))return;this.map&&this.map._collectResourceTiming&&(f.collectResourceTiming=!0);const w=yo(c,f,this.dispatcher,this);w.scope=this.scope,w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(w.id),source:w.serialize(),sourceId:w.id}));const S=M=>{const k=(M?"symbol:":"other:")+w.id,L=s.aE(k,this.scope),F=this._sourceCaches[k]=new s.bq(L,w,M);(M?this._symbolSourceCaches:this._otherSourceCaches)[w.id]=F,F.onAdd(this.map)};S(!1),f.type!=="vector"&&f.type!=="geojson"||S(!0),w.onAdd&&w.onAdd(this.map),v.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(c){this._checkLoaded();const f=this.getOwnSource(c);if(!f)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===c)return this.fire(new s.a7(new Error(`Source "${c}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===c)return this.fire(new s.a7(new Error(`Source "${c}" cannot be removed while terrain is using it.`)));const v=this.getOwnSourceCaches(c);for(const w of v){const S=s.cq(w.id);delete this._sourceCaches[S],this._changes.discardSourceCacheUpdate(w.id),w.fire(new s.a8("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles()}return delete this._otherSourceCaches[c],delete this._symbolSourceCaches[c],this.mergeSources(),f.setEventedParent(null),f.onRemove&&f.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(c,f){this._checkLoaded(),this.getOwnSource(c).setData(f),this._changes.setDirty()}getOwnSource(c){const f=this.getOwnSourceCache(c);return f&&f.getSource()}getOwnSources(){const c=[];for(const f in this._otherSourceCaches){const v=this.getOwnSourceCache(f);v&&c.push(v.getSource())}return c}areTilesLoaded(){const c=this._mergedSourceCaches;for(const f in c){const v=c[f]._tiles;for(const w in v){const S=v[w];if(S.state!=="loaded"&&S.state!=="errored")return!1}}return!0}setLights(c){if(this._checkLoaded(),!c)return delete this.ambientLight,void delete this.directionalLight;const f=this._getTransitionParameters();for(const w of c){if(this._validate(s.ct,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const S=this.ambientLight;S.set(w),S.updateTransitions(f)}else this.ambientLight=new bs(w,ws,this.scope,this.options);break;case"directional":if(this.directionalLight){const S=this.directionalLight;S.set(w),S.updateTransitions(f)}else this.directionalLight=new bs(w,jc,this.scope,this.options)}}const v=new s.al(this.z||0,f);this.ambientLight&&this.ambientLight.recalculate(v),this.directionalLight&&this.directionalLight.recalculate(v),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const c=this.directionalLight,f=this.ambientLight;if(!c||!f)return;const v=Z=>.2126*(Z[0]<=.03928?Z[0]/12.92:Math.pow((Z[0]+.055)/1.055,2.4))+.7152*(Z[1]<=.03928?Z[1]/12.92:Math.pow((Z[1]+.055)/1.055,2.4))+.0722*(Z[2]<=.03928?Z[2]/12.92:Math.pow((Z[2]+.055)/1.055,2.4)),w=c.properties.get("color").toArray01(),S=c.properties.get("intensity"),M=c.properties.get("direction"),k=1-s.b3(M.x,M.y,M.z)[2]/90,L=v(w)*S*k,F=f.properties.get("color").toArray01(),$=f.properties.get("intensity");return(L+v(F)*$)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const c=[];return this.directionalLight&&c.push(this.directionalLight.get()),this.ambientLight&&c.push(this.ambientLight.get()),c}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(c){if(!c)return this;if(s.cu(c)){const f=s.cv(c),v=this.fragments.find(({id:S})=>S===f);if(!v)throw new Error(`Style import not found: ${c}`);const w=s.cq(c);return v.style.getFragmentStyle(w)}{const f=this.fragments.find(({id:v})=>v===c);if(!f)throw new Error(`Style import not found: ${c}`);return f.style}}getConfigProperty(c,f){const v=this.getFragmentStyle(c);if(!v)return null;const w=s.aE(f,v.scope),S=v.options.get(w),M=S?S.value||S.default:null;return M?M.serialize():null}setConfigProperty(c,f,v){const w=s.cw(v);if(w.result!=="success")return void Ql(this,w.value);const S=w.value.expression,M=this.getFragmentStyle(c);if(!M)return;const k=s.aE(f,M.scope),L=M.options.get(k);L&&(this.options.set(k,{...L,value:S}),this.updateConfigDependencies())}setConfig(c,f){if(this._config=c,c||f)if(f)for(const v in f){let w,S;const M=s.cw(f[v].default);if(M.result==="success"&&(w=M.value.expression),c&&c[v]!==void 0){const K=s.cw(c[v]);K.result==="success"&&(S=K.value.expression)}const{minValue:k,maxValue:L,stepValue:F,type:$,values:Z}=f[v];if(w){const K=s.aE(v,this.scope);this.options.set(K,{default:w,value:S,minValue:k,maxValue:L,stepValue:F,type:$,values:Z})}else this.fire(new s.a7(new Error(`No schema defined for config option "${v}".`)))}else this.fire(new s.a7(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(const c of this._configDependentLayers){const f=this.getLayer(c);f&&(f.possiblyEvaluateVisibility(),this._updateLayer(f))}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(c,f,v={}){this._checkLoaded();const w=c.id;if(this._layers[w])return void this.fire(new s.a7(new Error(`Layer with id "${w}" already exists on this map`)));let S;if(c.type==="custom"){if(Ql(this,s.cx(c)))return;S=s.cp(c,this.scope,this.options)}else{if(typeof c.source=="object"&&(this.addSource(w,c.source),c=s.co(c),c=s.ak(c,{source:w})),this._validate(s.cy,`layers.${w}`,c,{arrayIndex:-1},v))return;S=s.cp(c,this.scope,this.options),this._validateLayer(S),S.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[S.id]=S.serialize()}S.isConfigDependent&&this._configDependentLayers.add(S.fqid);let M=this._order.length;if(f){const $=this._order.indexOf(f);if($===-1)return void this.fire(new s.a7(new Error(`Layer with id "${f}" does not exist on this map.`)));S.slot===this._layers[f].slot?M=$:s.X(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(M,0,w),this._layerOrderChanged=!0,this._layers[w]=S;const k=this.getOwnLayerSourceCache(S),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&S.canCastShadows()&&L&&(k.castsShadows=!0);const F=this._changes.getRemovedLayer(S);if(F&&S.source&&k&&S.type!=="custom"){this._changes.discardLayerRemoval(S);const $=s.aE(S.source,S.scope);F.type!==S.type?this._changes.updateSourceCache($,"clear"):(this._changes.updateSourceCache($,"reload"),k.pause())}this._updateLayer(S),S.onAdd&&S.onAdd(this.map),S.scope=this.scope,this.mergeLayers()}moveLayer(c,f){this._checkLoaded();const v=this._checkLayer(c);if(!v||c===f)return;const w=this._order.indexOf(c);this._order.splice(w,1);let S=this._order.length;if(f){const M=this._order.indexOf(f);if(M===-1)return void this.fire(new s.a7(new Error(`Layer with id "${f}" does not exist on this map.`)));v.slot===this._layers[f].slot?S=M:s.X(`Layer with id "${f}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,c),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(c){this._checkLoaded();const f=this._checkLayer(c);if(!f)return;f.setEventedParent(null);const v=this._order.indexOf(c);this._order.splice(v,1),delete this._layers[c],delete this._serializedLayers[c],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(f.fqid),this._changes.removeLayer(f);const w=this.getOwnLayerSourceCache(f);if(w&&w.castsShadows){let S=!1;for(const M in this._layers)if(this._layers[M].source===f.source&&this._layers[M].canCastShadows()){S=!0;break}w.castsShadows=S}f.onRemove&&f.onRemove(this.map),this.mergeLayers()}getOwnLayer(c){return this._layers[c]}hasLayer(c){return c in this._mergedLayers}hasLayerType(c){for(const f in this._layers)if(this._layers[f].type===c)return!0;return!1}setLayerZoomRange(c,f,v){this._checkLoaded();const w=this._checkLayer(c);w&&(w.minzoom===f&&w.maxzoom===v||(f!=null&&(w.minzoom=f),v!=null&&(w.maxzoom=v),this._updateLayer(w)))}setSlot(c,f){this._checkLoaded();const v=this._checkLayer(c);v&&v.slot!==f&&(v.slot=f,this._updateLayer(v))}setFilter(c,f,v={}){this._checkLoaded();const w=this._checkLayer(c);if(w&&!I(w.filter,f))return f==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(s.cz,`layers.${w.id}.filter`,f,{layerType:w.type},v)||(w.filter=s.co(f),this._updateLayer(w)))}getFilter(c){const f=this._checkLayer(c);if(f)return s.co(f.filter)}setLayoutProperty(c,f,v,w={}){this._checkLoaded();const S=this._checkLayer(c);S&&(I(S.getLayoutProperty(f),v)||(S.setLayoutProperty(f,v,w),S.isConfigDependent&&this._configDependentLayers.add(S.fqid),this._updateLayer(S)))}getLayoutProperty(c,f){const v=this._checkLayer(c);if(v)return v.getLayoutProperty(f)}setPaintProperty(c,f,v,w={}){this._checkLoaded();const S=this._checkLayer(c);if(!S||I(S.getPaintProperty(f),v))return;const M=S.setPaintProperty(f,v,w);S.isConfigDependent&&this._configDependentLayers.add(S.fqid),M&&this._updateLayer(S),this._changes.updatePaintProperties(S)}getPaintProperty(c,f){const v=this._checkLayer(c);if(v)return v.getPaintProperty(f)}setFeatureState(c,f){this._checkLoaded();const v=c.source,w=c.sourceLayer,S=this._checkSource(v);if(!S)return;const M=S.type;if(M==="geojson"&&w)return void this.fire(new s.a7(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(M==="vector"&&!w)return void this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));c.id===void 0&&this.fire(new s.a7(new Error("The feature id parameter must be provided.")));const k=this.getOwnSourceCaches(v);for(const L of k)L.setFeatureState(w,c.id,f)}removeFeatureState(c,f){this._checkLoaded();const v=c.source,w=this._checkSource(v);if(!w)return;const S=w.type,M=S==="vector"?c.sourceLayer:void 0;if(S==="vector"&&!M)return void this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")));if(f&&typeof c.id!="string"&&typeof c.id!="number")return void this.fire(new s.a7(new Error("A feature id is required to remove its specific state property.")));const k=this.getOwnSourceCaches(v);for(const L of k)L.removeFeatureState(M,c.id,f)}getFeatureState(c){this._checkLoaded();const f=c.source,v=c.sourceLayer,w=this._checkSource(f);if(w){if(w.type!=="vector"||v)return c.id===void 0&&this.fire(new s.a7(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(f)[0].getFeatureState(v,c.id);this.fire(new s.a7(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(c){return this.stylesheet.transition=s.ak({},this.stylesheet.transition,c),this.transition=this.stylesheet.transition,this}getTransition(){return s.ak({},this.stylesheet.transition)}serialize(){this._checkLoaded();const c=this.getTerrain(),f=c&&this.terrain&&this.terrain.scope===this.scope?c:this.stylesheet.terrain;return s.cA({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:f,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},v=>v!==void 0)}_updateLayer(c){this._changes.updateLayer(c);const f=this.getLayerSourceCache(c),v=s.aE(c.source,c.scope),w=this._changes.getUpdatedSourceCaches();c.source&&!w[v]&&f&&f.getSource().type!=="raster"&&(this._changes.updateSourceCache(v,"reload"),f.pause()),c.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(c){const f=k=>this._mergedLayers[k].type==="fill-extrusion",v=this.order,w={},S=[];for(let k=v.length-1;k>=0;k--){const L=v[k];if(f(L)){w[L]=k;for(const F of c){const $=F[L];if($)for(const Z of $)S.push(Z)}}}S.sort((k,L)=>L.intersectionZ-k.intersectionZ);const M=[];for(let k=v.length-1;k>=0;k--){const L=v[k];if(f(L))for(let F=S.length-1;F>=0;F--){const $=S[F].feature;if(w[$.layer.id]<k)break;M.push($),S.pop()}else for(const F of c){const $=F[L];if($)for(const Z of $)M.push(Z.feature)}}return M}queryRenderedFeatures(c,f,v){f&&f.filter&&this._validate(s.cz,"queryRenderedFeatures.filter",f.filter,null,f),f.scope=this.scope,f.availableImages=this._availableImages,f.serializedLayers=this._serializedLayers;const w={};if(f&&f.layers){if(!Array.isArray(f.layers))return this.fire(new s.a7(new Error("parameters.layers must be an Array."))),[];for(const F of f.layers){const $=this._mergedLayers[F];if(!$)return this.fire(new s.a7(new Error(`The layer '${F}' does not exist in the map's style and cannot be queried for features.`))),[];w[$.source]=!0}}const S=[],M=f.serializedLayers||{},k=f&&f.layers?f.layers.some(F=>{const $=this.getLayer(F);return $&&$.is3D()}):this.has3DLayers(),L=ji.createFromScreenPoints(c,v);for(const F in this._mergedSourceCaches){const $=this._mergedSourceCaches[F].getSource();if(!$||$.scope!==f.scope)continue;const Z=this._mergedSourceCaches[F].getSource().id;f.layers&&!w[Z]||S.push(as(this._mergedSourceCaches[F],this._mergedLayers,M,L,f,v,k,!!this.map._showQueryGeometry))}return this.placement&&S.push(function(F,$,Z,K,ee,ne,oe){const ie={},re=ne.queryRenderedSymbols(K),de=[];for(const be of Object.keys(re).map(Number))de.push(oe[be]);de.sort(vo);for(const be of de){const Ee=be.featureIndex.lookupSymbolFeatures(re[be.bucketInstanceId],$,be.bucketIndex,be.sourceLayerIndex,ee.filter,ee.layers,ee.availableImages,F);for(const ce in Ee){const fe=ie[ce]=ie[ce]||[],Ce=Ee[ce];Ce.sort((Oe,Ae)=>{const Le=be.featureSortOrder;if(Le){const ut=Le.indexOf(Oe.featureIndex);return Le.indexOf(Ae.featureIndex)-ut}return Ae.featureIndex-Oe.featureIndex});for(const Oe of Ce)fe.push(Oe)}}for(const be in ie)ie[be].forEach(Ee=>{const ce=Ee.feature,fe=Z(F[be]);if(!fe)return;const Ce=fe.getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=Ce});return ie}(this._mergedLayers,M,this.getLayerSourceCache.bind(this),L.screenGeometry,f,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(S)}querySourceFeatures(c,f){f&&f.filter&&this._validate(s.cz,"querySourceFeatures.filter",f.filter,null,f);const v=this.getOwnSourceCaches(c);let w=[];for(const S of v)w=w.concat(za(S,f));return w}addSourceType(c,f,v){return Is.getSourceType(c)?v(new Error(`A source type called "${c}" already exists.`)):(Is.setSourceType(c,f),f.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:c,url:f.workerSourceURL},v):v(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(c,f,v={}){this._checkLoaded();const w=this.light.getLight();let S=!1;for(const k in c)if(!I(c[k],w[k])){S=!0;break}if(!S)return;const M=this._getTransitionParameters();this.light.setLight(c,f,v),this.light.updateTransitions(M)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(c,f=1){if(this._checkLoaded(),!c)return delete this.terrain,c===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let v=c;const w=c.source==null;if(f===1){if(typeof v.source=="object"){const k="terrain-dem-src";this.addSource(k,v.source),v=s.co(v),v=s.ak(v,{source:k})}const S=s.ak({},v),M={};if(this.terrain&&w){S.source=this.terrain.get().source;const k=this.terrain?this.getFragmentStyle(this.terrain.scope):null;k&&(M.style=k.serialize())}if(this._validate(s.cB,"terrain",S,M))return}if(!this.terrain||this.terrain.scope!==this.scope&&!w||this.terrain&&f!==this.terrain.drapeRenderMode){if(!v)return;this._createTerrain(v,f),this.fire(new s.a8("data",{dataType:"style"}))}else{const S=this.terrain,M=S.get();for(const k of Object.keys(s.ae.terrain))!v.hasOwnProperty(k)&&s.ae.terrain[k].default&&(v[k]=s.ae.terrain[k].default);for(const k in c)if(!I(c[k],M[k])){S.set(c,this.options),this.stylesheet.terrain=c;const L=this._getTransitionParameters({duration:0});S.updateTransitions(L),this.fire(new s.a8("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(c){const f=this.fog=new io(c,this.map.transform);this.stylesheet.fog=f.get();const v=this._getTransitionParameters({duration:0});f.updateTransitions(v)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const c of this.map._markers)c._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(c){if(this._checkLoaded(),!c)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const f=this.fog;if(!I(f.get(),c)){f.set(c),this.stylesheet.fog=f.get();const v=this._getTransitionParameters({duration:0});f.updateTransitions(v)}}else this._createFog(c);this._markersNeedUpdate=!0}_getTransitionParameters(c){return{now:s.a4.now(),transition:s.ak(this.transition,c)}}updateDrapeFirstLayers(){if(!this.terrain)return;const c=[],f=[];for(const v in this._mergedLayers)this.isLayerDraped(this._mergedLayers[v])?c.push(v):f.push(v);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...c),this._drapedFirstOrder.push(...f)}_createTerrain(c,f){const v=this.terrain=new fi(c,f,this.scope,this.options);f===1&&(this.stylesheet.terrain=c),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const w=this._getTransitionParameters({duration:0});v.updateTransitions(w)}_force3DLayerUpdate(){for(const c in this._layers){const f=this._layers[c];f.type==="fill-extrusion"&&this._updateLayer(f)}}_forceSymbolLayerUpdate(){for(const c in this._layers){const f=this._layers[c];f.type==="symbol"&&this._updateLayer(f)}}_validate(c,f,v,w,S={}){if(S&&S.validate===!1)return!1;const M=s.ak({},this.serialize());return Ql(this,c.call(s.aj,s.ak({key:f,style:M,value:v,styleSpec:s.ae},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),s.cC.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._mergedLayers)this._mergedLayers[c].setEventedParent(null);for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].clearTiles(),this._mergedSourceCaches[c].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(c){const f=this.getSourceCaches(c);for(const v of f)v.clearTiles()}clearSources(){for(const c in this._mergedSourceCaches)this._mergedSourceCaches[c].clearTiles()}reloadSource(c){const f=this.getSourceCaches(c);for(const v of f)v.resume(),v.reload()}reloadSources(){for(const c of this.getSources())c.reload&&c.reload()}updateSources(c){let f;this.directionalLight&&(f=im(this.directionalLight));for(const v in this._mergedSourceCaches)this._mergedSourceCaches[v].update(c,void 0,void 0,f)}_generateCollisionBoxes(){for(const c in this._sourceCaches){const f=this._sourceCaches[c];f.resume(),f.reload()}}_updatePlacement(c,f,v,w,S=!1){let M=!1,k=!1;const L={},F={};for(const $ of this._mergedOrder){const Z=this._mergedLayers[$];if(Z.type!=="symbol")continue;const K=s.aE(Z.source,Z.scope);let ee=L[K];if(!ee){const oe=this.getLayerSourceCache(Z);if(!oe)continue;const ie=oe.getRenderableIds(!0).map(re=>oe.getTileByID(re));F[K]=ie.slice(),ee=L[K]=ie.sort((re,de)=>de.tileID.overscaledZ-re.tileID.overscaledZ||(re.tileID.isLessThan(de.tileID)?-1:1))}const ne=this.crossTileSymbolIndex.addLayer(Z,ee,c.center.lng,c.projection);M=M||ne}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),S=S||this._layerOrderChanged||v===0,this._layerOrderChanged&&this.fire(new s.a8("neworder")),(S||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(s.a4.now(),c.zoom))&&(this.pauseablePlacement=new Dt(c,this._mergedOrder,S,f,v,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,L,F),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(s.a4.now()),k=!0),M&&this.pauseablePlacement.placement.setStale()),k||M)for(const $ of this._mergedOrder){const Z=this._mergedLayers[$];Z.type==="symbol"&&this.placement.updateLayerOpacities(Z,L[s.aE(Z.source,Z.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(s.a4.now())}_releaseSymbolFadeTiles(){for(const c in this._sourceCaches)this._sourceCaches[c].releaseSymbolFadeTiles()}addImport(c){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];return f.findIndex(({id:v})=>v===c.id)!==-1?this.fire(new s.a7(new Error(`Import with id '${c.id}' already exists in the map's style.`))):(f.push(c),this._loadImports([c],!0),this)}setImportUrl(c,f){this._checkLoaded();const v=this.stylesheet.imports||[],w=this.getImportIndex(c);if(w===-1)return this;v[w].url=f;const S=this.fragments[w];return S.style=this._createFragmentStyle(v[w]),S.style.on("style.import.load",()=>this.mergeAll()),S.style.loadURL(f),this}setImportData(c,f){this._checkLoaded();const v=this.getImportIndex(c),w=this.stylesheet.imports||[];return v===-1?this:f?(this.fragments[v].style.setState(f),this._reloadImports(),this):(delete w[v].data,this.setImportUrl(c,w[v].url))}setImportConfig(c,f){this._checkLoaded();const v=this.getImportIndex(c),w=this.stylesheet.imports||[];if(v===-1)return this;f?w[v].config=f:delete w[v].config;const S=this.fragments[v],M=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=f,S.style.setConfig(f,M),this.updateConfigDependencies(),this}removeImport(c){this._checkLoaded();const f=this.stylesheet.imports||[],v=this.getImportIndex(c);return v===-1||(f.splice(v,1),this.fragments[v].style._remove(),this.fragments.splice(v,1),this._reloadImports()),this}getImportIndex(c){const f=(this.stylesheet.imports||[]).findIndex(v=>v.id===c);return f===-1&&this.fire(new s.a7(new Error(`Import '${c}' does not exist in the map's style and cannot be updated.`))),f}getLayer(c){return this._mergedLayers[c]}getSources(){const c=[];for(const f in this._mergedOtherSourceCaches){const v=this._mergedOtherSourceCaches[f];v&&c.push(v.getSource())}return c}getSource(c,f){const v=this.getSourceCache(c,f);return v&&v.getSource()}getLayerSource(c){const f=this.getLayerSourceCache(c);return f&&f.getSource()}getSourceCache(c,f){const v=s.aE(c,f);return this._mergedOtherSourceCaches[v]}getLayerSourceCache(c){const f=s.aE(c.source,c.scope);return c.type==="symbol"?this._mergedSymbolSourceCaches[f]:this._mergedOtherSourceCaches[f]}getSourceCaches(c){const f=[];return this._mergedOtherSourceCaches[c]&&f.push(this._mergedOtherSourceCaches[c]),this._mergedSymbolSourceCaches[c]&&f.push(this._mergedSymbolSourceCaches[c]),f}updateSourceCaches(){const c=this._changes.getUpdatedSourceCaches();for(const f in c){const v=c[f];v==="reload"?this.reloadSource(f):v==="clear"&&this.clearSource(f)}}updateLayers(c){const f=this._changes.getUpdatedPaintProperties();for(const v of f){const w=this.getLayer(v);w&&w.updateTransitions(c)}}getImages(c,f,v){this.imageManager.getImages(f.icons,f.scope,v),this._updateTilesForChangedImages();const w=S=>{S&&S.setDependencies(f.tileID.key,f.type,f.icons)};w(this._otherSourceCaches[f.source]),w(this._symbolSourceCaches[f.source])}getGlyphs(c,f,v){this.glyphManager.getGlyphs(f.stacks,f.scope,v)}getResource(c,f,v){return s.cD(f,v)}getOwnSourceCache(c){return this._otherSourceCaches[c]}getOwnLayerSourceCache(c){return c.type==="symbol"?this._symbolSourceCaches[c.source]:this._otherSourceCaches[c.source]}getOwnSourceCaches(c){const f=[];return this._otherSourceCaches[c]&&f.push(this._otherSourceCaches[c]),this._symbolSourceCaches[c]&&f.push(this._symbolSourceCaches[c]),f}_isSourceCacheLoaded(c){const f=this.getOwnSourceCaches(c);return f.length===0?(this.fire(new s.a7(new Error(`There is no source with ID '${c}'`))),!1):f.every(v=>v.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function pl(_,c){let f=!1,v=null;const w=()=>{v=null,f&&(_(),v=setTimeout(w,c),f=!1)};return()=>(f=!0,v||w(),v)}Is.getSourceType=function(_){return Wo[_]},Is.setSourceType=function(_,c){Wo[_]=c},Is.registerForPluginStateChange=s.ci;class qy{constructor(c){this._hashName=c&&encodeURIComponent(c),s.aR(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=pl(this._updateHashUnthrottled.bind(this),300)}addTo(c){return this._map=c,window.addEventListener("hashchange",this._onHashChange,!1),c.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const c=this._map;if(!c)return"";const f=ml(c);if(this._hashName){const v=this._hashName;let w=!1;const S=location.hash.slice(1).split("&").map(M=>{const k=M.split("=")[0];return k===v?(w=!0,`${k}=${f}`):M}).filter(M=>M);return w||S.push(`${v}=${f}`),`#${S.join("&")}`}return`#${f}`}_getCurrentHash(){const c=location.hash.replace("#","");if(this._hashName){let f;return c.split("&").map(v=>v.split("=")).forEach(v=>{v[0]===this._hashName&&(f=v)}),(f&&f[1]||"").split("/")}return c.split("/")}_onHashChange(){const c=this._map;if(!c)return!1;const f=this._getCurrentHash();if(f.length>=3&&!f.some(v=>isNaN(v))){const v=c.dragRotate.isEnabled()&&c.touchZoomRotate.isEnabled()?+(f[3]||0):c.getBearing();return c.jumpTo({center:[+f[2],+f[1]],zoom:+f[0],bearing:v,pitch:+(f[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function ml(_,c){const f=_.getCenter(),v=Math.round(100*_.getZoom())/100,w=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,w),M=Math.round(f.lng*S)/S,k=Math.round(f.lat*S)/S,L=_.getBearing(),F=_.getPitch();let $=c?`/${M}/${k}/${v}`:`${v}/${k}/${M}`;return(L||F)&&($+="/"+Math.round(10*L)/10),F&&($+=`/${Math.round(F)}`),$}const hh={linearity:.3,easing:s.cE(0,0,.3,1)},sm=s.ak({deceleration:2500,maxSpeed:1400},hh),am=s.ak({deceleration:20,maxSpeed:1400},hh),Ld=s.ak({deceleration:1e3,maxSpeed:360},hh),lb=s.ak({deceleration:1e3,maxSpeed:90},hh);class Wy{constructor(c){this._map=c,this.clear()}clear(){this._inertiaBuffer=[]}record(c){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:s.a4.now(),settings:c})}_drainInertiaBuffer(){const c=this._inertiaBuffer,f=s.a4.now();for(;c.length>0&&f-c[0].time>160;)c.shift()}_onMoveEnd(c){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const f={zoom:0,bearing:0,pitch:0,pan:new s.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:S}of this._inertiaBuffer)f.zoom+=S.zoomDelta||0,f.bearing+=S.bearingDelta||0,f.pitch+=S.pitchDelta||0,S.panDelta&&f.pan._add(S.panDelta),S.around&&(f.around=S.around),S.pinchAround&&(f.pinchAround=S.pinchAround);const v=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(f.pan.mag()){const S=zd(f.pan.mag(),v,s.ak({},sm,c||{}));w.offset=f.pan.mult(S.amount/f.pan.mag()),w.center=this._map.transform.center,gl(w,S)}if(f.zoom){const S=zd(f.zoom,v,am);w.zoom=this._map.transform.zoom+S.amount,gl(w,S)}if(f.bearing){const S=zd(f.bearing,v,Ld);w.bearing=this._map.transform.bearing+s.c(S.amount,-179,179),gl(w,S)}if(f.pitch){const S=zd(f.pitch,v,lb);w.pitch=this._map.transform.pitch+S.amount,gl(w,S)}if(w.zoom||w.bearing){const S=f.pinchAround===void 0?f.around:f.pinchAround;w.around=S?this._map.unproject(S):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function gl(_,c){(!_.duration||_.duration<c.duration)&&(_.duration=c.duration,_.easing=c.easing)}function zd(_,c,f){const{maxSpeed:v,linearity:w,deceleration:S}=f,M=s.c(_*w/(c/1e3),-v,v),k=Math.abs(M)/(S*w);return{easing:f.easing,duration:1e3*k,amount:M*(k/2)}}class ds extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,v,w={}){const S=ue(f.getCanvasContainer(),v),M=f.unproject(S);super(c,s.ak({point:S,lngLat:M,originalEvent:v},w)),this._defaultPrevented=!1,this.target=f}}class dh extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,v){const w=c==="touchend"?v.changedTouches:v.touches,S=Me(f.getCanvasContainer(),w),M=S.map(L=>f.unproject(L)),k=S.reduce((L,F,$,Z)=>L.add(F.div(Z.length)),new s.P(0,0));super(c,{points:S,point:k,lngLats:M,lngLat:f.unproject(k),originalEvent:v}),this._defaultPrevented=!1}}class cb extends s.a8{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(c,f,v){super(c,{originalEvent:v}),this._defaultPrevented=!1}}class lm{constructor(c,f){this._map=c,this._clickTolerance=f.clickTolerance}reset(){this._mousedownPos=void 0}wheel(c){return this._firePreventable(new cb(c.type,this._map,c))}mousedown(c,f){return this._mousedownPos=f,this._firePreventable(new ds(c.type,this._map,c))}mouseup(c){this._map.fire(new ds(c.type,this._map,c))}preclick(c){const f=s.ak({},c);f.type="preclick",this._map.fire(new ds(f.type,this._map,f))}click(c,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||(this.preclick(c),this._map.fire(new ds(c.type,this._map,c)))}dblclick(c){return this._firePreventable(new ds(c.type,this._map,c))}mouseover(c){this._map.fire(new ds(c.type,this._map,c))}mouseout(c){this._map.fire(new ds(c.type,this._map,c))}touchstart(c){return this._firePreventable(new dh(c.type,this._map,c))}touchmove(c){this._map.fire(new dh(c.type,this._map,c))}touchend(c){this._map.fire(new dh(c.type,this._map,c))}touchcancel(c){this._map.fire(new dh(c.type,this._map,c))}_firePreventable(c){if(this._map.fire(c),c.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Nd{constructor(c){this._map=c}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(c){this._map.fire(new ds(c.type,this._map,c))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ds("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(c){this._delayContextMenu?this._contextMenuEvent=c:this._map.fire(new ds(c.type,this._map,c)),this._map.listens("contextmenu")&&c.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fh{constructor(c,f){this._map=c,this._el=c.getCanvasContainer(),this._container=c.getContainer(),this._clickTolerance=f.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(c,f){this.isEnabled()&&c.shiftKey&&c.button===0&&(U(),this._startPos=this._lastPos=f,this._active=!0)}mousemoveWindow(c,f){if(!this._active)return;const v=f,w=this._startPos,S=this._lastPos;if(!w||!S||S.equals(v)||!this._box&&v.dist(w)<this._clickTolerance)return;this._lastPos=v,this._box||(this._box=j("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",c));const M=Math.min(w.x,v.x),k=Math.max(w.x,v.x),L=Math.min(w.y,v.y),F=Math.max(w.y,v.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${M}px,${L}px)`,this._box.style.width=k-M+"px",this._box.style.height=F-L+"px")})}mouseupWindow(c,f){if(!this._active)return;const v=this._startPos,w=f;if(v&&c.button===0){if(this.reset(),pe(),v.x!==w.x||v.y!==w.y)return this._map.fire(new s.a8("boxzoomend",{originalEvent:c})),{cameraAnimation:S=>S.fitScreenCoordinates(v,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",c)}}keydown(c){this._active&&c.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",c))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),q(),delete this._startPos,delete this._lastPos}_fireEvent(c,f){return this._map.fire(new s.a8(c,{originalEvent:f}))}}function ph(_,c){const f={};for(let v=0;v<_.length;v++)f[_[v].identifier]=c[v];return f}class mh{constructor(c){this.reset(),this.numTouches=c.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(c,f,v){(this.centroid||v.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=c.timeStamp),v.length===this.numTouches&&(this.centroid=function(w){const S=new s.P(0,0);for(const M of w)S._add(M);return S.div(w.length)}(f),this.touches=ph(v,f)))}touchmove(c,f,v){if(this.aborted||!this.centroid)return;const w=ph(v,f);for(const S in this.touches){const M=w[S];(!M||M.dist(this.touches[S])>30)&&(this.aborted=!0)}}touchend(c,f,v){if((!this.centroid||c.timeStamp-this.startTime>500)&&(this.aborted=!0),v.length===0){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class gh{constructor(c){this.singleTap=new mh(c),this.numTaps=c.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(c,f,v){this.singleTap.touchstart(c,f,v)}touchmove(c,f,v){this.singleTap.touchmove(c,f,v)}touchend(c,f,v){const w=this.singleTap.touchend(c,f,v);if(w){const S=c.timeStamp-this.lastTime<500,M=!this.lastTap||this.lastTap.dist(w)<30;if(S&&M||this.reset(),this.count++,this.lastTime=c.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Fd{constructor(){this._zoomIn=new gh({numTouches:1,numTaps:2}),this._zoomOut=new gh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(c,f,v){this._zoomIn.touchstart(c,f,v),this._zoomOut.touchstart(c,f,v)}touchmove(c,f,v){this._zoomIn.touchmove(c,f,v),this._zoomOut.touchmove(c,f,v)}touchend(c,f,v){const w=this._zoomIn.touchend(c,f,v),S=this._zoomOut.touchend(c,f,v);return w?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()+1,around:M.unproject(w)},{originalEvent:c})}):S?(this._active=!0,c.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:M=>M.easeTo({duration:300,zoom:M.getZoom()-1,around:M.unproject(S)},{originalEvent:c})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Bd={0:1,2:2};class Xo{constructor(c){this.reset(),this._clickTolerance=c.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(c,f){return!1}_move(c,f){return{}}mousedown(c,f){if(this._lastPoint)return;const v=Se(c);this._correctButton(c,v)&&(this._lastPoint=f,this._eventButton=v)}mousemoveWindow(c,f){const v=this._lastPoint;if(v){if(c.preventDefault(),this._eventButton!=null&&function(w,S){const M=Bd[S];return w.buttons===void 0||(w.buttons&M)!==M}(c,this._eventButton))this.reset();else if(this._moved||!(f.dist(v)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(v,f)}}mouseupWindow(c){this._lastPoint&&Se(c)===this._eventButton&&(this._moved&&pe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hy extends Xo{mousedown(c,f){super.mousedown(c,f),this._lastPoint&&(this._active=!0)}_correctButton(c,f){return f===0&&!c.ctrlKey}_move(c,f){return{around:f,panDelta:f.sub(c)}}}class cm extends Xo{_correctButton(c,f){return f===0&&c.ctrlKey||f===2}_move(c,f){const v=.8*(f.x-c.x);if(v)return this._active=!0,{bearingDelta:v}}contextmenu(c){c.preventDefault()}}class um extends Xo{_correctButton(c,f){return f===0&&c.ctrlKey||f===2}_move(c,f){const v=-.5*(f.y-c.y);if(v)return this._active=!0,{pitchDelta:v}}contextmenu(c){c.preventDefault()}}class Kl{constructor(c,f){this._map=c,this._el=c.getCanvasContainer(),this._minTouches=1,this._clickTolerance=f.clickTolerance||1,this.reset(),s.aR(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new s.P(0,0)}touchstart(c,f,v){return this._calculateTransform(c,f,v)}touchmove(c,f,v){if(this._active&&!(v.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(v.length===1&&!s.cF())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return c.cancelable&&c.preventDefault(),this._calculateTransform(c,f,v)}}touchend(c,f,v){this._calculateTransform(c,f,v),this._active&&v.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(c,f,v){v.length>0&&(this._active=!0);const w=ph(v,f),S=new s.P(0,0),M=new s.P(0,0);let k=0;for(const F in w){const $=w[F],Z=this._touches[F];Z&&(S._add($),M._add($.sub(Z)),k++,w[F]=$)}if(this._touches=w,k<this._minTouches||!M.mag())return;const L=M.div(k);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:S.div(k),panDelta:L}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class jd{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(c){}_move(c,f,v){return{}}touchstart(c,f,v){this._firstTwoTouches||v.length<2||(this._firstTwoTouches=[v[0].identifier,v[1].identifier],this._start([f[0],f[1]]))}touchmove(c,f,v){const w=this._firstTwoTouches;if(!w)return;c.preventDefault();const[S,M]=w,k=Jl(v,f,S),L=Jl(v,f,M);if(!k||!L)return;const F=this._aroundCenter?null:k.add(L).div(2);return this._move([k,L],F,c)}touchend(c,f,v){if(!this._firstTwoTouches)return;const[w,S]=this._firstTwoTouches,M=Jl(v,f,w),k=Jl(v,f,S);M&&k||(this._active&&pe(),this.reset())}touchcancel(){this.reset()}enable(c){this._enabled=!0,this._aroundCenter=!!c&&c.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Jl(_,c,f){for(let v=0;v<_.length;v++)if(_[v].identifier===f)return c[v]}function $d(_,c){return Math.log(_/c)/Math.LN2}class Ud extends jd{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(c){this._startDistance=this._distance=c[0].dist(c[1])}_move(c,f){const v=this._distance;if(this._distance=c[0].dist(c[1]),this._active||!(Math.abs($d(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$d(this._distance,v),pinchAround:f}}}function hm(_,c){return 180*_.angleWith(c)/Math.PI}class Zy extends jd{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(c){this._startVector=this._vector=c[0].sub(c[1]),this._minDiameter=c[0].dist(c[1])}_move(c,f){const v=this._vector;if(this._vector=c[0].sub(c[1]),v&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:hm(this._vector,v),pinchAround:f}}_isBelowThreshold(c){this._minDiameter=Math.min(this._minDiameter,c.mag());const f=25/(Math.PI*this._minDiameter)*360,v=this._startVector;if(!v)return!1;const w=hm(c,v);return Math.abs(w)<f}}function _l(_){return Math.abs(_.y)>Math.abs(_.x)}class ub extends jd{constructor(c){super(),this._map=c}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(c){this._lastPoints=c,_l(c[0].sub(c[1]))&&(this._valid=!1)}_move(c,f,v){const w=this._lastPoints;if(!w)return;const S=c[0].sub(w[0]),M=c[1].sub(w[1]);return this._map._cooperativeGestures&&!s.cF()&&v.touches.length<3||(this._valid=this.gestureBeginsVertically(S,M,v.timeStamp),!this._valid)?void 0:(this._lastPoints=c,this._active=!0,{pitchDelta:(S.y+M.y)/2*-.5})}gestureBeginsVertically(c,f,v){if(this._valid!==void 0)return this._valid;const w=c.mag()>=2,S=f.mag()>=2;if(!w&&!S)return;if(!w||!S)return this._firstMove==null&&(this._firstMove=v),v-this._firstMove<100&&void 0;const M=c.y>0==f.y>0;return _l(c)&&_l(f)&&M}}const hb={panStep:100,bearingStep:15,pitchStep:10};class Xy{constructor(){const c=hb;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(c){if(c.altKey||c.ctrlKey||c.metaKey)return;let f=0,v=0,w=0,S=0,M=0;switch(c.keyCode){case 61:case 107:case 171:case 187:f=1;break;case 189:case 109:case 173:f=-1;break;case 37:c.shiftKey?v=-1:(c.preventDefault(),S=-1);break;case 39:c.shiftKey?v=1:(c.preventDefault(),S=1);break;case 38:c.shiftKey?w=1:(c.preventDefault(),M=-1);break;case 40:c.shiftKey?w=-1:(c.preventDefault(),M=1);break;default:return}return this._rotationDisabled&&(v=0,w=0),{cameraAnimation:k=>{const L=k.getZoom();k.easeTo({duration:300,easeId:"keyboardHandler",easing:Vd,zoom:f?Math.round(L)+f*(c.shiftKey?2:1):L,bearing:k.getBearing()+v*this._bearingStep,pitch:k.getPitch()+w*this._pitchStep,offset:[-S*this._panStep,-M*this._panStep],center:k.getCenter()},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Vd(_){return _*(2-_)}const Gd=4.000244140625;class Yy{constructor(c,f){this._map=c,this._el=c.getCanvasContainer(),this._handler=f,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,s.aR(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(c){this._defaultZoomRate=c}setWheelZoomRate(c){this._wheelZoomRate=c}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(c){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!c&&c.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(c){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(c.ctrlKey||c.metaKey||this.isZooming()||s.cF()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let f=c.deltaMode===WheelEvent.DOM_DELTA_LINE?40*c.deltaY:c.deltaY;const v=s.a4.now(),w=v-(this._lastWheelEventTime||0);this._lastWheelEventTime=v,f!==0&&f%Gd==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,c)):this._type||(this._type=Math.abs(w*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),c.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=c,this._delta-=f,this._active||this._start(c)),c.preventDefault()}_onTimeout(c){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(c)}_start(c){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const f=ue(this._el,c);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:f,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const c=this._map.transform;this._type==="wheel"&&c.projection.wrap&&(c._center.lng>=180||c._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const f=()=>c._terrainEnabled()&&this._aroundCoord?c.computeZoomRelativeTo(this._aroundCoord):c.zoom;if(this._delta!==0){const F=this._type==="wheel"&&Math.abs(this._delta)>Gd?this._wheelZoomRate:this._defaultZoomRate;let $=2/(1+Math.exp(-Math.abs(this._delta*F)));this._delta<0&&$!==0&&($=1/$);const Z=f(),K=Math.pow(2,Z),ee=typeof this._targetZoom=="number"?c.zoomScale(this._targetZoom):K;this._targetZoom=Math.min(c.maxZoom,Math.max(c.minZoom,c.scaleZoom(ee*$))),this._type==="wheel"&&(this._startZoom=Z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const v=typeof this._targetZoom=="number"?this._targetZoom:f(),w=this._startZoom,S=this._easing;let M,k=!1;if(this._type==="wheel"&&w&&S){const F=Math.min((s.a4.now()-this._lastWheelEventTime)/200,1),$=S(F);M=s.n(w,v,$),F<1?this._frameId||(this._frameId=!0):k=!0}else M=v,k=!0;this._active=!0,k&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let L=M-f();return L*this._lastDelta<0&&(L=0),{noInertia:!0,needsRenderFrame:!k,zoomDelta:L,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(c){let f=s.cG;if(this._prevEase){const v=this._prevEase,w=(s.a4.now()-v.start)/v.duration,S=v.easing(w+.01)-v.easing(w),M=.27/Math.sqrt(S*S+1e-4)*.01,k=Math.sqrt(.0729-M*M);f=s.cE(M,k,.25,1)}return this._prevEase={start:s.a4.now(),duration:c,easing:f},f}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=j("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Qy{constructor(c,f){this._clickZoom=c,this._tapZoom=f}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class qd{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(c,f){return c.preventDefault(),{cameraAnimation:v=>{v.easeTo({duration:300,zoom:v.getZoom()+(c.shiftKey?-1:1),around:v.unproject(f)},{originalEvent:c})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class dm{constructor(){this._tap=new gh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(c,f,v){this._swipePoint||(this._tapTime&&c.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?v.length>0&&(this._swipePoint=f[0],this._swipeTouch=v[0].identifier):this._tap.touchstart(c,f,v))}touchmove(c,f,v){if(this._tapTime){if(this._swipePoint){if(v[0].identifier!==this._swipeTouch)return;const w=f[0],S=w.y-this._swipePoint.y;return this._swipePoint=w,c.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(c,f,v)}touchend(c,f,v){this._tapTime?this._swipePoint&&v.length===0&&this.reset():this._tap.touchend(c,f,v)&&(this._tapTime=c.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ky{constructor(c,f,v){this._el=c,this._mousePan=f,this._touchPan=v}enable(c){this._inertiaOptions=c||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Jy{constructor(c,f,v){this._pitchWithRotate=c.pitchWithRotate,this._mouseRotate=f,this._mousePitch=v}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ev{constructor(c,f,v,w){this._el=c,this._touchZoom=f,this._touchRotate=v,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(c){this._touchZoom.enable(c),this._rotationDisabled||this._touchRotate.enable(c),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const _h=_=>_.zoom||_.drag||_.pitch||_.rotate;class tv extends s.a8{}class Wc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(c,f){const v=s.v.sub([],f,c);this.radius=s.v.length(v[2]<0?s.v.div([],v,this.constants):[v[0],v[1],0])}projectRay(c){s.v.div(c,c,this.constants),s.v.normalize(c,c),s.v.mul(c,c,this.constants);const f=s.v.scale([],c,this.radius);if(f[2]>0){const v=s.v.scale([],[0,0,1],s.v.dot(f,[0,0,1])),w=s.v.scale([],s.v.normalize([],[f[0],f[1],0]),this.radius),S=s.v.add([],f,s.v.scale([],s.v.sub([],s.v.add([],w,v),f),2));f[0]=S[0],f[1]=S[1]}return f}}function yh(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class rv{constructor(c,f){this._map=c,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Wy(c),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Wc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(f),s.aR(["handleEvent","handleWindowEvent"],this);const v=this._el;this._listeners=[[v,"touchstart",{passive:!0}],[v,"touchmove",{passive:!1}],[v,"touchend",void 0],[v,"touchcancel",void 0],[v,"mousedown",void 0],[v,"mousemove",void 0],[v,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[v,"mouseover",void 0],[v,"mouseout",void 0],[v,"dblclick",void 0],[v,"click",void 0],[v,"keydown",{capture:!1}],[v,"keyup",void 0],[v,"wheel",{passive:!1}],[v,"contextmenu",void 0],[window,"blur",void 0]];for(const[w,S,M]of this._listeners){const k=w===document?this.handleWindowEvent:this.handleEvent;w.addEventListener(S,k,M)}}destroy(){for(const[c,f,v]of this._listeners){const w=c===document?this.handleWindowEvent:this.handleEvent;c.removeEventListener(f,w,v)}}_addDefaultHandlers(c){const f=this._map,v=f.getCanvasContainer();this._add("mapEvent",new lm(f,c));const w=f.boxZoom=new fh(f,c);this._add("boxZoom",w);const S=new Fd,M=new qd;f.doubleClickZoom=new Qy(M,S),this._add("tapZoom",S),this._add("clickZoom",M);const k=new dm;this._add("tapDragZoom",k);const L=f.touchPitch=new ub(f);this._add("touchPitch",L);const F=new cm(c),$=new um(c);f.dragRotate=new Jy(c,F,$),this._add("mouseRotate",F,["mousePitch"]),this._add("mousePitch",$,["mouseRotate"]);const Z=new Hy(c),K=new Kl(f,c);f.dragPan=new Ky(v,Z,K),this._add("mousePan",Z),this._add("touchPan",K,["touchZoom","touchRotate"]);const ee=new Zy,ne=new Ud;f.touchZoomRotate=new ev(v,ne,ee,k),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",ne,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Nd(f));const oe=f.scrollZoom=new Yy(f,this);this._add("scrollZoom",oe,["mousePan"]);const ie=f.keyboard=new Xy;this._add("keyboard",ie);for(const re of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])c.interactive&&c[re]&&f[re].enable(c[re])}_add(c,f,v){this._handlers.push({handlerName:c,handler:f,allowed:v}),this._handlersById[c]=f}stop(c){if(!this._updatingCamera){for(const{handler:f}of this._handlers)f.reset();this._inertia.clear(),this._fireEvents({},{},c),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:c}of this._handlers)if(c.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!_h(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(c,f,v){for(const w in c)if(w!==v&&(!f||f.indexOf(w)<0))return!0;return!1}handleWindowEvent(c){this.handleEvent(c,`${c.type}Window`)}_getMapTouches(c){const f=[];for(const v of c)this._el.contains(v.target)&&f.push(v);return f}handleEvent(c,f){this._updatingCamera=!0;const v=c.type==="renderFrame",w=v?void 0:c,S={needsRenderFrame:!1},M={},k={},L=c.touches?this._getMapTouches(c.touches):void 0,F=L?Me(this._el,L):v?void 0:ue(this._el,c);for(const{handlerName:K,handler:ee,allowed:ne}of this._handlers){if(!ee.isEnabled())continue;let oe;this._blockedByActive(k,ne,K)?ee.reset():ee[f||c.type]&&(oe=ee[f||c.type](c,F,L),this.mergeHandlerResult(S,M,oe,K,w),oe&&oe.needsRenderFrame&&this._triggerRenderFrame()),(oe||ee.isActive())&&(k[K]=ee)}const $={};for(const K in this._previousActiveHandlers)k[K]||($[K]=w);this._previousActiveHandlers=k,(Object.keys($).length||yh(S))&&(this._changes.push([S,M,$]),this._triggerRenderFrame()),(Object.keys(k).length||yh(S))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:Z}=S;Z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Z(this._map))}mergeHandlerResult(c,f,v,w,S){if(!v)return;s.ak(c,v);const M={handlerName:w,originalEvent:v.originalEvent||S};v.zoomDelta!==void 0&&(f.zoom=M),v.panDelta!==void 0&&(f.drag=M),v.pitchDelta!==void 0&&(f.pitch=M),v.bearingDelta!==void 0&&(f.rotate=M)}_applyChanges(){const c={},f={},v={};for(const[w,S,M]of this._changes)w.panDelta&&(c.panDelta=(c.panDelta||new s.P(0,0))._add(w.panDelta)),w.zoomDelta&&(c.zoomDelta=(c.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(c.bearingDelta=(c.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(c.pitchDelta=(c.pitchDelta||0)+w.pitchDelta),w.around!==void 0&&(c.around=w.around),w.aroundCoord!==void 0&&(c.aroundCoord=w.aroundCoord),w.pinchAround!==void 0&&(c.pinchAround=w.pinchAround),w.noInertia&&(c.noInertia=w.noInertia),s.ak(f,S),s.ak(v,M);this._updateMapTransform(c,f,v),this._changes=[]}_updateMapTransform(c,f,v){const w=this._map,S=w.transform,M=de=>[de.x,de.y,de.z];if((de=>{const be=this._eventsInProgress.drag;return be&&!this._handlersById[be.handlerName].isActive()})()&&!yh(c)){const de=S.zoom;S.cameraElevationReference="sea",this._originalZoom!=null&&S._orthographicProjectionAtLowPitch&&S.projection.name!=="globe"&&S.pitch===0?(S.cameraElevationReference="ground",S.zoom=this._originalZoom):(S.recenterOnTerrain(),S.cameraElevationReference="ground"),de!==S.zoom&&this._map._update(!0)}if(S._isCameraConstrained&&w._stop(!0),!yh(c))return void this._fireEvents(f,v,!0);let{panDelta:k,zoomDelta:L,bearingDelta:F,pitchDelta:$,around:Z,aroundCoord:K,pinchAround:ee}=c;S._isCameraConstrained&&(L>0&&(L=0),S._isCameraConstrained=!1),ee!==void 0&&(Z=ee),(L||(de=>f[de]&&!this._eventsInProgress[de])("drag"))&&Z&&(this._dragOrigin=M(S.pointCoordinate3D(Z)),this._originalZoom=S.zoom,this._trackingEllipsoid.setup(S._camera.position,this._dragOrigin)),S.cameraElevationReference="sea",w._stop(!0),Z=Z||w.transform.centerPoint,F&&(S.bearing+=F),$&&(S.pitch+=$),S._updateCameraState();const ne=[0,0,0];if(k)if(S.projection.name==="mercator"){const de=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(Z).dir),be=this._trackingEllipsoid.projectRay(S.screenPointToMercatorRay(Z.sub(k)).dir);ne[0]=be[0]-de[0],ne[1]=be[1]-de[1]}else{const de=S.pointCoordinate(Z);if(S.projection.name==="globe"){k=k.rotate(-S.angle);const be=S._pixelsPerMercatorPixel/S.worldSize;ne[0]=-k.x*s.cH(s.l(de.y))*be,ne[1]=-k.y*s.cH(S.center.lat)*be}else{const be=S.pointCoordinate(Z.sub(k));de&&be&&(ne[0]=be.x-de.x,ne[1]=be.y-de.y)}}const oe=S.zoom,ie=[0,0,0];if(L){const de=M(K||S.pointCoordinate3D(Z)),be={dir:s.v.normalize([],s.v.sub([],de,S._camera.position))};if(be.dir[2]<0){const Ee=S.zoomDeltaToMovement(de,L);s.v.scale(ie,be.dir,Ee)}}const re=s.v.add(ne,ne,ie);S._translateCameraConstrained(re),L&&Math.abs(S.zoom-oe)>1e-4&&S.recenterOnTerrain(),S.cameraElevationReference="ground",this._map._update(),c.noInertia||this._inertia.record(c),this._fireEvents(f,v,!0)}_fireEvents(c,f,v){const w=_h(this._eventsInProgress),S=_h(c),M={};for(const $ in c){const{originalEvent:Z}=c[$];this._eventsInProgress[$]||(M[`${$}start`]=Z),this._eventsInProgress[$]=c[$]}!w&&S&&this._fireEvent("movestart",S.originalEvent);for(const $ in M)this._fireEvent($,M[$]);S&&this._fireEvent("move",S.originalEvent);for(const $ in c){const{originalEvent:Z}=c[$];this._fireEvent($,Z)}const k={};let L;for(const $ in this._eventsInProgress){const{handlerName:Z,originalEvent:K}=this._eventsInProgress[$];this._handlersById[Z].isActive()||(delete this._eventsInProgress[$],L=f[Z]||K,k[`${$}end`]=L)}for(const $ in k)this._fireEvent($,k[$]);const F=_h(this._eventsInProgress);if(v&&(w||S)&&!F){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=K=>K!==0&&-this._bearingSnap<K&&K<this._bearingSnap;$?(Z($.bearing||this._map.getBearing())&&($.bearing=0),this._map.easeTo($,{originalEvent:L})):(this._map.fire(new s.a8("moveend",{originalEvent:L})),Z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(c,f){this._map.fire(new s.a8(c,f?{originalEvent:f}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(c=>{this._frameId=void 0,this.handleEvent(new tv("renderFrame",{timeStamp:c})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const nv="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class iv extends s.a6{constructor(c,f){super(),this._moving=!1,this._zooming=!1,this.transform=c,this._bearingSnap=f.bearingSnap,this._respectPrefersReducedMotion=f.respectPrefersReducedMotion!==!1,s.aR(["_renderFrameCallback"],this)}getCenter(){return new s.L(this.transform.center.lng,this.transform.center.lat)}setCenter(c,f){return this.jumpTo({center:c},f)}panBy(c,f,v){return c=s.P.convert(c).mult(-1),this.panTo(this.transform.center,s.ak({offset:c},f),v)}panTo(c,f,v){return this.easeTo(s.ak({center:c},f),v)}getZoom(){return this.transform.zoom}setZoom(c,f){return this.jumpTo({zoom:c},f),this}zoomTo(c,f,v){return this.easeTo(s.ak({zoom:c},f),v)}zoomIn(c,f){return this.zoomTo(this.getZoom()+1,c,f),this}zoomOut(c,f){return this.zoomTo(this.getZoom()-1,c,f),this}getBearing(){return this.transform.bearing}setBearing(c,f){return this.jumpTo({bearing:c},f),this}getPadding(){return this.transform.padding}setPadding(c,f){return this.jumpTo({padding:c},f),this}rotateTo(c,f,v){return this.easeTo(s.ak({bearing:c},f),v)}resetNorth(c,f){return this.rotateTo(0,s.ak({duration:1e3},c),f),this}resetNorthPitch(c,f){return this.easeTo(s.ak({bearing:0,pitch:0,duration:1e3},c),f),this}snapToNorth(c,f){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(c,f):this}getPitch(){return this.transform.pitch}setPitch(c,f){return this.jumpTo({pitch:c},f),this}cameraForBounds(c,f){c=s.D.convert(c);const v=f&&f.bearing||0,w=f&&f.pitch||0,S=c.getNorthWest(),M=c.getSouthEast();return this._cameraForBounds(this.transform,S,M,v,w,f)}_extendCameraOptions(c){const f={top:0,bottom:0,right:0,left:0};if(typeof(c=s.ak({padding:f,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const v=c.padding;c.padding={top:v,bottom:v,right:v,left:v}}return c.padding=s.ak(f,c.padding),c}_minimumAABBFrustumDistance(c,f){const v=f.max[0]-f.min[0],w=f.max[1]-f.min[1];return v/w>c.aspect?v/(2*Math.tan(.5*c.fovX)*c.aspect):w/(2*Math.tan(.5*c.fovY)*c.aspect)}_cameraForBoundsOnGlobe(c,f,v,w,S,M){const k=c.clone(),L=this._extendCameraOptions(M);k.bearing=w,k.pitch=S;const F=s.L.convert(f),$=s.L.convert(v),Z=.5*(F.lat+$.lat),K=.5*(F.lng+$.lng),ee=s.cI(Z,K),ne=s.v.normalize([],ee),oe=s.v.normalize([],s.v.cross([],ne,[0,1,0])),ie=s.v.cross([],oe,ne),re=[oe[0],oe[1],oe[2],0,ie[0],ie[1],ie[2],0,ne[0],ne[1],ne[2],0,0,0,0,1],de=[ee,s.cI(F.lat,F.lng),s.cI($.lat,F.lng),s.cI($.lat,$.lng),s.cI(F.lat,$.lng),s.cI(Z,F.lng),s.cI(Z,$.lng),s.cI(F.lat,K),s.cI($.lat,K)];let be=s.c3.fromPoints(de.map($e=>[s.v.dot(oe,$e),s.v.dot(ie,$e),s.v.dot(ne,$e)]));const Ee=s.v.transformMat4([],be.center,re);s.v.squaredLength(Ee)===0&&s.v.set(Ee,0,0,1),s.v.normalize(Ee,Ee),s.v.scale(Ee,Ee,s.aC),k.center=s.cJ(Ee);const ce=k.getWorldToCameraMatrix(),fe=s.m.invert(new Float64Array(16),ce);be=s.c3.applyTransform(be,s.m.multiply([],ce,re)),s.v.transformMat4(Ee,Ee,ce);const Ce=.5*(be.max[2]-be.min[2]),Oe=this._minimumAABBFrustumDistance(k,be),Ae=s.v.scale([],[0,0,1],Ce),Le=s.v.add(Ae,Ee,Ae),ut=Oe+(k.pitch===0?0:s.v.distance(Ee,Le)),He=k.globeCenterInViewSpace,Je=s.v.sub([],Ee,[He[0],He[1],He[2]]);s.v.normalize(Je,Je),s.v.scale(Je,Je,ut);const Be=s.v.add([],Ee,Je);s.v.transformMat4(Be,Be,fe);const lt=s.cL/s.aC,Qe=s.v.length(Be),dt=s.b(Math.max(Qe*lt-s.cL,Number.EPSILON),0),ye=Math.min(k.zoomFromMercatorZAdjusted(dt),L.maxZoom);return ye>.5*(s.Z+s.G)?(k.setProjection({name:"mercator"}),k.zoom=ye,this._cameraForBounds(k,f,v,w,S,M)):{center:k.center,zoom:ye,bearing:w,pitch:S}}queryTerrainElevation(c,f){const v=this.transform.elevation;return v?(f=s.ak({},{exaggerated:!0},f),v.getAtPoint(s.M.fromLngLat(c),null,f.exaggerated)):null}_cameraForBounds(c,f,v,w,S,M){if(c.projection.name==="globe")return this._cameraForBoundsOnGlobe(c,f,v,w,S,M);const k=c.clone(),L=this._extendCameraOptions(M),F=k.padding;k.bearing=w,k.pitch=S;const $=s.L.convert(f),Z=s.L.convert(v),K=new s.L($.lng,Z.lat),ee=new s.L(Z.lng,$.lat),ne=k.project($),oe=k.project(Z),ie=this.queryTerrainElevation($),re=this.queryTerrainElevation(Z),de=this.queryTerrainElevation(K),be=this.queryTerrainElevation(ee),Ee=[[ne.x,ne.y,Math.min(ie||0,re||0,de||0,be||0)],[oe.x,oe.y,Math.max(ie||0,re||0,de||0,be||0)]];let ce=s.c3.fromPoints(Ee);const fe=k.getWorldToCameraMatrix(),Ce=s.m.invert(new Float64Array(16),fe);ce=s.c3.applyTransform(ce,fe);const Oe=s.v.sub([],ce.max,ce.min),Ae=F.left||0,Le=F.right||0,ut=F.bottom||0,He=F.top||0,{left:Je,right:Be,top:lt,bottom:Qe}=L.padding,dt=.5*(Ae+Le),ye=.5*(He+ut),$e=Math.min(k.scaleZoom(k.scale*Math.min((k.width-(Ae+Le+Je+Be))/Oe[0],(k.height-(ut+He+Qe+lt))/Oe[1])),L.maxZoom),St=k.scale/k.zoomScale($e);ce=new s.c3([ce.min[0]-(Je+dt)*St,ce.min[1]-(Qe+ye)*St,ce.min[2]],[ce.max[0]+(Be+dt)*St,ce.max[1]+(lt+ye)*St,ce.max[2]]);const pt=.5*Oe[2],Xt=this._minimumAABBFrustumDistance(k,ce),Bt=[0,0,1,0];s.e.transformMat4(Bt,Bt,fe),s.e.normalize(Bt,Bt);const nr=s.v.scale([],Bt,Xt+pt),Wt=s.v.add([],ce.center,nr),cr=(typeof L.offset.x=="number"&&typeof L.offset.y=="number"?new s.P(L.offset.x,L.offset.y):s.P.convert(L.offset)).rotate(-s.d(w));ce.center[0]-=cr.x*St,ce.center[1]+=cr.y*St,s.v.transformMat4(ce.center,ce.center,Ce),s.v.transformMat4(Wt,Wt,Ce);const ur=[ce.center[0],ce.center[1],Wt[2]*k.pixelsPerMeter];s.v.scale(ur,ur,1/k.worldSize);const er=s.cK(ur[0]),tr=s.l(ur[1]),Yr=Math.min(k._zoomFromMercatorZ(ur[2]),L.maxZoom),Cr=new s.L(er,tr);return k.mercatorFromTransition&&Yr<.5*(s.Z+s.G)?(k.setProjection({name:"globe"}),k.zoom=Yr,this._cameraForBounds(k,f,v,w,S,M)):{center:Cr,zoom:Yr,bearing:w,pitch:S}}fitBounds(c,f,v){const w=this.cameraForBounds(c,f);return this._fitInternal(w,f,v)}fitScreenCoordinates(c,f,v,w,S){const M=s.P.convert(c),k=s.P.convert(f),L=new s.P(Math.min(M.x,k.x),Math.min(M.y,k.y)),F=new s.P(Math.max(M.x,k.x),Math.max(M.y,k.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(M,k))return this;const $=this.transform.pointLocation3D(L),Z=this.transform.pointLocation3D(F),K=this.transform.pointLocation3D(new s.P(L.x,F.y)),ee=this.transform.pointLocation3D(new s.P(F.x,L.y)),ne=[Math.min($.lng,Z.lng,K.lng,ee.lng),Math.min($.lat,Z.lat,K.lat,ee.lat)],oe=[Math.max($.lng,Z.lng,K.lng,ee.lng),Math.max($.lat,Z.lat,K.lat,ee.lat)],ie=w&&w.pitch?w.pitch:this.getPitch(),re=this._cameraForBounds(this.transform,ne,oe,v,ie,w);return this._fitInternal(re,w,S)}_fitInternal(c,f,v){return c?(delete(f=s.ak(c,f)).padding,f.linear?this.easeTo(f,v):this.flyTo(f,v)):this}jumpTo(c,f){this.stop();const v=c.preloadOnly?this.transform.clone():this.transform;let w=!1,S=!1,M=!1;return"zoom"in c&&v.zoom!==+c.zoom&&(w=!0,v.zoom=+c.zoom),c.center!==void 0&&(v.center=s.L.convert(c.center)),"bearing"in c&&v.bearing!==+c.bearing&&(S=!0,v.bearing=+c.bearing),"pitch"in c&&v.pitch!==+c.pitch&&(M=!0,v.pitch=+c.pitch),c.padding==null||v.isPaddingEqual(c.padding)||(v.padding=c.padding),c.preloadOnly?(this._preloadTiles(v),this):(this.fire(new s.a8("movestart",f)).fire(new s.a8("move",f)),w&&this.fire(new s.a8("zoomstart",f)).fire(new s.a8("zoom",f)).fire(new s.a8("zoomend",f)),S&&this.fire(new s.a8("rotatestart",f)).fire(new s.a8("rotate",f)).fire(new s.a8("rotateend",f)),M&&this.fire(new s.a8("pitchstart",f)).fire(new s.a8("pitch",f)).fire(new s.a8("pitchend",f)),this.fire(new s.a8("moveend",f)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||s.X(nv),this.transform.getFreeCameraOptions()}setFreeCameraOptions(c,f){const v=this.transform;if(!v.projection.supportsFreeCamera)return s.X(nv),this;this.stop();const w=v.zoom,S=v.pitch,M=v.bearing;v.setFreeCameraOptions(c);const k=w!==v.zoom,L=S!==v.pitch,F=M!==v.bearing;return this.fire(new s.a8("movestart",f)).fire(new s.a8("move",f)),k&&this.fire(new s.a8("zoomstart",f)).fire(new s.a8("zoom",f)).fire(new s.a8("zoomend",f)),F&&this.fire(new s.a8("rotatestart",f)).fire(new s.a8("rotate",f)).fire(new s.a8("rotateend",f)),L&&this.fire(new s.a8("pitchstart",f)).fire(new s.a8("pitch",f)).fire(new s.a8("pitchend",f)),this.fire(new s.a8("moveend",f)),this}easeTo(c,f){this._stop(!1,c.easeId),((c=s.ak({offset:[0,0],duration:500,easing:s.cG},c)).animate===!1||this._prefersReducedMotion(c))&&(c.duration=0);const v=this.transform,w=this.getZoom(),S=this.getBearing(),M=this.getPitch(),k=this.getPadding(),L="zoom"in c?+c.zoom:w,F="bearing"in c?this._normalizeBearing(c.bearing,S):S,$="pitch"in c?+c.pitch:M,Z="padding"in c?c.padding:v.padding,K=s.P.convert(c.offset);let ee,ne,oe;if(v.projection.name==="globe"){const Ae=s.M.fromLngLat(v.center),Le=K.rotate(-v.angle);Ae.x+=Le.x/v.worldSize,Ae.y+=Le.y/v.worldSize;const ut=Ae.toLngLat(),He=s.L.convert(c.center||ut);this._normalizeCenter(He),ee=v.centerPoint.add(Le),ne=new s.P(Ae.x,Ae.y).mult(v.worldSize),oe=new s.P(s.E(He.lng),s.H(He.lat)).mult(v.worldSize).sub(ne)}else{ee=v.centerPoint.add(K);const Ae=v.pointLocation(ee),Le=s.L.convert(c.center||Ae);this._normalizeCenter(Le),ne=v.project(Ae),oe=v.project(Le).sub(ne)}const ie=v.zoomScale(L-w);let re,de;c.around&&(re=s.L.convert(c.around),de=v.locationPoint(re));const be=this._zooming||L!==w,Ee=this._rotating||S!==F,ce=this._pitching||$!==M,fe=!v.isPaddingEqual(Z),Ce=Ae=>Le=>{if(be&&(Ae.zoom=s.n(w,L,Le)),Ee&&(Ae.bearing=s.n(S,F,Le)),ce&&(Ae.pitch=s.n(M,$,Le)),fe&&(Ae.interpolatePadding(k,Z,Le),ee=Ae.centerPoint.add(K)),re)Ae.setLocationAtPoint(re,de);else{const ut=Ae.zoomScale(Ae.zoom-w),He=L>w?Math.min(2,ie):Math.max(.5,ie),Je=Math.pow(He,1-Le),Be=Ae.unproject(ne.add(oe.mult(Le*Je)).mult(ut));Ae.setLocationAtPoint(Ae.renderWorldCopies?Be.wrap():Be,ee)}return c.preloadOnly||this._fireMoveEvents(f),Ae};if(c.preloadOnly){const Ae=this._emulate(Ce,c.duration,v);return this._preloadTiles(Ae),this}const Oe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=be,this._rotating=Ee,this._pitching=ce,this._easeId=c.easeId,this._prepareEase(f,c.noMoveStart,Oe),this._ease(Ce(v),Ae=>{v.cameraElevationReference==="sea"&&v.recenterOnTerrain(),this._afterEase(f,Ae)},c),this}_prepareEase(c,f,v={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),f||v.moving||this.fire(new s.a8("movestart",c)),this._zooming&&!v.zooming&&this.fire(new s.a8("zoomstart",c)),this._rotating&&!v.rotating&&this.fire(new s.a8("rotatestart",c)),this._pitching&&!v.pitching&&this.fire(new s.a8("pitchstart",c))}_fireMoveEvents(c){this.fire(new s.a8("move",c)),this._zooming&&this.fire(new s.a8("zoom",c)),this._rotating&&this.fire(new s.a8("rotate",c)),this._pitching&&this.fire(new s.a8("pitch",c))}_afterEase(c,f){if(this._easeId&&f&&this._easeId===f)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const v=this._zooming,w=this._rotating,S=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,v&&this.fire(new s.a8("zoomend",c)),w&&this.fire(new s.a8("rotateend",c)),S&&this.fire(new s.a8("pitchend",c)),this.fire(new s.a8("moveend",c))}flyTo(c,f){if(this._prefersReducedMotion(c)){const Qe=s.p(c,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Qe,f)}this.stop(),c=s.ak({offset:[0,0],speed:1.2,curve:1.42,easing:s.cG},c);const v=this.transform,w=this.getZoom(),S=this.getBearing(),M=this.getPitch(),k="zoom"in c?s.c(+c.zoom,v.minZoom,v.maxZoom):w,L="bearing"in c?this._normalizeBearing(c.bearing,S):S,F="pitch"in c?+c.pitch:M,$=v.zoomScale(k-w),Z=s.P.convert(c.offset),K=v.centerPoint.add(Z),ee=v.pointLocation(K);let ne=c.center;if(ne&&c.padding){const Qe=this._cameraForBounds(this.transform,ne,ne,L,F,c);Qe&&(ne=Qe.center)}ne=s.L.convert(ne||ee),this._normalizeCenter(ne);const oe=v.project(ee),ie=v.project(ne).sub(oe);let re=c.curve;const de=Math.max(v.width,v.height),be=de/$,Ee=ie.mag();if("minZoom"in c){const Qe=s.c(Math.min(c.minZoom,w,k),v.minZoom,v.maxZoom),dt=de/v.zoomScale(Qe-w);re=Math.sqrt(dt/Ee*2)}const ce=re*re;function fe(Qe){const dt=(be*be-de*de+(Qe?-1:1)*ce*ce*Ee*Ee)/(2*(Qe?be:de)*ce*Ee);return Math.log(Math.sqrt(dt*dt+1)-dt)}function Ce(Qe){return(Math.exp(Qe)-Math.exp(-Qe))/2}function Oe(Qe){return(Math.exp(Qe)+Math.exp(-Qe))/2}const Ae=fe(0);let Le=function(Qe){return Oe(Ae)/Oe(Ae+re*Qe)},ut=function(Qe){return de*((Oe(Ae)*(Ce(dt=Ae+re*Qe)/Oe(dt))-Ce(Ae))/ce)/Ee;var dt},He=(fe(1)-Ae)/re;if(Math.abs(Ee)<1e-6||!isFinite(He)){if(Math.abs(de-be)<1e-6)return this.easeTo(c,f);const Qe=be<de?-1:1;He=Math.abs(Math.log(be/de))/re,ut=function(){return 0},Le=function(dt){return Math.exp(Qe*re*dt)}}c.duration="duration"in c?+c.duration:1e3*He/("screenSpeed"in c?+c.screenSpeed/re:+c.speed),c.maxDuration&&c.duration>c.maxDuration&&(c.duration=0);const Je=S!==L,Be=F!==M,lt=Qe=>dt=>{const ye=dt*He,$e=1/Le(ye);Qe.zoom=dt===1?k:w+Qe.scaleZoom($e),Je&&(Qe.bearing=s.n(S,L,dt)),Be&&(Qe.pitch=s.n(M,F,dt));const St=dt===1?ne:Qe.unproject(oe.add(ie.mult(ut(ye))).mult($e));return Qe.setLocationAtPoint(Qe.renderWorldCopies?St.wrap():St,K),Qe._updateCameraOnTerrain(),c.preloadOnly||this._fireMoveEvents(f),Qe};if(c.preloadOnly){const Qe=this._emulate(lt,c.duration,v);return this._preloadTiles(Qe),this}return this._zooming=!0,this._rotating=Je,this._pitching=Be,this._prepareEase(f,!1),this._ease(lt(v),()=>this._afterEase(f),c),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(c,f){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const v=this._onEaseEnd;this._onEaseEnd=void 0,v.call(this,f)}if(!c){const v=this.handlers;v&&v.stop(!1)}return this}_ease(c,f,v){v.animate===!1||v.duration===0?(c(1),f()):(this._easeStart=s.a4.now(),this._easeOptions=v,this._onEaseFrame=c,this._onEaseEnd=f,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const c=Math.min((s.a4.now()-this._easeStart)/this._easeOptions.duration,1),f=this._onEaseFrame;f&&f(this._easeOptions.easing(c)),c<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(c,f){c=s.w(c,-180,180);const v=Math.abs(c-f);return Math.abs(c-360-f)<v&&(c-=360),Math.abs(c+360-f)<v&&(c+=360),c}_normalizeCenter(c){const f=this.transform;if(f.maxBounds||f.projection.name!=="globe"&&!f.renderWorldCopies)return;const v=c.lng-f.center.lng;c.lng+=v>180?-360:v<-180?360:0}_prefersReducedMotion(c){return this._respectPrefersReducedMotion&&s.a4.prefersReducedMotion&&!(c&&c.essential)}_emulate(c,f,v){const w=Math.ceil(15*f/1e3),S=[],M=c(v.clone());for(let k=0;k<=w;k++){const L=M(k/w);S.push(L.clone())}return S}}class fm{constructor(c={}){this.options=c,s.aR(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(c){const f=this.options&&this.options.compact;return this._map=c,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=j("button","mapboxgl-ctrl-attrib-button",this._container),j("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=j("div","mapboxgl-ctrl-attrib-inner",this._container),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(c,f){const v=this._map._getUIString(`AttributionControl.${f}`);c.removeAttribute("title"),c.firstElementChild&&c.firstElementChild.setAttribute("title",v)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let c=this._editLink;c||(c=this._editLink=this._container.querySelector(".mapbox-improve-map"));const f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||s.cM.ACCESS_TOKEN}];if(c){const v=f.reduce((w,S,M)=>(S.value&&(w+=`${S.key}=${S.value}${M<f.length-1?"&":""}`),w),"?");c.href=`${s.cM.FEEDBACK_URL}/${v}#${ml(this._map,!0)}`,c.rel="noopener nofollow",this._setElementTitle(c,"MapFeedback")}}_updateData(c){!c||c.sourceDataType!=="metadata"&&c.sourceDataType!=="visibility"&&c.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let c=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const f=this._map.style._mergedSourceCaches;for(const w in f){const S=f[w];if(S.used){const M=S.getSource();M.attribution&&c.indexOf(M.attribution)<0&&c.push(M.attribution)}}c.sort((w,S)=>w.length-S.length),c=c.filter((w,S)=>{for(let M=S+1;M<c.length;M++)if(c[M].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?c=[...this.options.customAttribution,...c]:c.unshift(this.options.customAttribution));const v=c.join(" | ");v!==this._attribHTML&&(this._attribHTML=v,c.length?(this._innerContainer.innerHTML=v,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class pm{constructor(){s.aR(["_updateLogo","_updateCompact"],this)}onAdd(c){this._map=c,this._container=j("div","mapboxgl-ctrl");const f=j("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(c){c&&c.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const c=this._map.style._sourceCaches;if(Object.entries(c).length===0)return!0;for(const f in c){const v=c[f].getSource();if(v.hasOwnProperty("mapbox_logo")&&!v.mapbox_logo)return!1}return!0}_updateCompact(){const c=this._container.children;if(c.length){const f=c[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}}}class mm{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(c){const f=++this._id;return this._queue.push({callback:c,id:f,cancelled:!1}),f}remove(c){const f=this._currentlyRunning,v=f?this._queue.concat(f):this._queue;for(const w of v)if(w.id===c)return void(w.cancelled=!0)}run(c=0){const f=this._currentlyRunning=this._queue;this._queue=[];for(const v of f)if(!v.cancelled&&(v.callback(c),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function gm(_,c,f){if(_=new s.L(_.lng,_.lat),c){const v=new s.L(_.lng-360,_.lat),w=new s.L(_.lng+360,_.lat),S=360*Math.ceil(Math.abs(_.lng-f.center.lng)/360),M=f.locationPoint(_).distSqr(c),k=c.x<0||c.y<0||c.x>f.width||c.y>f.height;f.locationPoint(v).distSqr(c)<M&&(k||Math.abs(v.lng-f.center.lng)<S)?_=v:f.locationPoint(w).distSqr(c)<M&&(k||Math.abs(w.lng-f.center.lng)<S)&&(_=w)}for(;Math.abs(_.lng-f.center.lng)>180;){const v=f.locationPoint(_);if(v.x>=0&&v.y>=0&&v.x<=f.width&&v.y<=f.height)break;_.lng>f.center.lng?_.lng-=360:_.lng+=360}return _}const Wd={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Li extends s.a6{constructor(c,f){if(super(),(c instanceof HTMLElement||f)&&(c=s.ak({element:c},f)),s.aR(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=c&&c.anchor||"center",this._color=c&&c.color||"#3FB1CE",this._scale=c&&c.scale||1,this._draggable=c&&c.draggable||!1,this._clickTolerance=c&&c.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=c&&c.rotation||0,this._rotationAlignment=c&&c.rotationAlignment||"auto",this._pitchAlignment=c&&c.pitchAlignment&&c.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=c&&c.occludedOpacity||.2,c&&c.element)this._element=c.element,this._offset=s.P.convert(c&&c.offset||[0,0]);else{this._defaultMarker=!0,this._element=j("div");const S=41,M=27,k=G("svg",{display:"block",height:S*this._scale+"px",width:M*this._scale+"px",viewBox:`0 0 ${M} ${S}`},this._element),L=G("radialGradient",{id:"shadowGradient"},G("defs",{},k));G("stop",{offset:"10%","stop-opacity":.4},L),G("stop",{offset:"100%","stop-opacity":.05},L),G("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},k),G("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},k),G("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},k),G("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},k),this._offset=s.P.convert(c&&c.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",S=>{S.preventDefault()}),this._element.addEventListener("mousedown",S=>{S.preventDefault()});const v=this._element.classList;for(const S in Wd)v.remove(`mapboxgl-marker-anchor-${S}`);v.add(`mapboxgl-marker-anchor-${this._anchor}`);const w=c&&c.className?c.className.trim().split(/\s+/):[];v.add(...w),this._popup=null}addTo(c){return c===this._map||(this.remove(),this._map=c,c.getCanvasContainer().appendChild(this._element),c.on("move",this._updateMoving),c.on("moveend",this._update),c.on("remove",this._clearFadeTimer),c._addMarker(this),this.setDraggable(this._draggable),this._update(),c.on("click",this._onMapClick)),this}remove(){const c=this._map;return c&&(c.off("click",this._onMapClick),c.off("move",this._updateMoving),c.off("moveend",this._update),c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler),c.off("mouseup",this._onUp),c.off("touchend",this._onUp),c.off("mousemove",this._onMove),c.off("touchmove",this._onMove),c.off("remove",this._clearFadeTimer),c._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(c){return this._lngLat=s.L.convert(c),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(c){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),c){if(!("offset"in c.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);c.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(38.1-13.5+w)],"bottom-right":[-w,-1*(38.1-13.5+w)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=c,c._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(c){const f=c.code,v=c.charCode||c.keyCode;f!=="Space"&&f!=="Enter"&&v!==32&&v!==13||this.togglePopup()}_onMapClick(c){const f=c.originalEvent.target,v=this._element;this._popup&&(f===v||v.contains(f))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const c=this._popup;return c?(c.isOpen()?(c.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(c.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const c=this._map,f=this._pos;if(!c||!f)return!1;const v=c.unproject(f),w=c.getFreeCameraOptions();if(!w.position)return!1;const S=w.position.toLngLat();return S.distanceTo(v)<.9*S.distanceTo(this._lngLat)}_evaluateOpacity(){const c=this._map;if(!c)return;const f=this._pos;if(!f||f.x<0||f.x>c.transform.width||f.y<0||f.y>c.transform.height)return void this._clearFadeTimer();const v=c.unproject(f);let w;c._showingGlobe()&&s.cN(c.transform,this._lngLat)?w=0:(w=1-c._queryFogOpacity(v),c.transform._terrainEnabled()&&c.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const c=this._pos;if(!c||!this._map)return;const f=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${c.x}px,${c.y}px)
            ${Wd[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${f.x}px,${f.y}px)
        `}_calculateXYTransform(){const c=this._pos,f=this._map,v=this.getPitchAlignment();if(!f||!c||v!=="map")return"";if(!f._showingGlobe()){const L=f.getPitch();return L?`rotateX(${L}deg)`:""}const w=s.Y(s.cO(f.transform,this._lngLat)),S=c.sub(s.cP(f.transform)),M=Math.abs(S.x)+Math.abs(S.y);if(M===0)return"";const k=w/M;return`rotateX(${-S.y*k}deg) rotateY(${S.x*k}deg)`}_calculateZTransform(){const c=this._pos,f=this._map;if(!f||!c)return"";let v=0;const w=this.getRotationAlignment();if(w==="map")if(f._showingGlobe()){const S=f.project(new s.L(this._lngLat.lng,this._lngLat.lat+.001)),M=f.project(new s.L(this._lngLat.lng,this._lngLat.lat-.001)).sub(S);v=s.Y(Math.atan2(M.y,M.x))-90}else v=-f.getBearing();else if(w==="horizon"){const S=s.an(4,6,f.getZoom()),M=s.cP(f.transform);M.y+=S*f.transform.height;const k=c.sub(M),L=s.Y(Math.atan2(k.y,k.x));v=(L>90?L-270:L+90)*(1-S)}return v+=this._rotation,v?`rotateZ(${v}deg)`:""}_update(c){cancelAnimationFrame(this._updateFrameId);const f=this._map;f&&(f.transform.renderWorldCopies&&(this._lngLat=gm(this._lngLat,this._pos,f.transform)),this._pos=f.project(this._lngLat),c===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),f._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(f._showingGlobe()||f.getTerrain()||f.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(c){return this._offset=s.P.convert(c),this._update(),this}addClassName(c){return this._element.classList.add(c),this}removeClassName(c){return this._element.classList.remove(c),this}toggleClassName(c){return this._element.classList.toggle(c)}_onMove(c){const f=this._map;if(!f)return;const v=this._pointerdownPos,w=this._positionDelta;if(v&&w){if(!this._isDragging){const S=this._clickTolerance||f._clickTolerance;if(c.point.dist(v)<S)return;this._isDragging=!0}this._pos=c.point.sub(w),this._lngLat=f.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new s.a8("dragstart"))),this.fire(new s.a8("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const c=this._map;c&&(c.off("mousemove",this._onMove),c.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new s.a8("dragend")),this._state="inactive"}_addDragHandler(c){const f=this._map,v=this._pos;f&&v&&this._element.contains(c.originalEvent.target)&&(c.preventDefault(),this._positionDelta=c.point.sub(v),this._pointerdownPos=c.point,this._state="pending",f.on("mousemove",this._onMove),f.on("touchmove",this._onMove),f.once("mouseup",this._onUp),f.once("touchend",this._onUp))}setDraggable(c){this._draggable=!!c;const f=this._map;return f&&(c?(f.on("mousedown",this._addDragHandler),f.on("touchstart",this._addDragHandler)):(f.off("mousedown",this._addDragHandler),f.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(c){return this._rotation=c||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(c){return this._rotationAlignment=c||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(c){return this._pitchAlignment=c||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(c){return this._occludedOpacity=c||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const db={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ov=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _m(_=new s.P(0,0),c="bottom"){if(typeof _=="number"){const f=Math.round(Math.sqrt(.5*Math.pow(_,2)));switch(c){case"top":return new s.P(0,_);case"top-left":return new s.P(f,f);case"top-right":return new s.P(-f,f);case"bottom":return new s.P(0,-_);case"bottom-left":return new s.P(f,-f);case"bottom-right":return new s.P(-f,-f);case"left":return new s.P(_,0);case"right":return new s.P(-_,0)}return new s.P(0,0)}return _ instanceof s.P||Array.isArray(_)?s.P.convert(_):s.P.convert(_[c]||[0,0])}class fb{constructor(c){this.jumpTo(c)}getValue(c){if(c<=this._startTime)return this._start;if(c>=this._endTime)return this._end;const f=s.ba((c-this._startTime)/(this._endTime-this._startTime));return this._start*(1-f)+this._end*f}isEasing(c){return c>=this._startTime&&c<=this._endTime}jumpTo(c){this._startTime=-1/0,this._endTime=-1/0,this._start=c,this._end=c}easeTo(c,f,v){this._start=this.getValue(f),this._end=c,this._startTime=f,this._endTime=f+v}}const pb={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ws={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1};class sv{constructor(){this.showOverdrawInspector=!1,this.showTileBoundaries=!1,this.continuousRedraw=!1,this.showTerrainWireframe=!1,this.showLayers2DWireframe=!1,this.showLayers3DWireframe=!1}}const mb={showCompass:!0,showZoom:!0,visualizePitch:!1};class yl{constructor(c,f,v=!1){this._clickTolerance=10,this.element=f,this.mouseRotate=new cm({clickTolerance:c.dragRotate._mouseRotate._clickTolerance}),this.map=c,v&&(this.mousePitch=new um({clickTolerance:c.dragRotate._mousePitch._clickTolerance})),s.aR(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),f.addEventListener("mousedown",this.mousedown),f.addEventListener("touchstart",this.touchstart,{passive:!1}),f.addEventListener("touchmove",this.touchmove),f.addEventListener("touchend",this.touchend),f.addEventListener("touchcancel",this.reset)}down(c,f){this.mouseRotate.mousedown(c,f),this.mousePitch&&this.mousePitch.mousedown(c,f),U()}move(c,f){const v=this.map,w=this.mouseRotate.mousemoveWindow(c,f),S=w&&w.bearingDelta;if(S&&v.setBearing(v.getBearing()+S),this.mousePitch){const M=this.mousePitch.mousemoveWindow(c,f),k=M&&M.pitchDelta;k&&v.setPitch(v.getPitch()+k)}}off(){const c=this.element;c.removeEventListener("mousedown",this.mousedown),c.removeEventListener("touchstart",this.touchstart,{passive:!1}),c.removeEventListener("touchmove",this.touchmove),c.removeEventListener("touchend",this.touchend),c.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){q(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(c){this.down(s.ak({},c,{ctrlKey:!0,preventDefault:()=>c.preventDefault()}),ue(this.element,c)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(c){this.move(c,ue(this.element,c))}mouseup(c){this.mouseRotate.mouseupWindow(c),this.mousePitch&&this.mousePitch.mouseupWindow(c),this.offTemp()}touchstart(c){c.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Me(this.element,c.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>c.preventDefault()},this._startPos))}touchmove(c){c.targetTouches.length!==1?this.reset():(this._lastPos=Me(this.element,c.targetTouches)[0],this.move({preventDefault:()=>c.preventDefault()},this._lastPos))}touchend(c){c.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ma={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Hc={maxWidth:100,unit:"metric"},Hd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"};return{version:s.c$,supported:O,setRTLTextPlugin:s.d1,getRTLTextPluginStatus:s.d2,Map:class extends iv{constructor(_){const c=_;if((_=s.ak({},Ws,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(_.antialias&&s.cQ(window)&&(_.antialias=!1,s.X("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Or(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),_),this._repaint=!1,this._interactive=_.interactive,this._minTileCacheSize=_.minTileCacheSize,this._maxTileCacheSize=_.maxTileCacheSize,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=_.crossSourceCollisions,this._collectResourceTiming=_.collectResourceTiming,this._language=this._parseLanguage(_.language),this._worldview=_.worldview,this._renderTaskQueue=new mm,this._domRenderTaskQueue=new mm,this._controls=[],this._markers=[],this._popups=[],this._mapId=s.cR(),this._locale=s.ak({},pb,_.locale),this._clickTolerance=_.clickTolerance,this._cooperativeGestures=_.cooperativeGestures,this._performanceMetricsCollection=_.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new fb(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new s.cS(_.transformRequest,_.accessToken,_.testMode),this._silenceAuthErrors=!!_.testMode,this._contextCreateOptions=_.contextCreateOptions?{..._.contextCreateOptions}:{},typeof _.container=="string"){const f=document.getElementById(_.container);if(!f)throw new Error(`Container '${_.container.toString()}' not found.`);this._container=f}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(this._container.childNodes.length>0&&s.X("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),_.maxBounds&&this.setMaxBounds(_.maxBounds),s.aR(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._debugParams=new sv,this._tp=_.devtools?new By(this):new By,this._tp.registerParameter(this._debugParams,["Debug"],"showOverdrawInspector",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"showTileBoundaries",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug"],"continuousRedraw",void 0,f=>{this.repaint=f}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showTerrainWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers2DWireframe",void 0,()=>{this._update()}),this._tp.registerParameter(this._debugParams,["Debug","Wireframe"],"showLayers3DWireframe",void 0,()=>{this._update()}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new rv(this,_),this._localFontFamily=_.localFontFamily,this._localIdeographFontFamily=_.localIdeographFontFamily,(_.style||!_.testMode)&&this.setStyle(_.style||s.cM.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),_.projection&&this.setProjection(_.projection),_.hash&&(this._hash=new qy(typeof _.hash=="string"&&_.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){c.center==null&&c.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch});const f=_.bounds;f&&(this.resize(),this.fitBounds(f,s.ak({},_.fitBoundsOptions,{duration:0})))}this.resize(),_.attributionControl&&this.addControl(new fm({customAttribution:_.customAttribution})),this._logoControl=new pm,this.addControl(this._logoControl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",f=>{this._update(f.dataType==="style"),this.fire(new s.a8(`${f.dataType}data`,f))}),this.on("dataloading",f=>{this.fire(new s.a8(`${f.dataType}dataloading`,f))})}_getMapId(){return this._mapId}addControl(_,c){if(c===void 0&&(c=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new s.a7(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const f=_.onAdd(this);this._controls.push(_);const v=this._controlPositions[c];return c.indexOf("bottom")!==-1?v.insertBefore(f,v.firstChild):v.appendChild(f),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new s.a7(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const c=this._controls.indexOf(_);return c>-1&&this._controls.splice(c,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(_){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const c=!this._moving;return c&&this.fire(new s.a8("movestart",_)).fire(new s.a8("move",_)),this.fire(new s.a8("resize",_)),c&&this.fire(new s.a8("moveend",_)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(_){return this.transform.setMaxBounds(s.D.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_?this.setZoom(_):this.fire(new s.a8("zoomstart")).fire(new s.a8("zoom")).fire(new s.a8("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_?this.setZoom(_):this.fire(new s.a8("zoomstart")).fire(new s.a8("zoom")).fire(new s.a8("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_?this.setPitch(_):this.fire(new s.a8("pitchstart")).fire(new s.a8("pitch")).fire(new s.a8("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_?this.setPitch(_):this.fire(new s.a8("pitchstart")).fire(new s.a8("pitch")).fire(new s.a8("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(_){return _==="auto"?navigator.language:Array.isArray(_)?_.length===0?void 0:_.map(c=>c==="auto"?navigator.language:c):_}setLanguage(_){const c=this._parseLanguage(_);if(!this.style||c===this._language)return this;this._language=c,this.style.reloadSources();for(const f of this._controls)f._setLanguage&&f._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(_){return this.style&&_!==this._worldview?(this._worldview=_,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(_){return this._lazyInitEmptyStyle(),_?typeof _=="string"&&(_={name:_}):_=null,this._useExplicitProjection=!!_,this._prioritizeAndUpdateProjection(_,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const _=this.transform,c=_.projection.name;let f;c==="globe"&&_.zoom>=s.G?(_.setMercatorFromTransition(),f=!0):c==="mercator"&&_.zoom<s.G&&(_.setProjection({name:"globe"}),f=!0),f&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(_,c){return this._updateProjection(_||c||{name:"mercator"})}_updateProjection(_){let c;return c=_.name==="globe"&&this.transform.zoom>=s.G?this.transform.setMercatorFromTransition():this.transform.setProjection(_),this.style.applyProjectionUpdate(),c&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(_){return this.transform.locationPoint3D(s.L.convert(_))}unproject(_){return this.transform.pointLocation3D(s.P.convert(_))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(_,c,f){if(_==="mouseenter"||_==="mouseover"){let v=!1;const w=M=>{const k=c.filter(F=>this.getLayer(F)),L=k.length?this.queryRenderedFeatures(M.point,{layers:k}):[];L.length?v||(v=!0,f.call(this,new ds(_,this,M.originalEvent,{features:L}))):v=!1},S=()=>{v=!1};return{layers:new Set(c),listener:f,delegates:{mousemove:w,mouseout:S}}}if(_==="mouseleave"||_==="mouseout"){let v=!1;const w=M=>{const k=c.filter(L=>this.getLayer(L));(k.length?this.queryRenderedFeatures(M.point,{layers:k}):[]).length?v=!0:v&&(v=!1,f.call(this,new ds(_,this,M.originalEvent)))},S=M=>{v&&(v=!1,f.call(this,new ds(_,this,M.originalEvent)))};return{layers:new Set(c),listener:f,delegates:{mousemove:w,mouseout:S}}}{const v=w=>{const S=c.filter(k=>this.getLayer(k)),M=S.length?this.queryRenderedFeatures(w.point,{layers:S}):[];M.length&&(w.features=M,f.call(this,w),delete w.features)};return{layers:new Set(c),listener:f,delegates:{[_]:v}}}}on(_,c,f){if(f===void 0)return super.on(_,c);if(Array.isArray(c)||(c=[c]),c){for(const w of c)if(!this._isValidId(w))return this}const v=this._createDelegatedListener(_,c,f);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(v);for(const w in v.delegates)this.on(w,v.delegates[w]);return this}once(_,c,f){if(f===void 0)return super.once(_,c);if(Array.isArray(c)||(c=[c]),c){for(const w of c)if(!this._isValidId(w))return this}const v=this._createDelegatedListener(_,c,f);for(const w in v.delegates)this.once(w,v.delegates[w]);return this}off(_,c,f){if(f===void 0)return super.off(_,c);c=new Set(Array.isArray(c)?c:[c]);for(const S of c)if(!this._isValidId(S))return this;const v=(S,M)=>{if(S.size!==M.size)return!1;for(const k of S)if(!M.has(k))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[_]:void 0;return w&&(S=>{for(let M=0;M<S.length;M++){const k=S[M];if(k.listener===f&&v(k.layers,c)){for(const L in k.delegates)this.off(L,k.delegates[L]);return S.splice(M,1),this}}})(w),this}queryRenderedFeatures(_,c){if(!this.style)return[];if(c!==void 0||_===void 0||_ instanceof s.P||Array.isArray(_)||(c=_,_=void 0),_=_||[[0,0],[this.transform.width,this.transform.height]],(c=c||{}).layers&&Array.isArray(c.layers)){for(const f of c.layers)if(!this._isValidId(f))return[]}return this.style.queryRenderedFeatures(_,c,this.transform)}querySourceFeatures(_,c){return this._isValidId(_)?this.style.querySourceFeatures(_,c):[]}isPointOnSurface(_){const{name:c}=this.transform.projection;return c!=="globe"&&c!=="mercator"&&s.X(`${c} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(s.P.convert(_))}setStyle(_,c){return(c=s.ak({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},c)).diff!==!1&&c.localIdeographFontFamily===this._localIdeographFontFamily&&c.localFontFamily===this._localFontFamily&&this.style&&_?(this._diffStyle(_,c),this):(this._localIdeographFontFamily=c.localIdeographFontFamily,this._localFontFamily=c.localFontFamily,this._updateStyle(_,c))}_getUIString(_){const c=this._locale[_];if(c==null)throw new Error(`Missing UI string '${_}'`);return c}_updateStyle(_,c){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),_&&(this.style=new Is(this,c||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_):this.style.loadJSON(_)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Is(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,c){if(typeof _=="string"){const f=this._requestManager.normalizeStyleURL(_),v=this._requestManager.transformRequest(f,s.a2.Style);s.a1(v,(w,S)=>{w?this.fire(new s.a7(w)):S&&this._updateDiff(S,c)})}else typeof _=="object"&&this._updateDiff(_,c)}_updateDiff(_,c){try{this.style.setState(_)&&this._update(!0)}catch(f){s.X(`Unable to perform style diff: ${f.message||f.error||f}.  Rebuilding the style from scratch.`),this._updateStyle(_,c)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(s.X("There is no style added to the map."),!1)}_isValidId(_){return _==null?(this.fire(new s.a7(new Error("IDs can't be empty."))),!1):!s.cu(_)||(this.fire(new s.a7(new Error(`IDs can't contain special symbols: "${_}".`))),!1)}addSource(_,c){return this._isValidId(_)?(this._lazyInitEmptyStyle(),this.style.addSource(_,c),this._update(!0)):this}isSourceLoaded(_){return!!this._isValidId(_)&&!!this.style&&this.style._isSourceCacheLoaded(_)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(_,c,f){this._lazyInitEmptyStyle(),this.style.addSourceType(_,c,f)}removeSource(_){return this._isValidId(_)?(this.style.removeSource(_),this._updateTerrain(),this._update(!0)):this}getSource(_){return this._isValidId(_)?this.style.getOwnSource(_):null}addImage(_,c,{pixelRatio:f=1,sdf:v=!1,stretchX:w,stretchY:S,content:M}={}){if(this._lazyInitEmptyStyle(),c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap){const{width:k,height:L,data:F}=s.a4.getImageData(c);this.style.addImage(_,{data:new s.a5({width:k,height:L},F),pixelRatio:f,stretchX:w,stretchY:S,content:M,sdf:v,version:0})}else if(c.width===void 0||c.height===void 0)this.fire(new s.a7(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:k,height:L}=c,F=c;this.style.addImage(_,{data:new s.a5({width:k,height:L},new Uint8Array(F.data)),pixelRatio:f,stretchX:w,stretchY:S,content:M,sdf:v,version:0,userImage:F}),F.onAdd&&F.onAdd(this,_)}}updateImage(_,c){this._lazyInitEmptyStyle();const f=this.style.getImage(_);if(!f)return void this.fire(new s.a7(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const v=c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap?s.a4.getImageData(c):c,{width:w,height:S}=v,M=v.data;if(w===void 0||S===void 0)return void this.fire(new s.a7(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==f.data.width||S!==f.data.height)return void this.fire(new s.a7(new Error(`The width and height of the updated image (${w}, ${S})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));const k=!(c instanceof HTMLImageElement||ImageBitmap&&c instanceof ImageBitmap);f.data.replace(M,k),this.style.updateImage(_,f)}hasImage(_){return _?!!this.style&&!!this.style.getImage(_):(this.fire(new s.a7(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_,c){s.a3(this._requestManager.transformRequest(_,s.a2.Image),(f,v)=>{c(f,v instanceof HTMLImageElement?s.a4.getImageData(v):v)})}listImages(){return this.style.listImages()}addModel(_,c){this._lazyInitEmptyStyle(),this.style.addModel(_,c)}hasModel(_){return _?this.style.hasModel(_):(this.fire(new s.a7(new Error("Missing required model id"))),!1)}removeModel(_){this.style.removeModel(_)}listModels(){return this.style.listModels()}addLayer(_,c){return this._isValidId(_.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(_,c),this._update(!0)):this}moveLayer(_,c){return this._isValidId(_)?(this.style.moveLayer(_,c),this._update(!0)):this}removeLayer(_){return this._isValidId(_)?(this.style.removeLayer(_),this._update(!0)):this}getLayer(_){return this._isValidId(_)?this.style.getOwnLayer(_):null}setLayerZoomRange(_,c,f){return this._isValidId(_)?(this.style.setLayerZoomRange(_,c,f),this._update(!0)):this}setFilter(_,c,f={}){return this._isValidId(_)?(this.style.setFilter(_,c,f),this._update(!0)):this}getFilter(_){return this._isValidId(_)?this.style.getFilter(_):null}setPaintProperty(_,c,f,v={}){return this._isValidId(_)?(this.style.setPaintProperty(_,c,f,v),this._update(!0)):this}getPaintProperty(_,c){return this._isValidId(_)?this.style.getPaintProperty(_,c):null}setLayoutProperty(_,c,f,v={}){return this._isValidId(_)?(this.style.setLayoutProperty(_,c,f,v),this._update(!0)):this}getLayoutProperty(_,c){return this._isValidId(_)?this.style.getLayoutProperty(_,c):null}getConfigProperty(_,c){return this.style.getConfigProperty(_,c)}setConfigProperty(_,c,f){return this.style.setConfigProperty(_,c,f),this._update(!0)}setLights(_){if(this._lazyInitEmptyStyle(),_&&_.length===1&&_[0].type==="flat"){const c=_[0];c.properties?this.style.setFlatLight(c.properties,c.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(_),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const _=this.style.getLights()||[];return _.length===0&&_.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),_}setLight(_,c={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:_}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(_){return this._lazyInitEmptyStyle(),!_&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(_),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(_){return this._lazyInitEmptyStyle(),this.style.setFog(_),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(_){return this.style.setCamera(_),this._triggerCameraUpdate(_)}_triggerCameraUpdate(_){return this._update(this.transform.setOrthographicProjectionAtLowPitch(_["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(_){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(s.L.convert(_),this.transform):0}setFeatureState(_,c){return this._isValidId(_.source)?(this.style.setFeatureState(_,c),this._update()):this}removeFeatureState(_,c){return this._isValidId(_.source)?(this.style.removeFeatureState(_,c),this._update()):this}getFeatureState(_){return this._isValidId(_.source)?this.style.getFeatureState(_):null}_updateContainerDimensions(){if(!this._container)return;const _=this._container.getBoundingClientRect().width||400,c=this._container.getBoundingClientRect().height||300;let f,v,w,S=this._container;for(;S&&(!v||!w);){const M=window.getComputedStyle(S).transform;M&&M!=="none"&&(f=M.match(/matrix.*\((.+)\)/)[1].split(", "),f[0]&&f[0]!=="0"&&f[0]!=="1"&&(v=f[0]),f[3]&&f[3]!=="0"&&f[3]!=="1"&&(w=f[3])),S=S.parentElement}this._containerWidth=v?Math.abs(_/v):_,this._containerHeight=w?Math.abs(c/w):c}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&s.X("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const _=this._container;_.classList.add("mapboxgl-map"),(this._missingCSSCanary=j("div","mapboxgl-canary",_)).style.visibility="hidden",this._detectMissingCSS();const c=this._canvasContainer=j("div","mapboxgl-canvas-container",_);this._canvas=j("canvas","mapboxgl-canvas",c),this._interactive&&(c.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const f=this._controlContainer=j("div","mapboxgl-control-container",_),v=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{v[w]=j("div",`mapboxgl-ctrl-${w}`,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,c){const f=s.a4.devicePixelRatio||1;this._canvas.width=f*Math.ceil(_),this._canvas.height=f*Math.ceil(c),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${c}px`}_addMarker(_){this._markers.push(_)}_removeMarker(_){const c=this._markers.indexOf(_);c!==-1&&this._markers.splice(c,1)}_addPopup(_){this._popups.push(_)}_removePopup(_){const c=this._popups.indexOf(_);c!==-1&&this._popups.splice(c,1)}_setupPainter(){const _=s.ak({},O.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),c=this._canvas.getContext("webgl2",_);c?(s.cT(c,!0),this.painter=new sb(c,this._contextCreateOptions,this.transform,this._tp),this.on("data",f=>{f.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),s.cU.testSupport(c)):this.fire(new s.a7(new Error("Failed to initialize WebGL")))}_contextLost(_){_.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new s.a8("webglcontextlost",{originalEvent:_}))}_contextRestored(_){this._setupPainter(),this.resize(),this._update(),this.fire(new s.a8("webglcontextrestored",{originalEvent:_}))}_onMapScroll(_){if(_.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_requestDomTask(_){!this.loaded()||this.loaded()&&!this.isMoving()?_():this._domRenderTaskQueue.add(_)}_render(_){let c;this.fire(new s.a8("renderstart"));const f=this.painter.context.extTimerQuery,v=s.a4.now(),w=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(c=w.createQuery(),w.beginQuery(f.TIME_ELAPSED_EXT,c)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(_),this._domRenderTaskQueue.run(_),this._removed)return;this._updateProjectionTransition();const S=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const L=this.transform.zoom,F=this.transform.pitch,$=s.a4.now(),Z=new s.al(L,{now:$,fadeDuration:S,pitch:F,transition:this.style.transition});this.style.update(Z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let M=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),M=this._updateAverageElevation(v),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):M=this._updateAverageElevation(v),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,S,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries||this._debugParams.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe||this._debugParams.showTerrainWireframe,layers2D:this.showLayers2DWireframe||this._debugParams.showLayers2DWireframe,layers3D:this.showLayers3DWireframe||this._debugParams.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector||this._debugParams.showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:S,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new s.a8("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new s.a8("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),c){const L=s.a4.now()-v;w.endQuery(f.TIME_ELAPSED_EXT),setTimeout(()=>{const F=w.getQueryParameter(c,w.QUERY_RESULT)/1e6;w.deleteQuery(c),this.fire(new s.a8("gpu-timing-frame",{cpuTime:L,gpuTime:F}))},50)}if(this.listens("gpu-timing-layer")){const L=this.painter.collectGpuTimers();setTimeout(()=>{const F=this.painter.queryGpuTimers(L);this.fire(new s.a8("gpu-timing-layer",{layerTimes:F}))},50)}if(this.listens("gpu-timing-deferred-render")){const L=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const F=this.painter.queryGpuTimeDeferredRender(L);this.fire(new s.a8("gpu-timing-deferred-render",{gpuTime:F}))},50)}const k=this._sourcesDirty||this._styleDirty||this._placementDirty||M;if(k||this._repaint)this.triggerRepaint();else{const L=!this.isMoving()&&this.loaded();if(L&&(M=this._updateAverageElevation(v,!0)),M)this.triggerRepaint();else if(this._triggerFrame(!1),L&&(this.fire(new s.a8("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const F=this._calculateSpeedIndex();this.fire(new s.a8("speedindexcompleted",{speedIndex:F})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||k||(this._fullyLoaded=!0,this._performanceMetricsCollection&&s.cV(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(_){for(const c of this._markers)_&&!this.getRenderWorldCopies()&&(c._lngLat=c._lngLat.wrap()),c._update();for(const c of this._popups)!_||this.getRenderWorldCopies()||c._trackPointer||(c._lngLat=c._lngLat.wrap()),c._update()}_updateAverageElevation(_,c=!1){const f=w=>(this.transform.averageElevation=w,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&f(0);const v=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(v||(c||_-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(_)){const w=this.transform.averageElevation;let S=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(S)?S=0:this._averageElevationLastSampledAt=_;const M=Math.abs(w-S);if(M>1){if(this._isInitialLoad||v)return this._averageElevation.jumpTo(S),f(S);this._averageElevation.easeTo(S,_,300)}else if(M>1e-4)return this._averageElevation.jumpTo(S),f(S)}return!!this._averageElevation.isEasing(_)&&f(this._averageElevation.getValue(_))}_authenticate(){s.cW(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,_=>{if(_&&(_.message===s.cX||_.status===401)){const c=this.painter.context.gl;s.cT(c,!1),this._logoControl instanceof pm&&this._logoControl._updateLogo(),c&&c.clear(c.DEPTH_BUFFER_BIT|c.COLOR_BUFFER_BIT|c.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new s.a7(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),s.cY(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const _=this._isDragging();this.painter.updateTerrain(this.style,_)}_calculateSpeedIndex(){const _=this.painter.canvasCopy(),c=this.painter.getCanvasCopiesAndTimestamps();c.timeStamps.push(performance.now());const f=this.painter.context.gl,v=f.createFramebuffer();function w(S){f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_2D,S,0);const M=new Uint8Array(f.drawingBufferWidth*f.drawingBufferHeight*4);return f.readPixels(0,0,f.drawingBufferWidth,f.drawingBufferHeight,f.RGBA,f.UNSIGNED_BYTE,M),M}return f.bindFramebuffer(f.FRAMEBUFFER,v),this._canvasPixelComparison(w(_),c.canvasCopies.map(w),c.timeStamps)}_canvasPixelComparison(_,c,f){let v=f[1]-f[0];const w=_.length/4;for(let S=0;S<c.length;S++){const M=c[S];let k=0;for(let L=0;L<M.length;L+=4)M[L]===_[L]&&M[L+1]===_[L+1]&&M[L+2]===_[L+2]&&M[L+3]===_[L+3]&&(k+=1);v+=(f[S+2]-f[S+1])*(1-k/w)}return v}remove(){this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const _=this.painter.context.gl.getExtension("WEBGL_lose_context");_&&_.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),s.cZ(this.painter.context.gl),this._removed=!0,this.fire(new s.a8("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(_){this._renderNextFrame=this._renderNextFrame||_,this.style&&!this._frame&&(this._frame=s.a4.frame(c=>{const f=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,f&&this._render(c)}))}_preloadTiles(_){const c=this.style?Object.values(this.style._sourceCaches):[];return s.c_(c,(f,v)=>f._preloadTiles(_,v),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(_){this._trackResize&&this.resize({originalEvent:_})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(_){this._showTerrainWireframe!==_&&(this._showTerrainWireframe=_,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(_){this._showLayers2DWireframe!==_&&(this._showLayers2DWireframe=_,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(_){this._showLayers3DWireframe!==_&&(this._showLayers3DWireframe=_,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(_){this._speedIndexTiming!==_&&(this._speedIndexTiming=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(_){this._showTileAABBs!==_&&(this._showTileAABBs=_,_&&this._update())}_setCacheLimits(_,c){s.d0(_,c)}get version(){return s.c$}},NavigationControl:class{constructor(_){this.options=s.ak({},mb,_),this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",c=>c.preventDefault()),this.options.showZoom&&(s.aR(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",c=>{this._map&&this._map.zoomIn({},{originalEvent:c})}),j("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",c=>{this._map&&this._map.zoomOut({},{originalEvent:c})}),j("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(s.aR(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",c=>{const f=this._map;f&&(this.options.visualizePitch?f.resetNorthPitch({},{originalEvent:c}):f.resetNorth({},{originalEvent:c}))}),this._compassIcon=j("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const _=this._map;if(!_)return;const c=_.getZoom(),f=c===_.getMaxZoom(),v=c===_.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=v,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",v.toString())}_rotateCompassArrow(){const _=this._map;if(!_)return;const c=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(_.transform.pitch*(Math.PI/180)),.5)}) rotateX(${_.transform.pitch}deg) rotateZ(${_.transform.angle*(180/Math.PI)}deg)`:`rotate(${_.transform.angle*(180/Math.PI)}deg)`;_._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=c)})}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),_.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&_.on("pitch",this._rotateCompassArrow),_.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new yl(_,this._compass,this.options.visualizePitch)),this._container}onRemove(){const _=this._map;_&&(this._container.remove(),this.options.showZoom&&_.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&_.off("pitch",this._rotateCompassArrow),_.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(_,c){const f=j("button",_,this._container);return f.type="button",f.addEventListener("click",c),f}_setButtonTitle(_,c){if(!this._map)return;const f=this._map._getUIString(`NavigationControl.${c}`);_.setAttribute("aria-label",f),_.firstElementChild&&_.firstElementChild.setAttribute("title",f)}},GeolocateControl:class extends s.a6{constructor(_){super();const c=navigator.geolocation;this.options=s.ak({geolocation:c},ma,_),s.aR(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=pl(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(_){return this._map=_,this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(_){const c=(f=!!this.options.geolocation)=>{this._supportsGeolocation=f,_(f)};this._supportsGeolocation!==void 0?_(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(f=>c(f.state!=="denied")).catch(()=>c()):c()}_isOutOfMapMaxBounds(_){const c=this._map.getMaxBounds(),f=_.coords;return!!c&&(f.longitude<c.getWest()||f.longitude>c.getEast()||f.latitude<c.getSouth()||f.latitude>c.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(_){if(this._map){if(this._isOutOfMapMaxBounds(_))return this._setErrorState(),this.fire(new s.a8("outofmaxbounds",_)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=_,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(_),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(_),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.a8("geolocate",_)),this._finish()}}_updateCamera(_){const c=new s.L(_.coords.longitude,_.coords.latitude),f=_.coords.accuracy,v=this._map.getBearing(),w=s.ak({bearing:v},this.options.fitBoundsOptions);this._map.fitBounds(c.toBounds(f),w,{geolocateSource:!0})}_updateMarker(_){if(_){const c=new s.L(_.coords.longitude,_.coords.latitude);this._accuracyCircleMarker.setLngLat(c).addTo(this._map),this._userLocationDotMarker.setLngLat(c).addTo(this._map),this._accuracy=_.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const _=this._map.transform,c=s.b(1,_._center.lat)*_.worldSize,f=Math.ceil(2*this._accuracy*c);this._circleElement.style.width=`${f}px`,this._circleElement.style.height=`${f}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(_){if(this._map){if(this.options.trackUserLocation)if(_.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(_.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new s.a8("error",_)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(_){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",c=>c.preventDefault()),this._geolocateButton=j("button","mapboxgl-ctrl-geolocate",this._container),j("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",_===!1){s.X("Geolocation support is not available so the GeolocateControl will be disabled.");const c=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}else{const c=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",c),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",c)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=j("div","mapboxgl-user-location"),this._dotElement.appendChild(j("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(j("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Li({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=j("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Li({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",c=>{c.geolocateSource||this._watchState!=="ACTIVE_LOCK"||c.originalEvent&&c.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new s.a8("trackuserlocationend")))})}}_onDeviceOrientation(_){this._userLocationDotMarker&&(_.webkitCompassHeading?this._heading=_.webkitCompassHeading:_.absolute===!0&&(this._heading=-1*_.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return s.X("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new s.a8("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new s.a8("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new s.a8("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(_={maximumAge:6e5,timeout:0},this._noTimeout=!0):(_=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,_),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const _=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(c=>{c==="granted"&&_()}).catch(console.error):_()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:fm,ScaleControl:class{constructor(_){this.options=s.ak({},Hc,_),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),s.aR(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const _=this.options.maxWidth||100,c=this._map,f=c._containerHeight/2,v=c._containerWidth/2-_/2,w=c.unproject([v,f]),S=c.unproject([v+_,f]),M=w.distanceTo(S);if(this.options.unit==="imperial"){const k=3.2808*M;k>5280?this._setScale(_,k/5280,"mile"):this._setScale(_,k,"foot")}else this.options.unit==="nautical"?this._setScale(_,M/1852,"nautical-mile"):M>=1e3?this._setScale(_,M/1e3,"kilometer"):this._setScale(_,M,"meter")}_setScale(_,c,f){this._map._requestDomTask(()=>{const v=function(S){const M=Math.pow(10,`${Math.floor(S)}`.length-1);let k=S/M;return k=k>=10?10:k>=5?5:k>=3?3:k>=2?2:k>=1?1:function(L){const F=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*F)/F}(k),M*k}(c),w=v/c;this._container.innerHTML=this._isNumberFormatSupported&&f!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:f}).format(v):`${v}&nbsp;${Hd[f]}`,this._container.style.width=_*w+"px"})}onAdd(_){return this._map=_,this._language=_.getLanguage(),this._container=j("div","mapboxgl-ctrl mapboxgl-ctrl-scale",_.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(_){this._language=_,this._update()}setUnit(_){this.options.unit=_,this._update()}},FullscreenControl:class{constructor(_){this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:s.X("Full screen control 'container' must be a DOM element.")),s.aR(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=j("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",s.X("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const _=this._fullscreenButton=j("button","mapboxgl-ctrl-fullscreen",this._controlContainer);j("span","mapboxgl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",_)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends s.a6{constructor(_){super(),this.options=s.ak(Object.create(db),_),s.aR(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(_&&_.className?_.className.trim().split(/\s+/):[])}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&_.on("preclick",this._onClose),this.options.closeOnMove&&_.on("move",this._onClose),_.on("remove",this.remove),this._update(),_._addPopup(this),this._focusFirstElement(),this._trackPointer?(_.on("mousemove",this._onMouseEvent),_.on("mouseup",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")):_.on("move",this._update),this.fire(new s.a8("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const _=this._map;return _&&(_.off("move",this._update),_.off("move",this._onClose),_.off("preclick",this._onClose),_.off("click",this._onClose),_.off("remove",this.remove),_.off("mousemove",this._onMouseEvent),_.off("mouseup",this._onMouseEvent),_.off("drag",this._onMouseEvent),_._canvasContainer&&_._canvasContainer.classList.remove("mapboxgl-track-pointer"),_._removePopup(this),this._map=void 0),this.fire(new s.a8("close")),this}getLngLat(){return this._lngLat}setLngLat(_){this._lngLat=s.L.convert(_),this._pos=null,this._trackPointer=!1,this._update();const c=this._map;return c&&(c.on("move",this._update),c.off("mousemove",this._onMouseEvent),c._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const _=this._map;return _&&(_.off("move",this._update),_.on("mousemove",this._onMouseEvent),_.on("drag",this._onMouseEvent),_._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const c=document.createDocumentFragment(),f=document.createElement("body");let v;for(f.innerHTML=_;v=f.firstChild,v;)c.appendChild(v);return this.setDOMContent(c)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){let c=this._content;if(c)for(;c.hasChildNodes();)c.firstChild&&c.removeChild(c.firstChild);else c=this._content=j("div","mapboxgl-popup-content",this._container||void 0);if(c.appendChild(_),this.options.closeButton){const f=this._closeButton=j("button","mapboxgl-popup-close-button",c);f.type="button",f.setAttribute("aria-label","Close popup"),f.setAttribute("aria-hidden","true"),f.innerHTML="&#215;",f.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(_){return this._classList.add(_),this._updateClassList(),this}removeClassName(_){return this._classList.delete(_),this._updateClassList(),this}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){let c;return this._classList.delete(_)?c=!1:(this._classList.add(_),c=!0),this._updateClassList(),c}_onMouseEvent(_){this._update(_.point)}_getAnchor(_){if(this.options.anchor)return this.options.anchor;const c=this._map,f=this._container,v=this._pos;if(!c||!f||!v)return"bottom";const w=f.offsetWidth,S=f.offsetHeight,M=v.x<w/2,k=v.x>c.transform.width-w/2;if(v.y+_<S)return M?"top-left":k?"top-right":"top";if(v.y>c.transform.height-S){if(M)return"bottom-left";if(k)return"bottom-right"}return M?"left":k?"right":"bottom"}_updateClassList(){const _=this._container;if(!_)return;const c=[...this._classList];c.push("mapboxgl-popup"),this._anchor&&c.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&c.push("mapboxgl-popup-track-pointer"),_.className=c.join(" ")}_update(_){const c=this._map,f=this._content;if(!c||!this._lngLat&&!this._trackPointer||!f)return;let v=this._container;if(v||(v=this._container=j("div","mapboxgl-popup",c.getContainer()),this._tip=j("div","mapboxgl-popup-tip",v),v.appendChild(f)),this.options.maxWidth&&v.style.maxWidth!==this.options.maxWidth&&(v.style.maxWidth=this.options.maxWidth),c.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=gm(this._lngLat,this._pos,c.transform)),!this._trackPointer||_){const w=this._pos=this._trackPointer&&_?_:c.project(this._lngLat),S=_m(this.options.offset),M=this._anchor=this._getAnchor(S.y),k=_m(this.options.offset,M),L=w.add(k).round();c._requestDomTask(()=>{this._container&&M&&(this._container.style.transform=`${Wd[M]} translate(${L.x}px,${L.y}px)`)})}if(!this._marker&&c._showingGlobe()){const w=s.cN(c.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(ov);_&&_.focus()}_onClose(){this.remove()}_setOpacity(_){this._container&&(this._container.style.opacity=`${_}`),this._content&&(this._content.style.pointerEvents=_?"auto":"none")}},Marker:Li,Style:Is,LngLat:s.L,LngLatBounds:s.D,Point:s.P,MercatorCoordinate:s.M,FreeCameraOptions:Fn,Evented:s.a6,config:s.cM,prewarm:s.d3,clearPrewarmedResources:s.d4,get accessToken(){return s.cM.ACCESS_TOKEN},set accessToken(_){s.cM.ACCESS_TOKEN=_},get baseApiUrl(){return s.cM.API_URL},set baseApiUrl(_){s.cM.API_URL=_},get workerCount(){return s.d5.workerCount},set workerCount(_){s.d5.workerCount=_},get maxParallelImageRequests(){return s.cM.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(_){s.cM.MAX_PARALLEL_IMAGE_REQUESTS=_},clearStorage(_){s.d6(_)},get workerUrl(){return s.d7.workerUrl},set workerUrl(_){s.d7.workerUrl=_},get workerClass(){return s.d7.workerClass},set workerClass(_){s.d7.workerClass=_},get workerParams(){return s.d7.workerParams},set workerParams(_){s.d7.workerParams=_},get dracoUrl(){return s.d8()},set dracoUrl(_){s.d9(_)},setNow:s.a4.setNow,restoreNow:s.a4.restoreNow}});var T=g;return T})})(jj);var rae=jj.exports;const bx=vp(rae),nae=()=>{const[t,n]=W.useState(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light");return W.useEffect(()=>{const o=window.matchMedia("(prefers-color-scheme: dark)"),u=d=>n(d.matches?"dark":"light");return o.addEventListener("change",u),()=>o.removeEventListener("change",u)},[]),t},iae="_root_13ubf_1",oae="_container_13ubf_6",sae="_toolBar_13ubf_10",aae="_sideBar_13ubf_22",lae="_leg_13ubf_35",cae="_value_13ubf_57",uae="_distance_13ubf_61",hae="_waypoint_13ubf_64",dae="_number_13ubf_79",fae="_text_13ubf_91",pae="_label_13ubf_95",mae="_heading_13ubf_98",gae="_description_13ubf_103",_ae="_fadeIn_13ubf_1",ri={root:iae,container:oae,toolBar:sae,sideBar:aae,leg:lae,value:cae,distance:uae,waypoint:hae,number:dae,text:fae,label:pae,heading:mae,description:gae,fadeIn:_ae},Uj="pk.eyJ1IjoibWF0aGh1bGsiLCJhIjoiY2t6bTFhcDU2M2prOTJwa3VwcTJ2d2dpMiJ9.WEJWEP_qrKGXkYOgbIsaGg",q4=18,W4=14,H4=15.5;bx.accessToken=Uj;function yae({selectedSections:t}){const n=nae(),o=W.useRef(null),u=W.useRef([]),[d,g]=W.useState(H4),[x,T]=W.useState(null),s=W.useRef(null),I=W.useMemo(()=>t.filter(O=>O.location).map(({location:O})=>{const D=O.split(" ").slice(0,-1).join(" ");return DB[D].location}),[t]);return W.useEffect(()=>{if(!o.current)return;const O=new bx.Map({container:o.current,style:n==="dark"?"mapbox://styles/mathhulk/clvblbtkd005k01rd1n28b2xt":"mapbox://styles/mathhulk/clbznbvgs000314k8gtwa9q60",center:[-122.2592173,37.8721508],zoom:H4,minZoom:W4,maxZoom:q4});return O.on("load",async()=>{const D=new tae({styles:[{id:"directions-route-line-casing",type:"line",source:"directions",layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3b82f6","line-width":4},filter:["all",["in","$type","LineString"],["in","route","selected"]]}],accessToken:Uj,unit:"imperial",profile:"mapbox/walking",controls:{inputs:!1,instructions:!1,profileSwitcher:!1},interactive:!1,instructions:!1});O.addControl(D),D.on("route",({route:N})=>{console.log(N);for(let j=0;j<N[0].legs.length;j++){const{steps:G}=N[0].legs[j],X=document.createElement("div");X.className="marker",X.textContent=(j+1).toLocaleString();const te=new bx.Marker(X).setLngLat(G[0].maneuver.location).addTo(O);if(u.current.push(te),j!==N[0].legs.length-1)continue;const H=document.createElement("div");H.className="marker",H.textContent=(j+2).toLocaleString();const U=new bx.Marker(H).setLngLat(G[G.length-1].maneuver.location).addTo(O);u.current.push(U)}O.jumpTo({center:[-122.2592173,37.8721508]}),O.removeLayer("directions-route-line"),O.removeLayer("directions-waypoint-point-casing"),O.removeLayer("directions-waypoint-point"),O.removeLayer("directions-origin-point"),O.removeLayer("directions-destination-point"),O.removeLayer("directions-origin-label"),O.removeLayer("directions-destination-label")}),O.addSource("campus",{type:"geojson",data:"/geojson/campus.geojson"}),O.addLayer({id:"campus-fill",type:"line",source:"campus",layout:{},paint:{"line-width":1,"line-color":"#3b82f6","line-opacity":.5,"line-dasharray":[2,2]}}),O.addLayer({id:"campus-line",type:"fill",source:"campus",layout:{},paint:{"fill-color":"#3b82f6","fill-opacity":.05}}),T(D)}),O.on("zoomend",()=>{g(O.getZoom())}),s.current=O,()=>{var D;(D=s.current)==null||D.remove()}},[n]),W.useEffect(()=>{if(!x)return;u.current.forEach(D=>D.remove());const O=x.getWaypoints().length;for(let D=0;D<O;D++)x.removeWaypoint(D);if(!(I.length<2)){x.setOrigin(I[0]),x.setDestination(I[I.length-1]);for(let D=1;D<I.length-1;D++)x.addWaypoint(D,I[D])}},[I,x]),Y.jsxs("div",{className:ri.root,children:[Y.jsxs("div",{className:ri.toolBar,children:[Y.jsxs(al,{secondary:!0,className:ri.button,children:[Y.jsx(fI,{}),"Monday"]}),Y.jsx(os,{disabled:d===q4,onClick:()=>{var O;return(O=s.current)==null?void 0:O.zoomIn()},children:Y.jsx(bQ,{})}),Y.jsx(os,{disabled:d===W4,onClick:()=>{var O;return(O=s.current)==null?void 0:O.zoomOut()},children:Y.jsx(MQ,{})})]}),Y.jsx("div",{className:ri.container,ref:o}),Y.jsxs("div",{className:ri.sideBar,children:[Y.jsxs("div",{className:ri.waypoint,children:[Y.jsx("div",{className:ri.number,children:"1"}),Y.jsxs("div",{className:ri.text,children:[Y.jsx("p",{className:ri.label,children:"8:30 AM"}),Y.jsx("p",{className:ri.heading,children:"STAT 154"}),Y.jsx("p",{className:ri.description,children:"Dwinelle Hall 117"})]})]}),Y.jsxs("div",{className:ri.leg,children:[Y.jsx(UL,{}),Y.jsxs("div",{className:ri.value,children:[Y.jsx("span",{className:ri.distance,children:"5 min."})," (0.5 mi.)"]})]}),Y.jsxs("div",{className:ri.waypoint,children:[Y.jsx("div",{className:ri.number,children:"2"}),Y.jsxs("div",{className:ri.text,children:[Y.jsx("p",{className:ri.label,children:"8:30 AM"}),Y.jsx("p",{className:ri.heading,children:"STAT 154"}),Y.jsx("p",{className:ri.description,children:"Dwinelle Hall 117"})]})]}),Y.jsxs("div",{className:ri.leg,children:[Y.jsx(UL,{}),Y.jsxs("div",{className:ri.value,children:[Y.jsx("span",{className:ri.distance,children:"5 min."})," (0.5 mi.)"]})]}),Y.jsxs("div",{className:ri.waypoint,children:[Y.jsx("div",{className:ri.number,children:"3"}),Y.jsxs("div",{className:ri.text,children:[Y.jsx("p",{className:ri.label,children:"8:30 AM"}),Y.jsx("p",{className:ri.heading,children:"STAT 154"}),Y.jsx("p",{className:ri.description,children:"Dwinelle Hall 117"})]})]})]})]})}const vae="_root_h2x2n_1",xae="_view_h2x2n_7",bae="_header_h2x2n_13",wae="_menu_h2x2n_22",Eae="_body_h2x2n_26",Zg={root:vae,view:xae,header:bae,menu:wae,body:Eae},Sae="_overlay_ydv9y_1",Tae="_fadeIn_ydv9y_1",Cae="_content_ydv9y_10",Mae="_slideIn_ydv9y_1",Iae="_body_ydv9y_26",Aae="_header_ydv9y_31",Xg={overlay:Sae,fadeIn:Tae,content:Cae,slideIn:Mae,body:Iae,header:Aae};function kae({onClassSelect:t,children:n,semester:o,year:u}){const[d,g]=W.useState(!1),[x,T]=Ip(),{data:s}=ry(TI,{variables:{term:{semester:o,year:u}}}),I=W.useMemo(()=>(s==null?void 0:s.catalog)??[],[s==null?void 0:s.catalog]),O=N=>{g(N),!N&&(x.delete("query"),T(x))},D=(N,j)=>{t(N,j),g(!1),x.delete("query"),T(x)};return Y.jsxs(Aj,{onOpenChange:O,open:d,children:[Y.jsx(kj,{asChild:!0,children:n}),Y.jsxs(Pj,{children:[Y.jsx(Oj,{className:Xg.overlay}),Y.jsxs(Dj,{className:Xg.content,children:[Y.jsxs("div",{className:Xg.header,children:["Add a course to this schedule",Y.jsx(Rj,{asChild:!0,children:Y.jsx(os,{className:Xg.close,children:Y.jsx(pI,{})})})]}),Y.jsx("div",{className:Xg.body,children:Y.jsx(EI,{currentSemester:Io.Spring,currentYear:2024,courses:I,onClassSelect:D,responsive:!1})})]})]})]})}const Pae="_root_o1tke_1",Oae="_border_o1tke_4",Dae="_body_o1tke_9",Rae="_group_o1tke_19",Lae="_label_o1tke_27",zae="_header_o1tke_33",Nae="_icon_o1tke_40",Fae="_toolBar_o1tke_47",Bae="_iconButton_o1tke_52",jae="_text_o1tke_56",$ae="_heading_o1tke_60",Uae="_description_o1tke_66",Vae="_row_o1tke_70",Gae="_units_o1tke_77",ta={root:Pae,border:Oae,body:Dae,group:Rae,label:Lae,header:zae,icon:Nae,toolBar:Fae,iconButton:Bae,text:jae,heading:$ae,description:Uae,row:Vae,units:Gae},qae="_root_129cx_1",Wae="_title_129cx_7",Hae="_active_129cx_10",Zae="_radioButton_129cx_13",Xae="_time_129cx_39",Yg={root:qae,title:Wae,active:Hae,radioButton:Zae,time:Xae};function Z4({onSectionSelect:t,onSectionMouseOver:n,onSectionMouseOut:o,active:u,ccn:d,number:g,timeEnd:x,timeStart:T,days:s}){return Y.jsxs("div",{className:xi(Yg.root,{[Yg.active]:u}),onClick:()=>t==null?void 0:t(),onMouseOver:()=>n(),onMouseOut:()=>o(),children:[Y.jsx("div",{className:Yg.radioButton}),Y.jsx("p",{className:Yg.title,children:g}),Y.jsx(CI,{ccn:d,tooltip:!1}),Y.jsx(MI,{timeEnd:x,timeStart:T,days:s,tooltip:!1,className:Yg.time})]},d)}function Yae({expanded:t,onExpandedChange:n,title:o,course:u,unitsMin:d,unitsMax:g,primarySection:x,sections:T,number:s,selectedSections:I,onSectionSelect:O,onSectionMouseOver:D,onSectionMouseOut:N}){var te;const j=W.useMemo(()=>Array.from(new Set(T.map(H=>H.kind))),[T]),G=H=>{const U=structuredClone(H);U.class={number:s},O(U)},X=H=>{const U=structuredClone(H);U.class={number:s},D(U)};return Y.jsxs("div",{className:ta.root,children:[Y.jsx("div",{className:ta.border}),Y.jsxs("div",{className:ta.body,children:[Y.jsxs("div",{className:ta.header,onClick:()=>n(!t),children:[Y.jsx("div",{className:ta.icon,children:t?Y.jsx(YF,{}):Y.jsx(fI,{})}),Y.jsxs("div",{className:ta.text,children:[Y.jsxs("p",{className:ta.heading,children:[u.subject," ",u.number]}),Y.jsx("p",{className:ta.description,children:o??u.title}),Y.jsxs("div",{className:ta.row,children:[Y.jsx(_y,{gradeAverage:u.gradeAverage}),Y.jsx(H_,{enrollCount:x.enrollCount,enrollMax:x.enrollMax,waitlistCount:x.waitlistCount,waitlistMax:x.waitlistMax}),Y.jsx(dd,{unitsMin:d,unitsMax:g})]})]})]}),t&&Y.jsxs("div",{className:ta.group,children:[Y.jsx("p",{className:ta.label,children:((te=Z_[x.kind])==null?void 0:te.name)??x.kind}),Y.jsx(Z4,{active:I.some(H=>H.ccn===x.ccn),...x,onSectionMouseOver:()=>X(x),onSectionMouseOut:N})]}),t&&j.map(H=>{var q;const U=T.filter(J=>J.kind===H).sort((J,pe)=>J.number.localeCompare(pe.number));return Y.jsxs("div",{className:ta.group,children:[Y.jsx("p",{className:ta.label,children:((q=Z_[H])==null?void 0:q.name)??H}),U.map(J=>{const pe=I.some(ue=>ue.ccn===J.ccn);return W.createElement(Z4,{active:pe,onSectionMouseOut:N,onSectionMouseOver:()=>X(J),onSectionSelect:()=>G(J),...J,key:J.ccn})})]},H)})]})]})}const Qae="_root_r4xqv_1",Kae={root:Qae};function Jae({classes:t,selectedSections:n,onClassSelect:o,expanded:u,onSectionSelect:d,onSectionMouseOver:g,onSectionMouseOut:x,onExpandedChange:T}){return Y.jsxs("div",{className:Kae.root,children:[Y.jsx(kae,{onClassSelect:o,semester:"Spring",year:2024,children:Y.jsx(al,{children:"Add class"})}),t.map((s,I)=>{const O=n.filter(D=>D.course.number===s.course.number&&D.class.number===s.number&&D.course.subject===s.course.subject);return Y.jsx(Yae,{...s,expanded:u[I],onExpandedChange:D=>T(I,D),onSectionSelect:d,onSectionMouseOver:g,onSectionMouseOut:x,selectedSections:O},s.primarySection.ccn)})]})}function ele(){const t=hM(),{width:n}=wI(),[o,u]=W.useState(0),d=W.useRef(null),[g,x]=W.useState([]),[T,s]=W.useState([]),[I,O]=W.useState([]),[D,N]=W.useState(null),j=W.useCallback(H=>{N(null),O(U=>U.some(J=>J.ccn===H.ccn)?U:[...U.filter(J=>!(J.course.subject===H.course.subject&&J.course.number===H.course.number&&J.class.number===H.class.number&&J.kind==H.kind)),H])},[O]),G=W.useCallback(H=>{var U;if(o!==1){if(H.timeStart&&H.timeEnd){const q=nl(H.timeStart),J=(nl(H.timeEnd)-q)/2;(U=d.current)==null||U.scrollTo({top:q+J-d.current.clientHeight/2,behavior:"smooth"})}I.some(q=>q.ccn===H.ccn)||N(H)}},[N,I,o]),X=W.useCallback(async(H,U)=>{const{data:q}=await t.query({query:OB,variables:{term:{semester:"Spring",year:2024},subject:H.subject,courseNumber:H.number,classNumber:U}});if(!q)return;const J=g.findIndex(ge=>ge.course.subject===H.subject&&ge.course.number===H.number&&ge.number===U);if(s(ge=>{const se=structuredClone(ge);return J!==-1&&se.splice(J,1),[!0,...ge]}),x(ge=>{const se=structuredClone(ge);return J!==-1&&se.splice(J,1),[q.class,...ge]}),J!==-1)return;const{primarySection:pe,sections:ue}=q.class,Me=structuredClone(pe);Me.class={number:U},O(ge=>[...ge,Me]);const Se=Array.from(new Set(ue.map(ge=>ge.kind)));for(const ge of Se){const se=ue.filter(We=>We.kind===ge).sort((We,ze)=>We.number.localeCompare(ze.number))[0],Ie=structuredClone(se);Ie.class={number:U},O(We=>[...We,Ie])}},[t,x,g,O]),te=(H,U)=>{s(q=>{const J=structuredClone(q);return J[H]=U,J})};return Y.jsxs("div",{className:Zg.root,children:[n>992&&Y.jsx(Jae,{classes:g,selectedSections:I,expanded:T,onClassSelect:X,onSectionSelect:j,onExpandedChange:te,onSectionMouseOver:G,onSectionMouseOut:()=>N(null)}),Y.jsxs("div",{className:Zg.view,children:[Y.jsxs("div",{className:Zg.header,children:[Y.jsxs("div",{className:Zg.menu,children:[Y.jsx(Iu,{active:o===0,onClick:()=>u(0),children:"Schedule"}),Y.jsx(Iu,{active:o===1,onClick:()=>u(1),children:"Itinerary"})]}),Y.jsxs(al,{children:["Share",Y.jsx(ZY,{})]})]}),Y.jsx("div",{className:Zg.body,ref:d,id:"boundary",children:o===0?Y.jsx(Jse,{selectedSections:I,currentSection:D}):Y.jsx(yae,{selectedSections:I})})]})]})}function tle({children:t}){const{loading:n,error:o,data:u,client:d}=ry(Ree),g=()=>{n||(window.location.href="https://stanfurdtime.com/api/login?redirect_uri=http://localhost:3000/")},x=async()=>{try{await fetch("https://stanfurdtime.com/api/logout",{method:"POST",credentials:"include"}),d.resetStore()}catch(s){console.error(s)}},T=W.useMemo(()=>u==null?void 0:u.user,[u]);return Y.jsx(LB.Provider,{value:{account:T,loading:n,error:o,signIn:g,signOut:x},children:t})}const rle=rJ([{element:Y.jsx(DS,{header:!1,footer:!1}),children:[{element:Y.jsx(Mne,{}),index:!0},{element:Y.jsx(wre,{}),path:"explore"}]},{element:Y.jsx(DS,{}),children:[{element:Y.jsx(_J,{}),path:"about"}]},{element:Y.jsx(DS,{footer:!1}),children:[{element:Y.jsx(jte,{}),path:"catalog/:year?/:semester?/:subject?/:courseNumber?/:classNumber?"},{element:Y.jsx(ele,{}),path:"schedules"},{element:Y.jsx(_se,{}),path:"plan"}]}]);function nle(){return Y.jsx(xZ,{iconProps:{strokeWidth:2,width:16,height:16},children:Y.jsx(tle,{children:Y.jsx(vZ,{delayDuration:0,children:Y.jsx(uJ,{router:rle})})})})}const ile=new mz({uri:"http://localhost:8080/api/graphql",cache:new hz}),ole=SF(document.getElementById("root"));ole.render(Y.jsx(gG,{client:ile,children:Y.jsx(nle,{})}))});export default sle();
